langS_En={cdr:{column:{ID:"ID",ID_sensor:'ID<br><span style="font-size: 80%;">sensor id</span>',ID_sensor_name:'ID<br><span style="font-size: 80%;">sensor id</span>',calldate2:"Datetime",calldate2e:"Datetime<br>call end",duration2:'Duration<br><span style="font-size: 9">(PDD)</span><br>Billed time<br>codec',duration2s:"Duration<br>codec",caller2:"Caller num/name<br>SIP source IP<br>SIP agent",called2:"Called num<br>SIP destination IP<br>SIP agent",proxy:"Proxy",lastresponse:"Last response",callerrtp2:"Caller src RTP MOS<br>delay distribution<br>loss distribution",calledrtp2:"Called src RTP MOS<br>delay distribution<br>loss distribution",callerrtp2_without_rtp:"Caller src IP",calledrtp2_without_rtp:"Called dst IP",price:"Price",price_customer_shortcut:"C",price_operator_shortcut:"O",menu:"Commands",sipcallerip2:"Source IP",sipcalledip2:"Destination IP",srcSimple:"Call from",dstSimple:"Call to",durationSimple:"Duration",time_s:"time [s]",srcip:"Source IP",dstip:"Destination IP",direction:"direction",sipMsg:"SIP message",groupSipUser:"User",groupSipIP_hostName:"sip IP / host name",groupRtpIP_hostName:"rtp IP / host name",groupPhoneNumb:"phone number",groupCodec:"Codec",groupLastSIPresponse:"SIP Response",groupReasonSip:"Reason SIP",groupReasonQ850:"Reason Q850",groupIP_group:"IP Group",groupUa:"user agent",groupCountry:"country",cnt_all:"total CDR",cnt_ok:"%",sum_duration_min:"âˆ‘ minutes",acd_all:"ACD",asr_all:"ASR",ner_all:"NER",mos_all:"MOS",mos_perc95_all:"MOS %95",mos_perc99_all:"MOS %99",mos_xr_avg_all:"XR avg",mos_xr_avg_perc95_all:"XR avg %95",mos_xr_avg_perc99_all:"XR avg %99",mos_xr_avg_caller_all:"XR avg A",mos_xr_avg_caller_perc95_all:"XR avg A %95",mos_xr_avg_caller_perc99_all:"XR avg A %99",mos_xr_avg_called_all:"XR avg B",mos_xr_avg_called_perc95_all:"XR avg B %95",mos_xr_avg_called_perc99_all:"XR avg B %99",mos_xr_min_all:"XR min",mos_xr_min_perc95_all:"XR min %95",mos_xr_min_perc99_all:"XR min %99",mos_xr_min_caller_all:"XR min A",mos_xr_min_caller_perc95_all:"XR min A %95",mos_xr_min_caller_perc99_all:"XR min A %99",mos_xr_min_called_all:"XR min B",mos_xr_min_called_perc95_all:"XR min B %95",mos_xr_min_called_perc99_all:"XR min B %99",mos_silence_avg_all:"Silence avg",mos_silence_avg_perc95_all:"Silence avg %95",mos_silence_avg_perc99_all:"Silence avg %99",mos_silence_avg_caller_all:"Silence avg A",mos_silence_avg_caller_perc95_all:"Silence avg A %95",mos_silence_avg_caller_perc99_all:"Silence avg A %99",mos_silence_avg_called_all:"Silence avg B",mos_silence_avg_called_perc95_all:"Silence avg B %95",mos_silence_avg_called_perc99_all:"Silence avg B %99",mos_silence_min_all:"Silence min",mos_silence_min_perc95_all:"Silence min %95",mos_silence_min_perc99_all:"Silence min %99",mos_silence_min_caller_all:"Silence min A",mos_silence_min_caller_perc95_all:"Silence min A %95",mos_silence_min_caller_perc99_all:"Silence min A %99",mos_silence_min_called_all:"Silence min B",mos_silence_min_called_perc95_all:"Silence min B %95",mos_silence_min_called_perc99_all:"Silence min B %99",mos_lqo_caller_all:"LQO A",mos_lqo_caller_perc95_all:"LQO A %95",mos_lqo_caller_perc99_all:"LQO A %99",mos_lqo_called_all:"LQO B",mos_lqo_called_perc95_all:"LQO B %95",mos_lqo_called_perc99_all:"LQO B %99",packets_lost_all:"PL",packets_lost_perc95_all:"PL %95",packets_lost_perc99_all:"PL %99",jitter_all:"J",jitter_perc95_all:"J %95",jitter_perc99_all:"J %99",delay_all:"D",delay_perc95_all:"D %95",delay_perc99_all:"D %99",delay_all_avg:"x&#772; PDV",delay_perc95_all_avg:"x&#772; PDV %95",delay_perc99_all_avg:"x&#772; PDV %99",silence_all:"S",silence_perc95_all:"S %95",silence_perc99_all:"S %99",silence_end_all:"LS",silence_end_perc95_all:"LS %95",silence_end_perc99_all:"LS %99",clipping_all:"CF",clipping_perc95_all:"CF %95",clipping_perc99_all:"CF %99",short_60:"dur < 60s",short_20:"dur < 20s",price_customer:"price C",price_operator:"price O",price_difference:"price D",fbasename:"Call ID",firsttime:"Start",codec:"Codec",received:"Packets",saddr:"Source IP",daddr:"Dest. IP",sport:"Source Port",dport:"Dest. Port",ssrc:"SSRC",loss:"Loss",maxjitter_mult10:"Jitter",name:"name",note:"Note",created_at:"Datetime",created_name:"User"},field:{shareCdr_mailSubject:"Share CDR",shareCdr_mailMessage:"Share CDR links:\n\n",shareCdr_mailSignature:"\n---\n",interval:"interval",filter:"filter",direction:"direction",searchInterval_s:"search interval [s]",relatedInterval_s:"related interval [s]",groupBy:"group by",mosLt:"MOS <",packetsLossGtPerc:"Packets Loss [%] >",jitterGt:"Jitter >",delayCountGt:"PDV, count >",template:"Template",templateName:"Template name",privateTemplate:"Private",selectionName:"Selection name",privateSelection:"Private",showForUsers:"Restrict for users",showForGroups:"Show for groups",dateRange:"Date range",from:"From",to:"To",lastDays:"Last days",lastDaysMinutes:"Last days, minutes",currentSelection:"Current selection",namedSelection:"Named selection",reasonForAuditLog:"reason<br>(for audit log)",note:"Note",file:"Attachment"},sortBy:{calldate:"call start time",callend:"call end time",duration:"duration",pdd:"PDD",codec_payload:"codec (payload)",callerNumber:"caller number",sipSourceIP:"SIP source IP",calledNumber:"called number",sipDestinationIP:"SIP destination IP",lastresponse:"last response",sip_reason:"SIP reason",q850_reason:"Q.850 reason",priceCustomer:"price customer",priceOperator:"price operator"},field_filter:{dateRange:"Date range",dateRangeHelp:"Select date from which you want to see CDR or select date till you want to see CDR or select both dates.",dateFrom:"From",dateTo:"To",dateFromHelp:"From",dateToHelp:"To",lastDaysMinutes:"Last days, minutes",lastDaysMinutesHelp:"",currentSelection:"Current selection",currentSelectionHelp:"",namedSelection:"Named selection",namedSelectionHelp:"",num:"Number",num_start:"Numb.start",num_end:"Numb.end",num_contain:"Numb.contain",num_regexp:"Numb.regexp",numTriggerHelp:"Select search type",countryCodeByNumber:"&nbsp;&nbsp;&nbsp;&nbsp;country",countryCodeByNumberCallerCalledCmp:"&nbsp;&nbsp;&nbsp;&nbsp;compare caller / called country",callerName:"Caller name",domain:"Domain",IP:"IP address",countryCodeByIP:"&nbsp;&nbsp;&nbsp;&nbsp;country",countryCodeByIPCallerCalledCmp:"&nbsp;&nbsp;&nbsp;&nbsp;compare caller / called country",Port:"Port",ident:"Basic criteria",identHelp:'Search CDR by caller or called number. You can search for calls starting with prefix like this "001%" or ending with suffix "%123".',caller:"Caller",called:"Called",callerOrCalled:"Caller or Called",callerGroup:"Caller group",calledGroup:"Called group",callerOrCalledGroup:"Caller or Called group",source:"Source",dest:"Destination",sourceOrDest:"Source or Dest.",IP:"IP address",proxyIp:"Proxy",IPHelp:"Search CDR by SIP IP address. You can use single IP or IP/mask. For example you can select all calls from 192.168.0.0/16 subnet or just single IP address 192.168.0.10",codec:"Codec",codecHelp:"",exclude_codec:"Exclude codec",exclude_codecHelp:"",callDuration:"Call duration [s]",callDurationHelp:"Total length of call in seconds. You can search interval > 10 & < 100 seconds for example.",connectDuration:"Connect duration [s]",connectDurationHelp:"Total length of answered call. You can search interval > 10 & < 100 seconds for example.",PDD_:"PDD [s]",PDD_Help:"",ringingTime:"Ringing time [s]",ringingTime_Help:"",operLt:" < ",operGt:" >= ",lastSIPResponse:"Last SIP response code",lastSIPResponseHelp:'Search CDR by last SIP response number code or text response number code. Searching for numeric response code examples:<br>&nbsp;&bull; "4" - will search for all 4XX response codes,<br>&nbsp;&bull; "44" - will search for all 44X response codes,<br>&nbsp;&bull; "487 Block%" - will search by text response code which starts with string "487 Block",<br>&nbsp;&bull; "4,!487" - will search for all 4XX response codes except 487,<br>&nbsp;&bull; "4,!487 Request %" - will search for all 4XX response codes except those with starting string "487 Request",<br>&nbsp;&bull; "4 or 5" will search for all 4XX or 5XX response codes,<br>&nbsp;&bull; "4 or 5" will search for all 4XX or 5XX response codes.',allSIPRequests:"SIP requests",allSIPRequestsHelp:"",allSIPResponse:"SIP response code",allSIPResponseHelp:"Search for all SIP response codes. You can make logical OR use negation and substitution like % Example: 491,481,3%,%OK% will search all calls with 491 OR 481 or all 3XX or all text responses with OK in text.",reasonSip:"Reason SIP",reasonSipHelp:"Search in Reason: header SIP type protocol",reasonQ850:"Reason Q.850",reasonQ850Help:"Search in Reason: header Q.850 type protocol",reasonSipQ850:"Reason SIP & Q.850",trunk:"Direction (by trunk)",trunkHelp:"Search CDR by IN/OUT or INTERNAL which is determined by Groups -> IP groups trunk checkbox (you have to define trunks in IP groups and check Trunk checkbox there).",whoHangup:"Who hangup",whoHangupHelp:"Search calls where caller or called sent BYE",unconfirmedBye:"Unconfirmed BYE",unconfirmedByeHelp:"",byeCode:"Timeout calls",byeCodeHelp:"Type of terminated calls by the sniffer",byeCorrect:"Interrupted call",byeCorrectHelp:"Search calls where BYE SIP message is missing which can indicates interrupted call",oneWay:"One way",oneWayHelp:"",missingRtp:"Missing RTP",missingRtpHelp:"",missingSrtpKey:"Missing SRTP Key",missingSrtpKeyHelp:"",detectFAS:"FAS",detectFAShelp:"False Answer Supervision",detectZeroSSRC:"Zero SSRC",detectZeroSSRChelp:"Zero Synchronization source identifier",detectSIPALG:"SIP-ALG",detectSIPALGhelp:"Detected SIP-ALG",sdpMediaType:"SDP media type",sdpMediaTypeHelp:"",sdpMediaType_multipleSelectOperator:"multiple select operator",sdpMediaType_multipleSelectOperatorHelp:"",rtpState:"RTP streams",rtpStateHelp:"",changeSrcRtpPort:"Change source RTP port",changeSrcRtpPortHelp:"",televentRequestResponse:"Telephone event request / response",televentRequestResponseHelp:"",sipAgent:"SIP agent",sipAgentHelp:"",uaCaller:"Caller",uaCalled:"Called",uaCallerOrCalled:"Caller or Called",saddr:"RTP source IP",saddrHelp:"",a_saddr:"Caller",b_saddr:"Called",ab_saddr:"Caller or Called",callID:"Call ID",callIDHelp:"",note:"Note",noteHelp:"",maxRetransmissionInvite:"max. retransmission invite",maxRetransmissionInviteHelp:"",ipFragmented:"IP fragmented",ipFragmentedHelp:"",custhead_group:"Custom header group",sensor:"Sensor",sensorHelp:"",alertSent:"Alert history",alertSentHelp:"",reportSent:"Report history",reportSenthelp:"",MOS:"MOS <=",MOSHelp:"Search CDR by Meaning Opinion Score. 4.5 is top quality, 1 is the worst. Fixed 50 MOS represents quality for devices with minimal or no jitterbuffer. Fixed 200 represents MOS for devices with fixed 200 ms jitterbufff. Adaptive 500 represents MOS for devices with adaptive jitter buffer up to 500 ms.",MOS_LQO:"MOS LQO",MOS_LQO_Help:"Search CDR by MOS LQO. 4.5 is top quality, 1 is the worst.",delay:"PDV",delayHelp:'Search by number of delayd packets. If you search 10 in "> 70" field it will find calls where 10 packets were delayd at least 70ms.',delay_strict:"strict",delay_strictHelp:"ON is searching for exact match, all conditions must be satisfied in all PDF fields. e.g. value 2 in field >50 and value 7 in field >90 and value 10 in field >300 mean that the call must hit two or more of >50ms delayed packets AND seven or more of >90ms delayed packets AND ten or more of >300ms delayed packets. OFF is searching for any delayed packets greater then the summed value. e.g. you must hit ten or more of >300ms delayed packets OR hit seven or more of >300ms delayed packets + >90ms delayed packets OR hit two or more of >300ms delayed packets + >90ms delayed packets + >50ms delayed packets",delaySum:"PDV sum",delaySumHelp:"Summary of delayed packets.",delayAvg:"PDV avg",delayAvgHelp:"Average of delayed packets.",jitterMax:"Jitter max",jitterMaxHelp:"Maximal jitter.",jitterAvg:"Jitter avg",jitterAvgHelp:"Average jitter.",loss:"Loss",lossHelp:"Search by number of loss packets. Fields 1-10 represents number of packets which were lost in a row. For example if you put in field 5 number 1 it will find all calls with at least 5 packet loss in a row.",loss_strict:"strict",loss_strictHelp:"ON is searching for exact match, all conditions must be satisfied in all loss fields. e.g. value 2 in field 1 and value 7 in field 5 and value 10 in field 9 mean that the call must hit one lost packet in a row twice or more AND five lost packets in a row seventimes or more AND nine lost packets in a row tentimes or more. OFF is searching for any loss greater then the summed value. e.g. you must hit one lost packet in a row twice or more OR hit 5* five lost packets in a row + one lost packet in a row >= 7 OR hit 9* nine lost packets in a row + 5* five lost packets in a row + one lost packet in a row >= 10.",RTPport:"RTP port",RTPip_port:"RTP IP/Net, port",SDPip_port:"SDP IP/Net, port",RTPstreamUsedInAnotherCall:"RTP stream used in another call",RTCPj:"RTCP Jitter",RTCPjHelp:"RTCP jitter",RTCPjMax:"max >=",RTCPjAvg:"average >=",RTCPl:"RTCP % loss",RTCPlHelp:"RTCP % loss",RTCPlMax:"max >=",RTCPlAvg:"average >=",RTCPrtd:"RTCP rtd (latency)",RTCPrtdHelp:"Max RTCP Roundtrip delay aka latency [ms]",RTCPrtdMax:"max >=",RTCPrtdAvg:"average >=",a_lastRtpFromEnd:"Last RTP from last SIP (Caller)",a_lastRtpFromEndHelp:"Seconds between last RTP and last SIP packet.",b_lastRtpFromEnd:"Last RTP from last SIP (Called)",b_lastRtpFromEndHelp:"Seconds between last RTP and last SIP packet.",sipcallerdip_with_proxy:"include proxy",sipcallerdip_with_proxyHelp:"Include searching in rtp_proxy table - warning - due to extra MySQL SUBSELECT searching will slow down filtering.",frLostPkts:"RTCP Fraction Lost Pkts",frLostPktsHelp:"Number of packets with non-zero fraction lost.",mosMin:"MOS(min) from avgs",mosMinHelp:"",mosF1Min:"MOS f1 (min)",mosF1MinHelp:"MOS f1 50ms jitterbuffer (min)",mosF2Min:"MOS f2 (min)",mosF2MinHelp:"MOS f2 200ms jitterbuffer (min)",mosAdaptMin:"MOS Adapt (min)",mosAdaptMinHelp:"MOS Adapt up to 500ms jitterbuffer (min)",mosXrAvg:"MOS XR (avg)",mosXrAvgHelp:"",mosXrMin:"MOS XR (min)",mosXrMinHelp:"",mosSilenceAvg:"MOS Silence (avg)",mosSilenceAvgHelp:"",mosSilenceMin:"MOS Silence (min)",mosSilenceMinHelp:"",packetLossPerc:"Packet loss [%]",packetLossPercHelp:"",silence:"Silence [%]",silenceHelp:"Search for calls where there was specified % of silence audio frames. The silence detection must be enabled in the sniffer configuration silencedetect = yes",silenceEnd:"Last Silence [s]",silenceEndHelp:"Search for calls where there was silence at the end of calls for specified seconds. This is usefull when you want to search calls where audio was cut (silence) - the silence is meant by silence in audio and not missing RTP frames. This feature must be enabled in the sniffer also.",clipping:"Clipped Frames",clippingHelp:"Number of clipped audio frames (usually one RTP packet is 20ms audio). This can happen when one side speeks too loud for example or on broken devices / transcoders etc. This feature must be enabled in the sniffer also.",rtp_streams_ge:"RTP streams >=",rtp_streams_geHelp:"",rtp_stream_packets_ge:"Max packets in RTP stream >=",rtp_stream_packets_geHelp:"",rtp_stream_packets_le:"Min packets in RTP stream <=",rtp_stream_packets_leHelp:"",dscp_caller_sip:"Caller SIP",dscp_caller_sipHelp:"",dscp_called_sip:"Called SIP",dscp_called_sipHelp:"",dscp_caller_rtp:"Caller RTP",dscp_caller_rtpHelp:"",dscp_called_rtp:"Called RTP",dscp_called_rtpHelp:"",ip_port_label:"IP, port",ip_net_port_label:"IP/Net, port",ip_port_title_new:"new IP, port",ip_port_title_edit:"edit IP, port",ip_net_port_title_new:"new IP/Net, port",ip_net_port_title_edit:"edit IP/Net, port",eq:"eq (==)",not_eq:"not eq (<>)",chart_filter:"chart filter",chart_filterHelp:"For filtering according to a special field used for chart."},field_filter_help:{callerd:"Searching for all numbers starting with 1: 1%, searching for numbers 100 - 199 (exact 3 digits starting with 1): 1__, Searching for all numbers which ends 123: %123, searching for number 123 or number 456: 123 456, [123 456] will search for exact number with space, searching for all numbers starting with 1 except number 112: 1% !112, searching for numbers starting with 1 or 2 except 112 and 212: 1 2 !112 !212., searching for regexp 12[34].*: R(12[34].*)",callerd_domain:null,sipcallerdip:"Searching for more ip addresses (OR): 192.168.0.1 10.0.0.0/16, searching for subnet except one IP: 10.0.0.0/16 !10.0.0.1, searching for more subnets except another subnet: 10.0.0.0/16 192.168.0.0/16 !10.0.20.0/24 !192.168.10.0/24. If not proper IP or Net then DNS resolve is tried."},button:{quickFilter:"quick filter",filterForm:"filter form",resetFilter:"reset filter",menu:"Menu",charts:"Charts",search:"Search",ok:"OK",close:"Close",undock:"undock",dock:"dock",closeChart:"close",addChart:"add chart",wiresharkFilter:"wireshark filter",typePackets:"type",downloadPCAP:"download PCAP",applyFilterToParentTable:"apply filter to parrent table",filteredCdr:"filtered cdr",showMosXR:"show MOS XR",showMosSilence:"show MOS Silence",showMosLqo:"show MOS LQO",openPieChart:"open pie chart",save:"save",cancel:"cancel",saveTemplate:"save template",editTemplate:"edit template",deleteTemplate:"delete template",refreshInterval:"refresh interval",setttings:"",prepareSvgDiagram:"generate network MAP",exportSipHistory:"SIP export",shareShowCdr:"Share",restoreToCurrentSelection:"restore to current selection",selectFile:"Select File..."},button_help:{quickFilter:"Select common filters from menu",filterForm:"Show search form",viewUrl:"Show current view & filter URL",resetFilter:"Reset filter to default and reload data",charts:"Open charts panel",settings:"settings",advancedStatistics:"advanced statistics"},menu:{cdrBaseFilters:"cdr base filters",cdrOrder:"cdr order",cdrColumnsFilter:"cdr columns filter",groupFilters:"group filters",groupSelect:"group select",groupCdrErrorData:"group cdr error data",all:"all","delete":"delete",orderCurrentData:"Order current data",last24hours:"Last 24 hours",last7days:"Last 7 days",last30days:"Last 30 days",lastYear:"Last year",allTime:"All time",allFiltered:"All filtered",selected:"Selected",deleteCDR:"Delete CDR",deleteCDRandFiles:"Delete CDR and files",deleteFiles:"Delete files",exportCSV:"Export CSV",exportCSV_table:"Table content",exportCSV_summary_by_caller:"Summary by source number",exportCSV_summary_by_called:"Summary by destination number",selectionCDR:"Selection CDR",selectionCDR_clear:"clear current selection",selectionCDR_save:"save to named selection",selectionCDR_manage:"manage saved selections",filterByCDR:"Filter by this CDR",bySourceSipIP:"By source SIP IP",bySourceRtpIP:"By source RTP IP",byDstSipIP:"By destination SIP IP",byDstRtpIP:"By destination RTP IP",byCaller:"By caller number",byCalled:"By called number",byLastResponse:"By SIP response code",orderByWorstLoss:"Order by Loss",orderByWorstDelay:"Order by PDV",orderByWorstMOS:"Order by MOS",orderByFixed1:"Fixed 50 ms",orderByFixed2:"Fixed 200 ms",orderByAdaptive:"Adaptive 500 ms",orderByCallDuration:"Order by Call Duration",orderBySIP_IP:"Order by SIP IP",orderBySrcSIP_IP:"Order by source SIP IP",orderByDstSIP_IP:"Order by destination SIP IP",orderByNumber:"Order by Number",orderBySrcNumber:"Order by source Number",orderByDstNumber:"Order by destination Number",orderByCallerName:"Order by Caller Name",orderByLastSIPrespNum:"Order by SIP Response Num",orderAsc:"ascending",orderDesc:"descending",filterSimilarCDR:"Filter similar CDR",newIssueTicket:"New issue ticket",revaluationBilling:"Revaluation Billing",shareCdr:"Share CDR",shareSipRtp:"Share SIP + RTP",shareSip:"Share SIP only",shareSipHistory:"Share SIP history",showLink:"Show link",sendLinkViaEmail:"Send link via e-mail",localPublic:"local public",localPrivate:"local private",share_voipmonitor_org:appShareUrl,downloadPcap:"download PCAP",downloadSipPcap:"SIP PCAP",downloadSipRtpPcap:"SIP+RTP PCAP",tryDecodeFax:"try decode fax",tryDecodeFaxAsT30:"decode as T30",tryDecodeFaxAsT38:"decode as T38",showRtcpChart:"show RTCP chart",merge:"Merge",mergeSipPcap:"SIP PCAP",mergeSipRtpPcap:"SIP+RTP PCAP",mergeSipHistory:"SIP HISTORY",batchDownloadCdr:"download from all CDR",viewUrl:"current view & filter URL",enableDns:"Enable DNS IP lookup",enableFlags:"Enable flags",number:"number",ip:"IP",left:"left",right:"right",disable:"disable",exportSipHistoryTxtPkt:"Packets in text form",exportSipHistoryDiagramView:"Diagram",rtpStream:"RTP stream",flowChart:"RTP loss/jitter chart (.graph)",rtpStreamAnalysis:"RTP stream analysis",concurrentCallsStats:"Concurrent calls stats"},tbar:{dateTimeRange:"date, time range",dateTimeFrom:"date, time from",dateTimeTo:"date, time to",menu:"menu",filter:"filter",paginator:"paginator",conditionCallerCalled:"condition between caller / called"},title:{CDR:"CDR",groups:"Groups",groupBy:"Group by",shareCdr:"Share CDR",shareCdrSendLinkViaEmail:"Send link via e-mail",viewUrl:"URL for current filter",charts:"Charts",searchForm:"Search form",commonTab:"common",RTPtab:"RTP",DSCPtab:"DSCP",filtersCombTab:"combination",summaryTab:"summary",packetDetail:"Packet detail",messagesTab:"messages",diagramTab:"diagram",chartsTab:"charts",sipHistory:"SIP: history",sipHistoryTab:"SIP: history",sipHistory_merge:"SIP: history (merge)",legsByCIDtab:"Legs by CID",legsByHeaderTab:"Legs by header",noteTab:"note",pieChart:"pie chart",groupDefinition:"group definition",cdrFilters:"cdr filters",cdrErrorIf:"cdr error if",saveTemplate:"save template",editTemplate:"edit template",saveSelection:"save selection",msgZeroCdrForTicket:"Not selected cdr records",msgTooMuchCdrForTicket:"Too much selected cdr records",msgTooooMuchCdrForTicket:"Toooo much selected cdr records",msgZeroCdrForMerge:"Not selected cdr records",msgTooMuchCdrForMerge:"Too much selected cdr records",msgDuplicationName:"duplication name",msgDeleteFilter:"delete filter config",bodyTab:"body",bodyInRawTab:"raw",bodyInXmlTab:"xml",httpHeaderTab:"header",rtcpChart:"RTCP chart",rtcpChartTabChart:"RTCP",advancedStatistics:"Advanced statistics",faxContent:"FAX",faxCreateLog:"log",settingChartsTab:"setting charts",networkMapTab:"network map",manageSavedSelections:"manage saved selections"},text:{msgZeroCdrForTicket:"Select cdr records before ticket create!",msgTooMuchCdrForTicket1:"You selected",msgTooMuchCdrForTicket2:"cdr records. Continue?",msgTooooMuchCdrForTicket1:"You selected",msgTooooMuchCdrForTicket2:"cdr records. Maximum is 1000.",msgZeroCdrForMerge:"Select cdr records before merge!",msgTooMuchCdrForMerge1:"You selected",msgTooMuchCdrForMerge2:"cdr records. Continue?",msgDuplicationName:"Name is used. Overwrite?",msgDeleteFilter:"delete current template?",kernelPacketLoss:"The sniffer detected packet loss between the linux kernel and sniffer application which means that this CDR can have missing SIP packets or RTP packets and loss statistics is not accurate. The reason of this packet loss is mostly caused by I/O disk overload which blocks processing threads from reading packets from kernel ring buffer.<br>The solution is to increase ringbuffer in sniffer configuration and packetbuffer. If this will not help check the I/O performance and consult manual section &quot;scaling&quot; or contact your support.",kernelPacketLoss_short:"packet loss",byeText_2:"Call has missing confirmation to the BYE request (200 OK - ACK).",byeText_102:"Call was terminated by the sniffer due to absolute_timeout parametr in the sniffer which is by default 4 hours (14400 seconds) or the call was never terminated i.e. lost BYE. If your calls are longer than 4 hours you have to make this value longer.",byeText_103:"Call was forcibly terminated by the BYE 20 minutes timer. This timer is initiated with first BYE message and is 20 minutes long. Cals with this status sent BYE but there were still communication ongoing at least for 20 minutes and call has also no confirmation to the BYE request",byeText_104:"Call was terminated by the sniffer due to RTP timeout - both caller and called RTP streams were cut in the middle of call. The parameter is rtptimeout and is 300 seconds by default.",byeText_105:"Call was terminated by the sniffer because SIP signalization is seen only in one direction and there is no reply to any of SIP request from INVITE initiator within the default sniffer parametr onewaytimeout which is 15 seconds.",byeText_101:"signalization is only in one direction without any replies",byeText_106:"BYE without RES2XX and RES18X",byeText_107:"zombie",byeText_108:"sip without rtp",byeText_100:"The sniffer detected packet loss between the linux kernel and sniffer application which means that this CDR can have missing SIP packets or RTP packets and loss statistics is not accurate. The reason of this packet loss is mostly caused by I/O disk overload which blocks processing threads from reading packets from kernel ring buffer.",byeText_110:"Call was forcibly closed during the closing snifer.",byeTextShort_2:"missing BYE confirmation",byeTextShort_102:"absolute timeout",byeTextShort_103:"BYE timeout",byeTextShort_104:"RTP timeout",byeTextShort_105:"one way timeout",byeTextShort_101:"one way signalization",byeTextShort_106:"early BYE",byeTextShort_107:"zombie",byeTextShort_108:"sip without rtp",byeTextShort_100:"packet loss",byeTextShort_110:"closed during closing snifer",rtpStreamUsedInAnotherCall:"RTP stream used in another call",longSIPpacket:"long SIP packet (greather than 1500B)",unconfirmedBye:"unconfirmed BYE",aloneUnconfirmedBye:"alone unconfirmed BYE",unconfirmedBye_help:"",aloneUnconfirmedBye_help:"",ipFragmentedNo:"no fragmented",ipFragmentedSip:"in SIP",ipFragmentedRtp:"in RTP",ipFragmentedSipOrRtp:"in SIP or RTP",srtpWithoutKey:"sdp data contains the srtp protocol but does not contain the key; some rtp streams probably will not convert to audio",srtpWithoutKey_help:"",fasDetected:"FAS detected",fasDetected_short:"FAS",fasDetected_help:"",zerossrcDetected:"zero SSRC detected",zerossrcDetected_short:"0SSRC",zerossrcDetected_help:"",unknowSensorId:"Sensor ID is not defined in the sensors table. Please add him there.",sharingIsNotPermitted:"sharing is not permitted",dataAreNotYetWrittenToDisk:"Data not yet written to disk. Try reload again later.",selectedCdrDoesNotContainRtcpData:"Selected cdr does not contain rtcp data.",questionTryDecodeAsT30:"Try decode as T30?",deleteCdr:"Delete CDR - please wait...",sdpMediaType_audio:"audio",sdpMediaType_image:"image",sdpMediaType_video:"video",rtpState_missing:"no RTP streams",rtpState_exists:"1 or 2 RTP streams",rtpState_one_way:"only 1 stream",rtpState_two_way:"have 2 streams",changeSrcRtpPort_none:"none",changeSrcRtpPort_caller:"caller",changeSrcRtpPort_called:"called",changeSrcRtpPort_caller_or_called:"caller or called",changeSrcRtpPort_caller_and_called:"caller and called",televentRequestResponse_request_with_response:"request with response",televentRequestResponse_request_without_response:"request without response",televentRequestResponse_no_request:"no request",missingReasonColumns:"Your database schema has to be upgraded to support this feature. Altering cdr table can take hours and will prevent sniffers to insert new data until the alter is done so run it after working hours. In mysql "+applName+' database run this alter command (we recommend to run "screen" before you connect to database) and after the alter will finish logout/login to the GUI: "ALTER TABLE cdr ADD COLUMN reason_sip_cause smallint unsigned DEFAULT NULL, ADD COLUMN reason_sip_text_id mediumint unsigned DEFAULT NULL, ADD COLUMN reason_q850_cause smallint unsigned DEFAULT NULL, ADD COLUMN reason_q850_text_id mediumint unsigned DEFAULT NULL, ADD KEY reason_sip_text_id (reason_sip_text_id), ADD KEY reason_q850_text_id (reason_q850_text_id);"',missingSilenceColumns:"Your database schema has to be upgraded to support this feature. Altering cdr table can take hours and will prevent sniffers to insert new data until the alter is done so run it after working hours. In mysql "+applName+' database run this alter command (we recommend to run "screen" before you connect to database) and after the alter will finish logout/login to the GUI: "ALTER TABLE cdr ADD caller_silence tinyint unsigned default NULL, ADD called_silence tinyint unsigned default NULL, ADD caller_silence_end smallint default NULL, ADD called_silence_end smallint default NULL;"',missingClippingColumns:"Your database schema has to be upgraded to support this feature. Altering cdr table can take hours and will prevent sniffers to insert new data until the alter is done so run it after working hours. In mysql "+applName+' database run this alter command (we recommend to run "screen" before you connect to database) and after the alter will finish logout/login to the GUI: "ALTER TABLE cdr ADD caller_clipping_div3 smallint unsigned default NULL, ADD called_clipping_div3 smallint unsigned default NULL;"',missingFracLostPktCColumns:"Your database schema has to be upgraded to support this feature. Altering cdr table can take hours and will prevent sniffers to insert new data until the alter is done so run it after working hours. In mysql "+applName+' database run this alter command (we recommend to run "screen" before you connect to database) and after the alter will finish logout/login to the GUI: "ALTER TABLE cdr ADD COLUMN a_rtcp_fraclost_pktcount int unsigned default NULL, ADD COLUMN b_rtcp_fraclost_pktcount int unsigned default NULL;"',thereIsNoNodeInNetworkMap:"There is no node in network map with sip/rtp IP address of this CDR.",currentSelectionIsEmpty:"Current selection is empty.",dataTimeIgnoredInCombinationTemplates:"date / time range is taken from common tab only - date / time range in templates are ignored",groupBy:"group by",typeChart:"type chart",maxGraphs:"max graphs",attachedFile:"attached file",lastModifiedBy:"last modified by",noteTableIsOpen:"the note table is open",graphIsNotAvailable:"Graph is not available",chartIsNotAvailable:"Chart is not available",rtpStream:"RTP stream"},filtersCombination:{custom_filter:"custom filter",tooltip_edit_custom_filter:"edit custom filter",missing_filter_or_template:"missing filter or template",col_delete_order:"delete / order",col_logic_level:"AND / OR level",col_not:"not",col_filter_template:"filter / template",col_id:"id",btn_add:"add",field_description:"description",title_custom_filter:"custom filter",tooltip_delete:"delete",tooltip_move_up:"move up",tooltip_move_down:"move down",tooltip_logic_level_up:"increase AND / OR level",tooltip_logic_level_down:"decrease AND / OR level",error_filters_table_is_empty:"filters table is empty",error_missing_filter_or_template_in_any_row:"filter / template is empty in ids:",template_prefix:"template:"},tooltip:{selectOnlyThisRow:"select only this row",showSipHistory:"show SIP history",addNote:"add note",editNote:"edit note",xPDV:"median of jitter >50ms regradless on lenght of a call",maxRtd:"Max RTCP Roundtrip delay aka latency in miliseconds. See Rfc 3550#section-6.4.1",avgRtd:"Avg RTCP Roundtrip delay aka latency in miliseconds. See Rfc 3550#section-6.4.1",rtpStreamAnalysis:"RTP stream analysis"},limitCdrForBatchDownloadIs:"Limit cdr records for batch download is",limitCdrForBatchDownloadSolution:"Use form filter or right click on column caller or called.",grid:{subject_note:"note"}},group_stat:{menu:{sip_src_ip:"SIP source IP",sip_dst_ip:"SIP destination IP",rtp_src_ip:"RTP source IP",rtp_dst_ip:"RTP destination IP",src_phone_num:"source phone number",dst_phone_num:"destination phone number",caller:"source phone number",called:"destination phone number",a_ua:"source user agent",b_ua:"destination user agent",country_by_caller:"country by source phone number",country_by_called:"country by destination phone number",country_by_sipcallerip:"country by SIP source IP",country_by_sipcalledip:"country by SIP destination IP"},title:{distribution:"distribution",callQuality:"call quality",topCalls:"top calls",topCalls_msg:"top messages",topCallDistribution:"top call distribution",topCallDistribution_msg:"top messages distribution",charts:"charts",rtp_stat:"RTP stat",callDistribution:"call distribution",callDistribution_msg:"messages distribution",packetLossDistribution:"packet loss distribution",mosDistribution:"mos distribution",jitterDistribution:"jitter distribution",pdvDistribution:"PDV distribution",cdr:"CDR"},chart:{callDistribution:"call distribution",callDistribution_msg:"messages distribution",callDistribution_run:"ongoing",callDistribution_begin:"begin",callDistribution_end:"end"},text:{groupBy:"group by",typeChart:"type chart",maxGraphs:"max graphs"}},messages:{column:{ID_sensor:'ID<br><span style="font-size: 80%;">sensor id</span>',ID_sensor_name:'ID<br><span style="font-size: 80%;">sensor id</span>',calldate2:"Datetime",caller2:"Caller num/name<br>SIP source IP<br>SIP agent",called2:"Called num<br>SIP destination IP<br>SIP agent",lastresponse:"Last response",message:"Message",menu:"Commands",time_s:"time [s]",srcip:"Source IP",dstip:"Destination IP",sipMsg:"SIP message",groupLastSIPresponse:"SIP Response",groupSipIP_hostName:"sip IP / host name",groupIP_group:"IP Group",groupCountry:"country",cnt_all:"total Messages",cnt_perc:"%",proxy:"Proxy"},field:{searchCallerCalled:"Caller/Called",groupBy:"group by",shareMessage_mailSubject:"Share Message",shareMessage_mailMessage:"Share Message links:\n\n",shareMessage_mailSignature:"\n---\n",relatedInterval_s:"related interval [s]"},sortBy:{callerNumber:"caller number",sipSourceIP:"SIP source IP",calledNumber:"called number",sipDestinationIP:"SIP destination IP"},field_filter:{dateRange:"Date range",dateFrom:"From",dateTo:"To",lastDaysMinutes:"Last days",lastDaysMinutesHelp:"",num:"Number",num_start:"Numb.start",num_end:"Numb.end",num_contain:"Numb.contain",num_regexp:"Numb.regexp",numTriggerHelp:"Select search type",countryCodeByNumber:"&nbsp;&nbsp;&nbsp;&nbsp;country",callerName:"Caller name",domain:"Domain",IP:"IP address",countryCodeByIP:"&nbsp;&nbsp;&nbsp;&nbsp;country",proxyIp:"Proxy",sipcallerdip_with_proxy:"include proxy",sipAgent:"SIP agent",message:"Message",sensor:"Sensor",caller:"Caller",called:"Called",callerOrCalled:"Caller or Called",callerGroup:"Caller group",calledGroup:"Called group",callerOrCalledGroup:"Caller or Called group",callID:"Call ID",messageType:"Message type",custhead_group:"Custom header group",operLt:" < ",operGt:" >= "},button:{filterForm:"filter form",resetFilter:"reset filter",search:"Search",close:"Close",undock:"undock",dock:"dock",closeChart:"close",addChart:"add chart",wiresharkFilter:"wireshark filter",typePackets:"type",downloadPCAP:"download PCAP",openPieChart:"open pie chart",refreshInterval:"refresh interval",settings:"",prepareSvgDiagram:"generate network MAP",shareShowCdr:"Share"},button_help:{filterForm:"Show search form",resetFilter:"Reset filter to default and reload data",settings:"settings",viewUrl:"Show current view & filter URL",advancedStatistics:"advanced statistics"},menu:{shareMessages:"Share Messages",shareSipHistory:"Share SIP history",showLink:"Show link",sendLinkViaEmail:"Send link via e-mail",localPublic:"local public",localPrivate:"local private",merge:"Merge",mergeSipPcap:"SIP PCAP",mergeSipRtpPcap:"SIP+RTP PCAP",mergeSipHistory:"SIP HISTORY",showHttpJjViaExternalTransactionId:"show http via external transaction id",enableDns:"Enable DNS IP lookup",exportCSV:"Export CSV",enableFlags:"Enable flags",number:"number",ip:"IP",left:"left",right:"right",disable:"disable"},tbar:{dateTimeRange:"date, time range",dateTimeFrom:"date, time from",dateTimeTo:"date, time to",menu:"menu",filter:"filter",paginator:"paginator"},title:{SipMessages:"SIP MESSAGES",groups:"Groups",groupBy:"Group by",charts:"Charts",searchForm:"Search form",viewUrl:"URL for current filter",summaryTab:"summary",messagesTab:"messages",diagramTab:"diagram",sipHistory:"SIP: history",sipHistoryTab:"SIP: history",sipHistory_merge:"SIP: history (merge)",packetDetail:"Packet detail",messageTreeTab:"message tree",pieChart:"pie chart",groupDefinition:"group definition",messageFilters:"message filters",shareMessage:"Share Message",shareMessageSendLinkViaEmail:"Send link via e-mail",legsByHeaderTab:"Legs by header",msgZeroMessagesForMerge:"Not selected records",msgTooMuchMessagesForMerge:"Too much selected records",advancedStatistics:"Advanced statistics"},text:{msgZeroMessagesForMerge:"Select records before merge!",msgTooMuchMessagesForMerge1:"You selected",msgTooMuchMessagesForMerge2:"records. Continue?",sharingIsNotPermitted:"sharing is not permitted",dataAreNotYetWrittenToDisk:"Data not yet written to disk. Try reload again later."},tooltip:{showSipHistory:"show SIP history"}},register:{column:{calldate:"Datetime",created_at:"Datetime",sipcallerip:"Source IP",sipcalledip:"Destination IP",src_mac:"Source MAC",from_num:"From Number",to_num:"To Number",from_num_domain:'From <span style="font-size:80%;color:grey;">number (name) / domain</span>',to_num_domain:'To <span style="font-size:80%;color:grey;">number / domain</span>',contact_num_domain:'Contact <span style="font-size:80%;color:grey;">number / domain</span>',digestusername:"User name",digestusername_realm:"User name / Realm",expires:"Expires",expires_at:"Expires / at",rrd_avg:"RRD avg",state:"State",ua_str:"User agent",commands:"Commands",counter:"counter"},field:{ip_address:"IP address",net_mask:"Network mask",number_prefix:"Phone number prefix",auto_remove_at:"Auto remove at",reload_sniffer:"Reload sniffer"},field_filter:{calldate:"Call time",created_at:"Created at",counter:"Counter",ip_address:"IP address",caller_ip:"Caller IP",called_ip:"Called IP",caller_or_called_ip:"Caller or Called IP",number:"Number",name_from:"Name from",domain:"Domain",domain_contact:"Domain contact",username:"User name",realm:"Realm",rrd_avg:"RRD avg",expires:"Expires",expires_at:"Expires at",state:"State",ua:"User agent",sensor:"Sensor",from:"From",to:"To",contact:"Contact",from_to_contact:"From or To or Contact",group:"group",detectSIPALG:"SIP-ALG",cmp_oper_ge:" >= ",cmp_oper_lt:" < "},field_filter_help:{},button:{filterForm:"Filter Form",resetFilter:"Reset filter",search:"Search",close:"Close"},button_help:{filterForm:"Show search form",filterFormViewUrl:"Show current view & filter URL",resetFilter:"Reset filter to default and reload data"},menu:{exportCSV:"Export CSV",addToCaptureRules:"add to capture rules",removeFromCaptureRules:"remove from capture rules",filterByNumber:"number",filterByIP:"IP address",filterByNumberAndIP:"number and IP address",filterByNumberOrIP:"number or IP address"},toolbar:{from:"from",to:"to",userName:"user name",refreshInterval:"refresh interval",filterBy:"filter by"},tooltip:{tools:"tools"},title:{filterForm:"Filter form",filterFormViewUrl:"URL for current filter",newCaptureRule:"New capture rule",removeCaptureRule:"Remove capture rule",state:"state",stateFilteredBy:"state filtered by",relatedCDR:"related CDR",failed:"failed",noData:"no data",registerActive:"Register - Active",registerState:"Register - State",registerFailed:"Register - Failed"},text:{removeCaptureRuleQuestion:"Remove capture rule:",noDataInExpandArea:"Expand area does not contain data"}},sip_msg:{column:{ID_sensor:'ID<br><span style="font-size: 80%;">sensor id</span>',ID_sensor_name:'ID<br><span style="font-size: 80%;">sensor id</span>',datetime:"Datetime",ip_port_src:'<table border="0" cellspacing="0" cellpadding="0" style="font-size: inherit; border-spacing: 0; border-collapse: collapse;"><tr><td>IP<br>port<td style="padding-left: 5px;">src</table>',ip_port_dst:'<table border="0" cellspacing="0" cellpadding="0" style="font-size: inherit; border-spacing: 0; border-collapse: collapse;"><tr><td>IP<br>port<td style="padding-left: 5px;">dst</table>',number_domain_src:'<table border="0" cellspacing="0" cellpadding="0" style="font-size: inherit; border-spacing: 0; border-collapse: collapse;"><tr><td>Number<br>Domain<td style="padding-left: 5px;">src</table>',number_domain_dst:'<table border="0" cellspacing="0" cellpadding="0" style="font-size: inherit; border-spacing: 0; border-collapse: collapse;"><tr><td>Number<br>Domain<td style="padding-left: 5px;">dest</table>',ua_src:"User Agent src",ua_dst:"User Agent dest",response_time:"Response Time",response_duration_ms:"Response duration",response_type:"Response Type",menu:"Commands"},field:{name:"name",type:"type",options:"options",subscribe:"subscribe",notify:"notify",conditions:"conditions",descr:"description",ok_qualify_limit:"qualify limit [ms]",ok_responses:"ok responses",ip_src:"IP src",ip_dst:"IP dest",number_src:"Number src",number_dst:"Number dest",domain_src:"Domain src",domain_dst:"Domain dest"},sortBy:{ip_src:"IP src",ip_dst:"IP dst",port_src:"port src",port_dst:"port dst",number_src:"number src",number_dst:"number dst",domain_src:"domain src",domain_dst:"domain dst"},field_filter:{time:"Time",timeFrom:"from",timeTo:"to",ip_address:"IP address",ip_src:"src",ip_dst:"dest",ip_src_group_id:"src group",ip_dst_group_id:"dest group",port:"Port",port_src:"src",port_dst:"dest",number:"Number",number_src:"src",number_dst:"dest",domain:"Domain",number_src:"src",number_dst:"dest",ua:"user agent",ua_src:"src",ua_dst:"dest",src_or_dst:"src or dest",src:"src",src_or_dst_group:"src or dest group",src_group:"src group",qualify_state:"Qualify state",qualify_ok:"ok",qualify_bad:"bad",response_duration:"Response duration [ms]",response_number:"Response number",callername:"Callername",callID:"CallID",cseq:"Cseq",requestContentType:"Request Content type",requestContent:"Request Content",responseContentType:"Response Content type",responseContent:"Response Content",sensor:"Sensor",cmp_oper_ge:" >= ",cmp_oper_lt:" < "},field_filter_help:{},button:{filterForm:"Filter Form",resetFilter:"Reset filter",search:"Search",close:"Close"},button_help:{filterForm:"Show search form",filterFormViewUrl:"Show current view & filter URL",resetFilter:"Reset filter to default and reload data"},menu:{exportCSV:"Export CSV"},toolbar:{refreshInterval:"refresh interval",interval:"interval"},title:{filterForm:"Filter form",filterFormViewUrl:"URL for current filter",sip_msg_active:"Options / Subscribe / Notify - active",sip_msg_stored:"Options / Subscribe / Notify - stored",settings:"Settings",history:"History",stored:"Stored",settingsTable:"table",settingsDefaults:"defaults",summaryTab:"summary",requestTreeTab:"request xml tree",responseTreeTab:"response xml tree"}},ss7:{column:{ID_sensor:'ID<br><span style="font-size: 80%;">sensor id</span>',ID_sensor_name:'ID<br><span style="font-size: 80%;">sensor id</span>',time_iam:"Datetime",duration:'Duration&nbsp;<span style="font-size: 9">(PDD)</span><br>Connect duration',cic:"CIC",caller_number:"Caller",called_number:"Called",state:"State",menu:"Commands",time_s:"time [s]",direction:"direction",ss7Msg:"SS7 message"},field:{searchCallerCalled:"Caller/Called"},sortBy:{duration:"duration",progress_time:"progress time",connect_duration:"connect duration",caller_number:"caller number",opc:"OPC",called_number:"called number",dpc:"DPC"},field_filter:{timeRange:"Time range",timeFrom:"From",timeTo:"To",lastDaysMinutes:"Last days",lastDaysMinutesHelp:"",num:"Number",num_start:"Numb.start",num_end:"Numb.end",num_contain:"Numb.contain",num_regexp:"Numb.regexp",numTriggerHelp:"Select search type",countryCodeByNumber:"&nbsp;&nbsp;&nbsp;&nbsp;country",cic:"CIC",opc:"OPC",dpc:"DPC",duration:"Call duration [s]",connect_duration:"Connect duration [s]",progress_time:"Progress time [s]",sensor:"Sensor",caller:"Caller",called:"Called",callerOrCalled:"Caller or Called",callerGroup:"Caller group",calledGroup:"Called group",callerOrCalledGroup:"Caller or Called group",operLt:" < ",operGt:" >= "},button:{filterForm:"filter form",resetFilter:"reset filter",search:"Search",close:"Close",addChart:"add chart",refreshInterval:"refresh interval"},button_help:{filterForm:"Show search form",resetFilter:"Reset filter to default and reload data",viewUrl:"Show current view & filter URL"},menu:{enableDns:"Enable DNS IP lookup",exportCSV:"Export CSV",enableFlags:"Enable flags",number:"number",ip:"IP",left:"left",right:"right",disable:"disable"},tbar:{dateTimeRange:"date, time range",dateTimeFrom:"date, time from",dateTimeTo:"date, time to",menu:"menu",filter:"filter",paginator:"paginator"},title:{SS7:"SS7",searchForm:"Search form",viewUrl:"URL for current filter",summaryTab:"summary",historyTab:"SS7: history",packetDetail:"Packet detail"}},charts:{column:{interval_limit:"limit",interval_last:"last interval",color:"color",descr:"description"},field:{from:"from",to:"to",time_offset_name_title:"Name / title",time_offset_hours:"Hours",time_offset_days:"Days",time_offset_months:"Months",interval_limit:"Limit",interval_last:"Last interval",color:"Color",templates:"templates",timeAxis:"time axis",timeInterval:"time interval",intervalOffset:"interval offset",theme:"theme",title:"title",axisTitleLeft:"left axis title",axisTitleRight:"right axis title",minAxisWidth:"min. legend width",legendPosition:"legend position",limitLineValue:"mark line value",limitLineColor:"color",percTrend:"percent.line trend",perc95_Color:"perc.95",perc99_Color:"perc.99",chartName:"chart name",combinationToArea:"combine to stacked area / columns",maximumAreaItems:"maximum area items",seriesTitle:"series title"},column:{series:"series",param:"param",sideAxis:"axis side",primaryAxis:"primary",baseType:"type",lineType:"line",color:"color",trend:"trend",fill:"fill",markers:"markers",smooth:"smooth",percent:"percent",filters:"filters",tools:"tools"},combodata:{left:"left",right:"right",line:"line",column:"column",column_line:"auto",area:"area",trend:"trend",solid:"solid",dashed:"dashed",dotted:"doted",asc:"asc",desc:"desc"},grid:{subject_interval:" "},text:{interval_last:"last interval",msgInvalidQuery:"Invalid query or data",msgInvalidQueryDescr:"There is no CDR in your query",msgInvalidQueryDescr_messages:"There is no Message in your query",msgInvalidQueryDescr_sip_msg:"There is no opt.,subsc.,notify in your query",msgInvalidQueryDescr_records:"There is no record in your query",msgInvalidNewQuery:"Invalid new query",msgInvalidNewQueryDescr:"There are no CDRs for your query. Using previouse query.",msgInvalidNewQueryDescr_messages:"There are no Messages for your query. Using previouse query.",msgInvalidNewQueryDescr_sip_msg:"There are no opt.,subsc.,notify for your query. Using previouse query.",msgInvalidNewQueryDescr_records:"There are no records for your query. Using previouse query.",msgPhpCalcWarningMsgHeader:"PHP calc warning",msgPhpCalcWarningMsgText:"Used PHP calc. Check your installation!",emptyIntervalMsgHeader:"empty interval",emptyIntervalMsgText:"Not exists any begin call in select interval. Try another interval.",msgDuplicationNameTitle:"duplication name",msgDuplicationNameText:"Name is used. Overwrite?",msgDeleteChartConfirmTitle:"delete chart config",msgDeleteChartConfirmText:"delete current template?",errorMissingSeries:"Incomplete configuration. Missing series!",errorMultipleArea:"Bad configuration. Select only one 'area' series!",autoSet:"auto"},button:{undock:"undock",apply:"apply",cancel:"cancel",saveTemplate:"save template",deleteTemplate:"delete template",ok:"OK",close:"Close",remove:"Remove"},tooltip:{prev:"prev",next:"next",saveAsSVG:"save as SVG",saveAsPDF:"save as PDF",newTrackerTicket:"new issue ticket",editChart:"edit chart",closeChart:"close chart",undockChart:"undock chart",seriesFilter:"series filter",intervalOffsetHelp:"This option shifts the end of the timeline from now() to now() - X minutes. This is useful when you do not want to see downward trend due to the fact that there are still ongoing calls which is not yet in the chart.",seriesTools:"series tools"},fieldset:{dateRange:"date range",series:"series",description:"description"},title:{charts:"Charts",date_range:"date range",time_offset:"time offset",intervals:"intervals",colors:"colors",chartConfiguration:"chart configuration",baseChartData:"base chart data",filters:"filters",filtersCommon:"filters - common",filtersRtp:"filters - RTP",filtersDscp:"filters - DSCP",filtersComb:"filters - combination",filterCommon:"common",filterRTP:"RTP",filterDSCP:"DSCP",filterFiltersComb:"combination",saveChartConfig:"save chart config",seriesFilter:"Series Filter"},menu:{simpleConvert:"simple convert",pageFormat:"page format"}},chart3d:{menu:{rtp_ip:"RTP IP",showChartsMosJitterLoss:"show charts MOS, jitter, packet loss",showCDR:"show CDR",setCDR_filter:"set CDR filter"},button:{previous:"previous",next:"next"}},activecalls:{column:{sensor:"Sensor",time:"Time",duration:"Duration<br>connected",callercodec:"Codec",caller:"Caller number<br>domain",called:"Called number<br>domain",callerip:"Caller IP",calledip:"Called IP",sipproxies:"Proxy",calleragent:"Caller Agent",calledagent:"Called Agent",callername:"Caller Name",lastSIPresponseNum:"Last resp.",menu:"Commands"},field:{nationalOrInternational:"national / international",refreshInterval:"refresh interval",sensor:"sensor",filter:"filter",connected:"connected"},title:{ActiveCalls:"Active Calls",charts:"Charts",calls_per_ip:"Calls per IP",calls_per_ip_stacked:"Calls per IP - stacked",realtime_calls:"Realtime calls",realtime_top_source_ip:"Realtime top source IP",realtime_top_destination_ip:"Realtime top destination IP",recordsByCallerIP:"records by caller ip",recordsByCalledIP:"records by called ip",caller:"caller",called:"called",RealtimeRTP:"Realtime RTP"},text:{noActiveCalls:"no active calls",liveaudioIsDisabled:"Live listening is turned off in sniffer configuration - change liveaudio = yes"}},livepacket:{firstSelectSensor:"First, select a sensor!",warningStartWithoutFilter:"Start the livesniffer without the filter by IP or number can overload the browser.<br><br>Continue?"},http:{column:{id_sensor:'ID<br><span style="font-size: 80%;">sensor id</span>',timestamp:"time",srcip_port:"source ip<br>port",dstip_port:"destination ip<br>port",url:"url",http:"http",body:"body",response_http:"response http",response_body:"response body",callid:"call id",sessid:"sess id",external_transaction_id:"external trans. id"},field_filter:{externalTransactionId:"External transaction id",dateRange:"Date range",from:"From",to:"To",IP:"IP",port:"Port",srcOrDst:"Src or Dst",src:"Src",dst:"Dst",url:"URL",http:"Http",body:"Body",httpResponse:"Http response",bodyResponse:"Body response",callid:"Call id",sessid:"Sess id",external_transaction_id:"External trans. id",sensor:"Sensor"},button:{search:"Search",close:"Close"},menu:{showHttpJjViaExternalTransactionId:"Show HTTP via external transaction id"},tbar:{dateTimeRange:"date, time range",dateTimeFrom:"date, time from",dateTimeTo:"date, time to",menu:"menu",filter:"filter",paginator:"paginator"},title:{http:"HTTP",searchForm:"Search form",showHttpJjViaExternalTransactionId:"Show HTTP via external transaction id"},text:{maximumDateRangeIs168hours:"maximum date range is 168 hours"}},ipaccount:{column:{addr_ip:"address",customer:"customer",protocol:"protocol",port:"port",download:"download",upload:"upload",downloadAll:"D all",uploadAll:"U all",downloadVoip:"D VoIP",uploadVoip:"U VoIP",total:"total",traffic_sum_minute:"last minute",traffic_sum_hour:"last hour",traffic_sum_day:"last day",traffic_sum_week:"last week",traffic_sum_month:"last month",hideEmpty:"hide empty",city:"city",address:"address",connection_type:"connection type"},field:{IP:"IP",IP_network:"IP/network",customer:"customer"},button:{realTimeChart:"realtime chart"},button_help:{prev:"prev",next:"next",saveAsSVG:"save as SVG"},sortBy:{traffic:"traffic",trafficDown:"traffic down",trafficUp:"traffic up",trafficSum:"traffic sum",packets:"packets",packetsDown:"packets down",packetsUp:"packets up",packetsSum:"packets sum"},title:{top10:"TOP 10",customerServices:"customer services",IP:"IP",oppositeDirection:"opposite direction",protocol:"protocol",port:"port",IP_account:"IP account",chartsAll:"charts / all",chartsVoip:"charts / VoIP",chart_traffic:"traffic / line",chart_traffic_area:"traffic / area",chart_packets:"packets / line",chart_packets_area:"packets / area",chart_traffic_top_10_in:"TOP 10 - IN",chart_traffic_top_10_out:"TOP 10 - OUT",chart_realTime:"realtime chart",chart_realTime_all:"ALL",chart_realTime_voip:"VoIP",chart_realTime_all_voip:"ALL & VoIP"},speed:"speed",speedVoip:"speed VoIP",speedIn:"speed in",speedOut:"speed out",speedVoipIn:"speed VoIP in",speedVoipOut:"speed VoIP out"},dashboard_d:{field:{templateName:"name",templateFolder:"folder",privateTemplate:"private",templateNameName:"template name",showForUsers:"restrict for users",showForGroups:"show for groups",title:"title",interval:"interval",lastDaysMinutes:"last days, minutes",floatingInterval:"floating interval",prevInterval:"prev interval",refreshPeriod:"refresh period",intervalOffset:"interval offset",useOnlyCache:"use aggregation/rrd<br>(beta version)",withoutSipResponse200:"without response 200 - OK",bySourceOrDestination:"by source or destination",byCountry_sourceOrDestination:"by country (source or destination)",byCallerOrCalled:"by caller or called",byUA_callerOrCalled:"by UA (caller or called)",byCountry_callerOrCalled:"by country (caller or called)",panelType:"panel type",autoopenSetup:"autoopen setup",seconds:"sec",minutes:"min",sort_by:"sort by",sort_dir:"sort direction",max_rows:"maximum rows",total_perc:"show column '%'",layout:"layout",layoutConfiguration:"layout configuration",typeSensorRRD:"graph",typeChart:"type chart",module:"module",graph:"graph",enable_dns_ip_lookup:"Enable DNS IP lookup",IP:"IP",caller_called_by:"src/dst by",items_scale:"items scale",autocenter:"auto center & zoom",latitude_longitude:"lat/lng",zoom:"zoom",lineColors:"line colors",chartLengthMinutes:"chart length",chartType:"chart type",filters:"filters",onlyConnected:"only connected",internationalOrLocal:"international / local",numbers:"numbers",numbers_group:"numbers group",addresses:"addresses",ip_group:"addresses group",enable_for_all:"enable for all charts",overlap_minutes:"overlap minutes",compute_processes:"number of parallel tasks",temporarily_suspended:"temporary suspend",temporarily_autosuspended_if_sqlf_cdr_gt:"temporary auto-suspend if 'sqlf/cdr' in sniffer log >",name:"name"},field_help:{enable_for_all:"When enabled all charts will use aggregations and you will be not able to turn it off individually. If you have many charts which you are not using often or at all do not enable this and enable the aggregation only for charts you actually use.",overlap_minutes:"How long to look back when calculating data for charts. By default it is 120 minutes and if you have significant number of longer calls than 120 minutes change this to higher values.",compute_processes:"Number of running processes running in parallel. Change this to higher values if your charts are behind current time or if you have enough CPU cores."},field_rtp3d:{interval:"interval [s]",agregation_type:"agregation",number:"#items",scale:"scale",font_size:"font size",font_color:"font color",max_value:"max Z value",times:"X:time",addresses:"Y:hosts",values:"Z:values",curve_font_size:"hover font size",camera_position:"camera position",camera_lookat:"lookat",camera_perspective:"perspective"},help_rtp3d:{interval:"Lowest interval is 10 seconds which is default resolution. For hour interval set 3600 which will aggregate 360 values into one value.",agregation_type:"If aggregation is > 10 seconds choose if you want to see MAX/MIN value (depends on mos/loss) or average value. Note that if you choose average MOS and average aggregation (if interval > 10) it is different than choosing max/min MOS and average aggregation.",number:"X:time is number of values on time X axe (default 20 values). Y:hosts is number of IP addresses on host Y axe (default 15 in dashboard).",scale:"Scale x,y,z chart.",font_size:"Font size in percentage (100% is default)",font_color:"font color",max_value:"Z:value - maximum value on Z axe",times:"X:time is number of values on time X axe",addresses:"Y:hosts is number of IP addresses on host Y axe",values:"Z:value - maximum value on Z axe",curve_font_size:"Font size for numbers which shows when you hover over data",camera_position:"Camera position on 3d space x,y,z axe. Click on reload button to load current camera position",camera_lookat:"Camera direction",camera_perspective:"Field of view"},column:{sipip:"sip IP / host name",rtpip:"rtp IP / host name",phone_numb:"number",ua:"user agent",country:"country",lastSIPresponse:"sip response",cnt_all:"total CDR",cnt_all_cdr:"total CDR",cnt_all_messages:"total Messages",total_perc:"%",duration_all:"âˆ‘ minutes",asr_all:"ASR",ner_all:"NER",acd_all:"ACD",mos_all:"MOS",mos_perc95_all:"MOS %95",mos_perc99_all:"MOS %99",mos_xr_avg_all:"XR avg",mos_xr_avg_perc95_all:"XR avg %95",mos_xr_avg_perc99_all:"XR avg %99",mos_xr_avg_caller_all:"XR avg A",mos_xr_avg_caller_perc95_all:"XR avg A %95",mos_xr_avg_caller_perc99_all:"XR avg A %99",mos_xr_avg_called_all:"XR avg B",mos_xr_avg_called_perc95_all:"XR avg B %95",mos_xr_avg_called_perc99_all:"XR avg B %99",mos_xr_min_all:"XR min",mos_xr_min_perc95_all:"XR min %95",mos_xr_min_perc99_all:"XR min %99",mos_xr_min_caller_all:"XR min A",mos_xr_min_caller_perc95_all:"XR min A %95",mos_xr_min_caller_perc99_all:"XR min A %99",mos_xr_min_called_all:"XR min B",mos_xr_min_called_perc95_all:"XR min B %95",mos_xr_min_called_perc99_all:"XR min B %99",mos_silence_avg_all:"Silence avg",mos_silence_avg_perc95_all:"Silence avg %95",mos_silence_avg_perc99_all:"Silence avg %99",mos_silence_avg_caller_all:"Silence avg A",mos_silence_avg_caller_perc95_all:"Silence avg A %95",mos_silence_avg_caller_perc99_all:"Silence avg A %99",mos_silence_avg_called_all:"Silence avg B",mos_silence_avg_called_perc95_all:"Silence avg B %95",mos_silence_avg_called_perc99_all:"Silence avg B %99",mos_silence_min_all:"Silence min",mos_silence_min_perc95_all:"Silence min %95",mos_silence_min_perc99_all:"Silence min %99",mos_silence_min_caller_all:"Silence min A",mos_silence_min_caller_perc95_all:"Silence min A %95",mos_silence_min_caller_perc99_all:"Silence min A %99",mos_silence_min_called_all:"Silence min B",mos_silence_min_called_perc95_all:"Silence min B %95",mos_silence_min_called_perc99_all:"Silence min B %99",mos_lqo_caller_all:"LQO A",mos_lqo_caller_perc95_all:"LQO A %95",mos_lqo_caller_perc99_all:"LQO A %99",mos_lqo_called_all:"LQO B",mos_lqo_called_perc95_all:"LQO B %95",mos_lqo_called_perc99_all:"LQO B %99",packets_lost_all:"PL",packets_lost_perc95_all:"PL %95",packets_lost_perc99_all:"PL %99",jitter_all:"J",jitter_perc95_all:"J %95",jitter_perc99_all:"J %99",delay_all:"D",delay_perc95_all:"D %95",delay_perc99_all:"D %99",pdd_all:"PDD",pdd_perc95_all:"PDD %95",pdd_perc99_all:"PDD %99",cps_max:"CPS max",cps_avg:"CPS avg",rtcp_maxfr:"RTCP FL max",rtcp_maxfr_perc95_all:"RTCP FL max %95",rtcp_maxfr_perc99_all:"RTCP FL max %99",rtcp_avgfr:"RTCP FL avg",rtcp_avgfr_perc95_all:"RTCP FL avg %95",rtcp_avgfr_perc99_all:"RTCP FL avg %99",rtcp_maxjitter:"RTCP jitter max",rtcp_maxjitter_perc95_all:"RTCP jitter max %95",rtcp_maxjitter_perc99_all:"RTCP jitter max %99",rtcp_avgjitter:"RTCP jitter avg",rtcp_avgjitter_perc95_all:"RTCP jitter avg %95",rtcp_avgjitter_perc99_all:"RTCP jitter avg %99",rtcp_maxrtd:"RTCP Rtd max",rtcp_maxrtd_perc95_all:"RTCP Rtd max %95",rtcp_maxrtd_perc99_all:"RTCP Rtd max %99",rtcp_avgrtd:"RTCP Rtd avg",rtcp_avgrtd_perc95_all:"RTCP Rtd avg %95",rtcp_avgrtd_perc99_all:"RTCP Rtd avg %99",silence_all:"S",silence_perc95_all:"S %95",silence_perc99_all:"S %99",silence_end_all:"LS",silence_end_perc95_all:"LS %95",silence_end_perc99_all:"LS %99",clipping_all:"CF",clipping_perc95_all:"CF %95",clipping_perc99_all:"CF %99",price_customer:"price C",price_operator:"price O",price_difference:"price D",id_sensor:"id",name:"name",version:"version",pbStatString:"status",storingCdrLastSavedAt:"last calldate in SQL",storingCdrLastWriteAt:"last time in queue",pbCountPacketDrop:"#packet drops",uptime:"uptime",host:"host",port:"port",saddr:"IP",counter:"counter",mos_f1_min:"mos f1 min",mos_f1_avg:"mos f1 avg",mos_f2_min:"mos f2 min",mos_f2_avg:"mos f2 avg",mos_ad_min:"mos adapt min",mos_ad_avg:"mos adapt avg",jitter_max:"jitter max",jitter_avg:"jitter avg",loss_max:"loss max",loss_avg:"loss avg",chartSuffix:" - chart"},button:{addPanel:"add panel",setDefaultTemplate:"set default",saveTemplate:"save",editTemplate:"edit",deleteTemplate:"delete",selectTemplate:"dashboard",save:"save",cancel:"cancel",removeAllPanels:"remove all",reloadAll:"reload all",newDashboard:"new / duplicate",newLayout:"new dashboard",duplicate:"duplicate",urlDashboard:"URL"},button_help:{urlDashboard:"Show current dashboard / view URL"},menu:{resume:"resume",pause:"pause",refresh:"refresh",panelSetup:"panel setup",undock:"undock",dock:"dock",close:"close",cnt_all:"total CDR",total_perc:"%",duration_all:"âˆ‘ minutes",asr_all:"ASR",ner_all:"NER",acd_all:"ACD",mos_all:"MOS",mos_perc95_all:"MOS %95",mos_perc99_all:"MOS %99",mos_xr_avg_all:"MOS XR avg Both",mos_xr_avg_perc95_all:"MOS XR avg Both %95",mos_xr_avg_perc99_all:"MOS XR avg Both %99",mos_xr_avg_caller_all:"MOS XR avg Caller (A)",mos_xr_avg_caller_perc95_all:"MOS XR avg Caller (A) %95",mos_xr_avg_caller_perc99_all:"MOS XR avg Caller (A) %99",mos_xr_avg_called_all:"MOS XR avg Called (B)",mos_xr_avg_called_perc95_all:"MOS XR avg Called (B) %95",mos_xr_avg_called_perc99_all:"MOS XR avg Called (B) %99",mos_xr_min_all:"MOS XR min Both",mos_xr_min_perc95_all:"MOS XR min Both %95",mos_xr_min_perc99_all:"MOS XR min Both %99",mos_xr_min_caller_all:"MOS XR min Caller (A)",mos_xr_min_caller_perc95_all:"MOS XR min Caller (A) %95",mos_xr_min_caller_perc99_all:"MOS XR min Caller (A) %99",mos_xr_min_called_all:"MOS XR min Called (B)",mos_xr_min_called_perc95_all:"MOS XR min Called (B) %95",mos_xr_min_called_perc99_all:"MOS XR min Called (B) %99",mos_silence_avg_all:"MOS Silence avg Both",mos_silence_avg_perc95_all:"MOS Silence avg Both %95",mos_silence_avg_perc99_all:"MOS Silence avg Both %99",mos_silence_avg_caller_all:"MOS Silence avg Caller (A)",mos_silence_avg_caller_perc95_all:"MOS Silence avg Caller (A) %95",mos_silence_avg_caller_perc99_all:"MOS Silence avg Caller (A) %99",mos_silence_avg_called_all:"MOS Silence avg Called (B)",mos_silence_avg_called_perc95_all:"MOS Silence avg Called (B) %95",mos_silence_avg_called_perc99_all:"MOS Silence avg Called (B) %99",mos_silence_min_all:"MOS Silence min Both",mos_silence_min_perc95_all:"MOS Silence min Both %95",mos_silence_min_perc99_all:"MOS Silence min Both %99",mos_silence_min_caller_all:"MOS Silence min Caller (A)",mos_silence_min_caller_perc95_all:"MOS Silence min Caller (A) %95",mos_silence_min_caller_perc99_all:"MOS Silence min Caller (A) %99",mos_silence_min_called_all:"MOS Silence min Called (B)",mos_silence_min_called_perc95_all:"MOS Silence min Called (B) %95",mos_silence_min_called_perc99_all:"MOS Silence min Called (B) %99",mos_lqo_caller_all:"MOS LQO Caller (A)",mos_lqo_caller_perc95_all:"MOS LQO Caller (A) %95",mos_lqo_caller_perc99_all:"MOS LQO Caller (A) %99",mos_lqo_called_all:"MOS LQO Called (B)",mos_lqo_called_perc95_all:"MOS LQO Called (B) %95",mos_lqo_called_perc99_all:"MOS LQO Called (B) %99",packets_lost_all:"Packet loss",packets_lost_perc95_all:"Packet loss %95",packets_lost_perc99_all:"Packet loss %99",jitter_all:"Jitter",jitter_perc95_all:"Jitter %95",jitter_perc99_all:"Jitter %99",delay_all:"PDV",delay_perc95_all:"PDV %95",delay_perc99_all:"PDV %99",pdd_all:"PDD",pdd_perc95_all:"PDD %95",pdd_perc99_all:"PDD %99",cps_max:"CPS max",cps_avg:"CPS avg",rtcp_maxfr:"RTCP FL max",rtcp_maxfr_perc95_all:"RTCP FL max %95",rtcp_maxfr_perc99_all:"RTCP FL max %99",rtcp_avgfr:"RTCP FL avg",rtcp_avgfr_perc95_all:"RTCP FL avg %95",rtcp_avgfr_perc99_all:"RTCP FL avg %99",rtcp_maxjitter:"RTCP jitter max",rtcp_maxjitter_perc95_all:"RTCP jitter max %95",rtcp_maxjitter_perc99_all:"RTCP jitter max %99",rtcp_avgjitter:"RTCP jitter avg",rtcp_avgjitter_perc95_all:"RTCP jitter avg %95",rtcp_avgjitter_perc99_all:"RTCP jitter avg %99",rtcp_maxrtd:"RTCP Rtd max",rtcp_maxrtd_perc95_all:"RTCP Rtd max %95",rtcp_maxrtd_perc99_all:"RTCP Rtd max %99",rtcp_avgrtd:"RTCP Rtd avg",rtcp_avgrtd_perc95_all:"RTCP Rtd avg %95",rtcp_avgrtd_perc99_all:"RTCP Rtd avg %99",silence_all:"Silence",silence_perc95_all:"Silence %95",silence_perc99_all:"Silence %99",silence_end_all:"Last Silence",silence_end_perc95_all:"Last Silence %95",silence_end_perc99_all:"Last Silence %99",clipping_all:"Clipped Frames",clipping_perc95_all:"Clipped Frames %95",clipping_perc99_all:"Clipped Frames %99",price_customer:"Price Customer",price_operator:"Price Operator",price_difference:"Price Difference",counter:"counter",mos_f1_min:"mos f1 min",mos_f1_avg:"mos f1 avg",mos_f2_min:"mos f2 min",mos_f2_avg:"mos f2 avg",mos_ad_min:"mos adapt min",mos_ad_avg:"mos adapt avg",jitter_max:"jitter max",jitter_avg:"jitter avg",loss_max:"loss max",loss_avg:"loss avg",min:"min",max:"max",avg:"avg",perc95:"percentile 95",perc99:"percentile 99",numericColumn:"numeric column",chartWidget:"chart widget",hideMenu:"hide menu",passiveCharts:"passive charts",chartCacheSettings:"chart aggregation/rrd settings (beta version)",arrangeDashboardsInTree:"manage dashboards",linkToPngViaApi:"link to png",linkToCsvViaApi:"link to csv"},combomenu:{bySourceIP:"by source IP",byDestinationIP:"by destination IP",byCaller:"by caller",byCalled:"by called",typePanel_chart:"CDR charts",typePanel_chart_message:"Message charts",typePanel_chart_sip_msg:"Opt., Subsc., Notify charts",typePanel_chart_3d_rtp_stat:"RTP stat 3D charts",typePanel_grid_rtp_stat:"RTP stat grid",typePanel_sip_response_pie_chart:"CDR SIP responses (pie chart)",typePanel_sip_response_pie_chart_message:"IM SIP responses (pie chart)",typePanel_top_ip_address_chart:"Top CDR IP addresses",typePanel_top_ip_address_chart_message:"Top Messages IP addresses",typePanel_asr_acd_mos_by_sip_ip_grid:"custom CDR grid - by SIP IP",typePanel_asr_acd_mos_by_rtp_ip_grid:"custom CDR grid - by RTP IP",typePanel_asr_acd_mos_by_callerd_grid:"custom CDR grid - by number",typePanel_asr_acd_mos_by_ua_grid:"custom CDR grid - by user agent",typePanel_asr_acd_mos_by_country_by_sip_ip_grid:"custom CDR grid - by country (by SIP IP)",typePanel_asr_acd_mos_by_country_by_number_grid:"custom CDR grid - by country (by number)",typePanel_asr_acd_mos_by_sip_response_grid:"custom CDR grid - by SIP response",typePanel_count_by_sip_ip_grid_message:"custom Messages grid - by SIP IP",typePanel_count_by_callerd_grid_message:"custom Messages grid - by number",typePanel_count_by_country_by_sip_ip_grid_message:"custom Messages grid - by country (by SIP IP)",typePanel_count_by_country_by_number_grid_message:"custom Messages grid - by country (by number)",typePanel_count_by_sip_response_grid_message:"custom Messages grid - by SIP response",typePanel_sniffer_stat:"sniffer statistics",typePanel_sniffer_rrd:"sniffer charts",typePanel_collectd_rrd:"collectd charts",typePanel_active_calls_map:"active calls map",typePanel_active_calls_chart:"active calls chart",ascending:"ascending",descending:"descending",active_calls_chart_by_sensors:"calls by sensors",active_calls_chart_by_src_ip:"calls by top source ip",active_calls_chart_by_dst_ip:"calls by top destination ip"},title:{selectNewPanelType:"Select new panel type",saveTemplate:"Save dashboard",editTemplate:"Edit dashboard",duplicateTemplate:"Duplicate dashboard",msgDuplicationName:"duplication name",msgDeleteTemplate:"delete dashboard",panelSetup:"panel setup",tabFilter:"filters",tabFilterCommon:"filters - common",tabFilterRtp:"filters - RTP",tabFilterDscp:"filters - DSCP",tabFilterFiltersComb:"filters - combination",tabBaseSetting:"base setting",newDashboard:"New Dashboard",viewUrl:"Show current dashboard / view URL",filters:"filters",chartParameters:"chart parameters",setCustomTimeInterval:"Custom time interval",linkToPngViaApi:"link to png (via api)",linkToCsvViaApi:"link to csv (via api)",chartCacheSettings:"chart aggregation/rrd settings (beta version)",arrangeDashboardsInTree:"manage dashboards"},text:{questionClosePanel:"close panel",msgDuplicationName:"Name is used. Overwrite?",msgDeleteTemplate:"delete current dashboard?",msgRemoveAllPanels:"remove all panels?",restartSensor:"Restart sensor {0}?",upgradeSensor:"Upgrade sensor {0} to version {1}?",upgradeSensors:"Upgrade sensors {0} to version {1}?",bySourceIP_short:"by source IP",byDestinationIP_short:"by dest. IP",byCaller:"by caller",byCalled:"by called",changelog:"changelog",waitForFirstState:"wait for first state",betaVersions:"beta versions",newPanel:"New panel",formIsNotCompleted_checkAllTabs:"Form is not completed. Check all tabs!",noFreeRegionForNewPanel:"Unpin and resize your panels to make free room for new panel!",useUserHash:"use user_hash",useUserAndPassword:"use user and password",doNotForgetAddPasswordToLink:"do not forget add password to link",agregationShort:"agreg",youAreNotAuthorizedToOperation:"you are not authorized to perform the requested operation",questionForUseOnlyCache:"The calculation of the chart takes too long. Do you want to use the cache?",termsConfirm:"Enabling this feature (which is in beta version now) will create aggregated data for this chart which will allow instant render for any selected time range interval - especially if you need to see data for 30 days or even for whole year (we use aggregation intervals for day / week / month - similar to RRD). You can enable this only for some charts or enable it for all charts in all dashboards (in dashboard main toolbar click on wrench icon). Calculations are running on background - default number of parallel processes are 2 which can be changed in dashboard settings (in main dashboard toolbar the wrench icon). Use this feature wisely - if you do not need to see the data often take in mind that enabling the aggregation will continuously consume some CPU resources.<br><br>Please note that this feature is still in BETA and in case of problem we would need SSH access to the server to properply troubleshoot it.<br><br>Do you want to turn it on?",neverShowAgain:"never show again",disableChartCacheForPanelQuestion:"Disable chart aggregation for the selected panel?",enableChartCacheForPanelQuestion:"Enable chart aggregation for the selected panel?",agregationIsTemporarilyDisabledInSetting:"Aggregation of the chart is temporarily suspended in the chart aggregation setting.",agregationIsTemporarilyAutoDisabled:"Aggregation of the chart is temporarily suspended."},tooltip:{pause:"pause",resume:"paused - click to resume",refresh:"refresh",dock:"dock",undock:"undock",panelSetup:"panel setup",close:"close panel",setInterval:"change interval",restart:"restart",upgrade:"upgrade",setBySourceOrDestinationIP:"set by source or by destination IP",setByCallerOrCalledSide:"set by caller or called side",setTypeSensorRdd:"set type graph",setTypeCollectdGraphRdd:"set type graph",loadCameraParametersFromChart:"load camera parameters from chart",setCameraParametersToPanelSetup:"set camera parameters to panel setup",linkToPngCsvViaApi:"link to png / csv (via api)",exportToCsv:"export to csv",switchUseOnlyCache:"on / off use aggregation/rrd (beta version)",selectAgregationMethodAndChart:"select agregation method and chart widget",prevInterval:"previous interval",nextInterval:"next interval"}},alerts_daily_reports:{grid:{subject_alert:"alert",subject_daily_report:"daily report"},column:{last_run_at:"Last run at",concurrent_calls_limit_local:"calls limit - local",concurrent_calls_limit_international:"calls limit - intern.",concurrent_calls_limit:"calls limit - both",alert_descr:"alert",report_descr:"report",send_time:"started at",subject:"subject",last_cdr_id:"last cdr",send_email:"email",at_every:"At / Every",day:"day",timezone:"Timezone",use_cache:"use aggregation/rrd"},field:{descr:"Description",alert_type:"Alert Type",report_type:"Report Type",data_table:"Data Table",enable:"Enabled",every_interval_offset_min:"interval offset",at_day_of_week:"day of week",at_hour_of_day_from:"hour of day",at_day_of_month:"day of month",select_sensors:"select sensors",agregation_sensors:"aggreg.",enable_hyperlinks:"Enable hyperlinks",add_note2email:"Add Note into email",send_if:"Send alert if",send_if_report:"Send report if",every:"Every",at:"At",maximum_oldest_cdr_hour:"Max. oldest cdr",mos_lt:"MOS <",mos_xr_avg_lt:"MOS XR avg <",mos_xr_min_lt:"MOS XR min <",mos_silence_avg_lt:"MOS Silence avg <",mos_silence_min_lt:"MOS Silence min <",mos_lqo_caller_lt:"MOS LQO Caller <",mos_lqo_called_lt:"MOS LQO Called <",packets_lost_perc_gt:"Packet Loss >",jitter_gt:"Jitter >",delay_limit_ge:"PDV >",delay_count_gt:"PDV count >",silence_gt:"Silence >",silence_end_gt:"Last silence >",clipping_gt:"Clipping >",cb_rtp_ip_groups_id:"RTP IP Group",rtp_ip:"RTP IP Addresses",duration_gt:"Duration [s] >",pdd_gt:"PDD [s] >",sens_age_last_cdr_gt:"last cdr age [s] >",sens_packet_loss_gt:"#packet loss >",sens_sqlqueue_size_gt:"sqlsize >",sens_memory_res_mb_gt:"mem res [MB] >",sens_calls_gt:"calls >",sens_uptime_decrease:"uptime decrease",sens_select_sensors:"select sensors",sens_always_send_status:"always send status email",cdr_report_in_attachment:"cdr report in attachment",cdr_report_max_lines_in_body:"max lines in body",cdr_recap_report_in_attachment:"cdr summary in attachment",report_in_attachment:"report in attachment",summary_in_subject:"summary in subject",one_way:"One way",without_stream:"Missing RTP",interrupted_call:"Interrupted call",interrupted_call_time_tolerance:"time tolerance",last_sip_response_num:"SIP response",reason_type:"Type reason",reason_filter:"Reason filter",occurences_gt:"Incidents >",occurences_perc_from_all:"from all",cdr_gt:"# cdr >",time_without_call_minutes:"minutes without call >",time_without_call_only_connected:"only connected",cps_gt:"CPS >",dscp_caller_sip:"Caller SIP DSCP",dscp_called_sip:"Called SIP DSCP",dscp_caller_rtp:"Caller RTP DSCP",dscp_called_rtp:"Called RTP DSCP",dscp_cond_or:"Use OR condition",asr_lt:"ASR <",ner_lt:"NER <",acd_lt:"ACD <",rrd_avg_ge:"RRD avg >=",ipe_cdr_custom_headers_id:"custom header",ipe_error:"error code",call_timedout_absolute:"absolute time out",call_timedout_bye:"time out on post BYE",call_timedout_rtp:"timeout on RTP",call_timedout_oneway:"timeout on one way",concurrent_calls_minutes:"Check interval length",include_caller_numbers:"include caller numbers",exclude_caller_numbers:"exclude caller numbers",include_called_numbers:"include called numbers",exclude_called_numbers:"exclude called numbers",include_src_ip:"include source IP addresses",exclude_src_ip:"exclude source IP addresses",include_dst_ip:"include destination IP addresses",exclude_dst_ip:"exclude destination IP addresses",include_caller_domains:"include caller domains",exclude_caller_domains:"exclude caller domains",concurrent_calls_limit:"Concurrent calls limit",local:"local",international:"international",both:"both",fraud_by_ip:"By IP",fraud_rcc_by:"By",fraud_rc_by:"By",fraud_type_change_location:"Change type",fraud_use_domain:"Distinguish domains",fraud_filter_domain:"Domains filter",exclude_country:"Excluded country from alert",destination_country:"Destination country/continent",prefixes_called_numbers:"Called number prefixes",time_period_rules:"Time period rules",reg_filters:"Filters",next_reg_filters:"Next filters",fraud_interval_length:"Interval",fraud_interval_limit:"Limit",fraud_filter_international_only:"Only international calls",fraud_register_only_with_response:"with response",ip:"IP Addresses",number:"Numbers",domain:"Domains",ua:"User Agents",email:"E-mails",note:"Note",only_connected:"only connected",external_script:"external script",external_script_parameters_via_tmp_file:"script parameters via temporary files",external_script_vars:"variables exported into script",suppress_repeating_alerts:"suppress repeating alerts",alert_once_per_hours:"once per hours",international_prefixes_configuration:"international prefixes configuration",only_by:"only by",fraud_bill_by_ip:"IP addresses",fraud_bill_by_number:"numbers",fraud_bill_by_domain:"domains",quotas:"quotas",fraud_bill_quota_hour:"hour",fraud_bill_quota_day:"day",fraud_bill_quota_week:"week",fraud_bill_quota_month:"month",fraud_bill_quota_summary:"summary",fraud_bill_limit:"limit",fraud_store_pcaps:"store pcaps",fraud_store_pcaps_to_path:"to path",reg_unregister_time_sec_ge:"Unregistered time >=",reg_failed_occurences_ge:"Failed occurences >=",reg_ua:"User agents",reg_ua_neg:"NOT condition for user agents",reg_register_time_sec_le:"Register time <=",reg_interval_limit:"Limit",reg_interval_length_sec:"Interval",reg_rrd_avg_ms_ge:"RRD avg >=",reg_list_type:"List type",reg_ok_count_min:"Number of active registrations interval - min",reg_ok_count_min_column:"ok registration - min",reg_ok_count_max:"max",reg_ok_count_max_column:"ok registration - max",reg_ok_count_negative_condition:"negative condition (alert will be sent if the number of registrations is in the interval)",reg_ok_count_negative_condition_column:"negative condition",timeperiod:"Time period",report_last_days:"Last days",report_whole_month:"Whole month",cb_pmd_proxy_ip_groups_id:"Proxy IP Group",pmd_proxy_ip:"Proxy IP",pmd_mos_border_1:"MOS <",pmd_mos_border_2:"MOS >",pmd_cdr_custom_headers_id:"custom header",pmd_detail:"detail",cdr_sum_type:"Summary type",columns:"columns",cdr_sum_sort_by:"sort by",cdr_sum_sort_dir:"sort direction",cdr_sum_max_rows:"maximum rows",cc_interval_type:"interval",cc_interval_agregation:"join intervals",cc_interval_count:"count",cc_interval_days_of_week:"days",chart_enable_shadow:"Enable shadow in charts",send_pdf:"Send PDF",chart_pdf_image_format:"Charts format in PDF",pdf_page_orientation:"Landscape orientation",description:"description",enabled:"enabled",previous_period:"previous period",chart_width:"chart width",chart_height:"chart height",delete_all:"all",delete_to_date:"to date (<=)",ip_condition_12:"condition between source / destination",fraud_number_condition_12:"condition between caller / called",fraud_ip_condition_12:"condition between source / destination",custom_columns_enable:"custom columns",custom_columns_after_std:"after default columns",timezone:"Timezone",use_cache:"use aggregation/rrd (beta version)",sip_msg_type:"SIP message types",options:"options",subscribe:"subscribe",notify:"notify",sip_msg_group_by_ip:"group by IP",sip_msg_group_by_response_number:"group by response number",sip_msg_qualify_default:"use default qualify limit",sip_msg_qualify_limit:"qualify limit [ms]",sip_msg_ok_responses:"ok responses",sip_msg_data_source:"data source",owner_uid:"owner","private":"private",use_user_restriction:"use user restriction",read_permission:"read permission",write_permission:"write permission",users:"users",groups:"groups"},field_custom_columns:{top:"top",bottom:"bottom",field:"field",header:"header"},field_help:{descr:"This description will appear in email subject",send_if:"criteria match - send alert / report only if criteria and filters matches<br>no criteria match - send alert / report only if criteria and filters matches no data during period<br>both - send alert / report if criteria and filters matches and alsi if there is no data during the period",maximum_oldest_cdr_hour:"Alert rule takes all cdr since last alert match but limited to maximum age of a cdr by this parameter. Please take in mind that â€œsince last alert matchâ€ is not the same as â€œsince last alert runâ€. Â If you setup alert rule where you would like to be alerted once 5% of CDR meets some criteria and the alert runs every 5 minutes it does not mean that CDR is automatically taken only from the last 5 minutes period but since last posotive alert match and limited by this parameter.",mos_lt:"Send alert / report if MOS is less than this",mos_lqo_caller_lt:"Send alert / report if MOS LQO Caller is less than this",mos_lqo_called_lt:"Send alert / report if MOS LQO Called is less than this",packets_lost_perc_gt:"Send alert / report if packet loss in % is greater than this",jitter_gt:"Send alert / report if jitter is greater than this",delay_limit_ge:"Send alert / report if choosen delays is greater than count",sens_always_send_status:"Send alert even if criteria do not match showing that sensors are ok.",last_sip_response_num:"If you want to filter all 4XX responses put here number 4. If you want to filter specific responses put here 481 for example. Use !200 for all CDRs except 200OK.",occurences_gt:"Send alert only if this rule matches more than N times",occurences_gt_perc_cond:"logical condition between count of incidents and percentage",occurences_perc_gt:"Send alert only if this rule matches in more than N percents",occurences_perc_from_all:"chooses percentage equation<br>enabled - quotient of all CDRs and common filter subtabs including incidents rules<br>disabled - quotient of common filter subtabs and common filter subtabs including incidents rules",call_timedout_absolute:"If a call is released from memory due to absolute timeout (absolute_timeout is the sensor configuration option) this alert is triggered.",call_timedout_bye:"After receiving BYE message the sensor still accepts RTP or SIP which keeps the call in memory until 20 minute timeout occurs. It can happen that some device can send RTP stream indefinitely (stuck / bug) which is one of the case to trigger this alert.",call_timedout_rtp:"Trigger alert when the call is removed from memory due to rtptimeout option.",call_timedout_oneway:"Trigger alert when sniffer detects call with one-way SIP signaliization. This can happen when the sniffer do not see all the traffic or the receiver does not respond at all.",fraud_register_only_with_response:"Inspect REGISTER flood only if there is any response to REGISTER. Purpose of this option is to not be alerted for REGISTER messages which you firewalled but the "+applName+" still sees it but without response.",ip:"List of IP addresses or network ranges delimited with space or , or ; or newline. Examples: 192.168.0.0/24,10.0.0.10",number:"List of Tel. number prefixes which match source or destination. List is delimited with space or , or ; or newline.",email:"List of emails to which this alert will be sended. List is delimited with space or , or ; or newline. Can be omitted if an external script is entered.",report_last_days:"Report will include data for last X days. Default is one day.",every_interval_offset_min:"This option shifts the end of the timeline from now() to now() - X minutes. This is useful when you do not want to see downward trend due to the fact that there are still ongoing calls which is not yet in the chart. It is applied to all graphs in the report. It must be shorter then 'every' interval.",cc_interval_agregation:"For example if you set 8 and hour interval the report table will aggregate maximum concurrent calls per 8 hour intervals (0-8, 8-16, 16-24). The same is for minute interval - for example number 30 will show maximum calls for every 30 minutes.",custom_columns_enable:"Option to enable the definition of optional columns.",custom_columns_after_std:"When checked, optional columns will be placed behind the standard columns. When unchecked, optional columns will replace standard columns."},combomenu:{min:"min",max:"max",caller:"caller",called:"called",by_rtp_ip:"RTP IP",SIP:"SIP",Q850:"Q.850",sip_response:"SIP response",sip_caller_ip:"SIP caller IP",sip_called_ip:"SIP called IP",caller_number:"Caller number",called_number:"Called number",ua_caller:"User agent - caller",ua_called:"User agent - called",country_sip_caller_ip:"Country by SIP caller IP",country_sip_called_ip:"Country by SIP called IP",country_caller_number:"Country by caller number",country_called_number:"Country by called number",number_of_calls:"number of calls",by_minutes:"by minutes",by_hours:"by hours",by_days:"by days",cdr:"cdr",message:"message",source:"source",destination:"destination",both:"both",source_ip:"source ip",destination_ip:"destination ip",source_number:"source number",rtp_stream_ip:"rtp stream",rtp_stream_ip_group:"rtp stream group",summary:"summary",cc_interval_minute:"minute",cc_interval_hour:"hour",cc_interval_day:"day",operator_and:"AND",operator_or:"OR",operator_both_directions:"BOTH DIRECTIONS",current:"current",previous:"previous",active:"active",stored:"stored",src_ip:"source",dst_ip:"destination",no:"no",yes:"yes",yes_first:"yes - first"},combomenu_help:{operator_and_number:"caller number = caller condition AND called number = called condition",operator_or_number:"caller number = caller condition OR called number = called condition",operator_both_directions_number:"(caller number = caller condition AND called number = called condition) OR<br>(caller number = called condition AND called number = caller condition)",operator_and_ip:"source IP = source condition AND destination IP = destination condition",operator_or_ip:"source IP = source condition OR destination IP = destination condition",operator_both_directions_ip:"(source IP = source condition AND destination IP = destination condition) OR<br>(source IP = destination condition AND destination IP = source condition)",active:"",stored:""},combobox_emptyinfo:{cdr_custom_headers_id:"you have no custom header defined"},button:{preview_alert:"preview alert",preview_report:"preview report",send_alert:"send alert",send_report:"send report",delete_all:"Delete all",preview_chart:"preview chart","delete":"delete"},button_tooltip:{preview_alert_disabled_for_no_criteria_match:'preview for "no criteria match" is disabled',send_alert_disabled_for_no_criteria_match:'send for "no criteria match" is disabled'},menu:{normal_preview:"normal preview",test_preview:"test preview",cdr:"CDR",messages:"MESSAGES",sip_msg:"Options / Subscribe / Notify"},tab:{basicData:"basic data",filter:"filter",filterCommon:"filter - common",filterRtp:"filter - RTP",filterDscp:"filter - DSCP",filterFiltersComb:"filter - combination",charts:"charts",otherSettings:"other settings"},text:{infoDeleteSentAlerts:"will be deleted {0} sent alerts",infoDeleteSentReports:"will be deleted {0} sent reports",alertSent:"Alert sent",reportSent:"Report sent",deleteSentAlerts:"delete sent alerts",deleteSentAlertsQuestion:"Delete sent alerts?",deleteAllSentAlertsQuestion:"Delete all sent alerts?",deleteToTimeSentAlertsQuestion:"Delete alerts to time {0}?",deleteSentReports:"delete sent reports",deleteSentReportsQuestion:"Delete sent reports?",deleteAllSentReportsQuestion:"Delete all sent reports?",deleteToTimeSentReportsQuestion:"Delete reports to time {0}?",at:"at",every:"every"},title:{alerts:"Email Alerts",sent_alerts:"Sent Alerts",daily_reports:"Daily Email Reports",sent_daily_reports:"Sent Daily Reports",delete_sent_alerts:"Delete sent alerts",delete_sent_reports:"Delete sent reports",incidentsRules:"incidents rules",addCustomColumn:"add custom column",editCustomColumn:"edit custom column",userRestrictions:"user restrictions"}},daily_reports:{combomenu:{min:"min",max:"max",caller:"caller",called:"called",by_rtp_ip:"RTP IP"}},user_admin:{column:{time:"Time",type:"Type",bad_login_reason:"Subtype",addr:"Remote Address",user_agent:"User Agent",reason:"Reason",repeat_counter:"Repetetion",custom_header:"Custom header"},field:{username:"Login name",username_email:"Login name (email)",name:"Name",password:"Password",email:"E-mail",id_group:"Group",group_name:"Group",ip:"IP addresses",number:"Tel. numbers",domain:"Domains",vlan:"Vlans",cdr_custom_headers:"CDR custom headers",message_custom_headers:"Message custom headers",ip_number_domain_or:"OR condition between IP addr., Tel. numbers, Domains",note:"Note",is_admin:"Is administrator",req_2fa:"2FA auth",can_cdr:"Enable CDR",can_write_cdr:"Can delete CDR",can_play_audio:"Can play CDR",can_download_audio:"Can download WAV/OGG",can_listen_active_call:"Can listen active call",can_show_fax:"Can show fax",can_pcap:"Can download PCAP",can_upload_pcap:"Can upload PCAP",can_messages:"Enable Messages",can_view_content_message:"Can view content message",can_view_message_url:"Can view message URL",no_rtp:"Remove RTP from PCAP",simple_cdr:"Simple CDR",hide_cdr_groups:"Hide CDR / Messages groups",hide_cdr_groups_cdr_only:"Hide CDR groups",can_graphs:"Can graphs",can_tracker:"Enable Tracker",can_activecalls:"Enable active calls",can_activecalls_map:"Enable active calls map",can_register:"Enable register",can_sip_msg:"Enable sip opt., subsc., notify",can_livesniffer:"Enable live sniffer",can_dashboard:"Enable dashboard",dashboard_read_only:"Read only dashboard",show_only_connected_calls:"Show only connected calls",can_capture_rules:"Enable capture rules",crules_remove_expire_time:"Capture rules autoremove interval",can_audit:"Enable audit",can_alerts_edit:"Enable edit alerts",create_only_private_alerts:"Create only private alerts",can_alerts_show_sent:"Enable show sent alerts",can_reports_edit:"Enable edit reports",create_only_private_reports:"Create only private reports",can_reports_show_sent:"Enable show sent reports",can_report_functions:"Enable report functions",can_cdr_share_local_public:"Enable local public share",can_cdr_share_local_private:"Enable local private share",can_cdr_share_voipmonitor_org:"Enable "+appShareUrl,hide_license_information:"Hide license on homepage",can_ipacc:"Enable IP account",can_mtr:"Enable MTR",can_network:"Enable network settings",can_edit_codebooks:"Enable edit groups",can_show_sql_query:"Enable show SQL query",can_sensors_operations:"Enable sensors operations",can_edit_all_templates:"Can edit all templates",can_delete_all_templates:"Can delete all templates",hide_change_password:"Hide change user auth",hide_user_configuration:"Hide user configuration",password_expired:"Password is expired",can_svg_paint:"Enable Network map",can_3d_rtp_charts:"Enable 3D RTP charts",uc_color_theme_shift:"HSV",uc_color_theme_shift_h:"H",uc_color_theme_shift_s:"S+",uc_color_theme_shift_v:"V+",uc_font_main_menu:"main menu",uc_enable_confirm_before_unload:"Enable confirm before close / unload",uc_enable_dns_cdr:"Enable DNS IP lookup in CDR",uc_enable_dns_message:"Enable DNS IP lookup in Messages",uc_enable_dns_ss7:"Enable DNS IP lookup in SS7",uc_enable_flags_cdr_number:"Enable flags in CDR / number",uc_enable_flags_cdr_ip:"Enable flags in CDR / IP",uc_enable_flags_message_number:"Enable flags in Messages / number",uc_enable_flags_message_ip:"Enable flags in Messages / IP",uc_enable_flags_ss7_number:"Enable flags in SS7 / number",uc_enable_flags_ss7_ip:"Enable flags in SS7 / IP",uc_csv_field_separator:"CSV field separator",colorThemeShift:"color theme shift",fonts:"fonts",sensor_name:"sensor",sensor_id:"sensor",description:"description",at:"at",user_name:"user",activity:"activity type",reason:"reason",dest_number:"Dest.number",allow_change_settings:"Allow change settings",profile_id:"Profile",profile_name:"Profile",auto_popup:"Auto popup",show_ip:"Show IP",popup_on:"Popup on",non_numeric_caller_id:"Non numeric destination number",regex_calling_number:"Regex source number",src_ip_whitelist:"Include source IP",src_ip_blacklist:"Exclude source IP",app_launch:"App launch",app_launch_args_or_url:"App launch arguments / URL",status_line:"Status line",popup_title:"Popup title",Description:"Description",reason:"Reason",blocked:"Blocked",blocked_reason:"Blocked reason",max_bad_login_attempt:"Max bad login attempt",password_expiration_days:"Password expiration",enable_login_ip:"Enable remote addresses",password_min_length:"Minimum password length",password_min_small_letters:"Minimum small letters",password_min_large_letters:"Minimum large letters",password_min_numbers:"Minimum numbers",password_min_other_chars:"Minimum other characters",password_rules:"password rules",config_grid:"columns of grid - width, order",delete2fa_sec:"2FA secret state",keep2fa_sec:"Keep it",remove2fa_sec:"Remove current secret",missing_sec:"2FA secret state",req_2fa:"Require 2FA authentication",file:"File",deleteOld:"Delete old"},field_help:{username:"Login name",ip:"Restrict user to view only CDR / active calls which matches with IP address / network. Each IP has to be delimited with [enter]. Format is A.B.C.D/N where /N is optional and N is network mask from 0 to 32",number:'Restrict user to view only CDR / active calls which matches with telephone number. Each number has to be delimited with [enter]. You can use MySQL syntax LIKE. For example "222%" will restrict all numbers which starts with 222.',domain:"Restrict user to view only CDR / active calls which matches with domain. Each domain has to be delimited with [enter]. You can use MySQL syntax LIKE - for example domain%.",vlan:"Restrict user to view only CDR / active calls which matches with vlan ID. Each vlan has to be delimited with [enter].",cdr_custom_headers:"Restrict user to view only CDR / active calls which matches with custom headers content",message_custom_headers:"Restrict user to view only Messages which matches with custom headers content",is_admin:"Administrator can create and modify users.",req_2fa:"Require 2FA for authentication.",can_play_audio:"Can play CDR",can_download_audio:"Can download WAV/OGG from CDR",can_pcap:"Can download PCAP file",crules_remove_expire_time:"Define maximum interval (in hours) for the expire time setting in the capture rules. If set then the setting of the capture rules expire time is required.",no_rtp_text:"Remove RTP packets from pcap file on download. Usefull for not allowing users to listen to calls.",simple_cdr:"Show only simple CDR layout",delete2fa_sec:"If you select 'remove' then actual user's 2FA secret will be deleted. The user will have to create new secret in the first/next login if 2FA authentication is required.",req_2fa:"This enables user's 2FA authentication. The user will have to create new secret in the first/next login."},grid:{subject:"user",subject_user:"user",subject_group:"group",subject_sensor:"sensor",subject_profile:"profile"},title:{enabledSensorsTab:"enabled sensors",historyTab:"history",users:"Users",groups:"Groups",relatedCdrTab:"related CDR",filterQueryTab:"filter query",screen_popup_users:"Easy Caller ID users",screenPopupUsersTab:"users",screenPopupProfileTab:"profiles",blockUser:"Block user",blockGroup:"Blok group",settings:"Settings",commonTab:"common",colorFontTab:"color, font",resetConfiguration:"reset configuration",basic_data:"basic data",secure_users:"secure users",users_restriction:"users restriction",enabled_sensors:"enabled sensors",importUserRestrictions:"Import user restrictions"},text:{infoDeleteAuditLog:"will be deleted _COUNT_ records from audit log",duplicationUser:"duplication user",simpleCdrWarning:"This option hides many informations in CDR section making this section more likely call recorder instead of diagnostic tool - are you sure you want that?",queryBeforeReset:"After performing the reset operation, the application will be reloaded. Continue?"},menu:{tools:"tools",exportUserRestrictions:"export user restrictions",importUserRestrictions:"import user restrictions"},tooltip:{blockUser:"block user",blockGroup:"blok group",unblockUser:"unblock user",unblockGroup:"unblock group",groupIsBlocked:"user group is blocked"},enumdata:{login:"login",relogin:"relogin",bad_login:"bad login",bad_relogin:"bad relogin",password_change:"password change",secret2fa_change:"secret 2fa change",block:"block",unblock:"unblock",none:"",bad_password:"bad pasword",blocked_address:"blocked address",blocked_account:"blocked acount",bad_2facode:"bad 2FA code",left:"left",right:"right",disable:"disable"},button:{reset:"reset",selectFile:"Select File..."},checkboxes_group:{cdr:"CDR",messages:"messages",registers__sip_msg:"registers / sip options, subscribe, notify",pcap:"pcap (download / upload)",audio_fax:"audio & fax",active_calls:"active calls",dashboard_charts:"dashboard & charts",alerts_reports:"alerts & reports",share:"share",others:"others"}},capture_rules:{field:{ip:"IP address",mask:"Network mask [0-32]",maskV6:"Network mask [0-128]",prefix:"Prefix",domain:"Domain",header:"SIP header",content:"Content",content_type:"Content type",direction:"Direction",sensors_id:"Sensors",sensors:"Sensors",rtp:"Record RTP",rtcp:"Record RTCP",sip:"Record SIP",graph:"Record GRAPH",wav:"Record WAV",register:"Record REGISTER",dtmf:"Record DTMF",skip:"Skip",script:"Run script",mos_lqo:"Activate MOS LQO",mos_lqo_short:"MOS LQO",hide_message:"Hide message",spool_2:"Store pcaps to second spool",remove_at:"Auto remove at",no_permanent:"Permanent rule",note:"Note",deletetime:"The rule will be deleted at"},field_help:{ip:"IP address or network.",mask:"Network mask from 32 - 0. 32 represents single IP adress. If you want to add whole 192.168.C.D network just add IP adress 192.168.0.0 and mask 16",prefix:"Tel. number prefix. 222 will record all calss starting dialed number or caller number with 222",domain:"",header:"",content:"",content_type:"",direction:"Match this rule only for source IP or only for destination IP or for both src or dst IP",rtp:"Record RTP packets?",rtcp:"Record RTCP packets?",sip:"Record SIP packets?",graph:"Record GRAPH files?",wav:"Record WAV files?",register:"Record REGISTER packets?",dtmf:"Record DTMF ?",skip:"Call will be completely skipped?",script:"Tells sniffer to run shell script. See filtercommand in sniffer configuration.",mos_lqo:"",hide_message:"",remove_at:"",spool_2:"Enable pcap storing into second spool. If the setting is not allowed be sure you have spool_index column in cdr_next table.",no_permanent:"The rule is permanent by default. I.e it's not deleted by global rules autoremover. With this option you can disable it."},button:{reloadSniffer:"Reload sniffer",grouping_by_sensors:"grouping by sensors"},text:{all_sensors:"all sensors",questionSaveSetRtpWav:"You have selected saving both RTP and WAV which is redundant and not needed. To get audio from the GUI you only need to store RTP because the audio is extracted on demand from RTP. Storing WAV doubles CPU and I/O resources - are you sure you want this?",alertNoWildcardsInPrefix:"Capture rules does not support MySQL wildcards like %1245 or _. Use Capture rules by header and regular expressions instead.",realoadSnifersQuestionAfterChange:"change made - reload all sniffers?",reloadingResult:"reloading result",clickHereForKeep:"click here for keep"},title:{ip:"IP based",telnum:"Calling/Called Number based",domain:"Calling/Called Domain based",sip_header:"SIP Header based"}},cust:{column:{name:"name",cust_id:"customer ID",customer_name:"name",address:"address",ip:"IP",number:"numbers",vat_or_id:"VAT / ID",reseller_name:"reseller",start_time:"start at",postAddress:"post address",type_ip:"type / IP",server:"server"},field:{reseller_id:"Reseller",customer_id:"Customer",name:"Name",cust_id:"Customer ID",address:"Address",ip:"IP",number:"Numbers",enable_ip_detail:"Enable IP detail",enable_ip_detail_for_reseller:"Enable IP detail for Reseller"},field_help:{},title:{active:"Active",archive:"Archive"},grid:{subject_reseller:"reseller",subject_customer:"customer",subject_subsidiary:"subsidiary"},createNewCustomer:"create new customer",linkExistCustomer:"link existing customer",deleteCustomer:"delete customer",unlinkCustomerFromReseller:"unlink customer from reseller",linkSelectCustomersToReseller:"link select customers to reseller",unlinkSelectCustomersFromReseller:"unlink select customers from reseller",removePasswordFromSelect:"remove pasword (disable login)"},nagios:{column:{status_current_state:"state",status_last_check_time:"last check",status_last_update_time:"last update"},field:{customer_id:"customer"},title:{host:"Nagios - Host",service:"Nagios - Service",contact:"Nagios - Contact",setting:"Nagios - Seting",hostTab:"host",hostgroupTab:"group",serviceTab:"service",servicegroupTab:"group",contactTab:"contact",contactgroupTab:"group",timeperiodTab:"time period",timeperiodDefineTab:"define",timeperiodExcludeTab:"exclude",commandTab:"command",contactNotificationCommandSubTab:"next notification",contactSubTab:"contact",contactgroupSubTab:"contact group",hostSubTab:"host",hostgroupSubTab:"host group",serviceSubTab:"service",servicegroupSubTab:"service group",hostParentSubTab:"parent",hostContactSubTab:"contact",contactHostSubTab:"host",hostContactgroupSubTab:"contact group",contactgroupHostSubTab:"host",hostServiceSubTab:"service",serviceHostSubTab:"host",serviceHostgroupSubTab:"host group",hostgroupServiceSubTab:"service",serviceContactSubTab:"contact",contactServiceSubTab:"service",serviceContactgroupSubTab:"contact group",contactgroupServiceSubTab:"service"},linkExistContact:"link exist contact",createNewContact:"create new contact",editLinkContact:"change link contact",editContact:"edit contact",unlinkContact:"unlink contact",deleteContact:"delete contact",linkExistHost:"link exist host",createNewHost:"create new host",editLinkHost:"change link host",editHost:"edit host",unlinkHost:"unlink host",deleteHost:"delete host",linkExistService:"link exist service",createNewService:"create new service",editLinkService:"change link service",editService:"edit service",unlinkService:"unlink service",deleteService:"delete service",applyVmConfig:"apply",newConfigurationSuccessfullyAccepted:"new configuration successfully accepted"},common_settings:{field:{international_prefixes:"international prefixes",international_number_min_length:"min. international length",international_number_min_length_prefixes_strict:"strict for prefixes",country_code_for_local_numbers:"local numbers are in",enable_check_napa_without_prefix:"enable check NANPA without prefixes",min_length_napa_without_prefix:"min. length",skip_prefixes:"trim prefixes"},field_help:{international_number_min_length:"<b><i>unchecked</i></b>: Any dialed number with count of digits equal or greater is treated as international. When dialed number is shorter, its treated as international only when dialed number starts with international prefix.<br><b><i>checked</i></b>: Dialed number is treated as international only when count of digits is greater or equal to defined value and dialed number starts with international prefix.",skip_prefixes:"Trim left side of the prefix by specified number. If number begins with ^ it is considered as regex.",min_length_napa_without_prefix:"minimum length for apply NANPA rules (without prefix '1')"},title:{commonSettings:"Country Prefix",internationalRulesTab:"international rules"}},billing:{column:{name:"name",holiday_state_name:"state holidays",country_name:"country",prefix_number:"prefix pattern",fixed_number:"fixed length pattern",regex_number:"regex pattern",price:"price",t1:"T1",t2:"T2",billing_name:"billing",ip_net:"IP or net",default_customer_billing:"default cust.",side:"direction",default_use_for_number_format:"format",default_use_for_number_type:"area",use_for_number_format:"format",use_for_number_type:"area"},field:{name:"Name",id_holiday_state:"State holidays",default_price:"Default Price",default_price_peak:"Default Price peak",peak_offpeak:"Enable peak / offpeak",default_peak_starts_hour:"Default Peak starts hour",default_peak_starts_minute:"minute",default_peak_ends_hour:"Default Peak ends hour",default_peak_ends_minute:"minute",default_weekend_start:"Default Weekend start",default_t1:"Default T1",default_t2:"Default T2",default_use_for_number_format:"Format match",default_use_for_number_type:"Area match",default_customer_billing:"Default customer billing",prefix_number:"Prefix number",fixed_number:"Fixed number",regex_number:"Regex number",id_sensor:"Sensor",price:"Price",price_peak:"Price peak",override_default_peak_offpeak:"Override default peak / offpeak",peak_starts_hour:"Peak starts hour",peak_starts_minute:"minute",peak_ends_hour:"Peak ends hour",peak_ends_minute:"minute",weekend_start:"Weekend start",t1:"T1",t2:"T2",use_for_number_format:"Format match",use_for_number_type:"Area match",country_code:"Country",description:"Description",type:"Type",month:"Month",month_day:"Month day",date:"Date",ip:"IP",mask:"Mask",number:"Number",fixed:"Fixed",side:"Direction",id_billing:"Biling",addresses:"Addresses",numbers:"Numbers",addresses_destination:"Destination IP addresses",numbers_destination:"Destination numbers",addresses_source:"Source IP addresses",numbers_source:"Source Numbers",limitation_for_sensors:"Limitation for sensors",sensors:"Sensors",currency_code:"Currency",timezone_name:"Timezone",enable_by_ip:"Enable by addresses",enable_by_number:"Enable by numbers",enable_by_domain:"Enable by domains",week_start:"Week start",hours_history_in_days:"Hours history [days]",days_history_in_weeks:"Days history [weeks]",weeks_history_in_months:"Weeks history [months]",month_history_in_years:"Months history [years]",international_prefixes_configuration:"international prefixes configuration",request:"request",calldate:"datetime",duration:"duration",caller:"caller num",called:"called num",caller_domain:"caller domain",called_domain:"called domain",domain:"domain",sipcallerip:"source IP",sipcalledip:"destination IP",response:"response",price_operator:"operator price",price_customer:"customer price",debug_output:"debug output",sensor_id:"sensor",operator_rule:"operator rule",customer_rule:"customer rule",use_exclude_rules:"use exclude rules",progress:"progress"},field_help:{default_use_for_number_format:"Default use for number format - help",default_use_for_number_type:"Default use for number type - help",use_for_number_format:"Use for number format - help",use_for_number_type:"Use for number type - help"},combodata:{numberFormat_original:"original",numberFormat_normalized:"normalized",numberFormat_both:"original or normalized",numberType_local:"local",numberType_international:"international",numberType_both:"local or international"},button:{start:"start",stop:"stop"},title:{billingConfiguration:"Billing configuration",billingTab:"billing type / patterns",billingRuleTab:"patterns",holidayStateTab:"state holidays",holidayStateDateTab:"dates",operatorAssignmentTab:"operator assignment",customerAssignmentTab:"customer assignment",addressesTab:"addresses",numbersTab:"numbers",domainsTab:"domains",addresses_destinationTab:"destination IP addresses",numbers_destinationTab:"destination numbers",addresses_sourceTab:"source IP addresses",numbers_sourceTab:"source numbers",excludeTab:"exclude",currencyTab:"currency",agregationTab:"aggregation",settingsTab:"settings",excludeAddressesTab:"exclude addresses",excludeNumbersTab:"exclude numbers",excludeDomainsTab:"exclude domains",billingTest:"billing test",revaluationBilling_selectedRows:"Revaluation Billing for selected rows",revaluationBilling_allFilteredRows:"Revaluation Billing for all filtered rows"},text:{internationalPrefixesConfiguration:"international prefixes configuration",operator:"operator",customer:"customer",auto:"auto",theRevaluationWasCompletedSuccessfully:"the revaluation was completed successfully"}},fraud:{column:{name:"name",type:"type",priority:"priority",direction:"direction",ip_number:"ip / number",cb_descr:"group description",alertCondition:"condition",whitelist:"whitelist"},field:{name:"Name",use_group_classification_rule:"Group of classification rule",note:"Note",type:"Type",direction:"Direction",ip:"IP Addresses",number:"Numbers",src_ip__cb_ip_groups_id:"IP group",src_ip__ip:"IP",src_ip__countries:"Countries",src_ip__cb_country_groups_id:"Area",src_ip__change:"IP change",user_agent:"User Agent",dst_num__cb_number_groups_id:"Number group",dst_num__number:"Number",dst_num__countries:"Countries",dst_num__cb_country_groups_id:"Area",price__per_call:"Price",price__during_interval__limit:"Limit",price__during_interval__interval:"Interval",same_number__limit:"Limit",same_number__interval:"Interval",international_number_limit__limit:"Limit",international_number_limit__interval:"Interval",international_number_limit__length_number_gt:"Number length gt",concurrent_calls__limit_max:"Max",concurrent_calls__limit_min:"Min",concurrent_calls__from_hour:"From hour",concurrent_calls__to_hour:"To hour",whitelist:"Whitelist"},title:{fraudConfiguration:"Fraud Detection - configuration",classificationRuleGroupTab:"classification rules - groups",classificationRuleTab:"classification rules",alertRuleTab:"alert rules"}},setting:{column:{flag:"flag",lang_short:"lang - short",lang:"language",note:"note",type:"type",string_id:"id",string_en:"en",string_locale:"locale"},field:{lang_short:"Language - shortcut",lang:"Language",flag:"Flag",note:"Note",string_en:"En",string_locale:"Locale"},title:{localization:"Localization",localizationLangStringTab:"strings"},international_rules_field:{international_prefixes:"international prefixes",international_number_min_length:"min. international length",international_number_min_length_prefixes_strict:"strict for prefixes",country_code_for_local_numbers:"local numbers are in",enable_check_napa_without_prefix:"enable check NANPA without prefixes",min_length_napa_without_prefix:"min.length",skip_prefixes:"trim prefixes"},international_rules_field_help:{international_number_min_length:"<b><i>unchecked</i></b>: Any dialed number with count of digits equal or greater is treated as international. When dialed number is shorter, its treated as international only when dialed number starts with international prefix.<br><b><i>checked</i></b>: Dialed number is treated as international only when count of digits is greater or equal to defined value and dialed number starts with international prefix.",skip_prefixes:"Trim left side of the prefix by specified number. If number begins with ^ it is considered as regex.",min_length_napa_without_prefix:"minimum length for apply NANPA rules (without prefix '1')"}},changeUserAuth:{text:{possibleActions:"Possible action(s)",requiredActions:"Required action(s)",requirePassword:"Your account requires password setup. Password expired.",require2FA:"Your account requires Two Factor Authentification setup. You will require 2FA application like Google Authenticator on Android or iOS.",authRequired:"Authorization is required.",newPassword:"Enter new password.",new2FA:"Scan this qrcode by your favorite 2FA application or enter the secret code manually. We recommend to archive your secret code in case you loose your phone.",newSecret:"New secret",verify:"Enter your password / PIN code which you see in your 2FA application. Please note that the PIN code changes every minute and the verification will fail if your server has out of sync time.",finish:"Setup is complete. Click to Finish for save new password / 2FA.",authMissingSetting:"You didn't choose any action.",authMissingOldPassword:"Missing actual password.",authMissingOld2FAcode:"Missing actual 2FA code.",authMissingNewPassword:"Missing new password.",authDifferentNewPassword:"Different new passwords.",authNeedDiffPasswordNewOld:"New password must be different than your old pasword.",authMissingPassword:"Missing password.",authMissing2FAcode:"Missing 2FA code."},title:{authChangeAuth:"Password settings / Two Factor Authentication (2FA)",authErrorTitle:"Error",start_info_form:"request selection",auth_form:"user authentication",newpass_form:"new password",new2fa_form:"new 2FA secure",verify_form:"verification",finish_form:"finish"},checkbox:{setPassword:"Change password",set2FAsecret:"Set Two Factor Authentication (2FA)",change2FAsecret:"Change Two Factor Authentication (2FA)"},field:{password:"Actual password",code2fa:"Actual 2FA code",newpassword:"Password",newpassword2:"Verify password",verifypassword:"New password",verifycode2fa:"2FA code for the new secret"},button:{authGenNew2FA:"Other 2FA secret"}},tools:{column:{description:"description",filepathname:"file",table:"table",table_size:"table size",problem_description:"problem description",problem_severity:"severity",order_num:"#",sql:"SQL",run_at:"run at",finish_at:"finished at",duration:"duration",pid:"pid",task_id:"task"},field:{oldest_date_in_spool:"oldest date in spool",notes:"notes",email:"e-mail"},button:{runSql:"start upgrade / run sql",copySqlToClipboard:"copy sql to clipboard"},text:{selectFilesForRestore:"Select files for restore.",clickToButtonRestoreForStartRestoreSelectedFiles:"Click to button Restore for start restore selected files.",restoreGuiConfigurationSuccess:"Restoring configuration from backup was successfully completed. The application will be reloaded.",restoreGuiConfigurationWarnings:"Restoring configuration from backup was completed with warnings. The application will be reloaded.",restoreGuiConfigurationErrors:"Restoring configuration from backup was completed with errors.",restoreGuiConfigurationErrorsAndWarning:"Errors and warnings are caused by insufficient permissions on the file system. You can try command 'php php/run.php restoreGuiConfigurationFiles -f backup.zip'.",selectTablesForRestore:"Select tables for restore.",clickToButtonRestoreForStartRestoreSelectedTables:"Click to button Restore for start restore selected tables.",restoreGuiTablesSuccess:"Restoring tables from backup was successfully completed. The application will be reloaded.",restoreGuiTablesWarnings:"Restoring tables from backup was completed with warnings. The application will be reloaded.",restoreGuiTablesErrors:"Restoring tables from backup was completed with errors.",tableProblems:"Table problems (select problems to fix)",sqlQueriesToSolveProblems:"List of MySQL queries for upgrade operations",pleaseSetOldestDateInSpool:"please set oldest date in spool",sqlOperationCanTakeLotOfTime:"warning: sql operations can take a lot of time",showLowSeverity:"show low severity",sqlQueue:"sql queue",databaseMaintenanceInProgress:"Database maintenance in progress. Please wait.",databaseMaintenanceIsComplete:"Database maintenance is complete.",confirmRunBatchSql:"WARNING - upgrade operations can take long time (depends on the size of the tables) and during the upgrade you will be not able to use the GUI.",confirmCancelBatchSql:"Do you really cancel sql queries?",mysqlSchemaIsOK:"MySQL schema is OK",upgradeSensorsQuestionBeforeUpgradingSqlSchema:"Before upgrading SQL schema, some sensors needs to upgrade - do you want to upgrade them?",upgradeSensorsQuestionBeforeGenerateDebugLog:"Before generate debug log, some sensors needs to upgrade - do you want to upgrade them?",generateDebugLogInfo:"After you press the send button, your configuration and diagnostic information will be sent.",generateDebugLogLinkInfo:"Here is a link to access the information that was sent."},title:{restoreGuiConfiguration:"Restore GUI configuration",restoreGuiConfiguration_selectFiles:"Restore GUI configuration - select files",restoreGuiConfigTables:"Restore GUI configuration tables",restoreGuiDataTables:"Restore GUI data tables",restoreGuiConfigTables_selectTables:"Restore GUI configuration tables - select tables",restoreGuiDataTables_selectTables:"Restore GUI data tables - select tables",problemsInTables:"MySQL schema problems",updateTablesSchema:"MySQL schema update",generateDebugLog:"Generate debug log"}},rtpStreamAnalysis:{column:{packet:"packet","time [s]":"time [s]","rtp ts [s]":"rtp ts [s]",seq:"seq","delta [ms]":"delta [ms]","transit [ms]":"transit [ms]","skew [ms]":"skew [ms]",jitter:"jitter",marker:"marker","bad seq":"bad seq","mos 50":"mos 50","mos 200":"mos 200","mos adapt":"mos adapt","mos silence":"mos silence","payload len":"payload len",codec:"codec",energylevel:"energy"},columnTip:{packet:"","time [s]":"","rtp ts [s]":"",seq:"","delta [ms]":"","transit [ms]":"","skew [ms]":"",jitter:"",marker:"","bad seq":"","mos 50":"","mos 200":"","mos adapt":"","mos silence":"","payload len":"",codec:""},field:{directUpdateCharts:"update chart position during scrolling"},button:{createAudio:"create audio",audio:"audio",undock:"undock",close:"close",nextStream:"next stream"},menu:{openInNewWindow:"open in new window",openInDock:"open in dock"},combomenu:{spectrogram:"spectrogram",wave:"wave","spectrogram & wave":"spectrogram & wave"},text:{findNext:"find next",notFound:"not found"},title:{rtpStreamAnalysis:"RTP stream analysis",tree:"tree",payload:"payload",chart:"Full time range - click on chart to navigate to specific packet.",zoom_chart:"Zoomed range - click on chart to navigate to specific packet.",one_chart:"click on chart to navigate to specific packet"}},pcapTools:{column:{id:"id",calldate:"calldate",caller:"caller",called:"called",error:"error"},text:{errors_missingPcaps:"errors / missing pcaps",questionContinue:"continue?"}},otherTables:{column:{code:"code",custom_code:"custom code",name:"name",country_name:"country",main_currency:"main",exchange_rate:"exchange rate"},field:{code:"Code",custom_code:"Custom code",name:"Name",country_code:"Country",main_currency:"Main currency",exchange_rate:"Exchange rate",daily_update:"Daily update",description:"Description"},button:{loadExchangeRate:"load exchange rate"}},collectd:{field:{module:"module",from:"from",to:"to"}},sensors:{column:{enable:"enable",is_server:"Is server for<br>client/server mode",default_for_active_call:"Default for<br>active call",auto_upgrade:"Auto<br>upgrade",version:"Version",uid:"user id",user_name:"user name",state:"state",confirmed:"confirmed",time:"time",id_sensor:"sensor",type:"type",message:"message"},field:{id_sensor:"Sensor ID",name:"Name",managerIp:"Manager IP",managerPort:"Port",read_timeout:"Read timeout",color_background:"Background Color",color_chart:"Chart Color",is_server:"Is server for client/server mode",all_clients_in_active_calls:"Show calls from all clients in active calls",default_for_active_call:"Default for active calls","interface":"Interface",tcpdump_folder:"Folder",tcpdump_mount_folder:"Mount folder",from:"from",to:"to",newItem:"new {0} item",level:"level",showDefaultItems:"show default items",override_international_rules:"override international rules",override_country_prefixes:"override country prefixes / rules",auto_upgrade:"Enable auto upgrade",auto_upgrade_at:"Run at time",auto_upgrade_week_days:"Only in days",auto_upgrade_email:"Send resume to"},title:{sensors:"Sensors",tcpdumpParameters:"tcpdump parameters",sensorGraphs:"sensor graphs",sensorLiveSniffers:"active live sniffing",sensorConfiguration:"sensor configuration",addItem:"add new {0} item",suffixDirectConfiguration:"direct configuration",suffixDatabaseConfiguration:"database configuration",newSensorLogs:"new sensor logs",sublogs:"sublogs",upgradeSensor:"Upgrading sensor {0} to version {1}",upgradeSensors:"Upgrading sensors {0} to version {1}",basicData:"basic data",internationalRules:"international rules",countryPrefixes:"country rules",autoUpgrade:"upgrade"},text:{duplicityItemPrefix:"duplicity",deleteItemPrefix:"delete",applyNewConfigurationOnSensor:"apply new configuration on sensor",valueHasChanged:"value has changed",valueIsRemoved:"value is removed from database (or active run) and return to value in base configuration",valueIsSetInConfiguration:"value is set in base configuration",valueIsSetInDatabase:"value is set in database",valueIsSetInActiveRun:"value is set in active run",incorrectHostIp:"incorrect host IP",sensorIdMustBeUnique:"sensor id must be unique",LsensorIdMustBeGreaterThan0:"sensor id must be greater than 0",betaVersion:"beta version",loadingUpgradeInformation:"Loading upgrade information...",loadingSensors:"Loading sensors...",waitForFirstState:"wait for first state",questionStopSniffing:"Stop sniffing for selected row?"},combo:{levelNormal:"normal",levelAdvanced:"advanced",levelExpert:"expert",levelObsolete:"obsolete"},menu:{databaseConfiguration:"database configuration",directConfiguration:"direct configuration",undoChangeValue:"undo change value",disableValueInDb:"disable value in database and return to value in base configuration",disableValueInJson:"disable value in active run and return to value in base configuration",undoRemoveValue:"undo remove value from database (or active run)",betaVersions:"beta versions"},tbar:{showStatus:"expand status",reloadStatus:"reload status",upgradeAll:"upgrade all",paginator:"paginator",type:"type",showConfirmed:"show confirmed",confirmAll:"confirm all"},tooltip:{restartSensor:"restart sensor",upgradeSensor:"upgrade sensor",upgradeSensorToNewVersion:"upgrade sensor to new version",liveSniffers:"live sniffers",editConfiguration:"edit configuration",graphs:"graphs",stopSniffing:"stop sniffing"},stat:{version:"version",pbStatString:"status",calldateOfLastRecordInSqlDatabase:"calldate of a last record in sql database",timeOfLastSqlQueueRecord:"time of a last sql queue record",pbCountPacketDrop:"#packet&nbsp;drops",uptime:"uptime"}},crontab:{column:{last_run_at:"Last run at"},field:{descr:"Description",enable:"Enabled",type:"Type",type_at:"Schedule",schedule_at:"Schedule at",at_day_of_week:"day of week",at_day_of_month:"day of month",every_day_align:"Day align",time_interval:"Time interval",start_shift_minutes:"Start shift minutes",use_last_record_id:"Use last record id",send_to:"Send to",send_from:"Send from",send_report_to:"Send report to",send_report_from:"Send report from",csv_store_prefix:"CSV name prefix",csv_send_in_attachment:"CSV send in attachment",csv_delete_after_days:"delete CSV after days",note:"Note",cleaning_db_records_enable:"cleaning database",cleaning_db_records_enable_cdr:"cleaning CDR",cleaning_db_records_enable_message:"cleaning Messages",cleaning_sip_pcaps_enable:"cleaning SIP pcaps",cleaning_sip_pcaps_enable_cdr:"cleaning SIP pcaps",cleaning_sip_pcaps_enable_message:"cleaning pcaps",cleaning_rtp_pcaps_enable:"cleaning RTP pcaps",older_than_days:"older than days",enable_delete_records:"enable delete records",enable_delete_pcaps:"enable delete pcaps (for tar = no)",custom_columns_enable:"Custom columns",custom_columns_group_by:"group by",custom_columns_order_by:"order by"},field_custom_columns:{field:"field",header:"header"},field_help:{csv_store_prefix:"for enable set 'Folder for export CSV' in System configuration"},title:{forExperts:"for experts",tabBasicData:"basic data",tabFilterCommon:"filter - common",tabFilterRtp:"filter - RTP",tabFilterDscp:"filter - DSCP",tabFilterFiltersComb:"filter - combination",tabFilterMessage:"filter",tabFilterReg:"filter",crontabScheduler:"Crontab Scheduler",csvExports:"CSV Export",customCleaning:"Custom Auto Cleaning",customCleaningRules:"rules",customCleaningSettings:"settings"},text:{at:"at",customCleaningMainInfo:"This is alternative cleaning method for custom rules which can overload mysql or filesystem. For general cleaning please use maxpool* and cleandatabase options in sniffer configuration which is faster by magnitudes."}},treeArrange:{field:{name:"name"},button:{newFolder:"new folder",renameFolder:"rename folder",removeFolder:"remove folder",renameTemplate_dashboards:"rename dashboard",removeTemplate_dashboards:"remove dashboard"},menu:{inRoot:"in root",inSelected:"in selected"},title:{newFolder:"new folder",renameTemplate_dashboards:"rename dashboard"},text:{deleteSelectedFolderQuestion:"delete selected folder?",deleteSelectedTemplate_dashboardsQuestion:"delete selected dashboard?"}},fields:{column:{CBX_CdrSipIP_hostname:"hostname",CBX_CdrErrCodes:"response",CBX_MessageErrCodes:"response",CBX_MessageSipIP_hostname:"hostname",CBX_cbIpGroups_descr:"description",CBX_cbIpGroups_IP:"ip address",CBX_cbDomainGroups_descr:"description",CBX_cbDomainGroups_domain:"domain",CBX_cbDomainGroups_side:"side",CBX_cbNumberGroups_descr:"description",CBX_cbNumberGroups_number:"number",CBX_cbEmailGroups_descr:"description",CBX_cbEmailGroups_email:"e-mail address",CBX_cbCountryGroups_descr:"description",CBX_cbCountryGroups_country:"country",CBX_cbUaGroups_descr:"description",CBX_cbUaGroups_ua:"user agent",CBX_cbTimePeriod_descr:"description",CBX_trackerStatus_type:"type",CBX_trackerStatus_descr:"description",CBX_trackerCategory_type:"type",CBX_trackerCategory_descr:"descr"},field:{CBX_Codec:"codec",CBX_RegState:"state",CBX_Trunk:"trunk",CBX_Users:"user name",CBX_Groups:"group name",CBX_ScreenPopupProfile:"profile name",CBX_CdrSipUsers:"sip user",CBX_CdrSipIP:"sip IP",CBX_CdrCodecsA:"codec",CBX_CdrErrCodes:"SIP resp.",CBX_MessageErrCodes:"SIP resp.",CBX_MessageSipIP:"sip IP",CBX_MessageCodecsA:"codec",CBX_cbIpGroups:"IP Group",CBX_cbNumberGroups:"Number Group",CBX_cbDomainGroups:"Domain Group",CBX_cbEmailGroups:"E-mail Groups",CBX_cbCountryGroups:"Country Groups",CBX_cbUaGroups:"UA Groups",CBX_cbTimePeriod:"Time periods",CBX_trackerStatus:"status",CBX_trackerCategory:"category",CBX_sensor:"sensor",CBX_cdrCharts:"chart",CBX_messageTypes:"message type"},text:{CBX_sensor_empty:"local sensor",CBX_sensor_all:"ALL"}},login:{username:"Username",login:"Login",rememberMe:"Remember Me",exit:"Exit",password:"Password",cloudToken:"Cloud",pleaseLogin:"Please Log In",pleaseRelogin:"Please enter password for continue",loginButton:"Log In",waitTitle:"Please wait",waitMsg:"Transfering data...",loginSuccess:"Login succesfull",serverUnavailable:"Server unavailable",unknownError:"Unknown error",warning:"Warning",language:"Language",loginFailed:"Incorrect username or password.",code2fa:"2FA Code",selectCloudToken:"please select Cloud"},network:{field:{name:"Name","interface":"Interface",mac_address:"MAC",vlan:"VLAN",vlan_id:"VLAN ID",type:"Type",ip_address:"IP",network_subnet:"Subnet",dhcp_hostname:"Hostname",dhcp_lease_time:"Lease time",dhcp_vendor:"Vendor",network:"Network",network_mask:"Mask",gateway:"Gateway",source_ip:"Source IP",hostname:"Hostname",domain:"Domain",dns_1:"DNS 1",dns_2:"DNS 2",dns_3:"DNS 3",interfaces:"Interfaces"},title:{ipAddressesTab:"IP addresses",routingTab:"Routing",dnsTab:"DNS",network:"Network",bridgeTab:"Bridge network"},button:{restartNetwork:"Restart network"}},svg_paint:{column:{condition_text:"condition",color:"color",text:"text",prefix_count_records:"#recs <= ",prefix_response_time:"#resp >= ",prefix_response_time_2:"#resp T2 >= ",suffix_count_records:"",suffix_response_time:"ms",suffix_response_time_2:"ms"},field:{paintName:"paint",paintNameName:"paint name",privatePaint:"private",showForUsers:"restrict for users",showForGroups:"show for groups",item_1:"item 1",item_2:"item 2",type_condition:"condition type",count_records:"#records <=",response_time:"resp. [ms] >=",response_time_2:"resp. T2 [ms] >=",show_condition_value:"show value",filter_type:"filter type",check_last_minutes:"check only N last minutes",check_period_minutes:"check period",chart_interval:"interval",refresh_period:"refresh period",interval_offset:"interval offset",chart_type:"chart type",selected_items:"selected items"},field_properties:{href:"icon",size_perc:"size [%]",icon_text:"text",fill:"color","font-family":"font","font-size":"font size",stroke:"color","stroke-width":"width","stroke-dasharray":"dasharray","marker-start":"arrow left","marker-end":"arrow right",text_base:"text",width:"width",height:"height",chart_text:"text",chart:"chart",scale_perc:"scale [%]"},button:{newPaint:"new map",selectPaint:"map",savePaint:"save",editPaint:"edit",deletePaint:"delete",urlPaint:"URL",save:"save",cancel:"cancel",exportAs:"export as...",newText:"new text",newLink:"new link",addLink:"add link",newChart:"new chart",cancel:"cancel",deleteItem:"delete item",setWatching:"edit color filter",setChart:"edit chart",add:"add",save:"save",startWatching:"start map",stopWatching:"stop map",scale:"scale",multipleSelect:"multiple select",selectAll:"select all",unselectAll:"unselect all",close:"close"},button_help:{urlPaint:"Show current paint / view URL"},menu:{exportAsSvg:"export as SVG",exportAsPdf:"export as PDF",showWatchingRecords:"show watching records",deleteItem:"delete item",setWatching:"edit color filter",setChart:"edit chart",refreshNow:"refresh now",classicNMUrl:"classic URL",shareNMUrl:"share URL"},text:{clearPaintQuestion:"clear paint?",deletePaintQuestion:"delete paint?",nameIsUsed_OverwriteQuestion:"Name is used. Overwrite?",selectTwoItemsForNewLink:"Select two items for new link and click to buton 'add link'.",deleteRowQuestion:"delete row?",new_text:"new text",new_chart:"new chart",chartRenderInfo:"chart will render only when map is started",missingChartConfiguration:"chart is not yet configured",clickHereForEditChart:"click here for edit chart",deleteSelectedItemQuestion:"delete selected item?"},title:{panel:"Network map",savePaint:"Save paint",editPaint:"Edit paint",addNewLink:"Add new link",setWatching:"edit color filter",setChart:"Edit chart",tabFilter:"filter",tabFilterCommon:"filter - common",tabFilterRtp:"filter - RTP",tabFilterDscp:"filter - DSCP",tabFilterFiltersComb:"filters - combination",selectNewChartType:"Select chart type",multipleSelect:"multiple select",viewUrl:"Show current map / view URL",properties:"properties"},combomenu:{CDR:"CDR",Message:"Message",HTTP:"HTTP",typeCondition_count_records:"number of records",typeCondition_response_time:"response time",typeCondition_response_time_2:"response time T2"},tooltip:{delete_row:"delete"}},gmap:{column:{count_ge:"count >=",color:"color",strokeWidth:"stroke width",fontSize:"font size",fontBold:"bold"},field:{gmapApiInvalidKeyText:"Google Maps API Key is invalid.",gmapApiUndefinedKeyText:"Google Maps API Key is undefined.",gmapApiSetKey:"Please set key",gmapApiSetNewKey:"Please set new key",gmapApiKeyGenerator:"Google Maps API Key generator",gmapApiKey:"Google Maps API Key",search:"search",maxZoom:"max. zoom"},marker:{sip:"SIP (GeoLocation by SIP IP)",geos:"GeoIP (location from SIP header)",geop:"Geo position (from SIP header)"},tbar:{caller_called_by:"src/dst by",centerMarkers:"center markers",loadGeoipData:"load / update geoip data",scale:"items scale",lineColors:"line colors",geoipCustomer:"customer geoIP",refreshInterval:"refresh interval"},button:{add:"add",save:"save",remove:"remove"},title:{map:"map",gmapApiKey:"Google Maps API Key",lineColors:"Line colors",customerGeoIP:"Customer GeoIP",internationalRules:"International rules",activeCallsMap:"Active Calls Map - beta version",selectPositionFromPap:"select position from map"},text:{removeRowQuestion:"remove row?",getPosError_ip_is_private:"The IP address is a reserved IP address (private, multicast, etc.).",getPosError_unknown:"unable to find geological position",download_osm_offline_question:"Download now OpenStreetMap offline tiles?"},tooltip:{delete_row:"delete"},msgbox:{missingKey:"missing key",missingKeyUserId:"missing key / user id",missingKeyText:"Missing key for geolocation portal <b>{portal_name}</b>. Click on YES button if you want to be transfered to {portal_url} page.<br><br><i>The key must be entered at the server side in configuration file 'configuration.php':<br>&nbsp;&nbsp;&nbsp;define('{key_config}', 'your key');</i>",missingKeyUserIdText:"Missing key / user id for geolocation portal <b>{portal_name}</b>. Click on YES button if you want to be transfered to {portal_url} page.<br><br><i>The key and user id must be entered at the server side in configuration file 'configuration.php':<br>&nbsp;&nbsp;&nbsp;define('{key_config}', 'your key');<br>&nbsp;&nbsp;&nbsp;define('{user_id_config}', 'your user id');</i>",invalidKey:"invalid key",invalidKeyUserId:"invalid key / user id",invalidKeyText:"Invalid key for geolocation portal <b>{portal_name}</b>. Check the validity of your key.<br><br><i>The key is entered at the server side in configuration file 'configuration.php':<br>&nbsp;&nbsp;&nbsp;define('{key_config}', 'your key');</i>",invalidKeyUserIdText:"Invalid key / user id for geolocation portal <b>{portal_name}</b>. Check the validity of your key and user id.<br><br><i>The key and user id is entered at the server side in configuration file 'configuration.php':<br>&nbsp;&nbsp;&nbsp;define('{key_config}', 'your key');<br>&nbsp;&nbsp;&nbsp;define('{user_id_config}', 'your user id');</i>",gmapApiInvalidKeyHeader:"Google Maps API Key is invalid",gmapApiUndefinedKeyHeader:"Google Maps API Key is undefined",gmapApiInvalidKeyMessage:"Application need valid Google Maps API Key.",gmapApiUndefinedKeyMessage:"Application need valid Google Maps API Key.",gmapApiContactAdministratorMessage:"Please contact your administrator.",gmapApiNewKeyQuestion:"Do you want to define a key now?",missingDataHeader:"missing data",missingDataText:"Missing local geolocation data. Download data from "+appWeb+"?",obsoleteDataHeader:"obsolete data",obsoleteDataText:"Local geolocation data is obsolete. Download new version of data from "+appWeb+"?",incompleteDataHeader:"incomplete data",incompleteDataText:"Local geolocation data is incomplete. Download data from "+appWeb+"?",missingCoordinatesForPrivHeader:"missing coordinates for private network",missingCoordinatesForPrivText:"missing coordinates for private network",missingCoordinatesForPrivQuestion:"define it?",missingInternationalRulesHeader:"missing international rules",missingInternationalRulesText:"Missing international rules. Contact your administrator.",missingInternationalRulesQuestion:"Missing international rules. Define it?"},comboData:{"number/number":"Source number <--> Destination number","number/ip":"Source number -> Destination IP","ip/number":"Source IP  <-> Destination number","ip/ip":"Source IP <-> Destination IP"}},setting_geoip_customer:{column:{ip:"IP address / network",lat_lng:"coordinates",country_name:"country",descr:"description",note:"note"},field:{ip:"IP address / network",mask:"Network mask",latitude_longitude:"lat/lng",latitude:"latitude",longitude:"longitude",country_code:"country",descr:"description",note:"note"},title:{panel:"Customer GeoIP",ip_network:"IP address / network"}},setting_customer_country_prefix:{column:{prefix_regex:"prefix / regex",country_name:"country",advanced_mode:"adv.mode",international_local:"intern. / local",description:"description"},field:{advanced_mode:"Advanced mode",prefix:"Prefix",country_code:"Country",description:"Description",number_regexp_cond:"Regex condition",number_length_from:"Length >=",number_length_to:"Length <=",trim_prefixes:"list / regex",trim_prefix_length:"length",international_local:"International / Local"},title:{trim_prefix:"trim prefixes",country_prefixes_rules:"country prefixes / rules"},combodata:{international:"international",local:"local"}},"default":{column:{vat:"VAT",username:"user name",file_name:"file",file_size:"size"},field:{vat:"VAT",username:"User name",password:"Password",password_old:"Old password",password_new:"New password",password_new_again:"New password (again)",length_interval_minutes:"Interval [min]",secret:"2FA secret"},field_help:{},title:{resellers:"Resellers",customers:"Customers",changePassword:"Change password",change2FA:"Change 2FA",passwordExpired_changePassword:"Password expired - change password",setupPassword2FA:"Two Factor Authentication (2FA) / password settings",tcpDump:"TCP dump",userConfiguration:"User configuration"},grid:{newRec:"New",editRec:"Edit",deleteRec:"Delete",removeRec:"Remove",propertiesRec:"Properties",subject:"record","export":"export","import":"import",table:"table",copyToClipboard:"copy to clipboard",actualCell:"actual cell",actualRow:"actual row",selectionRow:"selection row",selectionRows:"selection rows",tableIsEmpty:"table is empty",alertNotAllStoreOkHeader:"Warning",alertNotAllStoreOkText:"All Stores is not complete",quickSearch:"quick search",paginator:"navigation",storeTimeoutHeader:"request timeout",storeTimeoutSimpleText:"The request timeout.",storeTimeoutText:"The request timeout after {0} seconds. Possible reasons - server is overloaded or not powerful enough to serve the request. The query was:",storeTimeoutWithoutQueryText:"The request timeout after {0} seconds. Possible reasons - server is overloaded or not powerful enough to serve the request.",reload:"reload",newIpLookup:"New IP lookup record",addIpLookup:"Add IP lookup record",editIpLookup:"Edit IP lookup record"},combo:{select:"select",multiselect:"multiselect",selectedItems_clickToRemove:"selected items - click to remove",listOfAvailableItems:"list of available items"},needEqPasswordNewAgainText:"new password again must be the same with new password",needDiffPasswordNewOld:"new password must be different than your old pasword",invalidRegularExpression:"invalid regular expression",invalidIP:"invalid IP",ALL:"ALL",LOCAL:"LOCAL",sensor:"sensor",reloadSniffers:"reload sniffers",filters:"filters",search:"search",from:"from",to:"to",dateRange:"date range",utilities:"utilities",appWelcome:'<h2 style="font-size: 12px; color: #555; padding-bottom: 5px; border-bottom: 1px solid #C3D0DF; width: 267px;">Welcome to the {0} interface</h2>',serverSideError:"server side error - check your http server error log.",errorIsNotSpecified:"connection to the web server was lost / interrupted.",connectionToServerLost:"connection to server lost",requestTimeout:"request timeout",requestAborted:"request aborted",tryingAgaing:"trying again",timezone:"timezone",timezone_os_short:"OS",clickForShowIt:"Click for show it",selectTimezonesFirst:"Select timezones on top right of the panel first!",timezoneIsRequiredField:"Timezone is a required field"},eula:{title:"EULA - "+applName,text:"Please read this end user license agreement (EULA) before agreeing to accept these terms and conditions. You have to accept EULA to use this software.",agreeButton:"agree",doNotAgreeButton:"do not agree"},global:{helpTitle:"Help",helpMainText:"Click on the menu bar displays help.",saveButtonText:"Save",reloadButtonText:"Reload",okButtonText:"OK",closeButtonText:"Close",continueButtonText:"Continue",sendButtonText:"Send",cancelButtonText:"Cancel",previewButtonText:"Preview",skipButtonText:"Skip",restoreButtonText:"Restore",downloadButtonText:"Download",menuButtonText:"Menu",nextButtonText:"Next",prevButtonText:"Prev",finishButtonText:"Finish",error:"Error",info:"Info",information:"Information",requirefield:"Required field",retry:"retry",OK:"OK",FAIL:"FAIL",processing:"processing",failed:"failed",day0:"Monday",day1:"Tuesday",day2:"Wednesday",day3:"Thursday",day4:"Friday",day5:"Saturday",day6:"Sunday",mon1:"January",mon2:"February",mon3:"March",mon4:"April",mon5:"May",mon6:"Jun",mon7:"July",mon8:"August",mon9:"September",mon10:"Oktober",mon11:"November",mon12:"December",newValue_fieldLabel:"new value",editValue_fieldLabel:"edit value",newValue_title:"New value",editValue_title:"Edit value",fileUploadText:"Select file",fileBrowse:"Browse...",confirmText:"Are you sure?",confirmDeleteSingleText:"Do you really want to delete the highlighted item?",confirmDeleteMultipleText:"Do you really want to delete highlighted items?",selectOneOrMoreText:"First select an item or more items to delete!",confirmStopSingleSniffer:"Do you really want to stop running sniffer?",confirmStopMultipleSniffer:"Do you really want to stop running sniffers?",selectOneOrMoreSniffer:"First select an running sniffer or more running sniffers to stop!",confirmRemoveSingleText:"Do you really want to remove the highlighted item?",confirmRemoveMultipleText:"Do you really want to remove highlighted items?",selectOneOrMoreRemoveText:"First select an item or more items to remove!",confirmDeleteTableSingleText:"Do you really want to delete the selected table?",confirmDeleteTableMultipleText:"Do you really want to delete selected tables?",selectOneOrMoreTableText:"First select a table or more tables to delete!",pleaseWait:"Please wait...",longOperationPleaseWait:"Long operation - please wait...",downloadPleaseWait:"Download - please wait...",questionText:"Question",infoText:"Info",warningText:"Warning",errorText:"Error",savingText:"Saving..",uploadingText:"Uploading..",genericResponseErrorText:"The server requests has failed",editRecord:"Edit Record",add:"add",remove:"remove",appHasNoPropertiesText:"This application has no properties.",properties:"Properties",warning:"Warning",cannotDeleteItems:"These items can not be erased",confirmDeleteRuleSingleText:"Do you really want to delete the highlighted item?",confirmDeleteRuleMultipleText:"Do you really want to delete highlighted items?",confirmUnlinkRuleSingleText:"Do you really want to unlink the highlighted item?",confirmUnlinkRuleMultipleText:"Do you really want to unlink the highlighted items?",confirmRemovePasswordRuleSingleText:"Do you really want to remove password from the highlighted item?",confirmRemovePasswordRuleMultipleText:"Do you really want to remove password from the highlighted items?",save:"Save",edit:"Edit",deleteText:"Delete",note:"Note",yes:"Yes",no:"No",stop:"Stop",filter:"filter",note:"Note",saveFirstThanEdit:"First, save the form",importTitleWindow:"Import",batchEditWinTitle:"Bulk edit",maintitleText:"Main menu",checklist:{info:"Information",ipaddress:"IP adresses",iproute:"Default gateway",ipdns:"DNS",ipsmtp:"SMTP",channels:"Trunk channel settings",inroute:"Incomming routing settings",outroute:"Outgoing routing settings",extension:"Extensions",reloadip:"IP network activation",reload:"Settings activation"},alertAjaxSuccessHeader:"Success",alertAjaxErrorHeader:"Request result",alertAjaxErrorMsgUnknown:"Unknown error",alertAjaxFailureHeader:"Request failure",alertAjaxFailureMsgWithStatusCode:"Server side failure with status code: ",alertAjaxFailureMsg:"Server side failure - unknown error",compatibilityProblem:"Compatibility problem",IE_header:"Compatibility problem",IE_msg:"Internet explorer is not fully supported and you may expirience bad rendering behaviour. We recommend to use another web browser like Google chrome, Firefox, Safari, Opera and others.",IE_msg_old:"Internet explorer is supported from version 11.",IE_msg_never_show_again:"never show again",emailSent:"Email sent",restoreDefault:"restore default",restoreDefaultConfirmHeader:"restore default values",restoreDefaultConfirmText:"Really?",msgErrorTitle:"Error",msgSaveQuestionTitle:"Save confirmation",msgSaveQuestionText:"Save changes?",success:"success",clipboard:{copyTo:"copy to clipboard",CopyTo:"Copy to clipboard",copyCellTo:"copy cell to cliboard",CopyCellTo:"Copy cell to cliboard"},reseller:"reseller",resellers:"resellers",customer:"customer",customers:"customers",subsidiary:"subsidiary",subsidiaries:"subsidiaries",newCapture:"new capture",stopCapture:"stop capture",stopCaptureConfirmHeader:"stop capure",stopCaptureConfirmText:"Really?",tcpdumpDeleteConfirmHeader:"delete tcpdump capture file(s)",tcpdumpDeleteFolderConfirmText:"delete time folder",tcpdumpDeletePcapFileConfirmText:"delete pcap file",tcpdumpDeleteConfirmText:"Really?",sensorId:"sensor id",areYouSure:"Are you sure?",upload_selectFileBtn:"Select file ...",callHangedUp:"call hanged up",alertCommandNotFoundHeader:"command {command} not found",alertCommandNotFoundText:'Try:<li style="list-style: disc; margin-left: 20;"><span style="color: blue;">apt-get install {packageAptGet}</span> on Debian or Ubuntu<li style="list-style: disc; margin-left: 20;"><span style="color: blue;">yum install {packageYum}</span> on Red Hat, Cent OS or Fedora',alertCommandPermissionDeniedHeader:"permission denied for run {command}",alertCommandPermissionDeniedText:'Try:<li style="list-style: disc; margin-left: 20;">add suid bit for {command}<li style="list-style: disc; margin-left: 20;">add apache user for {command} into /etc/sudoers',changeLicenseKey:"change license key",setLicenseToken:"set license token",newKey:"new key",licenseInformation:"license information",noLicenseInformation:"no license information",emailForLicenseExpirationAlert:"send license expiration alert to this email",automaticLicenseUpdate:"automatic license update",today:"today",yesterday:"yesterday",currentHour:"current hour",month:"month",week:"week",day:"day",days:"days",dayShort:"d",hour:"hour",hours:"hours",hourShort:"h",hourShort2:"hour",minute:"minute",minutes:"minutes",minuteShort:"m",minuteShort2:"min",second:"second",seconds:"seconds",secondShort:"s",secondShort2:"sec",milisecond:"milisecond",milisecondShort:"ms",year:"year",last:"last",current:"current",previous:"previous",play:"play",pause:"pause",stop:"stop",backward_player:"backward",play_player:"play",pause_player:"pause",stop_player:"stop",forward_player:"forward",togglemute_player:"mute",errorLoadingWavFile:"Error loading wav file",timezoneInformation:"timezone information",serverPhpTimezone:"server php timezone",sensorTimezone:"sensors timezone",sensorTimezoneDisplayText:"For proper function of the program it is necessary to set the time zone on sensors. In case of multiple sensors you need to set the same time zone on each.",recommendedNoSystemDefaultTimezone:"recommended choosing<br>concrete timezone",setTimezone:"set timezone",setSensorTimezone:"set sensors timezone",timezone:"timezone",newVersionGuiInformation:"There is new version of WEB GUI",newVersionGuiAvaialable:"new GUI version available",newVersionSnifferAvaialable:"new sensor version available",loadingNewVersionGuiInformationPleaseWait:"Loading new version changelog - please wait...",upgrade:"upgrade",upgradingPleaseWait:"Upgrading - please wait...",upgradingSensorPleaseWait:"Upgrading sensor {0} - please wait...",upgradeGuiQuestion:"Upgrade GUI to version {0}?",changelog:"changelog",upgradingSensor:"upgrading sensor",toVersion:"to version",restartingSensor:"restarting sensor",checkSensorsVersions:"check sensors versions",applyNewConfigurationToSensor:"apply new configuration to sensor",newVersionHeader:"",newVersionText:"Server application was upgraded - the GUI needs reload to operate correctly.",newVersionSnifferText:"You will be redirected to sensors table where you can upgrade each sensor individually by clicking on upgrade button.",crashOldVersionHeader:"Sensor crash detected",crashOldVersionText:"Crash detected on {0}. Your version is not the latest - would you like to upgrade it to the latest now?",listSensor:"sensor: {0}",listSensors:"sensors: {0}",upgradeSteps:{check_system:"check system",check_init_directory:"check application directory",check_license:"check your license",check_files:"check files privilege in application directory",download_upgrade:"download upgrade file",check_unzip_upgrade:"check unzip upgrade file",upgrade:"upgrade"},upgradeSnifferByGitSteps:{check_git_directory:"check git directory",git_pull:"call git pull",configure:"call configure",make_clean:"call make clean",make:"call make",install:"call make install"},youDoNotHavePermissionToEdit:"You do not have permission to edit",clickMe:"click me",mysqlHasCriticalError:"Your mysql version is buggy and can cause database corruption when upgrading tables with ALTER statements. We recommend to upgrade your MySQL to at least >= 5.5.43 before you proceed with GUI upgrade (through your standard OS packages like yum/apt-get or manually). However this GUI release already contains workaround to not crash old/buggy MySQL versions so you can try the upgrade. <br><br> Would you like to proceed with the upgrade?",failedDeleteRecord_FK:"Record is used in table {0}. You must first delete relational records from table {0}.",wavPlayerError:"wav player error",tryOldPlayer:"try old player",unknown:"unknown",notSet:"not set",reload:"Reload",reloading:"Reloading",columns:{delete_order:"delete / order",and_or_level:"AND / OR level",not:"not",id:"id"},tooltip:{enable:"enable",disable:"disable",moveUp:"move up",moveDown:"move down",edit:"edit","delete":"delete",increase_and_or_level:"increase AND / OR level",decrease_and_or_level:"decrease AND / OR level"},checkSnifferVersionTitle:"check sniffer version",checkSnifferVersionTextTooOld:"Your sniffer version is too old, please upgrade it to the latest version.",checkSnifferVersionUpgradeQuestion:"Run the upgrade now?",preparingBackupGuiTables:"preparing backup of gui tables - please wait",preparingBackupGuiConfiguration:"preparing backup of gui configuration - please wait",backupGuiConfigTablesTitle:"Backup GUI configuration tables",backupGuiDataTablesTitle:"Backup GUI data tables",backupGuiConfigTablesQuestionRun:"This option performs backup of the configuration mysql tables.<br><br><b>Do you want to start backups now?</b><br><br><i>You can also backup / restore via commands:<br><p>&nbsp;&bull;&nbsp;php php/run.php backupGuiTables -t config -f backup.zip<br>&nbsp;&bull;&nbsp;php php/run.php restoreGuiTables -t config -f backup.zip<br><p>or with database parameters<br><p>&nbsp;&bull;&nbsp;php php/run.php backupGuiTables -t config -f backup.zip -h host -u user -p pass -d db --key=keyfile --cert=certificate --cacert=CAcertificate --capath=CAcertificate_path --ciphers=Ciphers<br>&nbsp;&bull;&nbsp;php php/run.php restoreGuiTables -t config -f backup.zip -h host -u user -p pass -d db --key=keyfile --cert=certificate --cacert=CAcertificate --capath=CAcertificate_path --ciphers=Ciphers</i>",backupGuiDataTablesQuestionRun:"This option performs backup of the data mysql tables.<br><br><b>Do you want to start backups now?</b><br><br><i>You can also backup / restore via commands:<br><p>&nbsp;&bull;&nbsp;php php/run.php backupGuiTables -t data -f backup.zip<br>&nbsp;&bull;&nbsp;php php/run.php restoreGuiTables -t data -f backup.zip<br><p>or with database parameters<br><p>&nbsp;&bull;&nbsp;php php/run.php backupGuiTables -t data -f backup.zip -h host -u user -p pass -d db<br> --key=keyfile --cert=certificate --cacert=CAcertificate --capath=CAcertificate_path --ciphers=Ciphers<br>&nbsp;&bull;&nbsp;php php/run.php restoreGuiTables -t data -f backup.zip -h host -u user -p pass -d db --key=keyfile --cert=certificate --cacert=CAcertificate --capath=CAcertificate_path --ciphers=Ciphers</i>",backupGuiConfigurationTitle:"Backup GUI Configuration Files",backupGuiConfigurationQuestionRun:"This option performs backup of the configuration files.<br><br><b>Do you want to start backups now?</b><br><br><i>You can also backup / restore via commands:<br><p>&nbsp;&bull;&nbsp;php php/run.php backupGuiConfigurationFiles -f backup.zip<br>&nbsp;&bull;&nbsp;php php/run.php restoreGuiConfigurationFiles -f backup.zip</i>"},arrays:{LregState_OK:"REGISTER",LregState_Failed:"failed",LregState_UnknownMessageOK:"unknown message",LregState_ManyRegMessages:"too many reg.messages",LregState_Expired:"EXPIRED",LregState_Unregister:"UNREGISTER",LauditActivity_download_wav:"download wav",LauditActivity_download_pcap:"download pcap",LauditActivity_play_wav:"play wav",LauditActivity_show_fax:"show fax",LauditActivity_batch_download:"batch download",LauditActivity_filterFormCDR:"filter CDR in form",LauditActivity_login:"login",LauditActivity_logout:"logout",LauditActivity_liveSnifferStart:"Live sniffer start",LauditActivity_liveSnifferStop:"Live sniffer stop",LemailAlertType_RTP:"RTP & CDR",LemailAlertType_SIP_response:"SIP Response",LemailAlertType_ReasonSipQ850:"Reason SIP / Q.850",LemailAlertType_CPS:"CPS",LemailAlertType_DSCP:"DSCP",LemailAlertType_CALL_TIMEDOUT:"Call Timeout",LemailAlertType_ASR:"ASR",LemailAlertType_NER:"NER",LemailAlertType_ACD:"ACD",LemailAlertType_InternalProxyError:"Internal Proxy Error",LemailAlertType_TimeWithoutCall:"Time without call",LemailAlertType_ConcurrentCalls:"Concurrent calls",LemailAlertType_Sensors:"Sensors",LemailAlertType_Fraud_RCC:"Fraud: realtime concurrent calls",LemailAlertType_Fraud_CHC:"Fraud: change cdr country",LemailAlertType_Fraud_CHCR:"Fraud: change register country",LemailAlertType_Fraud_D:"Fraud: country/continent destination",LemailAlertType_Fraud_SPC:"Fraud: SIP PACKETS flood / attack",LemailAlertType_Fraud_RC:"Fraud: SIP REGISTER flood / attack",LemailAlertType_Fraud_Seq:"Fraud: SEQUENTIAL",LemailAlertType_Fraud_BilingOverQuota:"Watchdog: billing over quota",LemailAlertType_Fraud_BilingHighRate:"Watchdog: billing high rate",LemailAlertType_Register_check_active:"SIP is active REGISTER (beta)",LemailAlertType_Register_unreg:"SIP unREGISTER (beta)",LemailAlertType_Register_failed:"SIP failed REGISTER (beta)",LemailAlertType_Register_ua:"SIP REGISTER user agent (beta)",LemailAlertType_Register_short:"SIP short REGISTRATION (beta)",LemailAlertType_Register_mult:"SIP multiple REGISTER (beta)",LemailAlertType_Register_expire:"SIP REGISTER expire (beta)",LemailAlertType_Register_rrd:"SIP REGISTER RRD (beta)",LemailAlertType_SipMsg_qualify:"SIP Opt/Subsc/Notify Qualify",LemailAlertType_RTP_descr:"Alerts based on RTP metrics or CDR details.",LemailAlertType_SIP_response_descr:"Alerts based on SIP Response like 503 etc.",LemailAlertType_ReasonSipQ850_descr:"Alerts based on Reason SIP or Q.850.",LemailAlertType_CPS_descr:"Calls Per Second or CPS refers to how many telephone calls can be handled in a second. CPS is one measure of the performance of Switching systems. This alert is useful for fraud alerts or switch malfunction",LemailAlertType_DSCP_descr:"Differentiated services or DiffServ is a computer networking architecture that specifies a simple, scalable and coarse-grained mechanism for classifying and managing network traffic and providing quality of service (QoS) on modern IP networks. DiffServ uses a 6-bit differentiated services code point (DSCP) in the 8-bit Differentiated services Field (DS field) in the IP header for packet classification purposes. This alert can be used to check if SIP or RTP uses desired DSCP",LemailAlertType_CALL_TIMEDOUT_descr:"Alerts based on calls which timed-out by the internal timer like absolute timeout (default 4 hours) or timeout due to sudden RTP stop etc.",LemailAlertType_TimeWithoutCall_descr:"Alert monitors the time without any call. It can point to a global problem.",LemailAlertType_ConcurrentCalls_descr:"Alert monitors the count of the concurrent calls.",LemailAlertType_ASR_descr:"The answer-seizure ratio (ASR) is a measurement of network quality and call success rates in telecommunications. It is the percentage of answered telephone calls with respect to the total call volume.",LemailAlertType_NER_descr:"NER has been proposed as an addition toÂ ITUÂ E.411. It is designed to eliminate user behaviour as factor and better represent pure network performance. Its calculated as: (Answers + User Busy + Ring No Answer + Terminal Rejects) / Total call attempts (seizures)",LemailAlertType_ACD_descr:"Alerts based on Average Call Duration.",LemailAlertType_InternalProxyError_descr:"This report searches for calls which did not passed through SIP proxy with some error code. Example - customer called to some destination through SIP proxy which throw error sip respone code 5XX without trying to proxy the call ie. because of database error or any other errors. The way it searches such cases are that it walks all CDR with error response code 5XX (or that one you set) and tryes to search second leg based on SIP custom header (like X-Call-ID) which has the value of Call-ID from original call. It means that you need to support this feature on your SBC/Proxy and define the custom header in GUI->settings->CDR custom headers.",LemailAlertType_Sensors_descr:"Alerts based on sensors metrics like total memory used etc.",LemailAlertType_Fraud_RCC_descr:"This anti-fraud rule (and the purpose is not only for fraud) works in realtime and it is not based on CDR. It tracks each source IP and count number of concurrent call. The advantage of tracking concurrent calls in realtime and not based on CDR is obvious and it helps to compete attacks which creates many channels at the same time with long duration. ",LemailAlertType_Fraud_CHC_descr:"Alert is triggered when the last CDR changes IP source which is in different country or continent since last call. ",LemailAlertType_Fraud_CHCR_descr:"Alert is triggered when the last SIP REGISTRATION for some username changes country or continent since last successful registration.",LemailAlertType_Fraud_D_descr:"Alert is triggered when someone is calling to specific country or continent. This alert is based on first SIP INVITE and not from CDR thus it works in realtime.",LemailAlertType_Fraud_SPC_descr:"Alert is triggered when sniffer detects >= N number of any SIP packets from some IP during set interval.",LemailAlertType_Fraud_RC_descr:"Alert is triggered when sniffer detects >= N number of REGISTER SIP packets from some IP during set interval.",LemailAlertType_Fraud_Seq_descr:"Alert is triggered when sniffer detects >= N number of the calls from specific caller ips to the specific called numbers.",LemailAlertType_Fraud_BilingOverQuota_descr:"Alert is triggered when billing is over set quota",LemailAlertType_Fraud_BilingHighRate_descr:"Alert is triggered when destination costs more then set value",LemailAlertType_Register_check_active_descr:"Alert will be sent if number of total active registrations are below set number or above set number. You can set only min or only max value. You can set individual min/max numbers for various filter criteria.",LemailAlertType_Register_unreg_desr:"Alert will be sent once active registration (phone/pbx) is not registered for specified number of seconds. It will NOT alert if sensor does not know about the registration yet or if device never registers.",LemailAlertType_Register_failed_desr:"Allert will be sent once number of failed SIP registrations exceed specified number during period (5 mintues default). If no filter is set it will count any SIP registration fail.",LemailAlertType_Register_ua_desr:"Alert will be sent once number of SIP registerations with specified user-agent filter reach or exceeds spcified limit during period.",LemailAlertType_Register_short_desr:"Alert will be sent once some device registers and unregisters within specified limit (for example if some device registers for 10 seconds only).  You can also set how many of those short registrations will be within spcified interval to trigger the alert.",LemailAlertType_Register_mult_desr:"Alert will be sent once more than one device registers with the same number.",LemailAlertType_Register_expire_desr:"Alert will be sent once number of expired registrations will exceed specified number. This is useful for watching multiple expired registrations which might signalize faulty SIP proxy / network etc.",LemailAlertType_Register_rrd_desr:"Alert will be sent once Registration Request Delay exceeds threshold. Registration Request Delay is number of seconds between first SIP REGISTER to succesfull 200 OK. Ideally this should be <= 1 second and if it is more it can signalize problems on registration proxy/pbx (overload / db / network issues).",LemailAlertType_SipMsg_qualify_descr:"",LemailDailyReportType_RTP:"RTP",LemailDailyReportType_ProxyDegradMOS:"Proxy MOS degradation",LemailDailyReportType_CdrSummary:"CDR Summary",LemailDailyReportType_ConcurrentCallStat:"Concurrent Calls",LemailDailyReportType_Chart:"Charts",LemailDailyReportType_ConcurrentCallStat_license_chart:"Concurrent Calls - license chart",LfileFormat_Image_Svg:"SVG",LfileFormat_Image_Png:"PNG",LcdrFieldsCaller:"caller",LcdrFieldsCalled:"called",LcdrFieldsSipIpSrc:"SIP src IP",LcdrFieldsSipIpDst:"SIP dst IP",LcdrFieldsRtpIpSrc:"RTP src IP",LcdrFieldsRtpIpDst:"RTP dst IP",LcdrSideSrc:"source (caller)",LcdrSideDst:"destination (called)",LcdrSideBoth:"both",LsideCaller:"caller",LsideCalled:"called",Ltype_IpOrNumber_ip:"IP",Ltype_IpOrNumber_number:"number",LsipMsg_OPTIONS:"OPTIONS",LsipMsg_SUBSCRIBE:"SUBSCRIBE",LsipMsg_NOTIFY:"NOTIFY",LreqRespDirection_request:"request",LreqRespDirection_response:"response",LreqRespDirection_both:"both",LtypeFraudAlertRule_src_ip__blacklist:"src IP - blacklist",LtypeFraudAlertRule_src_ip__blacklist_countries:"src IP - country blacklist",LtypeFraudAlertRule_src_ip__blacklist_area:"src IP - area blacklist item",LtypeFraudAlertRule_src_ip__change:"src IP - change",LtypeFraudAlertRule_ua__blacklist:"user agent - blacklist item",LtypeFraudAlertRule_dst_num__blacklist:"dst number - blacklist",LtypeFraudAlertRule_dst_num__blacklist_countries:"dst number - country blacklist",LtypeFraudAlertRule_dst_num__blacklist_area:"dst number - contry blacklist",LtypeFraudAlertRule_price__per_call:"dst number - area blacklist item",LtypeFraudAlertRule_price__during_interval:"price during interval",LtypeFraudAlertRule_same_number:"same number",LtypeFraudAlertRule_international_number_limit:"international number limit",LtypeFraudAlertRule_concurrent_calls:"concurrent calls",LIntervalFraudAlertRule_1min:"1 minute",LIntervalFraudAlertRule_5min:"5 minutes",LIntervalFraudAlertRule_15min:"15 minutes",LIntervalFraudAlertRule_hour:"hour",LIntervalFraudAlertRule_day:"day",LIntervalFraudAlertRule_week:"week",LIntervalFraudAlertRule_month:"month",LRegisterAlertListType_none:"none",LRegisterAlertListType_ip_ua:"IP, UA",LcdrGroupBy_sipUsers:"users",LcdrGroupBy_sipIP:"sip IP",LcdrGroupBy_codecs:"codecs",LcdrGroupBy_sipResponse:"last sip response",LcdrGroupBy_sipResponse_bye_code:"last sip response / bye code",LcdrGroupBy_reasonSip:"reason SIP",LcdrGroupBy_reasonQ850:"reason Q.850",LcdrGroupBy_ipGroup:"IP group",LcdrGroupBy_ua:"user agent",LcdrGroupBy_country_number:"country by caller / called number",LcdrGroupBy_country_caller:"country by caller number",LcdrGroupBy_country_called:"country by called number",LcdrGroupBy_country_sip:"country by SIP source / dest. IP",LcdrGroupBy_sipcallerip:"country by SIP source IP",LcdrGroupBy_sipcalledip:"country by SIP destination IP",LmessageGroupBy_sipResponse:"last sip response",LmessageGroupBy_sipIP:"sip IP",LmessageGroupBy_ipGroup:"IP group",LmessageGroupBy_country_number:"country by caller / called number",LmessageGroupBy_country_caller:"country by caller number",LmessageGroupBy_country_called:"country by called number",LmessageGroupBy_country_sip:"country by SIP source / dest. IP",LmessageGroupBy_sipcallerip:"country by SIP source IP",LmessageGroupBy_sipcalledip:"country by SIP destination IP",LtrackerStatusType_Open:"open",LtrackerStatusType_Closed:"closed",LtrackerPriotity_1:"very low",LtrackerPriotity_2:"low",LtrackerPriotity_3:"normal",LtrackerPriotity_4:"high",LtrackerPriotity_5:"very high",LtimeInterval_minute:"minute",LtimeInterval_5minutes:"5 minutes",LtimeInterval_last_5minutes:"last 5 minutes",LtimeInterval_last_15minutes:"last 15 minutes",LtimeInterval_last_30minutes:"last 30 minutes",LtimeInterval_last_60minutes:"last 60 minutes",LtimeInterval_last_120minutes:"last 120 minutes",LtimeInterval_last_180minutes:"last 180 minutes",LtimeInterval_quarter:"quarter",LtimeInterval_hour:"hour",LtimeInterval_this_hour:"this hour",LtimeInterval_last_2hours:"last 2 hours",LtimeInterval_last_3hours:"last 3 hours",LtimeInterval_last_6hours:"last 6 hours",LtimeInterval_last_12hours:"last 12 hours",LtimeInterval_last_24hours:"last 24 hours",LtimeInterval_last_48hours:"last 48 hours",LtimeInterval_last_72hours:"last 72 hours",LtimeInterval_day:"day",LtimeInterval_this_day:"this day",LtimeInterval_last_2days:"last 2 days",LtimeInterval_last_3days:"last 3 days",LtimeInterval_last_7days:"last 7 days",LtimeInterval_last_8days:"last 8 days",LtimeInterval_last_30days:"last 30 days",LtimeInterval_last_60days:"last 60 days",LtimeInterval_last_120days:"last 120 days",LtimeInterval_last_180days:"last 180 days",LtimeInterval_last_360days:"last 360 days",LtimeInterval_week_from_monday:"week from monday",LtimeInterval_week_from_sunday:"week from sunday",LtimeInterval_this_week_from_monday:"this week from monday",LtimeInterval_this_week_from_sunday:"this week from sunday",LtimeInterval_week:"week",LtimeInterval_last_week:"last week",LtimeInterval_month:"month",LtimeInterval_last_month:"last month",LtimeInterval_year:"year",LtimeInterval_last_year:"last year",LtimeInterval_last_hour:"last hour",LtimeInterval_last_2h:"last 2 hours",LtimeInterval_last_3h:"last 3 hours",LtimeInterval_last_8h:"last 8 hours",LtimeInterval_last_24h:"last 24 hours",LtimeInterval_last_2d:"last 2 days",LtimeInterval_last_3d:"last 3 days",LtimeInterval_last_7d:"last 7 days",LtimeInterval_last_8d:"last 8 days",LtimeInterval_last_30d:"last 30 days",LtimeInterval_last_60d:"last 60 days",LtimeInterval_last_90d:"last 90 days",LtimeInterval_this_hour:"this hour",LtimeInterval_today:"today",LtimeInterval_yesterday:"yesterday",LtimeInterval_this_week_from_monday:"this week from monday",LtimeInterval_this_week_from_sunday:"this week from sunday",LtimeInterval_this_month:"this month",LtimeInterval_prev_month:"previous month",LtimeInterval_past_interval_by_schedule_every:"by schedule (every)",LtimeInterval_past_hour:"past hour",LtimeInterval_past_2_hours:"past 2 hours",LtimeInterval_past_3_hours:"past 3 hours",LtimeInterval_past_8_hours:"past 8 hours",LtimeInterval_past_day:"past day",LtimeInterval_past_2_days:"past 2 days",LtimeInterval_past_3_days:"past 3 days",LtimeInterval_past_month:"past month",LtimeInterval_custom:"custom",LtypeChart_TCH_count:"number of calls",LtypeChart_TCH_count_messages:"number of messages",LtypeChart_TCH_count_sip_msg:"number of opt., subsc., notify",LtypeChart_TCH_cps:"calls per sec.",LtypeChart_TCH_cps_messages:"messages per sec.",LtypeChart_TCH_cps_sip_msg:"opt., subsc., notify per sec.",LtypeChart_TCH_minutes:"minutes",LtypeChart_TCH_mos_intervals:"MOS - intervals",LtypeChart_TCH_mos:"MOS min(both)",LtypeChart_TCH_mos_caller_intervals:"MOS Caller - intervals",LtypeChart_TCH_mos_caller:"MOS Caller",LtypeChart_TCH_mos_called_intervals:"MOS Called - intervals",LtypeChart_TCH_mos_called:"MOS Called",LtypeChart_TCH_mos_xr_avg_intervals:"MOS XR avg - intervals",LtypeChart_TCH_mos_xr_avg:"MOS XR avg",LtypeChart_TCH_mos_xr_avg_caller:"MOS XR avg Caller",LtypeChart_TCH_mos_xr_avg_called:"MOS XR avg Called",LtypeChart_TCH_mos_xr_min_intervals:"MOS XR min - intervals",LtypeChart_TCH_mos_xr_min:"MOS XR min",LtypeChart_TCH_mos_xr_min_caller:"MOS XR min Caller",LtypeChart_TCH_mos_xr_min_called:"MOS XR min Called",LtypeChart_TCH_mos_silence_avg_intervals:"MOS Silence avg - intervals",LtypeChart_TCH_mos_silence_avg:"MOS Silence avg",LtypeChart_TCH_mos_silence_avg_caller:"MOS Silence avg Caller",LtypeChart_TCH_mos_silence_avg_called:"MOS Silence avg Called",LtypeChart_TCH_mos_silence_min_intervals:"MOS Silence min - intervals",LtypeChart_TCH_mos_silence_min:"MOS Silence min",LtypeChart_TCH_mos_silence_min_caller:"MOS Silence min Caller",LtypeChart_TCH_mos_silence_min_called:"MOS Silence min Called",LtypeChart_TCH_mos_lqo_caller:"MOS LQO Caller",LtypeChart_TCH_mos_lqo_called:"MOS LQO Called",LtypeChart_TCH_packet_lost_intervals:"packet loss - intervals",LtypeChart_TCH_packet_lost_caller_intervals:"packet loss - caller - intervals",LtypeChart_TCH_packet_lost_called_intervals:"packet loss - called - intervals",LtypeChart_TCH_packet_lost:"packet loss",LtypeChart_TCH_jitter_intervals:"jitter - intervals",LtypeChart_TCH_jitter:"jitter",LtypeChart_TCH_delay:"delay",LtypeChart_TCH_delay_avg:"xÌ„ PDV",LtypeChart_TCH_rtcp_avgjitter_intervals:"rtcp avg jitter - intervals",LtypeChart_TCH_rtcp_avgjitter:"rtcp avg jitter",LtypeChart_TCH_rtcp_maxjitter_intervals:"rtcp max jitter - intervals",LtypeChart_TCH_rtcp_maxjitter:"rtcp max jitter",LtypeChart_TCH_rtcp_avgfr_intervals:"rtcp avg fr - intervals",LtypeChart_TCH_rtcp_avgfr:"rtcp avg fr",LtypeChart_TCH_rtcp_maxfr_intervals:"rtcp max fr - intervals",LtypeChart_TCH_rtcp_maxfr:"rtcp max fr",LtypeChart_TCH_rtcp_avgrtd_intervals:"rtcp avg rtd - intervals",LtypeChart_TCH_rtcp_avgrtd:"rtcp avg rtd",LtypeChart_TCH_rtcp_maxrtd_intervals:"rtcp max rtd - intervals",LtypeChart_TCH_rtcp_maxrtd:"rtcp max rtd",LtypeChart_TCH_acd_avg:"ACD - average",LtypeChart_TCH_acd:"ACD - immediate",LtypeChart_TCH_asr_avg:"ASR - average",LtypeChart_TCH_asr:"ASR - immediate",LtypeChart_TCH_ner_avg:"NER - average",LtypeChart_TCH_ner:"NER - immediate",LtypeChart_TCH_pdd_intervals:"PDD - intervals",LtypeChart_TCH_pdd:"PDD",LtypeChart_TCH_sipResp:"SIP responses - typical",LtypeChart_TCH_sipResponse:"SIP responses - all",LtypeChart_TCH_sipResponse_base:"SIP responses Xxx - all",LtypeChart_TCH_codecs:"codecs - all",LtypeChart_TCH_IP_src:"TOP source IPs",LtypeChart_TCH_IP_dst:"TOP dest IPs",LtypeChart_TCH_domain_src:"TOP source SIP domains",LtypeChart_TCH_domain_dst:"TOP dest SIP domains",LtypeChart_TCH_silence:"silence max(both)",LtypeChart_TCH_silence_caller:"silence caller",LtypeChart_TCH_silence_called:"silence called",LtypeChart_TCH_silence_end:"last silence max(both)",LtypeChart_TCH_silence_end_caller:"last silence caller",LtypeChart_TCH_silence_end_called:"last silence called",LtypeChart_TCH_clipping:"clipped frames max(both)",LtypeChart_TCH_clipping_caller:"clipped frames caller",LtypeChart_TCH_clipping_called:"clipped frames called",LtypeChart_TCH_custom:"customize",LtypeSeries_TCHS_count:"# of calls",LtypeSeries_TCHS_concurrent:"# of concurrent calls",LtypeSeries_TCHS_perc_count:"% of calls",LtypeSeries_TCHS_count_messages:"# of messages",LtypeSeries_TCHS_count_sip_msg:"# of opt., subsc., notify",LtypeSeries_TCHS_cps:"calls per sec.",LtypeSeries_TCHS_cps_messages:"messages per sec.",LtypeSeries_TCHS_cps_sip_msg:"opt., subsc., notify per sec.",LtypeSeries_TCHS_minutes:"minutes",LtypeSeries_TCHS_mos:"MOS min(both)",LtypeSeries_TCHS_mos_caller:"MOS Caller",LtypeSeries_TCHS_mos_called:"MOS Called",LtypeSeries_TCHS_mos_xr_avg:"MOS XR avg (both)",LtypeSeries_TCHS_mos_xr_avg_caller:"MOS XR avg Caller",LtypeSeries_TCHS_mos_xr_avg_called:"MOS XR avg Called",LtypeSeries_TCHS_mos_xr_min:"MOS XR min (both)",LtypeSeries_TCHS_mos_xr_min_caller:"MOS XR min Caller",LtypeSeries_TCHS_mos_xr_min_called:"MOS XR min Called",LtypeSeries_TCHS_mos_silence_avg:"MOS Silence avg (both)",LtypeSeries_TCHS_mos_silence_avg_caller:"MOS Silence avg Caller",LtypeSeries_TCHS_mos_silence_avg_called:"MOS Silence avg Called",LtypeSeries_TCHS_mos_silence_min:"MOS Silence min (both)",LtypeSeries_TCHS_mos_silence_min_caller:"MOS Silence min Caller",LtypeSeries_TCHS_mos_silence_min_called:"MOS Silence min Called",LtypeSeries_TCHS_mos_lqo_caller:"MOS LQO Caller",LtypeSeries_TCHS_mos_lqo_called:"MOS LQO Called",LtypeSeries_TCHS_packet_lost:"packet loss",LtypeSeries_TCHS_packet_lost_caller:"packet loss - caller",LtypeSeries_TCHS_packet_lost_called:"packet loss - called",LtypeSeries_TCHS_jitter:"jitter",LtypeSeries_TCHS_delay:"delay",LtypeSeries_TCHS_delay_avg:"xÌ„ PDV",LtypeSeries_TCHS_rtcp_avgjitter:"rtcp avg jitter",LtypeSeries_TCHS_rtcp_maxjitter:"rtcp max jitter",LtypeSeries_TCHS_rtcp_avgfr:"rtcp avg fr",LtypeSeries_TCHS_rtcp_maxfr:"rtcp max fr",LtypeSeries_TCHS_rtcp_avgrtd:"rtcp avg rtd",LtypeSeries_TCHS_rtcp_maxrtd:"rtcp max rtd",LtypeSeries_TCHS_acd_avg:"ACD - average",LtypeSeries_TCHS_acd:"ACD - immediate",LtypeSeries_TCHS_asr_avg:"ASR - average",LtypeSeries_TCHS_asr:"ASR",LtypeSeries_TCHS_ner_avg:"NER - average",LtypeSeries_TCHS_ner:"NER",LtypeSeries_TCHS_pdd:"PDD",LtypeSeries_TCHS_sipResp:"SIP response",LtypeSeries_TCHS_sipResponse:"SIP responses",LtypeSeries_TCHS_sipResponse_base:"SIP responses Xxx",LtypeSeries_TCHS_codecs:"codecs",LtypeSeries_TCHS_IP_src:"TOP source IPs",LtypeSeries_TCHS_IP_dst:"TOP dest IPs",LtypeSeries_TCHS_domain_src:"TOP source SIP domains",LtypeSeries_TCHS_domain_dst:"TOP dest SIP domains",LtypeSeries_TCHS_silence:"silence max(both)",LtypeSeries_TCHS_silence_caller:"silence caller",LtypeSeries_TCHS_silence_called:"silence called",LtypeSeries_TCHS_silence_end:"last silence max(both)",LtypeSeries_TCHS_silence_end_caller:"last silence caller",LtypeSeries_TCHS_silence_end_called:"last silence called",LtypeSeries_TCHS_clipping:"clipped fr. max(both)",LtypeSeries_TCHS_clipping_caller:"clipped frames caller",LtypeSeries_TCHS_clipping_called:"clipped frames called",LsubtypeSeries_TCHS_all:"total",LsubtypeSeries_TCHS_max:"max",LsubtypeSeries_TCHS_avg:"avg",LsubtypeSeries_TCHS_min:"min",LsubtypeSeries_TCHS_count_perc_short_60:"<60s",LsubtypeSeries_TCHS_count_perc_short_20:"<20s",LsubtypeSeries_TCHS_perc95:"%95",LsubtypeSeries_TCHS_perc99:"%99",LsubtypeSeries_TCHS_intervals:"intervals",LtimeAxis_TA_SECONDS:"seconds",LtimeAxis_TA_MINUTES:"minutes",LtimeAxis_TA_MINUTES_FROM_ACT:"minutes from act",LtimeAxis_TA_5MINUTES:"5 minutes",LtimeAxis_TA_10MINUTES:"10 minutes",LtimeAxis_TA_QUARTER:"quarter",LtimeAxis_TA_QUARTER_FROM_ACT:"quarter from act",LtimeAxis_TA_HOURS:"hours",LtimeAxis_TA_HOURS_FROM_ACT:"hours from act",LtimeAxis_TA_2HOURS:"2 hours",LtimeAxis_TA_2HOURS_FROM_ACT:"2 hours from act",LtimeAxis_TA_DAYS:"days",LtimeAxis_TA_DAYS_FROM_ACT:"days from act",LtimeAxis_TA_WEEKS:"weeks from monday",LtimeAxis_TA_WEEKS_FROM_SUNDAY:"weeks from sunday",LtimeAxis_TA_WEEKS_FROM_ACT:"weeks from act",LtimeAxis_TA_MONTHS:"months",LtimeAxis_TA_MONTHS_FROM_ACT:"months from act",LtimeAxis_TA_YEARS:"years",LtimeAxis_TA_YEARS_FROM_ACT:"years from act",LchartTheme_CdrChart:"base theme",LchartTheme_CdrChartLine:"lines",LchartTheme_CdrChartColumn:"column",LchartTheme_CdrChartLineWithGreySum:"lines (first grey)",LchartTheme_CdrChartArea:"area",LchartLegendPosition_top:"top",LchartLegendPosition_bottom:"bottom",LchartLegendPosition_left:"left",LchartLegendPosition_right:"right",LchartLegendPosition_none:"none",Lsunday:"sunday",Lmonday:"monday",Ltuesday:"tuesday",Lwednesday:"wednesday",Lthursday:"thursday",Lfriday:"friday",Lsaturday:"saturday",LcrontabType_alert:"alert",LcrontabType_report:"report",LcrontabType_create_csv_cdr:"create csv : CDR",LcrontabType_create_csv_message:"create csv : MESSAGES",LcrontabType_create_csv_reg:"create csv : REG",LcrontabTypeAt_every:"every",LcrontabTypeAt_at:"at",LcustomCleaningType_cleaning_cdr:"CDR",LcustomCleaningType_cleaning_message:"MESSAGES",LscreenPopupOn_183x180:"183/180",LscreenPopupOn_200:"200",LscreenPopupOn_183x180_200:"183/180 and 200",LcountryOrContinent_country:"country",LcountryOrContinent_continent:"continent",LarSendAlertReportIf_match:"criteria match",LarSendAlertReportIf_no_match:"no criteria match",LarSendAlertReportIf_both:"both case",LarTypeHoliday_fixed:"fixed",LarTypeHoliday_movable:"movable",LarTypeHoliday_easter_monday:"easter monday",LarTypeHoliday_easter_friday:"easter friday",LsensorGraphsRRD_calls:"number of calls",LsensorGraphsRRD_heap:"buffer usage",LsensorGraphsRRD_SQLq:"sql queue",LsensorGraphsRRD_SQLf:"sql cache files",LsensorGraphsRRD_tCPU:"cpu usage",LsensorGraphsRRD_memusage:"memory usage",LsensorGraphsRRD_loadavg:"load averages",LsensorGraphsRRD_PS:"packet counter",LsensorGraphsRRD_PSS:"SIP packets counter",LsensorGraphsRRD_PSR:"RTP packets counter",LsensorGraphsRRD_PSSR:"SIP register packet counter",LsensorGraphsRRD_PSSM:"SIP message packet counter",LsensorGraphsRRD_PSA:"all packets counter",LsensorGraphsRRD_PSC:"calls counter",LsensorGraphsRRD_speed:"network throughput",LsensorGraphsRRD_drop:"packet drops",LsensorGraphsRRD_tacCPU:"zip compression",LarChart3D_rtp_stat_mosf1_min:"mos f1 min",LarChart3D_rtp_stat_mosf1_avg:"mos f1 avg",LarChart3D_rtp_stat_mosf2_min:"mos f2 min",LarChart3D_rtp_stat_mosf2_avg:"mos f2 avg",LarChart3D_rtp_stat_mosAD_min:"mos adapt min",LarChart3D_rtp_stat_mosAD_avg:"mos adapt avg",LarChart3D_rtp_stat_jitter_max:"jitter max",LarChart3D_rtp_stat_jitter_avg:"jitter avg",LarChart3D_rtp_stat_loss_max:"loss max",LarChart3D_rtp_stat_loss_avg:"loss avg",LarChart3D_rtp_stat_mosf1_min_pretty:"MOS Fixed 50ms MIN",LarChart3D_rtp_stat_mosf1_avg_pretty:"MOS Fixed 50ms AVG",LarChart3D_rtp_stat_mosf2_min_pretty:"MOS Fixed 200ms MIN",LarChart3D_rtp_stat_mosf2_avg_pretty:"MOS Fixed 200ms AVG",LarChart3D_rtp_stat_mosAD_min_pretty:"MOS Adaptive 500ms MIN",LarChart3D_rtp_stat_mosAD_avg_pretty:"MOS Adaptive 500ms AVG",LarChart3D_rtp_stat_jitter_max_pretty:"Jitter MAX",LarChart3D_rtp_stat_jitter_avg_pretty:"Jitter AVG",LarChart3D_rtp_stat_loss_max_pretty:"Packet loss MAX",LarChart3D_rtp_stat_loss_avg_pretty:"Packet loss AVG",LarCdrCustomHeadersSpecialType_max_length_sip_data:"max. length sip data",LarCdrCustomHeadersSpecialType_max_length_sip_packet:"max. length sip packet",LarCdrCustomHeadersSpecialType_max_retransmission_invite:"max. retransmission invite",LarMessageCustomHeadersSpecialType_gsm_dcs:"GSM - DCS",LarMessageCustomHeadersSpecialType_gsm_voicemail:"GSM - Voicemail",LarMessageCustomHeadersSpecialType_max_length_sip_data:"max. length sip data",LarMessageCustomHeadersSpecialType_max_length_sip_packet:"max. length sip packet",LarLogSensorType_debug:"debug",LarLogSensorType_info:"info",LarLogSensorType_notice:"notice",LarLogSensorType_warning:"warning",LarLogSensorType_error:"error",LarLogSensorType_critical:"critical",LarLogSensorType_alert:"alert",LarLogSensorType_emergency:"emergency",LarSs7State_call_setup:"call setup",LarSs7State_in_call:"in call",LarSs7State_completed:"completed",LarSs7State_rejected:"rejected",LarSs7State_canceled:"canceled"}};
function _findLangS(c,b,d,a){if(b&&!d){d=b;
b=null
}return(c&&langS[c]&&langS[c][b]&&langS[c][b][d]||a!=2&&c&&langS[c]&&langS[c][d]||!a&&langS["default"][b]&&langS["default"][b][d]||!a&&langS["default"][d])
}function findLangS(f,d,g,b){var a;
if(Ext.isObject(f)){if(f.main||f.primary||f.secondary){if(f.main||f.primary){a=_findLangS(f.main||f.primary,d,g,b)
}if(!a&&f.secondary){if(Ext.isArray(f.secondary)){for(var c=0;
!a&&c<f.secondary.length;
c++){a=_findLangS(f.secondary[c],d,g,b)
}}else{a=_findLangS(f.secondary,d,g,b)
}}}else{a=_findLangS(null,d,g,b)
}}else{a=_findLangS(f,d,g,b)
}return(a)
}function findLangSd(a,b){return(findLangS(null,a,b))
}function setLang(a){lang=cloneObject(a&&a.global?a.global:langS_En.global);
arLang=cloneObject(a&&a.arrays?a.arrays:langS_En.arrays);
langS=cloneObject(a||langS_En)
}Ext.apply(Ext.Component.prototype,{find:function(c,b){var a=[];
this.items.each(function(d){if(d[c]==b){a.push(d)
}});
return a
},findC:function(c,b,d){var a=[];
this.cascade(function(f){if(f[c||"name"]==b){a.push(f)
}else{if(d&&f.menu){_rsltItem=f.menu.findC(c,b,d);
if(_rsltItem){a.push(_rsltItem)
}}}});
if(a&&a.length){return a[0]
}return(null)
},getFormPanel:function(){var a=this.ownerCt;
while(a){if(a instanceof Ext.form.Panel){return(a)
}a=a.ownerCt
}return(null)
}});
Ext.apply(Ext.panel.Panel.prototype,{getToolbars:function(a){return this.dockedItems&&this.dockedItems.findBy(function(b){return(b.alias=="widget.toolbar"||b.alias=="widget.pagingtoolbar")&&b.dock==a
})
},getTopToolbar:function(){return this.getToolbars("top")
},getBottomToolbar:function(){return this.getToolbars("bottom")
},ajaxSafeLoad:function(a){if(!a){a=this.loader
}if(!a){return
}ajaxSafeRequest({url:a.url,params:a.params,scope:this,isLoader:true,success:function(b,c){this.update(c.responseText);
if(a&&a.success){a.success.call(this)
}},maskEl:a.loadMask?this:null})
},findLangS:function(b,c,a){return(findLangS({primary:this.subsystem,secondary:this.secondarySubsystem},b,c,a))
}});
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,d){for(var b=(d||0),a=this.length;
b<a;
b++){if(this[b]===c){return b
}}return -1
}
}if(!Array.prototype.inArray){Array.prototype.inArray=function(a){return this.indexOf(a)>=0
}
}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")
}
}if(!String.prototype.lpad){String.prototype.lpad=function(c,d){var a=this.toString();
for(var b=a.length;
b<c;
b++){a=d+a
}return(a)
}
}if(!String.prototype.template){String.prototype.template=function(b){var a=new Ext.Template(this.toString());
return(a.apply(b))
}
}if(!Math.deg2rad){Math.deg2rad=function(a){return(a*(2*Math.PI/360))
}
}if(!Math.rad2deg){Math.rad2deg=function(a){return(a/(2*Math.PI/360))
}
}if(!Object.create){Object.create=(function(){function a(){}return function(b){if(arguments.length!=1){throw new Error("Object.create implementation only accepts one parameter.")
}a.prototype=b;
return new a()
}
})()
}if(!("forEach" in Array.prototype)){Array.prototype.forEach=function(c,b){for(var a=0,d=this.length;
a<d;
a++){if(a in this){c.call(b,this[a],a,this)
}}}
}if(!Object.keys){Object.keys=function(c){var b=[];
for(var a in c){if(c.hasOwnProperty(a)){b.push(a)
}}return b
}
}Ext.override(Ext.grid.CellContext,{setRow:function(a){if(Ext.isEmpty(a)){return
}this.callOverridden(arguments)
}});
Ext.override(Ext.view.Table,{getDefaultFocusPosition:function(a){var b=this;
if(a&&!(a.isColumn&&a.cellFocusable!==false&&a.getView()===b)&&a.isTableView&&!a.lastFocused){return(null)
}return(this.callOverridden(arguments))
}});
Ext.override(Ext.form.field.TextArea,{fireKey:function(d){var b=this,a=d.getKey(),c;
if(d.isSpecialKey()&&(b.enterIsSpecial||(a!==d.ENTER||d.hasModifier()))){b.fireEvent("specialkey",b,d)
}if(b.needsMaxCheck&&a!==d.BACKSPACE&&a!==d.DELETE&&!d.isNavKeyPress()&&!b.isCutCopyPasteSelectAll(d,a)){c=b.getValue();
if(c.length>=b.maxLength){d.stopEvent()
}}}});
Ext.override(Ext.dom.Element,{setStyle:function(b,a){if(!this.dom){return
}this.callOverridden(arguments)
}});
Ext.override(Ext.form.field.Picker,{doAlign:function(){if(!this.picker){return
}this.callOverridden(arguments)
}});
__width_ColumnChar=function(a){return(parseInt(1.2*5.2*a+10+0.5))
};
__width_ColumnNum=function(a){return(parseInt(1.2*6.5*a+10+0.5))
};
__width_ColumnDate=70;
__width_ColumnDateTime=116;
__width_ColumnDateTimeMs=140;
__width_ColumnTime=70;
__width_ColumnTimeMs=80;
__width_FieldChar=function(a){return(parseInt(1.2*5.7*a+5+0.5))
};
__width_FieldNum=function(a){return(parseInt(1.2*7.4*a+5+0.5))
};
__width_FieldDate=92;
__width_FieldTime=77;
__width_FieldTimeM=60;
__width_FieldDateTimeM=155;
__width_Label=100;
__width_LabelFieldSeparator=5;
__width_FieldSeparator=4;
__width_Trigger=17;
__width_Scroller=20;
__width_Form=function(b,a){return(b+(Ext.isDefined(a)?a:__width_Label)+__width_LabelFieldSeparator)
};
__width_FormChar=function(b,a){return(__width_Form(__width_FieldChar(a),Ext.isDefined(b)?__width_FieldChar(b):undefined))
};
__width_FormNum=function(b,a){return(__width_Form(__width_FieldNum(a),Ext.isDefined(b)?__width_FieldChar(b):undefined))
};
__width_MarginsRedukFieldSet=11;
__height_Field=22;
__height_FieldLines=function(a){return(__height_Field+(a-1)*(__height_Field-6))
};
__height_FieldSeparator=5;
__height_Form=function(a){return((__height_Field+__height_FieldSeparator)*a)
};
__height_Scroller=20;
__height_MarginsRedukFieldSet=20;
__align_Label="right";
__color_FormBackground="#F0F0F0";
__color_TabGroupBackgroud="#F0F0F0";
__color_PanelBorder="#D0D0D0";
__color_TabPanelBorder="#B5B5B5";
__color_PanelBackgroud="#EAEAEA";
__color_FieldBorder="#B5B8C8";
__color_DisabledBackground="#E6E6E6";
__color_WindowFrame="#E8E8E8";
__color_DashboardBackground="#E1E1E1";
__color_ButtonsBackground="#E1E1E1";
__style_FormBackground=function(a){return(Ext.applyIf(a||{},{"background-color":__color_FormBackground}))
};
__style_RedukFieldSet=function(a){return(Ext.applyIf(a||{},{paddingLeft:5,paddingRight:4,paddingTop:2,paddingBottom:0,marginTop:0,marginBottom:4}))
};
__style_FieldBorder=function(){return({border:"1px solid "+__color_PanelBorder})
};
__style_SubgridBorder=function(){return({"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder})
};
__style_SubgridBorderBottom=function(){return({"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-top":"1px solid "+__color_PanelBorder})
};
__style_SubgridBorderImp=function(){return({"border-left":"1px solid "+__color_PanelBorder+" !important","border-right":"1px solid "+__color_PanelBorder+" !important","border-bottom":"1px solid "+__color_PanelBorder+" !important"})
};
__style_SubgridBorderTop=function(){return({"border-top":"1px solid "+__color_PanelBorder})
};
__format_DateDb="Y-m-d";
__format_TimeDb="H:i:s";
__format_TimeMsDb="H:i:s.u";
__format_DateTimeDb="Y-m-d H:i:s";
__format_DateTimeMsDb="Y-m-d H:i:s.u";
__format_Date="Y-m-d";
__format_Time="H:i:s";
__format_TimeMs="H:i:s.u";
__format_TimeM="H:i";
__format_DateTime="Y-m-d H:i:s";
__format_DateTimeMs="Y-m-d H:i:s.u";
__format_DateTimeM="Y-m-d H:i";
__font_Style="tahoma,arial,verdana,sans-serif";
__font_Grid="normal 11px tahoma,arial,verdana,sans-serif";
__font_Style_Monospace="courier";
__font_Monospace="normal 11px courier";
__tpl_simplyTabPanel=['<tpl if="hasTabGuard">{% this.renderTabGuard(out, values, \'before\'); %}</tpl><div id="{id}-body" data-ref="body" role="presentation" class="{baseBodyCls} {baseBodyCls}-{ui} {bodyCls} {bodyTargetCls}{childElCls}" style="padding-bottom: 0px !important;<tpl if="bodyStyle">{bodyStyle}"</tpl>">{%this.renderContainer(out,values)%}</div><tpl if="hasTabGuard">{% this.renderTabGuard(out, values, \'after\'); %}</tpl><div id="{id}-strip" data-ref="strip" role="presentation" class="{stripCls} {stripCls}-{ui}{childElCls}" style="bottom: 2px; height: 1px;"></div>'];
__keyCode_space=32;
__keyCode_cursLeft=37;
__keyCode_cursRight=39;
__keyCode_delete=46;
__keyCode_backspace=8;
__ip4_regex=/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/;
__ip64_regex=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
__ip4_regex_enable_0=/^(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/;
__extjs_images_path=function(){return("extjs-"+window.extjs_version+"/build/classic/theme-gray/resources/images/")
};
__unit_xPDV="ms";
function setMeasure(){var a=getScrollerWidth();
if(a){__width_Scroller=a;
__height_Scroller=a
}}__wikiUrl=!Ext.isDefined(window.wikiUrl)||wikiUrl;
if(__wikiUrl&&__wikiUrl.match&&!__wikiUrl.match(/\/$/)){__wikiUrl+="/"
}Ext.define("Ext.ux.form.IconCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.iconcombo",initComponent:function(){Ext.apply(this,{listConfig:{iconClsField:this.iconClsField,getInnerTpl:function(){return'<tpl for="."><div class="x-combo-list-item ux-icon-combo-item {'+this.iconClsField+'}">{'+this.displayField+"}</div></tpl>"
}},fieldSubTpl:['<div class="ux-icon-combo-wrap">','<input id="{id}" data-ref="inputEl" type="{type}" {inputAttrTpl}',' size="1"','<tpl if="name"> name="{name}"</tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','{%if (values.maxLength !== undefined){%} maxlength="{maxLength}"{%}%}','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx != null"> tabindex="{tabIdx}"</tpl>','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',"<tpl if=\"ariaEl == 'inputEl'\">",'<tpl foreach="ariaElAttributes"> {$}="{.}"</tpl>',"</tpl>",'<tpl foreach="inputElAriaAttributes"> {$}="{.}"</tpl>',' class="{fieldCls} {typeCls} {typeCls}-{ui} {editableCls} {inputCls}" autocomplete="off"/>',"</div>"],listeners:{scope:this,select:function(){this.setIconCls()
}}});
this.callParent(arguments)
},onRender:function(c,a){this.callParent(arguments);
var d=this.el.down("div.ux-icon-combo-wrap");
if(d){d.applyStyles({position:"relative"});
this.icon=Ext.core.DomHelper.append(d,{tag:"div",style:"position:absolute"})
}var b=this.el.down("input");
if(b){b.addCls("ux-icon-combo-input")
}},setIconCls:function(){if(this.rendered){var a=this.store.findRecord(this.valueField,this.getValue());
if(a){this.icon.className="ux-icon-combo-icon "+a.get(this.iconClsField)
}}else{this.on("render",this.setIconCls,this,{single:true})
}},setValue:function(a){this.callParent(arguments);
this.setIconCls()
}});
Ext.define("Ext.ux.colorpicker.ColorPicker",{extend:"Ext.container.Container",alias:"widget.ux.colorpicker",constructor:function(a){var b=this;
if(!a){a={}
}Ext.applyIf(a,{hsv:{h:0,s:0,v:0},width:350});
a.items=[{xtype:"container",itemId:"cRgb",cls:"x-cp-rgbpicker",items:[{xtype:"container",itemId:"rgbPicker",cls:"x-cp-rgbslider",width:15,height:15}]},{xtype:"container",itemId:"cHue",cls:"x-cp-huepicker",items:[{xtype:"container",itemId:"huePicker",cls:"x-cp-hueslider",width:15,height:15}]},{xtype:"form",itemId:"cForm",border:false,items:[{layout:"vbox",border:false,items:[{layout:"hbox",width:120,border:false,items:[{layout:"anchor",border:false,defaultType:"numberfield",defaults:{labelWidth:10,value:0,minValue:0,maxValue:255,labelSeparator:"",hideTrigger:true,width:50,fieldStyle:{"text-align":"right"}},flex:1,items:[{fieldLabel:"R",itemId:"iRed"},{fieldLabel:"G",itemId:"iGreen"},{fieldLabel:"B",itemId:"iBlue"}]},{width:5,border:false},{layout:"anchor",border:false,defaultType:"numberfield",defaults:{labelWidth:10,value:0,minValue:0,maxValue:255,labelSeparator:"",hideTrigger:true,width:50,fieldStyle:{"text-align":"right"}},flex:1,items:[{fieldLabel:"H",itemId:"iHue",maxValue:360},{fieldLabel:"S",itemId:"iSat"},{fieldLabel:"V",itemId:"iVal"}]}]}]},{layout:"anchor",border:false,defaults:{labelWidth:10,labelSeparator:"",width:70},items:[{xtype:"textfield",fieldLabel:"#",itemId:"iHexa"}]},{height:20,border:false},{xtype:"container",width:30,height:25,itemId:"cSelect",width:98,style:{marginLeft:10}},{height:4,border:false},{xtype:"button",text:a.selectTextBtn||"Select Color",itemId:"bSelect",width:98,style:{marginLeft:10}}],style:{paddingLeft:15,paddingTop:6,padingBottom:6}}];
this.callParent([a])
},afterRender:function(a){var b=this;
b.callParent(arguments);
if(b.value){b.setColor(b.value)
}},initEvents:function(){var a=this;
a.callParent();
a.down("#cRgb").getEl().on("mousedown",a.rgbClick,a);
a.down("#cHue").getEl().on("mousedown",a.hueClick,a);
a.down("#iHexa").on("blur",a.hexaChange,a);
a.down("#iRed").on("blur",a.rgbChange,a);
a.down("#iGreen").on("blur",a.rgbChange,a);
a.down("#iBlue").on("blur",a.rgbChange,a);
a.down("#iHue").on("blur",a.hsvChange,a);
a.down("#iSat").on("blur",a.hsvChange,a);
a.down("#iVal").on("blur",a.hsvChange,a);
a.down("#bSelect").on("click",a.selectClick,a)
},selectClick:function(){var b=this,a;
a=b.down("#cSelect").getEl().getColor("backgroundColor","","");
this.fireEvent("select",this,a.toUpperCase())
},getColor:function(){var b=this,a=b.getHsv();
return hsvToRgb(a.h,a.s,a.v)
},setValue:function(a){this.value=a;
this.setColor(a)
},setColor:function(b){var a=this;
if(a.rendered){b=b.replace("#","");
if(!/^[0-9a-fA-F]{6}$/.test(b)){return
}a.down("#iHexa").setValue(b);
a.hexaChange()
}},selectColor:function(b,a){this.fireEvent("select",this,Ext.get(a).getColor("backgroundColor","",""))
},rgbChange:function(b){var c=this,a=rgbToHsv(c.down("#iRed").getValue(),c.down("#iGreen").getValue(),c.down("#iBlue").getValue());
c.updateMode="rgb";
c.setHsv({h:a[0],s:a[1],v:a[2]});
c.updateColor()
},hsvChange:function(a){var b=this;
b.updateMode="hsv";
b.setHsv({h:b.down("#iHue").getValue(),s:b.down("#iSat").getValue()/100,v:b.down("#iVal").getValue()/100});
b.updateColor()
},hexaChange:function(b){var c=this,a=rgbToHsv(hexToRgb(c.down("#iHexa").getValue()));
c.updateMode="hexa";
c.setHsv({h:a[0],s:a[1],v:a[2]});
c.updateColor()
},hueClick:function(c,a){var b=this;
b.updateMode="click";
b.moveHuePicker(c.getXY()[1]-b.down("#cHue").getEl().getTop())
},rgbClick:function(c,a){var b=this,d=b.down("#cRgb").getEl();
b.updateMode="click";
b.moveRgbPicker(c.getXY()[0]-d.getLeft(),c.getXY()[1]-d.getTop())
},moveHuePicker:function(d){var b=this,a=b.getHsv(),c=b.down("#huePicker").getEl();
a.h=Math.round(360/181*(181-d));
c.setXY([c.getLeft(),b.down("#cHue").getEl().getTop()+d-7],true);
b.updateRgbPicker(a.h);
b.updateColor()
},updateRgbPicker:function(b){var a=this;
a.updateMode="click";
a.updateRgbPickerBackground(b)
},updateRgbPickerBackground:function(b){var a=this;
a.down("#cRgb").getEl().applyStyles({backgroundColor:"#"+rgbToHex(hsvToRgb(b,100,100))})
},moveRgbPicker:function(a,f){var c=this,b=c.getHsv(),d=c.down("#cRgb").getEl();
b.s=c.getSaturation(a);
b.v=c.getVal(f);
c.down("#rgbPicker").getEl().setXY([d.getLeft()+a-7,d.getTop()+f-7],true);
c.updateColor()
},updateColor:function(){var c=this,b=c.getHsv();
var a=hsvToRgb(b.h,b.s,b.v);
if(c.updateMode=="hexa"){c.updateRgbPickerBackground(b.h)
}else{c.down("#iHexa").setValue(rgbToHex(a))
}if(c.updateMode!="rgb"){c.down("#iRed").setValue(a[0]);
c.down("#iGreen").setValue(a[1]);
c.down("#iBlue").setValue(a[2])
}if(c.updateMode!="hsv"){c.down("#iHue").setValue(Math.round(b.h));
c.down("#iSat").setValue(Math.round(b.s));
c.down("#iVal").setValue(Math.round(b.v))
}c.setButtonColor("#cSelect",a);
if(c.updateMode!="click"){var g=c.down("#cRgb").getEl(),f=c.down("#cHue").getEl(),d=c.down("#huePicker").getEl();
d.setXY([d.getLeft(),f.getTop()+c.getHPos(c.down("#iHue").getValue())-7],true);
c.down("#rgbPicker").getEl().setXY([g.getLeft()+c.getSPos(c.down("#iSat").getValue())-7,f.getTop()+c.getVPos(c.down("#iVal").getValue())-7],true)
}},setButtonColor:function(d,a){var b=this,c=Ext.DomQuery;
b.down(d).getEl().applyStyles({background:"#"+rgbToHex(a)})
},getSaturation:function(a){return a/181*100
},getVal:function(a){return(181-a)/181*100
},realToDec:function(a){return Math.min(255,Math.round(a*256))
},getSPos:function(a){return a*181/100
},getVPos:function(a){return 181-(a*181)/100
},getHPos:function(a){return 181-a*(181/360)
},getHsv:function(){return(this.hsv)
},setHsv:function(a){Ext.apply(this.hsv,a)
}});
Ext.define("Ext.ux.colorpicker.ColorPickerField",{extend:"Ext.form.field.Picker",requires:["Ext.ux.colorpicker.ColorPicker"],alias:"widget.colorpickerfield",matchFieldWidth:false,createPicker:function(){var a=this;
return Ext.create("Ext.ux.colorpicker.ColorPicker",{floating:true,focusOnShow:true,baseCls:Ext.baseCSSPrefix+"colorpicker",listeners:{scope:a,select:a.onSelect},selectTextBtn:this.selectTextBtn})
},onSelect:function(a,d){var c=this,b="#"+d;
c.setValue(b);
c.fireEvent("select",c,b);
c.collapse()
},onExpand:function(a){var b=this,c=b.getValue();
b.picker.setValue(b.getValue())
},setValue:function(b){b=aliasColorToHexRgb(b);
var a=this._background?{background:b}:this._color_and_background?{color:b,background:b}:{color:b};
if(this.inputEl){this.inputEl.setStyle(a)
}else{this.setFieldStyle(a)
}this.callParent([b])
},enable:function(a){this.callParent(arguments);
if(this.triggerEl){for(var b=0;
b<this.triggerEl.elements.length;
b++){if(this.triggerEl.elements[b].dom){this.triggerEl.elements[b].dom.style.opacity=1
}}}},disable:function(a){this.callParent(arguments);
if(this.triggerEl){for(var b=0;
b<this.triggerEl.elements.length;
b++){if(this.triggerEl.elements[b].dom){this.triggerEl.elements[b].dom.style.opacity=0.5
}}}}});
Ext.ns("Ext.ux.grid");
Ext.define("Ext.ux.grid.ColumnSortFeature",{extend:"Ext.plugin.Abstract",alias:"plugin.columnSort",init:function(a){var b=this;
var c=a.headerCt;
b.headerCtListeners=c.on({destroyable:true,scope:b,menucreate:b.onMenuCreate})
},onMenuCreate:function(b,a){a.on({beforeshow:this.onMenuBeforeShow,scope:this})
},onMenuBeforeShow:function(f){var g=this.cmp.headerCt;
var b=f.ownerCmp;
var h=b;
var m=null;
var d=null;
for(var k=0;
k<f.items.length;
k++){var a=f.items.get(k);
if(a.text==g.sortAscText||a._text&&a._text==g.sortAscText){m=a
}if(a.text==g.sortDescText||a._text&&a._text==g.sortDescText){d=a
}}if(h.sortBy){var c=[];
for(var k=0;
k<2;
k++){c.push([]);
for(var l in h.sortBy){c[k].push({text:h.sortBy[l],_sortDataIndex:l,_sortDirection:k?"DESC":"ASC",handler:function(n){h.sortDataIndex=n._sortDataIndex;
h.sort()
}})
}}if(m){this.addSortSubmenu(m,c[0])
}if(d){this.addSortSubmenu(d,c[1])
}}else{if(m){this.removeSortSubmenu(m)
}if(d){this.removeSortSubmenu(d)
}}},addSortSubmenu:function(b,a){if(!b._handler){b._handler=b.handler
}if(!b._text){b._text=b.text;
b.setText(b.text+"&nbsp;&nbsp;&nbsp;&nbsp;")
}b.handler=null;
b.hideOnClick=false;
b.setMenu(a);
if(b.arrowEl){b.arrowEl.show()
}else{b.addCls("menu-item-arrow-right")
}},removeSortSubmenu:function(a){if(!a.handler&&a._handler){a.handler=a._handler;
a._handler=null
}if(!a.text&&a._text){a.setText(a._text);
a._text=null
}a.hideOnClick=true;
a.setMenu(null);
if(a.arrowEl){a.arrowEl.hide()
}a.removeCls("menu-item-arrow-right")
}});
Ext.override(Ext.grid.column.Column,{getSortParam:function(){return this.sortDataIndex||this.dataIndex
}});
Ext.ns("Ext.ux.grid");
Ext.define("Ext.ux.grid.column.ColumnWithCheckBox",{extend:"Ext.grid.column.Column",alias:"widget.gridcolumn_chb",renderTpl:'<div id="{id}-titleEl" class="'+Ext.baseCSSPrefix+'column-header-inner"><table class="grid-font" style="width: 100%;"><tr><td style="text-align: {align}"><span id="{id}-textEl" class="'+Ext.baseCSSPrefix+'column-header-text">{text}</span><td></td><tpl if="!menuDisabled"><div id="{id}-triggerEl" class="'+Ext.baseCSSPrefix+'column-header-trigger"></div></tpl></td></tr><tr><td><table class="grid-font"><tr><td style="vertical-align: middle;"><div id="{id}-checkBox"></div></td><td style="vertical-align: middle; padding-left: 3px; padding-top: 2px; color: {checkBoxLabelColor}; font-size: {checkBoxLabelPercSize}%;">{checkBoxLabel}</td></tr></table></td><tr></table></div>{%this.renderContainer(out,values)%}',setPadding:function(){},initRenderData:function(){var a=this;
return Ext.applyIf(a.callParent(arguments),{text:a.text,align:a.align,checkBoxLabel:a.checkBoxLabel,checkBoxLabelColor:a.checkBoxLabelColor||"black",checkBoxLabelPercSize:a.checkBoxLabelPercSize||100,menuDisabled:a.menuDisabled})
},onRender:function(b,a){this.callParent([arguments]);
this.checkBox=new Ext.form.field.Checkbox({renderTo:this.id+"-checkBox",listeners:{scope:this,change:function(d,c){if(this.onCheckBoxChange){this.onCheckBoxChange.call(this,c)
}}}});
this.checkBox.bodyEl.on("click",function(c){c.stopPropagation();
c.stopEvent();
return(false)
})
}});
Ext.define("Ext.ux.form.field.DateTime",{extend:"Ext.form.FieldContainer",mixins:{field:"Ext.form.field.Field"},alias:"widget.datetimefield",layout:"fit",timePosition:"right",dateCfg:{},timeCfg:{},allowBlank:true,initComponent:function(){var a=this;
a.buildField();
a.callParent();
this.dateField=this.down("datefield");
this.timeField=this.down("timefield");
a.initField()
},buildField:function(){this.items={xtype:"container",layout:this.timePosition=="below"?{type:"vbox",align:"right"}:{type:"hbox",align:"middle"},items:[Ext.apply({xtype:"datefield",format:"Y-m-d",width:this.widthDate||__width_FieldDate,allowBlank:Ext.isDefined(this.allowBlankDate)?this.allowBlankDate:this.allowBlank,listeners:{specialkey:this.onSpecialKey,select:this.onSelect,change:this.onChange,afterrender:function(a){if(a.disabled){a.disable()
}},scope:this},disabled:this.disabled,isFormField:false},this.dateCfg),Ext.apply({xtype:"timefield",format:"H:i",margin:this.timePosition=="below"?0:"0 0 0 3",width:this.widthTime||__width_FieldTimeM,allowBlank:this.allowBlank,listeners:{specialkey:this.onSpecialKey,select:this.onSelect,change:this.onChange,scope:this,afterrender:function(a){if(this.timeMarginLeft){a.getEl().setStyle({"margin-left":this.timeMarginLeft=="auto"?__width_FieldDate-__width_FieldTimeM:this.timeMarginLeft})
}if(a.disabled){a.disable()
}}},disabled:this.disabled,isFormField:false},this.timeCfg)]}
},focus:function(){this.callParent();
this.dateField.focus.apply(this.dateField,arguments)
},onSpecialKey:function(b,c){var a=c.getKey();
if(a===c.TAB){if(b==this.dateField){if(c.shiftKey){this.fireEvent("specialkey",this,c)
}}if(b==this.timeField){if(!c.shiftKey){this.fireEvent("specialkey",this,c)
}}}else{if(this.inEditor){this.fireEvent("specialkey",this,c)
}}},onSelect:function(a,b){if(a.xtype=="timefield"&&this.timeField.getValue()&&!this.dateField.getValue()){this.dateField.setValue(date())
}if(this.inEditor){this.fireEvent("select",this,b)
}},onChange:function(b,d,a,c){if(this.inEditor){this.fireEvent("change",this,d,a,c)
}},getValue:function(){var b=null,a=this.dateField.getSubmitValue(),d=this.timeField.getSubmitValue();
if(a){if(d){var c=this.getFormat();
b=Ext.Date.parse(a+" "+d,c);
b.timeDefined=true
}else{b=this.dateField.getValue();
b.timeDefined=false
}}return b
},getValueFromRaw:function(){var b=null,a=this.dateField.getRawValue(),d=this.timeField.getRawValue();
if(a){if(d){var c=this.getFormat();
b=Ext.Date.parse(a+" "+d,c);
b.timeDefined=true
}else{b=this.dateField.rawToValue(a);
b.timeDefined=false
}}return b
},setValue:function(a){if(a&&!(a instanceof Date)){a=dateTime(a)
}else{a=cloneDate(a)
}this.dateField.setValue(a);
if(a instanceof Date){if(this.zeroTimeEmpty&&!a.getHours()&&!a.getMinutes()&&!a.getSeconds()&&!a.timeDefined){this.timeField.setValue(null)
}else{this.timeField.setValue(a)
}}else{this.timeField.setValue(null)
}},getSubmitData:function(){var a=this.getValue();
var b=this.getFormat();
return a?Ext.Date.format(a,b):null
},getFormat:function(){return(this.dateField.submitFormat||this.dateField.format)+" "+(this.timeField.submitFormat||this.timeField.format)
},getErrors:function(){return this.dateField.getErrors().concat(this.timeField.getErrors())
},validate:function(){if(this.disabled){return true
}else{var b=this.dateField.validate();
var a=this.timeField.validate();
return b&&a
}},reset:function(){this.mixins.field.reset();
this.dateField.reset();
this.timeField.reset()
},trimTime:function(){this.setValue(date(this.getValue(),true))
},enable:function(){if(this.dateField){this.dateField.enable()
}if(this.timeField){this.timeField.enable()
}},disable:function(){if(this.dateField){this.dateField.disable()
}if(this.timeField){this.timeField.disable()
}},enableTime:function(a){this.timeField.enable();
if(a){this.dateField.disable()
}},disableTime:function(a){this.timeField.disable();
if(a){this.dateField.disable()
}}});
Ext.ns("Ext.ux.combobox");
Ext.define("Ext.ux.combobox.ComboBoxX",{extend:"Ext.form.ComboBox",alias:"widget.ComboBoxX",constructor:function(f){Ext.applyIf(f,{valueField:"id",displayField:"descr",minChars:3,autoHeight:true,triggerAction:"all",storeAutoLoad:true,style:f&&f._buttonGroup?{marginBottom:"1px !important"}:undefined,fieldStyle:f&&f._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined});
if(!Ext.isDefined(f.widthCh)&&!Ext.isDefined(f.width)){f.width=100
}if(f.fieldLabel=="auto_subsystem"){f.fieldLabel=findLangS(f.subsystem,"field",f.name);
if(!f.helpText){f.helpText=findLangS(f.subsystem,"field",f.name)
}}if(f._buttonGroup||f._noLabel){delete f.fieldLabel
}if(!f.tpl&&f.columns){f.tpl=this.getTemplate(f.columns,f);
if(!f.listConfig){f.listConfig={}
}if(!f.listConfig.minWidth){f.listConfig.minWidth=this.getWidthTable(f.columns)+3+(f.pageSize>0||f._listVertScroller?__width_Scroller:0)
}if(!f._disableFilterField&&f.listConfig.minWidth>180){f.listConfig.xtype="boundlist_toolbar"
}}if(!f.store){var a=f.modelName||f.module;
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:f.recordStruct,idProperty:f.valueField})
}f.store=new Ext.data.Store({storeId:f.storeId?f.storeId+"Store":undefined,model:a,proxy:{type:"ajax",url:f.url+"?"+f.module,actionMethods:"POST",extraParams:Ext.apply({task:"LISTING",module:f.module},f&&f.extraParams||{}),reader:{rootProperty:"results",totalProperty:"total",idProperty:f.valueField},timeout:Ext.Ajax.timeout},pageSize:f.pageSize||-1,remoteSort:Ext.isDefined(f.remoteSort)?f.remoteSort:f.sortField,sorters:f.sortField?{property:f.sortField,direction:f.sortDirection||"ASC"}:undefined,autoLoad:f.storeAutoLoad||f._autoDisableIfEmpty||f._infoEmpty,listeners:{load:function(n,m){if((this._autoDisableIfEmpty||this._infoEmpty)&&!this.lastQuery&&!this.getRawValue()&&(!m||!m.length)){if(this._autoDisableIfEmpty){this.disable();
var l=this.getFormPanel();
if(l&&l._gridForm){l._gridForm.callSetContext(l,null,"_afterautodisablefield")
}}if(this._infoEmpty){this.setEmptyText(this._infoEmpty)
}}if(this._autoDisableIfEmptyHandler){this._autoDisableIfEmptyHandler(this,m)
}},scope:this}});
f.store.proxy.on("exception",onGridStoreException,f.store);
if(f.initStore){k(f.store,f.initStore,f)
}f.store.on("load",function(){k(this.store,this.initStore,f);
if(this._afterLoadStore){this._afterLoadStore(this.store)
}},this);
if(f._multiSelect2){f.storeSelect=new Ext.data.Store({model:a,proxy:{type:"ajax",url:f.url+"?"+f.module,actionMethods:"POST",extraParams:Ext.apply({task:"LISTING",module:f.module},f&&f.extraParams||{}),reader:{rootProperty:"results",totalProperty:"total",idProperty:f.valueField}},autoLoad:false})
}}if(f._editTableButton||f._clearButton){f.triggers={};
if(f._editTableButton){f.triggers.table={cls:"x-form-table-trigger",handler:this.onTableClick,scope:this,weight:-2}
}if(f._clearButton){f.triggers.clear={cls:"x-form-clear-trigger",handler:this.onClearClick,scope:this,weight:-1}
}}this.callParent([f]);
this.on("afterrender",d,this);
this.on("expand",g,this);
this.on("collapse",c,this);
this.on("specialkey",b,this);
this.on("select",h,this);
function d(l){if(this.disabled){this.disable()
}}function g(){if(this.emptyText){if(Ext.supports.Placeholder){this.inputEl.dom.placeholder=""
}else{if(this.emptyText==this.getRawValue()){this.setRawValue(emptyText)
}}this._emptyText=this.emptyText;
this.emptyText=null
}}function c(){if(this._emptyText){this.emptyText=this._emptyText;
this._emptyText=null
}}function b(m,l){if(l.getKey()==l.ENTER){h.call(this,m)
}}function h(l){if(this._gridForm&&this._searchField){var m={};
m[this._searchField]=l.getValue();
this._gridForm.setExtraParams(m,true)
}}function k(m,l,n){if(Ext.isFunction(l)){l(m,n)
}else{if(Ext.isArray(l)){for(var o=0;
o<l.length;
o++){m.add(l[o])
}}}}},setValue:function(a,l){if(this._disableSetValue){return
}if(this._multiSelect2){if(a!==this.lastSetValue){this.lastSetValue=a
}else{return
}if(!Ext.isDefined(a)||a===null||a===0||Ext.isString(a)&&a.trim()===""){this.value=a;
this.setRawValue("");
if(this._pickerSelect){this._pickerSelect.store.removeAll()
}}else{if(Ext.isString(a)){a=a.match(",")?a.split(","):a*1
}if(Ext.isArray(a)){var d=[];
for(var g=0;
g<a.length;
g++){if(a[g]*1){d.push(a[g])
}}a=d
}if(Ext.isArray(a)&&a.length==1){a=a[0]
}var c;
this.value=a;
if(Ext.isNumber(a)){c=a
}else{c=a.join(",");
this.setRawValue(findLangSd("combo","multiselect"))
}this.storeSelect.on("load",function(){if(this._afterLoadStoreSelect){this._afterLoadStoreSelect(this.storeSelect,this.storeSelect.proxy.extraParams._findComboValues)
}if(this.selectRenderer){this.setRawValue(this.selectRenderer(this.storeSelect))
}else{if(Ext.isNumber(this.storeSelect.proxy.extraParams._findComboValues)){if(this.storeSelect.getCount()){var m=this.storeSelect.getAt(0).data[this.displayField];
if(this._stripTags&&m&&Ext.isString(m)){m=m.stripTags()
}this.setRawValue(m)
}else{this.setRawValue("")
}}}if(this.storeSelect.proxy.extraParams._findComboValCount>0){--this.storeSelect.proxy.extraParams._findComboValCount
}if(!this.storeSelect.proxy.extraParams._findComboValCount){delete this.storeSelect.proxy.extraParams._findComboValues;
delete this.storeSelect.proxy.extraParams._findComboValField;
delete this.storeSelect.proxy.extraParams._findComboValCount
}},this,{single:true});
if(this._afterLoadStoreSelect){this.storeSelect.on("load",function(){if(this._afterLoadStoreSelect){this._afterLoadStoreSelect(this.storeSelect,this.value)
}},this)
}this.storeSelect.proxy.extraParams._findComboValues=c;
this.storeSelect.proxy.extraParams._findComboValField=this.valueField;
if(this.storeSelect.proxy.extraParams._findComboValCount){++this.storeSelect.proxy.extraParams._findComboValCount
}else{this.storeSelect.proxy.extraParams._findComboValCount=1
}this.storeSelect.load()
}if(!this._evSelectMode2&&!this._disableEvSelectAfterSetValue){this.fireEvent("select",this)
}return
}if(a){if(Ext.isArray(a)&&a.length){a=a[0]
}if(Ext.isObject(a)&&a.data){a=a.data[this.valueField]
}if(this._textHelper&&Ext.isString(a)){this.setRawValue(a);
this.clearInvalid();
return
}}var h=false;
var f=null;
var b=false;
if(this.valueIsOk(a)){if(this.findRecord(this.valueField,a)){this.setValueOk=true;
h=true
}else{if(this.getDisplayValueFromInitStore(a)){this.setValueOk=true;
f=this.getDisplayValueFromInitStore(a)
}else{if((l||this.store.pageSize<=0)&&!this.initStore&&this.store.getCount()){this.setValueOk=true;
b=true
}else{if(!l){this.store.on("load",function(){delete this.store.proxy.extraParams._findComboVal;
delete this.store.proxy.extraParams._findComboValField;
Ext.defer(function(){this.setValue(a,true);
this._disableSetValueInGlobalOnLoad=false
},100,this)
},this,{single:true});
if(this.store.pageSize>0){this.store.proxy.extraParams._findComboVal=a;
this.store.proxy.extraParams._findComboValField=this.valueField
}this._disableSetValueInGlobalOnLoad=true;
this.store.load();
this.setValueOk=false
}else{this.setValueOk=null;
b=true
}}}}}else{this.setValueOk=true;
b=true
}if(this.setValueOk&&h){var k=this.store.loading;
this.store.loading=false;
Ext.ux.combobox.ComboBoxX.superclass.setValue.call(this,a);
this.store.loading=k
}if(f){this.setRawValue(f)
}if(b){this.setRawValue("")
}},getValue:function(){if(this._multiSelect2){if(!Ext.isDefined(this.value)||this.value===null||this.value===0||Ext.isString(this.value)&&this.value.trim()===""){return(null)
}else{if(Ext.isArray(this.value)){return(this.value.join(","))
}else{return(this.value)
}}}if(this._textHelper){return(this.getRawValue())
}var a=Ext.ux.combobox.ComboBoxX.superclass.getValue.call(this);
if(a){if(Ext.isArray(a)&&a.length){a=a[0]
}if(Ext.isObject(a)&&a.data){a=a.data[this.valueField]
}}return(this.valueIsOk(a)&&(this.getRawValue()||this.store.loading)?a:null)
},numberValueIsOk:function(a){return((this._enableZeroValue||a!=0)&&(this._enableNegativeValue||a>=0)&&a<10000000000&&a>-10000000000)
},valueIsOk:function(a){return(Ext.isNumber(a)&&this.numberValueIsOk(a)||this._stringValue&&Ext.isString(a)&&a.length)
},getDisplayValueFromInitStore:function(c){if(this.initStore&&Ext.isArray(this.initStore)){for(var b=0;
b<this.initStore.length;
b++){if(this.initStore[b][this.valueField]==c){var a=this.initStore[b][this.displayField];
if(this._stripTags&&a&&Ext.isString(a)){a=a.stripTags()
}return(a)
}}}return(null)
},getDisplayValue:function(){var a=this.callParent();
if(this._stripTags&&a&&Ext.isString(a)){a=a.stripTags()
}return(a)
},getSelectRecord:function(){return(this.findRecord(this.valueField,this.getValue()))
},getTemplate:function(h,c){this.completeColumns(h,c);
var d="";
var b="";
var f="";
var g=false;
for(var l=0;
l<h.length;
l++){if(h[l].title){g=true;
break
}}for(var l=0;
l<h.length;
l++){d+="<col width="+h[l].width+">";
if(g){b+="<th>"+h[l].title+"</th>"
}var a;
if(Ext.isArray(h[l].fields)){a="{";
for(var k=0;
k<h[l].fields.length;
k++){a+=h[l].fields[k];
a+=":"+((h[l].renderer?(Ext.isArray(h[l].renderer)?h[l].renderer[k<h[l].renderer.length?k:0]:h[l].renderer):null)||"renderNull");
if(k<h[l].fields.length-1){a+="}<br>{"
}}a+="}"
}else{a="{"+h[l].fields+":"+(h[l].renderer||"renderNull")+"}"
}f+='<td style="text-align: '+(h[l].align?h[l].align:"left")+';padding-top: 0; padding-bottom: 2; padding-left: 2; padding-right: 2;"><div style="'+(h[l]._color?"color:"+h[l]._color+";":"")+(h[l]._bold?"font-weight:bold;":"")+'height: 16;">'+a+"</div></td>"
}var m='<tpl for="."><tpl if="[xindex]==1"><table class="comboBox-menuList" style="table-layout: fixed; text-align: left; width: '+this.getWidthTable(h)+';">';
m+=d;
m+="<tr>";
m+=b;
m+='</tr></tpl><tr class="x-boundlist-item" style="font-size: 11;">';
m+=f;
m+='</tr><tpl if="[xcount-xindex]==0"></table></tpl></tpl>';
return(m)
},completeColumns:function(d,a){for(var c=0;
c<d.length;
c++){if(!d[c].width&&(d[c].widthChar||d[c].widthCh||d[c].widthNum||d[c].widthN)){d[c].width=d[c].widthChar||d[c].widthCh?__width_ColumnChar(d[c].widthChar||d[c].widthCh):__width_ColumnNum(d[c].widthNum||d[c].widthN)
}if(!d[c].title&&!d[c].withoutTitle&&(d[c].titleLang||d[c].fields)){var b=findLangS(a?a.subsystem:this.subsystem,"column",d[c].titleLang||(Ext.isArray(d[c].fields)?d[c].fields[0]:d[c].fields));
if(b){d[c].title=b
}}}},getWidthTable:function(b){var c=0;
for(var a=0;
a<b.length;
a++){c+=b[a].width+6
}return(Math.max(c+5,this.width||0))
},isStoreOk:function(){return(this.setValueOk!==false)
},setBaseParams:function(c,b){var a={task:this.store.proxy.extraParams.task,module:this.store.proxy.extraParams.module};
Ext.apply(a,c);
this.store.proxy.extraParams=a;
if(b){this.store.load()
}},addBaseParam:function(b,a,c){this.store.proxy.extraParams[b]=a;
if(c){this.store.load()
}},removeBaseParam:function(a,b){if(Ext.isDefined(this.store.proxy.extraParams[a])){delete this.store.proxy.extraParams[a]
}if(b){this.store.load()
}},clearStore:function(){this.store.removeAll();
this.lastQuery=null
},refreshValue:function(b){if(!b||!this.getRawValue()){var a=this.getValue();
if(a){this.setValue(a)
}}},onTableClick:function(){if(this._editTablePanel){var a=new this._editTablePanel({width:600,height:500});
var b=new Ext.Window({layout:"fit",items:a,modal:true,title:a._title,closable:true,listeners:{scope:this,close:function(){this.clearStore()
}}});
b.show()
}},onClearClick:function(){if(this._emptyText){this.emptyText=this._emptyText;
this._emptyText=null
}this.setValue(null);
this.fireEvent("select",this,null,null);
if(this.emptyText){this.inputEl.addCls(this.emptyCls)
}if(this.isExpanded&&this.pageSize){this.lastQuery=null;
this.doQuery(this.allQuery,true)
}},onTriggerClick:function(){this.fireEvent("beforetriggeraction",this);
this.callParent();
if(this._multiSelect2){this.adjustPickerPosition()
}},createPicker:function(){if(!this._multiSelect2){return(this.callParent())
}var f=this;
var h=Ext.baseCSSPrefix+"menu";
var c=Ext.apply({xtype:"boundlist",pickerField:f,selModel:{mode:"SINGLE"},ownerCt:f.up("[floating]"),cls:f.el&&f.el.up("."+h)?h:"",store:f.store,displayField:f.displayField,focusOnToFront:false,pageSize:f.pageSize,tpl:f.tpl},f.listConfig,f.defaultListConfig);
var d=f._picker=Ext.widget(c);
var g=Ext.apply({xtype:"boundlist",pickerField:f,selModel:{mode:"SINGLE"},ownerCt:f.up("[floating]"),cls:f.el&&f.el.up("."+h)?h:"",store:f.storeSelect,displayField:f.displayField,focusOnToFront:false,tpl:f.tpl,minHeight:100,maxHeight:150},f.listConfig,f.defaultListConfig);
g.xtype="boundlist";
var b=f._pickerSelect=Ext.widget(g);
f.mon(d.getSelectionModel(),{selectionchange:f._pickerSelectionChange,scope:f});
f.mon(b.getSelectionModel(),{selectionchange:f._pickerSelectSelectionChange,scope:f});
var a=new Ext.container.Container({floating:true,hidden:true,focusOnShow:true,layout:"vbox",items:[{xtype:"panel",border:false,items:[{xtype:"displayfield",value:"<i>"+findLangSd("combo","selectedItems_clickToRemove")+"</i>",style:{marginLeft:5},fieldStyle:{font:__font_Grid,color:"grey",height:"16 !important","min-height":"16 !important"}}],width:d.minWidth,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder}},b,{xtype:"panel",border:false,width:d.minWidth,layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"button",text:findLangSd("combo","select"),iconCls:"icon_ok",handler:this._onSelect,scope:this,style:{marginTop:5,marginBottom:5}}],style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder}},{xtype:"panel",border:false,items:[{xtype:"displayfield",value:"<i>"+findLangSd("combo","listOfAvailableItems")+"</i>",style:{marginLeft:5},fieldStyle:{font:__font_Grid,color:"grey",height:"16 !important","min-height":"16 !important"}}],width:d.minWidth,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder}},d],minWidth:d.minWidth,getNavigationModel:function(){return(d.getNavigationModel())
},getSelectionModel:function(){return(d.getSelectionModel())
},refresh:function(){d.refresh()
},bindStore:function(k){if(!k){d.bindStore(null);
b.bindStore(null)
}},onUnbindStore:function(){d.bindStore(null);
b.bindStore(null)
}});
return a
},adjustPickerPosition:function(){if(this.picker&&this.picker.isVisible()){var k=this.picker.getBox();
var h=this.picker.getPosition();
var g=[k.x,k.y];
var a=this.picker.getHeight();
var f=this.getBox();
var b=[f.x,f.y];
var d=this.getHeight();
var c=0;
if(g[1]+a>Ext.dom.Element.getViewportHeight()){if(b[1]+d<Ext.dom.Element.getViewportHeight()/2){c=b[1]+d;
if(c+a>Ext.dom.Element.getViewportHeight()){c=Ext.dom.Element.getViewportHeight()-a
}}else{c=b[1]-a;
if(c<0){c=0
}}if(h!=c-(g[1]-h[1])){this.picker.setLocalXY(h[0],c-(g[1]-h[1]));
Ext.defer(function(){this.adjustPickerPosition()
},10,this)
}}}},onLoad:function(){this.adjustPickerPosition();
if(!this._multiSelect2){if(this._disableSetValueInGlobalOnLoad){this._disableSetValue=true
}var a=this.callParent();
if(this._disableSetValueInGlobalOnLoad){this._disableSetValue=false
}return(a)
}},_pickerSelectionChange:function(a,b){if(b.length){if(this._pickerSelect.store.findExact(this.valueField,b[0].data.id)<0){this._pickerSelect.store.add(b[0].data)
}this._picker.getSelectionModel().deselectAll()
}},_pickerSelectSelectionChange:function(a,b){if(b.length){this._pickerSelect.store.remove(b[0])
}},_onSelect:function(){this.setValue(this._getMultiSelect2Value());
this.collapse();
if(this._evSelectMode2||this._enableEvSelectAfterSelect){this.fireEvent("select",this)
}},_getMultiSelect2Value:function(){var b=[];
for(var a=0;
a<this._pickerSelect.store.getCount();
a++){b.push(this._pickerSelect.store.getAt(a).data[this.valueField])
}return(b.length>1?b:(b.length==1?b[0]:null))
},addRecord:function(c,b,a,f){if(f){var d=false;
c.each(function(g){if(g.data[this.valueField]==b[this.valueField]){d=true
}},this);
if(d){return
}}if(Ext.isDefined(a)&&a!==null){c.insert(a,b)
}else{c.add(b)
}},startSearchTimeout:function(a){if(this._startSearchTimeout){clearInterval(this._startSearchTimeout);
delete this._startSearchTimeout
}this._startSearchTimeout=setTimeout(Ext.bind(this.doSearch,this,[a]),1000)
},doSearch:function(b){if(this._startSearchTimeout){clearInterval(this._startSearchTimeout);
delete this._startSearchTimeout
}var a=b.getValue();
if(a){this.addBaseParam("query",a,true)
}else{this.removeBaseParam("query",true)
}},expand:function(){this.callParent(arguments);
this.mon(Ext.getDoc(),{mousewheel:this.collapseIf,mousedown:this.collapseIf,scope:this})
},collapse:function(a){this.callParent(arguments);
Ext.getDoc().un("mousewheel",this.collapseIf,this);
Ext.getDoc().un("mousedown",this.collapseIf,this)
},collapseIf:function(a){if(!this.destroyed&&!this.isOwnsEvent(a)){this.collapse()
}},onFocusLeave:function(a){if(this.destroyed||this.isOwnsEvent(a)){return
}this.callParent(arguments)
},isOwnsEvent:function(a){if(!a){return(false)
}if(a.event&&!a.within){a=a.event
}return(this.bodyEl&&a.within(this.bodyEl,false,true)||this.picker&&this.picker.el&&a.within(this.picker.el,false,true)||this.owns(a.target))
},onFieldMutation:function(){if(this._multiSelect2&&!Ext.isDefined(this.lastMutatedValue)){this.lastMutatedValue=""
}this.callParent(arguments)
}});
Ext.define("Ext.ux.combobox.ComboBoxA",{extend:"Ext.form.ComboBox",alias:"widget.ComboBoxA",constructor:function(c){if(Ext.isArray(c.aData)){c.aData={data:c.aData}
}if(!Ext.isDefined(c.aData.fields)){c.aData.fields=["id","descr"]
}if(c.aData&&c.aData.data&&c.aData.data.length&&!Ext.isArray(c.aData.data[0])&&Ext.isString(c.aData.data[0])){var f=[];
for(var d=0;
d<c.aData.data.length;
d++){if(c.aData.descrSubsystem&&c.aData.descrTypeItem){f.push([c.aData.data[d],findLangS(c.aData.descrSubsystem,c.aData.descrTypeItem,c.aData.data[d])])
}else{if(c._aDataDescrIsId){f.push([c.aData.data[d],c.aData.data[d]])
}else{f.push([c.aData.data[d]])
}}}c.aData.data=f
}Ext.applyIf(c,{valueField:c.aData.fields[0],displayField:c.aData.fields[1],tpl:c._tpl||c.aData.fields.inArray("qtip")?'<tpl for="."><tpl if="[id]==\'-\'"><div class="x-boundlist-item" style="padding: 0; padding-bottom: 7; margin: 0; height: 2; border: 0; cursor: default; background-color: white;"><hr/></div></tpl><tpl if="[id]!=\'-\'"><div class="x-boundlist-item"'+(c.aData.fields.inArray("qtip")?' data-qtip="{qtip}"':"")+">"+(c._tpl||"{descr}")+"</div></tpl></tpl>":undefined,editable:false,mode:"local",triggerAction:"all",forceSelection:true,selectOnFocus:c.editable,style:c&&c._buttonGroup?{marginBottom:"1px !important"}:undefined,fieldStyle:c&&c._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined});
if(c._buttonGroup){delete c.fieldLabel
}if(c._clearButton){c.triggers={};
if(c._clearButton){c.triggers.clear={cls:"x-form-clear-trigger",handler:this.onClearClick,scope:this,weight:-1}
}}if(!c.store){c.store=new Ext.data.ArrayStore({fields:c.aData.fields,data:c.aFilter?this.getFilteredData(c.aData.data,c.aFilter):c.asFilter?this.getFilteredData(c.aData.data,c.asFilter,true):c.aeFilter?this.getFilteredData(c.aData.data,c.aeFilter,false,null,true):c.aData.data})
}this.callParent([c]);
this.on("afterrender",b,this);
this.on("specialkey",a,this);
this.on("select",g,this);
function b(h){if(this.disabled){this.disable()
}}function a(k,h){if(h.getKey()==h.ENTER){g.call(this,k)
}}function g(k){if(this._gridForm&&this._searchField){var l={};
l[this._searchField]=k.getValue();
this._gridForm.setExtraParams(l,true)
}var h=k.getValue();
Ext.defer(function(){k.oldValue=h
},10)
}},onTriggerClick:function(){if(this._simpleTriggerAction){this.expand()
}else{this.callParent();
var a=this.getValue();
if(Ext.isString(a)&&this._arraySeparator&&a.match(this._arraySeparator)){a=a.split(this._arraySeparator)
}if(this.multiSelect&&this.textAliasAll&&a&&a.length>0&&this.aData&&this.aData.data&&this.aData.data.length==a.length){if(this.picker){++this.suspendCheckChange;
this.suspendEvents();
this.picker.getSelectionModel().selectAll(true);
this.resumeEvents();
--this.suspendCheckChange
}this.setRawValue(this.textAliasAll)
}}},onClearClick:function(){if(this._emptyText){this.emptyText=this._emptyText;
this._emptyText=null
}this.collapse();
this.setValue(null);
this.fireEvent("select",this,null,null);
if(this.emptyText){this.inputEl.addCls(this.emptyCls)
}},createPicker:function(){if(this.listConfig&&this.listConfig.maxHeight){var c=this.getBox();
var a=[c.x,c.y];
var b=this.getHeight();
if(a[1]<Ext.dom.Element.getViewportHeight()/2){if(a[1]+b+this.listConfig.maxHeight>Ext.dom.Element.getViewportHeight()){this.listConfig.maxHeight=Ext.dom.Element.getViewportHeight()-a[1]-b
}}else{if(a[1]<this.listConfig.maxHeight){this.listConfig.maxHeight=a[1]
}}}return(this.callParent())
},addMenuItem:function(k,g,h,d){var a=this.store.find(this.valueField,k[this.valueField],0,false,false,true);
if(a>=0){if(g){this.store.data.items[a].data=k
}}else{if(h){this.store.addSorted(k)
}else{if(Ext.isDefined(d)){this.store.insert(d,k)
}else{this.store.add(k)
}}}var l=this.aData.fields.indexOf(this.valueField);
if(l>=0){var f=[];
for(var c=0;
c<this.aData.fields.length;
c++){f.push(k[this.aData.fields[c]])
}var b=-1;
for(var c=0;
c<this.store.proxy.data.length;
c++){if(this.store.proxy.data[c][l]==k[this.valueField]){b=c;
break
}}if(b>=0){if(g){this.store.proxy.data[b]=f
}}else{if(!h&&Ext.isDefined(d)){this.store.proxy.data.splice(d,0,f)
}else{this.store.proxy.data.push(f)
}}}},deleteMenuItem:function(g,h){var f=this.store.find(h||this.valueField,g,0,false,false,true);
if(f>=0){var d=this.store.getAt(f);
this.store.remove(d)
}var a=this.aData.fields.indexOf(h||this.valueField);
if(a>=0){var b=-1;
for(var c=0;
c<this.store.proxy.data.length;
c++){if(this.store.proxy.data[c][a]==g){b=c;
break
}}if(b>=0){this.store.proxy.data.splice(b,1)
}}},deleteAllMenuItems:function(){while(this.store.getCount()){var a=this.store.getAt(0);
this.deleteMenuItem(a.data[this.valueField]);
this.store.remove(a)
}},getValue:function(){var c=this.callParent();
var b=this.getRawValue();
if(this.multiSelect&&this.textAliasAll&&this.aData&&this.aData.data&&this.aData.data.length&&!this.suspendCheckChange){if(c===this.textAliasAll||b===this.textAliasAll){if(this.picker&&this.picker.getSelectionModel().getSelection().length!=this.aData.data.length){++this.suspendCheckChange;
this.suspendEvents();
this.picker.getSelectionModel().selectAll(true);
this.resumeEvents();
--this.suspendCheckChange
}this.setRawValue(this.textAliasAll);
var c=[];
for(var a=0;
a<this.aData.data.length;
a++){c.push(this.aData.data[a][0])
}}else{if(Ext.isArray(c)&&c.length==this.aData.data.length){this.setRawValue(this.textAliasAll)
}}}if(Ext.isArray(c)&&this._arraySeparator){c=c.join(this._arraySeparator)
}return(c)
},setValue:function(c){if(Ext.isArray(c)&&c.length==1&&c[0].data&&c[0].data.id==="-"||c==="-"){return
}if(Ext.isEmpty(c)){if(this._autoSetFirstIfSetEmpty){c=this.store.getAt(0).data.id
}else{if(Ext.isDefined(this._autoSetIfSetEmpty)){c=this._autoSetIfSetEmpty
}}}if(this.multiSelect&&this.textAliasAll&&c===this.textAliasAll&&this.aData&&this.aData.data&&this.aData.data.length){c=[];
for(var b=0;
b<this.aData.data.length;
b++){c.push(this.aData.data[b][0])
}}if(Ext.isString(c)){if(this._arraySeparator&&c.match(this._arraySeparator)){c=c.split(this._arraySeparator);
if(!this._stringValue){for(var b=0;
b<c.length;
b++){c[b]*=1
}}}else{if(String(c*1)==c&&!this._stringValue){c*=1
}}}this.callParent([c]);
if(this.multiSelect&&this.textAliasAll&&c&&c.length>0&&this.aData&&this.aData.data&&this.aData.data.length==c.length){if(this.picker){++this.suspendCheckChange;
this.suspendEvents();
this.picker.getSelectionModel().selectAll(true);
this.resumeEvents();
--this.suspendCheckChange
}this.setRawValue(this.textAliasAll)
}var a=this.getValue();
Ext.defer(function(){this.oldValue=a
},10,this)
},getDisplayValue:function(a){a=a||this.displayTplData;
if(this.multiSelect&&this.textAliasAll&&a&&this.aData&&this.aData.data&&this.aData.data.length==a.length){return(this.textAliasAll)
}return(this.callParent([a]))
},setFirstValue:function(){if(this.store.getCount()){this.setValue(this.store.getAt(0).data[this.valueField])
}else{this.setValue(null)
}},getFilteredData:function(k,g,a,b,c){var h=[];
if(a&&!c){for(var f=0;
f<g.length;
f++){for(var d=0;
d<k.length;
d++){if(k[d][0]==g[f]){h.push(k[d]);
break
}}}}else{for(var f=0;
f<k.length;
f++){if(Ext.isFunction(g)?g(k[f],b):g.isIn(k[f][0])){if(!c){h.push(k[f])
}}else{if(c){h.push(k[f])
}}}}return(h)
},fillData:function(a){this.deleteAllMenuItems();
var f=this.aFilter?this.getFilteredData(this.aData.data,this.aFilter,false,a):this.asFilter?this.getFilteredData(this.aData.data,this.asFilter,true,a):this.aeFilter?this.getFilteredData(this.aData.data,this.aeFilter,false,a,true):this.aData.data;
for(var c=0;
c<f.length;
c++){var d={};
for(var b=0;
b<this.aData.fields.length;
b++){d[this.aData.fields[b]]=f[c][b]
}this.addMenuItem(d)
}}});
Ext.define("Ext.ux.combobox.ComboBoxAT",{extend:"Ext.ux.combobox.ComboBoxA",alias:"widget.ComboBoxAT",constructor:function(a){this.callParent([a])
},onTriggerClick_tree:function(c){if(this._suppress_onTriggerClick){delete this._suppress_onTriggerClick;
return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"treeArrange",params:Ext.encode({subTask:"existsFolder",dataType:this.dataType})},success:function(g){if(g.rslt*1){a.call(this)
}else{b.call(this)
}}});
function b(){if(this.treeIsExpanded){this.treePicker.hide();
this.treeIsExpanded=false
}if(!this.isExpanded){var g=!this.picker;
this.expand();
if(!g){f.call(this)
}d.call(this)
}else{this.collapse()
}}function a(){if(this.isExpanded){this.collapse()
}var g=false;
if(!this.treePicker){this.treePickerContent=new Tools.Tree.Arrange.Template({dataType:"dashboards",animate:false,autoScroll:true,disableTbar:true,disableDD:true,hideEmptyFolders:true,comboBox:true,onClick:function(k,h){if(k.data_id){this.treePicker.hide();
this.treeIsExpanded=false;
this.setValue(k.data_id);
c.onSelect(k.data_id,h)
}},onClickScope:this});
this.treePicker=new Ext.container.Container({floating:true,focusOnShow:true,layout:"fit",items:this.treePickerContent,width:__width_ColumnChar(55),maxHeight:Ext.dom.Element.getViewportHeight()/2,listeners:{scope:this,focusleave:function(h,k){if(this._suppress_focusleave_picker){return
}this._suppress_onTriggerClick=true;
Ext.defer(function(){delete this._suppress_onTriggerClick
},250,this);
this.onFocusLeave()
}}});
g=true
}if(!this.treeIsExpanded){this.treePicker.show();
this.treePicker.el.alignTo(this.triggerWrap);
this.treeIsExpanded=true;
if(!g){d.call(this)
}f.call(this);
this.treeIsExpanded=true
}else{this.treePicker.hide();
this.treeIsExpanded=false
}}function f(){c.loadTemplates()
}function d(){if(this.treePickerContent){this.treePickerContent.reload(true,true,function(){this._suppress_focusleave_picker=true;
Ext.defer(function(){delete this._suppress_focusleave_picker
},500,this)
},this)
}}},onFocusLeave_tree:function(a){this._suppress_onTriggerClick=true;
Ext.defer(function(){delete this._suppress_onTriggerClick
},250,this);
if(this.isExpanded){this.collapse()
}if(this.treeIsExpanded){if(a&&a.event&&!a.within){a=a.event
}if(a&&a.within&&a.within(this.treePicker.el,false,true)){return
}this.treePicker.hide();
this.treeIsExpanded=false
}}});
Ext.define("Ext.ux.combobox.ComboBoxT",{extend:"Ext.form.ComboBox",alias:"widget.ComboBoxT",constructor:function(a){if(a._clearButton){a.triggers={};
if(a._clearButton){a.triggers.clear={cls:"x-form-clear-trigger",handler:this.onClearClick,scope:this,weight:-1}
}}this.callParent([a])
},setValue:function(a,b){this._value=a;
this.setRawValue(b)
},getValue:function(){return(this._value)
},onClearClick:function(){if(this._emptyText){this.emptyText=this._emptyText;
this._emptyText=null
}this.collapse();
this.setValue(null);
this.fireEvent("select",this,null,null);
if(this.emptyText){this.inputEl.addCls(this.emptyCls)
}}});
Ext.define("Ext.ux.combobox.DateField2T",{extend:"Ext.form.DateField",alias:"widget.DateField2T",constructor:function(a){a.triggers={};
a.triggers.date={cls:"x-form-trigger-default",handler:this.onTriggerDefaultClick,scope:this,weight:1};
this.callParent([a])
},onTriggerDefaultClick:function(c){var d=new Ext.menu.Menu(this.t2menu);
var a=[this.el.getLeft(),this.el.getTop()];
var b=this.getSize();
a[0]+=b.width-__width_Trigger-1;
a[1]+=b.height;
d.showAt(a)
}});
Ext.define("Ext.ux.ColorPickerCombo",{extend:"Ext.form.field.Text",alias:"widget.ComboColorPicker",onTriggerClick:function(){var a=this;
picker=Ext.create("Ext.picker.Color",{pickerField:this,ownerCt:this,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,style:{backgroundColor:"white"},listeners:{scope:this,select:function(d,c,b){a.setValue("#"+c);
a.inputEl.setStyle({color:c=="FFFFFF"?"black":c});
picker.hide()
},show:function(c,b){c.getEl().monitorMouseLeave(500,c.hide,c)
}}});
picker.alignTo(a.inputEl,"tl-bl?");
picker.show(a.inputEl)
},setValue:function(b){b=aliasColorToHexRgb(b);
var a=b=="FFFFFF"?"black":b;
if(this.inputEl){this.inputEl.setStyle({color:a})
}this.callParent([b])
}});
Ext.define("Ext.view.BoundListToolbar",{extend:"Ext.view.BoundList",alias:"widget.boundlist_toolbar",initComponent:function(){this.pageSizeOrig=this.pageSize;
this.pageSize=1;
this.callParent(arguments);
this.pageSize=this.pageSizeOrig;
this.on("resize",this.onResize,this)
},createPagingToolbar:function(){if(!this.pickerField.disableFilterField){this.filterField=new Ext.form.field.Text({width:__width_ColumnChar(20),triggers:{clear:{cls:"x-form-clear-trigger",handler:function(){this.filterField.setValue("");
this.filterField.showClearBtn(false);
this.pickerField.doSearch(this.filterField)
},scope:this,hidden:true}},enableKeyEvents:true,listeners:{scope:this,keydown:function(a){this.pickerField.startSearchTimeout(a);
a.showClearBtn(a.getValue())
},keyup:function(a){a.showClearBtn(a.getValue())
},afterrender:function(a){a.showClearBtn(a.getValue())
}},fieldStyle:this.pageSizeOrig?{}:{height:"17 !important","min-height":"17 !important"},showClearBtn:function(a){this.triggers.clear[a?"show":"hide"]()
}})
}this.toolbarItems=[];
if(this.filterField){this.toolbarItems.push({xtype:"tbfill"},{xtype:"displayfield",value:lang.filter+":",fieldStyle:this.pageSizeOrig?{font:__font_Grid,padding:0,marginTop:6}:{font:__font_Grid,padding:0,marginTop:5,height:"17 !important","min-height":"17 !important"}},this.filterField,{xtype:"container",width:this.pageSizeOrig?1:2})
}if(this.pageSizeOrig){this.paginator=Ext.widget("pagingtoolbar",{id:this.id+"-paging-toolbar",pageSize:this.pageSizeOrig,store:this.store,border:false,items:this.toolbarItems,width:this.minWidth});
return(this.paginator)
}else{if(this.toolbarItems.length){return(Ext.widget("toolbar",{id:this.id+"-toolbar",border:false,items:this.toolbarItems,width:this.minWidth}))
}}return(null)
},bindStore:function(a,b){if(this.paginator){this.paginator.bindStore(this.store,b)
}Ext.view.BoundList.prototype.superclass.bindStore.call(this,a,b)
},onResize:function(){this.pickerField.adjustPickerPosition()
},getNavigationModel:function(){return(this.navigationModel)
}});
Ext.define("Ext.ux.form.field.RadioButtonsGroup",{extend:"Ext.form.FieldContainer",alias:"widget.radiobuttonsgroup",constructor:function(b){if(b.items&&Ext.isArray(b.items)){for(var c=0;
c<b.items.length;
c++){if(Ext.isDefined(b.items[c].inputValue)){if(!b.items[c].name){b.items[c].name=b.name+"_radiobutton"
}if(!b.items[c].xtype){b.items[c].xtype="radiofield"
}if(Ext.isDefined(b.value)){b.items[c].checked=b.value==b.items[c].inputValue
}if(!b.items[c].listeners){b.items[c].listeners={}
}if(!b.items[c].listeners.change){b.items[c].listeners.change=a
}}}}Ext.applyIf(b,{isFormField:true});
this.callParent([b]);
var d=this;
function a(g,f){if(f){Ext.defer(function(){d.fireEvent("change",d,g.inputValue)
},100,d)
}}},getName:function(){return(this.name)
},setValue:function(c){for(var a=0;
a<this.items.getCount();
a++){var b=this.items.get(a);
if(Ext.isDefined(b.inputValue)){b.setValue(b.inputValue==c)
}}},getValue:function(){for(var a=0;
a<this.items.getCount();
a++){var b=this.items.get(a);
if(Ext.isDefined(b.inputValue)&&b.getValue()){return(b.inputValue)
}}return(null)
},getSubmitData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},getModelData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},isValid:function(){return(true)
},validate:function(){return(true)
},clearInvalid:function(){},isFileUpload:function(){return(false)
},isDirty:function(){return(false)
}});
/*!
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
;
Ext.ns("Ext.ux.form");
Ext.define("Ext.ux.form.ButtonGroupField",{extend:"Ext.form.field.Text",alias:"widget.ButtonGroupFieldX",constructor:function(a){a=Ext.applyIf(a||{},{width:180,style:a&&a._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:a&&a._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined});
this.callParent([a])
}});
Ext.define("Ext.ux.form.ClearedField",{extend:"Ext.form.field.Text",alias:"widget.ClearedFieldX",constructor:function(a){a=Ext.applyIf(a||{},{triggers:{clear:{cls:"x-form-clear-trigger",handler:this.onClear,scope:this}},width:180,style:a&&a._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:a&&a._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined});
this.callParent([a])
},onClear:function(){this.setValue("")
}});
Ext.define("Ext.ux.form.SearchField",{extend:"Ext.form.field.Text",alias:"widget.SearchFieldX",constructor:function(b){b=Ext.applyIf(b||{},{validationEvent:false,validateOnBlur:false,triggers:{clear:{cls:"x-form-clear-trigger",handler:this.onClear,scope:this,hidden:true},search:{cls:"x-form-search-trigger",handler:this.onSearch,scope:this}},width:180,paramName:"query",style:b&&b._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:b&&b._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined,enableKeyEvents:true,listeners:{keydown:function(d,c){if([__keyCode_space,__keyCode_cursLeft,__keyCode_cursRight,__keyCode_delete,__keyCode_backspace].inArray(c.keyCode)){c.stopPropagation()
}}}});
this.callParent([b]);
this.on("specialkey",a,this);
this.on("blur",this.onSearch,this);
this.hasSearch=this.value;
function a(d,c){if(c.getKey()==c.ENTER){this.onSearch()
}}},onClear:function(){if(this.hasSearch){this.setValue("");
this.showTriggerBtn("clear",false);
this.hasSearch=false;
if(this._gridForm&&(this.onChangeValue||this._searchField)){if(this.onChangeValue){this.onChangeValue.call(this.onChangeValueScope||this._gridForm||this,null)
}else{var b={};
b[this._searchField]="";
this._gridForm.setExtraParams(b,true)
}}else{var a=this.store||this._gridForm&&this._gridForm.store;
if(a){a.proxy.extraParams=a.proxy.extraParams||{};
a.proxy.extraParams[this.paramName]="";
a.loadPage(1)
}}this.lastSearchString=false
}},onSearch:function(){var b=this.getRawValue();
if(b.length<1){this.onClear();
return
}if(b!=this.lastSearchString){this.hasSearch=true;
this.showTriggerBtn("clear",true);
if(this._gridForm&&(this.onChangeValue||this._searchField)){if(this.onChangeValue){this.onChangeValue.call(this.onChangeValueScope||this._gridForm||this,b)
}else{var c={};
c[this._searchField]=b;
this._gridForm.setExtraParams(c,true)
}}else{var a=this.store||this._gridForm&&this._gridForm.store;
if(a){a.proxy.extraParams=a.proxy.extraParams||{};
a.proxy.extraParams[this.paramName]=b;
a.loadPage(1)
}}this.lastSearchString=b
}},showTriggerBtn:function(b,a){this.triggers[b][a?"show":"hide"]()
},setValue:function(a){this.callParent([a]);
this.showTriggerBtn("clear",a);
this.hasSearch=a
}});
Ext.define("Ext.ux.form.SearchDate",{extend:"Ext.form.DateField",alias:"widget.SearchDateX",constructor:function(b){b=Ext.applyIf(b||{},{width:__width_FieldDate,format:__format_Date,style:b&&b._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:b&&b._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined,checkChangeEvents:["blur"]});
this.callParent([b]);
this.on("specialkey",a,this);
this.on("select",c,this);
this.on("change",c,this);
function a(f,d){if(d.getKey()==d.ENTER){c.call(this,f)
}}function c(f){var d=f.rawToValue(f.getRawValue());
if(this._gridForm&&this._searchField){if(!eqDate(d,this._gridForm.getExtraParam(this._searchField))){this._gridForm.setExtraParam(this._searchField,d,true)
}}else{if(this.onSetDate){this.onSetDate.call(this.onSetDateScope||this.scope,f,d)
}}}}});
Ext.define("Ext.ux.form.SearchDate2T",{extend:"Ext.ux.combobox.DateField2T",alias:"widget.SearchDate2TX",constructor:function(b){b=Ext.applyIf(b||{},{width:__width_FieldDate+__width_Trigger,format:__format_Date,style:b&&b._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:b&&b._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined,checkChangeEvents:["blur"]});
this.callParent([b]);
this.on("specialkey",a,this);
this.on("select",c,this);
this.on("change",c,this);
function a(f,d){if(d.getKey()==d.ENTER){c.call(this,f)
}}function c(f){var d=f.rawToValue(f.getRawValue());
if(this._gridForm&&this._searchField){if(!eqDate(d,this._gridForm.getExtraParam(this._searchField))){this._gridForm.setExtraParam(this._searchField,d,true)
}}else{if(this.onSetDate){this.onSetDate.call(this.onSetDateScope||this.scope,f,d)
}}}}});
Ext.define("Ext.ux.form.SearchDateTime",{extend:"Ext.ux.form.field.DateTime",alias:"widget.SearchDateTimeX",constructor:function(b){b=Ext.applyIf(b||{},{dateCfg:{format:__format_Date},timeCfg:{format:__format_TimeM},inEditor:true,style:b&&b._buttonGroup?{marginBottom:"0px !important"}:undefined,checkChangeEvents:["blur"]});
Ext.applyIf(b.dateCfg,{style:b&&b._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:b&&b._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined,checkChangeEvents:["blur"]});
Ext.applyIf(b.timeCfg,{style:b&&b._buttonGroup?{marginBottom:"0px !important"}:undefined,fieldStyle:b&&b._buttonGroup?{height:"17 !important","min-height":"17 !important"}:undefined,checkChangeEvents:["blur"]});
this.callParent([b]);
this.on("specialkey",a,this);
this.on("select",c,this);
this.on("change",c,this);
function a(f,d){if(d.getKey()==d.ENTER){c.call(this,f)
}}function c(f){var d=f.getValueFromRaw();
if(this._gridForm&&this._searchField){if(!eqDate(d,this._gridForm.getExtraParam(this._searchField))){this._gridForm.setExtraParam(this._searchField,d,true)
}}else{if(this.onSetDate){this.onSetDate.call(this.onSetDateScope||this.scope,f,d)
}}}}});
Ext.ns("Ext.ux.grid");
Ext.define("Ext.ux.grid.GridForm",{extend:"Ext.grid.GridPanel",constructor:function(b){if(this.subsystem){if(b){b.subsystem=this.subsystem
}}else{if(b&&b.subsystem){this.subsystem=b.subsystem
}}var h=b.modelName||b.module+"_model";
if(!Ext.ClassManager.isCreated(h)){Ext.define(h,{extend:"Ext.data.Model",fields:b.recordStruct,idProperty:b.keyField||"id"})
}var l={task:"LISTING",module:b.module,relFields:b.relFields?Ext.encode(b.relFields):undefined};
if(b.extraParams){Ext.applyIf(l,b.extraParams)
}if(b.suppressTotal){l.suppressTotal=true
}b.baseExtraParams=cloneObject(l);
if(!b.withoutStore){var k={type:"ajax",url:b.url,actionMethods:"POST",extraParams:l,reader:{rootProperty:"results",totalProperty:"total",idProperty:b.keyField||"id"}};
if(b.proxy_timeout){k.timeout=b.proxy_timeout
}else{k.timeout=Ext.Ajax.timeout
}var o=new Ext.data.Store({storeId:b.storeId?b.storeId+"Store":undefined,model:h,proxy:k,pageSize:b.pageSize||-1,sorters:b.sort||(b.sortField?{property:b.sortField,direction:(b.sortDirection=="desc"||b.sortDirection=="DESC"?"DESC":"ASC")}:undefined),remoteSort:b.remoteSort&&!b.memoryStore,remoteFilter:Ext.isDefined(b.remoteFilter)?b.remoteFilter:b.remoteSort&&!b.memoryStore,groupField:b.groupField,_grid:this,disableLoad:b.disableLoadStore});
o.on("beforeload",a,this);
o.on("load",m,this);
o.on("load_before_renders",q,this);
o.proxy.on("exception",onGridStoreException,o);
if(b.initStoreData){for(var d=0;
d<b.initStoreData.length;
d++){o.add(b.initStoreData[d])
}}else{if(b.enableAutoLoad!==false&&!b.deferredLoad&&(!b.memoryStore||b.relFields)){if(o.proxy.url){o.load()
}}}}if(b.columnsDefaults&&!b.columnsDefaults.width&&(b.columnsDefaults.widthChar||b.columnsDefaults.widthCh||b.columnsDefaults.widthNum||b.columnsDefaults.widthN)){b.columnsDefaults.width=b.columnsDefaults.widthChar||b.columnsDefaults.widthCh?__width_ColumnChar(b.columnsDefaults.widthChar||b.columnsDefaults.widthCh):__width_ColumnNum(b.columnsDefaults.widthNum||b.columnsDefaults.widthN)
}if(b.prefixCls){if(b.prefixCls[b.prefixCls.length-1]=="x"){b.prefixCls+="_"
}}else{b.prefixCls="default"
}if(b.prefixCls){if(!b.columnsDefaults){b.columnsDefaults={}
}b.columnsDefaults.tdCls=(b.columnsDefaults.tdCls?b.columnsDefaults.tdCls+" ":"")+b.prefixCls+"-cell"
}this.completeColumns(b.columns,b.columnsDefaults,b);
if(b.fpDefaults){completeDefaultsFormFields(b.fpDefaults)
}if(b.fpItems||b.fpItemsSrc){if(!b.disableCompleteFormFields){if(b.fpItems&&!Ext.isFunction(b.fpItems)){completeFormFields(b.fpItems,true,b.fpDefaults,b)
}else{if(b.fpItemsSrc){completeFormFields(b.fpItemsSrc,true,b.fpDefaults,b)
}}}}else{b.enableEdit=false
}if((!b.ewConfig||!b.ewConfig.width)&&b.fpDefaults&&b.fpDefaults.width){if(!b.ewConfig){b.ewConfig={}
}if(!b.ewConfig.autoWidth){b.ewConfig.width=b.fpDefaults.width+50
}}var g=(b.stdBar=="bottom"?b.bbar:b.tbar)||[];
if(b.enableEdit){if(!b.disableInsertButton&&b.enableInsert!==false){g.push({scope:this,text:this.newText||(findLangS(b.subsystem,"grid","newRec")==findLangSd("grid","newRec")?(findLangSd("grid","newRec")+" "+findLangS(b.subsystem,"grid",b.subjectLang?"subject_"+b.subjectLang:"subject")):findLangS(b.subsystem,"grid","newRec")),iconCls:"icon_add",menu:b.insertMenu,handler:b.insertMenu?undefined:function(){this.createEditWindow(1)
},_id:"insert"})
}if(!b.disableEditButon){if(g.length&&g[g.length-1]._id!="insert"){g.push("-")
}g.push({disabled:true,scope:this,text:findLangS(this.subsystem,"grid","editRec"),iconCls:"icon_edit",menu:b.editMenu,handler:b.editMenu?undefined:function(){this.editFce?this.editFce.call(this):this.createEditWindow(0)
},_id:"edit"})
}}if((b.enableEdit&&b.enableDelete!==false||b.enableDelete===true)&&!b.disableDeleteButton){if(g.length&&g[g.length-1]._id!="insert"&&g[g.length-1]._id!="edit"){g.push("-")
}g.push({disabled:true,scope:this,text:findLangS(this.subsystem,"grid","deleteRec"),menu:b.deleteMenu,handler:b.deleteMenu?undefined:this.confirmDeleteRule,iconCls:"icon_remove",_id:"remove"})
}if((b.enableExportCsv||b.enableImportCsv)&&typeDb=="mysql"){if(g.length&&!b.withoutSeparatorCsv){g.push("-")
}if(b.enableExportCsv){g.push({scope:this,text:findLangS(this.subsystem,"grid","export"),iconCls:"icon_excel",handler:this.exportToCsv})
}if(b.enableImportCsv){g.push({scope:this,text:findLangS(this.subsystem,"grid","import"),iconCls:"icon_excel_blue",handler:function(){this.importFromCsv()
}})
}}if(b.nextStdBar){if(g.length){g.push("-")
}g=g.concat(b.nextStdBar)
}if(b.enableSearchX&&!b.paginatorPrependButtons){g.push("->",{xtype:"SearchFieldX",store:o,width:100})
}if(b.paginator&&b.paginator._own){b.paginator.store=o;
if(b.suppressTotal){b.paginator.suppressTotal=true
}this._paginator=new Ext.PagingToolbar(b.paginator);
b.paginator=this._paginator
}else{if(b.pageSize>0&&b.paginator!=="own"){if(!b.paginator){b.paginator={}
}if(g.length&&b.paginator.separator!==false){if(b.paginatorPrependButtons===false){Ext.Array.insert(g,0,"-")
}else{g.push("-")
}}if(b.paginatorBehindButtonsItems||b.enableSearchX&&b.paginatorPrependButtons){var p=[];
if(b.paginatorBehindButtonsItems){p=Ext.isArray(b.paginatorBehindButtonsItems)?b.paginatorBehindButtonsItems:[b.paginatorBehindButtonsItems]
}if(b.enableSearchX&&b.paginatorPrependButtons){if(!p.length){p.push("->")
}p.push({xtype:"SearchFieldX",store:o,width:100})
}if(p.length){b.paginator.behindButtonsItems=p
}}if(b.suppressTotal){b.paginator.suppressTotal=true
}this._paginator=new Ext.PagingToolbar(Ext.applyIf(b.paginator,{store:o,items:g.length?g:undefined,prependButtons:Ext.isDefined(b.paginatorPrependButtons)?b.paginatorPrependButtons:true,displayInfo:Ext.isDefined(b.paginatorDisplayInfo)?b.paginatorDisplayInfo:true}));
g=this._paginator
}else{if(!g.length){g=undefined
}}}var c=b.plugins||[];
if(b.tplExpander){c.push({ptype:"rowexpander",rowBodyTpl:b.tplExpander})
}if(b.suspendStdBar){b.suspendedStdBar=g;
b[b.stdBar=="bottom"?"bbar":"tbar"]=null
}else{if(g&&(g.length||g.store||g.items&&g.items.length)){b[b.stdBar=="bottom"?"bbar":"tbar"]=g
}}if(b.columnsDefaults){b.columns={items:b.columns,defaults:b.columnsDefaults}
}if(b.multiSelect){b.selModel={mode:"MULTI"}
}Ext.applyIf(b,{store:o,region:"south",minSize:75,clicksToEdit:2,border:false,plugins:c.length?c:undefined,viewConfig:{}});
Ext.applyIf(b.viewConfig,{enableTextSelection:true,listeners:Ext.applyIf(b.viewConfigListeners||{},{scope:this,cellcontextmenu:f}),getRowClass:b.getRowClass,stripeRows:Ext.isDefined(b.stripeRows)?b.stripeRows:true,loadMask:Ext.isDefined(b.loadMask)?b.loadMask:true,setNewTemplate:function(){Ext.grid.View.prototype.setNewTemplate.call(this,arguments);
if(this.prefixCls){this.tpl.html=this.tpl.html.replaceall("x-grid-rowwrap-div",this.prefixCls+"-grid-rowwrap-div").replaceall("x-grid-cell-inner",this.prefixCls+"-grid-cell-inner");
if(b.plugins){var s=false;
for(var r=0;
r<b.plugins.length;
r++){if(b.plugins[r].ptype=="rowexpander"&&b.plugins[r].getRowBody){s=true
}}if(s){this.tpl.html=this.tpl.html.replace("x-grid-cell-rowbody",this.prefixCls+"-cell x-grid-cell-rowbody")
}}}},prefixCls:b.prefixCls});
var n=b.titleLang&&findLangS(b&&b.subsystem,"title",b.titleLang);
if(n){b.title=n
}if(b.prefixCls){b.viewConfig.selectedItemCls=b.prefixCls+"-row-selected";
b.viewConfig.overItemCls=b.prefixCls+"-row-over";
b.viewConfig.focusedItemCls=b.prefixCls+"-row-focused";
addGridPrefixClsCss(b.prefixCls)
}if(b.loadingText){b.viewConfig.loadingText=b.loadingText
}if(b.withoutGrid){Ext.applyIf(this,b)
}else{this.callParent([b]);
this.on("afterrender",function(r){if(this.deferredLoad&&(!this.memoryStore||this.relFields)){Ext.defer(r.store.load,100,r.store)
}if(this.intervalRefreshScheduler){this.startRefreshScheduler()
}},this);
this.on("beforedestroy",function(r){if(this.rowExpander){this.rowExpander.collapseAll()
}},this);
this.on("destroy",function(r){this.stopRefreshScheduler()
},this);
if(this.dblClickToEdit!==false){this.on("celldblclick",function(r){if(this.enableEdit){var s=this.selModel.getSelection();
if(s.length&&this.isEnableEditRecord(s[0])){this.createEditWindow(0)
}}},this)
}this.selModel.on("selectionchange",function(r){var s=r.getSelection();
this.enableEditBtn(s&&s.length==1?s[0]:false);
this.enableRemoveBtn(s&&s.length?s[0]:false);
this.onSelectionChange(r)
},this);
if(b.fullColumnSize){this.on("resize",function(r){this.setFullColumnSize(this.fullColumnSize,this.fullColumnSizeDecrement?this.fullColumnSizeDecrement:this.fullColumnSizeDecrementScroller?__width_Scroller:0)
},this)
}if(this.autoCollapseAllBeforeChangeHeader){this.on("beforecolumnhide",this.collapseAll,this);
this.on("beforecolumnshow",this.collapseAll,this)
}}function a(r,s,t){this.restartRefreshScheduler();
r.lastOperations=cloneObject(s,null,1)
}function m(s,r,v,u){if(this.removeRecordsIdAfterLoad&&r){for(var t=0;
t<r.length;
t++){if(r[t].data&&r[t].data[this.keyField||"id"]){delete r[t].data[this.keyField||"id"]
}}}this.onStoreLoad(s,r,v,u)
}function q(s,r,u,t){this.onStoreLoadBeforeRenders(s,r,u,t)
}function f(E,F,C,A,G,D,t){if(window.disableGridContextMenu){return
}var r=this;
var B=C;
t.stopEvent();
var A=this.store.getAt(D);
var w=this.getColumnManager().getColumns();
var v=w[B];
this.enableEditBtn(A);
this.enableRemoveBtn(A);
var s=[];
if(this.enableEdit&&this.isEnableEditRecord(A)){s.push({scope:this,text:findLangS(this.subsystem,"grid","propertiesRec"),iconCls:"icon_edit",handler:function(){r.selModel.select(D);
var H=this.createEditWindow(0)
}})
}if((this.enableEdit&&this.enableDelete!==false||this.enableDelete===true)&&!this.disableDeleteMenuItem&&this.isEnableDeleteRecord(A)){s.push({scope:this,text:findLangS(this.subsystem,"grid","removeRec")==findLangSd("grid","removeRec")?(findLangSd("grid","removeRec")+" "+findLangS(this.subsystem,"grid",this.subjectLang?"subject_"+this.subjectLang:"subject")):findLangS(this.subsystem,"grid","removeRec"),iconCls:"icon_remove",handler:function(){r.selModel.select(D);
this.confirmDeleteRule()
}})
}if(this.contextMenu){var y;
if(Ext.isFunction(this.contextMenu)){y=this.contextMenu(A,v)
}else{y=this.contextMenu
}if(y&&y.length){if(s.length){s.push("-")
}for(var z=0;
z<y.length;
z++){y[z]._record=A;
y[z]._column=v;
s.push(y[z])
}}}if(this.enableClipboardCopy!==false&&isClipboardCopySupport()){if(s.length){s.push("-");
s.push({text:findLangS(this.subsystem,"grid","copyToClipboard"),menu:getCellContextClipboardMenuItems.call(this,D,B,A,v)})
}else{s=getCellContextClipboardMenuItems.call(this,D,B,A,v)
}}if(s.length){var u=new Ext.menu.Menu({items:s});
u.showAtMouse(t)
}}},createEditWindow:function(o,q,v){delete this._getFieldCache;
delete this._showFieldCache;
var l;
var r;
this.maskLoad();
var f=null;
if(!o){f=v&&v.record||this.selModel.getSelection()[0]
}if((!v||!v.disableAjaxParams)&&!q){if(this.ajaxParamsUrl&&this.ajaxParamsTask&&(!this.ajaxParamsEnable||this.ajaxParamsEnable())){ajaxSafeRequest({scope:this,url:this.ajaxParamsUrl,params:{task:this.ajaxParamsTask,params:Ext.encode({isnew:o,data:o?undefined:f.data})},success:function(z){this.createEditWindow(o,z,v)
},errorFailure2:function(){this.unmask()
}})
}else{Ext.defer(function(){this.createEditWindow(o,{bypassAjaxParams:true},v)
},10,this)
}return
}var h=this.ewConfig?Ext.isFunction(this.ewConfig)?cloneObject(this.ewConfig()):cloneObject(this.ewConfig):{};
if(Ext.isFunction(h.height)){h.height=h.height()
}var n=Ext.applyIf(h,{scope:this,iconCls:o?"icon_add":"icon_edit",title:o?(this.newText||(findLangS(this.subsystem,"grid","newRec")==findLangSd("grid","newRec")?(findLangSd("grid","newRec")+" "+findLangS(this.subsystem,"grid",this.subjectLang?"subject_"+this.subjectLang:"subject")):findLangS(this.subsystem,"grid","newRec"))):(findLangS(this.subsystem,"grid","editRec",true)||this.propRecordText?findLangS(this.subsystem,"grid","propertiesRec")+" "+this.propRecordText(f.data):findLangS(this.subsystem,"grid","editRec")),closable:true,autoScroll:true,autoHeight:true,border:false,plain:true,layout:"fit",modal:true,listeners:Ext.applyIf(h.listeners||{},{activate:function(){this.setContextItems(l,this.getFieldValues(l),"_afteractivatewindow");
if(!l._focusFieldSetted){var z=null;
this.formPanel.getForm().getFields().each(function(A){if(A.isFormField&&A.focus&&!(A.xtype&&A.xtype.match&&(A.xtype=="checkbox"||A.xtype.match(/^displayfield/)))&&!A.disabled&&!A.readOnly&&(!Ext.isDefined(A.editable)||A.editable)){z=A;
return(false)
}});
if(z){z.focus(false,200);
l._focusFieldSetted=true
}++l._windowActivated
}if(!h.height){Ext.defer(function(){t.call(this)
},100,this)
}},scope:this})});
var a;
if(v&&v.fpItems){a=v.fpItems;
var c=this.fpDefaults;
if(v.fpDefaults){c=v.fpDefaults;
completeDefaultsFormFields(c)
}if(!v.disableCompleteFormFields){completeFormFields(a,true,c,this)
}}else{if(Ext.isFunction(this.fpItems)){if(!this.fpConfig){this.fpConfig={}
}a=this.fpItems(q,o,this.fpConfig,o?null:f);
if(!this.disableCompleteFormFields){completeFormFields(a,true,this.fpDefaults,this)
}}else{a=this.fpItems?this.fpItems:cloneObject(this.fpItemsSrc)
}}var u=[];
if(Ext.isDefined(this.buttons)&&!Ext.isEmpty(this.buttons)){u=this.buttons
}else{u.push({text:lang.saveButtonText,iconCls:"icon_save",handler:v&&v.saveRecord?function(){if(l.getForm().isValid()){v.saveRecord.call(this)
}}:function(){g.call(this)
},scope:this},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){if(this.onCancel){this.onCancel()
}r.destroy()
},scope:this})
}if(this.fpConfig&&this.fpConfig.prevButtons){u=this.fpConfig.prevButtons.concat(u)
}if(this.fpConfig&&this.fpConfig.leftButtons){u=this.fpConfig.leftButtons.concat(["->"],u)
}var k={};
if(this.fpConfig&&!isDataEmpty(this.fpConfig)){Ext.applyIf(k,this.fpConfig);
Ext.applyIf(k,{items:a,defaults:this.fpDefaults})
}else{Ext.applyIf(k,{layout:"fit",items:{xtype:"container",items:a,defaults:this.fpDefaults}})
}Ext.applyIf(k,{frame:true,url:this.url,border:false,autoHeight:true,labelAlign:"right",waitMsgTarget:true,buttons:u,listeners:Ext.applyIf((this.fpConfig||{}).listeners||{},{afterrender:y,_changefield:m,scope:this})});
var l=new Ext.FormPanel(k);
this.formPanel=l;
this.formPanel.editRecord=f;
n.items=l;
if(v&&v.title){n.title=v.title
}var r=new Ext.Window(n);
r.on("close",function(){if(this.onWindowClose){this.onWindowClose()
}},this);
r.on("destroy",function(){if(this.onWindowClose){this.onWindowClose(true)
}},this);
r.on("afterrender",function(){if(this.onWindowOpen){this.onWindowOpen()
}this.unmask()
},this);
l.editWindow=r;
r.formPanel=l;
this.dataForEdit={};
if(f){this.origDataForEdit=cloneObject(f.data);
this.prepareDataForEdit(f.data,l);
r.items.get(0).getForm().loadRecord(f);
this.dataForEdit=cloneObject(f.data)
}else{var s=v&&v.defaultValues||this.getDefaultValues(q);
if(s&&Ext.isObject(s)){this.prepareDataForEdit(s,l);
for(var d in s){var b=this.getField(d);
if(b){b.setValue(s[d])
}}this.dataForEdit=cloneObject(s)
}}r.show();
w.call(this);
this.setContextItems(l,this.getFieldValues(l),"loadrecord");
this.formPanel._recordLoaded=true;
l.getForm().clearInvalid();
return(r);
function g(F){if(!l.getForm().isValid()){Ext.suspendLayouts();
var H=l.getForm().getFields().filterBy(function(J){return(!J.validate())
});
Ext.resumeLayouts(true);
if(H.items.length){debug_log("invalid fields");
for(var D=0;
D<H.items.length;
D++){debug_log(H.items[D].name);
debug_log(H.items[D])
}}return
}var z=this.getFieldValues(l);
if(this.formFieldsElementFilters){var E={};
for(var D=0;
D<this.formFieldsElementFilters.length;
D++){var C=l.findC(this.formFieldsElementFilters[D].id,this.formFieldsElementFilters[D].value);
if(C){C.cascade(function(J){if(J.name&&!J.xtype.match(/displayfield/)&&Ext.isDefined(z[J.name])){if(Ext.isArray(z[J.name])){E[J.name]=J.getValue()
}else{E[J.name]=z[J.name]
}}})
}}if(!isDataEmpty(E)){z=E
}}if(!F&&!this.testValidRecord(z,o,o?undefined:f.data,g)){return
}this.prepareDataForSave(z,l,o?undefined:f.data);
if(this.skipStoreInSaveRecord){this._updateRecord(f,z,true);
if(v&&v.onSubmitSuccess){v.onSubmitSuccess.call(v.onSubmitSuccessScope)
}if(r){r.destroy()
}return
}if(this.memoryStore){if(o){this._addRecord(z)
}else{var B=f.data[this.keyField||"id"];
this._updateRecord(f,z,true);
f.data[this.keyField||"id"]=B;
if(f.data[this.keyField||"id"]){if(!this._updateRecords){this._updateRecords=[]
}this._updateRecords.push(f.data[this.keyField||"id"])
}}if(r){r.destroy()
}return
}for(var I in z){var G=this.getRecordItem(I);
if(G){if(G.enableZero&&z[I]===0){z[I]="0"
}else{if(G.convert==_convNull&&!G.disableSaveNull&&!z[I]||z[I]===null){z[I]="NULL"
}}if(G.type=="date"&&G.subtype=="time"){z[I]=Ext.Date.format(z[I],__format_Time)
}}}var A={task:o?"CREATE":"UPDATE",module:this.module,taskParams:Ext.encode({keyField:this.keyField||"id",keyValue:f?f.data[this.keyField||"id"]:undefined,relFields:this.relFields,data:z,fileField:this.fileField})};
if(isEnableClientTimezone()){Ext.applyIf(A,{clientTimezone:getClientTimezone(),clientOsTimezone:getClientOsTimezone()})
}if(!o&&f){A[this.keyField||"id"]=f.data[this.keyField||"id"]
}r.items.get(0).getForm().submit({scope:this,params:A,waitMsg:lang.savingText,success:function(J,K){if(v&&v.onSubmitSuccess){v.onSubmitSuccess.call(v.onSubmitSuccessScope,K)
}else{if(!this.withoutGrid){this.enableEditBtn(false);
this.enableRemoveBtn(false);
this.clearSelections();
this.onChangeRecordsBeforeRender(o?"insert":"update",K.result.record,f);
if(K.result.record){if(o){if(this.loadStoreAfterInserRecord||!this._addRecord(K.result.record)){this.store.load()
}}else{if(this.loadStoreAfterUpdateRecord||(!this.forceUpdateRecordAfterUpdate&&this.isAnyExpand())||!this._updateRecord(f,K.result.record,true)){this.store.load()
}}}else{this.store.load()
}this.onChangeRecords(o?"insert":"update",K.result.record,f);
this.processAfterChangeRecord()
}else{this.onChangeRecords(o?"insert":"update",K.result.record,f)
}}r.destroy()
},failure:function(J,K){if(!onAjaxRequestException(K.response,{fce:g,scope:this})){return
}if(K&&K.result){var L=K.result.error&&K.result.error.descr||K.result.error||K.result.errors&&K.result.errors.reason||K.result.msg;
if(L&&L.replaceall){L=L.replaceall("\n","<br>")
}Ext.MessageBox.alert(lang.errorText,L)
}else{if(K.failureType=="server"){Ext.MessageBox.alert(findLangSd("serverSideError"),findLangSd("errorIsNotSpecified"))
}else{Ext.MessageBox.alert(lang.error,findLangSd("errorIsNotSpecified"))
}}}})
}function y(){Ext.create("Ext.util.KeyNav",l.el,{enter:function(){if(l._enterInTextAreaField){l._enterInTextAreaField=null;
return true
}else{if(v&&v.saveRecord){if(l.getForm().isValid()){v.saveRecord.call(this)
}}else{g.call(this)
}}},scope:this});
l.getForm().getFields().each(function(z){if(z.catchAllEventsField!==false){catchAllEventsField(z,l,"_changefield")
}});
this.setContextItems(l,this.getFieldValues(l),"afterrender")
}function m(D,z,F,E,B,A){if(D=="_afterrenderfields"){var C=true;
z.getForm().getFields().each(function(G){if(G.isFormField&&!G.rendered){C=false;
return(false)
}})
}if(D!="_afterrenderfields"||C){this.setContextItems(z,this.getFieldValues(z),D,F,E,B,A)
}}function p(){var z=true;
this.cascade(function(A){if(A.isStoreOk&&!A.isStoreOk()){z=false;
return(false)
}});
return(z)
}function w(){if(p.call(l)){this.setContextItems(l,this.getFieldValues(l),"_afterstoreitemsok")
}else{l.getEl().mask();
var z=0;
var A={run:function(){if(!l.getEl()||!l.getEl().dom){Ext.TaskManager.stop(A)
}else{if(z&&p.call(l)||z>100){l.getEl().unmask();
Ext.TaskManager.stop(A);
this.setContextItems(l,this.getFieldValues(l),"_afterstoreitemsok");
if(z>100){Ext.Msg.alert(findLangS(this.subsystem,"grid","alertNotAllStoreOkHeader"),findLangS(this.subsystem,"grid","alertNotAllStoreOkText"))
}}}++z
},scope:this,interval:250};
Ext.TaskManager.start(A)
}}function t(){adjustHeightWindow(r,l,this.ewConfig&&this.ewConfig.heightMax,this.addWidthForVerticalScroller)
}},editRecord:function(d){var c=this.store.find(this.store.proxy.reader.idProperty,d);
if(c>=0){var a=this.store.getAt(c);
if(a){this.view.select(a);
var b=this.selModel.getSelection();
if(b.length){this.createEditWindow()
}}}},onChangeRecordsBeforeRender:function(a,b,c){},onChangeRecords:function(a,b,c){},onStoreLoad:function(b,a,d,c){},onStoreLoadBeforeRenders:function(b,a,d,c){},processAfterChangeRecord:function(){if(this.autoAdjustHeight||this.existsExpander()||this.autoRelayoutExpanders){Ext.defer(function(){this.adjustHeight()
},100,this)
}},adjustHeight:function(){if(this.autoAdjustHeight||this.existsExpander()){var a=this.body.down(".x-grid-item-container").getHeight()+(this.headerCt?this.headerCt.getHeight():0)+(this.getTopToolbar()?this.getTopToolbar().getHeight():0)+(this.getBottomToolbar()?this.getBottomToolbar().getHeight():0)+2;
if(this.getHeight()!=a&&Math.abs(this.getHeight()-a)>2){this.setHeight(a)
}}},loadRecordById:function(c,b,a){ajaxSafeRequest({scope:this,url:this.url,params:{module:this.module,task:"SINGLEROW",id:c},success:function(d){this._addRecord(d.data,true);
if(b){b.call(a,this.store,d.data)
}}})
},loadRecordByParams:function(c,b,a){ajaxSafeRequest({scope:this,url:this.url,params:{module:this.module,task:"LISTING",params:Ext.encode(c)},success:function(d){this._addRecord(d.results[0],true);
if(b){b.call(a,this.store,d.results)
}}})
},updateRecord:function(a,b,c){ajaxSafeRequest({scope:this,url:this.url,params:{module:this.module,task:"SINGLEROW",id:a.data[this.keyField||"id"],taskParams:Ext.encode({keyField:this.keyField||"id"})},success:function(d){this._updateRecord(a,d.data,b,c)
}})
},_updateRecord:function(m,s,q,p){var b=this.store.proxy.reader.readRecords({results:[s],total:1});
if(!b.records.length){debug_log("failed this.store.proxy.reader.readRecords");
return(false)
}if(this.isExpandRecord(m)){var f=this.columnManager.getColumns();
var l=this.rowExpander;
var h=[];
if(!Ext.isDefined(p)||p==="all"){p=[];
for(var k=(l?1:0);
k<f.length;
k++){if(f[k].dataIndex){p.push(f[k].dataIndex)
}h.push(f[k])
}}else{for(var k=0;
k<f.length;
k++){if(f[k].dataIndex&&p.isIn(f[k].dataIndex)){h.push(f[k])
}}}var a=this.view.getNodeByRecord(m);
var r={};
if(this.fixFieldsInUpdateRecord){for(var k=0;
k<this.fixFieldsInUpdateRecord.length;
k++){r[this.fixFieldsInUpdateRecord[k]]=m.data[this.fixFieldsInUpdateRecord[k]]
}}m.data=b.records[0].data;
if(this.fixFieldsInUpdateRecord){for(var k=0;
k<this.fixFieldsInUpdateRecord.length;
k++){m.data[this.fixFieldsInUpdateRecord[k]]=r[this.fixFieldsInUpdateRecord[k]]
}}var d=this.view.createRowElement(m,0,h);
for(var k=0;
k<h.length;
k++){for(var g=0;
g<f.length;
g++){if(f[g].id==h[k].id){var o=".x-grid-cell"+(k?":nth-child("+(k+1)+")":"");
var c=".x-grid-cell"+(g?":nth-child("+(g+1)+")":"");
Ext.fly(a).down("[role=row]").down(c).down(".x-grid-cell-inner",true).innerHTML=Ext.fly(d).down("[role=row]").down(o).down(".x-grid-cell-inner",true).innerHTML
}}}if(q){this.updateExpanderBodyContent(m)
}}else{if(p==="all"){if(this.headerCt){p=[];
for(var k=0;
k<this.headerCt.items.getCount();
k++){var n=this.headerCt.items.get(k);
if(n&&n.dataIndex){p.push(n.dataIndex)
}}}else{p=null
}}if(p){m.data=b.records[0].data;
m.store.afterEdit(m,p)
}else{m.beginEdit();
var r={};
if(this.fixFieldsInUpdateRecord){for(var k=0;
k<this.fixFieldsInUpdateRecord.length;
k++){r[this.fixFieldsInUpdateRecord[k]]=m.data[this.fixFieldsInUpdateRecord[k]]
}}m.data=b.records[0].data;
if(this.fixFieldsInUpdateRecord){for(var k=0;
k<this.fixFieldsInUpdateRecord.length;
k++){m.data[this.fixFieldsInUpdateRecord[k]]=r[this.fixFieldsInUpdateRecord[k]]
}}m.endEdit()
}}return(true)
},_addRecord:function(b,c){var a=this.store.proxy.reader.readRecords({results:[b],total:1});
if(!a.records.length){debug_log("failed this.store.proxy.reader.readRecords");
return(false)
}this.store[c?"add":"addSorted"](a.records[0]);
return(true)
},_removeRecord:function(a){var b=Ext.isObject(a)?this.store.indexOf(a):a;
if(b>=0&&b<this.store.getCount()){this.collapseRowIndex(b);
this.store.removeAt(b)
}},repaintRecord:function(a,b){if(!Ext.isDefined(b)){b=this.store.indexOf(a)
}if(this.view.all.item(b)){this._updateRecord(a,a.data,null,"all")
}},repaintAllRecords:function(a){var b=0;
this.store.each(function(c){this.repaintRecord(c,b);
++b
},this)
},createNewRecord:function(a){ajaxSafeRequest({scope:this,url:this.url,params:{module:this.module,task:"CREATE",taskParams:Ext.encode({keyField:this.keyField||"id",relFields:this.relFields,data:a})},success:function(b){this.enableEditBtn(false);
this.enableRemoveBtn(false);
this.clearSelections();
if(b.record){if(!this._addRecord(b.record)){this.store.load()
}}else{this.store.load()
}this.onChangeRecords("insert",b.record);
this.processAfterChangeRecord()
}})
},createNewIndirectRecord:function(c,a,d){var b=Ext.create(c,Ext.apply({withoutStore:true,withoutGrid:true},d||{}));
b.createEditWindow(1,null,{onSubmitSuccess:function(g){var f={};
f[a]=g.result.record.id;
this.createNewRecord(f)
},onSubmitSuccessScope:this})
},editIndirectRecord:function(d,b,g){var f=this.selModel.getSelection();
if(!f||f.length!=1){return
}var a=f[0];
var c=Ext.create(d,Ext.apply({enableAutoLoad:false,withoutGrid:true},g||{}));
c.loadRecordById(a.data[b],function(h,k){c.createEditWindow(0,null,{record:h.getAt(0),onSubmitSuccess:function(l){this.updateRecord(a)
},onSubmitSuccessScope:this})
},this)
},saveRecord:function(c,a,b){ajaxSafeRequest(Ext.applyIf(b||{},{scope:this,url:this.url,params:{module:this.module,task:"UPDATE",taskParams:Ext.encode({keyField:this.keyField||"id",keyValue:c.data[this.keyField||"id"],relFields:this.relFields,data:c.data})},success:function(d){if(a){a.call(this)
}}}))
},callSetContext:function(a,d,f,h,g,c,b){if(!d){d=a.getForm().getFieldValues()
}this.setContextItems(a,d,f,h,g,c,b);
this.setContextButtons(a,d,f,h,g,c,b)
},setContextItems:function(a,d,f,h,g,c,b){},setContextButtons:function(g,f,b,m,c,a,h){if(g&&g.getForm&&g.getForm()){var d=g.getForm();
if(d.getFields){var k=d.getFields();
var l=false;
k.each(function(n){if(!n.disabled){l=true;
return(false)
}});
this.enableFormBtn(g,"save",l)
}}},testValidRecord:function(c,b,d,a){return(true)
},getDefaultValues:function(){return null
},prepareDataForEdit:function(a){},prepareDataForSave:function(a){},completeColumns:function(d,f,b){if(!d){return
}for(var c=0;
c<d.length;
c++){if(!d[c].width&&(d[c].widthChar||d[c].widthCh||d[c].widthNum||d[c].widthN)){d[c].width=d[c].widthChar||d[c].widthCh?__width_ColumnChar(d[c].widthChar||d[c].widthCh):__width_ColumnNum(d[c].widthNum||d[c].widthN)
}if(f&&f.renderer&&!d[c].renderer){d[c].renderer=f.renderer
}if(f&&f.tdCls&&!d[c].tdCls){d[c].tdCls=f.tdCls
}if(!d[c].header&&!d[c].withoutHeader&&(d[c].headerLang||d[c].dataIndex)){var a=findLangS(b.subsystem,"column",d[c].headerLang||d[c].dataIndex,true)||findLangS(b.subsystem,"field",d[c].headerLang||d[c].dataIndex,true)||findLangS(b.subsystem,"column",d[c].headerLang||d[c].dataIndex,b.subsystemConfig&&b.subsystemConfig.columnStrict)||findLangS(b.subsystem,"field",d[c].headerLang||d[c].dataIndex,b.subsystemConfig&&b.subsystemConfig.columnStrict);
if(a){d[c].header=a
}else{if(b.subsystemConfig&&b.subsystemConfig.columnEnableDataIndex&&d[c].dataIndex){d[c].header=d[c].dataIndex;
if(d[c].header.match(/_id$/)){d[c].header=d[c].header.substr(0,d[c].header.length-3)
}if(d[c].header.match(/^id_/)){d[c].header=d[c].header.substr(3)
}var g=d[c].header.match(/^(.*__)/);
if(g&&g.length>1){d[c].header=d[c].header.substr(g[1].length)
}d[c].header=d[c].header.replaceall("_"," ")
}}}if(d[c].xtype=="actioncolumn"&&!d[c].menuText){d[c].menuText=d[c].header
}}},getField:function(c){if(this.formPanel&&this.formPanel.getForm){if(this._withoutFieldProp){if(!this._getFieldCache){this._getFieldCache=[]
}else{if(Ext.isDefined(this._getFieldCache[c])){return(this._getFieldCache[c])
}}var a=this.formPanel.getItems(c,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(!a[b][this._withoutFieldProp]){this._getFieldCache[c]=a[b];
return(a[b])
}}}this._getFieldCache[c]=null;
return(null)
}else{return(this.formPanel.getForm().findField(c))
}}return(null)
},getFieldValues:function(a){if(!a){a=this.formPanel
}if(a&&a.getForm){var c=a.getForm().getFieldValues();
this.formPanel.getForm().getFields().each(function(g){if(!Ext.isDefined(c[g.name])&&g.disabled&&g.saveIfDisabled){c[g.name]=g.getValue()
}});
if(this._withoutFieldProp){var b={};
for(var f in c){var d=this.getField(f);
if(d){b[f]=d.getValue()
}}return(b)
}else{return(c)
}}return(null)
},getItemBy:function(b,a){if(this.formPanel&&this.formPanel.findC){return(this.formPanel.findC(b,a))
}return(null)
},getValueField:function(b){var a=this.getField(b);
if(a){return(a.getValue())
}return(null)
},setValueField:function(c,a){var b=this.getField(c);
if(b){return(b.setValue(a))
}},enableField:function(d,a){if(Ext.isArray(d)){for(var b=0;
b<d.length;
b++){this.enableField(d[b],a)
}}else{var c=this.getField(d);
if(c){c.enableIf(a)
}}},enableFieldIf:function(b,a){this.enableField(b,a)
},showField:function(d,a){if(Ext.isArray(d)){for(var b=0;
b<d.length;
b++){this.showField(d[b],a)
}}else{var c=this.getField(d);
if(c){if(!this._showFieldCache){this._showFieldCache=[]
}else{if(Ext.isDefined(this._showFieldCache[d])&&this._showFieldCache[d]==a){return
}}c.showIf(a);
this._showFieldCache[d]=a
}}},showFieldIf:function(b,a){this.showField(b,a)
},showItemBy:function(d,c,a){var b=this.getItemBy(d,c);
if(b){b.showIf(a)
}},allowBlankField:function(d,a){if(Ext.isArray(d)){for(var b=0;
b<d.length;
b++){this.allowBlankField(d[b],a)
}}else{var c=this.getField(d);
if(c){c.allowBlankIf(a)
}}},needFillField:function(b,a){this.allowBlankField(b,!a)
},setReadOnly:function(c,b){var a=this.getField(c);
if(a){a.setReadOnly(b);
if(a.inputEl&&a.inputEl.setStyle){a.inputEl.setStyle(b?{background:"none","background-color":__style_FormBackground}:{background:null})
}}},setFieldLabel:function(c,a){var b=this.getField(c);
if(b&&b.setFieldLabel){b.setFieldLabel(a)
}},setLabelWidth:function(c,a){var b=this.getField(c);
if(b&&b.labelEl&&b.labelEl.up(".x-field-label-cell")){b.labelEl.setWidth(a);
b.labelEl.up(".x-field-label-cell").setWidth(a+__width_FieldSeparator)
}},getFormItem:function(b,c,d){if(this.formPanel){if(d){var a=[];
this.formPanel.cascade(function(f){if(f[c||"name"]==b){a.push(f)
}});
if(a&&a.length){return a[0]
}}else{var a=this.formPanel.find(c||"name",b);
if(a&&a.length){return a[0]
}}}return(null)
},getRecordItem:function(a){return(getRecordItem(a,this.recordStruct))
},enableEditBtn:function(a){this.enableBtn("edit",a&&this.isEnableEditRecord(a))
},enableRemoveBtn:function(a){this.enableBtn("remove",a&&this.isEnableDeleteRecord(a))
},isEnableEditRecord:function(a){return(true)
},isEnableDeleteRecord:function(a){return(true)
},enableFormBtn:function(a,f,b){if(a.dockedItems){for(var d=0;
d<a.dockedItems.getCount();
d++){var c=a.dockedItems.get(d).findC("_id",f);
if(c){c.enableIf(b)
}}}},setToolbarFieldValue:function(a,d,c){for(var b=0;
b<4;
b++){if(!c||c==(b==0?"tbar":b==1?"bbar":b==2?"foreign_tbar":"foreign_bbar")){var c=b==0?this.getTopToolbar():b==1?this.getBottomToolbar():b==2?this.foreignBarOwner&&this.foreignBarOwner.getTopToolbar():this.foreignBarOwner&&this.foreignBarOwner.getBottomToolbar();
if(c){var f=c.getItem(a,"_id",c.alias=="widget.pagingtoolbar");
if(!f&&c.alias!="widget.pagingtoolbar"){f=c.getItem(a,"_id",true)
}if(f){f.setValue(d)
}}}}},confirmDeleteRule:function(a){if(this.selModel.getCount()==1){Ext.MessageBox.confirm(lang.questionText,this.confirmDeleteRuleText?(Ext.isFunction(this.confirmDeleteRuleText)?this.confirmDeleteRuleText(this.selModel.getSelection(),lang.confirmDeleteRuleSingleText):this.confirmDeleteRuleText):lang.confirmDeleteRuleSingleText,function(b){this.deleteRule(b,a)
},this)
}else{if(this.selModel.getCount()>1){Ext.MessageBox.confirm(lang.questionText,this.confirmDeleteRuleText?(Ext.isFunction(this.confirmDeleteRuleText)?this.confirmDeleteRuleText(this.selModel.getSelection(),lang.confirmDeleteRuleMultipleText):this.confirmDeleteRuleText):lang.confirmDeleteRuleMultipleText,function(b){this.deleteRule(b,a)
},this)
}else{Ext.MessageBox.alert(lang.errorText,lang.selectOneOrMoreText)
}}},deleteRule:function(a,m){if(a!="yes"){return
}var k=this.selModel.getSelection();
if(!k.length){return
}this.enableEditBtn(false);
this.enableRemoveBtn(false);
var g=[];
var b=[];
var l=[];
var h=this.selModel.getCount()==1?cloneObject(k[0].data):null;
for(var d=0;
d<this.selModel.getCount();
d++){g.push(k[d].data[this.keyField||"id"]);
l.push(this.store.indexOf(k[d]));
if(m&&m.id2&&m.table2){b.push(k[d].data[m.id2])
}}if(this.memoryStore){for(var d=l.length-1;
d>=0;
d--){var f=this.store.getAt(l[d]);
if(f){f.forDelete=true;
this.collapseRowIndex(l[d]);
this.store.removeAt(l[d]);
if(f.data[this.keyField||"id"]){if(!this._deleteRecords){this._deleteRecords=[]
}this._deleteRecords.push(f.data[this.keyField||"id"])
}}}return
}var c={module:this.module,task:"DELETE",ids:Ext.encode(g),taskParams:Ext.encode({keyField:this.keyField||"id",relFields:this.relFields})};
if(m&&m.id2&&m.table2){c.ids2=Ext.encode(b);
c.table2=m.table2
}ajaxSafeRequest({scope:this,url:this.url,params:c,success:function(n){if(this.isAnyExpand()){for(var p=l.length-1;
p>=0;
p--){var o=this.store.getAt(l[p]);
if(o){o.forDelete=true;
this.collapseRowIndex(l[p]);
this.store.removeAt(l[p])
}}}else{this.store.load()
}this.onChangeRecords("delete",h);
this.processAfterChangeRecord()
},error2:function(n){this.enableEditBtn(k[0]);
this.enableRemoveBtn(k[0])
},failure:function(o){var n=o.responseText;
Ext.MessageBox.alert(lang.errorText,lang.genericResponseErrorText);
this.enableEditBtn(k[0]);
this.enableRemoveBtn(k[0])
},maskEl:this})
},setExtraParams:function(b,a,c){if(c){this.store.proxy.extraParams=cloneObject(this.baseExtraParams)
}Ext.apply(this.store.proxy.extraParams,b);
if(a){this.reloadFirstPage()
}},setNewExtraParams:function(b,a){this.setExtraParams(b,a,true)
},setExtraParam:function(c,b,a){var d=this.store.proxy.extraParams||{};
if(c.search("/")>=0){c=c.split("/");
if(c.length==2){subParams=d[c[0]]?Ext.decode(d[c[0]]):{};
subParams[c[1]]=b;
d[c[0]]=Ext.encode(subParams)
}}else{d[c]=b
}Ext.apply(this.store.proxy.extraParams,d);
if(a){this.reloadFirstPage()
}},getExtraParam:function(a){return(this.store.proxy&&this.store.proxy.extraParams&&this.store.proxy.extraParams[a])
},setRelFields:function(a,b){this.relFields=cloneObject(a);
this.store.proxy.extraParams.relFields=Ext.encode(a);
if(b){this.reloadFirstPage()
}},reloadFirstPage:function(){if(this.pageSize){this.store.loadPage(1)
}else{this.store.load()
}},reload:function(a){var b;
if(a&&this.view&&this.view.getEl()){b=this.view.getEl().dom.scrollTop
}this.store.load();
if(a&&Ext.isDefined(b)){this.store.on("load",function(){this.view.getEl().dom.scrollTop=b
},this,{single:true})
}},refresh:function(){if(!this.store.lastOperations){return
}var a=this.store.proxy.buildRequest(this.store.lastOperations);
ajaxSafeRequest({scope:this,url:this.url,params:a.config.params,success:function(b){for(var d=0;
d<b.total;
d++){var f=b.results[d];
var c=this.store.getById(f[this.keyField||"id"]*1);
if(c){this._updateRecord(c,f,false,"all")
}}}})
},getSeachFieldX:function(){return(this.getTopToolbar().findC("xtype","SearchFieldX"))
},getExpanderBodyContent:function(a){var b=this.store.indexOf(a);
if(this.isExpandRowIndex(b)){return(a.expanderBodyContent)
}return(null)
},updateExpanderBodyContent:function(a){var b=this.store.indexOf(a);
if(this.isExpandRowIndex(b)&&a.expanderBodyContent&&a.expanderBodyContent.update){a.expanderBodyContent.update(a)
}},reloadExpanderBodyContent:function(a){var b=this.store.indexOf(a);
if(this.isExpandRowIndex(b)&&a.expanderBodyContent&&a.expanderBodyContent.reload){a.expanderBodyContent.reload()
}},forEachExpanderBodyContent:function(b){for(var c=0;
c<this.store.getCount();
c++){if(this.isExpandRowIndex(c)){var a=this.store.getAt(c);
b.call(this,a.expanderBodyContent,a)
}}},expandRecord:function(a){this.expandRowIndex(this.store.indexOf(a))
},expandRowIndex:function(a){if(this.rowExpander){this.rowExpander.expandRow(a)
}},collapseRecord:function(a){this.collapseRowIndex(this.store.indexOf(a))
},collapseRowIndex:function(a){if(this.rowExpander){this.rowExpander.collapseRow(a)
}},isExpandRecord:function(a){return(this.isExpandRowIndex(this.store.indexOf(a)))
},isExpandRowIndex:function(a){return(this.rowExpander&&this.rowExpander.isExpand(a))
},isAnyExpand:function(){return(this.rowExpander&&this.rowExpander.isAnyExpand())
},expandAll:function(){return(this.rowExpander&&this.rowExpander.expandAll())
},collapseAll:function(){return(this.rowExpander&&this.rowExpander.collapseAll())
},onSelectionChange:function(a){},clearSelections:function(){this.selModel.clearSelections();
for(var a=0;
a<this.store.getCount();
a++){this.view.onRowDeselect(a)
}this.selModel.fireEvent("selectionchange",this.selModel)
},setFullColumnSize:function(k,b){var a=this.getWidth();
if(!a){return
}var c=this.getColumnManager().getColumns();
var d=0;
var g=-1;
for(var f=0;
f<c.length;
f++){if(c[f].dataIndex==k){g=f
}else{d+=c[f].getWidth()
}}var h=0;
var l=this.getExpanderPlugin();
if(l){h=l.expanderColumn.getWidth()
}if(g>=0){if(!Ext.isDefined(b)){b=0
}c[g].setWidth(a-d-h-b)
}},adjustFullColumnSize:function(){if(this.isVisible()&&this.isColumnsRendered()){this.setFullColumnSize(this.fullColumnSize,this.fullColumnSizeDecrement?this.fullColumnSizeDecrement:this.fullColumnSizeDecrementScroller?__width_Scroller:0)
}},isColumnsRendered:function(){var b=this.getColumnManager().getColumns();
for(var a=0;
a<b.length;
a++){if(!b[a].el){return(false)
}}return(true)
},getAllGridItems:function(b){var a=[];
this.store.each(function(c){if(c.data[b]){a.push(c.data[b])
}});
return(a.length?a:null)
},getSelectedGridItems:function(d){var a=[];
var c=this.selModel.getSelection();
if(c.length){for(var b=0;
b<c.length;
b++){if(c[b].data[d]){a.push(c[b].data[d])
}}}return(a.length?a:null)
},getAllGridData:function(c){var a=[];
var b=this;
this.store.each(function(f){if(c){var g=cloneObject(f.data);
for(var h in g){var d=b.getRecordItem(h);
if(d){if(d.enableZero&&g[h]===0){g[h]="0"
}else{if(d.convert==_convNull&&!d.disableSaveNull&&!g[h]||g[h]===null){g[h]="NULL"
}}}}a.push(g)
}else{a.push(f.data)
}});
return(a.length?a:null)
},getSelectedGridData:function(d){var a=[];
var c=this.selModel.getSelection();
if(c.length){for(var b=0;
b<c.length;
b++){a.push(c[b].data)
}}return(a.length?a:null)
},exportToCsv:function(){formPostSafe("php/model/sql.php","POST",Ext.applyIf({module:this.module,task:"CSV",dummy:new Date(),timeout:60*60},this.getExtraParamsForExportToCsv()))
},getExtraParamsForExportToCsv:function(){var c={};
if(this.store.proxy.extraParams){for(var b in this.store.proxy.extraParams){if(Ext.isObject(this.store.proxy.extraParams[b])||Ext.isArray(this.store.proxy.extraParams[b])||Ext.isDate(this.store.proxy.extraParams[b])){var a=Ext.encode(this.store.proxy.extraParams[b]);
if(a&&a.length&&a[0]=='"'&&a[a.length-1]=='"'){a=a.substr(1,a.length-2);
c[b]=a
}}else{c[b]=this.store.proxy.extraParams[b]
}}}if(this.filters){Ext.applyIf(c,this.filters.buildQuery(this.filters.getFilterData()))
}Ext.applyIf(c,{sort:this.store.proxy.encodeSorters(this.store.getSorters().items)});
return(c)
},importFromCsv:function(){var a=new Tools.UploadFile({type:"import_from_csv",module:this.module,grid:this});
var b=new Ext.Window({title:a.windowTitle,iconCls:a.windowIconCls,layout:"fit",items:a,border:false,modal:true,closable:true,resizable:false});
b.show()
},startRefreshScheduler:function(){if(!this.refreshScheduler){this.refreshScheduler=Ext.TaskManager.start({run:this.onRefreschScheduler,interval:this.intervalRefreshScheduler*1000,scope:this});
this.counterRefreshScheduler=0
}},stopRefreshScheduler:function(){if(this.refreshScheduler){Ext.TaskManager.stop(this.refreshScheduler);
this.refreshScheduler=null;
this.counterRefreshScheduler=null
}},onRefreschScheduler:function(){if(this.counterRefreshScheduler&&this.isVisible()){var a=this.findMainPanel();
if(!a||!a.xtype||(ActiveModule+"PanelX")==a.xtype){this.refresh()
}}++this.counterRefreshScheduler
},restartRefreshScheduler:function(){if(this.refreshScheduler){this.stopRefreshScheduler();
this.startRefreshScheduler()
}},findMainPanel:function(){var b=this;
while(b){if(b.ownerCt){b=b.ownerCt
}else{if(b.getEl){var a=b.getEl().up(".x-panel");
if(a){b=Ext.getCmp(a.id)
}else{b=null
}}else{b=null
}}if(b instanceof Ext.ux.grid.Panel){return(b)
}}},getExpanderPlugin:function(){if(this.plugins){for(var a=0;
a<this.plugins.length;
a++){if(this.plugins[a].ptype=="rowexpander"){return(this.plugins[a])
}}}return(null)
},existsExpander:function(){return(this.getExpanderPlugin()!=null)
},getExpanderHeaderConfig:function(){var a=this.getExpanderPlugin();
if(a){return(a.getHeaderConfig())
}return(null)
},findLangS:function(b,c,a){return(findLangS(this.subsystem,b,c,a))
}});
function completeDefaultsFormFields(a){if(!a.labelWidth){if(a.labelChar||a.labelCh){a.labelWidth=__width_FieldChar(a.labelChar||a.labelCh)
}else{a.labelWidth=100
}}if(!a.width){if(!a._width&&(a.widthChar||a.widthCh)){a._width=__width_FieldChar(a.widthChar||a.widthCh)
}if(a._width){a.width=__width_Form(a._width,a.labelWidth)
}}if(!a.labelAlign){a.labelAlign="right"
}}function completeFormFields(a,f,c,b){if(Ext.isArray(a)){for(var d=0;
d<a.length;
d++){if(a[d]){completeFormField(a[d],f,c,b)
}}}else{completeFormField(a,f,c,b)
}}function completeFormField(f,g,b,a){if(!Ext.isDefined(f.xtype)&&b&&b.xtypeForce){f.xtype=b.xtypeForce
}if(!f.width){if(!f._width&&!f.disableAutoWidth&&(f.widthChar||f.widthCh||f.widthNum||f.widthN||f.widthCharForm||f.widthChF||(!(f.xtype&&f.xtype.match&&f.xtype.match(/^displayfield/))&&b&&(b.widthChar||b.widthCh)))){f._width=f.widthChar||f.widthCh||f.widthCharForm||f.widthChF?__width_FieldChar(f.widthChar||f.widthCh||f.widthCharForm||f.widthChF):f.widthNum||f.widthN?__width_FieldNum(f.widthNum||f.widthN):__width_FieldChar(b.widthChar||b.widthCh)
}if(f._width){if(f.hideLabel){f.width=f._width
}else{if(f.labelWidthForce||f.labelWidthForceCh||f.labelWidthForceChar){f.width=__width_Form(f._width,f.labelWidthForce||__width_FieldChar(f.labelWidthForceCh||f.labelWidthForceChar));
f.labelWidth=f.labelWidthForce||__width_FieldChar(f.labelWidthForceCh||f.labelWidthForceChar)
}else{f.width=__width_Form(f._width,b&&b.labelWidth?b.labelWidth:f.labelWidth)
}}if((!b||!b.disableAutoAddTriggerWidth)&&f.xtype&&(f.xtype=="ComboBoxX"||f.xtype=="ComboBoxA"||f.xtype=="ComboBoxAT"||f.xtype=="ComboBoxT"||Ext.isString(f.xtype)&&f.xtype.substr(0,4)=="CBX_")){f.width+=__width_Trigger
}if(f.widthAdd){f.width+=f.widthAdd
}}}if(!f.regex&&f.onlyNumberContent!==false&&(f.widthNum||f.widthN||f.onlyNumberContent)){Ext.applyIf(f,{maskRe:f._disableDecPoint||f._enableDecPoint===false?(f._unsigned?/[0-9]+/:/[-0-9]+/):(f._unsigned?/[0-9.]+/:/[-0-9.]+/),regex:f._disableDecPoint||f._enableDecPoint===false?(f._unsigned?/^[0-9]+$/:/^\-?[0-9]+$/):(f._unsigned?/^[0-9]+[.]?[0-9]*$/:/^\-?[0-9]+[.]?[0-9]*$/)})
}if(!f.height&&f.heightL){f.height=__height_FieldLines(f.heightL)
}if(f.align=="right"){f.fieldStyle=Ext.applyIf(f.fieldStyle||{},{"text-align":"right"})
}if(f.xtype=="textarea"||f.vtype||f.allowBlank||f.checkAfterKeyEvent){f.enableKeyEvents=true
}if(!f.hideLabel){Ext.applyIf(f,{labelWidth:b&&b.labelWidth?b.labelWidth:__width_Label,labelAlign:b&&b.labelAlign?b.labelAlign:__align_Label})
}if(f.marginLabel){if(!f.style){f.style={}
}Ext.applyIf(f.style,{marginLeft:b.labelWidth+__width_LabelFieldSeparator})
}if(f.items&&g&&!f._stopCompleteField){if(f.labelWidth){if(!b){b={}
}_labelWidth=b.labelWidth;
b.labelWidth=f.labelWidth
}completeFormFields(f.items,g,b,a);
if(_labelWidth){b.labelWidth=_labelWidth
}}Ext.applyIf(f,{checkChangeEvents:["blur"]});
if(!f.fieldLabel){if(f.autoBoxLabel){var d=findLangS(a&&a.subsystem,"field",f.fieldLabelLang||f.name,a&&a.subsystemConfig&&a.subsystemConfig.fieldStrict);
if(d){f.boxLabel=d
}else{if(a&&a.subsystemConfig&&a.subsystemConfig.fieldEnableName&&f.name){f.boxLabel=f.name.match(/__b_/)?f.name.substr(f.name.search(/__b_/)+4):f.name
}}}else{if(!f.hideLabel&&!f.withoutLabel&&!f.withoutFieldLabel&&(f.fieldLabelLang||f.name)){var h=findLangS(a&&a.subsystem,"field",f.fieldLabelLang||f.name,a&&a.subsystemConfig&&a.subsystemConfig.fieldStrict);
if(h){f.fieldLabel=h
}else{if(a&&a.subsystemConfig&&a.subsystemConfig.fieldEnableName&&(f.fieldLabelLang||f.name)){f.fieldLabel=(f.fieldLabelLang||f.name);
if(f.fieldLabel.match(/_id$/)){f.fieldLabel=f.fieldLabel.substr(0,f.fieldLabel.length-3)
}f.fieldLabel=f.fieldLabel.replaceall("_"," ")
}}}}}if(!f.helpText&&!f.withoutHelp&&!f.withoutHelpText&&(f.fieldLabelLang||f.name)){var c=findLangS(a&&a.subsystem,"field_help",f.fieldLabelLang||f.name,a&&a.subsystemConfig&&a.subsystemConfig.helpStrict);
if(c&&Ext.isString(c)){f.helpText=c
}else{if(a&&a.subsystemConfig&&a.subsystemConfig.getHelp){c=a.subsystemConfig.getHelp(f.fieldLabelLang||f.name);
if(c&&Ext.isString(c)){f.helpText=c
}}}}if(a&&a.colorLabelAllowBlankFalse&&f.fieldLabel&&(f.allowBlank===false||f.allowBlank==="color_label")){f.fieldLabel='<span style="color: '+a.colorLabelAllowBlankFalse+';">'+f.fieldLabel+"</span>"
}if(!f.title&&f.titleLang){f.title=findLangS(a&&a.subsystem,"field",f.titleLang,a&&a.subsystemConfig&&a.subsystemConfig.fieldStrict)
}}function catchAllEventsField(c,a,b){c._formPanel=a;
c.on("change",function(g,f,d){this.fireEvent("_changefield","change",this,g,f,d)
},a);
c.on("select",function(g,f){var d=null;
if(g){if(g.getValue){d=g.getValue()
}else{if(g.view&&g.view.ownerCt&&g.view.ownerCt.getValue){d=g.view.ownerCt.getValue()
}}}this.fireEvent("_changefield","select",this,g,d,g.oldValue)
},a);
c.on("check",function(f,d){this.fireEvent("_changefield","check",this,f,d)
},a);
if(c.enableKeyEvents||c.vtype){c.on("keydown",function(f,d){if(f.xtype=="textarea"&&d.keyCode==d.ENTER&&!d.ctrlKey&&!d.altKey){f._formPanel._enterInTextAreaField=f
}else{this.fireEvent("_changefield","key",this,f,null,null,d);
this.fireEvent("_changefield","keydown",this,f,null,null,d)
}},a);
c.on("keyup",function(f,d){if(f.vtype&&f.isValid()){f.isValid()
}this.fireEvent("_changefield","key",this,f,null,null,d);
this.fireEvent("_changefield","keyup",this,f,null,null,d)
},a)
}if(c.spinner){c.on("spin",function(d){this.fireEvent("_changefield","spin",this,d.field)
},a);
c.on("spinup",function(d){this.fireEvent("_changefield","spinup",this,d.field)
},a);
c.on("spindown",function(d){this.fireEvent("_changefield","spindown",this,d.field)
},a)
}else{c.on("spin",function(d){this.fireEvent("_changefield","spin",this,d)
},a);
c.on("spinup",function(d){this.fireEvent("_changefield","spinup",this,d)
},a);
c.on("spindown",function(d){this.fireEvent("_changefield","spindown",this,d)
},a)
}c.on("afterrender",function(d){this.fireEvent("_changefield","_afterrenderfields",this,d)
},a)
}function getFormFieldValues(d,b){if(d.getForm){d=d.getForm()
}var c=d.getFieldValues();
for(var f in c){var a=getRecordItem(f,b);
if(a&&a.convert==_convNull&&!c[f]||c[f]===null){c[f]="NULL"
}}return(c)
}function onContextClipboardMenu(p,q,n,l,r,o,c){var a=this;
var m=n;
c.stopEvent();
var l=this.store.getAt(o);
var g=this.getColumnManager().getColumns();
var f=g[m];
var b=[];
if(isClipboardCopySupport()){b=getCellContextClipboardMenuItems.call(a,o,m,l,f)
}if(this.contextMenu){var h;
if(Ext.isFunction(this.contextMenu)){h=this.contextMenu(l,f)
}else{h=this.contextMenu
}if(h&&h.length){if(b.length){b.push("-")
}for(var k=0;
k<h.length;
k++){h[k]._record=l;
h[k]._column=f;
b.push(h[k])
}}}if(b.length){var d=new Ext.menu.Menu({items:b});
d.showAtMouse(c)
}}function getCellContextClipboardMenuItems(k,h,g,d){if(!isClipboardCopySupport()){return(null)
}var c=[];
c.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 4;">'+findLangS(this.subsystem,"grid","copyToClipboard")+"</div>");
var m=getClipboardTableTextCell.call(this,k,h,g,d);
if(m){c.push(new cClipboardMenuItem({text:findLangS(this.subsystem,"grid","actualCell"),getClipText:function(n){return(n.clipboardText)
},getClipTextParams:{clipboardText:m},hideOnClick:false,scope:this}))
}var l=false;
var b=[];
var a=this.selModel.getSelection();
for(var f=0;
f<a.length;
f++){b.push(a[f].id);
if(a[f].id==g.id){l=true
}}for(var f=0;
f<3;
f++){if(f==0||(f==1?a.length>(l?1:0):this.store.getCount()>1)){c.push(new cClipboardMenuItem({text:f==0?findLangS(this.subsystem,"grid","actualRow"):f==1?(a.length>1?findLangS(this.subsystem,"grid","selectionRows"):findLangS(this.subsystem,"grid","selectionRow")):findLangS(this.subsystem,"grid","table"),getClipText:function(n){return(Ext.isDefined(n.rowIndex)?getClipboardTableTextRow.call(this,n.rowIndex,null,null,n.csvParams,true):Ext.isDefined(n.selectionRecordsId)?getClipboardTableTextRow.call(this,null,n.selectionRecordsId,null,n.csvParams):getClipboardTableText.call(this,n.csvParams))
},getClipTextParams:{rowIndex:f==0?k:undefined,selectionRecordsId:f==1?b:undefined,csvParams:{fieldDelimiter:getCsvFieldSeparator(),rowDelimiter:"\n",endLineInField:"\n"}},hideOnClick:false,scope:this}))
}}return(c)
}function getClipboardTableTextCell(k,h,d,b,g){var f=g&&g.endLineInField||"\n";
var l=null;
var d=d||this.store.getAt(k);
var c=this.getColumnManager().getColumns();
var b=b||c[h];
if(d&&b&&b.dataIndex){l=d.data[b.dataIndex];
if(b.renderer){var a=Ext.apply({},b);
l=b.renderer(l,a,d,k,h,this.store,this.view)
}if(Ext.isDefined(l)&&l!==null){l=String(l).replaceall("<br>",f,"i").replaceall("</tr><tr","</tr>"+f+"<tr","i").removeTags(l)
}}return(l)
}function getClipboardTableTextRow(m,b,h,l,p){var g=l&&l.fieldDelimiter||getCsvFieldSeparator();
var a=l&&l.rowDelimiter||"\n";
var k=l&&l.endLineInField||"\n";
if(Ext.isArray(b)){var o=getClipboardTableTextHeader.call(this,l)+a;
for(var f=0;
f<b.length;
f++){o+=getClipboardTableTextRow.call(this,null,b[f],null,l)+a
}}else{var o=null;
var h=h||(Ext.isDefined(m)&&m!==null?this.store.getAt(m):this.store.getById(b));
var d=this.getColumnManager().getColumns();
for(var f=(this.rowExpander?1:0);
f<d.length;
f++){if(d[f].text&&!d[f].hidden&&!d[f].noCopyToClipboard){o=o===null?"":o+g;
var n=getClipboardTableTextCell.call(this,m,f,h,null,l);
if(n){var c=n.match(/[\n\"]+/)||n.match(g)||n.match(a)||n.match(k);
if(c){n=n.replaceall('"',"__``__").replaceall("__``__",'""')
}o+=(c?'"':"")+n+(c?'"':"")
}}}if(o&&p){o=getClipboardTableTextHeader.call(this,l)+a+o
}}return(o)
}function getClipboardTableTextHeader(h){var f=h&&h.fieldDelimiter||getCsvFieldSeparator();
var a=h&&h.rowDelimiter||"\n";
var g=h&&h.endLineInField||"\n";
var l=null;
var c=this.getColumnManager().getColumns();
for(var d=(this.rowExpander?1:0);
d<c.length;
d++){if(c[d].text&&!c[d].hidden&&!c[d].noCopyToClipboard){l=l===null?"":l+f;
var k=c[d].text;
if(k){k=String(k).replaceall("<br>",g,"i").replaceall("</tr><tr","</tr>"+g+"<tr","i").removeTags();
var b=k.match(/[\n\"]+/)||k.match(f)||k.match(a)||k.match(g);
if(b){k=k.replaceall('"',"__``__").replaceall("__``__",'""')
}l+=(b?'"':"")+k+(b?'"':"")
}}}return(l)
}function getClipboardTableText(d){var b=d&&d.rowDelimiter||"\n";
var c=getClipboardTableTextHeader.call(this,d)+b;
for(var a=0;
a<this.store.getCount();
a++){c+=getClipboardTableTextRow.call(this,a,null,null,d)+b
}return(c)
}function gridEmptyInfo(c,b,a){if(!c.body){return
}if(c.store._emptyInfo){if(c.store._emptyInfo.getEl()){c.store._emptyInfo.destroy()
}c.store._emptyInfo=null
}if(!c.store.getCount()){var d=c.body.getWidth();
if((d<10||d>2000)&&c.ownerCt){d=c.ownerCt.getWidth()
}c.store._emptyInfo=new Ext.Panel({layout:{type:"vbox",align:"center",pack:"center"},width:d,height:a||80,border:false,renderTo:c.body.down(".x-grid-view").id,items:{xtype:"displayfield",value:b||findLangS(c.subsystem,"grid","tableIsEmpty"),fieldStyle:{"font-weight":"bold","font-size":"120%"}}});
c.updateLayout()
}}function addGridPrefixClsCss(a){addRuleToStyleSheet("."+a+"-grid-cell-inner","overflow: hidden;-o-text-overflow: ellipsis;text-overflow: ellipsis;padding: 2px 6px 3px;white-space: nowrap;");
addRuleToStyleSheet("."+a+"-grid-rowwrap-div","border-width: 1px 0;border-color: #EDEDED;border-style: solid;border-top-color: #FAFAFA;overflow: hidden;");
addRuleToStyleSheet("."+a+"-cell","border-color: #EDEDED !important;border-top-color: #FAFAFA !important;");
addRuleToStyleSheet("."+a+"-grid-rowwrap-div ."+a+"-cell","border-width: 0;background: transparent;");
addRuleToStyleSheet("."+a+"-row-over ."+a+"-cell, ."+a+"-row-over ."+a+"-grid-rowwrap-div","background-color: #EFEFEF;border-color: #DDDDDD !important;");
addRuleToStyleSheet("."+a+"-row-focused ."+a+"-cell, ."+a+"-row-focused ."+a+"-grid-rowwrap-div","background-color: #EFEFEF;border-color: #DDDDDD !important;");
addRuleToStyleSheet("."+a+"-row-selected ."+a+"-cell, ."+a+"-row-selected ."+a+"-grid-rowwrap-div","background-color: #E0E0E0 !important;border-color: #BFB8B8 !important;border-style: dotted;");
addRuleToStyleSheet("."+a+"-row-selected ."+a+"-grid-cell-inner","background-color: #E0E0E0 !important;")
}function editIndirectRecord(b,d,c){var a=Ext.create(b,Ext.apply({enableAutoLoad:false,withoutGrid:true},c||{}));
a.loadRecordById(d,function(f,g){a.createEditWindow(0,null,{record:f.getAt(0)})
},this)
}Ext.define("Ext.ux.grid.Panel",{extend:"Ext.Panel",constructor:function(a){a=Ext.applyIf(a||{},{title:this.titleText||a.titleLang&&findLangS(a&&a.subsystem||this.subsystem,"title",a.titleLang),layout:"fit",items:{border:false,layout:"fit",items:a.gridConfig?Ext.apply({xtype:a.gridXType},a.gridConfig):{xtype:a.gridXType}}});
this.callParent([a])
},reactivate:function(){this.reloadGrid()
},reloadGrid:function(a){var b=this.getGrid(a);
if(b&&b.store){b.store.load()
}},getGrid:function(a){var b=null;
var c=this.gridXType;
this.cascade(function(d){if(d.xtype==c){b=d
}});
if(!b&&a){this.cascade(function(d){if(d instanceof Ext.grid.Panel){b=d
}})
}return(b)
},getGridExtraParams:function(a){var b=this.getGrid(a);
if(b&&b.store&&b.extraParams){return(b.extraParams)
}return({})
}});
Ext.override(Ext.grid.Panel,{getColumnsConfiguration:function(){if(!this.isDefinedOrigParams()){return(null)
}var a={};
var c=this.getColumnManager().getColumns();
for(var b=(this.rowExpander?1:0);
b<c.length;
b++){var f=c[b];
if(f.dataIndex&&!f.noColumnConfiguration){var g={};
if(!f.flex&&f.width!=f.width_orig){g.width=f.width
}if(f.hidden!=f.hidden_orig){g.hidden=f.hidden
}var h=b!=(this.rowExpander?1:0)?this.getColumnConfigIndex(b-1):null;
var d=b<c.length-1?this.getColumnConfigIndex(b+1):null;
if(h!=f.position_orig_after||d!=f.position_orig_before){g.position_after=h;
g.position_before=d
}if(isDataSet(g)){a[this.getColumnConfigIndex(b)]=g
}}}return(a)
},setColumnsConfiguration:function(b){if(!this.isDefinedOrigParams()){return
}this._ignore_saveConfig=true;
var f=this.getColumnManager().getColumns();
for(var l=(this.rowExpander?1:0);
l<f.length;
l++){var d=f[l];
var m=this.getColumnConfigIndex(l);
if(d.dataIndex&&b[m]){if(Ext.isDefined(b[m].width)&&b[m].width!=d.width){d.setWidth(b[m].width)
}if(Ext.isDefined(b[m].hidden)&&b[m].hidden!=d.hidden){if(d.getEl()){d.setVisible(!b[m].hidden)
}else{d.hidden=b[m].hidden
}}}}var p=[];
var f=this.getColumnManager().getColumns();
for(var l=(this.rowExpander?1:0);
l<f.length;
l++){var d=f[l];
var m=this.getColumnConfigIndex(l);
if(d.dataIndex&&b[m]&&(b[m].position_after||b[m].position_before)){p.push({configIndex:m,position_after:b[m].position_after,position_before:b[m].position_before})
}}if(p.length){for(pass=0;
pass<this.getColumnManager().getColumns().length;
pass++){var q=false;
for(var l=0;
l<p.length;
l++){var f=this.getColumnManager().getColumns();
for(var h=(this.rowExpander?1:0);
h<f.length;
h++){var o=this.getColumnConfigIndex(h);
if(o==p[l].configIndex){var c=h!=(this.rowExpander?1:0)?this.getColumnConfigIndex(h-1):null;
var a=h<f.length-1?this.getColumnConfigIndex(h+1):null;
if(p[l].position_before&&p[l].position_before!=a){for(var g=(this.rowExpander?1:0);
g<f.length;
g++){var n=this.getColumnConfigIndex(g);
if(n==p[l].position_before){this.headerCt.move(h,g);
q=true;
break
}}}else{if(p[l].position_after&&p[l].position_after!=c){for(var g=(this.rowExpander?1:0);
g<f.length;
g++){var n=this.getColumnConfigIndex(g);
if(n==p[l].position_after){this.headerCt.move(h,g+1);
q=true;
break
}}}}}}}if(!q){break
}}}delete this._ignore_saveConfig
},saveOrigParams:function(){var b=this.getColumnManager().getColumns();
for(var a=(this.rowExpander?1:0);
a<b.length;
a++){b[a].width_orig=b[a].width;
b[a].hidden_orig=b[a].hidden;
b[a].position_orig_after=a!=(this.rowExpander?1:0)?this.getColumnConfigIndex(a-1):null;
b[a].position_orig_before=a<b.length-1?this.getColumnConfigIndex(a+1):null
}},isDefinedOrigParams:function(){var b=this.getColumnManager().getColumns();
for(var a=(this.rowExpander?1:0);
a<b.length;
a++){if(Ext.isDefined(b[a].width_orig)||Ext.isDefined(b[a].hidden_orig)){return(true)
}}return(false)
},setConfigName:function(b){this._configName=b;
this.on("columnhide",this.saveConfig,this);
this.on("columnshow",this.saveConfig,this);
this.on("columnresize",this.saveConfig,this);
this.on("columnmove",this.saveConfig,this);
var a=this.getColumnManager().getColumns();
if(a.length&&!this.isDefinedOrigParams()){this.saveOrigParams()
}},applyConfig:function(c){if(c&&c!=this._configName){this.setConfigName(c)
}if(!this._configName){return
}var b=this.getColumnManager().getColumns();
if(b.length&&!this.isDefinedOrigParams()){this.saveOrigParams()
}var a=getConfigParameter("grid_configuration_"+this._configName);
if(a){this.setColumnsConfiguration(a)
}},saveConfig:function(){if(!this._configName||this._ignore_saveConfig){return
}var b=this.getColumnsConfiguration();
if(b!==null){var a=getConfigParameter("grid_configuration_"+this._configName);
if(!a||Ext.encode(a)!=Ext.encode(b)){setConfigParameter("grid_configuration_"+this._configName,b)
}}},getColumnConfigIndex:function(c){if(Ext.isNumber(c)){var b=this.getColumnManager().getColumns();
if(c<b.length){c=b[c]
}else{return(null)
}}if(!c.dataIndex){return(null)
}var a=c.dataIndex;
if(c.headerLang){a+="/"+c.headerLang
}return(a)
}});
function adjustHeightWindow(f,a,l,g,b){var k=f.getSize();
var c=false;
var d=0;
if(!l||l===true||l>Ext.dom.Element.getViewportHeight()-20){l=Ext.dom.Element.getViewportHeight()-20
}if(k.height>l){c=true;
d=(Ext.dom.Element.getViewportHeight()-l)/2
}if(c||b){if(g){a.body.setStyle({"padding-right":__width_Scroller+5});
a.updateLayout();
k=f.getSize()
}else{a.setAutoScroll(true)
}if(c){f.setSize(k.width,l)
}else{f.setSize(k.width,k.height)
}a.body.setStyle({"overflow-y":"auto"});
a.body.setStyle({"overflow-x":"hidden"});
var h=f.getPosition();
f.setPosition(h[0],c?d:h[1])
}}Ext.ns("Ext.ux.setting");
Ext.define("Ext.ux.setting.Form",{extend:"Ext.FormPanel",constructor:function(b){if(b.subsystem){this.subsystem=b.subsystem
}Ext.applyIf(b,{widthLabel_char:30,widthField_char:30,smartPosButtons:true});
var d=[{text:lang.save,iconCls:"icon_save",scope:this,handler:this.save,disabled:b.smartSaveButton,_id:"save"}];
if(b.nextButtons){d=d.concat(b.nextButtons)
}var a=this.createItems(b);
if(b.smartPosButtons){var f=[];
for(var c=0;
c<d.length;
c++){f.push(cloneObject(d[c]));
Ext.applyIf(f[c],{xtype:"button",style:{padding:10,paddingTop:2,paddingBottom:1,marginLeft:5,marginRight:5}})
}a.push({xtype:"container",_id:"buttonsContainer",layout:"hbox",items:[{xtype:"container",layout:{type:"hbox",pack:"center",align:"middle"},items:f,width:__width_FormChar(b.widthLabel_char,b.widthField_char)+5,style:{"background-color":__color_PanelBorder,padding:10}},{xtype:"container",flex:1}],style:{marginTop:20}})
}b=Ext.applyIf(b,{items:a,buttons:{items:d,style:{"background-color":__color_PanelBorder,padding:10,marginTop:1}},buttonAlign:"center",listeners:{scope:this,afterrender:this.load,beforedeactivate:this.beforeDeactivateControl,destroy:function(){delete window.settingForms[this.id]
},resize:this.evResize},border:false,bodyStyle:__style_FormBackground({padding:5}),autoScroll:true});
this.callParent([b]);
if(!Ext.isDefined(window.settingForms)){window.settingForms={}
}window.settingForms[this.id]=this
},createItems:function(f){var b=[];
for(var h=0;
h<f.settingTableStruct.length;
h++){var d=findLangS(this.subsystem,"field",f.settingTableStruct[h].name);
if(!d){d=f.settingTableStruct[h].name;
d=d.replaceall("_"," ")
}var g=findLangS(this.subsystem,"field_help",f.settingTableStruct[h].name);
var a={};
if(f.specItems&&f.specItems[f.settingTableStruct[h].name]){Ext.applyIf(a,f.specItems[f.settingTableStruct[h].name])
}if(a.skip){continue
}if(a.xtype=="container"&&a.layout=="hbox"){if(a.items&&a.items.length){for(var c=0;
c<a.items.length;
c++){if(f.defaultItem){Ext.applyIf(a.items[c],f.defaultItem)
}Ext.applyIf(a.items[c],{xtype:"textfield",width:(a.items[c]._width||__width_FieldChar(f.widthField_char))+__width_FieldChar(f.widthLabel_char),labelWidth:__width_FieldChar(f.widthLabel_char),labelAlign:"right"})
}}}else{if(f.defaultItem){Ext.applyIf(a,f.defaultItem)
}Ext.applyIf(a,{xtype:"textfield",name:f.settingTableStruct[h].name,fieldLabel:d,width:(a._width||__width_FieldChar(f.widthField_char))+__width_FieldChar(f.widthLabel_char),labelWidth:__width_FieldChar(f.widthLabel_char),labelAlign:"right"});
if(g){a.helpText=g
}}b.push(a);
if(f.specItems&&f.specItems[f.settingTableStruct[h].name]&&f.specItems[f.settingTableStruct[h].name].nextItem){b.push(f.specItems[f.settingTableStruct[h].name].nextItem)
}}recurseCascadeApplyIf(b,{listeners:{}},"listeners",{change:this.changeField,select:this.changeField,scope:this});
return(b)
},changeField:function(){this.setContext();
if(this._readyForEvChange){this._change=true;
if(this.autoSave){this.save(true)
}if(this.smartSaveButton){this.enableBtn("save",true)
}}},startCheckChangeField:function(){this._change=false;
this._readyForEvChange=true;
if(this.smartSaveButton){this.enableBtn("save",false)
}},setContext:function(){},beforeDeactivateControl:function(a,b){return(this.checkChangeFields(function(){if(b.ownerCt&&b.ownerCt.setActiveTab){b.ownerCt.setActiveTab(b)
}}))
},checkChangeFields:function(a,b){if(this.promptSave&&this._change){this._change=false;
Ext.defer(function(){Ext.Msg.confirm(lang.msgSaveQuestionTitle,lang.msgSaveQuestionText,function(c){if(c=="yes"){this.save()
}a.call(b||this)
},this)
},100,this);
return(false)
}else{return(true)
}},load:function(){this.maskLoad();
var c=this;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getConfigRecord",params:Ext.encode({table:this.settingTableName})},success:function(d){if(!d.record){d.record=this.getDefaultValues()
}for(var f in d.record){var g=this.getForm().findField(f);
if(g){g.setValue(d.record[f])
}}b()
}});
function a(){var d=true;
c.cascade(function(f){if(f.isStoreOk&&!f.isStoreOk()){d=false;
return(false)
}});
return(d)
}function b(){if(a()){c.unmask();
c.setContext();
c.startCheckChangeField()
}else{var d=0;
var f={run:function(){if(!c.getEl()||!c.getEl().dom){Ext.TaskManager.stop(f)
}else{if(d&&a()||d>100){c.unmask();
c.setContext();
c.startCheckChangeField();
Ext.TaskManager.stop(f)
}}++d
},interval:250};
Ext.TaskManager.start(f)
}}},save:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setConfigRecord",params:Ext.encode({record:this.getForm().getFieldValues(),table:this.settingTableName})},success:function(b){this._change=false;
if(this.onSaveSuccess){this.onSaveSuccess()
}if(this.smartSaveButton){this.enableBtn("save",false)
}},maskEl:a?undefined:this})
},getDefaultValues:function(){return({})
},isVisibleForm:function(){var a=this;
do{if(a.isVisible&&!a.isVisible()){return(false)
}a=a.ownerCt
}while(a);
return(true)
},getFieldValues:function(){var a=this.getForm();
if(a){return(a.getFieldValues())
}},getField:function(a){var b=this.getForm();
if(b){return(b.findField(a))
}},enableIf:function(b,a){if(Ext.isArray(b)){for(var c=0;
c<b.length;
c++){this.enableIf(b[c],a)
}}else{var d=this.getForm();
if(d){var f=d.findField(b);
if(f){f.enableIf(a)
}}}},enableBtn:function(g,b){var d=this.getDockedItems();
if(d.length){var f=d[0];
var c=f.findC("_id","save");
if(c){c.enableIf(b)
}}if(this.smartPosButtons){var a=this.findC("_id","buttonsContainer");
if(a){var c=a.findC("_id","save");
if(c){c.enableIf(b)
}}}},evResize:function(){if(this.smartPosButtons){var b=this.findC("_id","buttonsContainer");
var f=this.getDockedItems();
if(b&&f.length){var g=f[0];
var k=0;
var a=this.getForm().getFields();
for(var d=0;
d<a.length;
d++){var c=a.items[d].getClientRegion().bottom-this.getClientRegion().top;
if(c>k){k=c
}}var h=this.getHeight()>k*2;
b.showIf(h);
g.showIf(!h)
}}}});
function getVisibleSettingForm(){if(!Ext.isDefined(window.settingForms)){return(null)
}for(var a in window.settingForms){if(window.settingForms[a].isVisibleForm()){return(window.settingForms[a])
}}return(null)
}function evChangeAppPanelSettingForm(c,k,h,b,g,d){var a=arguments;
var f=getVisibleSettingForm();
if(f){return(f.checkChangeFields(function(){showPanel.apply(this,a)
},this))
}return(true)
}Ext.ns("Ext.ux.priority");
Ext.define("Ext.ux.priority.Table",{extend:"Ext.grid.Panel",alias:"widget.priorityTable",constructor:function(c){var o="priorityTable";
var p=this;
if(!Ext.ClassManager.isCreated(o)){Ext.define(o,{extend:"Ext.data.Model",fields:[{name:"name"},{name:"code"},{name:"enable",type:"boolean"},{name:"data"}],idProperty:"code"})
}var r=Ext.create("Ext.data.ArrayStore",{model:o,data:[],grid:this});
var q=[];
if(c.editPanel){q.push({getClass:function(t,u,w){return("icon_edit")
},handler:function(u,z,t,v,w){var y=u.store.getAt(z);
p.createEditWindow(y)
},tooltip:function(t,u,w){return(lang.tooltip.edit)
},scope:this})
}q.push({getClass:function(t,u,w){return(w.data.enable?"icon_ok":"icon_cross")
},handler:function(u,z,t,v,w){var y=u.store.getAt(z);
if(y.data.enable){h(y)
}else{m(y)
}},tooltip:function(t,u,w){return(w.data.enable?lang.tooltip.disable:lang.tooltip.enable)
},scope:this},{getClass:function(y,z,A,B,t,w,u){return(a(A)?"icon_arrow_up":"icon_blank_w16")
},handler:function(t,z,u,v,w){var y=t.store.getAt(z);
if(a(y)){k(y)
}},enableHandler:function(y,z,A,B,t,w,u){return(a(A))
},tooltip:lang.tooltip.moveUp,scope:this},{getClass:function(y,z,A,B,t,w,u){return(d(A)?"icon_arrow_down":"icon_blank_w16")
},handler:function(t,z,u,v,w){var y=t.store.getAt(z);
if(d(y)){s(y)
}},enableHandler:function(y,z,A,B,t,w,u){return(d(A))
},tooltip:lang.tooltip.moveDown,scope:this});
var f=[{xtype:"actioncolumn",dataIndex:"name",rendererBase:n,items:q,iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: "+(q.length*16+2),flex:1}];
if(c.dataColumn){if(Ext.isObject(c.dataColumn)){f.push(c.dataColumn)
}else{f.push({xtype:"actioncolumn",dataIndex:"data",rendererBase:function(y,t,u,z,w,v){if(u.data.enable){if(v.grid.rendererDataColumn){return(v.grid.rendererDataColumn.call(this,y,t,u,z,w,v))
}}return("")
},items:[{getClass:function(y,A,B,C,t,w,u){var z=B.data.enable&&w.grid.enableHandlerDataColumn&&w.grid.enableHandlerDataColumn.call(w.grid.handlerDataColumnScope||this,y,A,B,C,t,w,u);
return(z?"icon_wrench":"icon_blank")
},handler:function(u,z,t,v,w){var y=u.store.getAt(z);
if(y.data.enable){if(u.ownerCt.handlerDataColumn){u.ownerCt.handlerDataColumn.call(u.ownerCt.handlerDataColumnScope||this,y,u,z,t,v,w)
}}},enableHandler:function(y,z,A,B,t,w,u){if(A.data.enable){if(w.grid.enableHandlerDataColumn){return(w.grid.enableHandlerDataColumn.call(w.grid.handlerDataColumnScope||this,y,z,A,B,t,w,u))
}return(true)
}return(false)
},tooltip:c.tooltipDataColumn,scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20",flex:c.flexDataColumn||1})
}}c=Ext.applyIf(c||{},{store:r,columns:f,hideHeaders:true,viewConfig:{stripeRows:false},isFormField:true,catchAllEventsField:false,codeDataIndex:0,nameDataIndex:1});
var g=[];
if(c.tbarAdd){g.push({text:lang.add,iconCls:"icon_add",handler:function(){p.createEditWindow()
},_btnId:"add"})
}if(c.tbarRemove){g.push({text:lang.remove,iconCls:"icon_remove",handler:function(){p.removeSelectedData()
},_btnId:"remove",disabled:true})
}if(g.length){c.tbar=g
}this.callParent([c]);
this.selModel.on("selectionchange",l,this);
this.fillAllItems(false);
function n(z,v,u,A,y,w,t){if(p.dataRenderer){return(p.dataRenderer(u.data.data))
}else{return(renderString.apply(this,arguments))
}}function a(t){if(!t.data.enable){return(false)
}var u=r.indexOf(t);
return(u>0)
}function d(t){if(!t.data.enable){return(false)
}var u=r.indexOf(t);
if(u>=r.getCount()-1){return(false)
}var v=r.getAt(u+1);
return(v.data.enable)
}function k(t){var u=r.indexOf(t);
r.removeAt(u);
r.insert(u-1,t);
r.grid.repaintRecord(r.getAt(u));
r.grid.selModel.select(t);
r.grid.fireEvChange()
}function s(t){var u=r.indexOf(t);
r.removeAt(u);
r.insert(u+1,t);
r.grid.repaintRecord(r.getAt(u));
r.grid.selModel.select(t);
r.grid.fireEvChange()
}function h(t){r.grid.disableRecord(t)
}function m(t){r.grid.enableRecord(t)
}function b(){return(r.grid.getCountEnable())
}function l(u){var w=u.getSelection();
var v=this.getTopToolbar();
if(v){var t=v.findC("_btnId","remove",true);
if(t){t.enableIf(w.length==1)
}}}},fillItem:function(b,a){this.store.add({name:getDataArrayItem(this.tableItems,b,this.codeDataIndex,this.nameDataIndex),code:b,enable:a})
},fillAllItems:function(a){if(this.tableItems){for(var b=0;
b<this.tableItems.length;
b++){this.fillItem(this.tableItems[b][this.codeDataIndex],a)
}}},addData:function(b,a){this.store.add({data:Ext.encode(b),enable:Ext.isDefined(a)?a:b.enable});
this.repaintAll();
this.fireEvChange()
},modifyData:function(a,b){a.data.data=Ext.encode(b);
this.repaintRecord(a);
this.fireEvChange()
},removeSelectedData:function(){var a=this.getSelectionModel();
var b=a.getSelection();
if(b&&b.length==1){this.removeRecord(b[0])
}},removeRecord:function(a){this.store.remove(a);
this.repaintAll();
this.fireEvChange()
},getName:function(){return(this.name)
},setValue:function(b){if(this.dataArray){this.store.removeAll();
if(b){var f=Ext.decode(b);
for(var d=0;
d<f.length;
d++){this.addData(f[d])
}}}else{var a=this.store.getAt(0);
while(a.data.enable){this.disableRecord(a,true,true);
a=this.store.getAt(0)
}if(b){if(this.dataColumn){for(var d in b){for(var c=0;
c<this.store.getCount();
c++){a=this.store.getAt(c);
if(a.data.code==d){this.enableRecord(a,true,true);
if(b[d]){a.data.data=b[d]
}else{if(a.data.data){delete a.data.data
}}break
}}}}else{b=b.split(",");
for(var d=0;
d<b.length;
d++){for(var c=0;
c<this.store.getCount();
c++){a=this.store.getAt(c);
if(a.data.code==b[d]){this.enableRecord(a,true,true);
break
}}}}}}this.repaintAll();
this.selModel.deselectAll();
this.setScrollY(0)
},getValue:function(){if(this.dataArray){var f=[];
for(var c=0;
c<this.store.getCount();
c++){var a=this.store.getAt(c);
var d=Ext.decode(a.data.data);
if(this.dataEnable){d.enable=a.data.enable
}f.push(d)
}return(Ext.encode(f))
}else{if(this.dataColumn){var b={};
for(var c=0;
c<this.store.getCount();
c++){var a=this.store.getAt(c);
if(a.data.enable){b[a.data.code]=a.data.data||{}
}}return(b)
}else{var b=[];
for(var c=0;
c<this.store.getCount();
c++){var a=this.store.getAt(c);
if(a.data.enable){b.push(a.data.code)
}}return(b.join(","))
}}},getSubmitData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},getModelData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},isValid:function(){return(true)
},validate:function(){return(true)
},clearInvalid:function(){},isFileUpload:function(){return(false)
},isDirty:function(){return(false)
},repaintAll:function(){for(var a=0;
a<this.store.getCount();
a++){this.repaintRecord(this.store.getAt(a),a)
}},repaintRecord:function(a,b){if(!Ext.isDefined(b)){b=this.store.indexOf(a)
}if(this.view.all.item(b)){a.store.afterEdit(a,["name"])
}},disableRecord:function(b,d,g){var c=this.store.indexOf(b);
this.store.removeAt(c);
var a=this.getCountEnable();
b.data.enable=false;
var f=a;
while(f<this.store.getCount()&&this.store.getAt(f).data.code<b.data.code){++f
}this.store.insert(f,b);
if(!d){this.repaintAll()
}if(!g){this.selModel.deselectAll()
}if(this.onChange){this.onChange.call(this.onChangeScope)
}this.fireEvChange()
},enableRecord:function(b,d,f){var c=this.store.indexOf(b);
this.store.removeAt(c);
var a=this.getCountEnable();
b.data.enable=true;
this.store.insert(a,b);
if(!d){this.repaintAll()
}if(!f){this.selModel.select(b)
}if(this.onChange){this.onChange.call(this.onChangeScope)
}this.fireEvChange()
},enable:function(){this.callParent();
this.unmask()
},disable:function(){this.callParent()
},getCountEnable:function(){var b=0;
for(var a=0;
a<this.store.getCount();
a++){if(this.store.getAt(a).data.enable){++b
}}return(b)
},createEditWindow:function(a){var b=this.editPanel(a);
var c=new Ext.Window({title:a?this.titleEdit:this.titleAdd,iconCls:a?"icon_edit":"icon_add",items:b,border:false,plain:true,modal:true});
c.show()
},fireEvChange:function(){this.fireEvent("change",this)
}});
Ext.define("Ext.ux.andOrCombination.Table",{extend:"Ext.grid.Panel",alias:"widget.andOrCombinationTable",constructor:function(a){var g=this;
var f=a.modelName||"andOrCombinationTable";
this.modelFields=[];
if(a.fields){this.modelFields=a.fields
}else{this.modelFields=[{name:"logic_level",type:"int"}];
if(a.fieldNot){this.modelFields.push({name:"not",type:"int"})
}if(a.fieldId){this.modelFields.push({name:"id",type:"int"})
}if(a.fieldsNext){this.modelFields=this.modelFields.concat(a.fieldsNext)
}}if(!Ext.ClassManager.isCreated(f)){Ext.define(f,{extend:"Ext.data.Model",fields:this.modelFields})
}var h=Ext.create("Ext.data.ArrayStore",{model:f,data:[],grid:this});
var b=[];
b.push({xtype:"actioncolumn",header:lang.columns.delete_order,rendererBase:renderString,items:[{getClass:function(m,n,o){return("icon_delete_small")
},handler:function(n,r,m,o,p){var q=n.store.getAt(r);
if(q){this._processingDelete=true;
this.store.remove(q);
this.fixLogicLevels();
this.repaintAll();
this.setLogicRslt();
this.fireEvChange();
Ext.defer(function(){delete this._processingDelete
},100,this)
}},tooltip:lang.tooltip["delete"],scope:this},{getClass:function(p,q,r,s,m,o,n){return(this.enableRecordUp(r)?"icon_arrow_up":"icon_blank_w16")
},handler:function(m,r,n,o,p){var q=m.store.getAt(r);
if(this.enableRecordUp(q)){this.recordUp(q)
}},enableHandler:function(p,q,r,s,m,o,n){return(this.enableRecordUp(r))
},tooltip:lang.tooltip.moveUp,scope:this},{getClass:function(p,q,r,s,m,o,n){return(this.enableRecordDown(r)?"icon_arrow_down":"icon_blank_w16")
},handler:function(m,r,n,o,p){var q=m.store.getAt(r);
if(this.enableRecordDown(q)){this.recordDown(q)
}},enableHandler:function(p,q,r,s,m,o,n){return(this.enableRecordDown(r))
},tooltip:lang.tooltip.moveDown,scope:this}],width:16*3+4,sortable:false});
b.push({xtype:"actioncolumn",dataIndex:"logic_level",header:lang.columns.and_or_level,rendererBase:k,items:[{getClass:function(p,q,r,s,m,o,n){return(this.enableLevelDown(r)?"icon_arrow_left":"icon_blank_w16")
},handler:function(m,r,n,o,p){var q=m.store.getAt(r);
if(this.enableLevelDown(q)){this.levelDown(q)
}},enableHandler:function(p,q,r,s,m,o,n){return(this.enableLevelDown(r))
},tooltip:lang.tooltip.decrease_and_or_level,scope:this},{getClass:function(p,q,r,s,m,o,n){return(this.enableLevelUp(r)?"icon_arrow_right":"icon_blank_w16")
},handler:function(m,r,n,o,p){var q=m.store.getAt(r);
if(this.enableLevelUp(q)){this.levelUp(q)
}},enableHandler:function(p,q,r,s,m,o,n){return(this.enableLevelUp(r))
},tooltip:lang.tooltip.increase_and_or_level,scope:this}],iconDivStyle:"float:left; height:15; width: 30; padding-top: 2px;",baseContentDivStyle:"padding-left: 40",width:a.logic_level_width||270,sortable:false});
if(a.fieldNot||a.columnNot){b.push({xtype:"checkcolumn",dataIndex:"not",header:lang.columns.not,width:30,sortable:false,listeners:{scope:this,checkchange:function(o,n,p){var m=g.store.getAt(n);
if(m){m.data.not=p?1:0;
m.commit();
this.setLogicRslt();
this.fireEvChange()
}}}})
}if(a.fieldId&&a.columnId!==false||a.columnId){b.push({dataIndex:"id",header:lang.columns.id,renderer:l,width:30,sortable:false})
}if(a.columnsNext){b=b.concat(a.columnsNext)
}var c=undefined;
if(a.tbar){if(!c){c=[]
}c=c.concat(a.tbar)
}var d=undefined;
if(a.cellediting){if(!d){d=[]
}d=d.concat({ptype:"cellediting",clicksToEdit:1})
}a=Ext.applyIf(a||{},{store:h,columns:b,viewConfig:{stripeRows:false},isFormField:true,plugins:d,tbar:c,listeners:{}});
Ext.applyIf(a.listeners,{scope:this,afterrender:this.onAfterRender});
if(a.cellediting){Ext.applyIf(a.listeners,{edit:function(m,n){this.onAfterEditRecord(n.record);
n.record.commit()
}})
}this.callParent([a]);
this.selModel.on("selectionchange",this.onSelectionChange,this);
if(this.dblClickToEdit&&this.editFce){this.on("celldblclick",function(m){var n=this.selModel.getSelection();
if(n.length){this.editFce(this,n[0])
}},this)
}this.onSelectionChange();
if(a.value){this.setValue(a.value)
}function k(s,v,o,r,p,t){if(Ext.isEmpty(r)){r=t.indexOf(o)
}v.style="padding: 0";
var w=20;
var q='<table style="border: none; border-collapse: collapse; padding: 0; margin: 0;table-layout: fixed; font: '+__font_Grid+';">';
var m=0;
var u="";
if(r>0){if(o.data.logic_level&&g.getLogicLevelInPrevRecord(o)<o.data.logic_level){m=o.data.logic_level*2-1;
u="AND"
}else{if(g.getPrevRecordInLogicLevel(o)){m=o.data.logic_level*2;
u="OR"
}}}else{u="base"
}for(var n=0;
n<m;
n++){q+='<td style="width: '+w+'px; text-align: center;">';
if(n==m-1){q+=u=="OR"?'<table style="border-collapse: collapse; padding: 0; margin: 0; width: 100%; height: 100%;"><td style="height: 9px;"><td style="height: 9px; border-left: 1px solid blue; border-bottom: 1px solid blue"><tr><td style="height: 10px;"><td style="height: 10px;'+(g.existsLevelInNextRecords(o,parseInt((n+1)/2))?" border-left: 1px solid blue;":"")+'"></table>':'<table style="border-collapse: collapse; padding: 0; margin: 0; width: 100%; height: 100%;"><td style="height: 9px;"><td style="height: 9px; border-left: 1px solid blue; border-bottom: 1px solid blue"><tr><td style="height: 10px;"><td style="height: 10px;"></table>'
}else{if(n%2&&g.existsLevelInNextRecords(o,parseInt((n+1)/2))){q+='<table style="border-collapse: collapse; padding: 0; margin: 0; width: 100%; height: 100%;"><td style="height: 9px;"><td style="height: 9px; border-left: 1px solid blue;"><tr><td style="height: 10px;"><td style="height: 10px; border-left: 1px solid blue;"></table>'
}}}q+='<td style="padding-top: 0px; height: 19px; color: blue;">'+u+"</td>";
q+="</table>";
return(q)
}function l(q,m,n,r,p,o){return('<span style="font-size: 80%;">'+q+"</span>")
}},onAfterRender:function(){Ext.defer(function(){this.onSelectionChange();
this.setLogicRslt()
},100,this)
},onAfterEditRecord:function(a){this.setLogicRslt();
this.fireEvChange()
},onSelectionChange:function(a){var d=this.selModel.getSelection();
d&&d.length==1?d[0]:false;
for(var c=0;
c<2;
c++){var g=c==0?this.getTopToolbar():this.getBottomToolbar();
if(g){for(var b=0;
b<g.items.getCount();
b++){var f=g.items.get(b);
if(f.autoEnableIfSelectedRecord){f.enableIf(d&&d.length==1)
}}}}},getSelectedRecord:function(){var a=this.selModel.getSelection();
return(a&&a.length==1?a[0]:false)
},addRecord:function(f){var g=false;
for(var b=0;
b<this.modelFields.length;
b++){if(this.modelFields[b].name=="id"){g=true
}}if(g&&!Ext.isDefined(f.id)){f.id=this.getMaxId()+1
}var a=new Ext.create(this.store.config.model,f);
var c=this.selModel.getSelection();
if(c.length==1){var d=this.store.indexOf(c[0]);
this.store.insert(d+1,a);
this.store.grid.selModel.select(a)
}else{this.store.add(a)
}this.repaintAll();
this.setLogicRslt();
this.fireEvChange();
return(a)
},updateRecord:function(c,a){a.beginEdit();
for(var b in c){a.data[b]=c[b]
}a.commit();
a.endEdit();
this.repaintAll();
this.setLogicRslt();
this.fireEvChange()
},startCellEdit:function(a){this.focus();
this.findPlugin("cellediting").startEdit(a,this.headerCt.find("dataIndex","template_id")[0])
},getPrevRecordInLogicLevel:function(b){var d=this.store.indexOf(b);
if(d<0){return(false)
}for(var c=d;
c>=0;
c--){var a=this.store.getAt(c);
if(a.data.logic_level==b.data.logic_level){return(a)
}}return(null)
},getNextRecordInLogicLevel:function(a){var d=this.store.indexOf(a);
if(d<0){return(false)
}for(var b=d;
b<this.store.getCount();
b++){var c=this.store.getAt(b);
if(c.data.logic_level==a.data.logic_level){return(c)
}}return(null)
},getLogicLevelInPrevRecord:function(b){var c=this.store.indexOf(b);
if(c<=0){return(false)
}var a=this.store.getAt(c-1);
return(a.data.logic_level)
},getLogicLevelInNextRecord:function(a){var c=this.store.indexOf(a);
if(c<0||c>=this.store.getCount()-1){return(false)
}var b=this.store.getAt(c+1);
return(b.data.logic_level)
},existsLevelInNextRecords:function(a,b){if(!b){return(false)
}var f=this.store.indexOf(a);
if(f<0||f>=this.store.getCount()-1){return(false)
}for(var c=f+1;
c<this.store.getCount();
c++){var d=this.store.getAt(c);
if(d.data.logic_level==b){return(true)
}else{if(d.data.logic_level<b){break
}}}return(false)
},enableRecordUp:function(a){var b=this.store.indexOf(a);
return(b>0)
},enableRecordDown:function(a){var b=this.store.indexOf(a);
return(b<this.store.getCount()-1)
},recordUp:function(a){var b=this.store.indexOf(a);
this.store.removeAt(b);
this.store.insert(b-1,a);
this.store.grid.repaintRecord(this.store.getAt(b));
this.store.grid.selModel.select(a);
this.fixLogicLevels();
this.repaintAll();
this.setLogicRslt();
this.fireEvChange()
},recordDown:function(a){var b=this.store.indexOf(a);
this.store.removeAt(b);
this.store.insert(b+1,a);
this.store.grid.repaintRecord(this.store.getAt(b));
this.store.grid.selModel.select(a);
this.fixLogicLevels();
this.repaintAll();
this.setLogicRslt();
this.fireEvChange()
},enableLevelUp:function(b){if(b.data.logic_level==5){return(false)
}var c=this.store.indexOf(b);
if(c==0){return(false)
}var a=this.store.getAt(c-1);
return(b.data.logic_level<=a.data.logic_level)
},enableLevelDown:function(a){return(a.data.logic_level>0)
},levelUp:function(b){var c=this.store.indexOf(b);
if(c==0){return
}var a=this.store.getAt(c-1);
if(a.data.logic_level==b.data.logic_level){++b.data.logic_level
}else{if(a.data.logic_level>b.data.logic_level){++b.data.logic_level
}}b.commit();
this.fixLogicLevels();
this.repaintAll();
this.setLogicRslt();
this.fireEvChange()
},levelDown:function(a){--a.data.logic_level;
a.commit();
this.fixLogicLevels();
this.repaintAll();
this.setLogicRslt();
this.fireEvChange()
},fireEvChange:function(){this.fireEvent("change",this)
},fixLogicLevels:function(a){var b=-1;
for(var c=0;
c<this.store.getCount();
c++){var a=this.store.getAt(c);
if(a.data.logic_level>b+1){a.data.logic_level=b+1;
this.repaintRecord(a,c)
}var b=a.data.logic_level
}},repaintAll:function(){for(var a=0;
a<this.store.getCount();
a++){this.repaintRecord(this.store.getAt(a),a)
}},repaintRecord:function(a,b){if(!Ext.isDefined(b)){b=this.store.indexOf(a)
}if(this.view.all.item(b)){a.store.afterEdit(a)
}},getLogicRslt:function(g){var a=false;
if(!g){a=true;
if(!this.store.getCount()){return(false)
}else{g=this.store.getAt(0)
}}var k="";
var c=g.data.logic_level;
var d=this.store.indexOf(g);
var h=0;
for(var f=d;
f<this.store.getCount();
f++){var g=this.store.getAt(f);
if(g.data.logic_level<c){break
}var b=!k?null:(g.data.logic_level==c?"OR":"AND");
if(b=="AND"){var l=this.getLogicRslt(g);
if(l[0]=="("&&!l.match("OR")){l=l.substr(1,l.length-2)
}while((f+1)<this.store.getCount()&&this.store.getAt(f+1).data.logic_level>c){++f
}}else{l=(g.data.not?"not(":"")+(this.logicRsltItemRenderer?this.logicRsltItemRenderer(g):"[id:"+g.data.id+"]")+(g.data.not?")":"")
}if(b){k=k+" "+b+" "+l
}else{k=l
}if(b){++h
}}if(h&&!a){k="("+k+")"
}return(k)
},setLogicRslt:function(){},getRecordForId:function(c){for(var b=0;
b<this.store.getCount();
b++){var a=this.store.getAt(b);
if(a.data.id==c){return(a)
}}return(false)
},getMaxId:function(){var a=0;
this.store.each(function(b){if(b.data.id>a){a=b.data.id
}});
return(a)
},getName:function(){return(this.name)
},setValue:function(d){this.store.removeAll();
if(!Ext.isArray(d)){if(d&&d.split&&d!=""){d=d.split("\n")
}else{d=null
}}if(d){for(var c=0;
c<d.length;
c++){var a=this.fieldSeparator?d[c].split(this.fieldSeparator):Ext.JSON.decode(d[c]);
var f={};
for(var b=0;
b<this.modelFields.length;
b++){f[this.modelFields[b].name]=a[b]||"";
if(this.modelFields[b].type=="int"){f[this.modelFields[b].name]*=1
}}this.store.add(f)
}this.fixLogicLevels();
this.repaintAll()
}this.setLogicRslt()
},getValue:function(){if(!this.store.getCount()){return(null)
}var a=[];
this.store.each(function(b){var d=[];
for(var c=0;
c<this.modelFields.length;
c++){d.push(b.data[this.modelFields[c].name]||(this.modelFields[c].type=="int"?0:""))
}a.push(this.fieldSeparator?d.join(this.fieldSeparator):Ext.JSON.encode(d))
},this);
return(a.join("\n"))
},getSubmitData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},getModelData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},isValid:function(){return(true)
},validate:function(){return(true)
},clearInvalid:function(){},isFileUpload:function(){return(false)
},isDirty:function(){return(false)
}});
Ext.ns("Ext.ux");
Ext.define("Ext.ux.ToolsPanel",{extend:"Ext.Panel",constructor:function(f){Ext.applyIf(f,{rsltSeparator:"<br><br><br>"});
if(f.formConfig&&!f.formConfig.labelWidth&&(f.formConfig.labelChar||f.formConfig.labelCh)){f.formConfig.labelWidth=__width_FieldChar(f.formConfig.labelChar||f.formConfig.labelCh)
}this.runButton=new Ext.Button({text:this.Lrun,handler:h,scope:this,disabled:f.runDisabled});
this.clearButton=new Ext.Button({text:this.Lclear,handler:d,scope:this,disabled:true});
var c=f.formItems;
c.push({layout:"hbox",style:{paddingTop:5,paddingLeft:150},items:[this.runButton,{width:5,border:false},this.clearButton]});
completeFormFields(c,true,f.formPanel);
this.questionForm=new Ext.form.FormPanel(Ext.applyIf(f.formConfig||{},{items:c,keys:[{key:Ext.event.Event.ENTER,handler:h,scope:this}],bodyStyle:__style_FormBackground({padding:5}),border:false,defaults:{bodyStyle:__style_FormBackground(),border:false},autoHeight:true,region:"north",listeners:{afterrender:b,_changefield:a,scope:this}}));
this.answerPanel=new Ext.Panel({title:this.answerTitle,border:false,style:{"border-top":"1px solid #D7D7D7"},bodyStyle:{padding:5},autoScroll:true,region:"center",listeners:{afterrender:g,scope:this}});
f=Ext.applyIf(f||{},{id:"mtr-panel",iconCls:"icon_menu_mtr",layout:"border",items:[this.questionForm,this.answerPanel]});
this.callParent([f]);
function h(){this.run()
}function d(){this.clearAnswer()
}function b(){var k=this.questionForm;
Ext.create("Ext.util.KeyNav",k.el,{enter:h,scope:this});
k.getForm().getFields().each(function(l){catchAllEventsField(l,k,"_changefield")
});
this.updateLayout();
Ext.defer(this.updateLayout,200,this)
}function g(){this.clearAnswer()
}function a(n,k,p,o,m,l){if(n!="_afterrenderfields"){this.enableButtons()
}}},enableButtons:function(){this.runButton.enableIf(this.isOkQuery?this.isOkQuery(this.questionForm.getForm().getFieldValues()):true);
this.clearButton.enableIf(this.getAnswer(true))
},getAnswer:function(b){var a=this.answerPanel.body.dom.innerHTML;
return b?(a&&a.length||0):a
},addToAnswer:function(a){if(this.htmlFormatRslt){htmlRslt=this.htmlFormatRslt(a,this.questionForm.getForm().getFieldValues())
}else{htmlRslt=a.rslt
}if(htmlRslt&&htmlRslt.length){this.answerPanel.body.dom.innerHTML=htmlRslt+(this.answerPanel.body.dom.innerHTML?this.rsltSeparator+this.answerPanel.body.dom.innerHTML:"");
this.enableButtons()
}},clearAnswer:function(){this.answerPanel.body.dom.innerHTML="";
this.enableButtons()
},run:function(){ajaxSafeRequest({scope:this,url:this.url,params:{task:this.task,params:Ext.encode(this.questionForm.getForm().getFieldValues())},success:function(a){this.addToAnswer.call(this,a)
},maskEl:this})
},getField:function(a){if(this.questionForm&&this.questionForm.getForm){return(this.questionForm.getForm().findField(a))
}return(null)
}});
Ext.override(Ext.ux.ToolsPanel,{Lrun:"run",Lclear:"clear result"});
Ext.ns("Ext.ux.listviewedit");
Ext.define("Ext.ux.listviewedit.Panel",{extend:"Ext.grid.Panel",constructor:function(a){this.mainBaseFieldName="field";
this.valueSeparator=a.valueSeparator||";";
this.valueSeparatorAlter=a.valueSeparatorAlter||"\n";
this.store=new Ext.data.ArrayStore({fields:a.fieldsStore||[this.mainBaseFieldName]});
var c=[{xtype:"actioncolumn",items:[{getClass:function(d,f,g){return("icon_delete_small")
},handler:function(f,l,d,g,h){var k=f.store.getAt(l);
if(k){this._processingDelete=true;
this.store.remove(k);
this.clearInvalid();
Ext.defer(function(){delete this._processingDelete
},100,this)
}},scope:this}],width:24}];
if(a.columns){if(Ext.isArray(a.columns)){for(var b=0;
b<a.columns.length;
b++){c.push(a.columns[b])
}}else{c.push(a.columns)
}}else{c.push({dataIndex:this.mainBaseFieldName,flex:1})
}Ext.apply(a,{store:this.store,columns:c});
Ext.applyIf(a,{hideHeaders:true,viewConfig:{},bbar:{items:[{iconCls:"icon_add_small",handler:function(){this.editValue(true)
},scope:this,border:false,style:{background:"transparent",marginLeft:2,marginTop:-3}}],height:__height_Field-3}});
Ext.applyIf(a.viewConfig,{stripeRows:false});
this.callParent([a]);
this.getSelectionModel().on("selectionchange",function(f){if(this._processingDelete){return
}var d=null;
var g=f.getSelection();
if(g.length==1){d=g[0]
}f.deselectAll();
if(d){this.editValue(false,d)
}},this)
},editValue:function(q,l){var p=this.valueLabelWidth_char||15;
var b=this.valueFieldWidth_char||30;
var o=[];
var c;
switch(this.typeValue){case"ip:port":case"ip_or_port":case"ip_or_port_or_net":var f=undefined;
var g=undefined;
if(!q){if(l.data[this.mainBaseFieldName]){var n=l.data[this.mainBaseFieldName];
if(ip_is_valid(n,this.enableIP_0)){f=l.data[this.mainBaseFieldName]
}else{if(this.typeValue=="ip_or_port_or_net"){var a=n.lastIndexOf("/");
var k=n.lastIndexOf(":");
if(a>0){test_ip=n.substr(0,a).trim();
if(k>a){f=n.substr(0,k).trim();
g=n.substr(k+1).trim()
}else{f=n.trim()
}}else{if(k>0){f=n.substr(0,k).trim();
g=n.substr(k+1).trim();
test_ip=f
}else{f=n.trim();
test_ip=f
}}if(!ip_is_valid(test_ip,this.enableIP_0)){f=null
}}else{var k=n.lastIndexOf(":");
if(k>=0){f=n.substr(0,k).trim();
if(!ip_is_valid(f,this.enableIP_0)){f=null
}g=n.substr(k+1).trim()
}}}}}o.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"value_ip",value:f,fieldLabel:q?this.newValue_fieldLabel||lang.newValue_fieldLabel:this.editValue_fieldLabel||lang.editValue_fieldLabel,width:__width_Form(__width_FieldChar(p),__width_FieldNum(15)),labelWidth:__width_FieldChar(p),allowBlank:(this.typeValue=="ip_or_port"||this.typeValue=="ip_or_port_or_net")?!Ext.isEmpty(g):false,listeners:{scope:this,change:function(r){if(this.typeValue=="ip_or_port"||this.typeValue=="ip_or_port_or_net"){c.getForm().findField("value_port").allowBlankIf(r.getValue())
}}}},{xtype:"displayfield",value:":",style:{marginLeft:2,marginRight:2}},{xtype:"numberfield",name:"value_port",value:g,hideLabel:true,width:__width_FieldNum(5)+__width_Trigger,minValue:this.enablePort_0?0:1,maxValue:65535,allowBlank:(this.typeValue=="ip_or_port"||this.typeValue=="ip_or_port_or_net")?!Ext.isEmpty(f):false,listeners:{scope:this,change:function(r){if(this.typeValue=="ip_or_port"||this.typeValue=="ip_or_port_or_net"){c.getForm().findField("value_ip").allowBlankIf(r.getValue())
}}}}]});
break;
default:if(this.formItems){if(Ext.isFunction(this.formItems)){o=this.formItems(this,{isNew:q,record:l})
}else{o=this.formItems
}}else{o.push({xtype:"textfield",name:"value",value:q?undefined:l.data[this.mainBaseFieldName],fieldLabel:q?this.newValue_fieldLabel||lang.newValue_fieldLabel:this.editValue_fieldLabel||lang.editValue_fieldLabel,width:__width_FormChar(p,b),labelWidth:__width_FieldChar(p),allowBlank:false})
}}c=new Ext.FormPanel({frame:true,border:false,items:o,buttons:[{text:lang.okButtonText,iconCls:"icon_ok",handler:m,scope:this},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){c.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){if(!q&&l&&this.fieldsStore){for(var r=0;
r<this.fieldsStore.length;
r++){var s=c.getForm().findField(this.fieldsStore[r]);
if(s){s.setValue(l.data[this.fieldsStore[r]])
}}}Ext.create("Ext.util.KeyNav",c.el,{enter:m,scope:this})
}}});
var d=new Ext.Window({layout:"fit",items:c,border:false,title:q?this.newValue_title||lang.newValue_title:this.editValue_title||lang.editValue_title,modal:true,closable:true,listeners:{scope:this,activate:function(){c.getForm().findField(c.getForm().getFields().get(0).name).focus(false,200)
}}});
d.show();
function m(){if(c.getForm().isValid()){var r=h.call(this);
if(!Ext.isEmpty(r)){if(this.save){this.save(this,{value:r,isNew:q,record:l,fields:c.getForm().getFields(),panel:c,window:d})
}else{if(q){this.addValue(r)
}else{this.modifyValue(l,r)
}c.destroyWindow()
}}}}function h(){switch(this.typeValue){case"ip:port":case"ip_or_port":case"ip_or_port_or_net":var r=c.getForm().findField("value_ip");
var s=c.getForm().findField("value_port");
if(r&&s){if(r.getValue()&&(this.enablePort_0?!Ext.isEmpty(s.getValue()):s.getValue())){return(r.getValue()+":"+s.getValue())
}else{if(r.getValue()){return(r.getValue())
}else{if(s.getValue()){return("port: "+s.getValue())
}}}}break;
default:if(this.getValueFromForm){return(this.getValueFromForm(this,{fields:c.getForm().getFields(),fieldValues:c.getForm().getFieldValues(),panel:c,window:d}))
}else{var t=c.getForm().findField("value");
if(t){return(t.getValue())
}}}return(null)
}},addValue:function(c){var b={};
if(this.fieldsStore){for(var a=0;
a<this.fieldsStore.length;
a++){b[this.fieldsStore[a]]=c[this.fieldsStore[a]]
}}else{b[this.mainBaseFieldName]=c
}this.store.add(b)
},modifyValue:function(a,c){if(this.fieldsStore){for(var b=0;
b<this.fieldsStore.length;
b++){a.data[this.fieldsStore[b]]=c[this.fieldsStore[b]]
}}else{a.data[this.mainBaseFieldName]=c
}a.commit();
this.getSelectionModel().clearSelections()
}});
Ext.define("Ext.ux.listviewedit.Field",{extend:"Ext.ux.listviewedit.Panel",alias:"widget.ListViewEditField",constructor:function(a){a=Ext.applyIf(a||{},{isFormField:true});
this.callParent([a]);
if(a.value){this.setValue(a.value)
}},getName:function(){return(this.name)
},setValue:function(d){this.clearInvalid();
this.store.removeAll();
if(!Ext.isArray(d)){if(d&&d.split&&d!=""){d=d.split(d.match(this.valueSeparatorAlter)?this.valueSeparatorAlter:this.valueSeparator)
}else{return
}}for(var c=0;
c<d.length;
c++){var b={};
if(this.fieldsStore){var f=Ext.JSON.decode(d[c]);
for(var a=0;
a<this.fieldsStore.length;
a++){b[this.fieldsStore[a]]=f[a]
}}else{b[this.mainBaseFieldName]=d[c]
}this.store.add(b)
}},getValue:function(){if(!this.store.getCount()){return(null)
}var a=[];
this.store.each(function(c){if(this.fieldsStore){var b=[];
for(var d=0;
d<this.fieldsStore.length;
d++){b[d]=c.data[this.fieldsStore[d]]
}a.push(Ext.JSON.encode(b))
}else{a.push(c.data[this.mainBaseFieldName])
}},this);
return(a.join(this.valueSeparator))
},getSubmitData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},getModelData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},isValid:function(){return(this.allowBlank===false?(this.getValue()!=null):true)
},isDirty:function(){return(false)
},validate:function(){var a=this.isValid();
if(a){this.clearInvalid()
}else{this.setInvalid()
}return(a)
},clearInvalid:function(){if(this.getEl()){this.getEl().setStyle({border:""})
}},setInvalid:function(){if(this.getEl()){this.getEl().setStyle({border:"1px red solid"})
}},isFileUpload:function(){return(false)
}});
Ext.ns("Ext.ux.fields");
Ext.define("Ext.ux.fields.CheckboxGroup_set",{extend:Ext.form.CheckboxGroup,alias:"widget.checkboxgroup_set",constructor:function(a){this.callParent([a])
},getValue:function(){var a=this.callParent();
var b=[];
for(var c in a){b.push(c)
}return(b.join(",")||null)
},setValue:function(c){if(c){var a=c.split(",");
c={};
for(var b=0;
b<a.length;
b++){c[a[b]]="on"
}}this.callParent([c])
},getName:function(){return(this.name)
},getSubmitData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},getModelData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},isValid:function(){return(true)
},validate:function(){return(true)
},clearInvalid:function(){},isFileUpload:function(){return(false)
},isDirty:function(){return(false)
}});
Ext.define("Ext.ux.form.field.TimeDHMS",{extend:"Ext.form.FieldContainer",mixins:{field:"Ext.form.field.Field"},alias:"widget.timefield_dhms",days:true,hours:true,minutes:true,seconds:false,constructor:function(a){this.fieldsTypes=["days","hours","minutes","seconds"];
this.convTypes={days:{to:"hours",conv:24},hours:{to:"minutes",conv:60},minutes:{to:"seconds",conv:60}};
a=Ext.applyIf(a,{layout:"fit",listeners:{afterrender:this.onAfterRender,scope:this}});
this.callParent([a])
},initComponent:function(){this.buildField();
this.callParent();
this.initField()
},buildField:function(){this.fieldsConfigDefault={days:{minValue:0,maxValue:10*365,width:__width_FieldNum(5)+__width_Trigger,_unit:"days",label:lang.dayShort},hours:{minValue:0,maxValue:23,width:__width_FieldNum(2)+__width_Trigger,_unit:"hours",label:lang.hourShort},minutes:{minValue:0,maxValue:59,width:__width_FieldNum(2)+__width_Trigger,_unit:"minutes",label:lang.minuteShort},seconds:{minValue:0,maxValue:59,width:__width_FieldNum(2)+__width_Trigger,_unit:"seconds",label:lang.secondShort}};
var b=this;
for(var a in this.fieldsConfigDefault){Ext.apply(this.fieldsConfigDefault[a],{fieldStyle:{"text-align":"right"},style:{marginRight:3},onSpinnerUpClick:function(d){b.fieldSpinUp(d)
},onSpinnerDownClick:function(d){b.fieldSpinDown(d)
},listeners:{specialkey:this.onSpecialKey,change:this.onChange,scope:this}});
if(Ext.isDefined(this.config.disabled)){this.fieldsConfigDefault[a].disabled=this.config.disabled
}}this.fieldsConfig={};
this.activeFieldsTypes=[];
for(var a=0;
a<this.fieldsTypes.length;
a++){if(this[this.fieldsTypes[a]]){this.fieldsConfig[this.fieldsTypes[a]]=Ext.applyIf(this[this.fieldsTypes[a]+"Cfg"]||{},this.fieldsConfigDefault[this.fieldsTypes[a]]);
this.activeFieldsTypes.push(this.fieldsTypes[a])
}}var c=[];
this.fields={};
this.labels={};
for(var a=0;
a<this.activeFieldsTypes.length;
a++){this.fields[this.activeFieldsTypes[a]]=new Ext.form.field.Number(this.fieldsConfig[this.activeFieldsTypes[a]]);
c.push(this.fields[this.activeFieldsTypes[a]]);
if(!this.config.noLabels&&this.fieldsConfig[this.activeFieldsTypes[a]].label){this.labels[this.activeFieldsTypes[a]]=new Fields.DisplayFieldHeight16({value:this.fieldsConfig[this.activeFieldsTypes[a]].label,style:{marginRight:2}});
c.push(this.labels[this.activeFieldsTypes[a]])
}}this.items={xtype:"container",layout:{type:"hbox",align:"middle"},items:c}
},focus:function(){this.callParent();
this.fields[this.activeFieldsTypes[0]].focus.apply(this.dateField,arguments)
},convUnit:function(g,d){var a=false;
var h=this.activeFieldsTypes.indexOf(g);
var f=this.activeFieldsTypes.indexOf(d);
if(h<0||f<0){return(0)
}else{if(h==f){return(1)
}else{if(h>f){var c=g;
g=d;
d=c;
a=true
}}}var b=this._convUnit(g,d);
if(a){b=1/b
}return(b)
},_convUnit:function(c,a){var b=this.convTypes[c].conv;
if(this.convTypes[c].to!=a){b*=this._convUnit(this.convTypes[c].to,a)
}return(b)
},getValueUnit:function(){return(this.activeFieldsTypes[this.activeFieldsTypes.length-1])
},setValue:function(f){var c=this.getValueUnit();
var a=false;
for(var b=0;
b<this.activeFieldsTypes.length;
b++){var g=this.fields[this.activeFieldsTypes[b]];
if(b<this.activeFieldsTypes.length-1){var h=this.convUnit(g._unit,c);
var d=parseInt(f/h);
f-=d*h;
g.setValue(d||a?d:null);
if(d){a=true
}}else{g.setValue(f||a?f:null)
}}},getValue:function(){var b=this.getValueUnit();
var d=0;
var h=false;
for(var a=0;
a<this.activeFieldsTypes.length;
a++){var f=this.fields[this.activeFieldsTypes[a]];
var c=f.getValue();
if(!Ext.isEmpty(c)){if(a<this.activeFieldsTypes.length-1){var g=this.convUnit(f._unit,b);
d+=c*g
}else{d+=c
}h=true
}}return(h?d:null)
},fieldSpinUp:function(d){var c=d.getValue();
if(c==d.maxValue){var a=this.getValueUnit();
var f=this.convUnit(d._unit,a);
var b=this.getValue()+f;
this.setValue(b)
}else{d.spinUp()
}this.fireEvent("spinup",this)
},fieldSpinDown:function(d){var c=d.getValue();
if(c==d.minValue){var a=this.getValueUnit();
var f=this.convUnit(d._unit,a);
var b=this.getValue()-f;
if(b>=0){this.setValue(b)
}}else{d.spinDown()
}this.fireEvent("spindown",this)
},enable:function(){for(var b=0;
b<this.activeFieldsTypes.length;
b++){var c=this.fields[this.activeFieldsTypes[b]];
c.enable();
var a=this.labels[this.activeFieldsTypes[b]];
if(a){a.enable()
}}},disable:function(){for(var b=0;
b<this.activeFieldsTypes.length;
b++){var c=this.fields[this.activeFieldsTypes[b]];
c.disable();
var a=this.labels[this.activeFieldsTypes[b]];
if(a){a.disable()
}}},onAfterRender:function(){if(this.disabled){this.disable()
}},onChange:function(b,d,a,c){this.fireEvent("change",this,this.getValue(),null,c)
},onSpecialKey:function(a,b){this.fireEvent("specialkey",this,b)
},validate:function(){if(this.disabled){return(true)
}else{var b=true;
for(var a=0;
a<this.activeFieldsTypes.length;
a++){var c=this.fields[this.activeFieldsTypes[a]];
if(!c.validate()){b=false
}}return(b)
}}});
function renderDate(h,b,d,f,l,k,g){var c=g&&g.ownerCt&&g.ownerCt.getHeaderContainer?g.ownerCt.getHeaderContainer().getHeaderAtIndex(l):null;
if(c){var a=c.hideZeroTime&&!time_sec(h)?__format_Date:c.dateFormat;
if(h){h=Ext.Date.format(h,a||__format_Date);
if(c.renderer2){h=c.renderer2(h,b,d,f,l,k,g)
}}}return(h)
}function renderDateTime(a){return(a?(a.getMilliseconds()?Ext.Date.format(a,__format_DateTimeMs):Ext.Date.format(a,__format_DateTime)):null)
}function renderDateTimeM(a){return(a?Ext.Date.format(a,__format_DateTimeM):null)
}function renderTime(d){if(!d){return("")
}var b="";
var g=Math.floor(d/(24*60*60));
if(g){b+=g+"d"
}var a=Math.floor(d%(24*60*60)/(60*60));
if(b!=""){b+=" "
}b+=String(a).lpad(2,"0");
var c=Math.floor(d%(60*60)/(60));
b+=":"+String(c).lpad(2,"0");
var f=d%60;
b+=":"+String(f).lpad(2,"0");
return(b)
}function calcRemoveTime(h,c,b,l,g,f,a){var k=new Date(h);
if(!b.data.no_permanent||k.getTime()==0){return("")
}k.setTime(k.getTime()+(crulesRemoveExpireTimeGlobal*3600*1000));
return(Ext.Date.format(k,__format_DateTimeDb))
}function renderCheckBox(h,c,b,k,f,d,a){var g=a&&a.ownerCt&&a.ownerCt.getHeaderContainer?a.ownerCt.getHeaderContainer().getHeaderAtIndex(f):null;
if(g&&g.showInvState){h=h=="on"||h==1?0:1
}c.style="padding-top: 1px; padding-bottom: 0px;";
return(h=="on"||h==1?'<img src="images/tick_small_black_frame.png">':'<img src="images/tick_no_frame.png">')
}function renderCheckBoxNull(b,a){if(b!==null&&b!=-1){a.style="padding-top: 1px; padding-bottom: 0px;"
}return(b=="on"||b==1?'<img src="images/tick_small_black_frame.png">':b===null||b==-1?"":'<img src="images/tick_no_frame.png">')
}function renderCheckBoxNullArrayData(g,c,b,h,f,d,a){if(g>1){return(renderArrayData(g,c,b,h,f,d,a))
}else{return(renderCheckBoxNull(g,c))
}}function renderTick(g,c,b,h,f,d,a){if(g){c.style="padding-top: 1px; padding-bottom: 0px";
return('<img src="images/tick_small_black.png">')
}}function renderArrayData(h,c,b,k,f,d,a){var g=a&&a.ownerCt&&a.ownerCt.getHeaderContainer?a.ownerCt.getHeaderContainer().getHeaderAtIndex(f):null;
if(g){h=getDataArrayItem(g.arrayData,h,g.arrayDataFindIndex,g.arrayDataRsltIndex);
if(g.renderer2){h=g.renderer2(h,c,b,k,f,d,a)
}}return(h)
}function renderString(h,c,b,k,f,d,a){var g=a&&a.ownerCt&&a.ownerCt.getHeaderContainer?a.ownerCt.getHeaderContainer().getHeaderAtIndex(f):null;
if(g&&g.multiLine&&h&&h.replaceall){h=h.replaceall("\n","<br>")
}return(renderStringStyle(h,g))
}function renderStringStyle(b,a){var c="";
if(a){if(Ext.isDefined(a.color)&&a.color){c+="color:"+a.color+";"
}if(Ext.isDefined(a.background)&&a.background){c+="background-color:"+a.background+";"
}if(Ext.isDefined(a.bold)&&a.bold){c+="font-weight:bold;"
}if(Ext.isDefined(a.italic)&&a.italic){c+="font-style:italic;"
}if(Ext.isDefined(a.strike)&&a.strike){c+="text-decoration:line-through;"
}if(Ext.isDefined(a.multiLine)&&a.multiLine){c+="white-space: normal;"
}if(Ext.isDefined(a.forceMultiLine)&&a.forceMultiLine){c+="word-wrap: break-word; white-space: normal;"
}if(Ext.isDefined(a.style)&&a.style){c+=a.style
}}return(c?'<span style="'+c+'">'+(b||"")+"</span>":b)
}Ext.util.Format.bold=function(a){return(a===null?"":"<b>"+a+"</b>")
};
Ext.util.Format.renderNull=function(a){return(a===null?"":a)
};
Ext.util.Format.renderDateTime=function(a){return(a===null?"":renderDateTime(a))
};
Ext.util.Format.renderSideCbDomainGroups=function(a){return(getDataArrayItem(arCallerCalledSide,a,0,2)||arLang.LcdrSideBoth)
};
Ext.util.Format.renderIdSensor=function(a){return(a>0?a:"")
};
function renderFilesize(g,c,b,h,f,d,a){return(formatFilesize(g))
}function getHtmlStyle(a){if(Ext.isString(a)){return(a)
}var c="";
for(var b in a){if(!Ext.isEmpty(a[b])){c+=b+":"+a[b]+";"
}}return(c)
}function flagImage(a,c,b){if(!window.list_flags_decoded){window.list_flags_decoded=Ext.JSON.decode(window.list_flags)
}if(!a||a.match("/^X\d$/")||!window.list_flags_decoded.isIn(a.toLowerCase())){return(null)
}else{return('<img src="images/blank.png" class="flag flag-'+a+'" '+(b?'style="'+getHtmlStyle(b)+'" ':"")+(c?'data-qtip="'+c+'" ':"")+"/>")
}}function renderRecordId(b,a){if((!a.data.id_sensor||a.data.id_sensor<0)&&(!a.data._id_sensor||a.data._id_sensor<0)){return(b)
}return('<div style = "text-align:center">'+b+"<br>"+(a.data.id_sensor?a.data.id_sensor+(window.displaySensorNameCdr&&a.data.sensorname?'&thinsp;<span style="font-size: 80%">'+a.data.sensorname+"</span>":""):'<i style="color: grey;">'+a.data._id_sensor+"</i>")+"</div>")
}function debug_log(a){if(window.debug&&console&&console.log&&Ext.isFunction(console.log)){console.log(a)
}return(a)
}function debug_backtrace(){if(window.debug&&console&&console.log&&Ext.isFunction(console.log)){try{x=null;
x.foo()
}catch(a){console.log(a.stack)
}}}function showDebugData(c){if(window.debug&&console&&console.log&&Ext.isFunction(console.log)){for(var b=0;
b<c.length;
b++){switch(c[b].type){case"log":case"info":case"warning":case"error":var a=c[b].type;
switch(c[b].type){case"warning":a="warn"
}if(c[b].param2||c[b].param3){console[a](c[b].param2||c[b].param3,c[b].data)
}else{console[a](c[b].data)
}break;
case"table":if(c[b].param2||c[b].param3){console.log(c[b].param2||c[b].param3)
}console.table(c[b].data);
break;
case"group":if(c[b].param2){console.groupCollapsed(c[b].data)
}else{console.group(c[b].data)
}break;
case"group_end":console.groupEnd();
break
}}}}function getDebugLogForLoadId(a){if(window.debug){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getDebugLogForLoadId",params:Ext.encode({load_id:a})}})
}}function alert_stack(){try{x=null;
x.foo()
}catch(a){alert(a.stack)
}}function getDataArrayIndex(d,c,a){if(!Ext.isDefined(a)){a=0
}for(var b=0;
b<d.length;
b++){if((Ext.isArray(d[b])||Ext.isObject(d[b]))&&Ext.isDefined(d[b][a])&&d[b][a]==c){return(b)
}}return(null)
}function getRecordItem(c,a){if(a){var b=getDataArrayIndex(a,c,"name")
}if(b!==null){return(a[b])
}return(null)
}function getDataArrayItem(f,d,b,a){if(!Ext.isDefined(b)){b=0
}if(!Ext.isDefined(a)){a=1
}for(var c=0;
c<f.length;
c++){if((Ext.isArray(f[c])||Ext.isObject(f[c]))&&Ext.isDefined(f[c][b])&&f[c][b]==d&&Ext.isDefined(f[c][a])){return(f[c][a])
}}return(null)
}function dateTimeStringToDate(a){var b=/([0-9]{1,4})-([0-1]?[0-9])-([0-3]?[0-9])[T ]?([0-2]?[0-9])?:?([0-5]?[0-9])?:?([0-5]?[0-9])?/.exec(a);
var c=b&&b.length>=3?new Date(b[1],b[2]-1,b[3],b[4]||0,b[5]||0,b[6]||0):null;
if(c&&a.match(/^([0-9]{1,4})-([0-1]?[0-9])-([0-3]?[0-9])$/)){c.timeDefined=false
}return(c)
}function timeStringToTime(b){var a=/([0-2]?[0-9]):?([0-5]?[0-9])?:?([0-5]?[0-9])?/.exec(b);
return a&&a.length>=1?new Date(0,0,0,a[1],a[2]||0,a[3]||0):null
}function date(a,b){if((!Ext.isDefined(a)||a===null)&&!b){a=new Date
}else{if(Ext.isNumber(a)){a=new Date(a*1000)
}else{if(Ext.isString(a)){a=dateTimeStringToDate(a)
}}}return a?new Date(a.getFullYear(),a.getMonth(),a.getDate()):null
}function date_next(b){var a=date(b);
return(date((a.getTime()+36*60*60*1000)/1000))
}function date_prev(b){var a=date(b);
return(date((a.getTime()-12*60*60*1000)/1000))
}function time(a){if(Ext.isNumber(a)){a=new Date(a*1000)
}else{if(Ext.isString(a)){a=timeStringToTime(a)
}else{if(Ext.isDate(a)){a=new Date(0,0,0,a.getHours(),a.getMinutes(),a.getSeconds())
}}}return a
}function time_sec(a){if(!a){return(null)
}a=time(a);
return a.getHours()*3600+a.getMinutes()*60+a.getSeconds()
}function dateTime(a,b){if((!Ext.isDefined(a)||a===null)&&!b){a=new Date
}if(Ext.isNumber(a)){a=new Date(a*1000)
}else{if(Ext.isString(a)){a=dateTimeStringToDate(a)
}}return a
}function dateTimeM(a,b){a=dateTime(a,b);
return new Date(parseInt(a.getTime()/(60*1000))*60*1000)
}function completeDateTime(a,b){return(new Date(a?a.getFullYear():0,a?a.getMonth():0,a?a.getDate():0,b?b.getHours():0,b?b.getMinutes():0,b?b.getSeconds():0))
}function incHour(a,b){a.setTime(a.getTime()+b*60*60*1000);
return(a)
}function decHour(a,b){a.setTime(a.getTime()-b*60*60*1000);
return(a)
}function incDay(b,c){for(var a=0;
a<Math.abs(c);
a++){b=_incDay(b,c>0)
}return(b)
}function decDay(a,b){return(incDay(a,-b))
}function _incDay(c,d){var a=date(c);
var b=time(c);
if(d){a=date_next(a)
}else{a=date_prev(a)
}return(completeDateTime(a,b))
}function incMonth(c,d){var a=c.getDate();
for(var b=0;
b<Math.abs(d);
b++){c=_incMonth(c,d>0,a)
}return(c)
}function decMonth(a,b){return(incMonth(a,-b))
}function _incMonth(c,f,a){if(!a){a=c.getDate()
}month=c.getMonth()+1;
var b=f?(month==12?1:month+1):(month==1?12:month-1);
var d=0;
while(true){c=incDay(c,f?1:-1);
if(c.getMonth()+1==b){d=c.getTime()/1000;
if(f?(c.getDate()>=a):(c.getDate()<=a)){break
}}else{if(d){c.setTime(d*1000);
break
}}}return(c)
}function formatTime(a){if(!Ext.isDefined(a)){return("")
}return(Ext.Date.format(new Date(new Date(0,0,0,0,0,0).getTime()+a*1000),__format_Time))
}function formatTimeHMSfromS(g,b,a){var d="";
var c=parseInt(g/3600);
if(a||c){if(a&&c<10){d+="0"
}d+=c+(a?"":"h")
}var f=parseInt(g/60)%60;
if(a||f){if(d){d+=":"
}if(a&&f<10){d+="0"
}d+=f+(a?"":"m")
}var h=g%60;
if(a||h){if(d){d+=":"
}if(a&&h<10){d+="0"
}d+=(a?formatNumber(h,b||0):roundNumber(h,b||0))+(a?"":"s")
}return(d||"0")
}function cmpDate(b,a){if(Ext.isEmpty(b)&&Ext.isEmpty(a)){return(false)
}else{if(b&&b.getTime&&a&&a.getTime){return(b.getTime()-a.getTime())
}else{return(true)
}}}function eqDate(c,b,a){return(!cmpDate(c,b)&&(!a||c.timeDefined==b.timeDefined))
}function roundNumber(a,b){if(!Ext.isDefined(b)){b=0
}return(Math.round(a*Math.pow(10,b))/Math.pow(10,b))
}function roundNumberLeft(a,b){return(roundNumber(a,-(Math.round(Math.log(a)/Math.LN10+1)-b)))
}function trimTimeFormatString(b,a){return(Ext.Date.format(b,!time_sec(b)&&(!a||!time_sec(a))?__format_Date:!b.getSeconds()&&(!a||!a.getSeconds())?__format_DateTimeM:__format_DateTime))
}function formatNumber(c,k,b,f){if(!Ext.isNumber(c)){c=Number(c)
}negative=false;
if(c<0){c=-c;
negative=true
}var h=String(c.toFixed(Ext.isDefined(k)?k:0));
if(b||f){var a=0;
for(a=0;
a<h.length&&h.charAt(a)!=".";
a++){}snumRslt="";
k=false;
for(var d=0;
d<h.length;
d++){var g=h.charAt(d);
if(g=="."){snumRslt+=b?b:".";
k=true
}else{snumRslt+=g;
if(f&&!k&&d<a-1&&(a%3-d-1)%3==0){snumRslt+=f
}}}}else{snumRslt=h
}return(negative?"-":"")+snumRslt
}function formatFilesize(c,n,f,a,m,o,h){var g=["B","kB","MB","GB","TB","PB"];
var d=1024;
if(!c){c=h||"";
var l=""
}else{var k=0;
while(c>=d&&k<g.length-1){c/=(a?1000:1024);
++k
}var b=0;
if(k){if(c<10){b=2
}else{if(c<100){b=1
}}}b=trimDec(c,b);
o=Ext.isDefined(o)?o:(f?" ":"&thinsp;");
c=formatNumber(c,b,m,o);
var l=g[k]
}return(c+(f?(c===""?"":" "+l+(n||"")):'<span style="margin-left: 3px; width: 15px; display: inline-block; text-align: left;">'+l+(n||"")+"</span>"))
}function formatTraffic(b,l,p,h,a,d,o,q,k){var g=d?["b","kb","Mb","Gb","Tb","Pb"]:["B","kB","MB","GB","TB","PB"];
if(d){b*=8
}var f=1024;
if(!b){b=k||"";
var n=""
}else{var m=0;
while(b>=f&&m<g.length-1){b/=(a?1000:1024);
++m
}var c=0;
if(m){if(b<10){c=2
}else{if(b<100){c=1
}}}c=trimDec(b,c);
q=Ext.isDefined(q)?q:(h?" ":"&thinsp;");
b=formatNumber(b,c,o,q);
var n=g[m]
}return(b+(h?(b===""?"":" "+n+(p||"")):'<span style="margin-left: 3px; width: 15px; display: inline-block; text-align: left;">'+n+(p||"")+"</span>")+(l?'<span style="margin-left: 3px; width: 19px; display: inline-block">'+(b?'<img src="images/icon/tr_'+(l=="in"?"download":"upload")+'.png">':"")+"</span>":""))
}function formatPackets(a,f,l,b,k,m,d){var c=["p","kp","Mp","Gp","Tp","Pp"];
limitValue=1000*1000;
if(!a){a=d||"";
var h=""
}else{var g=0;
while(a>=limitValue&&g<c.length-1){a/=1000;
++g
}m=Ext.isDefined(m)?m:(b?" ":"&thinsp;");
a=formatNumber(a,0,k,m);
var h=c[g]
}return(a+(b?(a===""?"":" "+h+(l||"")):'<span style="margin-left: 3px; width: 15px; display: inline-block; text-align: left;">'+h+(l||"")+"</span>"))
}function trimDec(a,b){while(b){if(Math.round(a*Math.pow(10,b-1))*10==Math.round(a*Math.pow(10,b))){--b
}else{break
}}return(b)
}String.prototype.removeTags=function(){return(this.replace(/<.*?>/g,""))
};
String.prototype.replaceall=function(d,c,b){if(!this||!this.indexOf||!this.replace){return(null)
}var a=this.toString();
while(a.indexOf(d)>=0){a=a.replace(d,c,b||"")
}return(a)
};
String.prototype.lpad=function(c,b){var a=this;
while(a.length<c){a=(b||" ")+a
}return(String(a))
};
String.prototype.trunc=function(a,b){return(this.substr(0,a)+(this.length>a?(b||"..."):""))
};
String.prototype.trimch=function(a){var b=this;
while(b.length&&(Ext.isArray(a)?a.isIn(b[0]):b[0]==a)){b=b.substr(1)
}while(b.length&&(Ext.isArray(a)?a.isIn(b[b.length-1]):b[b.length-1]==a)){b=b.substr(0,b.length-1)
}return(String(b))
};
String.prototype.eexplode=function(c,b,g,h){var k;
if(Ext.isArray(c)){k=[this];
for(var f=0;
f<c.length;
f++){var a=[];
for(var d=0;
d<k.length;
d++){a=a.concat(k[d].split(c[f]))
}k=a
}}else{k=this.split(c)
}var a=[];
for(var f=0;
f<k.length;
f++){var l=k[f];
if(b){l=l.trim();
if(l===""){continue
}}if(g){l=g.call(h,l);
if(l===""||l===null){continue
}}a.push(l)
}return(a)
};
Array.prototype.isIn=function(b,c){if(Ext.isArray(b)){for(var a=0;
a<b.length;
a++){if(this.isIn(b[a])){return(true)
}}return(false)
}else{if(c){for(var a=0;
a<this.length;
a++){if(this[a]==b){return(true)
}}return(false)
}else{return(this.indexOf(b)>=0)
}}};
String.prototype.isIn=function(a,b){if(this.split){var c=this.split(b||",");
if(c&&c.length){return(c.isIn(a,true))
}}return(false)
};
Ext.Component.prototype.enableIf=function(a){if(a){this.enable()
}else{this.disable()
}};
Ext.Component.prototype.showIf=function(a){if(a){this.show()
}else{this.hide()
}};
Ext.Component.prototype.deferShowIf=function(a,b,c){if(this._timeoutId_deferShowIf){clearInterval(this._timeoutId_deferShowIf)
}var d=this;
this._timeoutId_deferShowIf=setTimeout(function(){if(a?!d.isVisible():d.isVisible()){d.showIf(a);
if(c){c()
}}},b||100)
};
Ext.Component.prototype.allowBlankIf=function(a){this.allowBlank=a;
if(a&&this.clearInvalid){this.clearInvalid()
}};
Ext.Component.prototype.getItem=function(b,c,f,d){if(f){var a=null;
this.cascade(function(g){if(!a){if(g[c||"name"]==b){a=g
}else{if((d||f=="withMenu")&&g.menu){a=getItem(b,g.menu,c,f,d)
}}}})
}else{var a=this.find(c||"name",b);
if(a&&a.length){a=a[0]
}else{a=null
}}return a
};
Ext.Component.prototype.getItems=function(b,c,f,d){if(f){var a=[];
this.cascade(function(g){if(g[c||"name"]==b){a.push(g)
}else{if((d||f=="withMenu")&&g.menu){var h=getItem(b,g.menu,c,f,d);
if(h&&h.length){a=a.concat(h)
}}}})
}else{var a=this.find(c||"name",b)
}return a
};
Ext.Component.prototype.findFormPanel=function(){var a=this.ownerCt;
while(a){if(a instanceof Ext.FormPanel){return(a)
}a=a.ownerCt
}return(null)
};
Ext.Component.prototype.findWindow=function(){var a=this.ownerCt;
while(a){if(a instanceof Ext.Window){return(a)
}a=a.ownerCt
}return(null)
};
function findForm(b){var a=b.ownerCt;
while(a){if(a instanceof cForm){return(a)
}a=a.ownerCt
}return(null)
}function onGridStoreException(c,b,a){if(c._request&&c._request._aborted){return
}if(b&&b.responseText){var d=Ext.decode(b.responseText);
if(d&&!d.success&&d.error){if(d.error.type=="no_session"){reLogin({fce:function(f){this.load(f)
},scope:this,params:b.request&&b.request.options&&[b.request.options.params]})
}else{if(d.error.type=="kill_session"){window.kill_session=true;
window.onbeforeunload_disable=true;
window.location="./"
}else{if(Ext.isString(d.error)){Ext.Msg.alert(findLangSd("grid","serverSideError"),d.error)
}}}}}else{if(b.timedout){if(c._request&&c._request.timestampId&&user_can_show_sql_query()){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getQueryMysqlTask",params:Ext.encode({timestampId:c._request.timestampId})},success:function(f){if(f.query){Ext.Msg.longalert(findLangSd("grid","storeTimeoutHeader"),findLangSd("grid","storeTimeoutText").template([Math.round(((new Date).getTime()-c._request.timestampId)/1000)])+"<br><br>"+(Ext.isString(f.query)?f.query.replaceall("\n","<br>"):"NA"),null,null,true)
}else{Ext.Msg.longalert(findLangSd("grid","storeTimeoutHeader"),findLangSd("grid","storeTimeoutWithoutQueryText").template([Math.round(((new Date).getTime()-c._request.timestampId)/1000)]))
}}})
}else{Ext.Msg.alert(findLangSd("grid","storeTimeoutHeader"),findLangSd("grid","storeTimeoutSimpleText"))
}}else{Ext.Msg.alert(findLangSd("grid","serverSideError"),b&&b.statusText||findLangSd("grid","errorIsNotSpecified"))
}abortLoadResponse(b)
}}function getStringStoreException(c,b,a){if(c._request&&c._request._aborted){return("")
}if(b&&b.responseText){var d=Ext.decode(b.responseText);
if(d&&!d.success&&d.error){return(findLangSd("grid","serverSideError")+" - "+d.error)
}}else{if(b.timedout){return(findLangSd("grid","storeTimeoutHeader")+" - "+findLangSd("grid","storeTimeoutSimpleText"))
}else{return(findLangSd("grid","serverSideError")+" - "+(b&&b.statusText||findLangSd("grid","errorIsNotSpecified")))
}abortLoadResponse(b)
}}function abortLoadStore(a){if(a&&a.proxy&&a.proxy._request&&a.proxy._request.xhr){if(a.proxy._request.xhr.abort){a.proxy._request._aborted=true;
a.proxy._request.xhr.abort()
}if(a.proxy._request.timestampId){abortLoad(a.proxy._request.timestampId)
}}}function abortLoadResponse(a){if(a.request&&a.request.timestampId){abortLoad(a.request.timestampId)
}}function abortRequest(b,a){if(!b||b._aborted){return
}if(b.timestampId){a=b.timestampId
}b._aborted=true;
if(b.xhr&&b.xhr.abort){b.xhr.abort()
}if(a){abortLoad(a)
}}function loadStoreIsAborted(a){return(a.proxy&&a.proxy._request&&a.proxy._request._aborted)
}function loadStoreIsTimedout(a){return(a.proxy&&a.proxy._request&&a.proxy._request.timedout)
}function loadStoreIsCancel(a){return(loadStoreIsAborted(a)||loadStoreIsTimedout(a))
}function abortLoad(a){if(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"killMysqlTask",params:Ext.encode({timestampId:a})}})
}}function showQuery(a){if(a.proxy){a=a.proxy._request.timestampId
}if(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getQueryMysqlTask",params:Ext.encode({timestampId:a})},success:function(b){if(b.query){Ext.Msg.longalert("sql query"+(b.thread?" - thread "+b.thread:""),Ext.isString(b.query)?b.query.replaceall("\n","<br>"):"NA",null,null,true)
}else{Ext.Msg.alert("","no active SQL query")
}}})
}}function onAjaxRequestException(a,c,d){if(a&&a.responseText){var b=Ext.decode(a.responseText,d);
if(b&&!b.success&&b.error&&(b.error.type=="no_session"||b.error.type=="kill_session")){if(b.error.type=="no_session"){reLogin(c)
}else{window.kill_session=true;
window.onbeforeunload_disable=true;
window.location="./"
}}else{if(isDataEmpty(b)&&!c.disableCheckAccessDenied&&a.responseText=="access denied"){c.disableCheckAccessDenied=true;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"checkSession"}},c)
}else{return(true)
}}}return(false)
}function repairJsonResult(b,a){if(b&&Ext.isString(b)){var g=0;
while(g<b.length){if(Ext.isIE?b.charAt(g)=="{"||g<b.length-1&&b.charAt(g)=="["&&(b.charAt(g+1)=="{"||b.charAt(g+1)=="["):b[g]=="{"||g<b.length-1&&b[g]=="["&&(b[g+1]=="{"||b[g+1]=="[")){break
}++g
}if(g>0){if(window.debug&&!a){var d=b.substr(0,g);
if(d.trim()){debug_log("JSON extra result left: "+d)
}if(d.match(/Fatal error/)&&d.match(/key\.php/)&&(d.match(/The encoded file/)||d.match(/The license file/))){window.onbeforeunload_disable=true;
window.location="./"
}}b=b.substr(g)
}var c=b.length;
while(c){if(Ext.isIE?b.charAt(c-1)=="}"||c>1&&b.charAt(c-1)=="]"&&(b.charAt(c-2)=="}"||b.charAt(c-2)=="]"):b[c-1]=="}"||c>1&&b[c-1]=="]"&&(b[c-2]=="}"||b[c-2]=="]")){break
}--c
}if(c<b.length){if(window.debug&&!a){var f=b.substr(c);
if(f.trim()){debug_log("JSON extra result right: "+f)
}}b=b.substr(0,c)
}}return(b)
}function timeSecondFloor(a){return(new Date(parseInt(a.getTime()/1000)*1000))
}function timeSecondCeil(a){return(new Date(parseInt(a.getTime()/1000)*1000+(a.getTime()%1000?1000:0)))
}function timeMinuteFloor(a){return(new Date(parseInt(a.getTime()/(60*1000))*(60*1000)))
}function timeMinuteCeil(a){return(new Date(parseInt(a.getTime()/(60*1000))*(60*1000)+(a.getTime()%(60*1000)?60*1000:0)))
}function cloneObject(b,a,f){if(f===0){return(undefined)
}if(Ext.isObject(b)||Ext.isArray(b)){var d=a||(Ext.isObject(b)?{}:[]);
for(var c in b){d[c]=c=="scope"||c=="_scope"?b[c]:Ext.isFunction(b[c])?b[c]:cloneObject(b[c],null,f?f-1:undefined)
}return(d)
}else{return(b)
}}function cloneArray(d,a){if(Ext.isArray(d)){var c=a||[];
for(var b in d){if(b*1==b){c.push(Ext.isFunction(d[b])?d[b]:cloneObject(d[b]))
}else{c[b]=Ext.isFunction(d[b])?d[b]:cloneObject(d[b])
}}return(c)
}else{return(d)
}}function cloneDate(a){if(Ext.isDate(a)){var b=new Date(a.getTime());
if(Ext.isDefined(a.timeDefined)){b.timeDefined=a.timeDefined
}return(b)
}else{return(a)
}}function clone(a){if(Ext.isObject(a)){return(cloneObject(a))
}else{if(Ext.isArray(a)){return(cloneArray(a))
}else{if(Ext.isDate(a)){return(cloneDate(a))
}else{return(a)
}}}}function compareObjects(c,b,d){if(d===0){return(undefined)
}if(Ext.isObject(c)){if(!Ext.isObject(b)){return(false)
}for(var a in c){if(Ext.isDefined(c[a])&&!Ext.isDefined(b[a])){return(false)
}if(!compareObjects(c[a],b[a],d?d-1:undefined)){return(false)
}}for(var a in b){if(Ext.isDefined(b[a])&&!Ext.isDefined(c[a])){return(false)
}}}else{if(Ext.isArray(c)){if(!Ext.isArray(b)){return(false)
}if(b.length!=c.length){return(false)
}for(var a=0;
a<c.length;
a++){if(Ext.isDefined(c[a])&&!Ext.isDefined(b[a])){return(false)
}if(!compareObjects(c[a],b[a],d?d-1:undefined)){return(false)
}}}else{if(c!=b){return(false)
}}}return(true)
}function getTimeInterval(a,h){var g=null;
var f=null;
var d=false;
if(!h){h={}
}if(!h.actTime){h.actTime=new Date
}var c=new Date(h.actTime.getTime());
if(h.intervalOffset){c.setTime(h.actTime.getTime()-h.intervalOffset*1000*60)
}else{h.intervalOffset=0
}switch(a){case"last_hour":case"last_60m":g=new Date(h.actTime.getTime()-60*60*1000);
if(h.forChart){f=h.actTime;
d=true
}break;
case"current_hour":g=new Date(parseInt(h.actTime.getTime()/(60*60*1000))*60*60*1000);
if(h.forChart){f=new Date(g.getTime()+60*60*1000);
d=true
}break;
case"last_2h":g=new Date(h.actTime.getTime()-2*60*60*1000);
if(h.forChart){f=h.actTime;
d=true
}break;
case"last_3h":g=new Date(h.actTime.getTime()-3*60*60*1000);
if(h.forChart){f=h.actTime;
d=true
}break;
case"last_8h":g=new Date(h.actTime.getTime()-8*60*60*1000);
if(h.forChart){f=h.actTime;
d=true
}break;
case"last_24h":g=new Date(h.actTime.getTime()-24*60*60*1000);
if(h.forChart){f=h.actTime;
d=true
}break;
case"last_2d":g=date(new Date(h.actTime.getTime()-2*24*60*60*1000));
break;
case"last_3d":g=date(new Date(h.actTime.getTime()-3*24*60*60*1000));
break;
case"last_7d":case"last_week":g=date(new Date(h.actTime.getTime()-7*24*60*60*1000));
break;
case"last_8d":g=date(new Date(h.actTime.getTime()-8*24*60*60*1000));
break;
case"last_week_time":g=new Date(h.actTime.getTime()-7*24*60*60*1000);
break;
case"last_30d":case"last_month":g=date(new Date(h.actTime.getTime()-30*24*60*60*1000));
break;
case"last_month_time":g=new Date(h.actTime.getTime()-30*24*60*60*1000);
break;
case"last_60d":g=date(new Date(h.actTime.getTime()-60*24*60*60*1000));
break;
case"last_90d":g=date(new Date(h.actTime.getTime()-90*24*60*60*1000));
break;
case"this_hour":g=new Date(h.actTime.getFullYear(),h.params.actTime.getMonth(),h.actTime.getDate(),h.actTime.getHours());
break;
case"today":g=date(h.actTime);
break;
case"yesterday":g=date(new Date(date(h.actTime).getTime()-12*60*60*1000));
f=g;
f.timeDefined=false;
break;
case"this_week_m":case"this_week_s":g=date(h.actTime);
while(g.getDay()!=(a=="this_week_m"?1:0)){g=date(new Date(g.getTime()-12*60*60*1000))
}if(h.prevInterval){if(!Ext.isDefined(h.prevIntervalHourTolerance)||(h.actTime.getTime()-g.getTime())/(1000*60*60)<h.prevIntervalHourTolerance){f=g=date(new Date(g.getTime()-12*60*60*1000));
for(var b=0;
b<6;
b++){g=date(new Date(g.getTime()-12*60*60*1000))
}}}break;
case"this_month":g=new Date(h.actTime.getFullYear(),h.actTime.getMonth(),1);
if(h.prevInterval){if(!Ext.isDefined(h.prevIntervalHourTolerance)||(h.actTime.getTime()-g.getTime())/(1000*60*60)<h.prevIntervalHourTolerance){f=g=date(new Date(g.getTime()-12*60*60*1000));
while(g.getDate()>1){g=date(new Date(g.getTime()-12*60*60*1000))
}}}break;
case"prev_month":g=new Date(h.actTime.getFullYear(),h.actTime.getMonth(),1);
g=decMonth(g,1);
if(h.prevInterval){if(!Ext.isDefined(h.prevIntervalHourTolerance)||(h.actTime.getTime()-g.getTime())/(1000*60*60)<h.prevIntervalHourTolerance){f=g=date(new Date(g.getTime()-12*60*60*1000));
while(g.getDate()>1){g=date(new Date(g.getTime()-12*60*60*1000))
}}}else{f=decDay(incMonth(g,1),1)
}break;
case"last_year":g=date(new Date(h.actTime.getTime()-365*24*60*60*1000));
break;
case"last_year_time":g=new Date(h.actTime.getTime()-365*24*60*60*1000);
break
}if(h.intervalOffset&&d){if(g){g.setTime(g.getTime()-h.intervalOffset*60*1000)
}if(f){f.setTime(f.getTime()-h.intervalOffset*60*1000)
}}return([g,f,{applicableIntervalOffset:d}])
}function getStdMenuTimeFrom(b,a,c){if(!c){c=[];
c.push({text:lang.last+" 60 "+lang.minutes,_typeTimeFrom:"last_60m"},{text:lang.currentHour,_typeTimeFrom:"current_hour"},{text:lang.last+" 2 "+lang.hours,_typeTimeFrom:"last_2h"},{text:lang.last+" 3 "+lang.hours,_typeTimeFrom:"last_3h"},{text:lang.last+" 24 "+lang.hours,_typeTimeFrom:"last_24h"},{text:lang.today,_typeTimeFrom:"today"},{text:lang.yesterday,_typeTimeFrom:"yesterday"},{text:lang.last+" "+2+" "+lang.days,_typeTimeFrom:"last_2d"},{text:lang.last+" "+3+" "+lang.days,_typeTimeFrom:"last_3d"},{text:lang.last+" "+lang.week,_typeTimeFrom:"last_week"},{text:lang.last+" "+lang.month,_typeTimeFrom:"last_month"})
}return({items:c,defaults:{scope:b,handler:a}})
}function getScrollerWidth(){var c=document.createElement("p");
c.style.width="100%";
c.style.height="200px";
var d=document.createElement("div");
d.style.position="absolute";
d.style.top="0px";
d.style.left="0px";
d.style.visibility="hidden";
d.style.width="200px";
d.style.height="150px";
d.style.overflow="hidden";
d.appendChild(c);
document.body.appendChild(d);
var b=c.offsetWidth;
d.style.overflow="scroll";
var a=c.offsetWidth;
if(b==a){a=d.clientWidth
}document.body.removeChild(d);
return(b-a)
}function addBackgroundColorRuleToStyleSheet(b,c,a){var b=b&&b[0]=="#"?b.substr(1):b;
var d="background_color_"+b+(a?"_"+a:"")+(c=="important"?"_important":"");
addRuleToStyleSheet("."+d+(c&&c!="important"?" ."+c:""),"background-color: "+b+(c=="important"?"!important":""));
return(d)
}function addRuleToStyleSheet(n,c,h,o,a,b){if(!Ext.isDefined(h)){h="other"
}if(!Ext.isDefined(o)){o=true
}var m=getStyleSheet(h);
if(m){n=n.toLowerCase();
var l=n+(c?" { "+(b?c:c.toLowerCase())+" }":null);
if(Ext.isIE){var k=n.split(",");
for(var g=0;
g<k.length;
g++){var f=false;
k[g]=k[g].trim();
for(var d=0;
d<m.rules.length;
d++){if(m.rules[d].selectorText==k[g]&&(o||m.rules[d].style.cssText==c)){f=true;
break
}}if(!f){m.addRule(k[g],c)
}}}else{for(var g=0;
g<m.cssRules.length;
g++){if(o?m.cssRules[g].cssText.substr(0,n.length)==n:m.cssRules[g].cssText==l){if(a){m.deleteRule(g)
}else{return
}}}if(c){m.insertRule(l,m.cssRules.length)
}}}}function getStyleSheet(b){for(var a=0;
a<document.styleSheets.length;
a++){if(document.styleSheets[a].title==b){return(document.styleSheets[a])
}}}function getLinkUrlWithTaskParams(d,c,f,a){var b=getUrlWithTaskParams(d,c,f);
return(a?'<a href="#" onClick="window.open(\''+b+"');\">":'<a href="'+b+'">')
}function getUrlWithTaskParams(b,a,c){return(b+"?task="+a+(c?"&params="+encodeURIComponent(Ext.encode(c)):""))
}function isDataEmpty(a){if(!Ext.isDefined(a)||a===null){return(true)
}var c=true;
for(var b in a){if(!Ext.isFunction(a[b])){c=false;
break
}}return(c)
}function isDataSet(b,d,a){for(var c in b){if(Ext.isObject(b[c])){if(isDataSet(b[c],d,a)){return(true)
}}else{if((!d||!Ext.isString(c)||d==c.substr(0,d.length))&&(a?!Ext.isEmpty(b[c]):b[c])){return(true)
}}}return(false)
}function recurseCascadeApplyIf(c,b,g,a,f){if(Ext.isArray(c)){for(var d=0;
d<c.length;
d++){recurseCascadeApplyIf(c[d],b,g,a,f)
}}else{if(Ext.isObject(c)){if(!f||f(c)){cascadeApplyIf(c,b,g,a)
}if(c.items){recurseCascadeApplyIf(c.items,b,g,a,f)
}}}}function cascadeApplyIf(c,b,d,a){if(!Ext.isDefined(c)){c={}
}if(!Ext.isObject(c)){return(c)
}if(b){Ext.applyIf(c,b)
}if(d&&c[d]&&a){Ext.applyIf(c[d],a)
}}function ip_is_valid(b,a){if(Ext.isString(b)&&b.length&&b[0]=="["&&b[b.length-1]=="]"){b=b.substr(1,b.length-2)
}return((VM_IPV6?__ip64_regex.test(b):__ip4_regex.test(b))||(a&&__ip4_regex_enable_0.test(b)))
}function ip_is_v6(a){return(a&&a.match&&a.match(":"))
}function ip_mask_text(b,a){if(!ip_is_valid(b,true)){return("BAD IP")
}return(b+(!Ext.isEmpty(a)&&a!=(ip_is_v6(b)?128:32)?"/"+a:""))
}function ip_to_id(a){return(a.replaceall(".","_").replaceall(":","_"))
}function fix_id(a){return(Ext.isString(a)?ip_to_id(a):a)
}function skip_separators(c,a){var b=0;
while(b<c.length&&a.indexOf(c[b])>=0){++b
}return([c.substr(b),b])
}function skip_ip(d){var c=0;
while(c<d.length&&d[c]==" "||d[c]=="\t"){++c
}if(VM_IPV6){var a=d.substr(c).indexOf(":");
if(a>=0&&a<=(d[c]=="["?5:4)){if(d[c]=="["){++c
}var b=0;
while(c+b<d.length&&"0123456789abcdefABCDEF:".indexOf(d[c+b])>=0){++b
}if(b>0&&ip_is_valid(d.substr(c,b))){return([d.substr(c,b),d.substr(c+b+(d[c+b]=="]"?1:0)),c,c+b+(d[c+b]=="]"?1:0)])
}}}var b=0;
while(c+b<d.length&&"0123456789.".indexOf(d[c+b])>=0){++b
}if(b>0&&ip_is_valid(d.substr(c,b))){return([d.substr(c,b),d.substr(c+b),c,c+b])
}return(false)
}function htmlEncode(d){if(Ext.isString(d)&&d.length>0){if(d[0]=="["||d[0]=="{"){return(d)
}var a=["<div","<span","<table","<img","<a","<br>"];
var c=false;
for(var b=0;
b<a.length;
b++){if(d.match(a[b])){c=true;
break
}}if(!c){return(d.replaceall("&","__amp;").replaceall("<","&lt;").replaceall(">","&gt;").replaceall('"',"&quot;").replaceall("'","&#039;").replaceall("__amp;","&amp;"))
}}return(d)
}function htmlEncodeObject(b){var a={};
for(var c in b){a[c]=htmlEncode(b[c])
}return(a)
}String.prototype.stripTags=function(){return(this.replace(/<[^>]+>/ig,""))
};
function ajaxSafeRequest(h,c){var g=false;
var a=false;
if(h.maskEl){if(h.maskEl.maskLoad){if(h.deferMask){Ext.defer(function(){if(!g){h.maskEl.maskLoad(null,h.longOperation,h.maskMsg);
a=true
}},250)
}else{h.maskEl.maskLoad(null,h.longOperation,h.maskMsg);
a=true
}}else{if(h.maskEl.mask){if(h.maskMsg){h.maskEl.mask(h.maskMsg)
}else{h.maskEl.mask()
}a=true
}}}var b=null;
if(h&&h.params&&Ext.isObject(h.params)){if(h.timeout&&!h.params.timeout){h.params.timeout=h.timeout/1000
}if(h.timestampId){var b=h.timestampId;
h.params.timestampId=h.timestampId
}if(isEnableClientTimezone()){h.params.clientTimezone=getClientTimezone();
h.params.clientOsTimezone=getClientOsTimezone()
}}var f=Ext.apply({},h);
Ext.applyIf(f,{method:"POST"});
Ext.apply(f,{success:function(l,m){g=true;
if(h.maskEl&&a){h.maskEl.unmask()
}if(!onAjaxRequestException(l,c||{fce:ajaxSafeRequest,scope:h.scope,params:[h]},h.isLoader)){return
}var k=Ext.decode(l.responseText,h.isLoader);
if(k.success||h.isLoader&&!k.error&&l.responseText){if(h.success){h.success.call(h.scope,k,l,m)
}}else{if(h.error){h.error.call(h.scope,k,l,m)
}else{if(h.errorFailure){h.errorFailure.call(h.scope,l,m)
}else{alertAjaxError(l)
}}if(h.error2){h.error2.call(h.scope,k,l,m)
}if(h.errorFailure2){h.errorFailure2.call(h.scope,l,m)
}}},failure:function(k){if(h&&h.params&&h.params.task=="getDebugLogForLoadId"){return
}g=true;
if(h.maskEl&&a){h.maskEl.unmask()
}if(h.failure){h.failure.call(h.scope,k)
}else{if(h.errorFailure){h.errorFailure.call(h.scope,k)
}else{alertAjaxFailure(k)
}}if(h.failure2){h.failure2.call(h.scope,k)
}if(h.errorFailure2){h.errorFailure2.call(h.scope,k)
}}});
Ext.applyIf(f,{timeout:Ext.Ajax.timeout});
var d=Ext.Ajax.request(f);
if(b){d.timestampId=b
}return(d)
}function alertAjaxSuccess(a){if(a&&a.replaceall){a=a.replaceall("\n","<br>")
}Ext.Msg.alert(lang.alertAjaxSuccessHeader,a)
}function alertAjaxError(c,d,b){var a=null;
if(c&&c.responseText){a=Ext.decode(c.responseText);
if(isDataEmpty(a)){a={msg:c.responseText}
}}_alertAjaxError(a,d,b)
}function _alertAjaxError(a,c,b){var d=getStringAjaxError(a,c);
if(d&&d.replaceall){d=d.replaceall("\n","<br>")
}if(b){Ext.Msg.confirm(lang.alertAjaxErrorHeader,d+"<br><br>"+b.text,function(f){if(f=="yes"){b.yes.call(b.scope)
}else{if(b.no){b.no.call(b.scope)
}}})
}else{if(Ext.Msg.longalert){Ext.Msg.longalert(lang.alertAjaxErrorHeader,d)
}else{Ext.Msg.alert(lang.alertAjaxErrorHeader,d)
}}}function getStringAjaxError(a,c,f){var b=(c||"")+(a&&(a.error&&a.error.descr||a.error||a.errors&&a.errors.reason||a.msg)||lang.alertAjaxErrorMsgUnknown);
var d=b.match(/Cannot delete or update a parent row: a foreign key constraint fails \(([^,]*)/);
if(d&&d.length==2){b=lang.failedDeleteRecord_FK.template([d[1]])
}if(f&&b&&b.replaceall){b=b.replaceall("\n","<br>")
}return(b)
}function alertAjaxFailure(a){var b=getStringAjaxFailure(a);
if(b&&b.replaceall){b=b.replaceall("\n","<br>")
}if(Ext.Msg.longalert){Ext.Msg.longalert(lang.alertAjaxFailureHeader,b)
}else{Ext.Msg.alert(lang.alertAjaxFailureHeader,b)
}}function getStringAjaxFailure(a){getDebugLogForLoadId("fatal_error");
return(requestIsAborted(a)?findLangSd("grid","requestAborted"):requestIsTimedout(a)?findLangSd("grid","requestTimeout"):(findLangSd("grid","serverSideError")+" - "+(a&&a.statusText||findLangSd("grid","errorIsNotSpecified"))))
}function requestIsAborted(a){return(a&&a.request&&a.request._aborted)
}function requestIsTimedout(a){return(a&&a.timedout)
}function getStringAjaxFailure_errorIsNotSpecified(){return(findLangSd("grid","serverSideError")+" - "+findLangSd("grid","errorIsNotSpecified"))
}function alertSubmitFailure(a){if(a&&a.result){var b=a.result&&(a.result.error&&a.result.error.descr||a.result.error||a.result.errors&&a.result.errors.reason||a.result.msg)||lang.alertAjaxErrorMsgUnknown;
if(b&&b.replaceall){b=b.replaceall("\n","<br>")
}Ext.Msg.longalert(lang.errorText,b)
}}function downloadPrepareFileHash(a,b,c){if(b){a.okTimeSec=b
}if(c){a.inline=c
}formPostSafe("php/model/utilities.php","POST",{task:"safeDownloadFileHash",params:Ext.encode(a)})
}function okTimeSecSet(a,b){if(b){a.okTimeSec=b
}return(a)
}function downloadPrepareFileHashUrl(a,b){if(a._debug){delete a._debug
}if(b){a.okTimeSec=b
}return("php/model/utilities.php?task=safeDownloadFileHash&params="+encodeURIComponent(Ext.encode(a)))
}function unlinkPrepareFileHash(a){if(a._debug){delete a._debug
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"safeUnlinkFileHash",params:Ext.encode(a)}})
}function alertCommandNotFound(f,d,a){if(!d){d=f
}if(!a){a=d
}var c={command:f,packageAptGet:d,packageYum:a};
var b=Math.min(600,Ext.dom.Element.getViewportWidth()*3/5);
Ext.Msg.show({title:lang.alertCommandNotFoundHeader.template(c),msg:'<div style="width: '+b+'">'+lang.alertCommandNotFoundText.template(c)+"<br></div>",buttons:Ext.Msg.OK,minWidth:b,width:b})
}function alertCommandPermissionDenied(c){var b={command:c};
var a=Math.min(600,Ext.dom.Element.getViewportWidth()*3/5);
Ext.Msg.show({title:lang.alertCommandPermissionDeniedHeader.template(b),msg:'<div style="width: '+a+'">'+lang.alertCommandPermissionDeniedText.template(b)+"<br></div>",buttons:Ext.Msg.OK,minWidth:a,width:a})
}function getAbsolutePosition(c,d){var a=c.offsetLeft;
var b=c.offsetTop;
while(c=c.offsetParent){a+=c.offsetLeft;
b+=c.offsetTop;
if(d&&c.id==d){break
}}return([a,b])
}function getCascadeMaxHeight(a){var b=0;
a.cascade(function(d){if(d.el&&d.el.dom){var c=getAbsolutePosition(d.el.dom,a.id)[1]+d.el.dom.clientHeight;
if(c>b){b=c
}}});
return(b-a.el.dom.offsetTop)
}function formPost(h,a,g,c){if(isEnableClientTimezone()){g.clientTimezone=getClientTimezone();
g.clientOsTimezone=getClientOsTimezone()
}if(c==="iframe"){c={autoRslt:true}
}var n=c&&(c.autoRslt||c.onRslt);
if(n){var l=Ext.id();
var b=document.createElement("iframe");
Ext.fly(b).set({id:l,name:l,cls:Ext.baseCSSPrefix+"hidden-display",src:Ext.SSL_SECURE_URL});
document.body.appendChild(b);
Ext.get(b).setStyle({border:"none"});
if(document.frames){document.frames[l].name=l
}}var m=Ext.get(document.createElement("form"));
m.set({action:h,method:a});
var f={};
for(var d in g){if(Ext.isDefined(g[d])){f[d]=Ext.get(document.createElement("input"));
f[d].set({name:d,type:"hidden"});
m.appendChild(f[d])
}}Ext.getBody().appendChild(m);
for(var d in g){if(Ext.isDefined(g[d])){f[d].set({value:g[d]})
}}if(n){m.set({target:l});
var k=function(s,v,u,r,o,p){var t=o.contentWindow.document||o.contentDocument||window.frames[o.id].document;
var q="";
if(t){if(t.body){if(/textarea/i.test((firstChild=t.body.firstChild||{}).tagName)){q=firstChild.value
}else{q=t.body.innerText||t.body.textContent
}}}if(q){if(r.onRslt){if(q.length&&(q[0]=="{"||q[0]=="[")){q=Ext.decode(q)
}r.onRslt.call(r.onRsltScope,q)
}else{if(q.length&&(q[0]=="{"||q[0]=="[")){q=Ext.decode(q)
}else{q={error:q}
}if(q.error){_alertAjaxError(q)
}}}else{if(Ext.isOpera&&!p){Ext.defer(k,500,this,[s,v,u,r,o,(p||0)+1]);
return
}}Ext.removeNode(o)
};
Ext.get(b).on("load",Ext.bind(k,null,[h,a,g,c,b]),null,{single:true})
}m.dom.submit();
Ext.defer(function(){Ext.removeNode(m.dom);
Ext.defer(function(){Ext.removeNode(b)
},30*60*1000)
},10*1000)
}function formPostSafe(a,c,b){formPost(a,c,b,"iframe")
}function loadGoogleApis(h,b,f,d){if(window.google&&!window._google_map_failure){h.call(b);
return
}window._google_map_failure=false;
window._google_map_invalid_key_fce=f;
window._google_map_invalid_key_scope=d;
onLoadGoogleApis_params={onLoadFce:h,onLoadScope:b};
var g=["maps.googleapis.com/maps/api/js?callback=onLoadGoogleApis"+(window._google_map_key?"&key="+window._google_map_key:"")];
window._google_map_script=[];
for(var c=0;
c<g.length;
c++){var a=document.createElement("script");
a.type="text/javascript";
a.src=g[c].match("LOCAL://")?g[c].substr(8):(isSsl()?"https://":"http://")+g[c];
document.body.appendChild(a);
window._google_map_script.push(a)
}}function onLoadGoogleApis(){if(!window.InfoBubble){Ext.defer(onLoadGoogleApis,200)
}else{onLoadGoogleApis_params.onLoadFce.call(onLoadGoogleApis_params.onLoadScope)
}}function gm_authFailure(){window._google_map_failure=true;
if(window._google_map_script){for(var a=0;
a<window._google_map_script.length;
a++){window._google_map_script[a].parentNode.removeChild(window._google_map_script[a])
}delete window._google_map_script
}if(window._google_map_invalid_key_fce){window._google_map_invalid_key_fce.call(window._google_map_invalid_key_scope)
}}function loadOpenLayersApi(b,a){if(window.OpenLayers&&!window._openlayers_failure){b.call(a);
return
}window._openlayers_failure=false;
loadScripts(["js/openlayers/OpenLayers_v2.js","js/openlayers/OpenStreetMap_v2.js"],b,a)
}function loadScripts(f,d,b,c){c=c||0;
var a=document.createElement("script");
a.type="text/javascript";
a.src=f[c];
a.onload=function(g){if(c<f.length-1){loadScripts(f,d,b,c+1)
}else{d.call(b)
}};
document.body.appendChild(a)
}function loadScript(d,c,b){var a=document.createElement("script");
a.type="text/javascript";
a.src=d;
a.onload=function(f){c.call(b)
};
document.body.appendChild(a)
}function gpsDistance(b,a){b=[Math.deg2rad(b[0]),Math.deg2rad(b[1])];
a=[Math.deg2rad(a[0]),Math.deg2rad(a[1])];
return Math.acos(Math.cos(b[0])*Math.cos(b[1])*Math.cos(a[0])*Math.cos(a[1])+Math.cos(b[0])*Math.sin(b[1])*Math.cos(a[0])*Math.sin(a[1])+Math.sin(b[0])*Math.sin(a[0]))*6372.795
}function gpsCenter(c,b){c=[Math.deg2rad(c[0]),Math.deg2rad(c[1])];
b=[Math.deg2rad(b[0]),Math.deg2rad(b[1])];
var f=b[1]-c[1];
var h=Math.cos(b[0])*Math.cos(f);
var g=Math.cos(b[0])*Math.sin(f);
var d=Math.atan2(Math.sin(c[0])+Math.sin(b[0]),Math.sqrt((Math.cos(c[0])+h)*(Math.cos(c[0])+h)+g*g));
var a=c[1]+Math.atan2(g,Math.cos(c[0])+h);
return([Math.rad2deg(d),Math.rad2deg(a)])
}function gpsSimpleCenter(d,c){for(var b=0;
b<2;
b++){if(Ext.isString(d[b])){d[b]*=1
}if(Ext.isString(c[b])){c[b]*=1
}}var f=(d[0]+c[0])/2;
var a=((d[1]<0?360-d[1]:d[1])+(c[1]<0?360-c[1]:c[1]))/2;
if(a>180){a-=180
}return([f,a])
}function isSsl(){return(window.location.protocol&&window.location.protocol.match&&window.location.protocol.match(/https/i))
}function treeToArray(a,b){var c={};
return(_treeToArray(a,c,b))
}function _treeToArray(a,f,d,c){for(var b in a){if(Ext.isObject(a[b])){_treeToArray(a[b],f,d,(c?c+d:"")+b)
}else{f[(c?c+d:"")+b]=a[b]
}}return(f)
}function arrayToTree(h,g){var a={};
for(var c in h){var f=c.split(g);
var d=a;
for(var b=0;
b<f.length;
b++){if(b<f.length-1){if(!Ext.isDefined(d[f[b]])){d[f[b]]={}
}d=d[f[b]]
}else{d[f[b]]=h[c]
}}}return(a)
}function objectToTreeStoreData(b){var a=[];
for(var c in b){if(!Ext.isFunction(b[c])){if(Ext.isArray(b[c])||Ext.isObject(b[c])){a.push({field:c,children:objectToTreeStoreData(b[c])})
}else{a.push({field:c,value:b[c],leaf:true})
}}}return(a)
}function setAppData(){if(window.setLang&&!window.lang){setLang()
}if(window.setArrays){setArrays()
}if(window.fillDataArrays){fillDataArrays()
}if(window.setVTypes){setVTypes()
}if(window.setMeasure){setMeasure()
}}function getWikiObject(a){if(!__wikiUrl){return(null)
}return({type:"wiki",width:40,height:a&&a.height||17,renderTpl:['<img id="{id}-toolEl" src="images/wiki.png" class="{baseCls}-wiki" role="presentation" style="width: 40; height: '+(a&&a.height||17)+";"+(a&&a.marginTop?"margin-top: "+a.marginTop+";":"")+'"/><img id="{id}-toolEl_anim" src="images/wiki.gif" style="position: absolute; left: 2; top: '+(2+(a&&a.marginTop||0))+' ; width: 36; height: 13;" onclick="Ext.getCmp(\'{id}\').click(window.event);"/>'],handler:function(){window.open(__wikiUrl+a.id)
},click:function(d){var c=this;
var b=c.owner||c.ownerCt;
Ext.callback(c.handler,c.scope||c,[d,null,b,c])
}})
}function setWikiInTab(f,a,d){if(!__wikiUrl){return
}var c=0;
if(a&&a.wikiId){a._title=a.title;
a.setTitle('<table callpadding=0 callspacing=0 style="border: none; border-collapse: collapse; padding: 0; margin: 0;"><tr><td style="height: 12; font-size: 11; font-weight: bold;">'+a._title+'</td><td style="height: 13; padding-left: 6;"><img src="images/wiki_small_13.png" style="display: inline; height:13;" onclick="window.open(\''+__wikiUrl+a.wikiId+"');\"></td></tr></table>");
var b=f.items.indexOf(a);
if(b>=0&&f.tabBar){f.tabBar.items.get(b).btnWrap.setStyle({"padding-right":0})
}++c
}if(d&&d.wikiId&&d._title){d.setTitle(d._title);
var b=f.items.indexOf(d);
if(b>=0&&f.tabBar){f.tabBar.items.get(b).btnWrap.setStyle({"padding-right":6})
}++c
}if(c&&f.tabBar){Ext.defer(f.tabBar.updateLayout,10,f.tabBar)
}}function getDataCdrCustomHeaders(){if(window.dataCdrCustomHeaders){return(Ext.decode(window.dataCdrCustomHeaders))
}return(null)
}function getDataMessageCustomHeaders(){if(window.dataMessageCustomHeaders){return(Ext.decode(window.dataMessageCustomHeaders))
}return(null)
}function getDataSipMsgCustomHeaders(){if(window.dataSipMsgCustomHeaders){return(Ext.decode(window.dataSipMsgCustomHeaders))
}return(null)
}function getComboboxDataCustomHeaders(b){if(b){var a=[];
for(var c=0;
c<b.length;
c++){if(b[c]._column_unique&&!b[c].special_type&&b[c].header_field){a.push([b[c]._column_unique,b[c].name])
}}return(a.length?a:null)
}return(null)
}function getNameCustomHeader(b,a){if(b){for(var c=0;
c<b.length;
c++){if(b[c]._column_unique==a){return(b[c].name)
}}}return(null)
}function getDataCdrSelectColumns(b){var d=[];
for(var c=0;
c<rsCDR.length;
c++){if(rsCDR[c].descr){var f={field:rsCDR[c].field||rsCDR[c].name,descr:rsCDR[c].descr};
if(rsCDR[c].join_table){Ext.apply(f,{join_table:rsCDR[c].join_table,join_field:rsCDR[c].join_field})
}d.push(f)
}}var g=getDataCdrCustomHeaders();
if(g){for(var c=0;
c<g.length;
c++){if(g[c].type=="fixed"||g[c].type=="dynamic"&&g[c].state=="active"){d.push({field:"ID",descr:g[c].name,join_table:g[c]._table,join_field:g[c]._column,join_field_u:g[c]._column_unique})
}}}if(b&&b.alert_rtp_columns){var a=[];
a.push("alert_flags");
a.push("mos");
if(window.existsMosXrCdr){a.push("mos_xr_avg");
a.push("mos_xr_min");
a.push("mos_xr_avg_caller");
a.push("mos_xr_avg_called");
a.push("mos_xr_min_caller");
a.push("mos_xr_min_called")
}if(window.existsMosSilenceCdr){a.push("mos_silence_avg");
a.push("mos_silence_min");
a.push("mos_silence_avg_caller");
a.push("mos_silence_avg_called");
a.push("mos_silence_min_caller");
a.push("mos_silence_min_called")
}if(window.existsMosLqoCdr){a.push("mos_lqo_caller");
a.push("mos_lqo_called")
}a.push("packets_loss");
a.push("packets_loss_rtcp");
a.push("jitter");
a.push("delay_count");
if(window.existsCdrSilence){a.push("silence");
a.push("silence_end")
}if(window.existsCdrClipping){a.push("clipping")
}a.push("one_way");
a.push("missing_rtp");
for(var c=0;
c<a.length;
c++){d.push({type:"alert_rtp",field:a[c],descr:a[c]})
}}return(d)
}function getDscpCode(d,b,a){var g=0;
switch(b*10+a){case 11:g=3;
break;
case 1:g=2;
break;
case 10:g=1;
break;
case 0:g=0;
break
}var f=(d>>(8*g))&((1<<8)-1);
var c=getDataArrayItem(arDscp,f);
return((c||"N/A")+" ("+f+")")
}function encodeURIjson(a){return(encodeURIComponent(a).replaceall("%7B","{").replaceall("%7D","}").replaceall("%3A",":").replaceall("%2C",","))
}function convSecTimeToNow(b){var a=parseInt((new Date).getTime()/1000);
b=parseInt(b);
secDiff=Math.abs(b-a);
diffTime=(parseInt(secDiff/(3600*24))?parseInt(secDiff/(3600*24))+"d":"")+((secDiff%(3600*24))?(secDiff%(3600*24))+"s":"");
return("now"+(diffTime?(b>a?"+":"-")+diffTime:""))
}function checkValidRegularExpression(a){var c;
try{new RegExp(a);
c=true
}catch(b){c=false
}return(c)
}function deleteElementById(b){do{var a=document.getElementById(b);
if(a){a.parentNode.removeChild(a)
}}while(a)
}function getConfigParameter(b){if(!Ext.isDefined(window.configParameters)){return(null)
}if(Ext.isString(configParameters)){configParameters=Ext.decode(configParameters)
}var a=configParameters[b];
if(Ext.isString(a)&&(a[0]=="{"&&a[a.length-1]=="}"||a[0]=="["&&a[a.length-1]=="]")){rsltDecode=Ext.decode(a);
if(rsltDecode){return(rsltDecode)
}}return(a)
}function setConfigParameter(b,a){if(!Ext.isDefined(window.configParameters)){return
}if(Ext.isString(configParameters)){configParameters=Ext.decode(configParameters)
}configParameters[b]=a;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"setParameter",params:Ext.encode({name:b,config:a})}})
}function getSizeHtml(d,c,a){var f=document.createElement("div");
f.setAttribute("id","test_div_size");
f.setAttribute("style","display: inline-block;");
if(a){Ext.apply(f.style,a)
}f.innerHTML=d;
document.body.appendChild(f);
var b=[c?f.offsetWidth:f.clientWidth,c?f.offsetHeight:f.clientHeight];
document.body.removeChild(f);
return(b)
}function clipboardCopy(d){window.getSelection().removeAllRanges();
var f=false;
var b=document.createElement("div");
b.innerHTML=d.replaceall("\n","<br>");
document.body.appendChild(b);
var a=document.createRange();
a.selectNode(b);
window.getSelection().addRange(a);
try{f=document.execCommand("copy")
}catch(c){}document.body.removeChild(b);
window.getSelection().removeAllRanges();
return(f)
}function isClipboardCopySupport(){return(document.queryCommandSupported("copy"))
}function isEnableClientTimezone(){return(window.enableChangeTimezone||window.activePanel&&activePanel.changeTimezone)
}function checkEqStore(c,b){var h=c.model.getFields();
var g=b.model.getFields();
if(h.length!=g.length){return(false)
}for(var f=0;
f<h.length;
f++){if(h[f].name!=g[f].name){return(false)
}}if(c.getCount()!=b.getCount()){return(false)
}for(var f=0;
f<c.getCount();
f++){var a=c.getAt(f).data;
var k=b.getAt(f).data;
for(var d=0;
d<h.length;
d++){if(a[h[d].name]!=k[h[d].name]){return(false)
}}}return(true)
}function getCsvFieldSeparator(){if(user&&user.sqlrow&&user.sqlrow.uc_csv_field_separator==="comma"||user.sqlrow.uc_csv_field_separator==="semicolon"){return(user.sqlrow.uc_csv_field_separator==="comma"?",":";")
}return(window.default_csv_field_separator||",")
}function getClientTimezone(){return(window.client_timezone||getDefaultClientOsTimezone())
}function getClientOsTimezone(){return(getDefaultClientOsTimezone()||window.client_os_timezone)
}function getDefaultClientOsTimezone(){var a=null;
try{a=window.jstz&&jstz.determine()&&jstz.determine().name()
}catch(b){debug_log("unsupported timezone")
}return(a)
}function existsFlag(a){if(a&&a.toLowerCase){var b=Ext.JSON.decode(list_flags);
if(b&&b.inArray){return(b.inArray(a.toLowerCase()))
}}return(false)
}Ext.define("cClipboardButton",{extend:"Ext.Button",constructor:function(a){if(isClipboardCopySupport()){this.callParent([a]);
this.on("click",function(){clipboardCopy(this.getClipText.call(this.scope,this.getClipTextParams))
},this);
return
}}});
Ext.define("cClipboardMenuItem",{extend:"Ext.menu.Item",constructor:function(a){if(isClipboardCopySupport()){this.callParent([a]);
this.on("click",function(){clipboardCopy(this.getClipText.call(this.scope,this.getClipTextParams));
if(this.parentMenu){if(this.parentMenu.parentMenu){this.parentMenu.parentMenu.destroy()
}else{this.parentMenu.destroy()
}}},this);
return
}}});
function openAttachment(b,h){var g=Ext.dom.Element.getViewportWidth()-20;
var d=Math.min(850,Ext.dom.Element.getViewportWidth()-20);
var a=Ext.dom.Element.getViewportHeight()-50;
var f;
if(b.data.attachment_type.match(/pdf/i)){f={layout:"fit",xtype:"box",autoEl:{tag:"iframe",src:getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:h,id:b.data.id,inline:true}),width:d,height:a,frameborder:0}}
}else{if(b.data.attachment_type.match(/svg/i)){f={xtype:"panel",layout:{type:"vbox",align:"center",pack:"center"},items:{xtype:"box",autoLoad:getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:h,id:b.data.id,inline:true})},width:Math.min(1000,g),height:a,autoScroll:true,border:false}
}else{f={xtype:"panel",html:'<table width="100%" height="100%" align="center" valign="center"><tr><td><img src="'+getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:h,id:b.data.id,inline:true})+'" style="width: 100%"></td></tr></table>',width:d,height:a,autoScroll:true,border:false,style:{padding:4,"background-color":"white"}}
}}var c=new Ext.Window({title:b.data.attachment_name,closable:true,maximizable:true,resizable:true,layout:"fit",items:f});
c.show()
}function gSignOut(){loadGoogleAuth(function(){var a=gapi.auth2.getAuthInstance();
a.signOut().then(function(){Ext.Ajax.request({url:"php/model/sql.php",params:{module:"logout"},success:function(){window.onbeforeunload_disable=true;
window.location="./"
},failure:function(){window.onbeforeunload_disable=true;
window.location="./"
},timeout:15000})
})
})
}function gSignIn(a){var b=a.getAuthResponse().id_token;
debug_log("G id_token: "+b);
ajaxSafeRequest({url:"php/model/sql.php",params:{module:"glogin",id_token:b},success:function(c){window.location="admin.php"
}})
}function gReSignIn(a){var b=a.getAuthResponse().id_token;
debug_log("G id_token relogin: "+b);
ajaxSafeRequest({url:"php/model/sql.php",params:{module:"glogin",id_token:b},success:function(c){window.reLoginWindow.close();
window.reLoginWindow=null;
window.reloginForm=null;
Ext.defer(runReloginTasks,250);
return(true)
}})
}function loadGoogleAuth(c){if(window._google_auth_loaded){if(c){c()
}return
}window._google_auth_on_load=c;
var d=["https://apis.google.com/js/platform.js"];
for(var b=0;
b<d.length;
b++){var a=document.createElement("script");
a.type="text/javascript";
a.src=d[b];
a.onload=gOnLoad;
a.onerror=function(){Ext.Msg.alert("Error","Can't load google platform library, so Google auth will not work.")
};
document.body.appendChild(a)
}}function gOnLoad(){gapi.load("auth2",function(){gapi.auth2.init({client_id:window.gClientId}).then(function(){window._google_auth_loaded=true;
if(window._google_auth_on_load){window._google_auth_on_load()
}},function(a){Ext.Msg.alert("Error","Can't init google API, so Google auth will not work. Error from Google:<br>"+a.details)
})
})
}function gRenderButton(a){if(a==true){gapi.signin2.render("gSignButton",{scope:"profile email",width:100,height:30,longtitle:false,theme:"light",onsuccess:gSignIn,onfailure:gOnFailure})
}else{gapi.signin2.render("gSignButton",{scope:"profile email",width:100,height:30,longtitle:false,theme:"light",onsuccess:gReSignIn,onfailure:gOnFailure})
}Ext.defer(gDisplayButton,100)
}function gDisplayButton(){var c=Ext.get("gSignButton");
if(c&&c.up()&&c.up().dom){gSignButtonContainer=Ext.getCmp(c.up().dom.id);
if(gSignButtonContainer){var a=gSignButtonContainer.findWindow();
if(a){gSignButtonContainer.show();
a.updateLayout();
for(var b=0;
b<5;
b++){Ext.defer(function(){a.updateLayout()
},(b+1)*100)
}}}}}function gOnFailure(a){console.log(a)
}function rgbToHex(c,d,a){if(!Ext.isArray(c)){c=[c,d,a]
}return((c[0]*256*256+c[1]*256+c[2]).toString(16).lpad(6,"0"))
}function hexToRgb(a){if(a.charAt(0)=="#"){a=a.substring(1,7)
}return([parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)])
}function hsvToRgb(g,o,m){var d;
if(Ext.isArray(g)){d=g[0];
o=g[1];
m=g[2]
}else{d=g
}o/=100;
m/=100;
var c=Math.floor(d/60)%6;
var k=(d/60)-c;
var b=m*(1-o);
var a=m*(1-k*o);
var n=m*(1-(1-k)*o);
var l=[0,0,0];
switch(c){case 0:l=[m,n,b];
break;
case 1:l=[a,m,b];
break;
case 2:l=[b,m,n];
break;
case 3:l=[b,a,m];
break;
case 4:l=[n,b,m];
break;
case 5:l=[m,b,a];
break
}return([Math.min(255,Math.round(l[0]*256)),Math.min(255,Math.round(l[1]*256)),Math.min(255,Math.round(l[2]*256))])
}function rgbToHsv(k,h,l){var a;
if(Ext.isArray(k)){a=k[0];
h=k[1];
l=k[2]
}else{a=k
}a/=255;
h/=255;
l/=255;
var c=Math.min(Math.min(a,h),l);
var m=Math.max(Math.max(a,h),l);
var o=m-c;
var n=m;
var f;
if(m==c){f=0
}else{if(m==a){f=(60*((h-l)/(m-c)))%360
}else{if(m==h){f=60*((l-a)/(m-c))+120
}else{if(m==l){f=60*((a-h)/(m-c))+240
}}}}if(f<0){f+=360
}var d;
if(m==0){d=0
}else{d=1-(c/m)
}return([Math.round(f),Math.round(d*100),Math.round(n*100)])
}function invertRgbColor(c,f,a){var d;
if(Ext.isArray(c)){d=c[0];
f=c[1];
a=c[2]
}else{d=c
}return[255-d,255-f,255-a]
}function lightColor(d,f,a){f=f||2;
a=a||1.5;
var g=false;
var b=false;
if(Ext.isString(d)){g=true;
if(d.charAt(0)=="#"){b=true
}d=hexToRgb(d)
}var c=rgbToHsv(d);
c[1]=c[1]/f;
c[2]=Math.min(100,c[2]*a);
d=hsvToRgb(c);
return(g?(b?"#":"")+rgbToHex(d):d)
}function aliasColorToHexRgb(a){var b={black:"#000000",red:"#FF0000",green:"#008000",blue:"#0000FF",cyan:"#00FFFF",magenta:"#FF00FF",yellow:"#FFFF00",orange:"#FFA500",chocolate:"#D2691E",bloodred:"#660000",grey:"#808080"};
if(Ext.isDefined(b[a])){a=b[a]
}return(a)
}function colorThemeShift(c,b,a){if(!Ext.isDefined(c)){c=uc_colorThemeShift_h
}if(!Ext.isDefined(b)){b=uc_colorThemeShift_s
}if(!Ext.isDefined(a)){a=uc_colorThemeShift_v
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"colorThemeShiftHsv",params:Ext.encode({h:c,s:b,v:a})},success:function(d){Ext.get("ExtAllBaseTheme").dom.innerText=d.extAllBaseTheme;
applyColorThemeShift(c,b,a)
}})
}function applyColorThemeShift(f,d,a){for(var c in window){if(c.match&&c.match(/^__color/)&&!c.match(/_orig$/)&&Ext.isString(window[c])&&window[c].charAt(0)=="#"){if(!Ext.isDefined(window[c+"_orig"])){window[c+"_orig"]=window[c]
}window[c]=applyColorThemeShift_color(window[c+"_orig"],f,d,a)
}}var k=Ext.get("app-header");
if(k){var b=applyColorThemeShift_color("#e1e1e1",f,d,a);
var g=applyColorThemeShift_color("#b0b0b0",f,d,a);
k.setStyle({"background-image":Ext.isGecko?"-moz-linear-gradient(top, "+g+", "+b+")":"-webkit-linear-gradient(top, "+g+", "+b+")"})
}setNextCssColorRules(f,d,a)
}function setNextCssColorRules(c,b,a){addRuleToStyleSheet(".panel-background-color","background-color: "+applyColorThemeShift_color("#EAEAEA",c,b,a),undefined,undefined,true,true);
addRuleToStyleSheet(".frame_window-background-color","background-color: "+applyColorThemeShift_color("#E8E8E8",c,b,a),undefined,undefined,true,true);
addRuleToStyleSheet(".panel-border-background-color","background-color: "+applyColorThemeShift_color("#D0D0D0",c,b,a),undefined,undefined,true,true)
}function applyColorThemeShift_color(b,d,c,a){if(!Ext.isDefined(d)&&Ext.isDefined(window.uc_colorThemeShift_h)){d=uc_colorThemeShift_h
}if(!Ext.isDefined(c)&&Ext.isDefined(window.uc_colorThemeShift_s)){c=uc_colorThemeShift_s
}if(!Ext.isDefined(a)&&Ext.isDefined(window.uc_colorThemeShift_v)){a=uc_colorThemeShift_v
}if(Ext.isDefined(d)||Ext.isDefined(c)||Ext.isDefined(a)){var f=rgbToHsv(hexToRgb(b));
return("#"+rgbToHex(hsvToRgb(d,f[1]+c,f[2]+a)))
}else{return(b)
}}function isHexColor(a){if(a.charAt(0)=="#"){a=a.substring(1)
}return(a.match(/^[0-9a-f]{6}$/i))
}function override_Ext_clone(){Ext._clone_base=Ext.clone;
Ext.clone=function(b,a){if(b===null||b===undefined){return b
}if(a!==false&&b.nodeType&&b.cloneNode){return b.cloneNode(true)
}if(Ext.isDate(b)&&Ext.isDefined(b.timeDefined)){var c=new Date(b.getTime());
c.timeDefined=b.timeDefined;
return(c)
}return(Ext._clone_base(b,a))
}
}Ext.decode=function(c,a){c=repairJsonResult(c,a);
var b={};
if(c){try{b=Ext.JSON.decode(c,a);
if(a&&b===null){b={}
}}catch(d){b={}
}}return(b)
};
Ext.override(Ext.Component,{afterRender:function(){if(this.helpText&&Ext.isString(this.helpText)){Ext.QuickTips.register({target:this.helpInField||!this.labelEl||this.xtype&&(this.xtype.match("displayfield")||this.xtype.match("checkbox"))?this.el:this.labelEl,title:"",text:this.helpText,enabled:true,dismissDelay:120000})
}this.callOverridden()
},destroy:function(){if(this.helpText&&Ext.isString(this.helpText)){Ext.QuickTips.unregister(this.helpInField||!this.labelEl||this.xtype&&(this.xtype.match("displayfield")||this.xtype.match("checkbox"))?this.el:this.labelEl)
}this.callOverridden()
}});
Ext.override(Ext.data.Store,{onProxyLoad:function(b){var d=this,c=b.getResultSet(),a=b.getRecords(),f=b.wasSuccessful();
if(d.destroyed){return
}if(c){d.totalCount=c.getTotal()
}d.fireEvent("load_before_renders",d,a,f,b);
if(f){a=d.processAssociation(a);
d.loadRecords(a,b.getAddRecords()?{addRecords:true}:undefined)
}else{d.loading=false
}if(d.hasListeners.load){d.fireEvent("load",d,a,f,b)
}d.callObservers("AfterLoad",[a,f,b])
}});
Ext.override(Ext.toolbar.Paging,{onLoadOrig:Ext.toolbar.Paging.prototype.onLoad,getPagingItems:function(){var b=this.callOverridden();
for(var a=0;
a<b.length;
a++){if(b[a].itemId=="afterTextItem"){b.splice(a,0,{itemId:"reloadingTotal_afterTextItem",iconCls:"icon_loading"});
break
}}return(b)
},initComponent:function(){var b=this,a=b.items||b.buttons||[],c;
b.bindStore(b.store||"ext-empty-store",true);
if(b.store&&!b.store.nextPage){Ext.raise("Store is not compatible with this component (does not support paging)")
}c=b.getPagingItems();
if(b.prependButtons){b.items=a.concat(c)
}else{b.items=c.concat(a)
}if(b.behindButtonsItems&&b.behindButtonsItems.length){b.items=b.items.concat(b.behindButtonsItems)
}delete b.buttons;
if(b.displayInfo){b.items.push("->");
b.items.push({xtype:"tbtext",itemId:"displayItem"});
b.items.push({itemId:"reloadingTotal_displayItem",iconCls:"icon_loading"})
}Ext.toolbar.Paging.superclass.initComponent.call(this);
if(b.suppressTotal){b.child("#afterTextItem").hide();
b.child("#last").hide()
}b.child("#reloadingTotal_afterTextItem").hide();
if(b.displayInfo){b.child("#reloadingTotal_displayItem").hide()
}b.store.on("beforeload",this.onBeforeLoad,this)
},onBeforeLoad:function(){if(this.totalRequest){abortRequest(this.totalRequest,this.totalRequest_timestampId);
delete this.totalRequest;
delete this.totalRequest_timestampId
}},onLoad:function(b,a,f){if(f&&b.proxy&&b.proxy.reader&&b.proxy.reader.rawData&&b.proxy.reader.rawData.deferTotal){this.deferringTotal=true;
this.child("#reloadingTotal_afterTextItem").show();
this.child("#afterTextItem").hide();
if(this.displayInfo){this.child("#reloadingTotal_displayItem").show()
}var d=cloneObject(b.proxy.extraParams);
var c=b.getFilters();
if(c&&c.items&&c.items.length){d.filter=b.proxy.encodeFilters(c.items)
}d.task="TOTAL";
this.totalRequest_timestampId=(new Date).getTime();
d.timestampId=this.totalRequest_timestampId;
if(this.totalRequest){abortRequest(this.totalRequest,this.totalRequest_timestampId)
}this.totalRequest=ajaxSafeRequest({scope:this,url:"php/model/sql.php",params:d,success:function(g){delete this.totalRequest;
delete this.totalRequest_timestampId;
delete this.deferringTotal;
this.store.totalCount=g.total;
this.child("#reloadingTotal_afterTextItem").hide();
this.child("#afterTextItem").show();
this.onLoadOrig();
if(this.displayInfo){this.child("#reloadingTotal_displayItem").hide();
this.updateInfo()
}},error:function(){},failure:function(){},timeout:b.proxy.timeout});
this._currentPageIsPageCount=true
}else{if(this._currentPageIsPageCount){delete this._currentPageIsPageCount
}}this.callOverridden();
if(this.suppressTotal){this.child("#next").setDisabled(this.getPageData().total<=this.store.pageSize)
}},moveNext:function(){var d=this,a=d.store,c=d.getPageData().pageCount,b=a.currentPage+1;
if(d.suppressTotal||b<=c){if(d.fireEvent("beforechange",d,b)!==false){a.nextPage();
return true
}}return false
},updateInfo:function(){var f=this,c=f.child("#displayItem"),a=f.store,b=f.getPageData(),d,g;
if(c){d=a.getCount();
if(d===0){g=f.emptyMsg
}else{g=Ext.String.format(f.displayMsg,b.fromRecord,this.deferringTotal?b.fromRecord+b.total-1:b.toRecord,this.deferringTotal?"":b.total)
}c.setText(g)
}},getPageData:function(){var b=this.store,a=b.getTotalCount(),c=Math.ceil(a/b.pageSize),f=Math.min(b.currentPage*b.pageSize,a);
var d=this._currentPageIsPageCount;
if(this._currentPageIsPageCount){delete this._currentPageIsPageCount
}return{total:a,currentPage:b.currentPage,pageCount:d&&b.proxy&&b.proxy.reader&&b.proxy.reader.rawData&&b.proxy.reader.rawData.deferTotal?b.currentPage:(Ext.Number.isFinite(c)?c:1),fromRecord:((b.currentPage-1)*b.pageSize)+1,toRecord:f||a}
}});
function override_Ext_MessageBox(){Ext.override(Ext.MessageBox,{show:function(a){if(a&&!a.cls){a.cls="x-selectable"
}this.callOverridden(arguments)
},longalert:function(h,g,d,c,f,k){if(g.split("<br>").length>15||f){var b=Math.min(700,Ext.dom.Element.getViewportWidth()*3/5);
var a=Math.min(400,Ext.dom.Element.getViewportHeight()*3/5);
Ext.Msg.show(Ext.applyIf(k||{},{title:h,msg:'<div id="Ext_Msg_longalert_text" style="width: '+b+"px; height: "+a+'px;"></div>',buttons:Ext.Msg.OK,fn:d,scope:c,minWidth:b+30,minHeight:a+30,width:b+30,height:a+30}));
new Ext.Panel({renderTo:"Ext_Msg_longalert_text",html:g,width:b,height:a,autoScroll:true,border:false,bodyStyle:{"background-color":__color_WindowFrame}})
}else{Ext.Msg.alert(h,g,d,c)
}}})
}Ext.override(Ext.Window,{constructor:function(a){if(a&&a.wikiId){if(!a.tools){a.tools=[]
}a.tools.push(getWikiObject({id:a.wikiId,marginTop:a.wikiButtonMarginTop}))
}if(a&&!a.cls){a.cls="x-selectable"
}this.callOverridden([a]);
if(a&&a.createMaskEl&&a.createMaskEl.maskLoad){this.on("afterrender",function(){a.createMaskEl.unmask()
},this)
}this.initCheckPosition();
if(this.formPanelForAutoAdjustSize){this.on("afterlayout",function(){this.adjustSizeForFormPanel(this.formPanelForAutoAdjustSize,this.heightMax,true,this.formPanelForAutoAdjustSizeForceScroller)
},this,{single:true})
}},checkPosition:function(){if(this.el&&this.isVisible()){var a=this.getPosition();
if(a){var c=false;
for(var b=0;
b<2;
b++){if(a[b]<0){a[b]=0;
c=true
}}if(c){this.setPosition(a)
}}}},initCheckPosition:function(){this.checkPositionTask={run:this.checkPosition,interval:2000,scope:this};
Ext.TaskManager.start(this.checkPositionTask);
this.on("move",this.checkPosition,this);
this.on("resize",this.checkPosition,this);
this.on("destroy",this.stopCheckPositionTask,this);
this.on("close",this.stopCheckPositionTask,this)
},stopCheckPositionTask:function(){Ext.TaskManager.stop(this.checkPositionTask)
},adjustSizeForFormPanel:function(b,d,a,c){adjustHeightWindow(this,b,d,a,c)
},setPositionAnimate:function(a,d,c){if(!Ext.isDefined(d)){d=1
}if(!Ext.isDefined(c)){c=5
}var b=this.getPosition();
var f=Math.pow(Math.pow(a[0]-b[0],2)+Math.pow(a[0]-b[0],2),1/2);
Ext.defer(function(){this._setPositionAnimate(b,a,f,c,d,c)
},d,this)
},_setPositionAnimate:function(c,a,k,h,d,b){if(h<k-b){var g=c[0]+(h/k*Math.abs(a[0]-c[0])*(a[0]>c[0]?1:-1));
var f=c[1]+(h/k*Math.abs(a[1]-c[1])*(a[1]>c[1]?1:-1));
this.setPosition(g,f);
Ext.defer(function(){this._setPositionAnimate(c,a,k,h+b,d,b)
},d,this)
}else{this.setPosition(a)
}}});
Ext.override(Ext.Panel,{constructor:function(a){if(a&&a.wikiId){var c=false;
if(a.tools){for(var b=0;
b<a.tools.length;
b++){if(a.tools[b].type=="wiki"){c=true
}}}if(!c){if(!a.tools){a.tools=[]
}a.tools.push(getWikiObject({id:a.wikiId,marginTop:a.wikiButtonMarginTop}))
}}this.callOverridden([a])
},mask:function(c,b,a){if(this.getEl()){if(a){this.unmaskedDeferMask=false;
Ext.defer(function(){if(!this.unmaskedDeferMask){this.getEl().mask(c,b)
}},a,this)
}else{this.getEl().mask(c,b)
}}},maskLoad:function(a,c,b){this.mask(b||(c?lang.longOperationPleaseWait:lang.pleaseWait),"x-mask-loading",a)
},maskLoadTime:function(b,a){this.mask(lang.pleaseWait,"x-mask-loading",a);
Ext.defer(function(){this.unmask()
},b,this)
},unmask:function(){if(this.getEl()){this.getEl().unmask();
this.unmaskedDeferMask=true
}},findWindow:function(){var a=this.ownerCt;
while(a){if(a instanceof Ext.Window){return(a)
}a=a.ownerCt
}return(null)
},destroyWindow:function(){var a=this.findWindow();
if(a){a.destroy()
}},getBtn:function(d,c){for(var b=0;
b<4;
b++){if(!c||c==(b==0?"tbar":b==1?"bbar":b==2?"foreign_tbar":"foreign_bbar")){var c=b==0?this.getTopToolbar():b==1?this.getBottomToolbar():b==2?this.foreignBarOwner&&this.foreignBarOwner.getTopToolbar():this.foreignBarOwner&&this.foreignBarOwner.getBottomToolbar();
if(c){var a=c.getItem(d,"_id",c.alias=="widget.pagingtoolbar");
if(!a&&c.alias!="widget.pagingtoolbar"){a=c.getItem(d,"_id",true)
}if(a){return(a)
}}}}return(null)
},enableBtn:function(d,a,c){var b=this.getBtn(d,c);
if(b){b.enableIf(a)
}}});
Ext.JSON.encodeDate=function(a){pad=function(b){return b<10?"0"+b:b
};
return'"'+a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+(a.timeDefined===false?"":"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds()))+'"'
};
Ext.Date.toString=function(a){pad=function(b){return b<10?"0"+b:b
};
return a.getFullYear()+"-"+pad(a.getMonth()+1)+"-"+pad(a.getDate())+(a.timeDefined===false?"":"T"+pad(a.getHours())+":"+pad(a.getMinutes())+":"+pad(a.getSeconds()))
};
Ext.override(Ext.form.field.Date,{getValue:function(){var a=this.callOverridden();
if(a){a.timeDefined=false
}return(a)
}});
Ext.override(Ext.tip.ToolTip,{onShow:function(){if(this.html!==null){this.callOverridden()
}},show:function(){if(this.title||this.html||this.dynamicContent){this.callOverridden()
}}});
Ext.override(Ext.Component,{getAbsolutePosition:function(){if(this.getEl()&&this.getEl().dom){return(getAbsolutePosition(this.getEl().dom))
}else{var a=this.getPosition();
var d=this;
while(d.ownerCt){d=d.ownerCt;
var c=d.getPosition();
for(var b=0;
b<2;
b++){a[b]+=c[b]
}}return(a)
}}});
Ext.override(Ext.data.proxy.Ajax,{doRequest:function(d){var k=this,b=k.getWriter(),f=k.buildRequest(d),a=k.getMethod(f),l,c;
var h=(new Date).getTime();
if(f._params){f._params.timestampId=h;
if(isEnableClientTimezone()){f._params.clientTimezone=getClientTimezone();
f._params.clientOsTimezone=getClientOsTimezone()
}if(f._proxy&&f._proxy.timeout){f._params.timeout=f._proxy.timeout/1000
}}if(b&&d.allowWrite()){f=b.write(f)
}f.setConfig({binary:k.getBinary(),headers:k.getHeaders(),timeout:k.getTimeout(),scope:k,callback:k.createRequestCallback(f,d),method:a,useDefaultXhrHeader:k.getUseDefaultXhrHeader(),disableCaching:false});
if(a.toUpperCase()!=="GET"&&k.getParamsAsJson()){c=f.getParams();
if(c){l=f.getJsonData();
if(l){l=Ext.Object.merge({},l,c)
}else{l=c
}f.setJsonData(l);
f.setParams(undefined)
}}if(k.getWithCredentials()){f.setWithCredentials(true);
f.setUsername(k.getUsername());
f.setPassword(k.getPassword())
}var g=k.sendRequest(f);
g._rawRequest.timestampId=h;
this._request=g._rawRequest;
return(g)
}});
Ext.override(Ext.data.request.Ajax,{onComplete:function(c){if(this.xhr){var a=null;
if(this.xhr.response){a=this.xhr.response
}else{if(this.xhr.responseText){a=this.xhr.responseText
}}if(a){if(a.match(/"ioncube_clock_skew"/)){Ext.Msg.alert("","Ioncube clock skew. Please check time on server side!");
return
}if(a.match(/"ioncube_error"/)){window.location="./";
return
}var b=a.match(/"_vm_version":"?(\d+)"?/);
if(b&&b.length==2){window._server_vm_version=b[1]*1
}if(a.match(/"_debug":/)&&window.debug&&window.console&&console.log&&Ext.isFunction(console.log)){var d=Ext.decode(a);
if(d&&d._debug){showDebugData(d._debug);
this._showDebugData=true
}}}}this.callOverridden(arguments)
}});
Ext.override(Ext.form.action.Submit,{onSuccess:function(a){if(a&&a.responseText&&a.responseText.match(/"ioncube_error"/)){window.location="./";
return
}if(!(a.request&&a.request._showDebugData)&&a&&a.responseText&&a.responseText.match(/"_debug":/)&&window.debug&&window.console&&console.log&&Ext.isFunction(console.log)){var b=Ext.decode(a.responseText);
if(b&&b._debug){showDebugData(b._debug)
}}this.callOverridden(arguments)
}});
Ext.override(Ext.picker.Date,{initComponent:function(){if(window.weekStart=="monday"){this.startDay=1
}this.callOverridden(arguments)
}});
Ext.override(Ext.menu.Menu,{showAtMouse:function(a){this.showAt(window.XY||a&&(a.xy||[a.x,a.y])||[null,null])
}});
Ext.override(Ext.grid.plugin.RowExpander,{rowBodyContentCls:null,rowBodyContentConfig:null,delayedRender:true,autoRelayoutExpanders:false,autoRelayoutExpanders_mask:false,enableSelectRowOnClick:true,setCmp:function(a){var c=this,b;
Ext.grid.plugin.RowExpander.superclass.setCmp.call(this,a);
c.recordsExpanded={};
if(!c.rowBodyTpl&&!c.getRowBody&&!c.rowBodyContentCls){Ext.raise("The 'rowBodyTpl' config is required and is not defined.")
}c.rowBodyTpl=Ext.XTemplate.getTpl(c,"rowBodyTpl");
b=c.getFeatureConfig(a);
if(a.features){a.features=Ext.Array.push(b,a.features)
}else{a.features=b
}a.rowExpander=this
},getRowBodyContentsFn:function(a){var b=this;
return function(c){if(!a){return""
}a.owner=b;
return a.applyTemplate(c.record.getData())
}
},init:function(a){this.callOverridden(arguments);
a.on("resize",this.onResizeGrid,this);
a.on("columnresize",this.onResizeGrid,this);
a.store.on("beforeload",this.onBeforeLoadGridStore,this)
},toggleRow:function(h,b){var g=this,a=g.normalView||g.view,f=a.getNode(h),k=Ext.fly(f),d=k.hasCls(g.rowCollapsedCls),b=this.view.getRecord(f),c=this.getGrid();
if(d){if(c.fireEvent("beforeexpandbody",c,b)===false){return
}}else{if(c.fireEvent("beforecollapsebody",c,b)===false){return
}}if(this.delayedRender||this.rowBodyContentCls){if(d){this._expandRow(h,b)
}else{this._collapseRow(h,b)
}}else{this.callOverridden(arguments)
}if(d){c.fireEvent("expandbody",c,b)
}else{c.fireEvent("collapsebody",c,b)
}},_expandRow:function(b,d){var u=this,o=u.normalView||u.view,g=o,c=o.getNode(b),s=Ext.fly(c),f=s.down(u.rowBodyTrSelector,true),n=s.hasCls(u.rowCollapsedCls),l=n?"removeCls":"addCls",d=this.view.getRecord(c),a=this.getGrid(),h=Ext.get(c),t=Ext.DomQuery.selectNode(".x-grid-rowbody",h.dom);
if(t&&(!t.innerHTML||t.innerHTML==" ")){s[l](u.rowCollapsedCls);
Ext.fly(f)[l](u.rowBodyHiddenCls);
u.recordsExpanded[d.internalId]=n;
t.style.padding=0;
if(this.rowBodyTpl||this.getRowBody){var v=cloneObject(d.data);
v.__record_id=d.internalId;
v.__grid_id=a.id;
v.__panel_id=a.ownerCt.id;
var q=this.rowBodyTpl?this.rowBodyTpl.applyTemplate(v):this.getRowBody(v,this.getCmp());
var k=d.store&&d.store.proxy&&d.store.proxy.reader&&d.store.proxy.reader.idProperty;
q=q.replaceall("__RECORD_ID__",k?d.data[k]:d.internalId).replaceall("__GRID_ID__",a.id).replaceall("__PANEL_ID__",a.ownerCt.id);
var m=a.store.indexOf(d);
var p=this.getIdExpanderAreaOwner(m);
Ext.dom.Helper.append(t,{tag:"div",id:p,cls:"expander-area-owner"+(a&&a.prefixCls?" "+a.prefixCls+"-cell":""),html:q,style:{padding:this.rowBodyPadding}})
}else{var m=a.store.indexOf(d);
var p=this.getIdExpanderAreaOwner(m);
Ext.dom.Helper.append(t,{tag:"div",id:p,cls:"expander-area-owner"+(a&&a.prefixCls?" "+a.prefixCls+"-cell":""),style:{"border-style":"none"}});
var r=this.getExpArea(b);
r.area.render(t.children[p]);
d.expanderArea=r.area;
d.expanderBodyContent=r.bodyContent;
this._lastGridWidthRow=r.widthRow
}g.fireEvent(n?"expandbody":"collapsebody",c,d,f);
o.refreshSize(true);
if(u.scrollIntoViewOnExpand&&n){u.grid.ensureVisible(b)
}}},_collapseRow:function(a,d){var g=this,h=g.normalView||g.view,l=h,b=h.getNode(a),c=Ext.fly(b),f=c.down(g.rowBodyTrSelector,true),m=c.hasCls(g.rowCollapsedCls),k=m?"removeCls":"addCls";
d=this.view.getRecord(b),grid=this.getGrid(),row=Ext.get(b),rowBody=Ext.DomQuery.selectNode(".x-grid-rowbody",row.dom);
if(rowBody){c[k](g.rowCollapsedCls);
Ext.fly(f)[k](g.rowBodyHiddenCls);
g.recordsExpanded[d.internalId]=m;
if(rowBody.innerHTML){rowBody.innerHTML=""
}if(this.rowBodyContentCls){if(d.expanderBodyContent){d.expanderBodyContent.destroy();
delete d.expanderBodyContent;
d.expanderBodyContent=null
}if(d.expanderArea){d.expanderArea.destroy();
delete d.expanderArea;
d.expanderArea=null
}}l.fireEvent(m?"expandbody":"collapsebody",b,d,f);
h.refreshSize(true);
if(g.scrollIntoViewOnExpand&&m){g.grid.ensureVisible(a)
}}},getExpArea:function(c){var q=this,r=q.normalView||q.view,d=r.getNode(c),m=Ext.fly(d),n=this.view.getRecord(d),a=this.getGrid();
rowIndex=a.store.indexOf(n);
var f=this.getIdExpanderAreaOwner(rowIndex),p=this.getIdExpanderArea(rowIndex),l=this.getIdExpanderBodyContent(rowIndex);
var h=this.getGridTable();
var b=h.dom.offsetWidth,o=this.getWidthExpArea(),k=this.getHeightExpArea(rowIndex);
var g=Ext.create(this.rowBodyContentCls,Ext.apply({},this.rowBodyContentConfig,{id:l,record:n,grid:a,widthExpArea:o,heightExpArea:k}));
var s=new Ext.Panel({border:false,items:new Ext.Panel({border:false,width:b,items:{xtype:"panel",items:g,border:false,cls:a&&a.prefixCls?a.prefixCls+"-cell":undefined,bodyCls:a&&a.prefixCls?a.prefixCls+"-cell":undefined,style:{marginLeft:2,marginRight:b-o-2,marginBottom:2,"border-style":"none"}},id:p,cls:a&&a.prefixCls?a.prefixCls+"-cell":undefined,bodyCls:a&&a.prefixCls?a.prefixCls+"-cell":undefined,style:{"border-style":"none"}}),listeners:{scope:this,afterrender:function(){Ext.defer(function(){s.updateLayout()
},100);
var u=["click","dblclick","mousedown"];
for(var t=0;
t<u.length;
t++){s.getEl().on(u[t],function(w){w.stopPropagation();
if(this.enableSelectRowOnClick){a.selModel.select([n],false,true);
a.selModel.fireEvent("selectionchange",a.selModel)
}},this)
}var v=Ext.get(l+"-outerCt");
if(v&&v.dom){if(a&&a.prefixCls){v.dom.className+=" "+a.prefixCls+"-cell"
}v.dom.style["border-style"]="none"
}},afterlayout:function(){this._onAfterLayout_recursCounter=(this._onAfterLayout_recursCounter||0)+1;
if(this._onAfterLayout_recursCounter<2){for(var u=0;
u<2;
u++){var v=this.getGridTable();
var t=v.getHeight()+(a.headerCt?a.headerCt.getHeight():0)+(a.getTopToolbar()?a.getTopToolbar().getHeight():0)+(a.getBottomToolbar()?a.getBottomToolbar().getHeight():0)+2;
if(a.getHeight()!=t&&Math.abs(a.getHeight()-t)>2){if(u==0){a.updateLayout()
}else{a.setHeight(t)
}if(this.noVerticalScroller){a.getView().getEl().setStyle({overflow:"hidden"})
}}}}--this._onAfterLayout_recursCounter
}},style:{"border-style":"none"},bodyCls:"expander-area-container",width:b,grid:this.view.ownerCt});
return({bodyContent:g,area:s,widthRow:b})
},getWidthExpArea:function(){var b=this.getGrid();
var d=this.getGridBody();
var f=this.getGridTable();
var c=d.dom.offsetWidth;
var a=f.dom.offsetWidth;
var g=a>c;
return(Math.min(b.getWidth()-this.expanderColumn.getWidth()-(this.noVerticalScroller?(g?7:0):__width_Scroller+5),a-this.expanderColumn.getWidth()-5))
},getHeightExpArea:function(k){var b=this.getGrid();
var n=Ext.get(this.view.getNode(k));
var m=this.getGridBody();
var h=this.getGridTable();
var l=b.el.down(".x-grid-header-ct");
var g=b.getTopToolbar();
var a=b.getBottomToolbar();
var d=m.dom.offsetWidth;
var c=h.dom.offsetWidth;
var f=c>d;
return(b.getHeight()-(g?g.getHeight():0)-(a?a.getHeight():0)-n.getHeight()-(l?l.getHeight():0)-(f?__height_Scroller:0)-1)
},getIdExpanderAreaOwner:function(a){return(this.getIdExpanderArea(a)+"_owner")
},getIdExpanderArea:function(f){var c=this.getGrid();
var b=c.store;
var a=b.getAt(f);
var d="";
if(c.prefixCls){d=c.prefixCls+"-"
}return(d+"expander_area_rec_"+fix_id(a.id)+(this.level||this.rowBodyContentConfig&&this.rowBodyContentConfig.level?"_"+(this.level||this.rowBodyContentConfig&&this.rowBodyContentConfig.level):""))
},getIdExpanderBodyContent:function(f){var c=this.getGrid();
var b=c.store;
var a=b.getAt(f);
var d="";
if(c.prefixCls){d=c.prefixCls+"-"
}return(d+"expander_body_content_rec_"+fix_id(a.id))
},getGrid:function(){var a=this.getCmp();
return(a)
},getGridBody:function(){var a=this.getGrid();
if(!a){return(null)
}var b=a.body;
return(b)
},getGridTable:function(){var a=this.getGridBody();
if(!a){return(null)
}var b=a.down(".x-grid-item-container");
return(b)
},getHeaderConfig:function(){var b=this,a=b.grid.lockable&&b.grid;
return{width:b.headerWidth,ignoreExport:true,lockable:false,autoLock:true,sortable:false,resizable:false,draggable:false,hideable:false,hidden:this.disableExpandColumn,menuDisabled:true,tdCls:Ext.baseCSSPrefix+"grid-cell-special",innerCls:Ext.baseCSSPrefix+"grid-cell-inner-row-expander",renderer:function(f,d,c){if(b.enableExpand&&Ext.isFunction(b.enableExpand)&&!b.enableExpand(c)){return'<div class="'+Ext.baseCSSPrefix+'" role="presentation" tabIndex="0"></div>'
}return'<div class="'+Ext.baseCSSPrefix+'grid-row-expander" role="presentation" tabIndex="0"></div>'
},processEvent:function(g,l,n,k,h,f,d){var c=f.pointerType==="touch",m=!!f.getTarget("."+Ext.baseCSSPrefix+"grid-row-expander");
if((g==="click"&&m)||(g==="keydown"&&f.getKey()===f.SPACE)){if(c){n.focus()
}b.toggleRow(k,d,f);
f.stopSelection=!b.selectRowOnExpand
}else{if(f.type==="mousedown"&&!c&&m){f.preventDefault()
}}},isLocked:function(){return a&&(a.lockedGrid.isVisible()||this.locked)
},editRenderer:function(){return"&#160;"
}}
},onResizeGrid:function(){if(!this.rowBodyContentCls){return
}var a=this.getGrid();
var d=this.getGridTable();
if(a&&d){var b=d.dom.offsetWidth;
if(this._lastGridWidthRow&&b!=this._lastGridWidthRow){var g=this.getWidthExpArea();
var k=a.store;
for(var f=0;
f<k.getCount();
f++){if(this.isExpand(f)){var h=this.getIdExpanderArea(f);
var l=Ext.getCmp(h);
if(l&&l.getEl()){if(l.getWidth()==b){l.setWidth(b+1)
}l.setWidth(b);
for(var c=0;
c<2;
c++){l.ownerCt.updateLayout()
}}}}}this._lastGridWidthRow=b
}},onBeforeLoadGridStore:function(){if(!this.keepExpand){this.collapseAll()
}},isExpand:function(f){var c=this,a=c.normalView||c.view,b=a.getNode(f),d=Ext.fly(b);
if(!d){return(false)
}wasCollapsed=d&&d.hasCls(c.rowCollapsedCls);
return(!wasCollapsed)
},expandRow:function(a){if(!this.isExpand(a)){this.toggleRow(a)
}},collapseRow:function(a){if(this.isExpand(a)){this.toggleRow(a)
}},expandAll:function(){var c=this.getGrid();
var a=c.store;
for(var b=0;
b<a.getCount();
b++){this.expandRow(b)
}},collapseAll:function(){var c=this.getGrid();
var a=c.store;
for(var b=0;
b<a.getCount();
b++){this.collapseRow(b)
}},isAnyExpand:function(){var c=this.getGrid();
var a=c.store;
for(var b=0;
b<a.getCount();
b++){if(this.isExpand(b)){return(true)
}}return(false)
}});
Ext.override(Ext.grid.column.Action,{stopSelection:false,sortable:true,defaultRenderer:function(m,r,c,b,q,h,o){var A=this,a=A.origScope||A,s=A.items,w=s.length,u,z,B,f,g,k,y,l,d,n;
var p=!A.enableHandler||A.enableHandler.apply(A,arguments);
var t="";
if(A.rendererBase){t=A.rendererBase.apply(a,arguments)||"";
if(!p&&A.baseContentFirst){return('<div class="x-grid-item" style="position: initial; margin-top: 1px; padding-left: 4px; padding-right: 4px; background-color: transparent; border: none;">'+t+"</div>")
}if(!A.baseContentTdStyle){t='<div class="x-grid-item" style="position: initial; margin-top: 1px; padding-left: 4px; padding-right: 4px; background-color: transparent; border: none; '+(A.baseContentDivStyle||"")+'">'+t+"</div>"
}}B=Ext.isFunction(A.origRenderer)?A.origRenderer.apply(a,arguments)||"":"";
r.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell";
if(A.iconVert){B+="<table>"
}for(u=0;
u<w;
u++){if(A.iconVert){B+="<tr><td>"
}z=s[u];
y=z.icon;
l=z.glyph;
f=z.disabled||(z.isDisabled?Ext.callback(z.isDisabled,z.scope||A.origScope,[o,b,q,z,c],0,A):false);
g=z.tooltip||(z.getTip?Ext.callback(z.getTip,z.scope||A.origScope,arguments,0,A):null);
k=z.getAltText?Ext.callback(z.getAltText,z.scope||A.origScope,arguments,0,A):z.altText||A.altText;
if(!z.hasActionConfiguration){z.stopSelection=A.stopSelection;
z.disable=Ext.Function.bind(A.disableAction,A,[u],0);
z.enable=Ext.Function.bind(A.enableAction,A,[u],0);
z.hasActionConfiguration=true
}if(l){l=Ext.Glyph.fly(l)
}d=(z!==A&&z.tabIndex!==undefined)?z.tabIndex:A.itemTabIndex;
n=(z!==A&&z.ariaRole!==undefined)?z.ariaRole:A.itemAriaRole;
B+="<"+(y?"img":"div")+(typeof d==="number"?' tabIndex="'+d+'"':"")+(n?' role="'+n+'"':' role="presentation"')+(y?' alt="'+k+'" src="'+z.icon+'"':"")+' class="'+A.actionIconCls+" "+Ext.baseCSSPrefix+"action-col-"+String(u)+" "+(f?A.disabledCls+" ":" ")+(z.hidden?Ext.baseCSSPrefix+"hidden-display ":"")+(z.getClass?Ext.callback(z.getClass,z.scope||A.origScope,arguments,undefined,A):(z.iconCls||A.iconCls||""))+'"'+(g?' data-qtip="'+(Ext.isFunction(z.tooltip)?z.tooltip.apply(z.scope||a,arguments):z.tooltip)+'"':"")+(y||!l?' style="width: '+(z.width||16)+"; height: "+(z.height||16)+"; "+(p&&z.handler&&(!z.enableHandler||z.enableHandler.apply(z.scope||a,arguments))?"cursor: pointer;":"cursor: default;")+'"':"")+(y?"/>":l?(' style="font-family:'+l.fontFamily+'">'+l.character+"</div>"):"></div>");
if(A.iconVert){B+="</td></tr>"
}}if(A.iconVert){B+="</table>"
}if(!A.iconTdStyle&&(A.iconDivStyle||A.rendererBase)){B='<div style="'+(A.iconDivStyle||"")+'">'+B+"</div>"
}if(A.baseContentTdStyle||A.iconTdStyle){if(!A.baseContentTdStyle){A.baseContentTdStyle="font: "+__font_Grid+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
}t='<td style="'+A.baseContentTdStyle+'">'+t+"</td>";
B='<td style="'+A.iconTdStyle+'">'+B+"</td>";
B='<table border=0 cellpadding=0 cellspacing=0 style="width: 100%; table-layout: fixed; padding-left: 4px; padding-right: 4px;">'+(A.baseContentFirst?t+B:B+t)+"</table>"
}else{B=A.baseContentFirst?t+B:B+t
}return B
},processEvent:function(l,n,p,b,m,h,d,r){var k=this,g=h.getTarget(),o=l==="keydown"&&h.getKey(),c,q,a,f=Ext.fly(p);
h.stopSelection=!o&&k.stopSelection;
if(o&&(g===p||!f.contains(g))){g=f.query("."+k.actionIconCls,true);
if(g.length===1){g=g[0]
}else{return
}}if(g&&(c=g.className.match(k.actionIdRe))){q=k.items[parseInt(c[1],10)];
a=q.disabled||(q.isDisabled?Ext.callback(q.isDisabled,q.scope||k.origScope,[n,b,m,q,d],0,k):false);
if(q&&!a){if(l==="mousedown"&&!k.getView().actionableMode){h.preventDefault();
if(q.onMouseDown){q.onMouseDown.call(q.scope,[n,b,m,q,h,d])
}}else{if(l==="click"||(o===h.ENTER||o===h.SPACE)){Ext.callback(q.handler||k.handler,q.scope||k.origScope,[n,b,m,q,h,d,r],undefined,k);
if(n.destroyed){return false
}else{if(!h.position.getNode()){h.position.refresh()
}if(!n.el.contains(Ext.Element.getActiveElement())){return false
}}}}}}return Ext.grid.column.Action.superclass.processEvent.apply(this,arguments)
}});
Ext.override(Ext.data.proxy.Ajax,{getMethod:function(a){var c=this.getActionMethods(),b=a.getAction(),d;
if(c){d=Ext.isString(c)?c:c[b]
}return d||this.defaultActionMethods[b]
}});
Ext.override(Ext.grid.column.Column,{beforeLayout:function(){if(this.xtype=="actioncolumn"){Ext.grid.header.Container.superclass.beforeLayout.call(this);
return
}this.callOverridden()
},hide:function(){var b=this,a=b.getRootHeaderCt();
if(a&&a.ownerCt){a.ownerCt.fireEvent("beforecolumnhide",a,b)
}this.callOverridden()
},show:function(){var b=this,a=b.getRootHeaderCt();
if(a&&a.ownerCt){a.ownerCt.fireEvent("beforecolumnshow",a,b)
}this.callOverridden()
}});
Ext.override(Ext.grid.filters.Filters,{initColumns:function(){var f=this.grid,b=f.getStore(),d=f.columnManager.getColumns(),a=d.length,c,h,g,k;
for(c=0;
c<a;
c++){h=d[c];
g=h.filter;
if(g&&!g.isGridFilter){if(g.value&&!k){k=b.getFilters();
k.beginUpdate()
}this.createColumnFilter(h)
}}if(k){k.endUpdate()
}}});
Ext.override(Ext.data.reader.Reader,{getKeepRawData:function(){return(true)
}});
Ext.override(Ext.form.field.Checkbox,{getModelData:function(){var a=Ext.form.field.Checkbox.superclass.getModelData.call(this);
return a
}});
Ext.override(Ext.view.Table,{renderRow:function(b,d,c){if(this.xtype=="tableview"){var f=b.data;
b.data=htmlEncodeObject(f);
b.dataHtml=b.data
}var a=this.callOverridden(arguments);
if(this.xtype=="tableview"){b.data=f
}return(a)
},renderCell:function(f,k,h,q,m,g){var o=this,c,l=o.selectionModel,n=o.cellValues,d=n.classes,a=k.data[f.dataIndex],r=o.cellTpl,b=f.enableTextSelection,s,p,t=o.navigationModel.getPosition();
if(this.xtype=="tableview"&&f&&f.htmlEncode){a=htmlEncode(a)
}if(b==null){b=o.enableTextSelection
}n.record=k;
n.column=f;
n.recordIndex=h;
n.rowIndex=q;
n.columnIndex=n.cellIndex=m;
n.align=f.textAlign;
n.innerCls=f.innerCls;
n.tdCls=n.tdStyle=n.tdAttr=n.style="";
n.unselectableAttr=b?"":'unselectable="on"';
d[1]=f.getCellId();
p=2;
if(f.renderer&&f.renderer.call){c=o.ownerCt.columnManager.getHeaderIndex(f);
s=f.renderer.call(f.usingDefaultRenderer?f:f.scope||o.ownerCt,a,n,k,h,c,o.dataSource,o);
if(n.css){k.cssWarning=true;
n.tdCls+=" "+n.css;
n.css=null
}if(n.tdCls){d[p++]=n.tdCls
}}else{s=a
}n.value=(s==null||s.length===0)?f.emptyCellText:s;
if(f.tdCls){d[p++]=f.tdCls
}if(o.markDirty&&k.dirty&&k.isModified(f.dataIndex)){d[p++]=o.dirtyCls;
if(f.dirtyTextElementId){n.tdAttr=(n.tdAttr?n.tdAttr+" ":"")+'aria-describedby="'+f.dirtyTextElementId+'"'
}}if(f.isFirstVisible){d[p++]=o.firstCls
}if(f.isLastVisible){d[p++]=o.lastCls
}if(!b){d[p++]=o.unselectableCls
}if(l&&(l.isCellModel||l.isSpreadsheetModel)&&l.isCellSelected(o,h,f)){d[p++]=o.selectedCellCls
}if(t&&t.record.id===k.id&&t.column===f){d[p++]=o.focusedItemCls
}d.length=p;
n.tdCls=d.join(" ");
r.applyOut(n,g);
n.column=n.record=null
}});
Ext.override(Ext.data.Store,{load:function(a){if(!this.disableLoad){this.callOverridden(arguments)
}}});
Ext.override(Ext.form.field.Picker,{privates:{onGlobalScroll:function(a){if(!this._multiSelect2&&!this.picker.owns(a.getElement())){this.collapse()
}}}});
Ext.override(Ext.button.Button,{constructor:function(a){this.callOverridden(arguments);
if(a&&a.innerStyle){this.on("afterrender",function(b){var c=b.getEl().down(".x-btn-inner");
if(c){c.setStyle(a.innerStyle)
}})
}}});
Ext.override(Ext.grid.GridPanel,{_renderRecord:function(m,r,o){var a=this;
var p=a.view;
var q=a.store;
var c=q.proxy.reader.readRecords({results:[r],total:1});
if(!c||!c.records||!c.records.length){return
}var g=a.columnManager.getColumns();
var k=[];
for(var l=0;
l<g.length;
l++){if(g[l].dataIndex&&o.isIn(g[l].dataIndex)){k.push(g[l])
}}var b=p.getNodeByRecord(m);
if(!b){return
}for(var l=0;
l<o.length;
l++){m.data[o[l]]=c.records[0].data[o[l]]
}var f=p.createRowElement(m,0,k);
for(var l=0;
l<k.length;
l++){for(var h=0;
h<g.length;
h++){if(g[h].id==k[l].id){var n=".x-grid-cell"+(l?":nth-child("+(l+1)+")":"");
var d=".x-grid-cell"+(h?":nth-child("+(h+1)+")":"");
Ext.fly(b).down("[role=row]").down(d).down(".x-grid-cell-inner",true).innerHTML=Ext.fly(f).down("[role=row]").down(n).down(".x-grid-cell-inner",true).innerHTML
}}}}});
Ext.override(Ext.data.field.Date,{convert:function(d){if(!d){return null
}if(d instanceof Date){return d
}var a=this.dateReadFormat||this.dateFormat,c;
if(a){if(Ext.isArray(a)){for(var f=0;
f<a.length;
f++){var b=Ext.Date.parse(d,a[f],this.useStrict);
if(b){return(b)
}}return(null)
}else{return Ext.Date.parse(d,a,this.useStrict)
}}c=Date.parse(d);
return c?new Date(c):null
}});
Ext.override(Ext.grid.header.Container,{getColumnMenu:function(c){var b=this.callOverridden(arguments);
if(b&&this.initialConfig&&this.initialConfig.items&&this.initialConfig.items.length==b.length){var d=[];
for(var a=0;
a<b.length;
a++){if(!this.initialConfig.items[a].removeFromColumnMenu){d.push(b[a])
}}b=d
}return b.length?b:null
}});
Ext.override(Ext.tip.QuickTip,{activateTarget:function(c,b){var a=this.currentTarget.getAttribute(this.tagConfig.namespace+"dismissDelay")*1;
if(a>0){this.activeTarget.dismissDelay=a
}else{if(Ext.isDefined(this.activeTarget.dismissDelay)){delete this.activeTarget.dismissDelay
}}this.callParent(arguments)
}});
Ext.override(Ext.chart.axis.layout.Layout,{calculateMajorTicks:function(c){this.callOverridden(arguments);
if(c.segmenter&&c.segmenter._axis&&c.segmenter._axis.type=="numeric"&&c.segmenter._axis._maxTickSteps&&c.majorTicks){var d=Ext.isFunction(c.segmenter._axis._maxTickSteps)?c.segmenter._axis._maxTickSteps():c.segmenter._axis._maxTickSteps;
var b=c.segmenter._axis._decPrecision||0;
var a=getNumericAxisConfig(c.majorTicks.max,d,b);
if(a){c.majorTicks.to=a.max;
c.majorTicks.step=a.step;
c.majorTicks.steps=a.count;
c.majorTicks.unit.scale=1
}}}});
Ext.override(Ext.chart.axis.layout.Discrete,{calculateMajorTicks:function(a){this.callOverridden(arguments);
if(a.segmenter&&a.segmenter._axis&&a.segmenter._axis.type=="category"&&a.segmenter._axis._typeTimeAxis&&a.segmenter._axis._maxTickSteps&&a.majorTicks){var b=a.majorTicks.step;
var h=a.majorTicks.steps;
var f=a.segmenter._axis._typeTimeAxis&&arCdrChart_timeAxisTypes[a.segmenter._axis._typeTimeAxis]&&arCdrChart_timeAxisTypes[a.segmenter._axis._typeTimeAxis].factor?arCdrChart_timeAxisTypes[a.segmenter._axis._typeTimeAxis].factor:[2,4,8,16,32];
var d=1;
var m=Ext.isFunction(a.segmenter._axis._maxTickSteps)?a.segmenter._axis._maxTickSteps():a.segmenter._axis._maxTickSteps;
if(h>m){for(var k=0;
h>m&&k<f.length;
k++){b=a.majorTicks.step*f[k];
h=Math.ceil(a.majorTicks.to/b);
d=f[k]
}}var g=0;
if(d>1&&arCdrChart_timeAxisTypes[a.segmenter._axis._typeTimeAxis]&&arCdrChart_timeAxisTypes[a.segmenter._axis._typeTimeAxis].step){var l=arCdrChart_timeAxisTypes[a.segmenter._axis._typeTimeAxis].step*d;
for(var c=0;
c<a.data.length;
c++){if(a.data[c].getTime()/1000%l==0){g=c;
break
}}}a.majorTicks._step=b;
a.majorTicks._steps=h;
a.majorTicks._stepOffset=g
}}});
Ext.override(Ext.chart.axis.sprite.Axis,{iterate:function(a,b){if(a.getLabel&&a._step){if(!a._stepOffset&&a.min<a.from){b.call(this,a.min,a.getLabel(a.min),-1,a)
}for(i=a._stepOffset;
i<=a.steps;
i+=a._step){b.call(this,a.get(i),a.getLabel(i),i,a)
}if(!a._stepOffset&&a.max>a.to){b.call(this,a.max,a.getLabel(a.max),a.steps+1,a)
}}else{this.callOverridden(arguments)
}}});
Ext.override(Ext.chart.series.sprite.Bar,{drawLabel:function(m,h,d,f,c){var k=this,g=k.attr,l=k.getMarker("labels"),b=l.getTemplate(),a=k.labelCfg||(k.labelCfg={});
if(b.attr.renderer){params=[m,l,a,{store:k.getStore()},c];
rsltLabel=Ext.callback(b.attr.renderer,null,params,0,k.getSeries());
if(rsltLabel===null){return
}}this.callOverridden(arguments)
}});
Ext.override(Ext.chart.series.Series,{getMarkerStyleByIndex:function(a){var b=this.callOverridden(arguments);
if(this.getLegendColor){color=this.getLegendColor(a);
if(color){b.fillStyle=color;
b.strokeStyle=color
}}return(b)
}});
Ext.override(Ext.chart.AbstractChart,{setHighlightSeries:function(a){if(a&&!this._highlightSeries||!a&&this._highlightSeries||a!=this._highlightSeries){if(this._highlightSeries&&this._highlightSeries.doUnhighlight){this._highlightSeries.doUnhighlight()
}if(a&&a.doHighlight){a.doHighlight()
}this.processData();
this.updateLayout();
this.fireEvent("itemhighlightserieschange",this,a,this.highlightSeries);
this._highlightSeries=a
}}});
Ext.override(Ext.chart.series.Line,{doHighlight:function(){this._baseStyle=clone(this.getStyle());
if(this._baseStyle.lineWidth){this.setStyle({lineWidth:this._baseStyle.lineWidth*2});
if(!Ext.isDefined(this._baseStyle.fillStyle)){this._baseSpriteAttr=cloneObject(this.sprites[0].attr,null,2);
this.sprites[0].setAttributes({zIndex:1000000000})
}}},doUnhighlight:function(){if(this._baseStyle.lineWidth){this.setStyle({lineWidth:this._baseStyle.lineWidth});
if(!Ext.isDefined(this._baseStyle.fillStyle)){if(Ext.isDefined(this._baseSpriteAttr.zIndex)){this.sprites[0].setAttributes({zIndex:this._baseSpriteAttr.zIndex})
}else{this.sprites[0].setAttributes({zIndex:null});
delete this.sprites[0].attr.zIndex
}}}}});
Ext.override(Ext.chart.legend.SpriteLegend,{updateSurface:function(a,b){this.callOverridden(arguments);
if(!this._disableUpdateSurface){if(b){b.el.un("mouseenter","onMouseEnter",this);
b.el.un("mouseleave","onMouseLeave",this);
b.el.un("mousemove","onMouseMove",this)
}if(a){a.el.on("mouseenter","onMouseEnter",this);
a.el.on("mouseleave","onMouseLeave",this);
a.el.on("mousemove","onMouseMove",this)
}}},onMouseEnter:function(b,a){this.onMouse("enter",b,a)
},onMouseLeave:function(c,a){this.onMouse("leave",c,a);
var b=this.getChart();
if(b){b.setHighlightSeries(null)
}},onMouseMove:function(b,a){this.onMouse("move",b,a)
},onMouse:function(b,a,c){var h=this.getChart(),c=this.getSurface(),l,k;
if(h&&h.hasFirstLayout&&c){k=c.getEventXY(a);
l=c.hitTest(k);
if(l&&l.sprite&&l.sprite._series){for(var f=0;
f<h.series.length;
f++){if(h.series[f].id==l.sprite._series){var g=h.series[f];
var d=f;
h.fireEvent("legend_mouse_event",b,h,g,d);
h.setHighlightSeries(g);
break
}}}}}});
Ext.override(Ext.draw.engine.Svg,{setElementAttributes:function(d,b){var g=d.dom,a=d.cache,c,f;
for(c in b){f=b[c];
if(a[c]!==f){a[c]=f;
if(!f||!f.match||!f.match("NaN")){g.setAttribute(c,f)
}}}}});
Ext.override(Ext.chart.series.sprite.Line,{renderAggregates:function(F,C,n,T,s,M,H){var p=this,m=p.attr,w=m.dataX,v=m.dataY,k=m.labels,B=m.xAxis,a=m.yCap,h=m.smooth&&p.smoothX&&p.smoothY,d=k&&p.getMarker("labels"),z=p.getMarker("markers"),I=m.matrix,A=T.devicePixelRatio,G=I.getXX(),g=I.getYY(),c=I.getDX(),b=I.getDY(),u=p.list||(p.list=[]),J=F.minX,f=F.maxX,l=F.minY,V=F.maxY,aa=F.startIdx,Z=true,P,q,N,o,W,Y,R,Q,X,K;
p.rendererData={store:p.getStore()};
u.length=0;
for(X=C;
X<n;
X++){var U=J[X],t=f[X],S=l[X],r=V[X];
P=Ext.isNumber(U);
N=Ext.isNumber(S);
q=Ext.isNumber(t);
o=Ext.isNumber(r);
if(U<t){u.push(P?(U*G+c):null,N?(S*g+b):null,aa[X]);
u.push(q?(t*G+c):null,o?(r*g+b):null,aa[X])
}else{if(U>t){u.push(q?(t*G+c):null,o?(r*g+b):null,aa[X]);
u.push(P?(U*G+c):null,N?(S*g+b):null,aa[X])
}else{u.push(q?(t*G+c):null,o?(r*g+b):null,aa[X])
}}}if(u.length){for(X=0;
X<u.length;
X+=3){R=u[X];
Q=u[X+1];
if(Ext.isNumber(R)&&Ext.isNumber(Q)){if(Q>a){Q=a
}else{if(Q<-a){Q=-a
}}u[X+1]=Q
}else{Z=false;
continue
}K=u[X+2];
if(z){p.drawMarker(R,Q,K)
}if(d&&k[K]){p.drawLabel(k[K],R,Q,K,H)
}}p.isContinuousLine=Z;
if(B){Y=B.getAlignment()==="vertical";
if(Ext.isNumber(B.floatingAtCoord)){W=(Y?H[2]:H[3])-B.floatingAtCoord
}else{W=Y?H[0]:H[1]
}}else{W=m.flipXY?H[0]:H[1]
}if(m.preciseStroke){if(m.fillArea){s.fill()
}if(m.transformFillStroke){m.inverseMatrix.toContext(s)
}p.drawStroke(T,s,C,n,u,W);
if(m.transformFillStroke){m.matrix.toContext(s)
}s.stroke()
}else{p.drawStroke(T,s,C,n,u,W);
if(Z&&h&&m.fillArea&&!m.renderer){var E=w[w.length-1]*G+c+A,D=v[v.length-1]*g+b,O=w[0]*G+c-A,L=v[0]*g+b;
s.lineTo(E,D);
s.lineTo(E,W-m.lineWidth);
s.lineTo(O,W-m.lineWidth);
s.lineTo(O,L)
}if(m.transformFillStroke){m.matrix.toContext(s)
}if(m.fillArea){s.fillStroke(m,true)
}else{s.stroke(true)
}}}}});
Ext.chart.series.sprite.Line.def._updaters.smooth=function(a){var d=a.dataX,c=a.dataY;
if(a.smooth&&d&&c&&d.length>2&&c.length>2){var b=Ext.draw.Draw.smooth(d,c,3);
this.smoothX=b.smoothX;
this.smoothY=b.smoothY
}else{delete this.smoothX;
delete this.smoothY
}};
Ext.override(Ext.chart.series.sprite.StackedCartesian,{getIndexNearPoint:function(f,d){var q=this,s=q.attr.matrix,k=q.attr.dataX,g=q.attr.dataY,w=q.attr.dataStartY,n=q.attr.selectionTolerance,u=this._series&&this._series._chart&&this._series._chart._getIndexNearPoint_toleranceX||0.5,t=Infinity,b=-1,m=s.clone().prependMatrix(this.surfaceMatrix).inverse(),v=m.transformPoint([f,d]),a=m.transformPoint([f-n,d-n]),p=m.transformPoint([f+n,d+n]),o=Math.min(a[1],p[1]),c=Math.max(a[1],p[1]),l,h;
for(var r=0;
r<k.length;
r++){if(Math.min(w[r],g[r])<=c&&o<=Math.max(w[r],g[r])){l=Math.abs(k[r]-v[0]);
h=Math.max(-Math.min(g[r]-v[1],v[1]-w[r]),0);
if(l<u&&h<=t){u=l;
t=h;
b=r
}}}return b
}});
function setVTypes(){Ext.apply(Ext.form.field.VTypes,{testIP:function(b,a){return(ip_is_valid(b,a.enableIP_0))
},testIPText:findLangSd("invalidIP"),testDiffPasswordNewOld:function(c,b){if(b._passwordOldField&&b._form){var a=b._form.getForm().findField(b._passwordOldField);
if(a){return(c!=a.getValue())
}}return(true)
},testDiffPasswordNewOldText:findLangSd("needDiffPasswordNewOld"),testEqPasswordNewAgain:function(c,b){if(b._passwordNewField&&b._form){var a=b._form.getForm().findField(b._passwordNewField);
if(a){return(c==a.getValue())
}}return(true)
},testEqPasswordNewAgainText:findLangSd("needEqPasswordNewAgainText"),testRegExp:function(b,a){return(checkValidRegularExpression(b))
},testRegExpText:findLangSd("invalidRegularExpression"),testScreenPopupProfile_regex_calling_number:function(c,b){if(!c){return(true)
}valA=c.split("\n");
for(var a=0;
a<valA.length;
a++){if(valA[a]){valAA=valA[a].split("|");
if(valAA[0]&&!checkValidRegularExpression(valAA[0])){return(false)
}}}return(true)
},testScreenPopupProfile_regex_calling_numberText:findLangSd("invalidRegularExpression")})
}function MD5(v){function O(b,a){return(b<<a)|(b>>>(32-a))
}function N(k,b){var G,a,d,F,c;
d=(k&2147483648);
F=(b&2147483648);
G=(k&1073741824);
a=(b&1073741824);
c=(k&1073741823)+(b&1073741823);
if(G&a){return(c^2147483648^d^F)
}if(G|a){if(c&1073741824){return(c^3221225472^d^F)
}else{return(c^1073741824^d^F)
}}else{return(c^d^F)
}}function u(a,c,b){return(a&c)|((~a)&b)
}function t(a,c,b){return(a&b)|(c&(~b))
}function s(a,c,b){return(a^c^b)
}function q(a,c,b){return(c^(a|(~b)))
}function y(G,F,ad,ac,k,H,I){G=N(G,N(N(u(F,ad,ac),k),I));
return N(O(G,H),F)
}function g(G,F,ad,ac,k,H,I){G=N(G,N(N(t(F,ad,ac),k),I));
return N(O(G,H),F)
}function K(G,F,ad,ac,k,H,I){G=N(G,N(N(s(F,ad,ac),k),I));
return N(O(G,H),F)
}function w(G,F,ad,ac,k,H,I){G=N(G,N(N(q(F,ad,ac),k),I));
return N(O(G,H),F)
}function f(k){var H;
var d=k.length;
var c=d+8;
var b=(c-(c%64))/64;
var G=(b+1)*16;
var I=Array(G-1);
var a=0;
var F=0;
while(F<d){H=(F-(F%4))/4;
a=(F%4)*8;
I[H]=(I[H]|(k.charCodeAt(F)<<a));
F++
}H=(F-(F%4))/4;
a=(F%4)*8;
I[H]=I[H]|(128<<a);
I[G-2]=d<<3;
I[G-1]=d>>>29;
return I
}function E(c){var b="",d="",k,a;
for(a=0;
a<=3;
a++){k=(c>>>(a*8))&255;
d="0"+k.toString(16);
b=b+d.substr(d.length-2,2)
}return b
}function M(b){b=b.replace(/\r\n/g,"\n");
var a="";
for(var k=0;
k<b.length;
k++){var d=b.charCodeAt(k);
if(d<128){a+=String.fromCharCode(d)
}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);
a+=String.fromCharCode((d&63)|128)
}else{a+=String.fromCharCode((d>>12)|224);
a+=String.fromCharCode(((d>>6)&63)|128);
a+=String.fromCharCode((d&63)|128)
}}}return a
}var J=Array();
var S,l,L,z,h,ab,aa,Z,Y;
var V=7,T=12,Q=17,P=22;
var D=5,C=9,B=14,A=20;
var r=4,p=11,o=16,n=23;
var X=6,W=10,U=15,R=21;
v=M(v);
J=f(v);
ab=1732584193;
aa=4023233417;
Z=2562383102;
Y=271733878;
for(S=0;
S<J.length;
S+=16){l=ab;
L=aa;
z=Z;
h=Y;
ab=y(ab,aa,Z,Y,J[S+0],V,3614090360);
Y=y(Y,ab,aa,Z,J[S+1],T,3905402710);
Z=y(Z,Y,ab,aa,J[S+2],Q,606105819);
aa=y(aa,Z,Y,ab,J[S+3],P,3250441966);
ab=y(ab,aa,Z,Y,J[S+4],V,4118548399);
Y=y(Y,ab,aa,Z,J[S+5],T,1200080426);
Z=y(Z,Y,ab,aa,J[S+6],Q,2821735955);
aa=y(aa,Z,Y,ab,J[S+7],P,4249261313);
ab=y(ab,aa,Z,Y,J[S+8],V,1770035416);
Y=y(Y,ab,aa,Z,J[S+9],T,2336552879);
Z=y(Z,Y,ab,aa,J[S+10],Q,4294925233);
aa=y(aa,Z,Y,ab,J[S+11],P,2304563134);
ab=y(ab,aa,Z,Y,J[S+12],V,1804603682);
Y=y(Y,ab,aa,Z,J[S+13],T,4254626195);
Z=y(Z,Y,ab,aa,J[S+14],Q,2792965006);
aa=y(aa,Z,Y,ab,J[S+15],P,1236535329);
ab=g(ab,aa,Z,Y,J[S+1],D,4129170786);
Y=g(Y,ab,aa,Z,J[S+6],C,3225465664);
Z=g(Z,Y,ab,aa,J[S+11],B,643717713);
aa=g(aa,Z,Y,ab,J[S+0],A,3921069994);
ab=g(ab,aa,Z,Y,J[S+5],D,3593408605);
Y=g(Y,ab,aa,Z,J[S+10],C,38016083);
Z=g(Z,Y,ab,aa,J[S+15],B,3634488961);
aa=g(aa,Z,Y,ab,J[S+4],A,3889429448);
ab=g(ab,aa,Z,Y,J[S+9],D,568446438);
Y=g(Y,ab,aa,Z,J[S+14],C,3275163606);
Z=g(Z,Y,ab,aa,J[S+3],B,4107603335);
aa=g(aa,Z,Y,ab,J[S+8],A,1163531501);
ab=g(ab,aa,Z,Y,J[S+13],D,2850285829);
Y=g(Y,ab,aa,Z,J[S+2],C,4243563512);
Z=g(Z,Y,ab,aa,J[S+7],B,1735328473);
aa=g(aa,Z,Y,ab,J[S+12],A,2368359562);
ab=K(ab,aa,Z,Y,J[S+5],r,4294588738);
Y=K(Y,ab,aa,Z,J[S+8],p,2272392833);
Z=K(Z,Y,ab,aa,J[S+11],o,1839030562);
aa=K(aa,Z,Y,ab,J[S+14],n,4259657740);
ab=K(ab,aa,Z,Y,J[S+1],r,2763975236);
Y=K(Y,ab,aa,Z,J[S+4],p,1272893353);
Z=K(Z,Y,ab,aa,J[S+7],o,4139469664);
aa=K(aa,Z,Y,ab,J[S+10],n,3200236656);
ab=K(ab,aa,Z,Y,J[S+13],r,681279174);
Y=K(Y,ab,aa,Z,J[S+0],p,3936430074);
Z=K(Z,Y,ab,aa,J[S+3],o,3572445317);
aa=K(aa,Z,Y,ab,J[S+6],n,76029189);
ab=K(ab,aa,Z,Y,J[S+9],r,3654602809);
Y=K(Y,ab,aa,Z,J[S+12],p,3873151461);
Z=K(Z,Y,ab,aa,J[S+15],o,530742520);
aa=K(aa,Z,Y,ab,J[S+2],n,3299628645);
ab=w(ab,aa,Z,Y,J[S+0],X,4096336452);
Y=w(Y,ab,aa,Z,J[S+7],W,1126891415);
Z=w(Z,Y,ab,aa,J[S+14],U,2878612391);
aa=w(aa,Z,Y,ab,J[S+5],R,4237533241);
ab=w(ab,aa,Z,Y,J[S+12],X,1700485571);
Y=w(Y,ab,aa,Z,J[S+3],W,2399980690);
Z=w(Z,Y,ab,aa,J[S+10],U,4293915773);
aa=w(aa,Z,Y,ab,J[S+1],R,2240044497);
ab=w(ab,aa,Z,Y,J[S+8],X,1873313359);
Y=w(Y,ab,aa,Z,J[S+15],W,4264355552);
Z=w(Z,Y,ab,aa,J[S+6],U,2734768916);
aa=w(aa,Z,Y,ab,J[S+13],R,1309151649);
ab=w(ab,aa,Z,Y,J[S+4],X,4149444226);
Y=w(Y,ab,aa,Z,J[S+11],W,3174756917);
Z=w(Z,Y,ab,aa,J[S+2],U,718787259);
aa=w(aa,Z,Y,ab,J[S+9],R,3951481745);
ab=N(ab,l);
aa=N(aa,L);
Z=N(Z,z);
Y=N(Y,h)
}var m=E(ab)+E(aa)+E(Z)+E(Y);
return m.toLowerCase()
}var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";
var m,k,g,l,h,f,d;
var b=0;
c=Base64._utf8_encode(c);
while(b<c.length){m=c.charCodeAt(b++);
k=c.charCodeAt(b++);
g=c.charCodeAt(b++);
l=m>>2;
h=((m&3)<<4)|(k>>4);
f=((k&15)<<2)|(g>>6);
d=g&63;
if(isNaN(k)){f=d=64
}else{if(isNaN(g)){d=64
}}a=a+this._keyStr.charAt(l)+this._keyStr.charAt(h)+this._keyStr.charAt(f)+this._keyStr.charAt(d)
}return a
},decode:function(c){var a="";
var m,k,g;
var l,h,f,d;
var b=0;
c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");
while(b<c.length){l=this._keyStr.indexOf(c.charAt(b++));
h=this._keyStr.indexOf(c.charAt(b++));
f=this._keyStr.indexOf(c.charAt(b++));
d=this._keyStr.indexOf(c.charAt(b++));
m=(l<<2)|(h>>4);
k=((h&15)<<4)|(f>>2);
g=((f&3)<<6)|d;
a=a+String.fromCharCode(m);
if(f!=64){a=a+String.fromCharCode(k)
}if(d!=64){a=a+String.fromCharCode(g)
}}a=Base64._utf8_decode(a);
return a
},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");
var a="";
for(var f=0;
f<b.length;
f++){var d=b.charCodeAt(f);
if(d<128){a+=String.fromCharCode(d)
}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);
a+=String.fromCharCode((d&63)|128)
}else{a+=String.fromCharCode((d>>12)|224);
a+=String.fromCharCode(((d>>6)&63)|128);
a+=String.fromCharCode((d&63)|128)
}}}return a
},_utf8_decode:function(a){var b="";
var d=0;
var f=c1=c2=0;
while(d<a.length){f=a.charCodeAt(d);
if(f<128){b+=String.fromCharCode(f);
d++
}else{if((f>191)&&(f<224)){c2=a.charCodeAt(d+1);
b+=String.fromCharCode(((f&31)<<6)|(c2&63));
d+=2
}else{c2=a.charCodeAt(d+1);
c3=a.charCodeAt(d+2);
b+=String.fromCharCode(((f&15)<<12)|((c2&63)<<6)|(c3&63));
d+=3
}}}return b
}};
(function(b){var a={};
if(typeof(exports)==="undefined"){if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){a.exports={};
define(function(){return a.exports
})
}else{a.exports=typeof(window)!=="undefined"?window:b
}}else{a.exports=exports
}(function(n){if(!s){var s=0.000001
}if(!f){var f=(typeof Float32Array!=="undefined")?Float32Array:Array
}if(!l){var l=Math.random
}var g={};
g.setMatrixArrayType=function(t){f=t
};
if(typeof(n)!=="undefined"){n.glMatrix=g
}var m=Math.PI/180;
g.toRadian=function(t){return t*m
};
var q={};
q.create=function(){var t=new f(2);
t[0]=0;
t[1]=0;
return t
};
q.clone=function(t){var u=new f(2);
u[0]=t[0];
u[1]=t[1];
return u
};
q.fromValues=function(t,v){var u=new f(2);
u[0]=t;
u[1]=v;
return u
};
q.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
return u
};
q.set=function(u,t,v){u[0]=t;
u[1]=v;
return u
};
q.add=function(v,u,t){v[0]=u[0]+t[0];
v[1]=u[1]+t[1];
return v
};
q.subtract=function(v,u,t){v[0]=u[0]-t[0];
v[1]=u[1]-t[1];
return v
};
q.sub=q.subtract;
q.multiply=function(v,u,t){v[0]=u[0]*t[0];
v[1]=u[1]*t[1];
return v
};
q.mul=q.multiply;
q.divide=function(v,u,t){v[0]=u[0]/t[0];
v[1]=u[1]/t[1];
return v
};
q.div=q.divide;
q.min=function(v,u,t){v[0]=Math.min(u[0],t[0]);
v[1]=Math.min(u[1],t[1]);
return v
};
q.max=function(v,u,t){v[0]=Math.max(u[0],t[0]);
v[1]=Math.max(u[1],t[1]);
return v
};
q.scale=function(v,u,t){v[0]=u[0]*t;
v[1]=u[1]*t;
return v
};
q.scaleAndAdd=function(v,u,t,w){v[0]=u[0]+(t[0]*w);
v[1]=u[1]+(t[1]*w);
return v
};
q.distance=function(v,u){var t=u[0]-v[0],w=u[1]-v[1];
return Math.sqrt(t*t+w*w)
};
q.dist=q.distance;
q.squaredDistance=function(v,u){var t=u[0]-v[0],w=u[1]-v[1];
return t*t+w*w
};
q.sqrDist=q.squaredDistance;
q.length=function(u){var t=u[0],v=u[1];
return Math.sqrt(t*t+v*v)
};
q.len=q.length;
q.squaredLength=function(u){var t=u[0],v=u[1];
return t*t+v*v
};
q.sqrLen=q.squaredLength;
q.negate=function(u,t){u[0]=-t[0];
u[1]=-t[1];
return u
};
q.normalize=function(w,v){var u=v[0],z=v[1];
var t=u*u+z*z;
if(t>0){t=1/Math.sqrt(t);
w[0]=v[0]*t;
w[1]=v[1]*t
}return w
};
q.dot=function(u,t){return u[0]*t[0]+u[1]*t[1]
};
q.cross=function(v,u,t){var w=u[0]*t[1]-u[1]*t[0];
v[0]=v[1]=0;
v[2]=w;
return v
};
q.lerp=function(w,v,u,y){var A=v[0],z=v[1];
w[0]=A+y*(u[0]-A);
w[1]=z+y*(u[1]-z);
return w
};
q.random=function(t,v){v=v||1;
var u=l()*2*Math.PI;
t[0]=Math.cos(u)*v;
t[1]=Math.sin(u)*v;
return t
};
q.transformMat2=function(w,v,u){var t=v[0],z=v[1];
w[0]=u[0]*t+u[2]*z;
w[1]=u[1]*t+u[3]*z;
return w
};
q.transformMat2d=function(w,v,u){var t=v[0],z=v[1];
w[0]=u[0]*t+u[2]*z+u[4];
w[1]=u[1]*t+u[3]*z+u[5];
return w
};
q.transformMat3=function(w,v,u){var t=v[0],z=v[1];
w[0]=u[0]*t+u[3]*z+u[6];
w[1]=u[1]*t+u[4]*z+u[7];
return w
};
q.transformMat4=function(w,v,u){var t=v[0],z=v[1];
w[0]=u[0]*t+u[4]*z+u[12];
w[1]=u[1]*t+u[5]*z+u[13];
return w
};
q.forEach=(function(){var t=q.create();
return function(w,B,C,A,z,u){var y,v;
if(!B){B=2
}if(!C){C=0
}if(A){v=Math.min((A*B)+C,w.length)
}else{v=w.length
}for(y=C;
y<v;
y+=B){t[0]=w[y];
t[1]=w[y+1];
z(t,t,u);
w[y]=t[0];
w[y+1]=t[1]
}return w
}
})();
q.str=function(t){return"vec2("+t[0]+", "+t[1]+")"
};
if(typeof(n)!=="undefined"){n.vec2=q
}var p={};
p.create=function(){var t=new f(3);
t[0]=0;
t[1]=0;
t[2]=0;
return t
};
p.clone=function(t){var u=new f(3);
u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
return u
};
p.fromValues=function(t,w,v){var u=new f(3);
u[0]=t;
u[1]=w;
u[2]=v;
return u
};
p.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
return u
};
p.set=function(u,t,w,v){u[0]=t;
u[1]=w;
u[2]=v;
return u
};
p.add=function(v,u,t){v[0]=u[0]+t[0];
v[1]=u[1]+t[1];
v[2]=u[2]+t[2];
return v
};
p.subtract=function(v,u,t){v[0]=u[0]-t[0];
v[1]=u[1]-t[1];
v[2]=u[2]-t[2];
return v
};
p.sub=p.subtract;
p.multiply=function(v,u,t){v[0]=u[0]*t[0];
v[1]=u[1]*t[1];
v[2]=u[2]*t[2];
return v
};
p.mul=p.multiply;
p.divide=function(v,u,t){v[0]=u[0]/t[0];
v[1]=u[1]/t[1];
v[2]=u[2]/t[2];
return v
};
p.div=p.divide;
p.min=function(v,u,t){v[0]=Math.min(u[0],t[0]);
v[1]=Math.min(u[1],t[1]);
v[2]=Math.min(u[2],t[2]);
return v
};
p.max=function(v,u,t){v[0]=Math.max(u[0],t[0]);
v[1]=Math.max(u[1],t[1]);
v[2]=Math.max(u[2],t[2]);
return v
};
p.scale=function(v,u,t){v[0]=u[0]*t;
v[1]=u[1]*t;
v[2]=u[2]*t;
return v
};
p.scaleAndAdd=function(v,u,t,w){v[0]=u[0]+(t[0]*w);
v[1]=u[1]+(t[1]*w);
v[2]=u[2]+(t[2]*w);
return v
};
p.distance=function(v,u){var t=u[0]-v[0],A=u[1]-v[1],w=u[2]-v[2];
return Math.sqrt(t*t+A*A+w*w)
};
p.dist=p.distance;
p.squaredDistance=function(v,u){var t=u[0]-v[0],A=u[1]-v[1],w=u[2]-v[2];
return t*t+A*A+w*w
};
p.sqrDist=p.squaredDistance;
p.length=function(u){var t=u[0],w=u[1],v=u[2];
return Math.sqrt(t*t+w*w+v*v)
};
p.len=p.length;
p.squaredLength=function(u){var t=u[0],w=u[1],v=u[2];
return t*t+w*w+v*v
};
p.sqrLen=p.squaredLength;
p.negate=function(u,t){u[0]=-t[0];
u[1]=-t[1];
u[2]=-t[2];
return u
};
p.normalize=function(w,v){var u=v[0],B=v[1],A=v[2];
var t=u*u+B*B+A*A;
if(t>0){t=1/Math.sqrt(t);
w[0]=v[0]*t;
w[1]=v[1]*t;
w[2]=v[2]*t
}return w
};
p.dot=function(u,t){return u[0]*t[0]+u[1]*t[1]+u[2]*t[2]
};
p.cross=function(u,A,z){var t=A[0],C=A[1],B=A[2],y=z[0],w=z[1],v=z[2];
u[0]=C*v-B*w;
u[1]=B*y-t*v;
u[2]=t*w-C*y;
return u
};
p.lerp=function(w,v,u,y){var B=v[0],A=v[1],z=v[2];
w[0]=B+y*(u[0]-B);
w[1]=A+y*(u[1]-A);
w[2]=z+y*(u[2]-z);
return w
};
p.random=function(t,y){y=y||1;
var v=l()*2*Math.PI;
var w=(l()*2)-1;
var u=Math.sqrt(1-w*w)*y;
t[0]=Math.cos(v)*u;
t[1]=Math.sin(v)*u;
t[2]=w*y;
return t
};
p.transformMat4=function(w,v,u){var t=v[0],B=v[1],A=v[2];
w[0]=u[0]*t+u[4]*B+u[8]*A+u[12];
w[1]=u[1]*t+u[5]*B+u[9]*A+u[13];
w[2]=u[2]*t+u[6]*B+u[10]*A+u[14];
return w
};
p.transformMat3=function(w,v,u){var t=v[0],B=v[1],A=v[2];
w[0]=t*u[0]+B*u[3]+A*u[6];
w[1]=t*u[1]+B*u[4]+A*u[7];
w[2]=t*u[2]+B*u[5]+A*u[8];
return w
};
p.transformQuat=function(C,I,t){var J=I[0],H=I[1],G=I[2],E=t[0],D=t[1],B=t[2],F=t[3],w=F*J+D*G-B*H,v=F*H+B*J-E*G,u=F*G+E*H-D*J,A=-E*J-D*H-B*G;
C[0]=w*F+A*-E+v*-B-u*-D;
C[1]=v*F+A*-D+u*-E-w*-B;
C[2]=u*F+A*-B+w*-D-v*-E;
return C
};
p.forEach=(function(){var t=p.create();
return function(w,B,C,A,z,u){var y,v;
if(!B){B=3
}if(!C){C=0
}if(A){v=Math.min((A*B)+C,w.length)
}else{v=w.length
}for(y=C;
y<v;
y+=B){t[0]=w[y];
t[1]=w[y+1];
t[2]=w[y+2];
z(t,t,u);
w[y]=t[0];
w[y+1]=t[1];
w[y+2]=t[2]
}return w
}
})();
p.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"
};
if(typeof(n)!=="undefined"){n.vec3=p
}var o={};
o.create=function(){var t=new f(4);
t[0]=0;
t[1]=0;
t[2]=0;
t[3]=0;
return t
};
o.clone=function(t){var u=new f(4);
u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
return u
};
o.fromValues=function(t,B,A,u){var v=new f(4);
v[0]=t;
v[1]=B;
v[2]=A;
v[3]=u;
return v
};
o.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
return u
};
o.set=function(v,t,B,A,u){v[0]=t;
v[1]=B;
v[2]=A;
v[3]=u;
return v
};
o.add=function(v,u,t){v[0]=u[0]+t[0];
v[1]=u[1]+t[1];
v[2]=u[2]+t[2];
v[3]=u[3]+t[3];
return v
};
o.subtract=function(v,u,t){v[0]=u[0]-t[0];
v[1]=u[1]-t[1];
v[2]=u[2]-t[2];
v[3]=u[3]-t[3];
return v
};
o.sub=o.subtract;
o.multiply=function(v,u,t){v[0]=u[0]*t[0];
v[1]=u[1]*t[1];
v[2]=u[2]*t[2];
v[3]=u[3]*t[3];
return v
};
o.mul=o.multiply;
o.divide=function(v,u,t){v[0]=u[0]/t[0];
v[1]=u[1]/t[1];
v[2]=u[2]/t[2];
v[3]=u[3]/t[3];
return v
};
o.div=o.divide;
o.min=function(v,u,t){v[0]=Math.min(u[0],t[0]);
v[1]=Math.min(u[1],t[1]);
v[2]=Math.min(u[2],t[2]);
v[3]=Math.min(u[3],t[3]);
return v
};
o.max=function(v,u,t){v[0]=Math.max(u[0],t[0]);
v[1]=Math.max(u[1],t[1]);
v[2]=Math.max(u[2],t[2]);
v[3]=Math.max(u[3],t[3]);
return v
};
o.scale=function(v,u,t){v[0]=u[0]*t;
v[1]=u[1]*t;
v[2]=u[2]*t;
v[3]=u[3]*t;
return v
};
o.scaleAndAdd=function(v,u,t,w){v[0]=u[0]+(t[0]*w);
v[1]=u[1]+(t[1]*w);
v[2]=u[2]+(t[2]*w);
v[3]=u[3]+(t[3]*w);
return v
};
o.distance=function(A,u){var t=u[0]-A[0],C=u[1]-A[1],B=u[2]-A[2],v=u[3]-A[3];
return Math.sqrt(t*t+C*C+B*B+v*v)
};
o.dist=o.distance;
o.squaredDistance=function(A,u){var t=u[0]-A[0],C=u[1]-A[1],B=u[2]-A[2],v=u[3]-A[3];
return t*t+C*C+B*B+v*v
};
o.sqrDist=o.squaredDistance;
o.length=function(v){var t=v[0],B=v[1],A=v[2],u=v[3];
return Math.sqrt(t*t+B*B+A*A+u*u)
};
o.len=o.length;
o.squaredLength=function(v){var t=v[0],B=v[1],A=v[2],u=v[3];
return t*t+B*B+A*A+u*u
};
o.sqrLen=o.squaredLength;
o.negate=function(u,t){u[0]=-t[0];
u[1]=-t[1];
u[2]=-t[2];
u[3]=-t[3];
return u
};
o.normalize=function(B,A){var u=A[0],D=A[1],C=A[2],v=A[3];
var t=u*u+D*D+C*C+v*v;
if(t>0){t=1/Math.sqrt(t);
B[0]=A[0]*t;
B[1]=A[1]*t;
B[2]=A[2]*t;
B[3]=A[3]*t
}return B
};
o.dot=function(u,t){return u[0]*t[0]+u[1]*t[1]+u[2]*t[2]+u[3]*t[3]
};
o.lerp=function(w,v,u,y){var B=v[0],A=v[1],z=v[2],C=v[3];
w[0]=B+y*(u[0]-B);
w[1]=A+y*(u[1]-A);
w[2]=z+y*(u[2]-z);
w[3]=C+y*(u[3]-C);
return w
};
o.random=function(t,u){u=u||1;
t[0]=l();
t[1]=l();
t[2]=l();
t[3]=l();
o.normalize(t,t);
o.scale(t,t,u);
return t
};
o.transformMat4=function(B,A,u){var t=A[0],D=A[1],C=A[2],v=A[3];
B[0]=u[0]*t+u[4]*D+u[8]*C+u[12]*v;
B[1]=u[1]*t+u[5]*D+u[9]*C+u[13]*v;
B[2]=u[2]*t+u[6]*D+u[10]*C+u[14]*v;
B[3]=u[3]*t+u[7]*D+u[11]*C+u[15]*v;
return B
};
o.transformQuat=function(C,I,t){var J=I[0],H=I[1],G=I[2],E=t[0],D=t[1],B=t[2],F=t[3],w=F*J+D*G-B*H,v=F*H+B*J-E*G,u=F*G+E*H-D*J,A=-E*J-D*H-B*G;
C[0]=w*F+A*-E+v*-B-u*-D;
C[1]=v*F+A*-D+u*-E-w*-B;
C[2]=u*F+A*-B+w*-D-v*-E;
return C
};
o.forEach=(function(){var t=o.create();
return function(w,B,C,A,z,u){var y,v;
if(!B){B=4
}if(!C){C=0
}if(A){v=Math.min((A*B)+C,w.length)
}else{v=w.length
}for(y=C;
y<v;
y+=B){t[0]=w[y];
t[1]=w[y+1];
t[2]=w[y+2];
t[3]=w[y+3];
z(t,t,u);
w[y]=t[0];
w[y+1]=t[1];
w[y+2]=t[2];
w[y+3]=t[3]
}return w
}
})();
o.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"
};
if(typeof(n)!=="undefined"){n.vec4=o
}var h={};
h.create=function(){var t=new f(4);
t[0]=1;
t[1]=0;
t[2]=0;
t[3]=1;
return t
};
h.clone=function(t){var u=new f(4);
u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
return u
};
h.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
return u
};
h.identity=function(t){t[0]=1;
t[1]=0;
t[2]=0;
t[3]=1;
return t
};
h.transpose=function(v,u){if(v===u){var t=u[1];
v[1]=u[2];
v[2]=t
}else{v[0]=u[0];
v[1]=u[2];
v[2]=u[1];
v[3]=u[3]
}return v
};
h.invert=function(y,v){var w=v[0],u=v[1],t=v[2],A=v[3],z=w*A-t*u;
if(!z){return null
}z=1/z;
y[0]=A*z;
y[1]=-u*z;
y[2]=-t*z;
y[3]=w*z;
return y
};
h.adjoint=function(v,t){var u=t[0];
v[0]=t[3];
v[1]=-t[1];
v[2]=-t[2];
v[3]=u;
return v
};
h.determinant=function(t){return t[0]*t[3]-t[2]*t[1]
};
h.multiply=function(y,D,B){var w=D[0],v=D[1],u=D[2],t=D[3];
var E=B[0],C=B[1],A=B[2],z=B[3];
y[0]=w*E+v*A;
y[1]=w*C+v*z;
y[2]=u*E+t*A;
y[3]=u*C+t*z;
return y
};
h.mul=h.multiply;
h.rotate=function(y,B,A){var w=B[0],v=B[1],u=B[2],t=B[3],C=Math.sin(A),z=Math.cos(A);
y[0]=w*z+v*C;
y[1]=w*-C+v*z;
y[2]=u*z+t*C;
y[3]=u*-C+t*z;
return y
};
h.scale=function(z,A,C){var y=A[0],w=A[1],u=A[2],t=A[3],D=C[0],B=C[1];
z[0]=y*D;
z[1]=w*B;
z[2]=u*D;
z[3]=t*B;
return z
};
h.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"
};
if(typeof(n)!=="undefined"){n.mat2=h
}var r={};
r.create=function(){var t=new f(6);
t[0]=1;
t[1]=0;
t[2]=0;
t[3]=1;
t[4]=0;
t[5]=0;
return t
};
r.clone=function(t){var u=new f(6);
u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
u[4]=t[4];
u[5]=t[5];
return u
};
r.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
u[4]=t[4];
u[5]=t[5];
return u
};
r.identity=function(t){t[0]=1;
t[1]=0;
t[2]=0;
t[3]=1;
t[4]=0;
t[5]=0;
return t
};
r.invert=function(u,z){var t=z[0],C=z[1],B=z[2],A=z[3],w=z[4],v=z[5];
var y=t*A-C*B;
if(!y){return null
}y=1/y;
u[0]=A*y;
u[1]=-C*y;
u[2]=-B*y;
u[3]=t*y;
u[4]=(B*v-A*w)*y;
u[5]=(C*w-t*v)*y;
return u
};
r.determinant=function(t){return t[0]*t[3]-t[1]*t[2]
};
r.multiply=function(u,F,E){var t=F[0],I=F[1],H=F[2],G=F[3],w=F[4],v=F[5],C=E[0],A=E[1],z=E[2],y=E[3],D=E[4],B=E[5];
u[0]=t*C+I*z;
u[1]=t*A+I*y;
u[2]=H*C+G*z;
u[3]=H*A+G*y;
u[4]=C*w+z*v+D;
u[5]=A*w+y*v+B;
return u
};
r.mul=r.multiply;
r.rotate=function(u,A,z){var t=A[0],E=A[1],D=A[2],B=A[3],y=A[4],v=A[5],C=Math.sin(z),w=Math.cos(z);
u[0]=t*w+E*C;
u[1]=-t*C+E*w;
u[2]=D*w+B*C;
u[3]=-D*C+w*B;
u[4]=w*y+C*v;
u[5]=w*v-C*y;
return u
};
r.scale=function(w,t,u){var z=u[0],y=u[1];
w[0]=t[0]*z;
w[1]=t[1]*y;
w[2]=t[2]*z;
w[3]=t[3]*y;
w[4]=t[4]*z;
w[5]=t[5]*y;
return w
};
r.translate=function(w,t,u){w[0]=t[0];
w[1]=t[1];
w[2]=t[2];
w[3]=t[3];
w[4]=t[4]+u[0];
w[5]=t[5]+u[1];
return w
};
r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"
};
if(typeof(n)!=="undefined"){n.mat2d=r
}var d={};
d.create=function(){var t=new f(9);
t[0]=1;
t[1]=0;
t[2]=0;
t[3]=0;
t[4]=1;
t[5]=0;
t[6]=0;
t[7]=0;
t[8]=1;
return t
};
d.fromMat4=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[4];
u[4]=t[5];
u[5]=t[6];
u[6]=t[8];
u[7]=t[9];
u[8]=t[10];
return u
};
d.clone=function(t){var u=new f(9);
u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
u[4]=t[4];
u[5]=t[5];
u[6]=t[6];
u[7]=t[7];
u[8]=t[8];
return u
};
d.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
u[4]=t[4];
u[5]=t[5];
u[6]=t[6];
u[7]=t[7];
u[8]=t[8];
return u
};
d.identity=function(t){t[0]=1;
t[1]=0;
t[2]=0;
t[3]=0;
t[4]=1;
t[5]=0;
t[6]=0;
t[7]=0;
t[8]=1;
return t
};
d.transpose=function(v,u){if(v===u){var y=u[1],w=u[2],t=u[5];
v[1]=u[3];
v[2]=u[6];
v[3]=y;
v[5]=u[7];
v[6]=w;
v[7]=t
}else{v[0]=u[0];
v[1]=u[3];
v[2]=u[6];
v[3]=u[1];
v[4]=u[4];
v[5]=u[7];
v[6]=u[2];
v[7]=u[5];
v[8]=u[8]
}return v
};
d.invert=function(y,F){var w=F[0],v=F[1],u=F[2],I=F[3],H=F[4],G=F[5],D=F[6],C=F[7],A=F[8],z=A*H-G*C,t=-A*I+G*D,E=C*I-H*D,B=w*z+v*t+u*E;
if(!B){return null
}B=1/B;
y[0]=z*B;
y[1]=(-A*v+u*C)*B;
y[2]=(G*v-u*H)*B;
y[3]=t*B;
y[4]=(A*w-u*D)*B;
y[5]=(-G*w+u*I)*B;
y[6]=E*B;
y[7]=(-C*w+v*D)*B;
y[8]=(H*w-v*I)*B;
return y
};
d.adjoint=function(w,B){var v=B[0],u=B[1],t=B[2],E=B[3],D=B[4],C=B[5],A=B[6],z=B[7],y=B[8];
w[0]=(D*y-C*z);
w[1]=(t*z-u*y);
w[2]=(u*C-t*D);
w[3]=(C*A-E*y);
w[4]=(v*y-t*A);
w[5]=(t*E-v*C);
w[6]=(E*z-D*A);
w[7]=(u*A-v*z);
w[8]=(v*D-u*E);
return w
};
d.determinant=function(A){var v=A[0],u=A[1],t=A[2],D=A[3],C=A[4],B=A[5],z=A[6],y=A[7],w=A[8];
return v*(w*C-B*y)+u*(-w*D+B*z)+t*(y*D-C*z)
};
d.multiply=function(G,L,K){var O=L[0],N=L[1],M=L[2],z=L[3],y=L[4],w=L[5],F=L[6],E=L[7],D=L[8],C=K[0],B=K[1],A=K[2],J=K[3],I=K[4],H=K[5],v=K[6],u=K[7],t=K[8];
G[0]=C*O+B*z+A*F;
G[1]=C*N+B*y+A*E;
G[2]=C*M+B*w+A*D;
G[3]=J*O+I*z+H*F;
G[4]=J*N+I*y+H*E;
G[5]=J*M+I*w+H*D;
G[6]=v*O+u*z+t*F;
G[7]=v*N+u*y+t*E;
G[8]=v*M+u*w+t*D;
return G
};
d.mul=d.multiply;
d.translate=function(z,F,H){var w=F[0],u=F[1],t=F[2],J=F[3],I=F[4],G=F[5],C=F[6],B=F[7],A=F[8],E=H[0],D=H[1];
z[0]=w;
z[1]=u;
z[2]=t;
z[3]=J;
z[4]=I;
z[5]=G;
z[6]=E*w+D*J+C;
z[7]=E*u+D*I+B;
z[8]=E*t+D*G+A;
return z
};
d.rotate=function(w,D,C){var v=D[0],u=D[1],t=D[2],G=D[3],F=D[4],E=D[5],A=D[6],z=D[7],y=D[8],H=Math.sin(C),B=Math.cos(C);
w[0]=B*v+H*G;
w[1]=B*u+H*F;
w[2]=B*t+H*E;
w[3]=B*G-H*v;
w[4]=B*F-H*u;
w[5]=B*E-H*t;
w[6]=A;
w[7]=z;
w[8]=y;
return w
};
d.scale=function(z,u,w){var t=w[0],A=w[1];
z[0]=t*u[0];
z[1]=t*u[1];
z[2]=t*u[2];
z[3]=A*u[3];
z[4]=A*u[4];
z[5]=A*u[5];
z[6]=u[6];
z[7]=u[7];
z[8]=u[8];
return z
};
d.fromMat2d=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=0;
u[3]=t[2];
u[4]=t[3];
u[5]=0;
u[6]=t[4];
u[7]=t[5];
u[8]=1;
return u
};
d.fromQuat=function(H,E){var B=E[0],A=E[1],v=E[2],C=E[3],I=B+B,t=A+A,D=v+v,u=B*I,G=A*I,F=A*t,O=v*I,N=v*t,L=v*D,M=C*I,K=C*t,J=C*D;
H[0]=1-F-L;
H[3]=G-J;
H[6]=O+K;
H[1]=G+J;
H[4]=1-u-L;
H[7]=N-M;
H[2]=O-K;
H[5]=N+M;
H[8]=1-u-F;
return H
};
d.normalFromMat4=function(N,S){var W=S[0],U=S[1],T=S[2],Q=S[3],y=S[4],w=S[5],v=S[6],u=S[7],M=S[8],L=S[9],K=S[10],J=S[11],Y=S[12],X=S[13],V=S[14],R=S[15],I=W*w-U*y,H=W*v-T*y,G=W*u-Q*y,F=U*v-T*w,E=U*u-Q*w,D=T*u-Q*v,C=M*X-L*Y,B=M*V-K*Y,A=M*R-J*Y,z=L*V-K*X,P=L*R-J*X,O=K*R-J*V,t=I*O-H*P+G*z+F*A-E*B+D*C;
if(!t){return null
}t=1/t;
N[0]=(w*O-v*P+u*z)*t;
N[1]=(v*A-y*O-u*B)*t;
N[2]=(y*P-w*A+u*C)*t;
N[3]=(T*P-U*O-Q*z)*t;
N[4]=(W*O-T*A+Q*B)*t;
N[5]=(U*A-W*P-Q*C)*t;
N[6]=(X*D-V*E+R*F)*t;
N[7]=(V*G-Y*D-R*H)*t;
N[8]=(Y*E-X*G+R*I)*t;
return N
};
d.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"
};
if(typeof(n)!=="undefined"){n.mat3=d
}var c={};
c.create=function(){var t=new f(16);
t[0]=1;
t[1]=0;
t[2]=0;
t[3]=0;
t[4]=0;
t[5]=1;
t[6]=0;
t[7]=0;
t[8]=0;
t[9]=0;
t[10]=1;
t[11]=0;
t[12]=0;
t[13]=0;
t[14]=0;
t[15]=1;
return t
};
c.clone=function(t){var u=new f(16);
u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
u[4]=t[4];
u[5]=t[5];
u[6]=t[6];
u[7]=t[7];
u[8]=t[8];
u[9]=t[9];
u[10]=t[10];
u[11]=t[11];
u[12]=t[12];
u[13]=t[13];
u[14]=t[14];
u[15]=t[15];
return u
};
c.copy=function(u,t){u[0]=t[0];
u[1]=t[1];
u[2]=t[2];
u[3]=t[3];
u[4]=t[4];
u[5]=t[5];
u[6]=t[6];
u[7]=t[7];
u[8]=t[8];
u[9]=t[9];
u[10]=t[10];
u[11]=t[11];
u[12]=t[12];
u[13]=t[13];
u[14]=t[14];
u[15]=t[15];
return u
};
c.identity=function(t){t[0]=1;
t[1]=0;
t[2]=0;
t[3]=0;
t[4]=0;
t[5]=1;
t[6]=0;
t[7]=0;
t[8]=0;
t[9]=0;
t[10]=1;
t[11]=0;
t[12]=0;
t[13]=0;
t[14]=0;
t[15]=1;
return t
};
c.transpose=function(w,v){if(w===v){var B=v[1],z=v[2],y=v[3],t=v[6],A=v[7],u=v[11];
w[1]=v[4];
w[2]=v[8];
w[3]=v[12];
w[4]=B;
w[6]=v[9];
w[7]=v[13];
w[8]=z;
w[9]=t;
w[11]=v[14];
w[12]=y;
w[13]=A;
w[14]=u
}else{w[0]=v[0];
w[1]=v[4];
w[2]=v[8];
w[3]=v[12];
w[4]=v[1];
w[5]=v[5];
w[6]=v[9];
w[7]=v[13];
w[8]=v[2];
w[9]=v[6];
w[10]=v[10];
w[11]=v[14];
w[12]=v[3];
w[13]=v[7];
w[14]=v[11];
w[15]=v[15]
}return w
};
c.invert=function(N,S){var W=S[0],U=S[1],T=S[2],Q=S[3],y=S[4],w=S[5],v=S[6],u=S[7],M=S[8],L=S[9],K=S[10],J=S[11],Y=S[12],X=S[13],V=S[14],R=S[15],I=W*w-U*y,H=W*v-T*y,G=W*u-Q*y,F=U*v-T*w,E=U*u-Q*w,D=T*u-Q*v,C=M*X-L*Y,B=M*V-K*Y,A=M*R-J*Y,z=L*V-K*X,P=L*R-J*X,O=K*R-J*V,t=I*O-H*P+G*z+F*A-E*B+D*C;
if(!t){return null
}t=1/t;
N[0]=(w*O-v*P+u*z)*t;
N[1]=(T*P-U*O-Q*z)*t;
N[2]=(X*D-V*E+R*F)*t;
N[3]=(K*E-L*D-J*F)*t;
N[4]=(v*A-y*O-u*B)*t;
N[5]=(W*O-T*A+Q*B)*t;
N[6]=(V*G-Y*D-R*H)*t;
N[7]=(M*D-K*G+J*H)*t;
N[8]=(y*P-w*A+u*C)*t;
N[9]=(U*A-W*P-Q*C)*t;
N[10]=(Y*E-X*G+R*I)*t;
N[11]=(L*G-M*E-J*I)*t;
N[12]=(w*B-y*z-v*C)*t;
N[13]=(W*z-U*B+T*C)*t;
N[14]=(X*H-Y*F-V*I)*t;
N[15]=(M*F-L*H+K*I)*t;
return N
};
c.adjoint=function(C,F){var J=F[0],H=F[1],G=F[2],D=F[3],w=F[4],v=F[5],u=F[6],t=F[7],B=F[8],A=F[9],z=F[10],y=F[11],L=F[12],K=F[13],I=F[14],E=F[15];
C[0]=(v*(z*E-y*I)-A*(u*E-t*I)+K*(u*y-t*z));
C[1]=-(H*(z*E-y*I)-A*(G*E-D*I)+K*(G*y-D*z));
C[2]=(H*(u*E-t*I)-v*(G*E-D*I)+K*(G*t-D*u));
C[3]=-(H*(u*y-t*z)-v*(G*y-D*z)+A*(G*t-D*u));
C[4]=-(w*(z*E-y*I)-B*(u*E-t*I)+L*(u*y-t*z));
C[5]=(J*(z*E-y*I)-B*(G*E-D*I)+L*(G*y-D*z));
C[6]=-(J*(u*E-t*I)-w*(G*E-D*I)+L*(G*t-D*u));
C[7]=(J*(u*y-t*z)-w*(G*y-D*z)+B*(G*t-D*u));
C[8]=(w*(A*E-y*K)-B*(v*E-t*K)+L*(v*y-t*A));
C[9]=-(J*(A*E-y*K)-B*(H*E-D*K)+L*(H*y-D*A));
C[10]=(J*(v*E-t*K)-w*(H*E-D*K)+L*(H*t-D*v));
C[11]=-(J*(v*y-t*A)-w*(H*y-D*A)+B*(H*t-D*v));
C[12]=-(w*(A*I-z*K)-B*(v*I-u*K)+L*(v*z-u*A));
C[13]=(J*(A*I-z*K)-B*(H*I-G*K)+L*(H*z-G*A));
C[14]=-(J*(v*I-u*K)-w*(H*I-G*K)+L*(H*u-G*v));
C[15]=(J*(v*z-u*A)-w*(H*z-G*A)+B*(H*u-G*v));
return C
};
c.determinant=function(P){var U=P[0],S=P[1],Q=P[2],O=P[3],w=P[4],v=P[5],u=P[6],t=P[7],L=P[8],K=P[9],J=P[10],I=P[11],W=P[12],V=P[13],T=P[14],R=P[15],H=U*v-S*w,G=U*u-Q*w,F=U*t-O*w,E=S*u-Q*v,D=S*t-O*v,C=Q*t-O*u,B=L*V-K*W,A=L*T-J*W,z=L*R-I*W,y=K*T-J*V,N=K*R-I*V,M=J*R-I*T;
return H*M-G*N+F*y+E*z-D*A+C*B
};
c.multiply=function(G,K,H){var O=K[0],N=K[1],L=K[2],I=K[3],A=K[4],y=K[5],v=K[6],t=K[7],F=K[8],E=K[9],D=K[10],C=K[11],Q=K[12],P=K[13],M=K[14],J=K[15];
var B=H[0],z=H[1],w=H[2],u=H[3];
G[0]=B*O+z*A+w*F+u*Q;
G[1]=B*N+z*y+w*E+u*P;
G[2]=B*L+z*v+w*D+u*M;
G[3]=B*I+z*t+w*C+u*J;
B=H[4];
z=H[5];
w=H[6];
u=H[7];
G[4]=B*O+z*A+w*F+u*Q;
G[5]=B*N+z*y+w*E+u*P;
G[6]=B*L+z*v+w*D+u*M;
G[7]=B*I+z*t+w*C+u*J;
B=H[8];
z=H[9];
w=H[10];
u=H[11];
G[8]=B*O+z*A+w*F+u*Q;
G[9]=B*N+z*y+w*E+u*P;
G[10]=B*L+z*v+w*D+u*M;
G[11]=B*I+z*t+w*C+u*J;
B=H[12];
z=H[13];
w=H[14];
u=H[15];
G[12]=B*O+z*A+w*F+u*Q;
G[13]=B*N+z*y+w*E+u*P;
G[14]=B*L+z*v+w*D+u*M;
G[15]=B*I+z*t+w*C+u*J;
return G
};
c.mul=c.multiply;
c.translate=function(J,L,E){var D=E[0],C=E[1],B=E[2],O,N,M,K,A,w,u,t,I,H,G,F;
if(L===J){J[12]=L[0]*D+L[4]*C+L[8]*B+L[12];
J[13]=L[1]*D+L[5]*C+L[9]*B+L[13];
J[14]=L[2]*D+L[6]*C+L[10]*B+L[14];
J[15]=L[3]*D+L[7]*C+L[11]*B+L[15]
}else{O=L[0];
N=L[1];
M=L[2];
K=L[3];
A=L[4];
w=L[5];
u=L[6];
t=L[7];
I=L[8];
H=L[9];
G=L[10];
F=L[11];
J[0]=O;
J[1]=N;
J[2]=M;
J[3]=K;
J[4]=A;
J[5]=w;
J[6]=u;
J[7]=t;
J[8]=I;
J[9]=H;
J[10]=G;
J[11]=F;
J[12]=O*D+A*C+I*B+L[12];
J[13]=N*D+w*C+H*B+L[13];
J[14]=M*D+u*C+G*B+L[14];
J[15]=K*D+t*C+F*B+L[15]
}return J
};
c.scale=function(A,u,w){var t=w[0],C=w[1],B=w[2];
A[0]=u[0]*t;
A[1]=u[1]*t;
A[2]=u[2]*t;
A[3]=u[3]*t;
A[4]=u[4]*C;
A[5]=u[5]*C;
A[6]=u[6]*C;
A[7]=u[7]*C;
A[8]=u[8]*B;
A[9]=u[9]*B;
A[10]=u[10]*B;
A[11]=u[11]*B;
A[12]=u[12];
A[13]=u[13];
A[14]=u[14];
A[15]=u[15];
return A
};
c.rotate=function(R,Y,aa,u){var H=u[0],G=u[1],F=u[2],S=Math.sqrt(H*H+G*G+F*F),M,W,L,ac,ab,Z,X,E,D,C,B,Q,P,O,N,K,J,I,V,U,T,A,w,v;
if(Math.abs(S)<s){return null
}S=1/S;
H*=S;
G*=S;
F*=S;
M=Math.sin(aa);
W=Math.cos(aa);
L=1-W;
ac=Y[0];
ab=Y[1];
Z=Y[2];
X=Y[3];
E=Y[4];
D=Y[5];
C=Y[6];
B=Y[7];
Q=Y[8];
P=Y[9];
O=Y[10];
N=Y[11];
K=H*H*L+W;
J=G*H*L+F*M;
I=F*H*L-G*M;
V=H*G*L-F*M;
U=G*G*L+W;
T=F*G*L+H*M;
A=H*F*L+G*M;
w=G*F*L-H*M;
v=F*F*L+W;
R[0]=ac*K+E*J+Q*I;
R[1]=ab*K+D*J+P*I;
R[2]=Z*K+C*J+O*I;
R[3]=X*K+B*J+N*I;
R[4]=ac*V+E*U+Q*T;
R[5]=ab*V+D*U+P*T;
R[6]=Z*V+C*U+O*T;
R[7]=X*V+B*U+N*T;
R[8]=ac*A+E*w+Q*v;
R[9]=ab*A+D*w+P*v;
R[10]=Z*A+C*w+O*v;
R[11]=X*A+B*w+N*v;
if(Y!==R){R[12]=Y[12];
R[13]=Y[13];
R[14]=Y[14];
R[15]=Y[15]
}return R
};
c.rotateX=function(t,B,A){var G=Math.sin(A),z=Math.cos(A),F=B[4],E=B[5],D=B[6],C=B[7],y=B[8],w=B[9],v=B[10],u=B[11];
if(B!==t){t[0]=B[0];
t[1]=B[1];
t[2]=B[2];
t[3]=B[3];
t[12]=B[12];
t[13]=B[13];
t[14]=B[14];
t[15]=B[15]
}t[4]=F*z+y*G;
t[5]=E*z+w*G;
t[6]=D*z+v*G;
t[7]=C*z+u*G;
t[8]=y*z-F*G;
t[9]=w*z-E*G;
t[10]=v*z-D*G;
t[11]=u*z-C*G;
return t
};
c.rotateY=function(y,F,E){var G=Math.sin(E),D=Math.cos(E),w=F[0],v=F[1],u=F[2],t=F[3],C=F[8],B=F[9],A=F[10],z=F[11];
if(F!==y){y[4]=F[4];
y[5]=F[5];
y[6]=F[6];
y[7]=F[7];
y[12]=F[12];
y[13]=F[13];
y[14]=F[14];
y[15]=F[15]
}y[0]=w*D-C*G;
y[1]=v*D-B*G;
y[2]=u*D-A*G;
y[3]=t*D-z*G;
y[8]=w*G+C*D;
y[9]=v*G+B*D;
y[10]=u*G+A*D;
y[11]=t*G+z*D;
return y
};
c.rotateZ=function(y,B,A){var G=Math.sin(A),z=Math.cos(A),w=B[0],v=B[1],u=B[2],t=B[3],F=B[4],E=B[5],D=B[6],C=B[7];
if(B!==y){y[8]=B[8];
y[9]=B[9];
y[10]=B[10];
y[11]=B[11];
y[12]=B[12];
y[13]=B[13];
y[14]=B[14];
y[15]=B[15]
}y[0]=w*z+F*G;
y[1]=v*z+E*G;
y[2]=u*z+D*G;
y[3]=t*z+C*G;
y[4]=F*z-w*G;
y[5]=E*z-v*G;
y[6]=D*z-u*G;
y[7]=C*z-t*G;
return y
};
c.fromRotationTranslation=function(L,J,H){var E=J[0],D=J[1],C=J[2],F=J[3],M=E+E,t=D+D,G=C+C,B=E*M,A=E*t,u=E*G,K=D*t,I=D*G,P=C*G,Q=F*M,O=F*t,N=F*G;
L[0]=1-(K+P);
L[1]=A+N;
L[2]=u-O;
L[3]=0;
L[4]=A-N;
L[5]=1-(B+P);
L[6]=I+Q;
L[7]=0;
L[8]=u+O;
L[9]=I-Q;
L[10]=1-(B+K);
L[11]=0;
L[12]=H[0];
L[13]=H[1];
L[14]=H[2];
L[15]=1;
return L
};
c.fromQuat=function(H,E){var B=E[0],A=E[1],v=E[2],C=E[3],I=B+B,t=A+A,D=v+v,u=B*I,G=A*I,F=A*t,O=v*I,N=v*t,L=v*D,M=C*I,K=C*t,J=C*D;
H[0]=1-F-L;
H[1]=G+J;
H[2]=O-K;
H[3]=0;
H[4]=G-J;
H[5]=1-u-L;
H[6]=N+M;
H[7]=0;
H[8]=O+K;
H[9]=N-M;
H[10]=1-u-F;
H[11]=0;
H[12]=0;
H[13]=0;
H[14]=0;
H[15]=1;
return H
};
c.frustum=function(y,u,D,t,C,A,z){var B=1/(D-u),w=1/(C-t),v=1/(A-z);
y[0]=(A*2)*B;
y[1]=0;
y[2]=0;
y[3]=0;
y[4]=0;
y[5]=(A*2)*w;
y[6]=0;
y[7]=0;
y[8]=(D+u)*B;
y[9]=(C+t)*w;
y[10]=(z+A)*v;
y[11]=-1;
y[12]=0;
y[13]=0;
y[14]=(z*A*2)*v;
y[15]=0;
return y
};
c.perspective=function(w,v,u,y,t){var A=1/Math.tan(v/2),z=1/(y-t);
w[0]=A/u;
w[1]=0;
w[2]=0;
w[3]=0;
w[4]=0;
w[5]=A;
w[6]=0;
w[7]=0;
w[8]=0;
w[9]=0;
w[10]=(t+y)*z;
w[11]=-1;
w[12]=0;
w[13]=0;
w[14]=(2*t*y)*z;
w[15]=0;
return w
};
c.ortho=function(w,u,D,t,B,A,z){var y=1/(u-D),C=1/(t-B),v=1/(A-z);
w[0]=-2*y;
w[1]=0;
w[2]=0;
w[3]=0;
w[4]=0;
w[5]=-2*C;
w[6]=0;
w[7]=0;
w[8]=0;
w[9]=0;
w[10]=2*v;
w[11]=0;
w[12]=(u+D)*y;
w[13]=(B+t)*C;
w[14]=(z+A)*v;
w[15]=1;
return w
};
c.lookAt=function(I,P,Q,A){var O,N,L,v,u,t,D,C,B,J,M=P[0],K=P[1],H=P[2],z=A[0],y=A[1],w=A[2],G=Q[0],F=Q[1],E=Q[2];
if(Math.abs(M-G)<s&&Math.abs(K-F)<s&&Math.abs(H-E)<s){return c.identity(I)
}D=M-G;
C=K-F;
B=H-E;
J=1/Math.sqrt(D*D+C*C+B*B);
D*=J;
C*=J;
B*=J;
O=y*B-w*C;
N=w*D-z*B;
L=z*C-y*D;
J=Math.sqrt(O*O+N*N+L*L);
if(!J){O=0;
N=0;
L=0
}else{J=1/J;
O*=J;
N*=J;
L*=J
}v=C*L-B*N;
u=B*O-D*L;
t=D*N-C*O;
J=Math.sqrt(v*v+u*u+t*t);
if(!J){v=0;
u=0;
t=0
}else{J=1/J;
v*=J;
u*=J;
t*=J
}I[0]=O;
I[1]=v;
I[2]=D;
I[3]=0;
I[4]=N;
I[5]=u;
I[6]=C;
I[7]=0;
I[8]=L;
I[9]=t;
I[10]=B;
I[11]=0;
I[12]=-(O*M+N*K+L*H);
I[13]=-(v*M+u*K+t*H);
I[14]=-(D*M+C*K+B*H);
I[15]=1;
return I
};
c.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"
};
if(typeof(n)!=="undefined"){n.mat4=c
}var k={};
k.create=function(){var t=new f(4);
t[0]=0;
t[1]=0;
t[2]=0;
t[3]=1;
return t
};
k.rotationTo=(function(){var t=p.create();
var u=p.fromValues(1,0,0);
var v=p.fromValues(0,1,0);
return function(A,y,w){var z=p.dot(y,w);
if(z<-0.999999){p.cross(t,u,y);
if(p.length(t)<0.000001){p.cross(t,v,y)
}p.normalize(t,t);
k.setAxisAngle(A,t,Math.PI);
return A
}else{if(z>0.999999){A[0]=0;
A[1]=0;
A[2]=0;
A[3]=1;
return A
}else{p.cross(t,y,w);
A[0]=t[0];
A[1]=t[1];
A[2]=t[2];
A[3]=1+z;
return k.normalize(A,A)
}}}
})();
k.setAxes=(function(){var t=d.create();
return function(w,v,y,u){t[0]=y[0];
t[3]=y[1];
t[6]=y[2];
t[1]=u[0];
t[4]=u[1];
t[7]=u[2];
t[2]=-v[0];
t[5]=-v[1];
t[8]=-v[2];
return k.normalize(w,k.fromMat3(w,t))
}
})();
k.clone=o.clone;
k.fromValues=o.fromValues;
k.copy=o.copy;
k.set=o.set;
k.identity=function(t){t[0]=0;
t[1]=0;
t[2]=0;
t[3]=1;
return t
};
k.setAxisAngle=function(u,w,t){t=t*0.5;
var v=Math.sin(t);
u[0]=v*w[0];
u[1]=v*w[1];
u[2]=v*w[2];
u[3]=Math.cos(t);
return u
};
k.add=o.add;
k.multiply=function(v,C,B){var t=C[0],E=C[1],D=C[2],u=C[3],z=B[0],y=B[1],w=B[2],A=B[3];
v[0]=t*A+u*z+E*w-D*y;
v[1]=E*A+u*y+D*z-t*w;
v[2]=D*A+u*w+t*y-E*z;
v[3]=u*A-t*z-E*y-D*w;
return v
};
k.mul=k.multiply;
k.scale=o.scale;
k.rotateX=function(v,A,y){y*=0.5;
var t=A[0],C=A[1],B=A[2],u=A[3],w=Math.sin(y),z=Math.cos(y);
v[0]=t*z+u*w;
v[1]=C*z+B*w;
v[2]=B*z-C*w;
v[3]=u*z-t*w;
return v
};
k.rotateY=function(v,A,y){y*=0.5;
var t=A[0],C=A[1],B=A[2],u=A[3],w=Math.sin(y),z=Math.cos(y);
v[0]=t*z-B*w;
v[1]=C*z+u*w;
v[2]=B*z+t*w;
v[3]=u*z-C*w;
return v
};
k.rotateZ=function(v,A,y){y*=0.5;
var t=A[0],C=A[1],B=A[2],u=A[3],w=Math.sin(y),z=Math.cos(y);
v[0]=t*z+C*w;
v[1]=C*z-t*w;
v[2]=B*z+u*w;
v[3]=u*z-B*w;
return v
};
k.calculateW=function(v,u){var t=u[0],A=u[1],w=u[2];
v[0]=t;
v[1]=A;
v[2]=w;
v[3]=-Math.sqrt(Math.abs(1-t*t-A*A-w*w));
return v
};
k.dot=o.dot;
k.lerp=o.lerp;
k.slerp=function(z,H,G,K){var u=H[0],L=H[1],J=H[2],w=H[3],E=G[0],D=G[1],C=G[2],F=G[3];
var I,v,y,B,A;
v=u*E+L*D+J*C+w*F;
if(v<0){v=-v;
E=-E;
D=-D;
C=-C;
F=-F
}if((1-v)>0.000001){I=Math.acos(v);
y=Math.sin(I);
B=Math.sin((1-K)*I)/y;
A=Math.sin(K*I)/y
}else{B=1-K;
A=K
}z[0]=B*u+A*E;
z[1]=B*L+A*D;
z[2]=B*J+A*C;
z[3]=B*w+A*F;
return z
};
k.invert=function(A,v){var y=v[0],u=v[1],t=v[2],B=v[3],w=y*y+u*u+t*t+B*B,z=w?1/w:0;
A[0]=-y*z;
A[1]=-u*z;
A[2]=-t*z;
A[3]=B*z;
return A
};
k.conjugate=function(u,t){u[0]=-t[0];
u[1]=-t[1];
u[2]=-t[2];
u[3]=t[3];
return u
};
k.length=o.length;
k.len=k.length;
k.squaredLength=o.squaredLength;
k.sqrLen=k.squaredLength;
k.normalize=o.normalize;
k.fromMat3=function(y,t){var u=t[0]+t[4]+t[8];
var A;
if(u>0){A=Math.sqrt(u+1);
y[3]=0.5*A;
A=0.5/A;
y[0]=(t[7]-t[5])*A;
y[1]=(t[2]-t[6])*A;
y[2]=(t[3]-t[1])*A
}else{var z=0;
if(t[4]>t[0]){z=1
}if(t[8]>t[z*3+z]){z=2
}var w=(z+1)%3;
var v=(z+2)%3;
A=Math.sqrt(t[z*3+z]-t[w*3+w]-t[v*3+v]+1);
y[z]=0.5*A;
A=0.5/A;
y[3]=(t[v*3+w]-t[w*3+v])*A;
y[w]=(t[w*3+z]+t[z*3+w])*A;
y[v]=(t[v*3+z]+t[z*3+v])*A
}return y
};
k.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"
};
if(typeof(n)!=="undefined"){n.quat=k
}})(a.exports)
})(this);
/*! jQuery v1.7.1 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1
}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");
d.remove();
if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);
if(!cm||!cl.createElement){cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close()
}d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)
}ck[a]=e
}return ck[a]
}function cu(a,b){var c={};
f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a
});
return c
}function ct(){cr=b
}function cs(){setTimeout(ct,0);
return cr=f.now()
}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")
}catch(b){}}function ci(){try{return new a.XMLHttpRequest
}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));
var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;
for(g=1;
g<i;
g++){if(g===1){for(h in a.converters){typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h])
}}l=k,k=d[g];
if(k==="*"){k=l
}else{if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];
if(!n){p=b;
for(o in e){j=o.split(" ");
if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];
if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);
break
}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))
}}}return c
}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;
for(i in g){i in d&&(c[g[i]]=d[i])
}while(f[0]==="*"){f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"))
}if(h){for(i in e){if(e[i]&&e[i].test(h)){f.unshift(i);
break
}}}if(f[0] in d){j=f[0]
}else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;
break
}k||(k=i)
}j=j||k
}if(j){j!==f[0]&&f.unshift(j);
return d[j]
}}function ca(a,b,c,d){if(f.isArray(b)){f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)
})
}else{if(!c&&b!=null&&typeof b=="object"){for(var e in b){ca(a+"["+e+"]",b[e],c,d)
}}else{d(a,b)
}}}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};
for(d in c){c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d])
}e&&f.extend(!0,a,e)
}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;
var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;
for(;
i<j&&(k||!l);
i++){l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)))
}(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));
return l
}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");
if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;
for(;
e<g;
e++){h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)
}}}
}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;
if(d>0){if(c!=="border"){for(;
g<h;
g++){c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0
}}return d+"px"
}d=bz(a,b,b);
if(d<0||d==null){d=a.style[b]||0
}d=parseFloat(d)||0;
if(c){for(;
g<h;
g++){d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0)
}}return d+"px"
}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)
}function bo(a){var b=c.createElement("div");
bh.appendChild(b),b.innerHTML=a.outerHTML;
return b.firstChild
}function bn(a){var b=(a.nodeName||"").toLowerCase();
b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)
}function bm(a){if(a.type==="checkbox"||a.type==="radio"){a.defaultChecked=a.checked
}}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]
}function bk(a,b){var c;
if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();
if(c==="object"){b.outerHTML=a.outerHTML
}else{if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option"){b.selected=a.defaultSelected
}else{if(c==="input"||c==="textarea"){b.defaultValue=a.defaultValue
}}}else{a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value)
}}b.removeAttribute(f.expando)
}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;
if(i){delete h.handle,h.events={};
for(c in i){for(d=0,e=i[c].length;
d<e;
d++){f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)
}}}h.data&&(h.data=f.extend({},h.data))
}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a
}function U(a){var b=V.split("|"),c=a.createDocumentFragment();
if(c.createElement){while(b.length){c.createElement(b.pop())
}}return c
}function T(a,b,c){b=b||0;
if(f.isFunction(b)){return f.grep(a,function(a,d){var e=!!b.call(a,d,a);
return e===c
})
}if(b.nodeType){return f.grep(a,function(a,d){return a===b===c
})
}if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1
});
if(O.test(b)){return f.filter(b,d,!c)
}b=f.filter(b,d)
}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c
})
}function S(a){return !a||!a.parentNode||a.parentNode.nodeType===11
}function K(){return !0
}function J(){return !1
}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);
h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())
},0)
}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b])){continue
}if(b!=="toJSON"){return !1
}}return !0
}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();
d=a.getAttribute(e);
if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d
}catch(g){}f.data(a,c,d)
}else{d=b
}}return d
}function h(a){var b=g[a]={},c,d;
a=a.split(/\s+/);
for(c=0,d=a.length;
c<d;
c++){b[a[c]]=!0
}return b
}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")
}catch(a){setTimeout(J,1);
return
}e.ready()
}}var e=function(a,b){return new e.fn.init(a,b,h)
},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()
},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};
e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;
if(!a){return this
}if(a.nodeType){this.context=this[0]=a,this.length=1;
return this
}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;
return this
}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];
if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);
return e.merge(this,a)
}h=c.getElementById(g[2]);
if(h&&h.parentNode){if(h.id!==g[2]){return f.find(a)
}this.length=1,this[0]=h
}this.context=c,this.selector=a;
return this
}return !d||d.jquery?(d||f).find(a):this.constructor(d).find(a)
}if(e.isFunction(a)){return f.ready(a)
}a.selector!==b&&(this.selector=a.selector,this.context=a.context);
return e.makeArray(a,this)
},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length
},toArray:function(){return F.call(this,0)
},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]
},pushStack:function(a,b,c){var d=this.constructor();
e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");
return d
},each:function(a,b){return e.each(this,a,b)
},ready:function(a){e.bindReady(),A.add(a);
return this
},eq:function(a){a=+a;
return a===-1?this.slice(a):this.slice(a,a+1)
},first:function(){return this.eq(0)
},last:function(){return this.eq(-1)
},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))
},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)
}))
},end:function(){return this.prevObject||this.constructor(null)
},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;
typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);
for(;
j<k;
j++){if((a=arguments[j])!=null){for(c in a){d=i[c],f=a[c];
if(i===f){continue
}l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)
}}}return i
},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);
return e
},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)
},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body){return setTimeout(e.ready,1)
}e.isReady=!0;
if(a!==!0&&--e.readyWait>0){return
}A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")
}},bindReady:function(){if(!A){A=e.Callbacks("once memory");
if(c.readyState==="complete"){return setTimeout(e.ready,1)
}if(c.addEventListener){c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1)
}else{if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);
var b=!1;
try{b=a.frameElement==null
}catch(d){}c.documentElement.doScroll&&b&&J()
}}}},isFunction:function(a){return e.type(a)==="function"
},isArray:Array.isArray||function(a){return e.type(a)==="array"
},isWindow:function(a){return a&&typeof a=="object"&&"setInterval" in a
},isNumeric:function(a){return !isNaN(parseFloat(a))&&isFinite(a)
},type:function(a){return a==null?String(a):I[C.call(a)]||"object"
},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a)){return !1
}try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf")){return !1
}}catch(c){return !1
}var d;
for(d in a){}return d===b||D.call(a,d)
},isEmptyObject:function(a){for(var b in a){return !1
}return !0
},error:function(a){throw new Error(a)
},parseJSON:function(b){if(typeof b!="string"||!b){return null
}b=e.trim(b);
if(a.JSON&&a.JSON.parse){return a.JSON.parse(b)
}if(n.test(b.replace(o,"@").replace(p,"]").replace(q,""))){return(new Function("return "+b))()
}e.error("Invalid JSON: "+b)
},parseXML:function(c){var d,f;
try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))
}catch(g){d=b
}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);
return d
},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)
})(b)
},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)
},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()
},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);
if(d){if(i){for(f in a){if(c.apply(a[f],d)===!1){break
}}}else{for(;
g<h;
){if(c.apply(a[g++],d)===!1){break
}}}}else{if(i){for(f in a){if(c.call(a[f],f,a[f])===!1){break
}}}else{for(;
g<h;
){if(c.call(a[g],g,a[g++])===!1){break
}}}}return a
},trim:G?function(a){return a==null?"":G.call(a)
}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")
},makeArray:function(a,b){var c=b||[];
if(a!=null){var d=e.type(a);
a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)
}return c
},inArray:function(a,b,c){var d;
if(b){if(H){return H.call(b,a,c)
}d=b.length,c=c?c<0?Math.max(0,d+c):c:0;
for(;
c<d;
c++){if(c in b&&b[c]===a){return c
}}}return -1
},merge:function(a,c){var d=a.length,e=0;
if(typeof c.length=="number"){for(var f=c.length;
e<f;
e++){a[d++]=c[e]
}}else{while(c[e]!==b){a[d++]=c[e++]
}}a.length=d;
return a
},grep:function(a,b,c){var d=[],e;
c=!!c;
for(var f=0,g=a.length;
f<g;
f++){e=!!b(a[f],f),c!==e&&d.push(a[f])
}return d
},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));
if(k){for(;
i<j;
i++){f=c(a[i],i,d),f!=null&&(h[h.length]=f)
}}else{for(g in a){f=c(a[g],g,d),f!=null&&(h[h.length]=f)
}}return h.concat.apply([],h)
},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];
c=a,a=d
}if(!e.isFunction(a)){return b
}var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))
};
g.guid=a.guid=a.guid||g.guid||e.guid++;
return g
},access:function(a,c,d,f,g,h){var i=a.length;
if(typeof c=="object"){for(var j in c){e.access(a,j,c[j],f,g,d)
}return a
}if(d!==b){f=!h&&f&&e.isFunction(d);
for(var k=0;
k<i;
k++){g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h)
}return a
}return i?g(a[0],c):b
},now:function(){return(new Date).getTime()
},uaMatch:function(a){a=a.toLowerCase();
var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];
return{browser:b[1]||"",version:b[2]||"0"}
},sub:function(){function a(b,c){return new a.fn.init(b,c)
}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));
return e.fn.init.call(this,d,f,b)
},a.fn.init.prototype=a.fn;
var b=a(c);
return a
},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()
}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()
}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())
});
return e
}(),g={};
f.Callbacks=function(a){a=a?g[a]||h(a):{};
var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;
for(d=0,e=b.length;
d<e;
d++){g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)
}},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;
for(;
c&&l<k;
l++){if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;
break
}}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))
},o={add:function(){if(c){var a=c.length;
m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))
}return this
},remove:function(){if(c){var b=arguments,d=0,e=b.length;
for(;
d<e;
d++){for(var f=0;
f<c.length;
f++){if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);
if(a.unique){break
}}}}}return this
},has:function(a){if(c){var b=0,d=c.length;
for(;
b<d;
b++){if(a===c[b]){return !0
}}}return !1
},empty:function(){c=[];
return this
},disable:function(){c=d=e=b;
return this
},disabled:function(){return !c
},lock:function(){d=b,(!e||e===!0)&&o.disable();
return this
},locked:function(){return !d
},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));
return this
},fire:function(){o.fireWith(this,arguments);
return this
},fired:function(){return !!e
}};
return o
};
var i=[].slice;
f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e
},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);
return this
},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);
return this
},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;
f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])
}):i[a](d[e])
})
}).promise()
},promise:function(a){if(a==null){a=h
}else{for(var b in h){a[b]=h[b]
}}return a
}},i=h.promise({}),j;
for(j in g){i[j]=g[j].fire,i[j+"With"]=g[j].fireWith
}i.done(function(){e="resolved"
},c.disable,d.lock).fail(function(){e="rejected"
},b.disable,d.lock),a&&a.call(i,i);
return i
},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)
}
}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)
}
}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();
if(d>1){for(;
c<d;
c++){b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g
}g||j.resolveWith(j,b)
}else{j!==a&&j.resolveWith(j,d?[a]:[])
}return k
}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;
q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];
if(!d||!d.length||!e){return{}
}g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;
try{delete q.test
}catch(s){b.deleteExpando=!1
}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1
}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);
if(q.attachEvent){for(o in {submit:1,change:1,focusin:1}){n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p
}}k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];
!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div><table "+n+" cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))
});
return b
}();
var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;
f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];
return !!a&&!m(a)
},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";
if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b){return
}n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));
if(typeof c=="object"||typeof c=="function"){e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c)
}g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);
if(o&&!h[c]){return g.events
}k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;
return i
}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;
if(!j[k]){return
}if(b){d=c?j[k]:j[k].data;
if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));
for(e=0,g=b.length;
e<g;
e++){delete d[b[e]]
}if(!(c?m:f.isEmptyObject)(d)){return
}}}if(!c){delete j[k].data;
if(!m(j[k])){return
}}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)
}},_data:function(a,b,c){return f.data(a,b,c,!0)
},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];
if(b){return b!==!0&&a.getAttribute("classid")===b
}}return !0
}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;
if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);
if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;
for(var i=0,j=e.length;
i<j;
i++){g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]))
}f._data(this[0],"parsedAttrs",!0)
}}return h
}if(typeof a=="object"){return this.each(function(){f.data(this,a)
})
}d=a.split("."),d[1]=d[1]?"."+d[1]:"";
if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));
return h===b&&d[1]?this.data(d[0]):h
}return this.each(function(){var b=f(this),e=[d[0],c];
b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)
})
},removeData:function(a){return this.each(function(){f.removeData(this,a)
})
}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))
},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);
if(b){c=c||"fx";
var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;
e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))
}},queue:function(a,b,c){var d;
if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));
return d||[]
}},dequeue:function(a,b){b=b||"fx";
var c=f.queue(a,b),d=c.shift(),e={};
d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)
},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))
}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");
if(c===b){return f.queue(this[0],a)
}return this.each(function(){var b=f.queue(this,a,c);
a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)
})
},dequeue:function(a){return this.each(function(){f.dequeue(this,a)
})
},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";
return this.queue(b,function(b,c){var d=setTimeout(b,a);
c.stop=function(){clearTimeout(d)
}
})
},clearQueue:function(a){return this.queue(a||"fx",[])
},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])
}typeof a!="string"&&(c=a,a=b),a=a||"fx";
var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;
while(g--){if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0)){h++,l.add(m)
}}m();
return d.promise()
}});
var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;
f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)
},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)
})
},prop:function(a,b){return f.access(this,a,b,!0,f.prop)
},removeProp:function(a){a=f.propFix[a]||a;
return this.each(function(){try{this[a]=b,delete this[a]
}catch(c){}})
},addClass:function(a){var b,c,d,e,g,h,i;
if(f.isFunction(a)){return this.each(function(b){f(this).addClass(a.call(this,b,this.className))
})
}if(a&&typeof a=="string"){b=a.split(p);
for(c=0,d=this.length;
c<d;
c++){e=this[c];
if(e.nodeType===1){if(!e.className&&b.length===1){e.className=a
}else{g=" "+e.className+" ";
for(h=0,i=b.length;
h<i;
h++){~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ")
}e.className=f.trim(g)
}}}}return this
},removeClass:function(a){var c,d,e,g,h,i,j;
if(f.isFunction(a)){return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))
})
}if(a&&typeof a=="string"||a===b){c=(a||"").split(p);
for(d=0,e=this.length;
d<e;
d++){g=this[d];
if(g.nodeType===1&&g.className){if(a){h=(" "+g.className+" ").replace(o," ");
for(i=0,j=c.length;
i<j;
i++){h=h.replace(" "+c[i]+" "," ")
}g.className=f.trim(h)
}else{g.className=""
}}}}return this
},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";
if(f.isFunction(a)){return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)
})
}return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);
while(e=j[g++]){i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)
}}else{if(c==="undefined"||c==="boolean"){this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""
}}})
},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;
for(;
c<d;
c++){if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1){return !0
}}return !1
},val:function(a){var c,d,e,g=this[0];
if(!!arguments.length){e=f.isFunction(a);
return this.each(function(d){var g=f(this),h;
if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""
})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];
if(!c||!("set" in c)||c.set(this,h,"value")===b){this.value=h
}}})
}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];
if(c&&"get" in c&&(d=c.get(g,"value"))!==b){return d
}d=g.value;
return typeof d=="string"?d.replace(q,""):d==null?"":d
}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;
return !b||b.specified?a.value:a.text
}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";
if(g<0){return null
}c=j?g:0,d=j?g+1:i.length;
for(;
c<d;
c++){e=i[c];
if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();
if(j){return b
}h.push(b)
}}if(j&&!h.length&&i.length){return f(i[g]).val()
}return h
},set:function(a,b){var c=f.makeArray(b);
f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0
}),c.length||(a.selectedIndex=-1);
return c
}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;
if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn){return f(a)[c](d)
}if(typeof a.getAttribute=="undefined"){return f.prop(a,c,d)
}i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));
if(d!==b){if(d===null){f.removeAttr(a,c);
return
}if(h&&"set" in h&&i&&(g=h.set(a,d,c))!==b){return g
}a.setAttribute(c,""+d);
return d
}if(h&&"get" in h&&i&&(g=h.get(a,c))!==null){return g
}g=a.getAttribute(c);
return g===null?b:g
}},removeAttr:function(a,b){var c,d,e,g,h=0;
if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;
for(;
h<g;
h++){e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))
}}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode){f.error("type property can't be changed")
}else{if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;
a.setAttribute("type",b),c&&(a.value=c);
return b
}}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button")){return w.get(a,b)
}return b in a?a.value:null
},set:function(a,b,c){if(w&&f.nodeName(a,"button")){return w.set(a,b,c)
}a.value=b
}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;
if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);
return d!==b?g&&"set" in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get" in g&&(e=g.get(a,c))!==null?e:a[c]
}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");
return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b
}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);
return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b
},set:function(a,b,c){var d;
b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));
return c
}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;
d=a.getAttributeNode(c);
return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b
},set:function(a,b,d){var e=a.getAttributeNode(d);
e||(e=c.createAttribute(d),a.setAttributeNode(e));
return e.nodeValue=b+""
}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");
return c
}}})
}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)
}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);
return d===null?b:d
}})
}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b
},set:function(a,b){return a.style.cssText=""+b
}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;
b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);
return null
}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value
}}
}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b)){return a.checked=f.inArray(f(a).val(),b)>=0
}}})
});
var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);
b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));
return b
},H=function(a,b){var c=a.attributes||{};
return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))
},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")
};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;
if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b
},i.elem=a),c=f.trim(I(c)).split(" ");
for(k=0;
k<c.length;
k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];
if(!r){r=j[m]=[],r.delegateCount=0;
if(!s.setup||s.setup.call(a,e,n,i)===!1){a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)
}}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0
}a=null
}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;
if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");
for(h=0;
h<b.length;
h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];
if(!j){for(j in o){f.event.remove(a,j+b[h],c,d,!0)
}continue
}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;
for(n=0;
n<r.length;
n++){s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s))
}r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])
}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))
}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;
if(E.test(h+f.event.triggered)){return
}h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());
if((!e||f.event.customEvent[h])&&!f.event.global[h]){return
}c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";
if(!e){j=f.cache;
for(l in j){j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0)
}return
}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};
if(p.trigger&&p.trigger.apply(e,d)===!1){return
}r=[[e,p.bindType||h]];
if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;
for(;
m;
m=m.parentNode){r.push([m,s]),n=m
}n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])
}for(l=0;
l<r.length&&!c.isPropagationStopped();
l++){m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault()
}c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));
return c.result
}},dispatch:function(c){c=f.event.fix(c||a.event);
var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;
g[0]=c,c.delegateTarget=this;
if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;
for(l=c.target;
l!=this;
l=l.parentNode||this){o={},q=[],m[0]=l;
for(j=0;
j<e;
j++){r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r)
}q.length&&i.push({elem:l,matches:q})
}}d.length>e&&i.push({elem:this,matches:d.slice(e)});
for(j=0;
j<i.length&&!c.isPropagationStopped();
j++){p=i[j],c.currentTarget=p.elem;
for(k=0;
k<p.matches.length&&!c.isImmediatePropagationStopped();
k++){r=p.matches[k];
if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace)){c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))
}}}return c.result
},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);
return a
}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;
a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);
return a
}},fix:function(a){if(a[f.expando]){return a
}var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;
a=f.Event(g);
for(d=i.length;
d;
){e=i[--d],a[e]=g[e]
}a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);
return h.filter?h.filter(a,g):a
},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)
},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)
}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});
d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()
}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)
}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)
},f.Event=function(a,b){if(!(this instanceof f.Event)){return new f.Event(a,b)
}a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0
},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;
var a=this.originalEvent;
!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)
},stopPropagation:function(){this.isPropagationStopped=K;
var a=this.originalEvent;
!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)
},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()
},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;
if(!d||d!==c&&!f.contains(c,d)){a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b
}return h
}}
}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form")){return !1
}f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;
d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)
}),d._submit_attached=!0)
})
},teardown:function(){if(f.nodeName(this,"form")){return !1
}f.event.remove(this,"._submit")
}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)
}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))
})
}return !1
}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;
z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)
}),b._change_attached=!0)
})
},handle:function(a){var b=a.target;
if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox"){return a.handleObj.handler.apply(this,arguments)
}},teardown:function(){f.event.remove(this,"._change");
return z.test(this.nodeName)
}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)
};
f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)
},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)
}}
}),f.fn.extend({on:function(a,c,d,e,g){var h,i;
if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);
for(i in a){this.on(i,c,d,a[i],g)
}return this
}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));
if(e===!1){e=J
}else{if(!e){return this
}}g===1&&(h=e,e=function(a){f().off(a);
return h.apply(this,arguments)
},e.guid=h.guid||(h.guid=f.guid++));
return this.each(function(){f.event.add(this,a,e,d,c)
})
},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)
},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;
f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);
return this
}if(typeof a=="object"){for(var g in a){this.off(g,c,a[g])
}return this
}if(c===!1||typeof c=="function"){d=c,c=b
}d===!1&&(d=J);
return this.each(function(){f.event.remove(this,a,d,c)
})
},bind:function(a,b,c){return this.on(a,null,b,c)
},unbind:function(a,b){return this.off(a,null,b)
},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);
return this
},die:function(a,b){f(this.context).off(a,this.selector||"**",b);
return this
},delegate:function(a,b,c,d){return this.on(b,a,c,d)
},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)
},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)
})
},triggerHandler:function(a,b){if(this[0]){return f.event.trigger(a,b,this[0],!0)
}},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;
f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();
return b[e].apply(this,arguments)||!1
};
e.guid=c;
while(d<b.length){b[d++].guid=c
}return this.click(e)
},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)
}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);
return arguments.length>0?this.on(b,null,a,c):this.trigger(b)
},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)
}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;
h<i;
h++){var j=e[h];
if(j){var k=!1;
j=j[a];
while(j){if(j[d]===c){k=e[j.sizset];
break
}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);
if(typeof b!="string"){if(j===b){k=!0;
break
}}else{if(m.filter(b,[j]).length>0){k=j;
break
}}}j=j[a]
}e[h]=k
}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;
h<i;
h++){var j=e[h];
if(j){var k=!1;
j=j[a];
while(j){if(j[d]===c){k=e[j.sizset];
break
}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);
if(j.nodeName.toLowerCase()===b){k=j;
break
}j=j[a]
}e[h]=k
}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;
[0,0].sort(function(){i=!1;
return 0
});
var m=function(b,d,e,f){e=e||[],d=d||c;
var h=d;
if(d.nodeType!==1&&d.nodeType!==9){return[]
}if(!b||typeof b!="string"){return e
}var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;
do{a.exec(""),i=a.exec(x);
if(i){x=i[3],w.push(i[1]);
if(i[2]){l=i[3];
break
}}}while(i);
if(w.length>1&&p.exec(b)){if(w.length===2&&o.relative[w[0]]){j=y(w[0]+w[1],d,f)
}else{j=o.relative[w[0]]?[d]:m(w.shift(),d);
while(w.length){b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)
}}}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);
if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;
while(w.length){q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)
}}else{k=w=[]
}}k||(k=j),k||m.error(q||b);
if(g.call(k)==="[object Array]"){if(!u){e.push.apply(e,k)
}else{if(d&&d.nodeType===1){for(t=0;
k[t]!=null;
t++){k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t])
}}else{for(t=0;
k[t]!=null;
t++){k[t]&&k[t].nodeType===1&&e.push(j[t])
}}}}else{s(k,e)
}l&&(m(l,h,e,f),m.uniqueSort(e));
return e
};
m.uniqueSort=function(a){if(u){h=i,a.sort(u);
if(h){for(var b=1;
b<a.length;
b++){a[b]===a[b-1]&&a.splice(b--,1)
}}}return a
},m.matches=function(a,b){return m(a,null,null,b)
},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0
},m.find=function(a,b,c){var d,e,f,g,h,i;
if(!a){return[]
}for(e=0,f=o.order.length;
e<f;
e++){h=o.order[e];
if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);
if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);
if(d!=null){a=a.replace(o.match[h],"");
break
}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);
return{set:d,expr:a}
},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);
while(a&&c.length){for(h in o.filter){if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);
if(l.substr(l.length-1)==="\\"){continue
}s===r&&(r=[]);
if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);
if(!f){g=i=!0
}else{if(f===!0){continue
}}}if(f){for(n=0;
(j=s[n])!=null;
n++){j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0))
}}if(i!==b){d||(s=r),a=a.replace(o.match[h],"");
if(!g){return[]
}break
}}}if(a===q){if(g==null){m.error(a)
}else{break
}}q=a
}return s
},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)
};
var n=m.getText=function(a){var b,c,d=a.nodeType,e="";
if(d){if(d===1||d===9){if(typeof a.textContent=="string"){return a.textContent
}if(typeof a.innerText=="string"){return a.innerText.replace(k,"")
}for(a=a.firstChild;
a;
a=a.nextSibling){e+=n(a)
}}else{if(d===3||d===4){return a.nodeValue
}}}else{for(b=0;
c=a[b];
b++){c.nodeType!==8&&(e+=n(c))
}}return e
},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")
},type:function(a){return a.getAttribute("type")
}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;
d&&(b=b.toLowerCase());
for(var f=0,g=a.length,h;
f<g;
f++){if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1){}a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b
}}e&&m.filter(b,a,!0)
},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;
if(d&&!l.test(b)){b=b.toLowerCase();
for(;
e<f;
e++){c=a[e];
if(c){var g=c.parentNode;
a[e]=g.nodeName.toLowerCase()===b?g:!1
}}}else{for(;
e<f;
e++){c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b)
}d&&m.filter(b,a,!0)
}},"":function(a,b,c){var d,f=e++,g=x;
typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)
},"~":function(a,b,c){var d,f=e++,g=x;
typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)
}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);
return d&&d.parentNode?[d]:[]
}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);
for(var e=0,f=d.length;
e<f;
e++){d[e].getAttribute("name")===a[1]&&c.push(d[e])
}return c.length===0?null:c
}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined"){return b.getElementsByTagName(a[1])
}}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";
if(f){return a
}for(var g=0,h;
(h=b[g])!=null;
g++){h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1))
}return !1
},ID:function(a){return a[1].replace(j,"")
},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()
},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");
var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);
a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0
}else{a[2]&&m.error(a[0])
}a[0]=e++;
return a
},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");
!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");
return a
},PSEUDO:function(b,c,d,e,f){if(b[1]==="not"){if((a.exec(b[3])||"").length>1||/^\w/.test(b[3])){b[3]=m(b[3],null,null,c)
}else{var g=m.filter(b[3],c,d,!0^f);
d||e.push.apply(e,g);
return !1
}}else{if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0])){return !0
}}return b
},POS:function(a){a.unshift(!0);
return a
}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"
},disabled:function(a){return a.disabled===!0
},checked:function(a){return a.checked===!0
},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;
return a.selected===!0
},parent:function(a){return !!a.firstChild
},empty:function(a){return !a.firstChild
},has:function(a,b,c){return !!m(c[3],a).length
},header:function(a){return/h\d/i.test(a.nodeName)
},text:function(a){var b=a.getAttribute("type"),c=a.type;
return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)
},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type
},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type
},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type
},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type
},submit:function(a){var b=a.nodeName.toLowerCase();
return(b==="input"||b==="button")&&"submit"===a.type
},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type
},reset:function(a){var b=a.nodeName.toLowerCase();
return(b==="input"||b==="button")&&"reset"===a.type
},button:function(a){var b=a.nodeName.toLowerCase();
return b==="input"&&"button"===a.type||b==="button"
},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)
},focus:function(a){return a===a.ownerDocument.activeElement
}},setFilters:{first:function(a,b){return b===0
},last:function(a,b,c,d){return b===d.length-1
},even:function(a,b){return b%2===0
},odd:function(a,b){return b%2===1
},lt:function(a,b,c){return b<c[3]-0
},gt:function(a,b,c){return b>c[3]-0
},nth:function(a,b,c){return c[3]-0===b
},eq:function(a,b,c){return c[3]-0===b
}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];
if(f){return f(a,c,b,d)
}if(e==="contains"){return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0
}if(e==="not"){var g=b[3];
for(var h=0,i=g.length;
h<i;
h++){if(g[h]===a){return !1
}}return !0
}m.error(e)
},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;
switch(k){case"only":case"first":while(l=l.previousSibling){if(l.nodeType===1){return !1
}}if(k==="first"){return !0
}l=a;
case"last":while(l=l.nextSibling){if(l.nodeType===1){return !1
}}return !0;
case"nth":c=b[2],e=b[3];
if(c===1&&e===0){return !0
}f=b[0],g=a.parentNode;
if(g&&(g[d]!==f||!a.nodeIndex)){i=0;
for(l=g.firstChild;
l;
l=l.nextSibling){l.nodeType===1&&(l.nodeIndex=++i)
}g[d]=f
}j=a.nodeIndex-e;
return c===0?j===0:j%c===0&&j/c>=0
}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b
},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b
},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1
},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];
return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1
},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];
if(f){return f(a,c,b,d)
}}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)
};
for(var r in o.match){o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q))
}var s=function(a,b){a=Array.prototype.slice.call(a,0);
if(b){b.push.apply(b,a);
return b
}return a
};
try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType
}catch(t){s=function(a,b){var c=0,d=b||[];
if(g.call(a)==="[object Array]"){Array.prototype.push.apply(d,a)
}else{if(typeof a.length=="number"){for(var e=a.length;
c<e;
c++){d.push(a[c])
}}else{for(;
a[c];
c++){d.push(a[c])
}}}return d
}
}var u,v;
c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;
return 0
}if(!a.compareDocumentPosition||!b.compareDocumentPosition){return a.compareDocumentPosition?-1:1
}return a.compareDocumentPosition(b)&4?-1:1
}:(u=function(a,b){if(a===b){h=!0;
return 0
}if(a.sourceIndex&&b.sourceIndex){return a.sourceIndex-b.sourceIndex
}var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;
if(g===i){return v(a,b)
}if(!g){return -1
}if(!i){return 1
}while(j){e.unshift(j),j=j.parentNode
}j=i;
while(j){f.unshift(j),j=j.parentNode
}c=e.length,d=f.length;
for(var k=0;
k<c&&k<d;
k++){if(e[k]!==f[k]){return v(e[k],f[k])
}}return k===c?v(a,f[k],-1):v(e[k],b,1)
},v=function(a,b,c){if(a===b){return c
}var d=a.nextSibling;
while(d){if(d===b){return -1
}d=d.nextSibling
}return 1
}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;
a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);
return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]
}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");
return a.nodeType===1&&c&&c.nodeValue===b
}),e.removeChild(a),e=a=null
}(),function(){var a=c.createElement("div");
a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);
if(a[1]==="*"){var d=[];
for(var e=0;
c[e];
e++){c[e].nodeType===1&&d.push(c[e])
}c=d
}return c
}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)
}),a=null
}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";
b.innerHTML="<p class='TEST'></p>";
if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;
if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);
if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1]){return s(e.getElementsByTagName(b),f)
}if(h[2]&&o.find.CLASS&&e.getElementsByClassName){return s(e.getElementsByClassName(h[2]),f)
}}if(e.nodeType===9){if(b==="body"&&e.body){return s([e.body],f)
}if(h&&h[3]){var i=e.getElementById(h[3]);
if(!i||!i.parentNode){return s([],f)
}if(i.id===h[3]){return s([i],f)
}}try{return s(e.querySelectorAll(b),f)
}catch(j){}}else{if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);
l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);
try{if(!q||p){return s(e.querySelectorAll("[id='"+n+"'] "+b),f)
}}catch(r){}finally{l||k.removeAttribute("id")
}}}}return a(b,e,f,g)
};
for(var e in a){m[e]=a[e]
}b=null
}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;
if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;
try{b.call(c.documentElement,"[test!='']:sizzle")
}catch(f){e=!0
}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");
if(!m.isXML(a)){try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);
if(f||!d||a.document&&a.document.nodeType!==11){return f
}}}catch(g){}}return m(c,null,null,[a]).length>0
}
}}(),function(){var a=c.createElement("div");
a.innerHTML="<div class='test e'></div><div class='test'></div>";
if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";
if(a.getElementsByClassName("e").length===1){return
}o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c){return b.getElementsByClassName(a[1])
}},a=null
}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)
}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return !!(a.compareDocumentPosition(b)&16)
}:m.contains=function(){return !1
},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;
return b?b.nodeName!=="HTML":!1
};
var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;
while(d=o.match.PSEUDO.exec(a)){f+=d[0],a=a.replace(o.match.PSEUDO,"")
}a=o.relative[a]?a+"*":a;
for(var h=0,i=g.length;
h<i;
h++){m(a,g[h],e,c)
}return m.filter(f,e)
};
m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains
}();
var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};
f.fn.extend({find:function(a){var b=this,c,d;
if(typeof a!="string"){return f(a).filter(function(){for(c=0,d=b.length;
c<d;
c++){if(f.contains(b[c],this)){return !0
}}})
}var e=this.pushStack("","find",a),g,h,i;
for(c=0,d=this.length;
c<d;
c++){g=e.length,f.find(a,this[c],e);
if(c>0){for(h=g;
h<e.length;
h++){for(i=0;
i<g;
i++){if(e[i]===e[h]){e.splice(h--,1);
break
}}}}}return e
},has:function(a){var b=f(a);
return this.filter(function(){for(var a=0,c=b.length;
a<c;
a++){if(f.contains(this,b[a])){return !0
}}})
},not:function(a){return this.pushStack(T(this,a,!1),"not",a)
},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)
},is:function(a){return !!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)
},closest:function(a,b){var c=[],d,e,g=this[0];
if(f.isArray(a)){var h=1;
while(g&&g.ownerDocument&&g!==b){for(d=0;
d<a.length;
d++){f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h})
}g=g.parentNode,h++
}return c
}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;
for(d=0,e=this.length;
d<e;
d++){g=this[d];
while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);
break
}g=g.parentNode;
if(!g||!g.ownerDocument||g===b||g.nodeType===11){break
}}}c=c.length>1?f.unique(c):c;
return this.pushStack(c,"closest",a)
},index:function(a){if(!a){return this[0]&&this[0].parentNode?this.prevAll().length:-1
}if(typeof a=="string"){return f.inArray(this[0],f(a))
}return f.inArray(a.jquery?a[0]:a,this)
},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);
return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))
},andSelf:function(){return this.add(this.prevObject)
}}),f.each({parent:function(a){var b=a.parentNode;
return b&&b.nodeType!==11?b:null
},parents:function(a){return f.dir(a,"parentNode")
},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)
},next:function(a){return f.nth(a,2,"nextSibling")
},prev:function(a){return f.nth(a,2,"previousSibling")
},nextAll:function(a){return f.dir(a,"nextSibling")
},prevAll:function(a){return f.dir(a,"previousSibling")
},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)
},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)
},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)
},children:function(a){return f.sibling(a.firstChild)
},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)
}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);
L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());
return this.pushStack(e,a,P.call(arguments).join(","))
}
}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");
return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)
},dir:function(a,c,d){var e=[],g=a[c];
while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d))){g.nodeType===1&&e.push(g),g=g[c]
}return e
},nth:function(a,b,c,d){b=b||1;
var e=0;
for(;
a;
a=a[c]){if(a.nodeType===1&&++e===b){break
}}return a
},sibling:function(a,b){var c=[];
for(;
a;
a=a.nextSibling){a.nodeType===1&&a!==b&&c.push(a)
}return c
}});
var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);
bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a)){return this.each(function(b){var c=f(this);
c.text(a.call(this,b,c.text()))
})
}if(typeof a!="object"&&a!==b){return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a))
}return f.text(this)
},wrapAll:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapAll(a.call(this,b))
})
}if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);
this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;
while(a.firstChild&&a.firstChild.nodeType===1){a=a.firstChild
}return a
}).append(this)
}return this
},wrapInner:function(a){if(f.isFunction(a)){return this.each(function(b){f(this).wrapInner(a.call(this,b))
})
}return this.each(function(){var b=f(this),c=b.contents();
c.length?c.wrapAll(a):b.append(a)
})
},wrap:function(a){var b=f.isFunction(a);
return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)
})
},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)
}).end()
},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)
})
},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)
})
},before:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)
})
}if(arguments.length){var a=f.clean(arguments);
a.push.apply(a,this.toArray());
return this.pushStack(a,"before",arguments)
}},after:function(){if(this[0]&&this[0].parentNode){return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)
})
}if(arguments.length){var a=this.pushStack(this,"after",arguments);
a.push.apply(a,f.clean(arguments));
return a
}},remove:function(a,b){for(var c=0,d;
(d=this[c])!=null;
c++){if(!a||f.filter(a,[d]).length){!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d)
}}return this
},empty:function(){for(var a=0,b;
(b=this[a])!=null;
a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));
while(b.firstChild){b.removeChild(b.firstChild)
}}return this
},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;
return this.map(function(){return f.clone(this,a,b)
})
},html:function(a){if(a===b){return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null
}if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");
try{for(var c=0,d=this.length;
c<d;
c++){this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)
}}catch(e){this.empty().append(a)
}}else{f.isFunction(a)?this.each(function(b){var c=f(this);
c.html(a.call(this,b,c.html()))
}):this.empty().append(a)
}return this
},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a)){return this.each(function(b){var c=f(this),d=c.html();
c.replaceWith(a.call(this,b,d))
})
}typeof a!="string"&&(a=f(a).detach());
return this.each(function(){var b=this.nextSibling,c=this.parentNode;
f(this).remove(),b?f(b).before(a):f(c).append(a)
})
}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this
},detach:function(a){return this.remove(a,!0)
},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];
if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j)){return this.each(function(){f(this).domManip(a,c,d,!0)
})
}if(f.isFunction(j)){return this.each(function(e){var g=f(this);
a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)
})
}if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;
if(g){c=c&&f.nodeName(g,"tr");
for(var l=0,m=this.length,n=m-1;
l<m;
l++){d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)
}}k.length&&f.each(k,bp)
}return this
}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];
b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);
return{fragment:e,cacheable:g}
},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;
if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);
return this
}for(var h=0,i=e.length;
h<i;
h++){var j=(h>0?this.clone(!0):this).get();
f(e[h])[b](j),d=d.concat(j)
}return this.pushStack(d,a,e.selector)
}
}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);
if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);
for(g=0;
d[g];
++g){e[g]&&bk(d[g],e[g])
}}if(b){bj(a,h);
if(c){d=bl(a),e=bl(h);
for(g=0;
d[g];
++g){bj(d[g],e[g])
}}}d=e=null;
return h
},clean:function(a,b,d,e){var g;
b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);
var h=[],i;
for(var j=0,k;
(k=a[j])!=null;
j++){typeof k=="number"&&(k+="");
if(!k){continue
}if(typeof k=="string"){if(!_.test(k)){k=b.createTextNode(k)
}else{k=k.replace(Y,"<$1></$2>");
var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");
b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];
while(n--){o=o.lastChild
}if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];
for(i=q.length-1;
i>=0;
--i){f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])
}}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes
}}var r;
if(!f.support.appendChecked){if(k[0]&&typeof(r=k.length)=="number"){for(i=0;
i<r;
i++){bn(k[i])
}}else{bn(k)
}}k.nodeType?h.push(k):h=f.merge(h,k)
}if(d){g=function(a){return !a.type||be.test(a.type)
};
for(j=0;
h[j];
j++){if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript")){e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j])
}else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);
h.splice.apply(h,[j+1,0].concat(s))
}d.appendChild(h[j])
}}}return h
},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;
for(var h=0,i;
(i=a[h])!=null;
h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()]){continue
}c=i[f.expando];
if(c){b=d[c];
if(b&&b.events){for(var j in b.events){e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle)
}b.handle&&(b.handle.elem=null)
}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]
}}}});
var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;
f.fn.css=function(a,c){if(arguments.length===2&&c===b){return this
}return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)
})
},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");
return c===""?"1":c
}return a.style.opacity
}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];
c=f.cssProps[i]||i;
if(d===b){if(k&&"get" in k&&(g=k.get(a,!1,e))!==b){return g
}return j[c]
}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");
if(d==null||h==="number"&&isNaN(d)){return
}h==="number"&&!f.cssNumber[i]&&(d+="px");
if(!k||!("set" in k)||(d=k.set(a,d))!==b){try{j[c]=d
}catch(l){}}}},css:function(a,c,d){var e,g;
c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");
if(g&&"get" in g&&(e=g.get(a,!0,d))!==b){return e
}if(bz){return bz(a,c)
}},swap:function(a,b,c){var d={};
for(var e in b){d[e]=a.style[e],a.style[e]=b[e]
}c.call(a);
for(e in b){a.style[e]=d[e]
}}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;
if(c){if(a.offsetWidth!==0){return bC(a,b,d)
}f.swap(a,bw,function(){e=bC(a,b,d)
});
return e
}},set:function(a,b){if(!bt.test(b)){return b
}b=parseFloat(b);
if(b>=0){return b+"px"
}}}
}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""
},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";
c.zoom=1;
if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");
if(d&&!d.filter){return
}}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e
}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;
f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight
});
return c
}})
}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;
b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));
return c
}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;
f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));
return f===""?"auto":f
}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;
return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"
},f.expr.filters.visible=function(a){return !f.expr.filters.hidden(a)
});
var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];
try{bV=e.href
}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href
}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS){return bS.apply(this,arguments)
}if(!this.length){return this
}var e=a.indexOf(" ");
if(e>=0){var g=a.slice(e,a.length);
a=a.slice(0,e)
}var h="GET";
c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));
var i=this;
f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a
}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])
}});
return this
},serialize:function(){return f.param(this.serializeArray())
},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this
}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))
}).map(function(a,b){var c=f(this).val();
return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}
}):{name:b.name,value:c.replace(bF,"\r\n")}
}).get()
}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)
}
}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);
return f.ajax({type:c,url:a,data:d,success:e,dataType:g})
}
}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")
},getJSON:function(a,b,c){return f.get(a,b,c,"json")
},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);
return a
},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;
var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;
if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified")){f.lastModified[k]=y
}if(z=v.getResponseHeader("Etag")){f.etag[k]=z
}}if(a===304){w="notmodified",o=!0
}else{try{r=cc(d,x),w="success",o=!0
}catch(A){w="parsererror",u=A
}}}else{u=w;
if(!w||a){w="error",a<0&&(a=0)
}}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))
}}typeof a=="object"&&(c=a,a=b),c=c||{};
var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();
a=m[c]=m[c]||a,l[a]=b
}return this
},getAllResponseHeaders:function(){return s===2?n:null
},getResponseHeader:function(a){var c;
if(s===2){if(!o){o={};
while(c=bH.exec(n)){o[c[1].toLowerCase()]=c[2]
}}c=o[a.toLowerCase()]
}return c===b?null:c
},overrideMimeType:function(a){s||(d.mimeType=a);
return this
},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);
return this
}};
h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;
if(s<2){for(b in a){j[b]=[j[b],a[b]]
}}else{b=a[v.status],v.then(b,b)
}}return this
},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);
if(s===2){return !1
}t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");
if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;
if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);
d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")
}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);
for(u in d.headers){v.setRequestHeader(u,d.headers[u])
}if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();
return !1
}for(u in {success:1,error:1,complete:1}){v[u](d[u])
}p=b$(bU,d,c,v);
if(!p){w(-1,"No Transport")
}else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")
},d.timeout));
try{s=1,p.send(l,w)
}catch(z){if(s<2){w(-1,z)
}else{throw z
}}}return v
},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)
};
c===b&&(c=f.ajaxSettings.traditional);
if(f.isArray(a)||a.jquery&&!f.isPlainObject(a)){f.each(a,function(){e(this.name,this.value)
})
}else{for(var g in a){ca(g,a[g],c,e)
}}return d.join("&").replace(bD,"+")
}}),f.extend({active:0,lastModified:{},etag:{}});
var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;
f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++
}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";
if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";
b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]
},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])
}),b.converters["script json"]=function(){g||f.error(h+" was not called");
return g[0]
},b.dataTypes[0]="json";
return"script"
}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);
return a
}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)
}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;
return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState)){d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")
}},e.insertBefore(d,e.firstChild)
},abort:function(){d&&d.onload(0,1)
}}
}});
var cf=a.ActiveXObject?function(){for(var a in ch){ch[a](0,1)
}}:!1,cg=0,ch;
f.ajaxSettings.xhr=a.ActiveXObject?function(){return !this.isLocal&&ci()||cj()
}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials" in a})
}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;
return{send:function(e,g){var h=c.xhr(),i,j;
c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);
if(c.xhrFields){for(j in c.xhrFields){h[j]=c.xhrFields[j]
}}c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");
try{for(j in e){h.setRequestHeader(j,e[j])
}}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;
try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);
if(e){h.readyState!==4&&h.abort()
}else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;
try{k=h.statusText
}catch(o){k=""
}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)
}}}catch(p){e||g(-1,p)
}m&&g(j,k,m,l)
},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)
},abort:function(){d&&d(0,1)
}}
}});
var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;
f.fn.extend({show:function(a,b,c){var d,e;
if(a||a===0){return this.animate(cu("show",3),a,b,c)
}for(var g=0,h=this.length;
g<h;
g++){d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)))
}for(g=0;
g<h;
g++){d=this[g];
if(d.style){e=d.style.display;
if(e===""||e==="none"){d.style.display=f._data(d,"olddisplay")||""
}}}return this
},hide:function(a,b,c){if(a||a===0){return this.animate(cu("hide",3),a,b,c)
}var d,e,g=0,h=this.length;
for(;
g<h;
g++){d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e))
}for(g=0;
g<h;
g++){this[g].style&&(this[g].style.display="none")
}return this
},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";
f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");
f(this)[b?"show":"hide"]()
}):this.animate(cu("toggle",3),a,b,c);
return this
},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)
},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);
var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;
b.animatedProperties={};
for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";
if(h==="hide"&&d||h==="show"&&!d){return b.complete.call(this)
}c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))
}b.overflow!=null&&(this.style.overflow="hidden");
for(i in a){j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""))
}return !0
}var e=f.speed(b,c,d);
if(f.isEmptyObject(a)){return this.each(e.complete,[!1])
}a=f.extend({},a);
return e.queue===!1?this.each(g):this.queue(e.queue,g)
},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);
return this.each(function(){function h(a,b,c){var e=b[c];
f.removeData(a,c,!0),e.stop(d)
}var b,c=!1,e=f.timers,g=f._data(this);
d||f._unmark(!0,this);
if(a==null){for(b in g){g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b)
}}else{g[b=a+".run"]&&g[b].stop&&h(this,g,b)
}for(b=e.length;
b--;
){e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1))
}(!d||!c)&&f.dequeue(this,a)
})
}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)
}
}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};
d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;
if(d.queue==null||d.queue===!0){d.queue="fx"
}d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)
};
return d
},easing:{linear:function(a,b,c,d){return c+d*a
},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+0.5)*d+c
}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}
}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)
},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]
}var a,b=f.css(this.elem,this.prop);
return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a
},custom:function(a,c,d){function h(a){return e.step(a)
}var e=this,g=f.fx;
this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)
},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))
},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);
this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()
},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)
},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;
if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;
for(b in i.animatedProperties){i.animatedProperties[b]!==!0&&(g=!1)
}if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]
}),i.hide&&f(h).hide();
if(i.hide||i.show){for(b in i.animatedProperties){f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0)
}}d=i.complete,d&&(i.complete=!1,d.call(h))
}return !1
}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();
return !0
}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;
for(;
c<b.length;
c++){a=b[c],!a()&&b[c]===a&&b.splice(c--,1)
}b.length||f.fx.stop()
},interval:13,stop:function(){clearInterval(cp),cp=null
},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)
},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now
}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)
}
}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem
}).length
});
var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;
"getBoundingClientRect" in c.documentElement?f.fn.offset=function(a){var b=this[0],c;
if(a){return this.each(function(b){f.offset.setOffset(this,a,b)
})
}if(!b||!b.ownerDocument){return null
}if(b===b.ownerDocument.body){return f.offset.bodyOffset(b)
}try{c=b.getBoundingClientRect()
}catch(d){}var e=b.ownerDocument,g=e.documentElement;
if(!c||!f.contains(g,b)){return c?{top:c.top,left:c.left}:{top:0,left:0}
}var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;
return{top:n,left:o}
}:f.fn.offset=function(a){var b=this[0];
if(a){return this.each(function(b){f.offset.setOffset(this,a,b)
})
}if(!b||!b.ownerDocument){return null
}if(b===b.ownerDocument.body){return f.offset.bodyOffset(b)
}var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;
while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed"){break
}c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c
}if(k.position==="relative"||k.position==="static"){l+=i.offsetTop,m+=i.offsetLeft
}f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));
return{top:l,left:m}
},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;
f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);
return{top:b,left:c}
},setOffset:function(a,b,c){var d=f.css(a,"position");
d==="static"&&(a.style.position="relative");
var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;
j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using" in b?b.using.call(a,k):e.css(k)
}},f.fn.extend({position:function(){if(!this[0]){return null
}var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();
c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;
return{top:c.top-d.top,left:c.left-d.left}
},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;
while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static"){a=a.offsetParent
}return a
})
}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;
f.fn[d]=function(c){var e,g;
if(c===b){e=this[0];
if(!e){return null
}g=cy(e);
return g?"pageXOffset" in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]
}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c
})
}
}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();
f.fn["inner"+c]=function(){var a=this[0];
return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null
},f.fn["outer"+c]=function(a){var b=this[0];
return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null
},f.fn[d]=function(a){var e=this[0];
if(!e){return a==null?null:this
}if(f.isFunction(a)){return this.each(function(b){var c=f(this);
c[d](a.call(this,b,c[d]()))
})
}if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;
return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g
}if(e.nodeType===9){return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c])
}if(a===b){var i=f.css(e,d),j=parseFloat(i);
return f.isNumeric(j)?j:i
}return this.css(d,typeof a=="string"?a:a+"px")
}
}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f
})
})(window);
if(glMatrix.setMatrixArrayType(Array),vec3.fromXYZ=function(b){var a=new Array(3);
return a[0]=b.x,a[1]=b.y,a[2]=b.z,a
},vec3.toXYZ=function(a){return{x:a[0],y:a[1],z:a[2]}
},vec4.fromXYZ=function(c,b){var a=new Array(4);
return a[0]=c.x,a[1]=c.y,a[2]=c.z,a[3]=b,a
},mat4.fromYPR=function(k,q,h){var b=new Array(16),d=Math.sin(h),p=Math.cos(h),f=Math.sin(q),u=Math.cos(q),g=Math.sin(k),m=Math.cos(k);
return b[0]=m*p,b[4]=-(m*d),b[8]=g,b[1]=f*g*p+u*d,b[5]=u*p-f*g*d,b[9]=-(f*m),b[2]=f*d-u*g*p,b[6]=f*p+u*g*d,b[10]=u*m,b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,b
},quat.fromYPR=function(p,A,k){var b=0.5*k,d=Math.sin(b),w=Math.cos(b),f=0.5*A,B=Math.sin(f),g=Math.cos(f),q=0.5*p,m=Math.sin(q),z=Math.cos(q),y=new Array(4);
return y[0]=z*B*w+m*g*d,y[1]=m*g*w-z*B*d,y[2]=z*g*d-m*B*w,y[3]=z*g*w+m*B*d,y
},"undefined"==typeof Phoria||!Phoria){var Phoria={};
Phoria.RADIANS=Math.PI/180,Phoria.TWOPI=2*Math.PI,Phoria.ONEOPI=1/Math.PI,Phoria.PIO2=Math.PI/2,Phoria.PIO4=Math.PI/4,Phoria.EPSILON=0.000001
}!function(){Phoria.Util={},Phoria.Util.extend=function(d,b,a){var c,f=function(){};
if(f.prototype=b.prototype,d.prototype=new f,d.prototype.constructor=d,d.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b),a){for(c in a){a.hasOwnProperty(c)&&(d.prototype[c]=a[c])
}}},Phoria.Util.augment=function(c,b){for(var a in b.prototype){"undefined"==typeof c.prototype[a]&&(c.prototype[a]=b.prototype[a])
}},Phoria.Util.merge=function(d,b){var a=Array.isArray(b),c=a&&[]||{};
return a?(d=d||[],c=c.concat(d),b.forEach(function(g,f){"object"==typeof g?c[f]=Phoria.Util.merge(d[f],g):c[f]=g
})):(d&&"object"==typeof d&&Object.keys(d).forEach(function(f){c[f]=d[f]
}),Object.keys(b).forEach(function(f){"object"==typeof b[f]&&b[f]&&d&&d[f]?c[f]=Phoria.Util.merge(d[f],b[f]):c[f]=b[f]
})),c
},Phoria.Util.combine=function(c,b){var a=Array.isArray(b)&&Array.isArray(c);
a?(c.length<b.length&&(c.length=b.length),b.forEach(function(f,d){"object"==typeof f?(c[d]=c[d]||{},Phoria.Util.combine(c[d],f)):c[d]=f
})):Object.keys(b).forEach(function(d){"object"==typeof b[d]&&b[d]?(c[d]=c[d]||(Array.isArray(b[d])?[]:{}),Phoria.Util.combine(c[d],b[d])):c[d]=b[d]
})
},Phoria.Util.clone=function(d){var b=null,a={};
for(var c in d){b=d[c],Array.isArray(b)?a[c]=[].concat(b):a[c]=b
}return a
},Phoria.Util.isIdentity=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]
},Phoria.Util.calcNormalVector=function(g,d,c,f,h,b){var k=vec4.fromValues(d*b-c*h,-(b*g-f*c),g*h-d*f,0);
return vec3.normalize(k,k)
},Phoria.Util.thetaTo=function(b,a){return Math.acos(vec3.dot(b,a)/(Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])*Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])))
},Phoria.Util.averagePolyVertex=function(g,d){for(var c=0,f=0,h=0,b=0;
c<g.length;
c++){f+=d[g[c]][0],h+=d[g[c]][1],b+=d[g[c]][2]
}return vec3.fromValues(f/g.length,h/g.length,b/g.length)
},Phoria.Util.averageObjectZ=function(c){for(var b=0,a=0;
a<c.length;
a++){b+=c[a][3]
}return b/c.length
},Phoria.Util.populateBuffer=function(d,b){for(var a=new Array(d),c=0;
d>c;
c++){a[c]=b(c)
}return a
},Phoria.Util.sortPolygons=function(d,b){for(var a,c=0;
c<d.length;
c++){a=d[c].vertices,d[c]._avz=d[c].zindex||0.25*(b[a[0]][2]+b[a[1]][2]+b[a[2]][2]+b[a[3]][2])
}d.sort(function(g,f){return g._avz<f._avz?-1:1
})
},Phoria.Util.sortEdges=function(c,b){for(var a=0;
a<c.length;
a++){c[a]._avz=0.5*(b[c[a].a][2]+b[c[a].b][2])
}c.sort(function(f,d){return f._avz<d._avz?-1:1
})
},Phoria.Util.sortPoints=function(d,b){var a=function c(m,r,k,f){if(f>k){var q=k+f>>1,g=r[q][2],u=k,h=r[q];
r[q]=r[f],r[f]=h,h=m[q],m[q]=m[f],m[f]=h;
for(var p=k;
f>p;
p++){r[p][2]>g&&(h=m[p],m[p]=m[u],m[u]=h,h=r[p],r[p]=r[u],r[u]=h,u++)
}h=m[u],m[u]=m[f],m[f]=h,h=r[u],r[u]=r[f],r[f]=h,c(m,r,k,u-1),c(m,r,u+1,f)
}};
a(b,d,0,d.length-1)
},Phoria.Util.generateTesselatedPlane=function(L,z,H,B,D,O){for(var E,A=[],G=[],N=[],I=B/z,w=D/L,q=0,M=!0,k=!1,K=!1,F=0,C=D/2;
L>=F;
F++){if(E=-B/2,K=!1,!k){for(var J=0;
z>=J;
J++){if(!K){if(M&&E>0?(M=!1,O&&O>C&&(k=!0)):!M&&0>E&&(M=!0,O&&O>C&&(k=!0)),A.push({x:E,y:0,z:C}),0!==J&&G.push({a:q,b:q-1}),0!==F&&G.push({a:q,b:q-z-1}),0!==F&&0!==J){var b={vertices:[q-z-1,q,q-1,q-z-2]};
N.push(b)
}E+=I,q++
}}C-=w
}}return{points:A,edges:G,polygons:N}
},Phoria.Util.generatePlane=function(z,G,p,b,g,D,k){var H=[],m=[],B=[],q=[],F=$.extend({x:0,y:0,z:0},g);
k=k||{};
for(var E=G;
E>=0;
E--){for(var A=[],C=0;
z>=C;
C++){if(2==D){var w={x:C*p+F.x,z:b*E+F.z,y:+F.y}
}else{if(1==D){var w={x:F.x,z:C*p+F.z,y:b*E+F.y}
}else{var w={x:C*p+F.x,y:b*E+F.y,z:+F.z}
}}m.push(w),A.push(m.length-1)
}H.push(A)
}for(var E=G;
E>=0;
E--){if(H[E-1]){for(var C=0;
z>=C;
C++){H[E][C+1]?(B.push({a:H[E][C],b:H[E][C+1]}),B.push({a:H[E][C],b:H[E-1][C]}),q.push({vertices:[H[E][C],H[E][C+1],H[E-1][C+1],H[E-1][C]],reversed:k.reversed||!1})):B.push({a:H[E][C],b:H[E-1][C]})
}}else{for(var C=0;
z>=C;
C++){H[E][C+1]&&B.push({a:H[E][C],b:H[E][C+1]})
}}}return{points:m,edges:B,polygons:q}
},Phoria.Util.generateUnitCube=function(b){var a=b||1;
return{points:[{x:-1*a,y:1*a,z:-1*a},{x:1*a,y:1*a,z:-1*a},{x:1*a,y:-1*a,z:-1*a},{x:-1*a,y:-1*a,z:-1*a},{x:-1*a,y:1*a,z:1*a},{x:1*a,y:1*a,z:1*a},{x:1*a,y:-1*a,z:1*a},{x:-1*a,y:-1*a,z:1*a}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:4,b:5},{a:5,b:6},{a:6,b:7},{a:7,b:4},{a:0,b:4},{a:1,b:5},{a:2,b:6},{a:3,b:7}],polygons:[{vertices:[0,1,2,3]},{vertices:[1,5,6,2]},{vertices:[5,4,7,6]},{vertices:[4,0,3,7]},{vertices:[4,5,1,0]},{vertices:[3,2,6,7]}]}
},Phoria.Util.generatePyramid=function(b){var a=b||1;
return{points:[{x:-1*a,y:0,z:-1*a},{x:-1*a,y:0,z:1*a},{x:1*a,y:0,z:1*a},{x:1*a,y:0*a,z:-1*a},{x:0,y:1.5*a,z:0}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:0,b:4},{a:1,b:4},{a:2,b:4},{a:3,b:4}],polygons:[{vertices:[0,1,4]},{vertices:[1,2,4]},{vertices:[2,3,4]},{vertices:[3,0,4]},{vertices:[3,2,1,0]}]}
},Phoria.Util.generateIcosahedron=function(d){var b=d||1,a=(1+Math.sqrt(5))/2,c=a/Math.sqrt(1+a*a)*b,f=1/Math.sqrt(1+a*a)*b;
return{points:[{x:c,y:f,z:0},{x:-c,y:f,z:0},{x:-c,y:-f,z:0},{x:c,y:-f,z:0},{x:f,y:0,z:c},{x:f,y:0,z:-c},{x:-f,y:0,z:-c},{x:-f,y:0,z:c},{x:0,y:c,z:f},{x:0,y:-c,z:f},{x:0,y:-c,z:-f},{x:0,y:c,z:-f}],edges:[{a:4,b:8},{a:8,b:7},{a:7,b:4},{a:7,b:9},{a:9,b:4},{a:5,b:6},{a:6,b:11},{a:11,b:5},{a:5,b:10},{a:10,b:6},{a:0,b:4},{a:4,b:3},{a:3,b:0},{a:3,b:5},{a:5,b:0},{a:2,b:7},{a:7,b:1},{a:1,b:2},{a:1,b:6},{a:6,b:2},{a:8,b:0},{a:0,b:11},{a:11,b:8},{a:11,b:1},{a:1,b:8},{a:9,b:10},{a:10,b:3},{a:3,b:9},{a:9,b:2},{a:2,b:10}],polygons:[{vertices:[4,8,7]},{vertices:[4,7,9]},{vertices:[5,6,11]},{vertices:[5,10,6]},{vertices:[0,4,3]},{vertices:[0,3,5]},{vertices:[2,7,1]},{vertices:[2,1,6]},{vertices:[8,0,11]},{vertices:[8,11,1]},{vertices:[9,10,3]},{vertices:[9,2,10]},{vertices:[8,4,0]},{vertices:[11,0,5]},{vertices:[4,9,3]},{vertices:[5,3,10]},{vertices:[7,8,1]},{vertices:[6,1,11]},{vertices:[7,2,9]},{vertices:[6,10,2]}]}
},Phoria.Util.subdivide=function(h,d){for(var c,g=[],k=[],b=function(m){var a=m.x*m.x+m.y*m.y+m.z*m.z;
a=1/Math.sqrt(a),m.x*=a,m.y*=a,m.z*=a
},l=function(q,o,m){var u={x:0,y:0,z:0},p={x:0,y:0,z:0},a={x:0,y:0,z:0};
u.x=q.x+o.x,u.y=q.y+o.y,u.z=q.z+o.z,p.x=o.x+m.x,p.y=o.y+m.y,p.z=o.z+m.z,a.x=m.x+q.x,a.y=m.y+q.y,a.z=m.z+q.z,b(u),b(p),b(a);
var r=g.length;
g.push(q,o,m,u,p,a),k.push({vertices:[r+0,r+3,r+5]}),k.push({vertices:[r+1,r+4,r+3]}),k.push({vertices:[r+2,r+5,r+4]}),k.push({vertices:[r+3,r+4,r+5]})
},f=0;
f<d.length;
f++){c=d[f].vertices,3===c.length?l.call(this,h[c[0]],h[c[1]],h[c[2]]):4===c.length&&(l.call(this,h[c[0]],h[c[1]],h[c[2]]),l.call(this,h[c[2]],h[c[3]],h[c[0]]))
}return{points:g,polygons:k}
},Phoria.Util.generateCylinder=function(p,v,k){for(var b=[],d=[],u=[],f=2*Math.PI/k,w=0,g=0;
k>=w;
w++){if(b.push({x:Math.cos(g)*p,z:Math.sin(g)*p,y:v/2}),b.push({x:Math.cos(g)*p,z:Math.sin(g)*p,y:-v/2}),g+=f,0!==w&&(d.push({vertices:[2*w-2,2*w,2*w+1,2*w-1]}),u.push({a:2*w,b:2*w-2},{a:2*w-2,b:2*w-1},{a:2*w+1,b:2*w-1}),w===k-1)){for(var q=[],m=k;
m>=0;
m--){q.push(2*m)
}d.push({vertices:q}),q=[];
for(var m=0;
k>m;
m++){q.push(2*m+1)
}d.push({vertices:q})
}}return{points:b,edges:u,polygons:d}
},Phoria.Util.generateCuboid=function(d){var b=d.scalex||1,a=d.scaley||1,c=d.scalez||1;
d.offsetx||0,d.offsety||0,d.offsetz||0;
return{points:[{x:-1*b,y:1*a,z:-1*c},{x:1*b,y:1*a,z:-1*c},{x:1*b,y:-1*a,z:-1*c},{x:-1*b,y:-1*a,z:-1*c},{x:-1*b,y:1*a,z:1*c},{x:1*b,y:1*a,z:1*c},{x:1*b,y:-1*a,z:1*c},{x:-1*b,y:-1*a,z:1*c}],edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0},{a:4,b:5},{a:5,b:6},{a:6,b:7},{a:7,b:4},{a:0,b:4},{a:1,b:5},{a:2,b:6},{a:3,b:7}],polygons:[{vertices:[0,1,2,3]},{vertices:[0,4,5,1]},{vertices:[1,5,6,2]},{vertices:[2,6,7,3]},{vertices:[4,0,3,7]},{vertices:[5,4,7,6]}]}
},Phoria.Util.generateSphere=function(S,E,N,G){for(var I=[],W=[],J=[],F=[],L=0;
E>=L;
++L){for(var U=0;
N>=U;
++U){var O=L*Math.PI/E,D=2*U*Math.PI/N,C=Math.sin(O),T=Math.sin(D),z=Math.cos(O),R=Math.cos(D),K=R*C,H=z,Q=T*C;
if(G){var k=U/N,A=L/E;
F.push({u:k,v:A})
}I.push({x:S*K,y:S*H,z:S*Q})
}}for(var L=0;
E>L;
++L){for(var U=0;
N>U;
++U){var V=L*(N+1)+U,B=V+N+1;
if(0===L){var q={vertices:[V+1,B+1,B]};
G&&(q.uvs=[F[V+1].u,F[V+1].v,F[B+1].u,F[B+1].v,F[B].u,F[B].v]),J.push(q),W.push({a:V,b:B})
}else{if(L===E-1){var q={vertices:[V+1,B,V]};
G&&(q.uvs=[F[V+1].u,F[V+1].v,F[B].u,F[B].v,F[V].u,F[V].v]),J.push(q),W.push({a:V,b:B})
}else{var q={vertices:[V+1,B+1,B,V]};
G&&(q.uvs=[F[V+1].u,F[V+1].v,F[B+1].u,F[B+1].v,F[B].u,F[B].v,F[V].u,F[V].v]),J.push(q),W.push({a:V,b:B}),W.push({a:B,b:B+1})
}}}}return{points:I,edges:W,polygons:J}
},Phoria.Util.generateRadialGradientBitmap=function(h,d,c){var g=document.createElement("canvas"),k=h<<1;
g.width=g.height=k;
var b=g.getContext("2d"),l=b.createRadialGradient(h,h,h>>1,h,h,h);
l.addColorStop(0,d),l.addColorStop(1,c),b.fillStyle=l,b.fillRect(0,0,k,k);
var f=new Image;
return f.src=g.toDataURL("image/png"),f
},Phoria.Util.request=function(d){var b=new XMLHttpRequest,a=d.data||"";
d.responseContentType&&b.overrideMimeType&&b.overrideMimeType(d.responseContentType),b.open(d.method?d.method:"GET",d.url),d.requestContentType&&b.setRequestHeader("Accept",d.requestContentType),b.onreadystatechange=function(){4===b.readyState&&(200===b.status?d.fnSuccess&&d.fnSuccess.call(this,b.responseText,b.status):d.fnFailure?d.fnFailure.call(this,b.responseText,b.status):alert(b.status+"\n\n"+b.responseText))
};
try{"POST"===d.method||"PUT"===d.method?b.send(a):b.send(null)
}catch(c){alert(c.message)
}},Phoria.Util.importGeometryWavefront=function(p){var y,k,b,d,v,f,z=[],g=[],q=[],m=/\s+/,w=p.scale||1;
y=k=b=d=v=f=0,Phoria.Util.request({url:p.url,fnSuccess:function(D){for(var O=D.split("\n"),u=0;
u<O.length;
u++){var N=O[u].split(m);
switch(N[0]){case"v":var I=parseFloat(N[1])*w,H=parseFloat(N[2])*w,K=parseFloat(N[3])*w;
z.push({x:I,y:H,z:K}),y>I?y=I:I>d&&(d=I),k>H?k=H:H>v&&(v=H),b>K?b=K:K>f&&(f=K);
break;
case"vt":var o=parseFloat(N[1]),B=parseFloat(N[2]);
q.push([o,B]);
break;
case"f":N.splice(0,1);
for(var Q,C,r=[],t=[],W=0;
W<N.length;
W++){if(Q=N[p.reorder?N.length-W-1:W],0!==Q.length&&(C=Q.split("/"),r.push(parseInt(C[0])-1),C.length>1&&-1===Q.indexOf("//"))){var l=parseInt(C[1])-1;
q.length>l&&t.push(q[l][0],q[l][1])
}}var F={vertices:r};
g.push(F),0!==t.length&&(F.uvs=t)
}}if(p.center){for(var h=(y+d)/2,n=(k+v)/2,J=(b+f)/2,u=0;
u<z.length;
u++){z[u].x-=h,z[u].y-=n,z[u].z-=J
}}if(p.scaleTo){var c=d-y,s=v-k,G=f-b,a=0;
a=s>c?G>s?1/(G/p.scaleTo):1/(s/p.scaleTo):G>c?1/(G/p.scaleTo):1/(c/p.scaleTo);
for(var u=0;
u<z.length;
u++){z[u].x*=a,z[u].y*=a,z[u].z*=a
}}p.fnSuccess&&p.fnSuccess.call(this,{points:z,polygons:g})
},fnFailure:function(a){p.fnFailure&&p.fnFailure.call(this,a)
}})
},Phoria.Util.calculatePolarFromPlanar=function(b){var a=new vec3.create;
return a[0]=vec3.length(b),a[1]=Math.acos(b[2]/a[0]),0!==b[0]?b[0]>0?a[2]=Math.atan(b[1]/b[0]):a[2]=Math.PI+Math.atan(b[1]/b[0]):b[1]>0?a[2]=Math.PI/2:a[2]=3*Math.PI/2,a
},Phoria.Util.calculatePlanarFromPolar=function(a){return new vec3.fromValues(Math.round(a[0]*Math.sin(a[1])*Math.cos(a[2])*100)/100,Math.round(a[0]*Math.sin(a[1])*Math.sin(a[2])*100)/100,Math.round(a[0]*Math.cos(a[1])*100)/100)
},Phoria.Util.planeLineIntersection=function(h,d,c,g){var k=vec3.dot(c,h);
if(0!==k){var b=new vec3.create;
vec3.subtract(b,d,g);
var l=vec3.dot(h,b)/k,f=vec3.create();
return vec3.scaleAndAdd(f,g,c,l),f
}return null
},Phoria.Util.intersectionInsidePolygon=function(k,q,h){for(var b=vec3.fromValues(Math.abs(k.normal[0]),Math.abs(k.normal[1]),Math.abs(k.normal[2])),d=0,p=vec2.fromValues(1,1),f=0;
f<k.vertices.length;
f++){var u,g,m;
b[2]>=b[0]&&b[2]>=b[1]?(u=vec2.fromValues(q[k.vertices[f]][0],q[k.vertices[f]][1]),g=f<k.vertices.length-1?vec2.fromValues(q[k.vertices[f+1]][0],q[k.vertices[f+1]][1]):vec2.fromValues(q[k.vertices[0]][0],q[k.vertices[0]][1]),m=vec2.fromValues(h[0],h[1])):b[1]>b[0]?(u=vec2.fromValues(q[k.vertices[f]][2],q[k.vertices[f]][0]),g=f<k.vertices.length-1?vec2.fromValues(q[k.vertices[f+1]][2],q[k.vertices[f+1]][0]):vec2.fromValues(q[k.vertices[0]][2],q[k.vertices[0]][0]),m=vec2.fromValues(h[2],h[0])):(u=vec2.fromValues(q[k.vertices[f]][1],q[k.vertices[f]][2]),g=f<k.vertices.length-1?vec2.fromValues(q[k.vertices[f+1]][1],q[k.vertices[f+1]][2]):vec2.fromValues(q[k.vertices[0]][1],q[k.vertices[0]][2]),m=vec2.fromValues(h[1],h[2])),Phoria.Util.sectionLineIntersect2D(u,g,m,p)&&d++
}return d%2===1
},Phoria.Util.sectionLineIntersect2D=function(k,q,h,b){var d=vec2.create();
vec2.subtract(d,q,k);
var p=vec3.create();
if(vec2.cross(p,d,b),0===p[2]){return !1
}var f,u=(h[0]*b[1]-h[1]*b[0]-k[0]*b[1]+k[1]*b[0])/p[2];
f=0!==b[0]?(k[0]+u*d[0]-h[0])/b[0]:(k[1]+u*d[1]-h[1])/b[1];
var g=vec2.create();
vec2.scaleAndAdd(g,k,d,u);
var m={x:!1,y:!1};
return f>=0&&(k[0]>q[0]?g[0]<=k[0]&&g[0]>=q[0]&&(m.x=!0):g[0]>=k[0]&&g[0]<=q[0]&&(m.x=!0),k[1]>q[1]?g[1]<=k[1]&&g[1]>=q[1]&&(m.y=!0):g[1]>=k[1]&&g[1]<=q[1]&&(m.y=!0)),m.x&&m.y
}
}(),function(){Phoria.Preloader=function(){return this.images=[],this
},Phoria.Preloader.prototype={images:null,callback:null,counter:0,addImage:function(c,b){var a=this;
c.url=b,c.onload=function(){a.counter++,a.counter===a.images.length&&a.callback.call(a)
},this.images.push(c)
},onLoadCallback:function(c){this.counter=0,this.callback=c;
for(var b=0,a=this.images.length;
a>b;
b++){this.images[b].src=this.images[b].url
}}}
}(),function(){Phoria.BaseEntity=function(){return this.matrix=mat4.create(),this.children=[],this
},Phoria.BaseEntity.create=function(b,a){return a||(a=new Phoria.BaseEntity),b.id&&(a.id=b.id),b.matrix&&(a.matrix=b.matrix),b.children&&(a.children=b.children),b.onBeforeScene&&a.onBeforeScene(b.onBeforeScene),b.onScene&&a.onScene(b.onScene),void 0!==b.disabled&&(a.disabled=b.disabled),a
},Phoria.BaseEntity.prototype={id:null,children:null,matrix:null,disabled:!1,onBeforeSceneHandlers:null,onSceneHandlers:null,onBeforeScene:function(a){null===this.onBeforeSceneHandlers&&(this.onBeforeSceneHandlers=[]),this.onBeforeSceneHandlers=this.onBeforeSceneHandlers.concat(a)
},onScene:function(a){null===this.onSceneHandlers&&(this.onSceneHandlers=[]),this.onSceneHandlers=this.onSceneHandlers.concat(a)
},identity:function(){return mat4.identity(this.matrix),this
},invert:function(){return mat4.invert(this.matrix,this.matrix),this
},multiply:function(a){return mat4.multiply(this.matrix,this.matrix,a),this
},scale:function(a){return mat4.scale(this.matrix,this.matrix,a),this
},scaleN:function(a){return mat4.scale(this.matrix,this.matrix,vec3.fromValues(a,a,a)),this
},rotate:function(b,a){return mat4.rotate(this.matrix,this.matrix,b,a),this
},rotateX:function(a){return mat4.rotateX(this.matrix,this.matrix,a),this
},rotateY:function(a){return mat4.rotateY(this.matrix,this.matrix,a),this
},rotateZ:function(a){return mat4.rotateZ(this.matrix,this.matrix,a),this
},rotateYPR:function(d,b,a){var c=mat4.fromYPR(d,b,a);
mat4.multiply(this.matrix,this.matrix,c)
},translate:function(a){return mat4.translate(this.matrix,this.matrix,a),this
},translateX:function(a){return mat4.translate(this.matrix,this.matrix,vec3.fromValues(a,0,0)),this
},translateY:function(a){return mat4.translate(this.matrix,this.matrix,vec3.fromValues(0,a,0)),this
},translateZ:function(a){return mat4.translate(this.matrix,this.matrix,vec3.fromValues(0,0,a)),this
},determinant:function(){return mat4.determinant(this.matrix)
},transpose:function(){return mat4.transpose(this.matrix,this.matrix),this
}}
}(),Phoria.CLIP_ARRAY_TYPE="undefined"!=typeof Uint32Array?Uint32Array:Array,function(){Phoria.Entity=function(){return Phoria.Entity.superclass.constructor.call(this),this.points=[],this.edges=[],this.polygons=[],this.textures=[],this.style=Phoria.Entity.createStyle(),this
},Phoria.Entity.create=function(b,a){return a||(a=new Phoria.Entity),Phoria.BaseEntity.create(b,a),b.points&&(a.points=b.points),b.polygons&&(a.polygons=b.polygons),b.edges&&(a.edges=b.edges),b.textures&&(a.textures=b.textures),b.texts&&(a.texts=b.texts),b.style&&Phoria.Util.combine(a.style,b.style),b.onRender&&a.onRender(b.onRender),a.generatePolygonNormals(),a
},Phoria.Entity.createStyle=function(b){var a={color:[128,128,128],diffuse:1,specular:0,drawmode:"solid",shademode:"lightsource",fillmode:"inflate",objectsortmode:"sorted",geometrysortmode:"automatic",linewidth:1,linescale:0,opacity:1,doublesided:!1};
return b&&Phoria.Util.combine(a,b),a
},Phoria.Util.extend(Phoria.Entity,Phoria.BaseEntity,{points:null,edges:null,polygons:null,style:null,textures:null,onRenderHandlers:null,_worldcoords:null,_cameracoords:null,_coords:null,_clip:null,_averagez:0,_sorted:!0,onRender:function(a){null===this.onRenderHandlers&&(this.onRenderHandlers=[]),this.onRenderHandlers=this.onRenderHandlers.concat(a)
},generatePolygonNormals:function(){if(this.polygons){for(var k,q,h,b,d,p,f,u=this.points,g=this.polygons,m=0;
m<g.length;
m++){k=g[m].vertices,q=u[k[1]].x-u[k[0]].x,h=u[k[1]].y-u[k[0]].y,b=u[k[1]].z-u[k[0]].z,d=u[k[2]].x-u[k[0]].x,p=u[k[2]].y-u[k[0]].y,f=u[k[2]].z-u[k[0]].z,g[m].normal=Phoria.Util.calcNormalVector(q,h,b,d,p,f)
}}},initCoordinateBuffers:function(){var b=this.points.length;
if(null===this._worldcoords||this._worldcoords.length<b){this._worldcoords=new Array(b);
for(var a=0;
b>a;
a++){this._worldcoords[a]=vec4.create()
}}if(null===this._cameracoords||this._cameracoords.length<b){this._cameracoords=new Array(b);
for(var a=0;
b>a;
a++){this._cameracoords[a]=vec4.create()
}}if(null===this._coords||this._coords.length<b){this._coords=new Array(b);
for(var a=0;
b>a;
a++){this._coords[a]=vec4.create()
}}(null===this._clip||this._clip.length<b)&&(this._clip=new Phoria.CLIP_ARRAY_TYPE(b))
},getScreenBounds:function(){for(var g,d=10000,c=10000,f=-10000,h=-10000,b=0;
b<this._coords.length;
b++){g=this._coords[b],g[0]<d&&(d=g[0]),g[0]>f&&(f=g[0]),g[1]<c&&(c=g[1]),g[1]>h&&(h=g[1])
}return{minx:d,miny:c,maxx:f,maxy:h}
},getWorldBounds:function(){for(var h,d=10000,c=10000,g=10000,k=-10000,b=-10000,l=-10000,f=0;
f<this._worldcoords.length;
f++){h=this._worldcoords[f],h[0]<d&&(d=h[0]),h[0]>k&&(k=h[0]),h[1]<c&&(c=h[1]),h[1]>b&&(b=h[1]),h[2]<g&&(g=h[2]),h[2]>l&&(l=h[2])
}return{minx:d,miny:c,maxx:k,maxy:b,minz:g,maxz:l}
}}),Phoria.Entity.debug=function(g,d){for(var c="Phoria.Debug"+(g.id?" "+g.id:""),f=null,h=0;
h<g.children.length;
h++){if(g.children[h].id===c){f=g.children[h];
break
}}if(null===f){f=new Phoria.Entity,f.id=c,f.points=[{x:0,y:0,z:0}],f.style={drawmode:"point",shademode:"callback",geometrysortmode:"none",objectsortmode:"front"},f.config={},f.onRender(function(m,l,p){m.fillStyle="#333",m.font="14pt Helvetica";
var k=p;
if(this.config.showId&&(m.fillText(g.id?g.id:"unknown - set Entity 'id' property",l,k),k+=16),this.config.showPosition){var q=g.worldposition?g.worldposition:f._worldcoords[0];
m.fillText("{x:"+q[0].toFixed(2)+", y:"+q[1].toFixed(2)+", z:"+q[2].toFixed(2)+"}",l,k)
}}),g.children.push(f);
var b=function(m,k,a){var l=new Phoria.Entity;
return l.points=[{x:0,y:0,z:0},{x:2*k[0],y:2*k[1],z:2*k[2]}],l.edges=[{a:0,b:1}],l.style={drawmode:"wireframe",shademode:"plain",geometrysortmode:"none",objectsortmode:"front",linewidth:2,color:a},l.disabled=!0,l
};
f.children.push(b("X",vec3.fromValues(1,0,0),[255,0,0])),f.children.push(b("Y",vec3.fromValues(0,1,0),[0,255,0])),f.children.push(b("Z",vec3.fromValues(0,0,1),[0,0,255]))
}Phoria.Util.combine(f.config,d);
for(var h=0;
h<f.children.length;
h++){f.children[h].disabled=!f.config.showAxis
}}
}(),function(){Phoria.PositionalAspect={},Phoria.PositionalAspect.prototype={position:null,worldposition:null,updatePosition:function(b){var a=vec4.fromXYZ(this.position,1);
vec4.transformMat4(a,a,b),this.worldposition=a
}}
}(),function(){Phoria.PhysicsEntity=function(){return Phoria.PhysicsEntity.superclass.constructor.call(this),this.velocity={x:0,y:0,z:0},this.position={x:0,y:0,z:0},this._force={x:0,y:0,z:0},this._acceleration=null,this.gravity=!0,this.onBeforeScene(this.applyPhysics),this.onScene(this.transformToScene),this
},Phoria.PhysicsEntity.create=function(b){var a=new Phoria.PhysicsEntity;
return Phoria.Entity.create(b,a),b.velocity&&(a.velocity=b.velocity),b.position&&(a.position=b.position),b.force&&(a._force=b.force),void 0!==b.gravity&&(a.gravity=b.gravity),a
},Phoria.Util.extend(Phoria.PhysicsEntity,Phoria.Entity,{velocity:null,gravity:!1,_force:null,_acceleration:null,impulse:function(a){this._acceleration=a
},force:function(a){this._force=a
},applyPhysics:function(c){var b=1000/60/1000,a=b*b;
this._acceleration&&(this.velocity.x+=this._acceleration.x*a,this.velocity.y+=this._acceleration.y*a,this.velocity.z+=this._acceleration.z*a,this._acceleration=null),this._force&&(this.velocity.x+=this._force.x*a,this.velocity.y+=this._force.y*a,this.velocity.z+=this._force.z*a),this.gravity&&(this.velocity.x+=Phoria.PhysicsEntity.GRAVITY.x*a,this.velocity.y+=Phoria.PhysicsEntity.GRAVITY.y*a,this.velocity.z+=Phoria.PhysicsEntity.GRAVITY.z*a),this.translate(vec3.fromXYZ(this.velocity))
},transformToScene:function(b,a){this.updatePosition(a)
}}),Phoria.Util.augment(Phoria.PhysicsEntity,Phoria.PositionalAspect)
}(),Phoria.PhysicsEntity.GRAVITY={x:0,y:-9.8,z:0},function(){Phoria.EmitterEntity=function(){Phoria.EmitterEntity.superclass.constructor.call(this),this.position={x:0,y:0,z:0},this.positionRnd={x:0,y:0,z:0},this.velocity={x:0,y:1,z:0},this.velocityRnd={x:0,y:0,z:0},this.maximum=1000,this.gravity=!0;
var a=Phoria.Entity.createStyle();
return a.drawmode="point",a.shademode="plain",a.geometrysortmode="none",a.linewidth=5,a.linescale=2,this.style=a,this.textures=[],this._lastEmitTime=Date.now(),this.onScene(this.emitParticles),this
},Phoria.EmitterEntity.create=function(b){var a=new Phoria.EmitterEntity;
return Phoria.BaseEntity.create(b,a),b.position&&(a.position=b.position),b.positionRnd&&(a.positionRnd=b.positionRnd),b.rate&&(a.rate=b.rate),b.maximum&&(a.maximum=b.maximum),b.velocity&&(a.velocity=b.velocity),b.velocityRnd&&(a.velocityRnd=b.velocityRnd),b.lifetime&&(a.lifetime=b.lifetime),b.lifetimeRnd&&(a.lifetimeRnd=b.lifetimeRnd),void 0!==b.gravity&&(a.gravity=b.gravity),b.style&&Phoria.Util.combine(a.style,b.style),b.onParticle&&a.onParticle(b.onParticle),a
},Phoria.Util.extend(Phoria.EmitterEntity,Phoria.BaseEntity,{style:null,rate:0,maximum:0,velocity:null,velocityRnd:null,lifetime:0,lifetimeRnd:0,gravity:!1,_lastEmitTime:0,onParticleHandlers:null,onParticle:function(a){null===this.onParticleHandlers&&(this.onParticleHandlers=[]),this.onParticleHandlers=this.onParticleHandlers.concat(a)
},emitParticles:function(p,A,k){this.updatePosition(A);
for(var b,d=Date.now(),w=0;
w<this.children.length;
w++){b=this.children[w],b._gravetime&&d>b._gravetime&&this.children.splice(w,1)
}var f=d-this._lastEmitTime,B=Math.floor(this.rate/1000*f);
if(B>0){for(var g=0;
B>g&&(0===this.maximum||this.children.length<this.maximum);
g++){var q={x:this.position.x,y:this.position.y,z:this.position.z};
q.x+=Math.random()*this.positionRnd.x-0.5*this.positionRnd.x,q.y+=Math.random()*this.positionRnd.y-0.5*this.positionRnd.y,q.z+=Math.random()*this.positionRnd.z-0.5*this.positionRnd.z;
var m={x:this.velocity.x,y:this.velocity.y,z:this.velocity.z};
m.x+=Math.random()*this.velocityRnd.x-0.5*this.velocityRnd.x,m.y+=Math.random()*this.velocityRnd.y-0.5*this.velocityRnd.y,m.z+=Math.random()*this.velocityRnd.z-0.5*this.velocityRnd.z;
var z=new Phoria.PhysicsEntity;
if(z.position=q,z.points=[q],z.velocity=m,z.gravity=this.gravity,z.style=this.style,z.textures=this.textures,0!==this.lifetime&&(z._gravetime=Math.floor(d+this.lifetime+this.lifetimeRnd*Math.random()-0.5*this.lifetimeRnd)),null!==this.onParticleHandlers){for(var y=0;
y<this.onParticleHandlers.length;
y++){this.onParticleHandlers[y].call(this,z)
}}this.children.push(z)
}this._lastEmitTime=d
}}}),Phoria.Util.augment(Phoria.EmitterEntity,Phoria.PositionalAspect)
}(),function(){Phoria.BaseLight=function(){return Phoria.BaseLight.superclass.constructor.call(this),this.color=[1,1,1],this.intensity=1,this
},Phoria.Util.extend(Phoria.BaseLight,Phoria.BaseEntity,{color:null,intensity:0})
}(),function(){Phoria.DistantLight=function(){return Phoria.DistantLight.superclass.constructor.call(this),this.direction={x:0,y:0,z:1},this.onScene(this.transformToScene),this
},Phoria.DistantLight.create=function(b){var a=new Phoria.DistantLight;
return Phoria.BaseEntity.create(b,a),b.color&&(a.color=b.color),b.intensity&&(a.intensity=b.intensity),b.direction&&(a.direction=vec3.toXYZ(vec3.normalize(a.direction,vec3.fromXYZ(b.direction)))),a
},Phoria.Util.extend(Phoria.DistantLight,Phoria.BaseLight,{direction:null,worlddirection:null,transformToScene:function(){this.worlddirection=vec3.fromValues(-this.direction.x,-this.direction.y,-this.direction.z)
}})
}(),function(){Phoria.PointLight=function(){return Phoria.PointLight.superclass.constructor.call(this),this.position={x:0,y:0,z:-1},this.attenuation=0.1,this.attenuationFactor="linear",this.onScene(this.transformToScene),this
},Phoria.PointLight.create=function(b){var a=new Phoria.PointLight;
return Phoria.BaseEntity.create(b,a),b.color&&(a.color=b.color),b.intensity&&(a.intensity=b.intensity),b.position&&(a.position=b.position),b.attenuation&&(a.attenuation=b.attenuation),b.attenuationFactor&&(a.attenuationFactor=b.attenuationFactor),a
},Phoria.Util.extend(Phoria.PointLight,Phoria.BaseLight,{attenuation:0,attenuationFactor:null,transformToScene:function(c,b,a){this.updatePosition(b)
}}),Phoria.Util.augment(Phoria.PointLight,Phoria.PositionalAspect)
}(),function(){Phoria.Scene=function(){return this.camera={up:{x:0,y:1,z:0},lookat:{x:0,y:0,z:0},position:{x:0,y:0,z:-10}},this.perspective={fov:35,aspect:1,near:1,far:10000},this.viewport={x:0,y:0,width:1024,height:1024},this.graph=[],this.triggerHandlers=[],this
},Phoria.Scene.create=function(b){var a=new Phoria.Scene;
return b.camera&&(a.camera=Phoria.Util.merge(a.camera,b.camera)),b.perspective&&(a.perspective=Phoria.Util.merge(a.perspective,b.perspective)),b.viewport&&(a.viewport=Phoria.Util.merge(a.viewport,b.viewport)),b.graph&&(a.graph=b.graph),b.onCamera&&a.onCamera(b.onCamera),a
},Phoria.Scene.createFromJSON=function(d){var b=null,a=JSON.parse(d);
if(a&&a.graph){var c=function(k){for(var h,g=0;
g<k.length;
g++){h=k[g];
for(var l in h){if(h.hasOwnProperty(l)){if(0===l.indexOf("on")&&(h[l] instanceof string||h[l] instanceof Array)){try{}catch(f){throw console.log("Failed to convert expected event handler to function: "+l+"="+h[l]),f
}}"children"===l&&h[l] instanceof Array&&c(h[l])
}}}};
c(a.graph)
}return b
},Phoria.Scene.toJSON=function(c){for(var b in c){c.hasOwnProperty(b)&&0===b.indexOf("_")&&delete c[b]
}if(c.graph){var a=function(g){for(var d,f=0;
f<g.length;
f++){d=g[f];
for(var h in d){if(d.hasOwnProperty(h)){switch(0===h.indexOf("on")&&d[h] instanceof Array&&(d[h]=d[h].toString()),0===h.indexOf("_")&&delete d[h],h){case"textures":delete d[h];
break;
case"children":d[h] instanceof Array&&a(d[h])
}}}}};
a(c.graph)
}return JSON.stringify(c)
},Phoria.Scene.prototype={camera:null,perspective:null,graph:null,viewport:null,renderlist:null,lights:null,triggerHandlers:null,onCameraHandlers:null,_entities:null,_lastTime:0,_cameraPosition:null,_perspectiveScale:0,findEntity:function(a){return this._entities[a]
},onCamera:function(a){null===this.onCameraHandlers&&(this.onCameraHandlers=[]),this.onCameraHandlers=this.onCameraHandlers.concat(a)
},modelView:function(){var B=Date.now(),I=(B-this._lastTime)/1000;
this._lastTime=B;
var w=this.viewport.x,b=this.viewport.y,g=0.5*this.viewport.width,F=0.5*this.viewport.height;
this._cameraPosition=vec4.fromValues(this.camera.position.x,this.camera.position.y,this.camera.position.z,0);
var k=mat4.create(),J=vec4.fromValues(this.camera.lookat.x,this.camera.lookat.y,this.camera.lookat.z,0),q=vec4.fromValues(this.camera.up.x,this.camera.up.y,this.camera.up.z,0);
if(null!==this.onCameraHandlers){for(var D=0;
D<this.onCameraHandlers.length;
D++){this.onCameraHandlers[D].call(this,this._cameraPosition,J,q)
}}mat4.lookAt(k,this._cameraPosition,J,q);
var z=mat4.create();
mat4.perspective(z,-this.perspective.fov*Phoria.RADIANS,this.perspective.aspect,this.perspective.near,this.perspective.far),this._perspectiveScale=(256-this.perspective.fov)/16;
var H=[],G=[],C={},E=function(Q,v){for(var L,R,O=0;
O<Q.length;
O++){if(L=Q[O],!L.disabled){if(L.id&&(C[L.id]=L),null!==L.onBeforeSceneHandlers){for(var K=0;
K<L.onBeforeSceneHandlers.length;
K++){L.onBeforeSceneHandlers[K].call(L,this,I)
}}var y=L.matrix;
if(v&&(y=y?mat4.multiply(mat4.create(),y,v):v),null!==L.onSceneHandlers){for(var K=0;
K<L.onSceneHandlers.length;
K++){L.onSceneHandlers[K].call(L,this,y,I)
}}if(L instanceof Phoria.BaseLight){G.push(L)
}else{if(L instanceof Phoria.Entity){R=L.points.length,L.initCoordinateBuffers();
var N=0,h=0;
"point"===L.style.drawmode&&(h=0===L.style.linescale?0.5*L.style.linewidth:L.style.linewidth*L.style.linescale/this._perspectiveScale*0.5);
for(var r,U,t,n=0,o=0;
R>n;
n++){r=L.points[n],U=vec4.set(L._worldcoords[n],r.x,r.y,r.z,1),y&&vec4.transformMat4(L._worldcoords[n],U,y),vec4.transformMat4(L._cameracoords[n],L._worldcoords[n],k),vec4.transformMat4(L._coords[n],L._cameracoords[n],z),U=L._coords[n],t=U[3],0===t&&(t=Phoria.EPSILON),N+=L._clip[n]=U[0]>t+h||U[0]<-t-h||U[1]>t+h||U[1]<-t-h||U[2]>t||U[2]<-t?1:0,U[0]/=t,U[1]/=t,U[0]=g*U[0]+w+g,U[1]=F*U[1]+b+F,o+=U[2]
}switch(L._averagez=R>1?o/R:o,L.style.geometrysortmode){default:case"automatic":case"sorted":if("sorted"===L.style.geometrysortmode||"solid"===L.style.drawmode||"lightsource"===L.style.shademode){switch(L.style.drawmode){case"solid":Phoria.Util.sortPolygons(L.polygons,L._cameracoords);
break;
case"wireframe":Phoria.Util.sortEdges(L.edges,L._cameracoords);
break;
case"point":Phoria.Util.sortPoints(L._coords,L._worldcoords)
}}}if("solid"===L.style.drawmode&&0!==L.polygons.length){var V=mat4.invert(mat4.create(),y?y:mat4.create());
switch(mat4.transpose(V,V),L.style.shademode){case"lightsource":for(var d,u,a=0;
a<L.polygons.length;
a++){L.polygons[a]._worldnormal||(L.polygons[a]._worldnormal=vec4.create()),d=L.polygons[a].normal,u=L.polygons[a]._worldnormal,vec3.transformMat4(u,d,V),vec3.normalize(u,u)
}}}H.push(L)
}}L.children&&0!==L.children.length&&E.call(this,L.children,y)
}}};
E.call(this,this.graph,null),this.renderlist=H,this.lights=G,this._entities=C;
for(var A=0,p=this.triggerHandlers.length;
p>A;
A++){this.triggerHandlers[A].trigger.call(this,this._cameraPosition,J,q)&&(this.triggerHandlers.splice(A,1),p--)
}}}
}(),function(){Phoria.Renderer=function(){},Phoria.Renderer.prototype={sort:!0,sortObjects:function(c){if(this.sort){for(var b,a=0;
a<c.renderlist.length;
a++){switch(b=c.renderlist[a],b.style.objectsortmode){case"sorted":break;
case"custom":b._averagez=b.style.zindex;
break;
case"front":b._averagez=Number.MIN_VALUE;
break;
case"back":default:b._averagez=Number.MAX_VALUE
}}c.renderlist.sort(function(f,d){return f._averagez<d._averagez?1:-1
})
}},calcNormalBrightness:function(z,G,p,b){for(var g,D,k=[0,0,0],H=p.lights,m=0;
m<H.length;
m++){if(g=H[m],g instanceof Phoria.DistantLight){var B=vec3.dot(G,g.worlddirection);
if(0>=B){continue
}D=B*g.intensity*b.style.diffuse
}else{if(g instanceof Phoria.PointLight){var q,F=vec3.subtract(vec3.create(),z,g.worldposition),E=vec3.length(F);
vec3.normalize(F,F);
var B=vec3.dot(G,vec3.negate(F,F));
if(0>=B){continue
}switch(g.attenuationFactor){default:case"none":q=g.attenuation;
break;
case"linear":q=g.attenuation*E;
break;
case"squared":q=g.attenuation*E*E
}if(0!==b.style.specular){var A=vec3.add(vec3.create(),F,p._cameraPosition),C=vec3.dot(G,vec3.normalize(A,A)),w=Math.pow(C,b.style.specular)*g.intensity/q;
k[0]+=w*g.color[0],k[1]+=w*g.color[1],k[2]+=w*g.color[2]
}D=b.style.diffuse*B*g.intensity/q
}}k[0]+=D*g.color[0],k[1]+=D*g.color[1],k[2]+=D*g.color[2]
}return k
},calcPositionBrightness:function(h,m){for(var g,b,c=[0,0,0],k=0;
k<m.length;
k++){if(g=m[k],g instanceof Phoria.DistantLight){b=g.intensity
}else{if(g instanceof Phoria.PointLight){var d,p=vec3.subtract(vec3.create(),h,g.worldposition),f=vec3.length(p);
switch(vec3.normalize(p,p),g.attenuationFactor){case"linear":d=g.attenuation*f;
break;
case"squared":d=g.attenuation*f*f;
break;
default:case"none":d=g.attenuation
}b=g.intensity/(2*d)
}}c[0]+=b*g.color[0],c[1]+=b*g.color[1],c[2]+=b*g.color[2]
}return c
},inflatePolygon:function(q,E,m){m=m||0.5;
for(var b=new Array(q.length),f=0;
f<q.length;
f++){b[f]=[E[q[f]][0],E[q[f]][1]]
}for(var B,g,F,k,z,f=0,p=q.length;
p>f;
f++){B=p-1>f?f+1:0,g=b[f][0],F=b[f][1],k=b[B][0],z=b[B][1];
var D,C=k-g,w=z-F,A=C*C+w*w;
0===A&&A===Phoria.EPSILON,D=m/Math.sqrt(A),C*=D,w*=D,b[f][0]-=C,b[f][1]-=w,b[B][0]+=C,b[B][1]+=w
}return b
},inflatePolygonFull:function(q,E,m){m=m||0.5;
for(var b,f,B,g,F,k,z,p=[],D=new Array(q.length),C=0,w=q.length;
w>C;
C++){b=E[q[C]][0],f=E[q[C]][1],w-1>C?(B=E[q[C+1]][0],g=E[q[C+1]][1]):(B=E[q[0]][0],g=E[q[0]][1]),F=g-f,k=-(B-b),z=Math.sqrt(F*F+k*k),F/=z,k/=z,F*=m,k*=m,p.push({x:b+F,y:f+k}),p.push({x:B+F,y:g+k})
}for(var A,C=0,w=q.length;
w>C;
C++){A=0===C?this.intersection(p[2*(w-1)],p[2*(w-1)+1],p[0],p[1]):this.intersection(p[2*(C-1)],p[2*(C-1)+1],p[2*C],p[2*C+1]),(Math.abs(A[0]-E[q[C]][0])>1.5||Math.abs(A[1]-E[q[C]][1])>1.5)&&(A[0]=E[q[C]][0],A[1]=E[q[C]][1]),D[C]=A
}return D
},intersection:function(p,v,k,b){var d=v.x-p.x,u=k.x-b.x,f=k.x-p.x,w=v.y-p.y,g=k.y-b.y,q=k.y-p.y,m=(u*q-g*f)/(w*u-d*g);
return[p.x+m*(v.x-p.x),p.y+m*(v.y-p.y)]
}}
}(),function(){Phoria.CanvasRenderer=function(a){return Phoria.CanvasRenderer.superclass.constructor.call(this),this.canvas=a,this.ctx=a.getContext("2d"),this
},Phoria.Util.extend(Phoria.CanvasRenderer,Phoria.Renderer,{canvas:null,ctx:null,render:function(g,d){this.sortObjects(g);
var c=this.ctx;
d?d.call(this,c):c.clearRect(0,0,this.canvas.width,this.canvas.height);
for(var f,h=0;
h<g.renderlist.length;
h++){switch(f=g.renderlist[h],c.save(),f.style.compositeOperation&&(c.globalCompositeOperation=f.style.compositeOperation),f.style.drawmode){case"solid":("fillstroke"===f.style.fillmode||"hiddenline"===f.style.fillmode)&&(c.lineWidth=0.5);
for(var b=0;
b<f.polygons.length;
b++){this.renderPolygon(c,f,g,f.polygons[b],b)
}break;
case"spline":this.renderSpline(c,f,g),c.strokeStyle="rgb("+f.style.color[0]+","+f.style.color[1]+","+f.style.color[2]+")",c.beginPath();
for(var b=0;
b<f.edges.length;
b++){this.renderEdge(c,f,g,f.edges[b])
}c.closePath(),c.stroke();
break;
case"wireframe":if(c.lineWidth=f.style.linewidth,c.globalAlpha=f.style.opacity,"plain"===f.style.shademode){c.strokeStyle="rgb("+f.style.color[0]+","+f.style.color[1]+","+f.style.color[2]+")",c.beginPath();
for(var b=0;
b<f.edges.length;
b++){this.renderEdge(c,f,g,f.edges[b])
}c.closePath(),c.stroke()
}else{for(var b=0;
b<f.edges.length;
b++){this.renderEdge(c,f,g,f.edges[b])
}}break;
case"point":if("sprite"===f.style.shademode&&void 0!==f.style.sprite){if(!f.textures){throw new Error("Entity has shademode 'sprite' but no textures defined on parent emitter.")
}if(f.style.sprite>f.textures.length-1){throw new Error("Entity has shademode 'sprite' index but references missing texture on parent emitter.")
}}c.globalAlpha=f.style.opacity;
var k=f._coords;
"plain"===f.style.shademode&&(c.fillStyle="rgb("+f.style.color[0]+","+f.style.color[1]+","+f.style.color[2]+")");
for(var b=0;
b<k.length;
b++){this.renderPoint(c,f,g,k[b],b)
}case"text":}c.restore()
}},renderPoint:function(h,d,c,g,k){if(!d._clip[k]){var b=d.style.linewidth;
switch(0!==d.style.linescale&&(b=d.style.linewidth*d.style.linescale*c._perspectiveScale/d._coords[k][3]),d.style.shademode){case"plain":h.beginPath(),h.arc(g[0],g[1],b,0,Phoria.TWOPI,!0),h.closePath(),h.fill();
break;
case"sprite":void 0!==d.style.sprite&&h.drawImage(d.textures[d.style.sprite],g[0]-b,g[1]-b,b+b,b+b);
break;
case"callback":if(null!==d.onRenderHandlers){for(var l=0;
l<d.onRenderHandlers.length;
l++){d.onRenderHandlers[l].call(d,h,g[0],g[1],b)
}}break;
case"lightsource":var f=this.calcPositionBrightness(d._worldcoords[k],c.lights);
h.fillStyle="rgb("+Math.min(Math.ceil(f[0]*d.style.color[0]),255)+","+Math.min(Math.ceil(f[1]*d.style.color[1]),255)+","+Math.min(Math.ceil(f[2]*d.style.color[2]),255)+")",h.beginPath(),h.arc(g[0],g[1],b,0,Phoria.TWOPI,!0),h.closePath(),h.fill()
}}},renderEdge:function(h,m,g,b){var c=m._coords;
if(0!==m.style.linescale&&(h.lineWidth=m.style.linewidth*m.style.linescale/(0.5*(m._coords[b.a][3]+m._coords[b.b][3]))*g._perspectiveScale),"lightsource"===m.style.shademode){var k=m._worldcoords[b.a],d=m._worldcoords[b.b],p=vec3.fromValues(0.5*(k[0]+d[0]),0.5*(k[1]+d[1]),0.5*(k[2]+d[2])),f=this.calcPositionBrightness(p,g.lights);
h.beginPath(),h.strokeStyle="rgb("+Math.min(Math.ceil(f[0]*m.style.color[0]),255)+","+Math.min(Math.ceil(f[1]*m.style.color[1]),255)+","+Math.min(Math.ceil(f[2]*m.style.color[2]),255)+")",h.moveTo(c[b.a][0],c[b.a][1]),h.lineTo(c[b.b][0],c[b.b][1]),h.closePath(),h.stroke()
}else{h.moveTo(c[b.a][0],c[b.a][1]),h.lineTo(c[b.b][0],c[b.b][1])
}},renderSpline:function(z,G,p){for(var b=G._coords,g=(G._clip,G.style.color),D=null,k=G.style,H=G.style.splineRight,m=(G.style.splineLeft,[]),B=0;
B<H.length;
B++){m.push({x:b[H[B]][0],y:b[H[B]][1]})
}z.save(),z.beginPath();
for(var q=[],F=[],E=[],B=0;
B<m.length;
B++){var A=m[B];
q[B]=A.x,F[B]=A.y,E[B]=1,q[B-1]&&(q[B]-q[B-1]<10&&(q[B]+=0.5),console.log(q[B]-q[B-1]))
}CSPL.getNaturalKs(q,F,E);
var C=m[0].x,w=m[m.length-1].x;
z.moveTo(C,CSPL.evalSpline(C,q,F,E));
for(var B=C+0.1;
w>=B;
B+=0.1){z.lineTo(B,CSPL.evalSpline(B,q,F,E))
}z.lineTo(b[G.style.splineRightLines[0]][0],b[G.style.splineRightLines[0]][1]),z.lineTo(b[G.style.splineRightLines[1]][0],b[G.style.splineRightLines[1]][1]),z.lineTo(b[G.style.splineRightLines[2]][0],b[G.style.splineRightLines[2]][1]),z.stroke(),z.beginPath();
var D="rgba("+g[0]+","+g[1]+","+g[2]+","+k+")";
z.fillStyle=D,z.fill(),z.restore()
},renderPolygon:function(U,G,Q,I,K){var Y,L=G._coords,H=I.vertices,O=I.color?I.color:G.style.color,W=null,R=0,F=I.opacity?I.opacity:G.style.opacity,E=L[H[0]][0]*L[H[1]][1]-L[H[1]][0]*L[H[0]][1]+(L[H[1]][0]*L[H[2]][1]-L[H[2]][0]*L[H[1]][1])+(L[H[2]][0]*L[H[3]][1]-L[H[3]][0]*L[H[2]][1])+(L[H[3]][0]*L[H[0]][1]-L[H[0]][0]*L[H[3]][1]);
if(!G.style.doublesided){if(I.reversed){if(0>E){return
}}else{if(E>0){return
}}}switch(G.style.shademode){case"plain":void 0===G.style.texture&&void 0===I.texture&&(W=O[0]+","+O[1]+","+O[2]);
break;
case"lightsource":Y=this.calcNormalBrightness(Phoria.Util.averagePolyVertex(H,G._worldcoords),I._worldnormal,Q,G),(I.emit||G.style.emit)&&(R=I.emit?I.emit:G.style.emit),W=Math.min(Math.ceil(Y[0]*O[0]+O[0]*R),255)+","+Math.min(Math.ceil(Y[1]*O[1]+O[1]*R),255)+","+Math.min(Math.ceil(Y[2]*O[2]+O[1]*R),255)
}if(U.save(),void 0!==G.style.texture||void 0!==I.texture){if(I.typeText&&!I.visible){return
}var V,B,T,N,J,S,k=G.textures[void 0!==I.texture?I.texture:G.style.texture],C=function(aa,ai,ac,ae,ap,af,ab){var ah=aa[0][0],an=aa[0][1],aj=aa[1][0],P=aa[1][1],am=aa[2][0],u=aa[2][1];
U.beginPath(),U.moveTo(ah,an),U.lineTo(aj,P),U.lineTo(am,u),U.closePath(),U.clip();
var al=1/(ai*(ab-ap)-ae*ab+af*ap+(ae-af)*ac),ag=-(ac*(am-aj)-ap*am+ab*aj+(ap-ab)*ah)*al,ad=(ap*u+ac*(P-u)-ab*P+(ab-ap)*an)*al,ak=(ai*(am-aj)-ae*am+af*aj+(ae-af)*ah)*al,z=-(ae*u+ai*(P-u)-af*P+(af-ae)*an)*al,ao=(ai*(ab*aj-ap*am)+ac*(ae*am-af*aj)+(af*ap-ae*ab)*ah)*al,M=(ai*(ab*P-ap*u)+ac*(ae*u-af*P)+(af*ap-ae*ab)*an)*al;
U.transform(ag,ad,ak,z,ao,M),U.globalAlpha=F,U.drawImage(k,0,0)
};
if(null!==W){var X=0.3*Y[0]+0.6*Y[1]+0.1*Y[2];
X>1&&(X=1),U.fillStyle="rgba("+W+","+(1-X).toFixed(3)+")"
}if(3===H.length){V=0,B=0,T=k.width,N=0,J=k.width,S=k.height,void 0!==I.uvs&&(V=k.width*I.uvs[0],B=k.height*I.uvs[1],T=k.width*I.uvs[2],N=k.height*I.uvs[3],J=k.width*I.uvs[4],S=k.height*I.uvs[5]);
var D=this.inflatePolygon(H,L,0.5);
C.call(this,D,V,B,T,N,J,S),null!==W&&U.fill()
}else{if(4===H.length){V=0,B=0,T=k.width,N=0,J=k.width,S=k.height,void 0!==I.uvs&&(V=k.width*I.uvs[0],B=k.height*I.uvs[1],T=k.width*I.uvs[2],N=k.height*I.uvs[3],J=k.width*I.uvs[4],S=k.height*I.uvs[5]),U.save();
var D=this.inflatePolygon(H.slice(0,3),L,0.5);
C.call(this,D,V,B,T,N,J,S),U.restore(),V=k.width,B=k.height,T=0,N=k.height,J=0,S=0,void 0!==I.uvs&&(V=k.width*I.uvs[4],B=k.height*I.uvs[5],T=k.width*I.uvs[6],N=k.height*I.uvs[7],J=k.width*I.uvs[0],S=k.height*I.uvs[1]),U.save();
var q=new Array(3);
if(q[0]=H[2],q[1]=H[3],q[2]=H[0],D=this.inflatePolygon(q,L,0.5),C.call(this,D,V,B,T,N,J,S),U.restore(),null!==W){D=this.inflatePolygon(H,L,0.75),U.beginPath(),U.moveTo(D[0][0],D[0][1]);
for(var A=1,Z=D.length;
Z>A;
A++){U.lineTo(D[A][0],D[A][1])
}U.closePath(),U.globalAlpha=F,U.fill()
}}}}else{var D=this.inflatePolygon(H,L,0.5);
U.beginPath(),U.moveTo(D[0][0],D[0][1]);
for(var A=1;
A<D.length;
A++){U.lineTo(D[A][0],D[A][1])
}switch(U.closePath(),W="rgba("+W+","+F+")",G.style.fillmode){case"fill":U.fillStyle=W,U.fill();
break;
case"filltwice":U.fillStyle=W,U.fill(),U.fill();
break;
case"inflate":U.fillStyle=W,U.fill();
break;
case"fillstroke":if(U.fillStyle=W,U.fill(),U.fill(),W="rgba(32,32,32, "+(G.style.borderOpacity?G.style.borderOpacity:F)+")",U.strokeStyle=W,G.style.linesAll){U.beginPath(),U.linewidth=0.1,U.moveTo(L[H[0]][0],L[H[0]][1]);
for(var A=1;
A<H.length;
A++){U.lineTo(L[H[A]][0],L[H[A]][1])
}U.closePath(),U.stroke()
}else{I.noLines?"line"==G.style.chartType?(U.lineWidth=0.5,U.beginPath(),U.moveTo(L[H[0]][0],L[H[0]][1]),U.lineTo(L[H[1]][0],L[H[1]][1]),U.closePath(),U.stroke(),U.lineWidth=(I.lineDouble,0.5),U.beginPath(),U.moveTo(L[H[2]][0],L[H[2]][1]),U.lineTo(L[H[3]][0],L[H[3]][1]),U.closePath(),U.stroke()):(U.lineWidth=1,U.beginPath(),U.moveTo(L[H[2]][0],L[H[2]][1]),U.lineTo(L[H[1]][0],L[H[1]][1]),U.lineTo(L[H[0]][0],L[H[0]][1]),U.lineTo(L[H[3]][0],L[H[3]][1]),U.closePath(),U.stroke()):"bar"==G.style.chartType?(U.lineWidth=1,I.additionalLine?(U.beginPath(),U.moveTo(L[H[3]][0],L[H[3]][1]),U.lineTo(L[H[2]][0],L[H[2]][1]),U.moveTo(L[H[0]][0],L[H[0]][1]),U.lineTo(L[H[1]][0],L[H[1]][1]),U.lineTo(L[H[2]][0],L[H[2]][1]),U.stroke()):(U.beginPath(),U.moveTo(L[H[3]][0],L[H[3]][1]),U.lineTo(L[H[2]][0],L[H[2]][1]),U.stroke(),U.beginPath(),U.moveTo(L[H[2]][0],L[H[2]][1]),U.lineTo(L[H[1]][0],L[H[1]][1]),U.lineTo(L[H[0]][0],L[H[0]][1]),U.stroke())):(U.lineWidth=1,U.beginPath(),U.moveTo(L[H[0]][0],L[H[0]][1]),U.lineTo(L[H[1]][0],L[H[1]][1]),U.lineTo(L[H[2]][0],L[H[2]][1]),I.additionalLine&&U.lineTo(L[H[3]][0],L[H[3]][1]),U.stroke())
}break;
case"hiddenline":U.strokeStyle=W,U.stroke()
}}U.restore()
}})
}(),function(){Phoria.SoftwareRenderer=function(a){return Phoria.SoftwareRenderer.superclass.constructor.call(this),this.canvas=a,this.ctx=a.getContext("2d"),this._imagedata=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this._data=this._imagedata.data,this
},Phoria.Util.extend(Phoria.SoftwareRenderer,Phoria.Renderer,{canvas:null,ctx:null,_imagedata:null,_data:null,render:function(d){this.sortObjects(d),this.clearCanvasRect(0,0,this.canvas.width,this.canvas.height);
for(var b,a=0;
a<d.renderlist.length;
a++){switch(b=d.renderlist[a],b.style.drawmode){case"solid":for(var c=0,f=0;
f<b.polygons.length;
f++){this.renderPolygon(null,b,d,b.polygons[f])&&c++
}}}this.ctx.putImageData(this._imagedata,0,0,0,0,this.canvas.width,this.canvas.height)
},clearCanvasRect:function(h,m,g,b){for(var c=4*(h+m*this.canvas.width-1)+3,k=4*(this.canvas.width-(g-h)),d=this._data,p=m;
b>p;
p++){for(var f=h;
g>f;
f++){d[c+=4]=0
}c+=k
}},renderPolygon:function(p,y,k,b){for(var d=y._coords,v=y._clip,f=b.vertices,z=b.color?b.color:y.style.color,g=1,q=0;
q<f.length;
q++){g&=v[f[q]]
}var m=d[f[0]][0]*d[f[1]][1]-d[f[1]][0]*d[f[0]][1]+(d[f[1]][0]*d[f[2]][1]-d[f[2]][0]*d[f[1]][1])+(d[f[2]][0]*d[f[0]][1]-d[f[0]][0]*d[f[2]][1]);
if(!y.style.doublesided){if(b.reversed){if(0>m){return
}}else{if(m>0){return
}}}var w;
switch(y.style.shademode){case"plain":w=new Array(3),w[0]=z[0],w[1]=z[1],w[2]=z[2];
break;
case"lightsource":w=this.calcNormalBrightness(Phoria.Util.averagePolyVertex(f,y._worldcoords),b._worldnormal,k,y),w[0]=Math.ceil(Math.min(w[0]*z[0],255)),w[1]=Math.ceil(Math.min(w[1]*z[1],255)),w[2]=Math.ceil(Math.min(w[2]*z[2],255))
}return this.drawTriangle(d[f[2]][0],d[f[2]][1],d[f[1]][0],d[f[1]][1],d[f[0]][0],d[f[0]][1],w[0],w[1],w[2]),4===f.length&&this.drawTriangle(d[f[0]][0],d[f[0]][1],d[f[3]][0],d[f[3]][1],d[f[2]][0],d[f[2]][1],w[0],w[1],w[2]),!0
},drawTriangle:function(ax,aj,at,al,an,aB,ao,ak,aq){var ax=Math.round(16*ax),at=Math.round(16*at),an=Math.round(16*an),aj=Math.round(16*aj),al=Math.round(16*al),aB=Math.round(16*aB),az=ax-at,au=at-an,ai=an-ax,ah=aj-al,ay=al-aB,ae=aB-aj,aw=az<<4,ap=au<<4,am=ai<<4,av=ah<<4,K=ay<<4,af=ae<<4,aA=this.canvas.width,ag=this.canvas.height,Q=this._data,ad=Math.max(Math.min(ax,at,an)+15>>4,0),aC=Math.min(Math.max(ax,at,an)+15>>4,aA),G=Math.max(Math.min(aj,al,aB)+15>>4,0),Z=Math.min(Math.max(aj,al,aB)+15>>4,ag);
if(!(ad>=aC||G>=Z)){var F=ah*ax-az*aj,J=ay*at-au*al,ar=ae*an-ai*aB;
(0>ah||0==ah&&az>0)&&F++,(0>ay||0==ay&&au>0)&&J++,(0>ae||0==ae&&ai>0)&&ar++;
for(var D,W,ac,q,Y,X=F+az*(G<<4)-ah*(ad<<4),ab=J+au*(G<<4)-ay*(ad<<4),N=ar+ai*(G<<4)-ae*(ad<<4),aa=G;
Z>aa;
aa++){for(D=X,W=ab,ac=N,q=ad;
aC>q;
q++){D>0&&W>0&&ac>0&&(Y=q+aa*aA<<2,Q[Y]=ao,Q[Y+1]=ak,Q[Y+2]=aq,Q[Y+3]=255),D-=av,W-=K,ac-=af
}X+=aw,ab+=ap,N+=am
}}}})
}(),function(){Phoria.View={},Phoria.View.events={},Phoria.View.addMouseEvents=function(c,b){if(c.id){var a={velocityH:0,velocityLastH:0,positionX:0,clickPositionX:0,velocityV:0,velocityLastV:0,positionY:0,clickPositionY:0};
return Phoria.View.events[c.id]=a,a.onMouseMove=function(d){a.positionX=d.clientX,a.velocityH=a.velocityLastH+0.5*(a.positionX-a.clickPositionX),a.positionY=d.clientY,a.velocityV=a.velocityLastV+0.5*(a.positionY-a.clickPositionY)
},a.onMouseUp=function(d){c.removeEventListener("mousemove",a.onMouseMove,!1)
},a.onMouseOut=function(d){c.removeEventListener("mousemove",a.onMouseMove,!1)
},a.onMouseDown=function(d){d.preventDefault(),c.addEventListener("mousemove",a.onMouseMove,!1),a.clickPositionX=d.clientX,a.velocityLastH=a.velocityH,a.clickPositionY=d.clientY,a.velocityLastV=a.velocityV
},c.addEventListener("mousedown",a.onMouseDown,!1),c.addEventListener("mouseup",a.onMouseUp,!1),c.addEventListener("mouseout",a.onMouseOut,!1),c.addEventListener("mousemove",a.onMouseMove),b&&c.addEventListener("click",b,!1),a
}},Phoria.View.removeMouseEvents=function(c,b){if(c.id){var a=Phoria.View.events[c.id];
a&&(c.removeEventListener("mousemove",a.onMouseMove,!1),c.removeEventListener("mousedown",a.onMouseDown,!1),c.removeEventListener("mouseup",a.onMouseUp,!1),c.removeEventListener("mouseout",a.onMouseOut,!1),b&&c.removeEventListener("click",b,!1),Phoria.View.events[c.id]=null)
}},Phoria.View.getMouse=function(a){return Phoria.View.events[a.id]
},Phoria.View.calculateClickPointAndVector=function(p,A,k){var b=vec3.fromValues(p.camera.lookat.x,p.camera.lookat.y,p.camera.lookat.z),d=vec3.subtract(vec3.create(),p._cameraPosition,b),w=p.viewport.height/2/(vec3.length(d)*Math.tan(p.perspective.fov/180*Math.PI/2)),f=vec2.fromValues(A-p.viewport.width/2,k-p.viewport.height/2);
vec2.subtract(f,f,new vec2.fromValues(8,8));
var B=vec2.create();
vec2.scale(B,f,1/w);
var g=vec3.fromValues(p.camera.up.x,p.camera.up.y,p.camera.up.z),q=vec3.create();
vec3.cross(q,d,g),vec3.normalize(q,q);
var m=vec3.scaleAndAdd(vec3.create(),b,q,B[0]),z=vec3.create();
vec3.cross(z,q,d),vec3.normalize(z,z),vec3.scale(z,z,B[1]),vec3.subtract(m,m,z);
var y=vec3.add(vec3.create(),b,d);
return{clickPoint:m,clickVector:vec3.subtract(vec3.create(),m,y)}
},Phoria.View.getIntersectedObjects=function(q,E,m){for(var b,f,B,g,b,F=[],k=q.renderlist,z=0;
z<k.length;
z++){if(b=k[z],"solid"===b.style.drawmode){for(var p=0;
p<b.polygons.length;
p++){if(f=vec3.clone(b.polygons[p].normal),B=vec3.clone(b._worldcoords[b.polygons[p].vertices[0]]),g=Phoria.Util.planeLineIntersection(f,B,m,E),null!==g&&Phoria.Util.intersectionInsidePolygon(b.polygons[p],b._worldcoords,g)){var D={entity:b,polygonIndex:p,intersectionPoint:g};
F.push(D)
}}}}for(var C=0;
C<F.length;
C++){F[C].distance=vec3.distance(q._cameraPosition,F[C].intersectionPoint)
}for(var C=0;
C<F.length-1;
C++){for(var w,A=C+1;
A<F.length;
A++){F[C].distance>=F[A].distance&&(w=F[A],F[A]=F[C],F[C]=w)
}}return F
}
}();
var Graph3d=function(d,c,b,a){this._inited=false;
if(window.glMatrix===undefined){throw"GL Matrix is required for Graph3D to run"
}if(window.jQuery===undefined){throw"jQuery is required for Graph3D to run"
}if(window.Phoria===undefined){throw"Phoria is required for Graph3D to run"
}this._canvas=document.getElementById(d);
this._scene=null;
this._renderer=null;
this._options=$.extend(true,{chartMinValue:0,chartMaxValue:10,columnScale:1,rowScale:1,heightsScale:0.5,showEachCol:1,heightsMax:10,numberFontSize:52,chartType:"line",camera:{position:{x:15,y:30,z:-25},lookat:{x:0,y:5,z:5},perspective:15},planeStyle:{color:[230,230,230],lineWidth:0.1,opacity:1,borderColor:[128,128,128],borderOpacity:0.5,borderWidth:1},rowStyle:{size:30,family:"monospace",color:"#cc3333",hoverColor:"#000000"},columnStyle:{size:24,family:"monospace",color:"#9999cc"},heightsRightStyle:{size:50,family:"monospace",color:"#000000"},heightsLeftStyle:{size:50,family:"monospace",color:"#000000"},container:a},b);
this._chartMinValue=parseInt(this._options.chartMinValue,10);
this._chartMaxValue=parseInt(this._options.chartMaxValue,10);
if(this._options.chartLimitValue){this._chartLimitValue=this._options.chartLimitValue
}this._chartsNum=1;
this._columnLength=this._options.chartType=="line"?c.length-1:c.length;
this._columnText=c;
this._columnScale=parseFloat(this._options.columnScale);
this._rowScale=parseFloat(this._options.rowScale);
this._heightsScale=parseFloat(this._options.heightsScale);
this._showEachCol=parseInt(this._options.showEachCol,10);
this._heightsMax=parseInt(this._options.heightsMax);
this._heightsNum=Math.min(this._heightsMax,this._chartMaxValue-this._chartMinValue);
this._heightsRange=this._chartMaxValue/this._heightsNum;
this._heightsInvertValues=this._options.invertValues;
this._textFlip=false;
this._chartType=(this._options.chartType!=="line"&&this._options.chartType!=="bar"?"bar":this._options.chartType);
this._graphs=[];
this._rows=[];
this._columns=[];
this._heightsRight=[];
this._heightsLeft=[];
this._initMouseHover=false;
this._absMousePos={};
this._mouseDownPosDelta={x:0,y:0};
this._speedDelta=0.1;
this._mouseClickDelta=null;
this._hoveredGraph=-1;
this._clickGraph=-1;
this._hoverRow=-1;
this._buttonsArray=[false,false,false];
this._mouseHold=false;
this._smoothMove=null;
this._lockCursor=null;
this._onClick=false;
this._clickChartCallback=null;
this._mouseOverChartCallback=null;
this._planeStyle={color:this._options.planeStyle.color,fillmode:"fillstroke",linesAll:true,shademode:"plain",linewidth:this._options.planeStyle.lineWidth,opacity:this._options.planeStyle.opacity,objectsortmode:"back"};
this._pause=false;
this._textBufferCanvas=document.createElement("canvas");
this._txtBfrCtx=this._textBufferCanvas.getContext("2d");
this._init=function(){this._attachEventListeners();
this._scene=new Phoria.Scene();
this._scene.camera.position={x:this._options.camera.position.x,y:this._options.camera.position.y,z:this._options.camera.position.z};
this._scene.camera.lookat={x:this._options.camera.lookat.x,y:this._options.camera.lookat.y,z:this._options.camera.lookat.z};
this._scene.perspective.fov=this._options.camera.perspective;
this._scene.perspective.aspect=this._canvas.width/this._canvas.height;
this._scene.viewport.width=this._canvas.width;
this._scene.viewport.height=this._canvas.height;
this._textFlip=Math.atan2(this._scene.camera.position.x-this._scene.camera.lookat.x,(this._scene.camera.position.z-this._scene.camera.lookat.z)*-1)*180/Math.PI>45;
this._renderer=new Phoria.CanvasRenderer(this._canvas);
this._drawPlanes();
this._drawHeightsRight()
};
this.start=function(){this._animationStep();
setTimeout(function(){this._initMouseHover=true
}.bind(this),0);
this._inited=true
};
this.bindClick=function(f){this._clickChartCallback=f
};
this.bindMouseOver=function(f){this._mouseOverChartCallback=f
};
this.draw=function(l){var k,h;
for(var g=0;
g<this._graphs.length;
g++){this._removeFromScene(this._graphs[g].graphId)
}this._graphs=[];
for(var g=0;
g<l.length;
g++){if(l[g].data[0]!==null&&typeof l[g].data[0]==="object"){for(var f=0;
f<l[g].data.length;
f++){h={color:l[g].style.color&&l[g].style.color[f],sectorColor:l[g].style.sectorColor&&l[g].style.sectorColor[f],numberColor:l[g].style.numberColor&&l[g].style.numberColor[f],sectorNumberColor:l[g].style.sectorNumberColor};
k={num:g,name:l[g].title,data:l[g].data[f],lowData:l[g].data[f+1]?l[g].data[f+1]:null,parentChart:f==0?false:true,cData:this._generateGraph(l[g].data[f],g,h,l[g].data[f+1]?l[g].data[f+1]:null,f==0?false:true,this._textFlip),style:h,graphId:this._scene.graph.length};
k.cData.translateX(-5).translateZ(1);
k.cData.id="graph."+g;
this._graphs.push(k);
this._scene.graph.push(k.cData)
}}else{k={num:g,name:l[g].title,data:l[g].data,cData:this._generateGraph(l[g].data,g,l[g].style,null,false,this._textFlip),style:l[g].style,graphId:this._scene.graph.length};
k.cData.translateX(-5).translateZ(1);
k.cData.id="graph."+g;
this._graphs.push(k);
this._scene.graph.push(k.cData)
}}this._countCharts();
this._drawPlanes();
this._drawRows();
this._drawColumns();
this._drawHeightsLeft()
};
this.drawText=function(o,m,l,k,n,h,g){var f={};
f.title=m;
f.hovered=false;
f.textStyle={size:n||40,family:g||"monospace",color:h||"#000000",hoverColor:h||"#000000"};
f.text=this._generateTextureFromText(f.title,f.textStyle,false);
f.obj=Phoria.Entity.create({id:o,points:this._alignToGrid([{x:l.x,y:l.y,z:0},{x:k?l.x:l.x+f.text.xWidth,y:l.y,z:k?l.x-f.text.xWidth:0},{x:k?l.x:l.x+f.text.xWidth,y:l.y-f.text.xHeight,z:k?l.x-f.text.xWidth:0},{x:l.x,y:l.y-f.text.xHeight,z:0}]),edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0}],polygons:[{vertices:[0,1,2,3],reversed:true}],style:{shademode:"plain",objectsortmode:"front"}});
f.obj.textures.push(f.text.img);
f.obj.polygons[0].texture=0;
this._scene.graph.push(f.obj)
};
this.removeText=function(g){var f=this._findObjectById(g);
if(f){this._removeFromScene(f)
}};
this._findGraphByNum=function(f,k){var h=0;
k=k===null||k===undefined?0:k;
for(var g=0;
g<this._graphs.length;
g++){if(this._graphs[g].num===f){if(h==k){return g
}else{h++
}}}return null
};
this._findObjectById=function(g){for(var f=0;
f<this._scene.graph.length;
f++){if(this._scene.graph[f].id&&this._scene.graph[f].id==g){return f
}}return null
};
this._removeFromScene=function(g){var f;
for(f=0;
f<this._graphs.length;
f++){if(this._graphs[f].graphId>g){this._graphs[f].graphId--
}}for(f=0;
f<this._rows.length;
f++){if(this._rows[f].textId>g){this._rows[f].textId--
}}this._scene.graph.splice(g,1)
};
this._countCharts=function(){var f=0;
for(var g=0;
g<this._graphs.length;
g++){if(!this._graphs[g].parentChart){f++
}}this._chartsNum=f
};
this._drawPlanes=function(){var l=Phoria.Entity.create($.extend({id:"planeFloor",style:this._planeStyle},Phoria.Util.generatePlane(this._columnLength,2*this._chartsNum-1,this._columnScale,this._rowScale,this._alignToGrid({x:0,z:this._chartsNum*this._rowScale*2-1*this._rowScale}),2)));
var o=Phoria.Entity.create($.extend({id:"planeLeft",style:this._planeStyle},Phoria.Util.generatePlane(this._chartsNum*2-1,this._heightsNum,this._rowScale,this._heightsScale,this._alignToGrid({y:0,z:this._chartsNum*this._rowScale*2-1*this._rowScale}),1)));
var k=Phoria.Entity.create($.extend({id:"planeRight",style:this._planeStyle},Phoria.Util.generatePlane(this._columnLength,this._heightsNum,this._columnScale,this._heightsScale,this._alignToGrid({y:0,z:0,x:0}),0)));
var n=Phoria.Entity.create({id:"planeBorders",points:this._alignToGrid([{x:0,y:0,z:this._chartsNum*this._rowScale*2-1*this._rowScale},{x:0,y:0,z:0},{x:this._columnScale*this._columnLength,y:0,z:this._chartsNum*this._rowScale*2-1*this._rowScale},{x:this._columnScale*this._columnLength,y:0,z:0},{x:0,y:this._heightsNum*this._heightsScale,z:this._chartsNum*this._rowScale*2-1*this._rowScale},{x:0,y:this._heightsNum*this._heightsScale,z:0},{x:this._columnScale*this._columnLength,y:this._heightsNum*this._heightsScale,z:0}]),edges:[{a:0,b:1},{a:0,b:2},{a:1,b:3},{a:3,b:2},{a:4,b:0},{a:1,b:5},{a:4,b:5},{a:6,b:5},{a:6,b:3}],style:{color:this._options.planeStyle.borderColor,drawmode:"wireframe",shademode:"plain",linewidth:this._options.planeStyle.borderWidth,linescale:1,opacity:this._options.planeStyle.borderOpacity,objectsortmode:"back"}});
var g=this._findObjectById("planeFloor"),h=this._findObjectById("planeLeft"),f=this._findObjectById("planeRight"),m=this._findObjectById("planeBorders");
if(g!==null){this._scene.graph[g]=l
}else{this._scene.graph.push(l)
}if(h!==null){this._scene.graph[h]=o
}else{this._scene.graph.push(o)
}if(f!==null){this._scene.graph[f]=k
}else{this._scene.graph.push(k)
}if(m!==null){this._scene.graph[m]=n
}else{this._scene.graph.push(n)
}};
this._drawRows=function(){for(var g=0;
g<this._chartsNum;
g++){this._rows[g]={};
this._rows[g].title=this._graphs[g].name;
this._rows[g].num=g;
this._rows[g].hovered=false;
this._rows[g].textStyle={size:Math.max(14,this._options.rowStyle.size*this._rowScale),family:this._options.rowStyle.family,color:this._options.rowStyle.color,hoverColor:this._options.rowStyle.hoverColor};
this._rows[g].text=this._generateTextureFromText(this._rows[g].title,this._rows[g].textStyle,this._rows[g].hovered);
this._rows[g].obj=Phoria.Entity.create({id:"row."+g,points:this._alignToGrid([{x:this._columnLength*this._columnScale+0.1,y:0,z:g*this._rowScale*2+0.3*this._rowScale},{x:this._columnLength*this._columnScale+0.1+this._rows[g].text.xWidth,y:0,z:g*this._rowScale*2+0.3*this._rowScale},{x:this._columnLength*this._columnScale+0.1+this._rows[g].text.xWidth,y:0,z:this._rows[g].text.xHeight+g*this._rowScale*2+0.3*this._rowScale},{x:this._columnLength*this._columnScale+0.1,y:0,z:this._rows[g].text.xHeight+g*this._rowScale*2+0.3*this._rowScale}]),edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0}],polygons:[{vertices:[0,1,2,3],reversed:true}],style:{shademode:"plain"}});
this._rows[g].obj.textures.push(this._rows[g].text.img);
this._rows[g].obj.polygons[0].texture=0;
var f=this._findObjectById("row."+g);
if(f!==null){this._scene.graph[f]=this._rows[g].obj;
this._rows[g].textId=f
}else{this._scene.graph.push(this._rows[g].obj);
this._rows[g].textId=this._scene.graph.length-1
}}};
this._drawColumns=function(){for(var g=0;
g<=(this._chartType=="bar"?this._columnLength-1:this._columnLength);
g++){var h=this._chartType=="bar"?0.35*this._columnScale:-0.08*this._columnScale;
if(this._showEachCol>0&&g%this._showEachCol!=0){continue
}this._columns[g]={};
this._columns[g].title=this._columnText[g];
this._columns[g].num=g;
this._columns[g].hovered=false;
this._columns[g].textStyle={size:Math.max(14,this._options.columnStyle.size*this._rowScale),family:this._options.columnStyle.family,color:this._options.columnStyle.color,hoverColor:this._options.columnStyle.hoverColor,rotateSquare:true,mirror:"both"};
this._columns[g].text=this._generateTextureFromText(this._columns[g].title,this._columns[g].textStyle,this._columns[g].hovered,true);
this._columns[g].obj=Phoria.Entity.create({id:"column."+g,points:this._alignToGrid([{x:h+g*this._columnScale,y:0,z:this._chartsNum*2*this._rowScale-this._rowScale+0.1},{x:h+g*this._columnScale+this._columns[g].text.xHeight,y:0,z:this._chartsNum*2*this._rowScale-this._rowScale+0.1},{x:h+g*this._columnScale+this._columns[g].text.xHeight,y:0,z:this._chartsNum*2*this._rowScale-this._rowScale+0.1+this._columns[g].text.xWidth},{x:h+g*this._columnScale,y:0,z:this._chartsNum*2*this._rowScale-this._rowScale+0.1+this._columns[g].text.xWidth}]),edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0}],polygons:[{vertices:[0,1,2,3],reversed:true}],style:{shademode:"plain"}});
this._columns[g].obj.textures.push(this._columns[g].text.img);
this._columns[g].obj.polygons[0].texture=0;
var f=this._findObjectById("column."+g);
if(f!==null){this._scene.graph[f]=this._columns[g].obj;
this._columns[g].textId=f
}else{this._scene.graph.push(this._columns[g].obj);
this._columns[g].textId=this._scene.graph.length-1
}}};
this._drawHeightsRight=function(){for(var f=0;
f<=this._heightsNum;
f++){this._heightsRight[f]={};
this._heightsRight[f].title=this._heightsInvertValues?(this._chartMaxValue-(this._heightsRange*f)):(this._heightsRange*f);
this._heightsRight[f].num=f;
this._heightsRight[f].hovered=false;
this._heightsRight[f].textStyle={size:this._options.heightsRightStyle.size*this._heightsScale,family:this._options.heightsRightStyle.family,color:this._options.heightsRightStyle.color};
this._heightsRight[f].text=this._generateTextureFromText(this._heightsRight[f].title,this._heightsRight[f].textStyle,this._heightsRight[f].hovered);
this._heightsRight[f].obj=Phoria.Entity.create({id:"heightRight."+f,points:this._alignToGrid([{x:this._columnLength*this._columnScale+0.2,y:this._heightsRight[f].text.xHeight+this._heightsScale*f,z:0},{x:this._columnLength*this._columnScale+0.2+this._heightsRight[f].text.xWidth,y:this._heightsRight[f].text.xHeight+this._heightsScale*f,z:0},{x:this._columnLength*this._columnScale+0.2+this._heightsRight[f].text.xWidth,y:this._heightsRight[f].text.xHeight+this._heightsScale*f-this._heightsRight[f].text.xHeight,z:0},{x:this._columnLength*this._columnScale+0.2,y:this._heightsRight[f].text.xHeight+this._heightsScale*f-this._heightsRight[f].text.xHeight,z:0}]),edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0}],polygons:[{vertices:[0,1,2,3],reversed:true}],style:{shademode:"plain",objectsortmode:"back"}});
this._heightsRight[f].obj.textures.push(this._heightsRight[f].text.img);
this._heightsRight[f].obj.polygons[0].texture=0;
this._scene.graph.push(this._heightsRight[f].obj);
this._heightsRight[f].textId=this._scene.graph.length-1
}};
this._drawHeightsLeft=function(){for(var g=0;
g<=this._heightsNum;
g++){this._heightsLeft[g]={};
this._heightsLeft[g].title=this._heightsInvertValues?(this._chartMaxValue-(this._heightsRange*g)):(this._heightsRange*g);
this._heightsLeft[g].num=g;
this._heightsLeft[g].hovered=false;
this._heightsLeft[g].textStyle={size:this._options.heightsLeftStyle.size*this._heightsScale,family:this._options.heightsLeftStyle.family,color:this._options.heightsLeftStyle.color};
this._heightsLeft[g].text=this._generateTextureFromText(this._heightsLeft[g].title,this._heightsLeft[g].textStyle,this._heightsLeft[g].hovered);
this._heightsLeft[g].obj=Phoria.Entity.create({id:"heightLeft."+g,points:this._alignToGrid([{x:-this._heightsLeft[g].text.xWidth-0.2,y:this._heightsLeft[g].text.xHeight+this._heightsScale*g,z:this._chartsNum*this._rowScale*2-this._rowScale},{x:-0.2,y:this._heightsLeft[g].text.xHeight+this._heightsScale*g,z:this._chartsNum*this._rowScale*2-this._rowScale},{x:-0.2,y:this._heightsLeft[g].text.xHeight+this._heightsScale*g-this._heightsLeft[g].text.xHeight,z:this._chartsNum*this._rowScale*2-this._rowScale},{x:-this._heightsLeft[g].text.xWidth-0.2,y:this._heightsLeft[g].text.xHeight+this._heightsScale*g-this._heightsLeft[g].text.xHeight,z:this._chartsNum*this._rowScale*2-this._rowScale}]),edges:[{a:0,b:1},{a:1,b:2},{a:2,b:3},{a:3,b:0}],polygons:[{vertices:[0,1,2,3],reversed:true}],style:{shademode:"plain",objectsortmode:"back"}});
this._heightsLeft[g].obj.textures.push(this._heightsLeft[g].text.img);
this._heightsLeft[g].obj.polygons[0].texture=0;
var f=this._findObjectById("heightLeft."+g);
if(f!==null){this._scene.graph[f]=this._heightsLeft[g].obj;
this._heightsLeft[g].textId=f
}else{this._scene.graph.push(this._heightsLeft[g].obj);
this._heightsLeft[g].textId=this._scene.graph.length-1
}}};
this._generateGraph=function(G,m,C,A,r,o){var s=-5;
var y=[],l=[],F=[],z=0,w=0;
var B=$.extend({},C);
if(this._chartType=="bar"){var q=[];
for(z=0;
z<G.length;
z++){q.push(G[z]);
q.push(G[z])
}if(B.sectorColor){var D=[];
for(z=0;
z<B.sectorColor.length;
z++){D.push(B.sectorColor[z]);
D.push(B.sectorColor[z])
}B.sectorColor=D
}if(B.sectorNumberColor){var h=[];
for(z=0;
z<B.sectorNumberColor.length;
z++){h.push(B.sectorNumberColor[z]);
h.push(B.sectorNumberColor[z])
}B.sectorNumberColor=h
}if(A){var E=[];
for(z=0;
z<A.length;
z++){E.push(A[z]);
E.push(A[z])
}A=E
}G=q
}for(z=0;
z<G.length;
z++){y.push({x:s,y:this._getScaledVal(G[z]),z:m*this._rowScale*-2+9-this._rowScale+this._rowScale});
y.push({x:s,y:A?this._getScaledVal(A[z]):0,z:m*this._rowScale*-2+9-this._rowScale+this._rowScale});
w=w>0?w+2:w+1;
if(this._chartType!="bar"||z%2==0){s+=this._columnScale
}}s=-5;
w=0;
var v=G.length*2;
for(z=0;
z<G.length;
z++){y.push({x:s,y:this._getScaledVal(G[z]),z:m*this._rowScale*-2+9-this._rowScale});
y.push({x:s,y:A?this._getScaledVal(A[z]):0,z:m*this._rowScale*-2+9-this._rowScale});
var u=B.sectorColor&&B.sectorColor[z]?B.sectorColor[z]:B.color||"#000000";
if(w>0){v++;
w++;
if(this._chartType!="bar"||z%2!=0){if(!r){F.push({vertices:[v-2,w-2,w,v],color:this._increase_brightness(u,25),zindex:F.length,reversed:true,height:this._getScaledVal(G[z])||0});
if(this._chartType=="bar"&&z<G.length-1){F.push({vertices:[v,w,w+2,v+2],color:this._increase_brightness(u,25),zindex:F.length,reversed:true})
}}if(this._getScaledVal(G[z])>0){F.push({vertices:[w+1,w-1,w-2,w],color:u,noLines:true,zindex:F.length})
}F.push({vertices:[v,v-2,v-1,v+1],color:u,noLines:true,zindex:F.length})
}}v++;
w++;
if(this._chartType!="bar"||z%2==0){s+=this._columnScale
}}F.push({vertices:[v,v-1,w-1,w],reversed:true,color:this._increase_brightness(u,25),zindex:200*F.length,additionalLine:true});
var g=y.length;
var f=[];
s=-5+this._columnScale;
for(w=1;
w<G.length;
w++){var t;
if(this._chartType=="bar"){if(w%2==0){continue
}t=g+(w-1)/2*4
}else{t=g+(w-1)*4
}f.push({data:this._generateTextureFromText(roundNumber(this._heightsInvertValues?(this._chartMaxValue-G[w]):G[w],1),{size:this._options.numberFontSize,family:"monospace",color:this._rgbToHex(B.sectorNumberColor&&B.sectorNumberColor[w]?B.sectorNumberColor[w]:B.numberColor||[0,0,0]),hoverColor:"#000000",rotateSquare:true,mirror:"vertical"},false),points:[t,t+1,t+2,t+3]});
if(!r){if(o){y.push({x:this._chartType=="bar"?s-this._columnScale/2-f[f.length-1].data.xWidth/2:s-f[f.length-1].data.xWidth/2,y:0.45+this._getScaledVal(G[w])+f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2});
y.push({x:this._chartType=="bar"?s-this._columnScale/2-f[f.length-1].data.xWidth/2:s-f[f.length-1].data.xWidth/2,y:0.45+this._getScaledVal(G[w])-f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2});
y.push({x:this._chartType=="bar"?s-this._columnScale/2+f[f.length-1].data.xWidth/2:s+f[f.length-1].data.xWidth/2,y:0.45+this._getScaledVal(G[w])-f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2});
y.push({x:this._chartType=="bar"?s-this._columnScale/2+f[f.length-1].data.xWidth/2:s+f[f.length-1].data.xWidth/2,y:0.45+this._getScaledVal(G[w])+f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2})
}else{y.push({x:this._chartType=="bar"?s-this._columnScale/2:s,y:0.45+this._getScaledVal(G[w])+f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2-f[f.length-1].data.xWidth/2});
y.push({x:this._chartType=="bar"?s-this._columnScale/2:s,y:0.45+this._getScaledVal(G[w])-f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2-f[f.length-1].data.xWidth/2});
y.push({x:this._chartType=="bar"?s-this._columnScale/2:s,y:0.45+this._getScaledVal(G[w])-f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2+f[f.length-1].data.xWidth/2});
y.push({x:this._chartType=="bar"?s-this._columnScale/2:s,y:0.45+this._getScaledVal(G[w])+f[f.length-1].data.xHeight/2,z:m*this._rowScale*-2+9-this._rowScale/2+f[f.length-1].data.xWidth/2})
}F.push({vertices:[t,t+1,t+2,t+3],zindex:this._chartType=="bar"?w*2:w*3,typeText:true,visible:false})
}F[F.length-1].texture=f.length-1;
s+=this._columnScale
}var n=[];
for(z=0;
z<f.length;
z++){n.push(f[z].data.img)
}return Phoria.Entity.create({points:y,edges:l,polygons:F,textures:n,texts:f,style:$.extend({chartType:this._chartType,fillmode:"fillstroke",shademode:"plain",hover:false,objectsortmode:"custom",zindex:-1*(5*m+(r?+1:0))},B)})
};
this._animationStep=function(l){var m,n,p,o,u,r;
if(!this._pause){if(this._initMouseHover){var t=Phoria.View.calculateClickPointAndVector(this._scene,this._absMousePos.x,this._absMousePos.y);
var g=Phoria.View.getIntersectedObjects(this._scene,t.clickPoint,t.clickVector);
this._hoveredGraph=-1;
this._hoverRow=-1;
if(!this._mouseHold){for(m=0;
m<g.length;
m++){r=g[m].entity.id?g[m].entity.id.split("."):[-1,-1];
if(r[0]==="graph"){this._hoveredGraph=r[1];
this._hoverRow=r[1]
}else{if(r[0]==="row"){this._hoveredGraph=r[1];
this._hoverRow=r[1]
}}}}if(this._onClick){if(this._clickChartCallback){this._clickChartCallback(this._hoveredGraph,[this._absMousePos.x,this._absMousePos.y])
}this._onClick=false
}if(this._clickChartCallback){this._mouseOverChartCallback(this._hoveredGraph,[this._absMousePos.x,this._absMousePos.y])
}}if(!this._mouseHold){for(n=0;
n<this._graphs.length;
n++){o=this._graphs[n];
var q=this._clickGraph==o.num||this._hoveredGraph==o.num;
var f=(this._clickGraph>=0||this._hoveredGraph>=0)&&!q;
for(var h=0;
h<o.cData.polygons.length;
h++){if(o.cData.polygons[h].typeText){o.cData.polygons[h].visible=q
}}o.cData.style.opacity=q?1:f?0.03:0.5;
o.cData.style.borderOpacity=q?1:f?0.03:1;
o.cData.style.hover=q;
this._scene.graph[o.graphId]=o.cData
}}for(n=0;
n<this._rows.length;
n++){var s=!(l||this._options.container&&this._options.container.suppressHighlightRow&&this._options.container.suppressHighlightRow())&&this._hoverRow==this._rows[n].num;
if(this._rows[n].hovered&&!s){this._rows[n].hovered=false;
this._rows[n].text=this._generateTextureFromText(this._rows[n].title,this._rows[n].textStyle,this._rows[n].hovered);
this._rows[n].obj.textures[0]=this._rows[n].text.img;
this._scene.graph[this._rows[n].textId]=this._rows[n].obj
}else{if(!this._rows[n].hovered&&s){this._rows[n].hovered=true;
this._rows[n].text=this._generateTextureFromText(this._rows[n].title,this._rows[n].textStyle,this._rows[n].hovered);
this._rows[n].obj.textures[0]=this._rows[n].text.img;
this._scene.graph[this._rows[n].textId]=this._rows[n].obj
}}}if(Math.atan2(this._scene.camera.position.x-this._scene.camera.lookat.x,(this._scene.camera.position.z-this._scene.camera.lookat.z)*-1)*180/Math.PI<45){if(!this._textFlip){this._textFlip=true;
for(n=0;
n<this._heightsRight.length;
n++){this._heightsRight[n].obj.points=this._alignToGrid([{x:this._columnLength*this._columnScale+0.2,y:this._heightsRight[n].text.xHeight+this._heightsScale*n,z:0},{x:this._columnLength*this._columnScale+0.2+this._heightsRight[n].text.xWidth,y:this._heightsRight[n].text.xHeight+this._heightsScale*n,z:0},{x:this._columnLength*this._columnScale+0.2+this._heightsRight[n].text.xWidth,y:this._heightsRight[n].text.xHeight+this._heightsScale*n-this._heightsRight[n].text.xHeight,z:0},{x:this._columnLength*this._columnScale+0.2,y:this._heightsRight[n].text.xHeight+this._heightsScale*n-this._heightsRight[n].text.xHeight,z:0}])
}for(n=0;
n<this._heightsLeft.length;
n++){this._heightsLeft[n].obj.points=this._alignToGrid([{x:-this._heightsLeft[n].text.xWidth-0.2,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n,z:this._chartsNum*this._rowScale*2-this._rowScale},{x:-0.2,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n,z:this._chartsNum*this._rowScale*2-this._rowScale},{x:-0.2,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n-this._heightsLeft[n].text.xHeight,z:this._chartsNum*this._rowScale*2-this._rowScale},{x:-this._heightsLeft[n].text.xWidth-0.2,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n-this._heightsLeft[n].text.xHeight,z:this._chartsNum*this._rowScale*2-this._rowScale}])
}for(n=0;
n<this._graphs.length;
n++){o=this._graphs[n];
if(!o.parentChart){p=-5+this._columnScale;
for(m=0;
m<o.cData.texts.length;
m++){o.cData.points[o.cData.texts[m].points[0]].x=this._chartType=="bar"?p-this._columnScale/2-o.cData.texts[m].data.xWidth/2:p-o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[0]].z=n*this._rowScale*-2+9-this._rowScale/2;
o.cData.points[o.cData.texts[m].points[1]].x=this._chartType=="bar"?p-this._columnScale/2-o.cData.texts[m].data.xWidth/2:p-o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[1]].z=n*this._rowScale*-2+9-this._rowScale/2;
o.cData.points[o.cData.texts[m].points[2]].x=this._chartType=="bar"?p-this._columnScale/2+o.cData.texts[m].data.xWidth/2:p+o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[2]].z=n*this._rowScale*-2+9-this._rowScale/2;
o.cData.points[o.cData.texts[m].points[3]].x=this._chartType=="bar"?p-this._columnScale/2+o.cData.texts[m].data.xWidth/2:p+o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[3]].z=n*this._rowScale*-2+9-this._rowScale/2;
p+=this._columnScale
}}}}}else{if(this._textFlip){this._textFlip=false;
for(n=0;
n<this._heightsRight.length;
n++){this._heightsRight[n].obj.points=this._alignToGrid([{x:this._columnLength*this._columnScale,y:this._heightsRight[n].text.xHeight+this._heightsScale*n,z:-0.2},{x:this._columnLength*this._columnScale,y:this._heightsRight[n].text.xHeight+this._heightsScale*n,z:-this._heightsRight[n].text.xWidth-0.2},{x:this._columnLength*this._columnScale,y:this._heightsRight[n].text.xHeight+this._heightsScale*n-this._heightsRight[n].text.xHeight,z:-this._heightsRight[n].text.xWidth-0.2},{x:this._columnLength*this._columnScale,y:this._heightsRight[n].text.xHeight+this._heightsScale*n-this._heightsRight[n].text.xHeight,z:-0.2}])
}for(n=0;
n<this._heightsLeft.length;
n++){this._heightsLeft[n].obj.points=this._alignToGrid([{x:0,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n,z:this._chartsNum*this._rowScale*2-this._rowScale+this._heightsLeft[n].text.xWidth+0.2},{x:0,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n,z:this._chartsNum*this._rowScale*2-this._rowScale+0.2},{x:0,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n-this._heightsLeft[n].text.xHeight,z:this._chartsNum*this._rowScale*2-this._rowScale+0.2},{x:0,y:this._heightsLeft[n].text.xHeight+this._heightsScale*n-this._heightsLeft[n].text.xHeight,z:this._chartsNum*this._rowScale*2-this._rowScale+this._heightsLeft[n].text.xWidth+0.2}])
}for(n=0;
n<this._graphs.length;
n++){o=this._graphs[n];
if(!o.parentChart){p=-5+this._columnScale;
for(m=0;
m<o.cData.texts.length;
m++){o.cData.points[o.cData.texts[m].points[0]].x=this._chartType=="bar"?p-this._columnScale/2:p;
o.cData.points[o.cData.texts[m].points[0]].z=n*this._rowScale*-2+9-this._rowScale/2-o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[1]].x=this._chartType=="bar"?p-this._columnScale/2:p;
o.cData.points[o.cData.texts[m].points[1]].z=n*this._rowScale*-2+9-this._rowScale/2-o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[2]].x=this._chartType=="bar"?p-this._columnScale/2:p;
o.cData.points[o.cData.texts[m].points[2]].z=n*this._rowScale*-2+9-this._rowScale/2+o.cData.texts[m].data.xWidth/2;
o.cData.points[o.cData.texts[m].points[3]].x=this._chartType=="bar"?p-this._columnScale/2:p;
o.cData.points[o.cData.texts[m].points[3]].z=n*this._rowScale*-2+9-this._rowScale/2+o.cData.texts[m].data.xWidth/2;
p+=this._columnScale
}}}}}this._scene.modelView();
this._renderer.render(this._scene)
}};
this._getScaledVal=function(f){if(this._chartLimitValue&&f>this._chartLimitValue){f=this._chartLimitValue
}return(f-this._chartMinValue)/this._chartMaxValue*this._heightsNum*this._heightsScale
};
this._increase_brightness=function(f,g){return[Math.round(Math.min(255,f[0]*(1+g/100))),Math.round(Math.min(255,f[1]*(1+g/100))),Math.round(Math.min(255,f[2]*(1+g/100)))]
};
this._rgbToHex=function(f){return"#"+((1<<24)+(f[0]<<16)+(f[1]<<8)+f[2]).toString(16).slice(1)
};
this._generateTextureFromText=function(u,f,n,t){var q=u+"";
if(t){while(q.length<7){q=f.align=="right"?" "+q:q+" "
}}var v=f.size;
var g=f.family;
var k=n?f.hoverColor:f.color;
var m=f.rotateSquare;
var s=f.mirror;
this._txtBfrCtx.save();
this._txtBfrCtx.font=v+"px "+g;
var p=this._txtBfrCtx.measureText(q).width;
if(m){this._textBufferCanvas.width=v+v*0.2;
this._textBufferCanvas.height=Math.floor(p)
}else{if(s){this._textBufferCanvas.width=Math.floor(p);
this._textBufferCanvas.height=v+v*0.2
}else{this._textBufferCanvas.width=Math.floor(p);
this._textBufferCanvas.height=v+v*0.2
}}this._txtBfrCtx.fillStyle=k;
this._txtBfrCtx.textAlign="center";
this._txtBfrCtx.textBaseline="top";
this._txtBfrCtx.font=v+"px "+g;
p=this._txtBfrCtx.measureText(q).width;
var o=p/2;
var h=0;
if(m){if(s=="both"){this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.scale(-1,-1);
this._txtBfrCtx.rotate(90*Math.PI/180);
o=-p/2;
h=-v-v*0.2
}else{if(s=="horizontal"){this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.scale(1,-1);
this._txtBfrCtx.rotate(90*Math.PI/180);
o=-p/2;
h=0
}else{if(s=="vertical"){this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.scale(-1,1);
this._txtBfrCtx.rotate(90*Math.PI/180);
o=p/2;
h=-p/4
}else{this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.rotate(90*Math.PI/180);
o=p/2;
h=0
}}}}else{if(s=="both"){this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.scale(-1,-1);
o=-p/4;
h=-v-v*0.2
}else{if(s=="horizontal"){this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.scale(1,-1);
o=p/4;
h=-v
}else{if(s=="vertical"){this._txtBfrCtx.translate(p/4,0);
this._txtBfrCtx.scale(-1,1);
o=-p/4;
h=0
}else{this._txtBfrCtx.translate(p/4,0);
o=p/4;
h=0
}}}}this._txtBfrCtx.shadowColor="black";
this._txtBfrCtx.shadowOffsetX=0;
this._txtBfrCtx.shadowOffsetY=0;
this._txtBfrCtx.shadowBlur=1;
this._txtBfrCtx.fillText(q,o,h);
var r=this._textBufferCanvas.toDataURL("image/png");
var l=new Image();
l.src=r;
this._txtBfrCtx.restore();
return{img:l,xWidth:(p/18)/5,xHeight:v*0.0125}
};
this._alignToGrid=function(k){var l={x:-10,y:0,z:10};
var h=[],g;
if(k.constructor===Array){for(var f=0;
f<k.length;
f++){g=$.extend({x:0,y:0,z:0},k);
h.push({x:g[f].x+l.x,y:g[f].y+l.y,z:(g[f].z*-1+l.z)})
}}else{g=$.extend({x:0,y:0,z:0},k);
h={x:g.x+l.x,y:g.y+l.y,z:(g.z*-1+l.z)}
}return h
};
this._smoothMoveCameraLookAt=function(h,n){var f=false,o=false,m=this._speedDelta*1.6;
var l=n[0]>h.x?n[0]-h.x:h.x-n[0];
var k=n[2]>h.z?n[2]-h.z:h.z-n[2];
var g=l+k;
m*=Math.max(1,Math.min(1.6,g/5));
clearTimeout(this._smoothMove);
if(Math.abs(h.x-n[0])>0.5){if(h.x>n[0]){h.x-=m;
f=true
}else{h.x+=m;
f=true
}}if(Math.abs(h.z-n[2])>0.5){if(h.z>n[2]){h.z-=m;
o=true
}else{h.z+=m;
o=true
}}if(f||o){this._smoothMove=setTimeout(this._smoothMoveCameraLookAt.bind(this,h,n),16)
}};
this._attachEventListeners=function(){this._canvas.oncontextmenu=this._oncontextmenu.bind(this);
this._canvas.addEventListener("mousedown",this._onmousedown.bind(this),false);
this._canvas.addEventListener("mouseup",this._onmouseup.bind(this),false);
this._canvas.addEventListener("mousemove",this._onmousemove.bind(this),false);
this._canvas.addEventListener("mouseout",this._onmouseout.bind(this),false);
this._canvas.addEventListener("wheel",this._onwheel.bind(this))
};
this._oncontextmenu=function(){if(!this._inited){return
}return false
};
this._onmousedown=function(f){if(!this._inited){return
}this._buttonsArray[f.button]=true;
this._mouseClickDelta=new Date().getTime()+150;
clearTimeout(this._smoothMove);
this._lockCursor=setTimeout(function(){this._mouseHold=true;
this._canvas.requestPointerLock=this._canvas.requestPointerLock||this._canvas.mozRequestPointerLock||this._canvas.webkitRequestPointerLock;
this._canvas.requestPointerLock()
}.bind(this),50);
this._animationStep()
};
this._onmouseup=function(g){if(!this._inited){return
}this._buttonsArray[g.button]=false;
this._mouseHold=false;
clearTimeout(this._lockCursor);
if(g.target==this._canvas){if(havePointerLock){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;
document.exitPointerLock()
}if(g.button==0){var h=$(this._canvas).offset();
var f=Phoria.View.calculateClickPointAndVector(this._scene,g.pageX-h.left,g.pageY-h.top);
this._onClick=true
}}this._animationStep()
};
this._onmousemove=function(p){var q,o,n;
if(!this._inited){return
}var m=$(this._canvas).offset();
this._absMousePos.x=p.pageX-m.left;
this._absMousePos.y=p.pageY-m.top;
this._mouseDownPosDelta.x=p.movementX;
this._mouseDownPosDelta.y=p.movementY;
if(this._buttonsArray[0]){var t=Math.abs(Math.atan2((this._scene.camera.position.y-this._scene.camera.lookat.y)*-1,(this._scene.camera.position.z-this._scene.camera.lookat.z)*-1)*180/Math.PI);
var l=Math.abs(Math.atan2((this._scene.camera.position.x-this._scene.camera.lookat.x)*-1,(this._scene.camera.position.z-this._scene.camera.lookat.z)*-1)*180/Math.PI);
q=this._scene.camera.position.x-this._mouseDownPosDelta.x*this._speedDelta*Math.abs(1-l/90);
o=this._scene.camera.position.y+(this._mouseDownPosDelta.y*this._speedDelta*Math.abs(1-t/90))+(this._mouseDownPosDelta.y*this._speedDelta*(t/90));
n=this._scene.camera.position.z+(this._mouseDownPosDelta.y*this._speedDelta*(t/90)*Math.abs(1-(l/90)))+(this._mouseDownPosDelta.y*this._speedDelta*Math.abs(1-t/90)*((l/90)))-(this._mouseDownPosDelta.x*this._speedDelta*(l/90));
if(o>70&&o>this._scene.camera.position.y){o=this._scene.camera.position.y;
n=this._scene.camera.position.z
}else{if(o<0&&o<this._scene.camera.position.y){o=this._scene.camera.position.y;
n=this._scene.camera.position.z
}}if(q>50&&q>this._scene.camera.position.x){q=this._scene.camera.position.x
}else{if(q<-50&&q<this._scene.camera.position.x){q=this._scene.camera.position.x
}}if(q-this._scene.camera.lookat.x<0){if(q<this._scene.camera.position.x){q=this._scene.camera.position.x
}}if(n-this._scene.camera.lookat.z<-60||n-this._scene.camera.lookat.z>-1){n=this._scene.camera.position.z
}this._scene.camera.position.x=q;
this._scene.camera.position.y=o;
this._scene.camera.position.z=n
}if(this._buttonsArray[2]){var s=this._mouseDownPosDelta.x*this._speedDelta*0.5;
var r=this._mouseDownPosDelta.y*this._speedDelta*0.5;
var u=Math.atan2(this._scene.camera.position.x-this._scene.camera.lookat.x,(this._scene.camera.position.z-this._scene.camera.lookat.z)*-1)*180/Math.PI;
var h=1-u/90;
var g=u/90;
q=this._scene.camera.position.x-s*h-r*g;
n=this._scene.camera.position.z-s*g+r*h;
var k=this._scene.camera.lookat.x-s*h-r*g;
var f=this._scene.camera.lookat.z-s*g+r*h;
if(q-k<0&&k<0){if(q<this._scene.camera.position.x||k<this._scene.camera.lookat.x){k=this._scene.camera.lookat.x;
q=this._scene.camera.position.x
}}if(k<-10){if(k<this._scene.camera.lookat.x){k=this._scene.camera.lookat.x;
q=this._scene.camera.position.x
}}if(k>this._columnLength*this._rowScale){if(k>this._scene.camera.lookat.x){k=this._scene.camera.lookat.x;
q=this._scene.camera.position.x
}}if(f>10){if(f>this._scene.camera.lookat.z){f=this._scene.camera.lookat.z;
n=this._scene.camera.position.z
}}else{if(f<this._chartsNum*-1-5){if(f<this._scene.camera.lookat.z){f=this._scene.camera.lookat.z;
n=this._scene.camera.position.z
}}}this._scene.camera.lookat.x=k;
this._scene.camera.lookat.z=f;
this._scene.camera.position.x=q;
this._scene.camera.position.z=n
}this._animationStep()
};
this._onmouseout=function(f){if(this._mouseOverChartCallback){this._mouseOverChartCallback(-1)
}};
this._onwheel=function(f){var g=f.wheelDelta||f.detail;
if(g>0){if(this._scene.perspective.fov>5){this._scene.perspective.fov--
}}else{if(this._scene.perspective.fov<50){this._scene.perspective.fov++
}}f.preventDefault()
};
this._init()
};
var requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,15)
};
var havePointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;
if(typeof(exports)!=="undefined"){exports.graph3d=Graph3d
}_EmailAlertType_RTP=1;
_EmailAlertType_SIP_response=2;
_EmailAlertType_SIP_various=3;
_EmailAlertType_ReasonSipQ850=13;
_EmailAlertType_DSCP=4;
_EmailAlertType_CPS=5;
_EmailAlertType_CALL_TIMEDOUT=6;
_EmailAlertType_ASR=7;
_EmailAlertType_NER=20;
_EmailAlertType_ACD=16;
_EmailAlertType_InternalProxyError=8;
_EmailAlertType_TimeWithoutCall=15;
_EmailAlertType_ConcurrentCalls=19;
_EmailAlertType_Sensors=9;
_EmailAlertType_Fraud_RCC=21;
_EmailAlertType_Fraud_CHC=22;
_EmailAlertType_Fraud_CHCR=23;
_EmailAlertType_Fraud_D=24;
_EmailAlertType_Fraud_SPC=25;
_EmailAlertType_Fraud_RC=26;
_EmailAlertType_Fraud_Seq=27;
_EmailAlertType_Fraud_BilingOverQuota=31;
_EmailAlertType_Fraud_BilingHighRate=32;
_EmailAlertType_Register_check_active=48;
_EmailAlertType_Register_unreg=41;
_EmailAlertType_Register_failed=42;
_EmailAlertType_Register_ua=43;
_EmailAlertType_Register_short=44;
_EmailAlertType_Register_mult=45;
_EmailAlertType_Register_expire=46;
_EmailAlertType_Register_rrd=47;
_EmailAlertType_SipMsg_qualify=49;
_EmailDailyReportType_RTP=1;
_EmailDailyReportType_ProxyDegradMOS=12;
_EmailDailyReportType_CdrSummary=14;
_EmailDailyReportType_ConcurrentCallStat=17;
_EmailDailyReportType_ConcurrentCallStat_license_chart=18;
_EmailDailyReportType_Chart=11;
_cc_interval_minute=1;
_cc_interval_hour=2;
_cc_interval_day=3;
_CdrGroupBy_sipUsers=1;
_CdrGroupBy_sipIP=2;
_CdrGroupBy_codecs=3;
_CdrGroupBy_sipResponse=4;
_CdrGroupBy_sipResponse_bye_code=41;
_CdrGroupBy_ipGroup=5;
_CdrGroupBy_reasonSip=6;
_CdrGroupBy_reasonQ850=7;
_CdrGroupBy_ua=8;
_CdrGroupBy_country_number=21;
_CdrGroupBy_country_caller=22;
_CdrGroupBy_country_called=23;
_CdrGroupBy_country_sipip=24;
_CdrGroupBy_country_sipcallerip=25;
_CdrGroupBy_country_sipcalledip=26;
_MessageGroupBy_sipResponse=1;
_MessageGroupBy_sipIP=2;
_MessageGroupBy_ipGroup=3;
_MessageGroupBy_country_number=21;
_MessageGroupBy_country_caller=22;
_MessageGroupBy_country_called=23;
_MessageGroupBy_country_sipip=24;
_MessageGroupBy_country_sipcallerip=25;
_MessageGroupBy_country_sipcalledip=26;
_TrackerStatusType_Open=1;
_TrackerStatusType_Closed=2;
_RegState_OK=1;
_RegState_Failed=2;
_RegState_UnknownMessageOK=3;
_RegState_ManyRegMessages=4;
_RegState_Expired=5;
_RegState_Unregister=-1;
_FileFormat_Image_Svg=1;
_FileFormat_Image_Png=2;
_FileFormat_Image_Svg_String="svg";
_FileFormat_Image_Png_String="png";
_AuditActivity_download_wav=1;
_AuditActivity_download_pcap=2;
_AuditActivity_play_wav=3;
_AuditActivity_show_fax=4;
_AuditActivity_batch_download=5;
_AuditActivity_filterFormCDR=11;
_AuditActivity_login=91;
_AuditActivity_logout=92;
_AuditActivity_liveSnifferStart=93;
_AuditActivity_liveSnifferStop=94;
_cdrFieldsCaller="caller";
_cdrFieldsCalled="called";
_cdrFieldsSipIpSrc="sipcallerip";
_cdrFieldsSipIpDst="sipcalledip";
_cdrFieldsRtpIpSrc="a_saddr";
_cdrFieldsRtpIpDst="b_saddr";
_cdrSide_Src="src";
_cdrSide_Dst="dst";
_cdrSide_Both="both";
_side_CallerNum=1;
_side_CalledNum=2;
_side_Caller="caller";
_side_Called="called";
_sipMsg_OPTIONS=8;
_sipMsg_SUBSCRIBE=7;
_sipMsg_NOTIFY=9;
_sensorId_empty=-2;
_sensorId_all=-1;
__default_chartWidth=800;
__default_chartHeight=500;
__default_chartPrevIntervalHourTolerance=12;
_IPPROTO_IP=0;
_IPPROTO_ICMP=1;
_IPPROTO_IGMP=2;
_IPPROTO_IPIP=4;
_IPPROTO_TCP=6;
_IPPROTO_EGP=8;
_IPPROTO_PUP=12;
_IPPROTO_UDP=17;
_IPPROTO_IDP=22;
_IPPROTO_TP=29;
_IPPROTO_DCCP=33;
_IPPROTO_IPV6=41;
_IPPROTO_ROUTING=43;
_IPPROTO_FRAGMENT=44;
_IPPROTO_RSVP=46;
_IPPROTO_GRE=47;
_IPPROTO_ESP=50;
_IPPROTO_AH=51;
_IPPROTO_ICMPV6=58;
_IPPROTO_NONE=59;
_IPPROTO_DSTOPTS=60;
_IPPROTO_MTP=92;
_IPPROTO_ENCAP=98;
_IPPROTO_PIM=103;
_IPPROTO_COMP=108;
_IPPROTO_SCTP=132;
_IPPROTO_UDPLITE=136;
_IPPROTO_RAW=255;
function _convNull(b,a){return(b===null?null:+b)
}rsCDR=[{name:"ID",type:"int",descr:"ID"},{name:"ID_comb",type:"int"},{name:"calldate",type:"string",descr:"calldate"},{name:"calldate_userformat",type:"string"},{name:"calldate2",type:"string"},{name:"callend",type:"string"},{name:"callend_userformat",type:"string"},{name:"calldate2e",type:"string"},{name:"duration",type:"string",descr:"duration"},{name:"duration2",type:"string"},{name:"_duration",type:"float"},{name:"_connect_duration",type:"float"},{name:"caller",type:"string",descr:"caller"},{name:"called",type:"string",descr:"called"},{name:"caller_domain",type:"string",descr:"domain - caller"},{name:"caller_with_domain",type:"string"},{name:"caller2",type:"string"},{name:"called_domain",type:"string",descr:"domain - called"},{name:"called_with_domain",type:"string"},{name:"called2",type:"string"},{name:"callername",type:"string",descr:"callername"},{name:"lastresponse",type:"string"},{name:"allsiprequests",type:"string"},{name:"allsipresponses",type:"string"},{name:"allrtpstreams",type:"string"},{name:"callerrtp",type:"string"},{name:"callerrtp2",type:"string"},{name:"calledrtp",type:"string"},{name:"calledrtp2",type:"string"},{name:"callerrtp_host",type:"string"},{name:"calledrtp_host",type:"string"},{name:"mfile",type:"string"},{name:"progress_time",type:"string",descr:"pdd"},{name:"ringing_time",type:"string",descr:"ringing time"},{name:"connect_duration",type:"string",descr:"connect duration"},{name:"lastSIPresponseNum",type:"string",descr:"last response number"},{name:"lastSIPresponse_id",type:"integer",descr:"last response",join_table:"cdr_sip_response",field:"lastSIPresponse_id",join_field:"lastSIPresponse"},{name:"reason_sip_cause",type:"string"},{name:"reason_q850_cause",type:"string"},{name:"sipresponse",type:"string"},{name:"sipcallerip",type:"string",descr:"sip IP - caller"},{name:"sipcalledip",type:"string",descr:"sip IP - called"},{name:"sipcallerip2",type:"string"},{name:"sipcalledip2",type:"string"},{name:"sipcaller_host",type:"string"},{name:"sipcalled_host",type:"string"},{name:"sipcallerport",type:"integer",convert:_convNull},{name:"sipcalledport",type:"integer",convert:_convNull},{name:"a_saddr",type:"string",descr:"rtp IP - caller"},{name:"b_saddr",type:"string",descr:"rtp IP - called"},{name:"a_ua",type:"string",descr:"user agent - caller",join_table:"cdr_ua",field:"a_ua_id",join_field:"ua",join_field_u:"a_ua"},{name:"b_ua",type:"string",descr:"user agent - called",join_table:"cdr_ua",field:"b_ua_id",join_field:"ua",join_field_u:"b_ua"},{name:"a_codec",type:"string"},{name:"b_codec",type:"string"},{name:"a_payload",type:"integer",descr:"codec - caller"},{name:"b_payload",type:"integer",descr:"codec - called"},{name:"payload",type:"integer",descr:"codec"},{name:"a_received",type:"string"},{name:"b_received",type:"string"},{name:"a_lost",type:"string"},{name:"b_lost",type:"string"},{name:"a_avgjitter",type:"string"},{name:"b_avgjitter",type:"string"},{name:"a_maxjitter",type:"string"},{name:"b_maxjitter",type:"string"},{name:"a_mos_f1",type:"string"},{name:"a_mos_f2",type:"string"},{name:"a_mos_adapt",type:"string"},{name:"b_mos_f1",type:"string"},{name:"b_mos_f2",type:"string"},{name:"b_mos_adapt",type:"string"},{name:"a_mos_lqo",type:"string"},{name:"b_mos_lqo",type:"string"},{name:"a_mos_xr_min",type:"string"},{name:"b_mos_xr_min",type:"string"},{name:"a_mos_xr",type:"string"},{name:"b_mos_xr",type:"string"},{name:"a_mos_silence_min",type:"string"},{name:"b_mos_silence_min",type:"string"},{name:"a_mos_silence",type:"string"},{name:"b_mos_silence",type:"string"},{name:"a_rtcp_maxjitter",type:"string"},{name:"a_rtcp_avgjitter",type:"string"},{name:"a_rtcp_maxfr",type:"string"},{name:"a_rtcp_avgfr",type:"string"},{name:"a_rtcp_maxrtd",type:"string"},{name:"a_rtcp_avgrtd",type:"string"},{name:"b_rtcp_maxjitter",type:"string"},{name:"b_rtcp_avgjitter",type:"string"},{name:"b_rtcp_maxfr",type:"string"},{name:"b_rtcp_avgfr",type:"string"},{name:"a_rtcp_fraclost_pktcount",type:"string"},{name:"b_rtcp_fraclost_pktcount",type:"string"},{name:"b_rtcp_maxrtd",type:"string"},{name:"b_rtcp_avgrtd",type:"string"},{name:"a_d50",type:"string"},{name:"b_d50",type:"string"},{name:"a_d70",type:"string"},{name:"b_d70",type:"string"},{name:"a_d90",type:"string"},{name:"b_d90",type:"string"},{name:"a_d120",type:"string"},{name:"b_d120",type:"string"},{name:"a_d150",type:"string"},{name:"b_d150",type:"string"},{name:"a_d200",type:"string"},{name:"b_d200",type:"string"},{name:"a_d300",type:"string"},{name:"b_d300",type:"string"},{name:"a_sl1",type:"string"},{name:"b_sl1",type:"string"},{name:"a_sl2",type:"string"},{name:"b_sl2",type:"string"},{name:"a_sl3",type:"string"},{name:"b_sl3",type:"string"},{name:"a_sl4",type:"string"},{name:"b_sl4",type:"string"},{name:"a_sl5",type:"string"},{name:"b_sl5",type:"string"},{name:"a_sl6",type:"string"},{name:"b_sl6",type:"string"},{name:"a_sl7",type:"string"},{name:"b_sl7",type:"string"},{name:"a_sl8",type:"string"},{name:"b_sl8",type:"string"},{name:"a_sl9",type:"string"},{name:"b_sl9",type:"string"},{name:"a_sl10",type:"string"},{name:"b_sl10",type:"string"},{name:"fbasename",type:"string",descr:"call-id"},{name:"fbasename_orig",type:"string"},{name:"menu",type:"string"},{name:"menu_pcap",type:"string"},{name:"menu_wav",type:"string"},{name:"embedplayer",type:"string"},{name:"embedplayer_indirect",type:"string"},{name:"id_sensor",type:"integer"},{name:"_id_sensor",type:"integer"},{name:"geopos_lat",type:"float"},{name:"geopos_lng",type:"float"},{name:"proxy",type:"string"},{name:"bye",type:"integer"},{name:"dscp",type:"integer",convert:_convNull},{name:"a_delay_sum",type:"integer"},{name:"b_delay_sum",type:"integer"},{name:"a_delay_avg",type:"float"},{name:"b_delay_avg",type:"float"},{name:"a_last_rtp_from_end",type:"float",convert:_convNull},{name:"b_last_rtp_from_end",type:"float",convert:_convNull},{name:"price_customer",type:"float"},{name:"price_customer_currency_code",type:"string"},{name:"price_operator",type:"float"},{name:"price_operator_currency_code",type:"string"},{name:"caller_silence",type:"integer",convert:_convNull},{name:"called_silence",type:"integer",convert:_convNull},{name:"caller_silence_end",type:"integer",convert:_convNull},{name:"called_silence_end",type:"integer",convert:_convNull},{name:"caller_clipping",type:"integer",convert:_convNull},{name:"max_retransmission_invite",type:"integer",convert:_convNull},{name:"called_clipping",type:"integer",convert:_convNull},{name:"flags",type:"integer",convert:_convNull},{name:"rtp_stream_used_in_another_call",type:"bool"},{name:"hold",type:"string"},{name:"checked",type:"bool"},{name:"caller_number_country_code",type:"string",descr:"Number country code - caller",join_table:"cdr_country_code",join_field:"caller_number_country_code"},{name:"called_number_country_code",type:"string",descr:"Number country code - called",join_table:"cdr_country_code",join_field:"called_number_country_code"},{name:"sipcallerip_country_code",type:"string",descr:"IP country code - caller",join_table:"cdr_country_code",join_field:"sipcallerip_country_code"},{name:"sipcalledip_country_code",type:"string",descr:"IP country code - called",join_table:"cdr_country_code",join_field:"sipcalledip_country_code"},{name:"note",type:"string"},{name:"unknown_sensor_id",type:"bool"}];
rsCDR_tshark=[{name:"num",type:"integer"},{name:"find_pass",type:"integer"},{name:"time",type:"float"},{name:"srcip",type:"string"},{name:"srcport",type:"number"},{name:"direction",type:"string"},{name:"type",type:"string"},{name:"cdr_ID",type:"int"},{name:"order",type:"int"},{name:"dstip",type:"string"},{name:"dstport",type:"number"},{name:"msg",type:"string"},{name:"protocol",type:"string"},{name:"spec_type",type:"string"},{name:"rtp_received",type:"int"},{name:"flags",type:"int"},{name:"ss7_opc",type:"int"},{name:"ss7_dpc",type:"int"},{name:"src_id",type:"int"}];
rsCDR_stats=[{name:"id"},{name:"sip_user_id",type:"int"},{name:"sip_user_name",type:"string"},{name:"sipip",type:"string"},{name:"rtpip",type:"string"},{name:"phone_numb",type:"string"},{name:"sip_ip",type:"string"},{name:"sip_hostname",type:"string"},{name:"rtp_ip",type:"string"},{name:"rtp_hostname",type:"string"},{name:"x_payload",type:"int"},{name:"x_codec",type:"string"},{name:"lastSIPresponse",type:"string"},{name:"bye",type:"int"},{name:"reason_sip",type:"string"},{name:"reason_q850",type:"string"},{name:"reason_q850_cause",type:"int",convert:_convNull},{name:"reason_q850_cause_text",type:"string"},{name:"reason_q850_cause_text_long",type:"string"},{name:"ua_id",type:"int"},{name:"ua",type:"string"},{name:"country_code",type:"string"},{name:"country",type:"string"},{name:"cb_ip_groups_id",type:"int"},{name:"cb_ip_groups_descr",type:"string"},{name:"protocol",type:"string"},{name:"cnt_all",type:"int",convert:_convNull},{name:"duration_all",type:"int",convert:_convNull},{name:"duration_ok",type:"int",convert:_convNull},{name:"duration_err",type:"int",convert:_convNull},{name:"cnt_ok",type:"int",convert:_convNull},{name:"cnt_err",type:"int",convert:_convNull},{name:"acd_all",type:"float",convert:_convNull},{name:"acd_ok",type:"float",convert:_convNull},{name:"acd_err",type:"float",convert:_convNull},{name:"asr_all",type:"float",convert:_convNull},{name:"asr_ok",type:"float",convert:_convNull},{name:"asr_err",type:"float",convert:_convNull},{name:"ner_all",type:"float",convert:_convNull},{name:"ner_ok",type:"float",convert:_convNull},{name:"ner_err",type:"float",convert:_convNull},{name:"mos_all",type:"float",convert:_convNull},{name:"mos_ok",type:"float",convert:_convNull},{name:"mos_err",type:"float",convert:_convNull},{name:"mos_perc95_all",type:"float",convert:_convNull},{name:"mos_perc99_all",type:"float",convert:_convNull},{name:"mos_xr_avg_all",type:"float",convert:_convNull},{name:"mos_xr_avg_perc95_all",type:"float",convert:_convNull},{name:"mos_xr_avg_perc99_all",type:"float",convert:_convNull},{name:"mos_xr_avg_caller_all",type:"float",convert:_convNull},{name:"mos_xr_avg_caller_perc95_all",type:"float",convert:_convNull},{name:"mos_xr_avg_caller_perc99_all",type:"float",convert:_convNull},{name:"mos_xr_avg_called_all",type:"float",convert:_convNull},{name:"mos_xr_avg_called_perc95_all",type:"float",convert:_convNull},{name:"mos_xr_avg_called_perc99_all",type:"float",convert:_convNull},{name:"mos_xr_min_all",type:"float",convert:_convNull},{name:"mos_xr_min_perc95_all",type:"float",convert:_convNull},{name:"mos_xr_min_perc99_all",type:"float",convert:_convNull},{name:"mos_xr_min_caller_all",type:"float",convert:_convNull},{name:"mos_xr_min_caller_perc95_all",type:"float",convert:_convNull},{name:"mos_xr_min_caller_perc99_all",type:"float",convert:_convNull},{name:"mos_xr_min_called_all",type:"float",convert:_convNull},{name:"mos_xr_min_called_perc95_all",type:"float",convert:_convNull},{name:"mos_xr_min_called_perc99_all",type:"float",convert:_convNull},{name:"mos_silence_avg_all",type:"float",convert:_convNull},{name:"mos_silence_avg_perc95_all",type:"float",convert:_convNull},{name:"mos_silence_avg_perc99_all",type:"float",convert:_convNull},{name:"mos_silence_avg_caller_all",type:"float",convert:_convNull},{name:"mos_silence_avg_caller_perc95_all",type:"float",convert:_convNull},{name:"mos_silence_avg_caller_perc99_all",type:"float",convert:_convNull},{name:"mos_silence_avg_called_all",type:"float",convert:_convNull},{name:"mos_silence_avg_called_perc95_all",type:"float",convert:_convNull},{name:"mos_silence_avg_called_perc99_all",type:"float",convert:_convNull},{name:"mos_silence_min_all",type:"float",convert:_convNull},{name:"mos_silence_min_perc95_all",type:"float",convert:_convNull},{name:"mos_silence_min_perc99_all",type:"float",convert:_convNull},{name:"mos_silence_min_caller_all",type:"float",convert:_convNull},{name:"mos_silence_min_caller_perc95_all",type:"float",convert:_convNull},{name:"mos_silence_min_caller_perc99_all",type:"float",convert:_convNull},{name:"mos_silence_min_called_all",type:"float",convert:_convNull},{name:"mos_silence_min_called_perc95_all",type:"float",convert:_convNull},{name:"mos_silence_min_called_perc99_all",type:"float",convert:_convNull},{name:"mos_lqo_caller_all",type:"float",convert:_convNull},{name:"mos_lqo_caller_perc95_all",type:"float",convert:_convNull},{name:"mos_lqo_caller_perc99_all",type:"float",convert:_convNull},{name:"mos_lqo_called_all",type:"float",convert:_convNull},{name:"mos_lqo_called_perc95_all",type:"float",convert:_convNull},{name:"mos_lqo_called_perc99_all",type:"float",convert:_convNull},{name:"packets_lost_all",type:"float",convert:_convNull},{name:"packets_lost_ok",type:"float",convert:_convNull},{name:"packets_lost_err",type:"float",convert:_convNull},{name:"packets_lost_perc95_all",type:"float",convert:_convNull},{name:"packets_lost_perc99_all",type:"float",convert:_convNull},{name:"jitter_all",type:"float",convert:_convNull},{name:"jitter_ok",type:"float",convert:_convNull},{name:"jitter_err",type:"float",convert:_convNull},{name:"jitter_perc95_all",type:"float",convert:_convNull},{name:"jitter_perc99_all",type:"float",convert:_convNull},{name:"delay_all",type:"float",convert:_convNull},{name:"delay_ok",type:"float",convert:_convNull},{name:"delay_err",type:"float",convert:_convNull},{name:"delay_perc95_all",type:"float",convert:_convNull},{name:"delay_perc99_all",type:"float",convert:_convNull},{name:"rtcp_maxfr",type:"float",convert:_convNull},{name:"rtcp_maxfr_perc95_all",type:"float",convert:_convNull},{name:"rtcp_maxfr_perc99_all",type:"float",convert:_convNull},{name:"rtcp_avgfr",type:"float",convert:_convNull},{name:"rtcp_avgfr_perc95_all",type:"float",convert:_convNull},{name:"rtcp_avgfr_perc99_all",type:"float",convert:_convNull},{name:"rtcp_maxrtd",type:"float",convert:_convNull},{name:"rtcp_maxrtd_perc95_all",type:"float",convert:_convNull},{name:"rtcp_maxrtd_perc99_all",type:"float",convert:_convNull},{name:"rtcp_avgrtd",type:"float",convert:_convNull},{name:"rtcp_avgrtd_perc95_all",type:"float",convert:_convNull},{name:"rtcp_avgrtd_perc99_all",type:"float",convert:_convNull},{name:"rtcp_maxjitter",type:"float",convert:_convNull},{name:"rtcp_maxjitter_perc95_all",type:"float",convert:_convNull},{name:"rtcp_maxjitter_perc99_all",type:"float",convert:_convNull},{name:"rtcp_avgjitter",type:"float",convert:_convNull},{name:"rtcp_avgjitter_perc95_all",type:"float",convert:_convNull},{name:"rtcp_avgjitter_perc99_all",type:"float",convert:_convNull},{name:"silence_all",type:"float",convert:_convNull},{name:"silence_perc95_all",type:"float",convert:_convNull},{name:"silence_perc99_all",type:"float",convert:_convNull},{name:"silence_end_all",type:"float",convert:_convNull},{name:"silence_end_perc95_all",type:"float",convert:_convNull},{name:"silence_end_perc99_all",type:"float",convert:_convNull},{name:"clipping_all",type:"float",convert:_convNull},{name:"clipping_perc95_all",type:"float",convert:_convNull},{name:"clipping_perc99_all",type:"float",convert:_convNull},{name:"pdd_all",type:"float",convert:_convNull},{name:"pdd_perc95_all",type:"float",convert:_convNull},{name:"pdd_perc99_all",type:"float",convert:_convNull},{name:"cps_max",type:"float",convert:_convNull},{name:"cps_avg",type:"float",convert:_convNull},{name:"short_60",type:"float",convert:_convNull},{name:"short_20",type:"float",convert:_convNull},{name:"price_customer",type:"float",convert:_convNull},{name:"price_operator",type:"float",convert:_convNull},{name:"price_currency_code",type:"string"},{name:"checked",type:"integer"}];
rsCDR_sipUsers=[{name:"sip_user_id",type:"int"},{name:"sip_user_name",type:"string"}];
rsCDR_sipIP=[{name:"sipip",type:"string"},{name:"sip_ip",type:"string"},{name:"sip_hostname",type:"string"},{name:"sip_iphost",type:"string"}];
rsCDR_codecsA=[{name:"x_payload",type:"int"},{name:"x_codec",type:"string"}];
rsCDR_errCodes=[{name:"lastSIPresponse",type:"string"}];
rsCdrRtp=[{name:"saddr",type:"string"},{name:"sport",type:"int"},{name:"daddr",type:"string"},{name:"dport",type:"int"},{name:"ssrc",type:"int"},{name:"received",type:"int"},{name:"loss",type:"int"},{name:"firsttime",type:"float"},{name:"payload",type:"int"},{name:"codec",type:"string"},{name:"maxjitter_mult10",type:"int"},{name:"checked",type:"integer"}];
rsCdrNote=[{name:"id",type:"int"},{name:"cdr_id",type:"int"},{name:"note",type:"string"},{name:"attachment_name",type:"string"},{name:"attachment_size",type:"int"},{name:"attachment_type",type:"string"},{name:"attachment_th_size",type:"int"},{name:"created_uid",type:"int"},{name:"created_name",type:"string"},{name:"created_at",type:"date",dateFormat:__format_DateTimeDb},{name:"chenged_uid",type:"int"},{name:"changed_name",type:"string"},{name:"changed_at",type:"date",dateFormat:__format_DateTimeDb}];
rsCdrSipRequest=[{name:"id",type:"int"},{name:"request",type:"string"}];
rsSPY=[{name:"id_sensor",type:"int"},{name:"sensor_name",type:"string"},{name:"calldate",type:"string"},{name:"duration",type:"string"},{name:"connect_duration",type:"string"},{name:"callercodec",type:"string"},{name:"caller",type:"string"},{name:"called",type:"string"},{name:"callerdomain",type:"string"},{name:"calleddomain",type:"string"},{name:"callerip",type:"string"},{name:"callerip2",type:"string"},{name:"calledip",type:"string"},{name:"calledip2",type:"string"},{name:"sipproxies",type:"string"},{name:"calleragent",type:"string"},{name:"calledagent",type:"string"},{name:"callername",type:"string"},{name:"lastSIPresponseNum",type:"string"},{name:"menu",type:"string"},{name:"embedplayer",type:"string"},{name:"sensor_color_background",type:"string"}];
rsLivepacket=[{name:"id",type:"int"},{name:"id_sensor",type:"int"},{name:"sipcallerip",type:"string"},{name:"sipcalledip",type:"string"},{name:"sport",type:"int"},{name:"dport",type:"int"},{name:"istcp",type:"int"},{name:"created_at",type:"date",dateFormat:__format_DateTimeDb},{name:"microseconds",type:"int"},{name:"callid",type:"string"},{name:"description",type:"string"}];
rsUserAdmin=[{name:"id",type:"int"},{name:"username",type:"string"},{name:"name",type:"string"},{name:"secret",type:"string"},{name:"id_group",type:"int",convert:_convNull},{name:"group_name",type:"string"},{name:"group_blocked",type:"bool"},{name:"can_cdr",type:"string"},{name:"can_write_cdr",type:"string"},{name:"can_play_audio",type:"string"},{name:"can_download_audio",type:"string"},{name:"can_listen_active_call",type:"string"},{name:"can_show_fax",type:"string"},{name:"can_pcap",type:"string"},{name:"can_upload_pcap",type:"string"},{name:"can_messages",type:"string"},{name:"can_view_content_message",type:"string"},{name:"can_view_message_url",type:"string"},{name:"is_admin",type:"string"},{name:"no_rtp",type:"string"},{name:"simple_cdr",type:"string"},{name:"hide_cdr_groups",type:"string"},{name:"can_graphs",type:"string"},{name:"can_tracker",type:"string"},{name:"can_activecalls",type:"string"},{name:"can_register",type:"string"},{name:"can_sip_msg",type:"string"},{name:"can_livesniffer",type:"string"},{name:"can_capture_rules",type:"string"},{name:"crules_remove_expire_time",type:"integer",convert:_convNull},{name:"can_audit",type:"string"},{name:"can_alerts_edit",type:"string"},{name:"create_only_private_alerts",type:"string"},{name:"can_alerts_show_sent",type:"string"},{name:"can_reports_edit",type:"string"},{name:"create_only_private_reports",type:"string"},{name:"can_reports_show_sent",type:"string"},{name:"can_cdr_share_local_public",type:"string"},{name:"can_cdr_share_local_private",type:"string"},{name:"can_cdr_share_voipmonitor_org",type:"string"},{name:"hide_license_information",type:"string"},{name:"can_ipacc",type:"string"},{name:"can_mtr",type:"string"},{name:"can_show_sql_query",type:"string"},{name:"can_sensors_operations",type:"string"},{name:"show_only_connected_calls",type:"string"},{name:"can_dashboard",type:"string"},{name:"dashboard_read_only",type:"string"},{name:"can_report_functions",type:"string"},{name:"hide_change_password",type:"string"},{name:"hide_user_configuration",type:"string"},{name:"password_expired",type:"string"},{name:"can_svg_paint",type:"string"},{name:"can_3d_rtp_charts",type:"string"},{name:"can_network",type:"string"},{name:"can_edit_codebooks",type:"string"},{name:"can_edit_all_templates",type:"string"},{name:"can_delete_all_templates",type:"string"},{name:"ip",type:"string"},{name:"number",type:"string"},{name:"domain",type:"string"},{name:"vlan",type:"string"},{name:"custom_headers_cdr",type:"string"},{name:"custom_headers_message",type:"string"},{name:"ip_number_domain_or",type:"integer"},{name:"note",type:"string"},{name:"email",type:"string"},{name:"blocked",type:"bool"},{name:"blocked_reason",type:"string"},{name:"max_bad_login_attempt",type:"integer",convert:_convNull},{name:"password_expiration_days",type:"integer",convert:_convNull},{name:"enable_login_ip",type:"string"},{name:"uc_color_theme_shift_h",type:"integer"},{name:"uc_color_theme_shift_s",type:"integer"},{name:"uc_color_theme_shift_v",type:"integer"},{name:"uc_color_theme_shift",type:"string"},{name:"uc_font_main_menu",type:"string"},{name:"uc_disable_confirm_before_unload",type:"integer"},{name:"uc_enable_dns_cdr",type:"integer"},{name:"uc_enable_dns_message",type:"integer"},{name:"uc_enable_flags_cdr_number",type:"string"},{name:"uc_enable_flags_cdr_ip",type:"string"},{name:"uc_enable_flags_message_number",type:"string"},{name:"uc_enable_flags_message_ip",type:"string"},{name:"uc_csv_field_separator",type:"string"},{name:"count_audit_log",type:"integer"},{name:"req_2fa",type:"string"}];
rsUsersHistory=[{name:"time",type:"date",dateFormat:__format_DateTimeDb},{name:"type",type:"string"},{name:"bad_login_reason",type:"string"},{name:"addr",type:"string"},{name:"user_agent",type:"string"},{name:"reason",type:"string"},{name:"repeat_counter",type:"integer",convert:_convNull}];
rsUsersSettings=[{name:"max_bad_login_attempt",type:"integer",convert:_convNull},{name:"password_expiration_days",type:"integer",convert:_convNull},{name:"password_min_length",type:"integer",convert:_convNull},{name:"password_min_small_letters",type:"integer",convert:_convNull},{name:"password_min_large_letters",type:"integer",convert:_convNull},{name:"password_min_numbers",type:"integer",convert:_convNull},{name:"password_min_other_chars",type:"integer",convert:_convNull}];
rsUserList=[{name:"id",type:"int"},{name:"name",type:"string"}];
rsGroupList=[{name:"id",type:"int"},{name:"name",type:"string"}];
rsAuditLog=[{name:"id",type:"int"},{name:"at",type:"date",dateFormat:__format_DateTimeDb},{name:"uid",type:"int"},{name:"user_name_2",type:"string"},{name:"activity",type:"int"},{name:"reason",type:"string"},{name:"cdr_id",type:"int"},{name:"count_relation_cdr",type:"int"},{name:"filter_data",type:"string"}];
rsUserSelections=[{name:"id",type:"int"},{name:"name"}];
rsScreenPopupUsers=[{name:"id",type:"int"},{name:"profile_id",type:"int",convert:_convNull},{name:"profile_name",type:"string"},{name:"username",type:"string"},{name:"name",type:"string"},{name:"password",type:"string"},{name:"dest_number",type:"string"},{name:"allow_change_settings",type:"int"},{name:"description",type:"string"}];
rsScreenPopupProfile=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"auto_popup",type:"int"},{name:"show_ip",type:"int"},{name:"popup_on",type:"string"},{name:"non_numeric_caller_id",type:"int"},{name:"regex_calling_number",type:"string"},{name:"src_ip_whitelist",type:"string"},{name:"src_ip_blacklist",type:"string"},{name:"app_launch",type:"string"},{name:"app_launch_args_or_url",type:"string"},{name:"status_line",type:"string"},{name:"popup_title",type:"string"},{name:"description",type:"string"}];
rsFilterIp=[{name:"id",type:"int"},{name:"ip",type:"string"},{name:"mask",type:"int",convert:_convNull,enableZero:true},{name:"direction",type:"int"},{name:"script",type:"int",convert:_convNull,disableSaveNull:true},{name:"skip",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtp",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtcp",type:"int",convert:_convNull,disableSaveNull:true},{name:"sip",type:"int",convert:_convNull,disableSaveNull:true},{name:"register",type:"int",convert:_convNull,disableSaveNull:true},{name:"dtmf",type:"int",convert:_convNull,disableSaveNull:true},{name:"graph",type:"int",convert:_convNull,disableSaveNull:true},{name:"wav",type:"int",convert:_convNull,disableSaveNull:true},{name:"mos_lqo",type:"int",convert:_convNull,disableSaveNull:true},{name:"hide_message",type:"int",convert:_convNull,disableSaveNull:true},{name:"spool_2",type:"int",convert:_convNull,disableSaveNull:true},{name:"note",type:"string"},{name:"remove_at",type:"date",dateFormat:__format_DateTimeDb},{name:"no_permanent",type:"int"},{name:"sensors_id",type:"string"},{name:"sensors",type:"string"}];
rsFilterTelnum=[{name:"id",type:"int"},{name:"prefix",type:"string"},{name:"direction",type:"int"},{name:"script",type:"int",convert:_convNull,disableSaveNull:true},{name:"skip",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtp",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtcp",type:"int",convert:_convNull,disableSaveNull:true},{name:"sip",type:"int",convert:_convNull,disableSaveNull:true},{name:"register",type:"int",convert:_convNull,disableSaveNull:true},{name:"dtmf",type:"int",convert:_convNull,disableSaveNull:true},{name:"graph",type:"int",convert:_convNull,disableSaveNull:true},{name:"wav",type:"int",convert:_convNull,disableSaveNull:true},{name:"mos_lqo",type:"int",convert:_convNull,disableSaveNull:true},{name:"hide_message",type:"int",convert:_convNull,disableSaveNull:true},{name:"spool_2",type:"int",convert:_convNull,disableSaveNull:true},{name:"note",type:"string"},{name:"remove_at",type:"date",dateFormat:__format_DateTimeDb},{name:"no_permanent",type:"int"},{name:"sensors_id",type:"string"},{name:"sensors",type:"string"}];
rsFilterDomain=[{name:"id",type:"int"},{name:"domain",type:"string"},{name:"direction",type:"int"},{name:"script",type:"int",convert:_convNull,disableSaveNull:true},{name:"skip",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtp",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtcp",type:"int",convert:_convNull,disableSaveNull:true},{name:"sip",type:"int",convert:_convNull,disableSaveNull:true},{name:"register",type:"int",convert:_convNull,disableSaveNull:true},{name:"dtmf",type:"int",convert:_convNull,disableSaveNull:true},{name:"graph",type:"int",convert:_convNull,disableSaveNull:true},{name:"wav",type:"int",convert:_convNull,disableSaveNull:true},{name:"mos_lqo",type:"int",convert:_convNull,disableSaveNull:true},{name:"hide_message",type:"int",convert:_convNull,disableSaveNull:true},{name:"spool_2",type:"int",convert:_convNull,disableSaveNull:true},{name:"note",type:"string"},{name:"remove_at",type:"date",dateFormat:__format_DateTimeDb},{name:"no_permanent",type:"int"},{name:"sensors_id",type:"string"},{name:"sensors",type:"string"}];
rsFilterSipHeader=[{name:"id",type:"int"},{name:"header",type:"string"},{name:"content",type:"string"},{name:"content_type",type:"string"},{name:"direction",type:"int"},{name:"script",type:"int",convert:_convNull,disableSaveNull:true},{name:"skip",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtp",type:"int",convert:_convNull,disableSaveNull:true},{name:"rtcp",type:"int",convert:_convNull,disableSaveNull:true},{name:"sip",type:"int",convert:_convNull,disableSaveNull:true},{name:"register",type:"int",convert:_convNull,disableSaveNull:true},{name:"dtmf",type:"int",convert:_convNull,disableSaveNull:true},{name:"graph",type:"int",convert:_convNull,disableSaveNull:true},{name:"wav",type:"int",convert:_convNull,disableSaveNull:true},{name:"mos_lqo",type:"int",convert:_convNull,disableSaveNull:true},{name:"hide_message",type:"int",convert:_convNull,disableSaveNull:true},{name:"spool_2",type:"int",convert:_convNull,disableSaveNull:true},{name:"note",type:"string"},{name:"remove_at",type:"date",dateFormat:__format_DateTimeDb},{name:"no_permanent",type:"int"},{name:"sensors_id",type:"string"},{name:"sensors",type:"string"}];
rsSendCallInfo=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"info_on",type:"string"},{name:"request_url",type:"string"},{name:"request_type",type:"string"},{name:"whitelist_number_caller",type:"string"},{name:"blacklist_number_caller",type:"string"},{name:"whitelist_number_called",type:"string"},{name:"blacklist_number_called",type:"string"},{name:"whitelist_ip_caller",type:"string"},{name:"blacklist_ip_caller",type:"string"},{name:"whitelist_ip_called",type:"string"},{name:"blacklist_ip_called",type:"string"},{name:"whitelist_number_caller_group",type:"string"},{name:"blacklist_number_caller_group",type:"string"},{name:"whitelist_number_called_group",type:"string"},{name:"blacklist_number_called_group",type:"string"},{name:"whitelist_ip_caller_group",type:"string"},{name:"blacklist_ip_caller_group",type:"string"},{name:"whitelist_ip_called_group",type:"string"},{name:"blacklist_ip_called_group",type:"string"},{name:"descr",type:"string"}];
rsAlerts=[{name:"id",type:"int"},{name:"alert_type",type:"int"},{name:"data_table",type:"string"},{name:"descr",type:"string"},{name:"every_min",type:"int",convert:_convNull},{name:"maximum_oldest_cdr_hour",type:"int",convert:_convNull,enableZero:true},{name:"maximum_oldest_cdr_min",type:"int",convert:_convNull,enableZero:true},{name:"select_sensors",type:"string"},{name:"agregation_sensors",type:"bool"},{name:"mos_lt",type:"float",convert:_convNull},{name:"mos_side",type:"int"},{name:"mos_xr_avg_lt",type:"float",convert:_convNull},{name:"mos_xr_avg_side",type:"int"},{name:"mos_xr_min_lt",type:"float",convert:_convNull},{name:"mos_xr_min_side",type:"int"},{name:"mos_silence_avg_lt",type:"float",convert:_convNull},{name:"mos_silence_avg_side",type:"int"},{name:"mos_silence_min_lt",type:"float",convert:_convNull},{name:"mos_silence_min_side",type:"int"},{name:"mos_lqo_caller_lt",type:"float",convert:_convNull},{name:"mos_lqo_called_lt",type:"float",convert:_convNull},{name:"packets_lost_perc_gt",type:"float",convert:_convNull},{name:"packets_lost_side",type:"int"},{name:"jitter_gt",type:"float",convert:_convNull},{name:"jitter_side",type:"int"},{name:"delay_limit_ge",type:"int",convert:_convNull},{name:"delay_count_gt",type:"int",convert:_convNull},{name:"delay_side",type:"int"},{name:"silence_gt",type:"int",convert:_convNull},{name:"silence_end_gt",type:"int",convert:_convNull},{name:"silence_side",type:"int"},{name:"clipping_gt",type:"int",convert:_convNull},{name:"clipping_side",type:"int"},{name:"cb_rtp_ip_groups_id",type:"int",convert:_convNull},{name:"rtp_ip",type:"string"},{name:"duration_gt",type:"int",convert:_convNull},{name:"pdd_gt",type:"int",convert:_convNull},{name:"pdd_lt",type:"int",convert:_convNull},{name:"one_way",type:"string"},{name:"without_stream",type:"string"},{name:"last_sip_response_num",type:"string"},{name:"reason_type",type:"int"},{name:"reason_filter",type:"string"},{name:"interrupted_call",type:"int"},{name:"interrupted_call_time_tolerance",type:"int"},{name:"occurences_gt",type:"int",convert:_convNull},{name:"occurences_perc_gt",type:"float",convert:_convNull},{name:"occurences_perc_from_all",type:"string"},{name:"occurences_gt_perc_cond",type:"string"},{name:"cdr_gt",type:"int",convert:_convNull},{name:"cps_gt",type:"int",convert:_convNull},{name:"dscp_caller_sip_ge",type:"int",convert:_convNull,enableZero:true},{name:"dscp_caller_sip_lt",type:"int",convert:_convNull,enableZero:true},{name:"dscp_caller_sip_eq",type:"int",convert:_convNull,enableZero:true},{name:"dscp_called_sip_ge",type:"int",convert:_convNull,enableZero:true},{name:"dscp_called_sip_lt",type:"int",convert:_convNull,enableZero:true},{name:"dscp_called_sip_eq",type:"int",convert:_convNull,enableZero:true},{name:"dscp_caller_rtp_ge",type:"int",convert:_convNull,enableZero:true},{name:"dscp_caller_rtp_lt",type:"int",convert:_convNull,enableZero:true},{name:"dscp_caller_rtp_eq",type:"int",convert:_convNull,enableZero:true},{name:"dscp_called_rtp_ge",type:"int",convert:_convNull,enableZero:true},{name:"dscp_called_rtp_lt",type:"int",convert:_convNull,enableZero:true},{name:"dscp_called_rtp_eq",type:"int",convert:_convNull,enableZero:true},{name:"dscp_cond_or",type:"string"},{name:"asr_lt",type:"int",convert:_convNull},{name:"ner_lt",type:"int",convert:_convNull},{name:"acd_lt",type:"int",convert:_convNull},{name:"ipe_cdr_custom_headers_id",type:"int",convert:_convNull},{name:"ipe_error",type:"string"},{name:"call_timedout_bye",type:"string"},{name:"call_timedout_absolute",type:"string"},{name:"call_timedout_rtp",type:"string"},{name:"call_timedout_oneway",type:"string"},{name:"time_without_call_minutes",type:"int",convert:_convNull},{name:"time_without_call_only_connected",type:"string"},{name:"concurrent_calls_limit_gt",type:"int",convert:_convNull,enableZero:true},{name:"concurrent_calls_limit_lt",type:"int",convert:_convNull,enableZero:true},{name:"concurrent_calls_minutes",type:"int",convert:_convNull},{name:"suppress_repeating_alerts",type:"string"},{name:"alert_once_per_hours",type:"int",convert:_convNull},{name:"sens_age_last_cdr_gt",type:"int",convert:_convNull},{name:"sens_packet_loss_gt",type:"int",convert:_convNull},{name:"sens_sqlqueue_size_gt",type:"int",convert:_convNull},{name:"sens_memory_res_mb_gt",type:"int",convert:_convNull},{name:"sens_calls_gt",type:"int",convert:_convNull},{name:"sens_uptime_decrease",type:"string"},{name:"sens_select_sensors",type:"string"},{name:"sens_always_send_status",type:"string"},{name:"fraud_whitelist_number",type:"string"},{name:"fraud_blacklist_number",type:"string"},{name:"fraud_whitelist_ip",type:"string"},{name:"fraud_blacklist_ip",type:"string"},{name:"fraud_whitelist_number_2",type:"string"},{name:"fraud_blacklist_number_2",type:"string"},{name:"fraud_whitelist_ip_2",type:"string"},{name:"fraud_blacklist_ip_2",type:"string"},{name:"fraud_whitelist_number_group",type:"string"},{name:"fraud_blacklist_number_group",type:"string"},{name:"fraud_whitelist_ip_group",type:"string"},{name:"fraud_blacklist_ip_group",type:"string"},{name:"fraud_whitelist_number_2_group",type:"string"},{name:"fraud_blacklist_number_2_group",type:"string"},{name:"fraud_whitelist_ip_2_group",type:"string"},{name:"fraud_blacklist_ip_2_group",type:"string"},{name:"fraud_number_condition_12",type:"string"},{name:"fraud_ip_condition_12",type:"string"},{name:"fraud_whitelist_ua",type:"string"},{name:"fraud_whitelist_ua_group",type:"string"},{name:"fraud_use_domain",type:"bool"},{name:"fraud_whitelist_domain",type:"string"},{name:"fraud_blacklist_domain",type:"string"},{name:"fraud_whitelist_domain_group",type:"string"},{name:"fraud_blacklist_domain_group",type:"string"},{name:"fraud_concurent_calls_limit",type:"int",convert:_convNull},{name:"fraud_concurent_calls_limit_local",type:"int",convert:_convNull},{name:"fraud_concurent_calls_limit_international",type:"int",convert:_convNull},{name:"fraud_filter_international",type:"int"},{name:"fraud_by_ip",type:"string"},{name:"fraud_rcc_by",type:"string"},{name:"fraud_rc_by",type:"string"},{name:"fraud_type_change_location",type:"string"},{name:"fraud_change_location_ok",type:"string"},{name:"fraud_dest_location",type:"string"},{name:"fraud_dest_prefixes",type:"string"},{name:"fraud_interval_length",type:"int",convert:_convNull},{name:"fraud_interval_limit",type:"int",convert:_convNull},{name:"fraud_register_only_with_response",type:"string"},{name:"fraud_suppress_repeating_alerts",type:"string"},{name:"fraud_alert_once_per_hours",type:"int",convert:_convNull},{name:"fraud_bill_by_ip",type:"bool"},{name:"fraud_bill_by_number",type:"bool"},{name:"fraud_bill_by_domain",type:"bool"},{name:"fraud_bill_quota_hour",type:"float",convert:_convNull},{name:"fraud_bill_quota_day",type:"float",convert:_convNull},{name:"fraud_bill_quota_week",type:"float",convert:_convNull},{name:"fraud_bill_quota_month",type:"float",convert:_convNull},{name:"fraud_bill_quota_summary",type:"int"},{name:"fraud_bill_limit",type:"float",convert:_convNull},{name:"fraud_store_pcaps",type:"bool"},{name:"fraud_store_pcaps_to_path",type:"string"},{name:"reg_ok_register_from",type:"int",convert:_convNull},{name:"reg_ok_register_to",type:"int",convert:_convNull},{name:"reg_ok_register_from_to_neg",type:"bool"},{name:"reg_unregister_time_sec_ge",type:"int",convert:_convNull},{name:"reg_failed_occurences_ge",type:"int",convert:_convNull},{name:"reg_ua",type:"string"},{name:"reg_ua_neg",type:"string"},{name:"reg_register_time_sec_le",type:"int",convert:_convNull},{name:"reg_interval_limit",type:"int",convert:_convNull},{name:"reg_interval_length_sec",type:"int",convert:_convNull},{name:"reg_list_type",type:"int"},{name:"reg_rrd_avg_ms_ge",type:"int",convert:_convNull},{name:"sip_msg_type",type:"string"},{name:"sip_msg_group_by_ip",type:"string"},{name:"sip_msg_group_by_response_number",type:"int",convert:_convNull},{name:"sip_msg_qualify_default",type:"bool"},{name:"sip_msg_qualify_limit",type:"int",convert:_convNull},{name:"sip_msg_ok_responses",type:"string"},{name:"sip_msg_data_source",type:"string"},{name:"whitelist_ip",type:"string"},{name:"blacklist_ip",type:"string"},{name:"whitelist_ip_2",type:"string"},{name:"blacklist_ip_2",type:"string"},{name:"whitelist_ip_group",type:"string"},{name:"blacklist_ip_group",type:"string"},{name:"whitelist_ip_2_group",type:"string"},{name:"blacklist_ip_2_group",type:"string"},{name:"ip_condition_12",type:"string"},{name:"only_connected",type:"string"},{name:"international_prefixes",type:"string"},{name:"international_number_min_length",type:"int",convert:_convNull},{name:"international_number_min_length_prefixes_strict",type:"bool"},{name:"country_code_for_local_numbers",type:"string"},{name:"enable_check_napa_without_prefix",type:"bool"},{name:"min_length_napa_without_prefix",type:"int"},{name:"skip_prefixes",type:"string"},{name:"cb_ip_groups_id",type:"int",convert:_convNull},{name:"ip",type:"string"},{name:"cb_number_groups_id",type:"int",convert:_convNull},{name:"number",type:"string"},{name:"cb_email_groups_id",type:"int",convert:_convNull},{name:"email",type:"string"},{name:"cdr_report_in_attachment",type:"string"},{name:"cdr_report_max_lines_in_body",type:"int",convert:_convNull},{name:"cdr_recap_report_in_attachment",type:"string"},{name:"summary_in_subject",type:"string"},{name:"note",type:"string"},{name:"disable",type:"string"},{name:"at_day_of_week",type:"string"},{name:"at_hour_of_day_from",type:"integer",convert:_convNull,enableZero:true},{name:"at_hour_of_day_to",type:"integer",convert:_convNull,enableZero:true},{name:"disable_hyperlinks",type:"string"},{name:"add_note2email",type:"string"},{name:"send_if",type:"integer"},{name:"config_filter_cdr",type:"string"},{name:"config_filter_message",type:"string"},{name:"config_filter_register",type:"string"},{name:"last_run_at",type:"date",dateFormat:__format_DateTimeDb},{name:"cb_ip_groups_descr",type:"string"},{name:"cb_ip_groups_ip",type:"string"},{name:"cb_email_groups_descr",type:"string"},{name:"cb_email_groups_email",type:"string"},{name:"count_sent",type:"integer"},{name:"external_script",type:"string"},{name:"external_script_parameters_via_tmp_file",type:"bool"},{name:"ext_script_vars",type:"string"},{name:"custom_columns_enable",type:"bool"},{name:"custom_columns_config",type:"string"},{name:"timezone",type:"string"},{name:"owner_uid",type:"int",convert:_convNull},{name:"owner_name",type:"string"},{name:"private",type:"bool"},{name:"use_user_restriction",type:"bool"},{name:"user_ids_read",type:"string"},{name:"user_ids_write",type:"string"},{name:"group_ids_read",type:"string"},{name:"group_ids_write",type:"string"}];
rsAlertsFraud=[{name:"id",type:"int"},{name:"alerts_id",type:"int"},{name:"descr",type:"string"},{name:"timeperiod",type:"string"},{name:"concurent_calls_limit",type:"int",convert:_convNull},{name:"concurent_calls_limit_local",type:"int",convert:_convNull},{name:"concurent_calls_limit_international",type:"int",convert:_convNull}];
rsAlertsRegFilters=[{name:"id",type:"int"},{name:"alerts_id",type:"int"},{name:"descr",type:"string"},{name:"reg_ok_register_from",type:"int",convert:_convNull},{name:"reg_ok_register_to",type:"int",convert:_convNull},{name:"reg_ok_register_from_to_neg",type:"bool"},{name:"config_filter_register",type:"string"}];
rsDailyReports=[{name:"id",type:"int"},{name:"report_type",type:"int"},{name:"report_last_days",type:"int",convert:_convNull},{name:"maximum_oldest_cdr_hour",type:"int",convert:_convNull,enableZero:true},{name:"maximum_oldest_cdr_min",type:"int",convert:_convNull,enableZero:true},{name:"data_table",type:"string"},{name:"daily_reports_id",type:"int"},{name:"descr",type:"string"},{name:"at_or_every",type:"string"},{name:"at_hour",type:"int",convert:_convNull,enableZero:true},{name:"at_min",type:"int",convert:_convNull,enableZero:true},{name:"at_day_of_week",type:"string"},{name:"at_day_of_month",type:"int",convert:_convNull},{name:"every_min",type:"int",convert:_convNull},{name:"every_interval_offset_min",type:"int",convert:_convNull,enableZero:true},{name:"at_hour_of_day_from",type:"integer",convert:_convNull,enableZero:true},{name:"at_hour_of_day_to",type:"integer",convert:_convNull,enableZero:true},{name:"mos_lt",type:"float",convert:_convNull},{name:"mos_side",type:"int"},{name:"mos_xr_avg_lt",type:"float",convert:_convNull},{name:"mos_xr_avg_side",type:"int"},{name:"mos_xr_min_lt",type:"float",convert:_convNull},{name:"mos_xr_min_side",type:"int"},{name:"mos_silence_avg_lt",type:"float",convert:_convNull},{name:"mos_silence_avg_side",type:"int"},{name:"mos_silence_min_lt",type:"float",convert:_convNull},{name:"mos_silence_min_side",type:"int"},{name:"mos_lqo_caller_lt",type:"float",convert:_convNull},{name:"mos_lqo_called_lt",type:"float",convert:_convNull},{name:"packets_lost_perc_gt",type:"float",convert:_convNull},{name:"packets_lost_side",type:"int"},{name:"jitter_gt",type:"float",convert:_convNull},{name:"jitter_side",type:"int"},{name:"delay_limit_ge",type:"int",convert:_convNull},{name:"delay_count_gt",type:"int",convert:_convNull},{name:"delay_side",type:"int"},{name:"silence_gt",type:"int",convert:_convNull},{name:"silence_end_gt",type:"int",convert:_convNull},{name:"silence_side",type:"int"},{name:"clipping_gt",type:"int",convert:_convNull},{name:"clipping_side",type:"int"},{name:"cb_rtp_ip_groups_id",type:"int",convert:_convNull},{name:"rtp_ip",type:"string"},{name:"duration_gt",type:"int",convert:_convNull},{name:"pdd_gt",type:"int",convert:_convNull},{name:"pdd_lt",type:"int",convert:_convNull},{name:"one_way",type:"string"},{name:"without_stream",type:"string"},{name:"cb_pmd_proxy_ip_groups_id",type:"int",convert:_convNull},{name:"pmd_proxy_ip",type:"string"},{name:"pmd_mos_border_1",type:"int",convert:_convNull},{name:"pmd_mos_border_2",type:"int",convert:_convNull},{name:"pmd_cdr_custom_headers_id",type:"int",convert:_convNull},{name:"pmd_detail",type:"string"},{name:"cdr_sum_type",type:"string"},{name:"cdr_sum_columns",type:"string"},{name:"cdr_sum_sort_by",type:"string"},{name:"cdr_sum_sort_dir",type:"string"},{name:"cdr_sum_max_rows",type:"int",convert:_convNull},{name:"cc_interval_type",type:"int"},{name:"cc_interval_agregation",type:"int"},{name:"cc_interval_count",type:"int",convert:_convNull},{name:"cc_interval_days_of_week",type:"string"},{name:"chart_enable_shadow",type:"string"},{name:"send_pdf",type:"string"},{name:"chart_pdf_image_format",type:"int"},{name:"pdf_page_orientation",type:"string"},{name:"cb_ip_groups_id",type:"int",convert:_convNull},{name:"ip",type:"string"},{name:"cb_number_groups_id",type:"int",convert:_convNull},{name:"number",type:"string"},{name:"cb_email_groups_id",type:"int",convert:_convNull},{name:"email",type:"string"},{name:"cdr_report_in_attachment",type:"string"},{name:"cdr_report_max_lines_in_body",type:"int",convert:_convNull},{name:"note",type:"string"},{name:"disable",type:"string"},{name:"disable_hyperlinks",type:"string"},{name:"add_note2email",type:"string"},{name:"send_if",type:"integer"},{name:"config_filter_cdr",type:"string"},{name:"config_filter_message",type:"string"},{name:"last_run_at",type:"date",dateFormat:__format_DateTimeDb},{name:"cb_ip_groups_descr",type:"string"},{name:"cb_ip_groups_ip",type:"string"},{name:"cb_email_groups_descr",type:"string"},{name:"cb_email_groups_email",type:"string"},{name:"count_sent",type:"integer"},{name:"custom_columns_enable",type:"bool"},{name:"custom_columns_config",type:"string"},{name:"owner_uid",type:"int",convert:_convNull},{name:"owner_name",type:"string"},{name:"private",type:"bool"},{name:"use_user_restriction",type:"bool"},{name:"user_ids_read",type:"string"},{name:"user_ids_write",type:"string"},{name:"group_ids_read",type:"string"},{name:"group_ids_write",type:"string"}];
rsDailyReportsCharts=[{name:"id",type:"int"},{name:"daily_reports_id",type:"int"},{name:"data_table",type:"string"},{name:"description",type:"string"},{name:"previous_period",type:"int"},{name:"chart_width",type:"int",convert:_convNull},{name:"chart_height",type:"int",convert:_convNull},{name:"enabled",type:"int"},{name:"config_chart",type:"string"}];
rsAlertsSended=[{name:"id",type:"int"},{name:"alerts_id",type:"int"},{name:"subject"},{name:"content"},{name:"last_cdr_id"},{name:"send_time",type:"date",dateFormat:__format_DateTimeDb},{name:"send_email"},{name:"alert_descr"}];
rsDailyReportsSended=[{name:"id",type:"int"},{name:"daily_reports_id",type:"int"},{name:"day",type:"date",dateFormat:__format_DateDb},{name:"subject"},{name:"content"},{name:"send_time",type:"date",dateFormat:__format_DateTimeDb},{name:"send_email"},{name:"report_descr"}];
rsFraudRules=[{name:"id",type:"int"},{name:"parent_id",type:"int",convert:_convNull},{name:"type"},{name:"priority",type:"int"},{name:"name"},{name:"use_group_classification_rule",type:"int"},{name:"note"}];
rsFraudClassificationRule=[{name:"id",type:"int"},{name:"rules_id",type:"int"},{name:"type"},{name:"type_int",type:"int"},{name:"direction"},{name:"direction_int",type:"int"},{name:"cb_ip_groups_id",type:"int"},{name:"cb_ip_groups_descr"},{name:"cb_ip_groups_ip"},{name:"ip"},{name:"cb_number_groups_id",type:"int"},{name:"cb_number_groups_descr"},{name:"cb_number_groups_number"},{name:"number"},{name:"note"},{name:"ip_number"},{name:"cb_descr"}];
rsFraudAlertRule=[{name:"id",type:"int"},{name:"rule_id",type:"int"},{name:"type"},{name:"type_int",type:"int"},{name:"src_ip__cb_ip_groups_id",type:"int",convert:_convNull},{name:"src_ip__ip"},{name:"src_ip__cb_ip_groups_descr"},{name:"src_ip__cb_ip_groups_ip"},{name:"src_ip__ip_all"},{name:"src_ip__countries"},{name:"src_ip__cb_country_groups_id",type:"int",convert:_convNull},{name:"src_ip__cb_country_groups_descr"},{name:"src_ip__change",type:"int"},{name:"user_agent"},{name:"dst_num__cb_number_groups_id",type:"int",convert:_convNull},{name:"dst_num__number"},{name:"dst_num__cb_number_groups_descr"},{name:"dst_num__cb_number_groups_number"},{name:"dst_num__number_all"},{name:"dst_num__countries"},{name:"dst_num__cb_country_groups_id",type:"int",convert:_convNull},{name:"dst_num__cb_country_groups_descr"},{name:"price__per_call",type:"float",convert:_convNull},{name:"price__during_interval__limit",type:"float",convert:_convNull},{name:"price__during_interval__interval",convert:_convNull},{name:"same_number__limit",type:"int",convert:_convNull},{name:"same_number__interval",type:"int",convert:_convNull},{name:"international_number_limit__limit",type:"int",convert:_convNull},{name:"international_number_limit__interval",type:"int",convert:_convNull},{name:"international_number_limit__length_number_gt",type:"int",convert:_convNull},{name:"concurent_calls__limit_max",type:"int",convert:_convNull},{name:"concurent_calls__limit_min",type:"int",convert:_convNull},{name:"concurent_calls__from_hour",type:"int",convert:_convNull},{name:"concurent_calls__to_hour",type:"int",convert:_convNull},{name:"whitelist",type:"int"},{name:"note"}];
rsCbIpGroups=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"ip",type:"string"},{name:"trunk",type:"string"},{name:"note",type:"string"}];
rsCbNumberGroups=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"number",type:"string"},{name:"note",type:"string"}];
rsCbDomainGroups=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"domain",type:"string"},{name:"side",type:"int",convert:_convNull},{name:"note",type:"string"}];
rsCbCustheadCdrGroups=[{name:"id",type:"int"},{name:"cdr_custom_headers_id",type:"int"},{name:"descr",type:"string"},{name:"custom_header",type:"string"},{name:"content",type:"string"},{name:"note",type:"string"}];
rsCbCustheadMsgGroups=[{name:"id",type:"int"},{name:"msg_custom_headers_id",type:"int"},{name:"descr",type:"string"},{name:"custom_header",type:"string"},{name:"content",type:"string"},{name:"note",type:"string"}];
rsCbEmailGroups=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"email",type:"string"},{name:"note",type:"string"}];
rsCbCountryGroups=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"country",type:"string"},{name:"note",type:"string"}];
rsCbUaGroups=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"ua",type:"string"},{name:"note",type:"string"}];
rsCbTimePeriod=[{name:"id",type:"int"},{name:"descr",type:"string"},{name:"is_hourmin",type:"int",convert:_convNull,enableZero:true},{name:"from_hour",type:"int",convert:_convNull,enableZero:true},{name:"from_minute",type:"int",convert:_convNull,enableZero:true},{name:"to_hour",type:"int",convert:_convNull,enableZero:true},{name:"to_minute",type:"int",convert:_convNull,enableZero:true},{name:"is_weekday",type:"int",convert:_convNull,enableZero:true},{name:"from_weekday",type:"int",convert:_convNull,enableZero:true},{name:"to_weekday",type:"int",convert:_convNull,enableZero:true},{name:"is_monthday",type:"int",convert:_convNull,enableZero:true},{name:"from_monthday",type:"int",convert:_convNull,enableZero:true},{name:"to_monthday",type:"int",convert:_convNull,enableZero:true},{name:"is_month",type:"int",convert:_convNull,enableZero:true},{name:"from_month",type:"int",convert:_convNull,enableZero:true},{name:"to_month",type:"int",convert:_convNull,enableZero:true},{name:"note",type:"string"}];
rsHolidayState=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"country_code",type:"string"},{name:"description",type:"string"}];
rsHolidayStateDate=[{name:"id",type:"int"},{name:"id_holiday_state",type:"int"},{name:"type_holiday",type:"string"},{name:"date",type:"date",dateFormat:__format_DateDb},{name:"month",type:"int",convert:_convNull},{name:"month_day",type:"int",convert:_convNull},{name:"name",type:"string"},{name:"description",type:"string"}];
rsCurrency=[{name:"id",type:"int"},{name:"code",type:"string"},{name:"custom_code",type:"string"},{name:"name",type:"string"},{name:"country_code",type:"string"},{name:"country_name",type:"string"},{name:"main_currency",type:"int"},{name:"exchange_rate",type:"float",convert:_convNull},{name:"daily_update",type:"int"},{name:"description",type:"string"}];
rsInternationalRules=[{name:"international_prefixes",type:"string"},{name:"international_number_min_length",type:"int",convert:_convNull},{name:"international_number_min_length_prefixes_strict",type:"bool"},{name:"country_code_for_local_numbers",type:"string"},{name:"enable_check_napa_without_prefix",type:"bool"},{name:"min_length_napa_without_prefix",type:"int"},{name:"skip_prefixes",type:"string"}];
rsBilling=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"id_holiday_state",type:"int",convert:_convNull},{name:"peak_offpeak",type:"int"},{name:"default_peak_starts_hour",type:"int",convert:_convNull,enableZero:true},{name:"default_peak_starts_minute",type:"int",convert:_convNull,enableZero:true},{name:"default_peak_ends_hour",type:"int",convert:_convNull,enableZero:true},{name:"default_peak_ends_minute",type:"int",convert:_convNull,enableZero:true},{name:"default_weekend_start",type:"int",convert:_convNull,enableZero:true},{name:"default_price",type:"float"},{name:"default_price_peak",type:"float"},{name:"default_t1",type:"int",convert:_convNull,enableZero:true},{name:"default_t2",type:"int",convert:_convNull,enableZero:true},{name:"default_use_for_number_format",type:"string"},{name:"default_use_for_number_type",type:"string"},{name:"default_customer_billing",type:"int"},{name:"currency_code",type:"string"},{name:"timezone_name",type:"string"},{name:"description",type:"string"}];
rsBillingRule=[{name:"id",type:"int"},{name:"id_billing",type:"int"},{name:"name",type:"string"},{name:"prefix_number",type:"string"},{name:"fixed_number",type:"string"},{name:"regex_number",type:"string"},{name:"override_default_peak_offpeak",type:"int"},{name:"peak_starts_hour",type:"int",convert:_convNull,enableZero:true},{name:"peak_starts_minute",type:"int",convert:_convNull,enableZero:true},{name:"peak_ends_hour",type:"int",convert:_convNull,enableZero:true},{name:"peak_ends_minute",type:"int",convert:_convNull,enableZero:true},{name:"weekend_start",type:"int",convert:_convNull,enableZero:true},{name:"price",type:"float"},{name:"price_peak",type:"float"},{name:"t1",type:"int",convert:_convNull,enableZero:true},{name:"t2",type:"int",convert:_convNull,enableZero:true},{name:"use_for_number_format",type:"string"},{name:"use_for_number_type",type:"string"}];
rsBillingOperatorAssignment=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"id_billing",type:"int",convert:_convNull},{name:"billing_name",type:"string"},{name:"description",type:"string"},{name:"international_prefixes",type:"string"},{name:"international_number_min_length",type:"int",convert:_convNull},{name:"international_number_min_length_prefixes_strict",type:"bool"},{name:"country_code_for_local_numbers",type:"string"},{name:"enable_check_napa_without_prefix",type:"bool"},{name:"min_length_napa_without_prefix",type:"int"},{name:"skip_prefixes",type:"string"},{name:"limitation_for_sensors",type:"bool"}];
rsBillingOperatorAssignmentAddresses=[{name:"id",type:"int"},{name:"id_operator_assignment",type:"int"},{name:"ip",type:"string"},{name:"mask",type:"int",convert:_convNull},{name:"description",type:"string"}];
rsBillingOperatorAssignmentNumbers=[{name:"id",type:"int"},{name:"id_operator_assignment",type:"int"},{name:"number",type:"string"},{name:"fixed",type:"int"},{name:"description",type:"string"}];
rsBillingOperatorAssignmentSensors=[{name:"id",type:"int"},{name:"id_operator_assignment",type:"int"},{name:"id_sensor",type:"int"},{name:"sensor_id",type:"int"},{name:"sensor_name",type:"string"}];
rsBillingCustomerAssignment=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"id_billing",type:"int",convert:_convNull},{name:"billing_name",type:"string"},{name:"description",type:"string"},{name:"international_prefixes",type:"string"},{name:"international_number_min_length",type:"int",convert:_convNull},{name:"international_number_min_length_prefixes_strict",type:"bool"},{name:"country_code_for_local_numbers",type:"string"},{name:"enable_check_napa_without_prefix",type:"bool"},{name:"min_length_napa_without_prefix",type:"int"},{name:"skip_prefixes",type:"string"},{name:"limitation_for_sensors",type:"bool"}];
rsBillingCustomerAssignmentAddresses=[{name:"id",type:"int"},{name:"id_customer_assignment",type:"int"},{name:"ip",type:"string"},{name:"mask",type:"int",convert:_convNull},{name:"description",type:"string"}];
rsBillingCustomerAssignmentNumbers=[{name:"id",type:"int"},{name:"id_customer_assignment",type:"int"},{name:"number",type:"string"},{name:"fixed",type:"int"},{name:"description",type:"string"}];
rsBillingCustomerAssignmentSensors=[{name:"id",type:"int"},{name:"id_customer_assignment",type:"int"},{name:"id_sensor",type:"int"},{name:"sensor_id",type:"int"},{name:"sensor_name",type:"string"}];
rsBillingExcludeAddresses=[{name:"id",type:"int"},{name:"side",type:"string"},{name:"ip",type:"string"},{name:"mask",type:"int",convert:_convNull},{name:"description",type:"string"}];
rsBillingExcludeNumbers=[{name:"id",type:"int"},{name:"side",type:"string"},{name:"number",type:"string"},{name:"fixed",type:"int"},{name:"description",type:"string"}];
rsBillingExcludeDomains=[{name:"id",type:"int"},{name:"side",type:"string"},{name:"domain",type:"string"},{name:"description",type:"string"}];
rsBillingAgregationSettings=[{name:"enable_by_ip",type:"int"},{name:"enable_by_number",type:"int"},{name:"enable_by_domain",type:"int"},{name:"week_start",type:"int"},{name:"hours_history_in_days",type:"int"},{name:"days_history_in_weeks",type:"int"},{name:"weeks_history_in_months",type:"int"},{name:"months_history_in_years",type:"int"}];
rsTrackerStatus=[{name:"id",type:"int"},{name:"status",type:"string"},{name:"status_type",type:"int"},{name:"color_text",type:"string"},{name:"color_background",type:"string"},{name:"description",type:"string"},{name:"default_select",type:"int"}];
rsTrackerCategory=[{name:"id",type:"int"},{name:"category",type:"string"},{name:"color_text",type:"string"},{name:"color_background",type:"string"},{name:"description",type:"string"},{name:"default_select",type:"int"}];
rsTrackerCategoryUser=[{name:"id",type:"int"},{name:"ticket_id",type:"int"},{name:"user_uid",type:"int"},{name:"user_name",type:"string"},{name:"description",type:"string"},{name:"auth_write_ticket",type:"int"},{name:"auth_delete_ticket",type:"int"},{name:"auth_new_comment",type:"int"},{name:"auth_write_comment",type:"int"},{name:"auth_delete_comment",type:"int"},{name:"auth_new_attachment",type:"int"},{name:"auth_write_attachment",type:"int"},{name:"auth_delete_attachment",type:"int"},{name:"created_uid",type:"int"},{name:"created_name",type:"string"},{name:"created_at",type:"date",dateFormat:__format_DateTimeDb},{name:"chenged_uid",type:"int"},{name:"changed_name",type:"string"},{name:"changed_at",type:"date",dateFormat:__format_DateTimeDb}];
rsTrackerPriority=[{name:"id",type:"int"},{name:"priority",type:"int"},{name:"color_text",type:"string"},{name:"color_background",type:"string"},{name:"description",type:"string"},{name:"default_select",type:"int"}];
rsTrackerTicket=[{name:"id",type:"int"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"status_id",type:"int",convert:_convNull},{name:"status_name",type:"string"},{name:"category_id",type:"int",convert:_convNull},{name:"category_name",type:"string"},{name:"priority",type:"int",convert:_convNull},{name:"assigned_uid",type:"int",convert:_convNull},{name:"assigned_name",type:"string"},{name:"deadline",type:"date",dateFormat:__format_DateTimeDb},{name:"created_uid",type:"int"},{name:"created_name",type:"string"},{name:"created_at",type:"date",dateFormat:__format_DateTimeDb},{name:"chenged_uid",type:"int"},{name:"changed_name",type:"string"},{name:"changed_at",type:"date",dateFormat:__format_DateTimeDb},{name:"priority_color_text",type:"string"},{name:"priority_color_background",type:"string"},{name:"status_color_text",type:"string"},{name:"status_color_background",type:"string"},{name:"category_color_text",type:"string"},{name:"category_color_background",type:"string"},{name:"exist_alert_descr",type:"integer"},{name:"alert_descr",type:"string"},{name:"ticket_url",type:"string"}];
rsTrackerTicketComment=[{name:"type",type:"string"},{name:"id",type:"int"},{name:"ticket_id",type:"int"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"alert_descr",type:"string"},{name:"alert_off",type:"int"},{name:"attachment_name",type:"string"},{name:"attachment_size",type:"int"},{name:"attachment_type",type:"string"},{name:"attachment_th_size",type:"int"},{name:"change_field",type:"string"},{name:"new_value",type:"string"},{name:"old_value",type:"string"},{name:"created_uid",type:"int"},{name:"created_name",type:"string"},{name:"created_at",type:"date",dateFormat:__format_DateTimeDb},{name:"chenged_uid",type:"int"},{name:"changed_name",type:"string"},{name:"changed_at",type:"date",dateFormat:__format_DateTimeDb}];
rsTrackerTicketRelationCdr=[{name:"id",type:"int"},{name:"ticket_id",type:"int"},{name:"comment_id",type:"int"},{name:"cdr_id",type:"int"},{name:"created_uid",type:"int"},{name:"created_name",type:"string"},{name:"created_at",type:"date",dateFormat:__format_DateTimeDb}];
rsTrackerChangeLog=[{name:"id",type:"int"},{name:"ticket_id",type:"int"},{name:"user_id",type:"int"},{name:"comment_id",type:"int"},{name:"changed_uid",type:"int"},{name:"changed_name",type:"string"},{name:"changed_name",type:"string"}];
rsRegister=[{name:"ID",type:"int"},{name:"calldate",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"sipcallerip",type:"string"},{name:"sipcalledip",type:"string"},{name:"sipcallerport",type:"int"},{name:"sipcalledport",type:"int"},{name:"from_num",type:"string"},{name:"from_name",type:"string"},{name:"from_domain",type:"string"},{name:"to_num",type:"string"},{name:"to_domain",type:"string"},{name:"contact_num",type:"string"},{name:"contact_domain",type:"string"},{name:"digestusername",type:"string"},{name:"digestrealm",type:"string"},{name:"expires",type:"int"},{name:"expires_at",type:"date",dateFormat:__format_DateTimeDb},{name:"state",type:"int"},{name:"rrd_avg",type:"int"},{name:"ua_id",type:"int"},{name:"id_sensor",type:"int"},{name:"menu"},{name:"ua_str",type:"string"},{name:"sipcallerip-reg"},{name:"sipcalledip-reg"},{name:"from_num-reg"},{name:"to_num-reg"},{name:"contact_num-reg"},{name:"fname"},{name:"new_register",type:"int"},{name:"spool_index",type:"int",convert:_convNull}];
rsRegisterState=[{name:"ID",type:"int"},{name:"created_at",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"sipcallerip",type:"string"},{name:"sipcalledip",type:"string"},{name:"from_num",type:"string"},{name:"to_num",type:"string"},{name:"to_domain",type:"string"},{name:"contact_num",type:"string"},{name:"contact_domain",type:"string"},{name:"digestusername",type:"string"},{name:"expires",type:"int"},{name:"state",type:"int"},{name:"ua_id",type:"int"},{name:"id_sensor",type:"int"},{name:"menu"},{name:"ua_str",type:"string"},{name:"sipcallerip-reg"},{name:"sipcalledip-reg"},{name:"from_num-reg"},{name:"to_num-reg"},{name:"contact_num-reg"},{name:"fname"},{name:"spool_index",type:"int",convert:_convNull}];
rsRegisterFailed=[{name:"ID",type:"int"},{name:"counter",type:"int"},{name:"created_at",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"sipcallerip",type:"string"},{name:"sipcalledip",type:"string"},{name:"from_num",type:"string"},{name:"to_num",type:"string"},{name:"to_domain",type:"string"},{name:"contact_num",type:"string"},{name:"contact_domain",type:"string"},{name:"digestusername",type:"string"},{name:"ua_id",type:"int"},{name:"id_sensor",type:"int"},{name:"menu"},{name:"ua_str",type:"string"},{name:"sipcallerip-reg"},{name:"sipcalledip-reg"},{name:"from_num-reg"},{name:"to_num-reg"},{name:"contact_num-reg"},{name:"fname"},{name:"spool_index",type:"int",convert:_convNull}];
rsSipMsgActive=[{name:"ID",type:"int"},{name:"id_sensor",type:"int",convert:_convNull},{name:"type",type:"int",convert:_convNull},{name:"ip_src",type:"string"},{name:"ip_dst",type:"string"},{name:"port_src",type:"int",convert:_convNull},{name:"port_dst",type:"int",convert:_convNull},{name:"number_src",type:"string"},{name:"number_dst",type:"string"},{name:"domain_src",type:"string"},{name:"domain_dst",type:"string"},{name:"callername",type:"string"},{name:"callid",type:"string"},{name:"cseq",type:"int"},{name:"ua_src",type:"string"},{name:"ua_dst",type:"string"},{name:"request_time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"request_time_us",type:"int",convert:_convNull},{name:"request_first_time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"request_first_time_us_compl",type:"int",convert:_convNull},{name:"response_time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"response_time_us",type:"int",convert:_convNull},{name:"response_duration_ms",type:"int",convert:_convNull},{name:"response_number",type:"int",convert:_convNull},{name:"response_string",type:"string"},{name:"qualify_ok",type:"int"},{name:"exists_pcap",type:"int"},{name:"history",type:"string"}];
rsSipMsgActiveHistory=[{name:"time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"time_us",type:"int"},{name:"response_duration_ms",type:"int",convert:_convNull},{name:"response_number",type:"int",convert:_convNull},{name:"response_string",type:"string"},{name:"qualify_ok",type:"int"},{name:"callid",type:"string"},{name:"cseq",type:"int"},{name:"exists_pcap",type:"int"}];
rsSipMsg=[{name:"ID",type:"int"},{name:"id_sensor",type:"int",convert:_convNull},{name:"type",type:"int",convert:_convNull},{name:"time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"ip_src",type:"string"},{name:"ip_dst",type:"string"},{name:"ip_src_country_code",type:"string"},{name:"ip_dst_country_code",type:"string"},{name:"ip_src_country",type:"string"},{name:"ip_dst_country",type:"string"},{name:"port_src",type:"int",convert:_convNull},{name:"port_dst",type:"int",convert:_convNull},{name:"number_src",type:"string"},{name:"number_dst",type:"string"},{name:"number_src_country_code",type:"string"},{name:"number_dst_country_code",type:"string"},{name:"number_src_country",type:"string"},{name:"number_dst_country",type:"string"},{name:"domain_src",type:"string"},{name:"domain_dst",type:"string"},{name:"ua_src_id",type:"int",convert:_convNull},{name:"ua_dst_id",type:"int",convert:_convNull},{name:"ua_src",type:"string"},{name:"ua_dst",type:"string"},{name:"callername",type:"string"},{name:"callid",type:"string"},{name:"cseq",type:"int",convert:_convNull},{name:"request_id_content_type",type:"int",convert:_convNull},{name:"request_content_type",type:"string"},{name:"request_content_length",type:"int",convert:_convNull},{name:"request_content",type:"string"},{name:"request_content_html",type:"string"},{name:"response_id_content_type",type:"int",convert:_convNull},{name:"response_content_type",type:"string"},{name:"response_content_length",type:"int",convert:_convNull},{name:"response_content",type:"string"},{name:"response_content_html",type:"string"},{name:"response_number",type:"int",convert:_convNull},{name:"response_id",type:"int",convert:_convNull},{name:"response_string",type:"string"},{name:"time_us",type:"int",convert:_convNull},{name:"request_repetition",type:"int",convert:_convNull},{name:"request_time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"request_time_us",type:"int",convert:_convNull},{name:"response_time",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"response_time_us",type:"int",convert:_convNull},{name:"response_duration_ms",type:"int",convert:_convNull},{name:"qualify_ok",type:"bool",convert:_convNull},{name:"spool_index",type:"int",convert:_convNull},{name:"flags",type:"int",convert:_convNull}];
rsMessage=[{name:"ID",type:"int"},{name:"id_sensor",type:"int"},{name:"calldate",type:"string"},{name:"calldate_userformat",type:"string"},{name:"calldate2",type:"string"},{name:"caller",type:"string"},{name:"caller2",type:"string"},{name:"caller_domain",type:"string"},{name:"caller_reverse",type:"string"},{name:"caller_with_domain",type:"string"},{name:"callername",type:"string"},{name:"callername_reverse",type:"string"},{name:"called",type:"string"},{name:"called2",type:"string"},{name:"called_domain",type:"string"},{name:"called_reverse",type:"string"},{name:"called_with_domain",type:"string"},{name:"sipcallerip",type:"string"},{name:"sipcalledip",type:"string"},{name:"lastSIPresponseNum",type:"string"},{name:"lastresponse",type:"string"},{name:"sipresponse",type:"string"},{name:"fbasename",type:"string"},{name:"fbasename_orig",type:"string"},{name:"contenttype",type:"string"},{name:"message",type:"string"},{name:"message_html",type:"string"},{name:"menu",type:"string"},{name:"menu_pcap",type:"string"},{name:"lastSIPresponse",type:"string"},{name:"a_ua",type:"string"},{name:"b_ua",type:"string"},{name:"geopos_lat",type:"float"},{name:"geopos_lng",type:"float"},{name:"content_length",type:"int",convert:_convNull},{name:"proxy",type:"string"}];
rsMessage_stats=[{name:"id"},{name:"sipip",type:"string"},{name:"sip_ip",type:"string"},{name:"sip_hostname",type:"string"},{name:"lastSIPresponse",type:"string"},{name:"country_code",type:"string"},{name:"country",type:"string"},{name:"cb_ip_groups_id",type:"int"},{name:"cb_ip_groups_descr",type:"string"},{name:"phone_numb",type:"string"},{name:"cnt_all",type:"int"},{name:"checked",type:"integer"}];
rsMessage_tshark=[{name:"num",type:"integer"},{name:"find_pass",type:"integer"},{name:"time",type:"float"},{name:"srcip",type:"string"},{name:"srcport",type:"number"},{name:"direction",type:"string"},{name:"type",type:"string"},{name:"dstip",type:"string"},{name:"dstport",type:"number"},{name:"msg",type:"string"},{name:"protocol",type:"string"},{name:"spec_type",type:"string"}];
rsSs7=[{name:"ID",type:"int"},{name:"time_iam",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"time_acm",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"time_cpg",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"time_anm",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"time_rel",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"time_rlc",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"duration",type:"float",convert:_convNull},{name:"connect_duration",type:"float",convert:_convNull},{name:"progress_time",type:"float",convert:_convNull},{name:"cic",type:"int",convert:_convNull},{name:"satellite_indicator",type:"int",convert:_convNull},{name:"echo_control_device_indicator",type:"int",convert:_convNull},{name:"caller_partys_category",type:"int",convert:_convNull},{name:"caller_party_nature_of_address_indicator",type:"int",convert:_convNull},{name:"ni_indicator",type:"int",convert:_convNull},{name:"address_presentation_restricted_indicator",type:"int",convert:_convNull},{name:"screening_indicator",type:"int",convert:_convNull},{name:"transmission_medium_requirement",type:"int",convert:_convNull},{name:"called_party_nature_of_address_indicator",type:"int",convert:_convNull},{name:"inn_indicator",type:"int",convert:_convNull},{name:"m3ua_protocol_data_opc",type:"int",convert:_convNull},{name:"m3ua_protocol_data_dpc",type:"int",convert:_convNull},{name:"mtp3_opc",type:"int",convert:_convNull},{name:"mtp3_dpc",type:"int",convert:_convNull},{name:"opc",type:"int",convert:_convNull},{name:"dpc",type:"int",convert:_convNull},{name:"called_number",type:"string"},{name:"caller_number",type:"string"},{name:"called_number_reverse",type:"string"},{name:"caller_number_reverse",type:"string"},{name:"called_number_country_code",type:"string"},{name:"caller_number_country_code",type:"string"},{name:"called_number_country",type:"string"},{name:"caller_number_country",type:"string"},{name:"called_number_with_flag",type:"string"},{name:"caller_number_with_flag",type:"string"},{name:"src_ip",type:"string",convert:_convNull},{name:"dst_ip",type:"string",convert:_convNull},{name:"src_ip_host",type:"string"},{name:"dst_ip_host",type:"string"},{name:"src_ip_country_code",type:"string"},{name:"dst_ip_country_code",type:"string"},{name:"src_ip_country",type:"string"},{name:"dst_ip_country",type:"string"},{name:"src_ip_with_flag",type:"string"},{name:"dst_ip_with_flag",type:"string"},{name:"rel_cause_indicator",type:"int",convert:_convNull},{name:"state",type:"string"},{name:"last_message_type",type:"string"},{name:"id_sensor",type:"int"},{name:"menu",type:"string"},{name:"menu_pcap",type:"string"}];
rsSs7_tshark=[{name:"num",type:"integer"},{name:"time",type:"float"},{name:"msg",type:"string"},{name:"protocol",type:"string"},{name:"ss7_opc",type:"integer"},{name:"ss7_dpc",type:"integer"}];
rsHttp=[{name:"id",type:"int"},{name:"id_sensor",type:"int"},{name:"timestamp",type:"date",dateFormat:__format_DateTimeDb},{name:"time_usec",type:"integer"},{name:"srcip",type:"string"},{name:"dstip",type:"string"},{name:"srcport",type:"integer"},{name:"dstport",type:"integer"},{name:"url",type:"string"},{name:"http",type:"string"},{name:"body",type:"string"},{name:"callid",type:"string"},{name:"sessid",type:"string"},{name:"external_transaction_id",type:"string"},{name:"response_time",type:"date",dateFormat:__format_DateTimeDb},{name:"response_time_usec",type:"integer"},{name:"response_http",type:"string"},{name:"response_body",type:"string"}];
rsRtp_stats=[{name:"id"},{name:"saddr",type:"string"},{name:"saddr_hostname",type:"string"},{name:"count",type:"int"}];
rsIPaccIPsum=[{name:"addr",type:"string"},{name:"customer",type:"string"},{name:"customer_id",type:"integer"},{name:"customer_name"},{name:"customer_type"},{name:"addr_hostname",type:"string"},{name:"protocol",type:"string"},{name:"port",type:"string"},{name:"traffic_in",type:"number"},{name:"traffic_out",type:"number"},{name:"traffic_sum",type:"number"},{name:"traffic_voip_in",type:"number"},{name:"traffic_voip_out",type:"number"},{name:"traffic_voip_sum",type:"number"},{name:"traffic_in_hour",type:"number"},{name:"traffic_in_day",type:"number"},{name:"traffic_in_week",type:"number"},{name:"traffic_in_month",type:"number"},{name:"traffic_out_hour",type:"number"},{name:"traffic_out_day",type:"number"},{name:"traffic_out_week",type:"number"},{name:"traffic_out_month",type:"number"},{name:"traffic_sum_hour",type:"number"},{name:"traffic_sum_day",type:"number"},{name:"traffic_sum_week",type:"number"},{name:"traffic_sum_month",type:"number"},{name:"packets_in",type:"number"},{name:"packets_out",type:"number"},{name:"packets_sum",type:"number"},{name:"packets_voip_in",type:"number"},{name:"packets_voip_out",type:"number"},{name:"packets_voip_sum",type:"number"},{name:"packets_in_hour",type:"number"},{name:"packets_in_day",type:"number"},{name:"packets_in_week",type:"number"},{name:"packets_in_month",type:"number"},{name:"packets_out_hour",type:"number"},{name:"packets_out_day",type:"number"},{name:"packets_out_week",type:"number"},{name:"packets_out_month",type:"number"},{name:"packets_sum_hour",type:"number"},{name:"packets_sum_day",type:"number"},{name:"packets_sum_week",type:"number"},{name:"packets_sum_month",type:"number"},{name:"act_time",type:"date",dateFormat:__format_DateTimeDb},{name:"user_interval_from",type:"date",dateFormat:__format_DateTimeDb},{name:"user_interval_to",type:"date",dateFormat:__format_DateTimeDb}];
rsHostname=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"ip",type:"string"}];
rsPrefix=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"prefix",type:"string"},{name:"id_customer",type:"int",convert:_convNull}];
rsCountryPrefix=[{name:"id",type:"int"},{name:"prefix",type:"string"},{name:"country_code",type:"string"},{name:"country_name",type:"string"},{name:"advanced_mode",type:"bool"},{name:"number_regexp_cond",type:"string"},{name:"number_length_from",type:"integer",convert:_convNull},{name:"number_length_to",type:"integer",convert:_convNull},{name:"trim_prefixes",type:"string"},{name:"trim_prefix_length",type:"integer",convert:_convNull},{name:"international_local",type:"string"},{name:"description",type:"string"},{name:"prefix_regex",type:"string"}];
rsSensors=[{name:"id",type:"integer"},{name:"id_sensor",type:"integer"},{name:"name",type:"string"},{name:"host",type:"string"},{name:"port",type:"integer",convert:_convNull},{name:"is_server",type:"bool"},{name:"all_clients_in_active_calls",type:"bool"},{name:"read_timeout",type:"integer",convert:_convNull},{name:"remote_mysql_host",type:"string"},{name:"remote_mysql_db",type:"string"},{name:"remote_mysql_user",type:"string"},{name:"remote_mysql_pass",type:"string"},{name:"interface",type:"string"},{name:"tcpdump_folder",type:"string"},{name:"tcpdump_mount_folder",type:"string"},{name:"default_for_active_call",type:"integer"},{name:"color_background",type:"string"},{name:"color_chart",type:"string"},{name:"override_international_rules",type:"integer"},{name:"international_prefixes",type:"string"},{name:"international_number_min_length",type:"integer",convert:_convNull},{name:"international_number_min_length_prefixes_strict",type:"bool"},{name:"country_code_for_local_numbers",type:"string"},{name:"enable_check_napa_without_prefix",type:"bool"},{name:"min_length_napa_without_prefix",type:"int"},{name:"skip_prefixes",type:"string"},{name:"override_country_prefixes",type:"integer"},{name:"auto_upgrade",type:"bool"},{name:"auto_upgrade_at",type:"date",subtype:"time",dateFormat:__format_Time},{name:"auto_upgrade_week_days",type:"string"},{name:"auto_upgrade_email",type:"string"},{name:"auto_upgrade_enable_beta",type:"bool"},{name:"auto_upgrade_last_run_at",type:"date",dateFormat:__format_DateTimeDb},{name:"_nameField",type:"string"},{name:"get_stat",type:"string"},{name:"version",type:"string"},{name:"storingCdrLastWriteAt",type:"date",dateFormat:__format_DateTimeDb},{name:"storingCdrLastSavedAt",type:"date",dateFormat:__format_DateTimeDb},{name:"pbStatString",type:"string"},{name:"pbCountPacketDrop",type:"integer"},{name:"uptime",type:"integer"},{name:"count_live_sniffers",type:"integer"},{name:"upgrade_by_git",type:"integer"},{name:"use_new_config",type:"integer"},{name:"terminating_error",type:"string"},{name:"upgrade_version_stable",type:"string"},{name:"upgrade_version_beta",type:"string"},{name:"disable",type:"integer"}];
rsSensorLiveSniffers=[{name:"id",type:"integer"},{name:"uid",type:"integer"},{name:"user_name",type:"string"},{name:"state",type:"string"}];
rsSensorsStat=[{name:"id",type:"string"},{name:"id_sensor",type:"string"},{name:"name",type:"string"},{name:"host",type:"string"},{name:"port",type:"integer",convert:_convNull},{name:"get_stat",type:"string"},{name:"version",type:"string"},{name:"storingCdrLastWriteAt",type:"date",dateFormat:__format_DateTimeDb},{name:"storingCdrLastSavedAt",type:"date",dateFormat:__format_DateTimeDb},{name:"pbStatString",type:"string"},{name:"pbCountPacketDrop",type:"integer"},{name:"uptime",type:"integer"},{name:"count_live_sniffers",type:"integer"},{name:"upgrade_by_git",type:"integer"},{name:"use_new_config",type:"integer"},{name:"terminating_error",type:"string"}];
rsSensorConfig=[{name:"name"},{name:"type"},{name:"subtype"},{name:"value"},{name:"value_old"},{name:"default"},{name:"value_in_config"},{name:"value_in_db"},{name:"value_in_json"},{name:"set",type:"bool"},{name:"set_old",type:"bool"},{name:"set_in_config",type:"bool"},{name:"set_in_config_old",type:"bool"},{name:"set_in_db",type:"bool"},{name:"set_in_db_old",type:"bool"},{name:"set_in_json",type:"bool"},{name:"set_in_json_old",type:"bool"},{name:"menu"},{name:"group_id",type:"integer"},{name:"group"},{name:"subgroup"},{name:"group_subgroup_id",type:"integer"},{name:"group_subgroup"},{name:"subgroup_end",type:"bool"},{name:"level",type:"integer"},{name:"description"},{name:"help"},{name:"minor",type:"bool"},{name:"minor_group_if_not_set",type:"bool"},{name:"read_only",type:"bool"},{name:"disable_if"},{name:"always_show",type:"bool"},{name:"maximum",type:"integer"},{name:"minimum",type:"integer"},{name:"menu_value",type:"bool"},{name:"only_menu",type:"bool"},{name:"password",type:"bool"},{name:"subgroup_label",type:"bool"},{name:"id",type:"integer"},{name:"state"}];
rsUsersSensors=[{name:"id",type:"integer"},{name:"user_id",type:"integer"},{name:"sensor_id",type:"integer"},{name:"sensor_name",type:"string"},{name:"description",type:"string"}];
rsCountryPrefixSensors=[{name:"sensor_id",type:"int"},{name:"id",type:"int"},{name:"prefix",type:"string"},{name:"country_code",type:"string"},{name:"country_name",type:"string"},{name:"advanced_mode",type:"bool"},{name:"number_regexp_cond",type:"string"},{name:"number_length_from",type:"integer",convert:_convNull},{name:"number_length_to",type:"integer",convert:_convNull},{name:"trim_prefixes",type:"string"},{name:"trim_prefix_length",type:"integer",convert:_convNull},{name:"international_local",type:"string"},{name:"description",type:"string"},{name:"prefix_regex",type:"string"}];
rsIpaccCaptIp=[{name:"id",type:"integer"},{name:"ip",type:"string"},{name:"mask",type:"integer"},{name:"enable",type:"integer"},{name:"note"}];
rsIpaccConfigResellers=[{name:"id",type:"integer"},{name:"reseller",type:"string"},{name:"descr",type:"string"},{name:"app_header_text",type:"string"},{name:"uc_color_theme_shift_h",type:"integer"},{name:"uc_color_theme_shift_s",type:"integer"},{name:"uc_color_theme_shift_v",type:"integer"},{name:"uc_color_theme_shift",type:"string"},{name:"uc_font_main_menu",type:"string"},{name:"logo_name",type:"string"},{name:"logo_size",type:"int"},{name:"logo_type",type:"string"}];
rsCdrCharts=[{name:"id",type:"integer"},{name:"name",type:"string"},{name:"order_int",type:"integer"},{name:"description",type:"string"},{name:"config_chart",type:"string"},{name:"default",type:"integer"},{name:"disable",type:"integer"}];
rsCdrCustomHeaders=[{name:"id",type:"integer"},{name:"special_type",type:"string"},{name:"type",type:"string"},{name:"state",type:"string"},{name:"dynamic_table",type:"integer",convert:_convNull},{name:"dynamic_column",type:"integer",convert:_convNull},{name:"header_field",type:"string"},{name:"name",type:"string"},{name:"left_border",type:"string"},{name:"right_border",type:"string"},{name:"regular_expression",type:"string"},{name:"default_for_legs_by_header",type:"integer"},{name:"show_as_column",type:"integer"},{name:"width_column",type:"integer",convert:_convNull},{name:"show_as_column_spy",type:"integer"},{name:"width_column_spy",type:"integer",convert:_convNull},{name:"correlated_http_field",type:"string"},{name:"correlated_http_field_at_trim",type:"bool"},{name:"screen_popup_field",type:"bool"},{name:"description",type:"string"},{name:"select_occurrence",type:"integer"},{name:"cseq_method",type:"string"},{name:"sip_response_code",type:"string"},{name:"delete_at",type:"date",dateFormat:__format_DateTimeDb}];
rsMessageCustomHeaders=[{name:"id",type:"integer"},{name:"special_type",type:"string"},{name:"type",type:"string"},{name:"state",type:"string"},{name:"dynamic_table",type:"integer",convert:_convNull},{name:"dynamic_column",type:"integer",convert:_convNull},{name:"header_field",type:"string"},{name:"name",type:"string"},{name:"left_border",type:"string"},{name:"right_border",type:"string"},{name:"regular_expression",type:"string"},{name:"default_for_legs_by_header",type:"integer"},{name:"show_as_column",type:"integer"},{name:"width_column",type:"integer",convert:_convNull},{name:"correlated_http_field",type:"string"},{name:"description",type:"string"},{name:"select_occurrence",type:"integer"},{name:"cseq_method",type:"string"},{name:"sip_response_code",type:"string"},{name:"delete_at",type:"date",dateFormat:__format_DateTimeDb}];
rsSipMsgCustomHeaders=[{name:"id",type:"integer"},{name:"type",type:"string"},{name:"state",type:"string"},{name:"dynamic_table",type:"integer",convert:_convNull},{name:"dynamic_column",type:"integer",convert:_convNull},{name:"header_field",type:"string"},{name:"name",type:"string"},{name:"left_border",type:"string"},{name:"right_border",type:"string"},{name:"regular_expression",type:"string"},{name:"direction",type:"string"},{name:"show_as_column",type:"integer"},{name:"width_column",type:"integer",convert:_convNull},{name:"description",type:"string"},{name:"delete_at",type:"date",dateFormat:__format_DateTimeDb}];
rsMessageTypes=[{name:"id",type:"integer"},{name:"name",type:"string"},{name:"descr",type:"string"},{name:"like_content_type",type:"string"},{name:"like_message",type:"string"}];
rsMessageNoHashRules=[{name:"id",type:"integer"},{name:"name",type:"string"},{name:"msg_custom_headers_id",type:"integer"},{name:"custom_header",type:"string"},{name:"header_regexp",type:"string"},{name:"content_regexp",type:"string"},{name:"descr",type:"string"}];
rsCrontab=[{name:"id",type:"integer"},{name:"type",type:"string"},{name:"enable",type:"integer"},{name:"descr",type:"string"},{name:"type_at",type:"string"},{name:"every_day_align",type:"integer"},{name:"at_hour",type:"integer",convert:_convNull,enableZero:true},{name:"at_minute",type:"integer",convert:_convNull,enableZero:true},{name:"at_day_of_week",type:"string"},{name:"at_day_of_month",type:"int",convert:_convNull},{name:"time_interval",type:"string"},{name:"start_shift_minutes",type:"integer",convert:_convNull},{name:"use_last_record_id",type:"integer"},{name:"send_to",type:"string"},{name:"send_from",type:"string"},{name:"note",type:"string"},{name:"last_run_at",type:"date",dateFormat:__format_DateTimeDb},{name:"config_filter_cdr",type:"string"},{name:"config_filter_message",type:"string"},{name:"config_filter_reg",type:"string"},{name:"csv_store_prefix",type:"string"},{name:"csv_send_in_attachment",type:"string"},{name:"csv_delete_after_days",type:"integer",convert:_convNull},{name:"last_record_id",type:"integer"},{name:"custom_columns_enable",type:"bool"},{name:"custom_columns_config",type:"string"},{name:"custom_columns_group_by",type:"string"},{name:"custom_columns_group_by_direction",type:"string"},{name:"custom_columns_order_by",type:"string"},{name:"custom_columns_order_by_direction",type:"string"}];
rsCustomCleaning=[{name:"id",type:"integer"},{name:"type",type:"string"},{name:"enable",type:"integer"},{name:"descr",type:"string"},{name:"at_hour",type:"integer",convert:_convNull,enableZero:true},{name:"at_minute",type:"integer",convert:_convNull,enableZero:true},{name:"send_report_to",type:"string"},{name:"send_report_from",type:"string"},{name:"note",type:"string"},{name:"last_run_at",type:"date",dateFormat:__format_DateTimeDb},{name:"cleaning_db_records_enable",type:"integer",convert:_convNull,enableZero:true},{name:"cleaning_db_records_older_than_days",type:"integer",convert:_convNull,enableZero:true},{name:"cleaning_sip_pcaps_enable",type:"integer",convert:_convNull,enableZero:true},{name:"cleaning_sip_pcaps_older_than_days",type:"integer",convert:_convNull,enableZero:true},{name:"cleaning_rtp_pcaps_enable",type:"integer",convert:_convNull,enableZero:true},{name:"cleaning_rtp_pcaps_older_than_days",type:"integer",convert:_convNull,enableZero:true},{name:"config_filter_cdr",type:"string"},{name:"config_filter_message",type:"string"}];
rsCustomCleaningSettings=[{name:"enable_delete_records",type:"bool"},{name:"enable_delete_pcaps",type:"bool"}];
rsDashboardChartCacheSettings=[{name:"enable_for_all",type:"bool"},{name:"overlap_minutes",type:"integer"},{name:"compute_processes",type:"integer"},{name:"temporarily_suspended",type:"bool"},{name:"temporarily_autosuspended_if_sqlf_cdr_gt",type:"integer"}];
rsCustResellers=[{name:"id"},{name:"name",type:"string",length:256},{name:"username",type:"string",length:32},{name:"password",type:"string",length:32},{name:"vat",type:"string",length:100},{name:"address",type:"string",length:1000},{name:"exist_password",type:"bool"}];
rsCustCustomers=[{name:"id",type:"integer"},{name:"reseller_id",type:"integer"},{name:"customer_id",type:"integer"},{name:"name",type:"string",length:256},{name:"username",type:"string",length:32},{name:"password",type:"string",length:32},{name:"vat",type:"string",length:100},{name:"cust_id",type:"string",length:100},{name:"address",type:"string",length:1000},{name:"ip",type:"string",length:256},{name:"number",type:"string",length:256},{name:"enable_ip_detail",type:"bool"},{name:"enable_ip_detail_for_reseller",type:"bool"},{name:"exist_password",type:"bool"},{name:"reseller_name",type:"string"}];
rsCustCustomer_explore=[{name:"city_address_ctype"},{name:"city"},{name:"address"},{name:"connection_type"}];
rsCustCustomer_ip_detail=[{name:"ip"},{name:"city"},{name:"address"},{name:"connection_type"}];
rsBatchDownloadCdr=[{name:"id",type:"integer"},{name:"number"},{name:"number_name"},{name:"calldate",type:"date",dateFormat:[__format_DateTimeDb,__format_DateTimeMsDb]},{name:"cdr_id",type:"integer"},{name:"caller"},{name:"called"},{name:"result"},{name:"cdr"}];
rsServerSideConfig=[{name:"type"},{name:"subtype"},{name:"default_value"},{name:"default_disabled",type:"bool"},{name:"context_enable"},{name:"array_values"},{name:"value"},{name:"disabled",type:"bool"},{name:"mainname"},{name:"var"},{name:"sep"},{name:"group"},{name:"maingroup"},{name:"name"},{name:"comment"}];
rsTcpdumpActive=[{name:"customer_id",type:"integer"},{name:"customer_name"},{name:"start_time",type:"date",dateFormat:__format_DateTimeDb}];
rsTcpdumpArchive=[{name:"customer_id",type:"integer"},{name:"customer_name"}];
rsTcpdumpArchiveL1=[{name:"start_time",type:"date",dateFormat:__format_DateTimeDb},{name:"end_time",type:"date",dateFormat:__format_DateTimeDb}];
rsTcpdumpArchiveL2=[{name:"start_time",type:"date",dateFormat:__format_DateTimeDb},{name:"server"},{name:"file_name"},{name:"file_size",type:"integer"}];
rsLocaleLang=[{name:"id",type:"integer"},{name:"lang_short"},{name:"lang"},{name:"note"},{name:"flag_name"}];
rsLocaleString=[{name:"id",type:"integer"},{name:"type"},{name:"string_id"},{name:"string_group"},{name:"string_group_id"},{name:"string_en"},{name:"string_locale"},{name:"string_group_order",type:"integer"}];
rsCountryCode=[{name:"id",type:"integer"},{name:"parent_id",type:"integer"},{name:"code"},{name:"type"},{name:"name"}];
rsNetworkIpAddress=[{name:"id",type:"integer"},{name:"name"},{name:"interface"},{name:"mac_address"},{name:"vlan",type:"integer"},{name:"vlan_id"},{name:"type",type:"integer"},{name:"ip_address"},{name:"network_subnet"},{name:"dhcp_hostname"},{name:"dhcp_lease_time",type:"integer"},{name:"dhcp_vendor"}];
rsNetworkRouting=[{name:"id",type:"integer"},{name:"name"},{name:"network"},{name:"network_mask"},{name:"gateway"},{name:"source_ip"},{name:"interface"}];
rsNetworkDNS=[{name:"hostname"},{name:"domain"},{name:"dns_1"},{name:"dns_2"},{name:"dns_3"}];
rsNetworkBridge=[{name:"id",type:"integer"},{name:"interface_name"},{name:"description"}];
rsNetworkBridgeInterfaces=[{name:"id",type:"integer"},{name:"interface"},{name:"id_network_bridge",type:"int"}];
rsNetworkInterfaces=[{name:"name"}];
rsGeoipCustomerType=[{name:"id",type:"integer"},{name:"latitude",type:"float",convert:_convNull},{name:"longitude",type:"float",convert:_convNull},{name:"country_code",type:"string"},{name:"country_name",type:"string"},{name:"descr"},{name:"note"}];
rsGeoipCustomer=[{name:"id",type:"integer"},{name:"type_id",type:"integer"},{name:"ip",type:"string"},{name:"mask",type:"integer"},{name:"ip_from",type:"string"},{name:"ip_to",type:"string"},{name:"latitude",type:"float",convert:_convNull},{name:"longitude",type:"float",convert:_convNull},{name:"country_code",type:"string"},{name:"country_name",type:"string"},{name:"descr"},{name:"note"}];
rsSipMsgQualify=[{name:"id",type:"int"},{name:"name",type:"string"},{name:"type",type:"string"},{name:"ip_src",type:"string"},{name:"ip_dst",type:"string"},{name:"ip_src_group",type:"string"},{name:"ip_dst_group",type:"string"},{name:"number_src",type:"string"},{name:"number_dst",type:"string"},{name:"number_src_group",type:"string"},{name:"number_dst_group",type:"string"},{name:"domain_src",type:"string"},{name:"domain_dst",type:"string"},{name:"domain_src_group",type:"string"},{name:"domain_dst_group",type:"string"},{name:"ok_qualify_limit",type:"int"},{name:"ok_responses",type:"string"},{name:"descr",type:"string"}];
rsSipMsgQualifySettings=[{name:"ok_qualify_limit",type:"int"},{name:"ok_responses",type:"string"}];
rsLogSensor=[{name:"ID",type:"integer"},{name:"time",type:"date",dateFormat:__format_DateTimeDb},{name:"ID_parent",type:"integer"},{name:"id_sensor",type:"integer",convert:_convNull},{name:"type"},{name:"confirmed",type:"bool"},{name:"subject"},{name:"message"},{name:"is_group",type:"bool"}];
function autoFillDataStructCustomHeaders(){for(var h=1;
h<=4;
h++){var b;
var g;
switch(h){case 1:b=getDataCdrCustomHeaders();
g="rsCDR";
break;
case 2:b=getDataCdrCustomHeaders();
g="rsSPY";
break;
case 3:b=getDataMessageCustomHeaders();
g="rsMessage";
break;
case 4:b=getDataSipMsgCustomHeaders();
g="rsSipMsg";
break
}var d=0;
if(b){for(var f=0;
f<b.length;
f++){if(b[f].type=="dynamic"){if(b[f].dynamic_table>d){d=b[f].dynamic_table*1
}}else{if(getDataArrayIndex(window[g],b[f]._column_unique,"name")===null){window[g].push({name:b[f]._column_unique,type:"string"})
}}}}for(var f=1;
f<=(d+1);
f++){for(var c=1;
c<=10;
c++){var a="custom_header_"+f+"_"+c;
if(getDataArrayIndex(window[g],a,"name")===null){window[g].push({name:a,type:"string"})
}}}}}rsNagios_timeperiod=[];
rsNagios_timeperiod_define=[];
rsNagios_timeperiod_exclude=[];
rsNagios_command=[];
rsNagios_contact=[];
rsNagios_contact_notification_command=[];
rsNagios_contactgroup=[];
rsNagios_contactgroup_contact=[];
rsNagios_host=[];
rsNagios_host_parent_host=[];
rsNagios_host_contact=[];
rsNagios_host_contactgroup=[];
rsNagios_hostgroup=[];
rsNagios_hostgroup_host=[];
rsNagios_service=[];
rsNagios_service_host=[];
rsNagios_service_hostgroup=[];
rsNagios_service_contact=[];
rsNagios_service_contactgroup=[];
rsNagios_servicegroup=[];
rsNagios_servicegroup_service=[];
function autoFillDataStructNagios(){autoFillDataStructFromDb(["nagios_timeperiod","nagios_timeperiod_define","nagios_timeperiod_exclude","nagios_command","nagios_contact","nagios_contact_notification_command","nagios_contactgroup","nagios_contactgroup_contact","nagios_host","nagios_host_parent_host","nagios_host_contact","nagios_host_contactgroup","nagios_hostgroup","nagios_hostgroup_host","nagios_service","nagios_service_host","nagios_service_hostgroup","nagios_service_contact","nagios_service_contactgroup","nagios_servicegroup","nagios_servicegroup_service"],[rsNagios_timeperiod,rsNagios_timeperiod_define,rsNagios_timeperiod_exclude,rsNagios_command,rsNagios_contact,rsNagios_contact_notification_command,rsNagios_contactgroup,rsNagios_contactgroup_contact,rsNagios_host,rsNagios_host_parent_host,rsNagios_host_contact,rsNagios_host_contactgroup,rsNagios_hostgroup,rsNagios_hostgroup_host,rsNagios_service,rsNagios_service_host,rsNagios_service_hostgroup,rsNagios_service_contact,rsNagios_service_contactgroup,rsNagios_servicegroup,rsNagios_servicegroup_service]);
fillDataStruct_nagiosStatus(rsNagios_host);
fillDataStruct_nagiosStatus(rsNagios_host_contact);
fillDataStruct_nagiosStatus(rsNagios_service_host);
rsNagios_host_contact.push({name:"address"})
}function autoFillDataStructFromDb(b,a){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getTableStruct",params:Ext.encode({tableNames:b})},success:function(c){if(c.tableStruct){for(var d=0;
d<c.tableStruct.length;
d++){fillDataStructFromDbData(c.tableStruct[d],a[d])
}}}})
}function fillDataStructFromDbData(d,a){if(!d){return
}for(var b=0;
b<d.length;
b++){var c={};
if(d[b].Field){c.name=d[b].Field
}if(d[b].Type){if(d[b].Type.match(/int/)){c.type="integer"
}else{if(d[b].Type.match(/double/)){c.type="float"
}else{if(d[b].Type.match(/bool/)){c.type="bool"
}}}}if(c.type&&d[b].Null!="NO"){c.convert=_convNull
}a.push(c);
if(c.type=="integer"&&c.name.match(/_id$/)){a.push({name:c.name.substr(0,c.name.search("_id"))})
}}}function fillDataStruct_nagiosStatus(a){a.push({name:"status_current_state",type:"integer"});
a.push({name:"status_current_state_str"});
a.push({name:"status_plugin_output"});
a.push({name:"status_performance_data"});
a.push({name:"status_current_attempt",type:"integer"});
a.push({name:"status_last_check",type:"integer"});
a.push({name:"status_last_check_time",type:"date",dateFormat:__format_DateTimeDb});
a.push({name:"status_last_update",type:"integer"});
a.push({name:"status_last_update_time",type:"date",dateFormat:__format_DateTimeDb})
}function setArrays(){arExtScriptIds={};
arExtScriptIds[_EmailAlertType_Register_check_active]=[["active_total","active_total","Number of registrations"]];
arExtScriptIds[_EmailAlertType_Register_unreg]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["ID","ID","id"],["id_sensor","id_sensor","Sensor ID"],["from_domain","from_domain","Src domain"],["digestrealm","digestrealm","Realm"],["from_name","from_name","From name"],["ua","ua","User agent"],["calldate","calldate","Date of call"],["expires_at","expires_at","Expire time"],["expires","expires","Number of expires"],["state","state","State"],["rrd_avg","rrd_avg","Average Registration Request Delay"],["fname","fname","Pcap filename"]];
arExtScriptIds[_EmailAlertType_Register_failed]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["ID","ID","id"],["id_sensor","id_sensor","Sensor ID"],["counter","counter","Counter"],["created_at","created_at","Creation date"],["ua_id","ua_id","ua_id"],["fname","fname","Pcap filename"]];
arExtScriptIds[_EmailAlertType_Register_ua]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["at","at","Date"],["prev_state_at","prev_state_at","Date of previous state"],["time_from_prev_state","time_from_prev_state","Time from previous state"],["from_domain","from_domain","Src domain"],["digestrealm","digestrealm","Realm"],["from_name","from_name","From name"],["ua","ua","User agent"],["prev_state","prev_state","Previous tate"],["state","state","State"]];
arExtScriptIds[_EmailAlertType_Register_short]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["at","at","Date"],["prev_state_at","prev_state_at","Date of previous state"],["time_from_prev_state","time_from_prev_state","Time from previous state"],["from_domain","from_domain","Src domain"],["digestrealm","digestrealm","Realm"],["from_name","from_name","From name"],["ua","ua","User agent"],["prev_state","prev_state","Previous tate"],["state","state","State"]];
arExtScriptIds[_EmailAlertType_Register_mult]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["ID","ID","id"],["id_sensor","id_sensor","Sensor ID"],["from_domain","from_domain","Src domain"],["digestrealm","digestrealm","Realm"],["from_name","from_name","From name"],["ua","ua","User agent"],["calldate","calldate","Date of call"],["expires_at","expires_at","Expire time"],["expires","expires","Number of expires"],["state","state","State"],["rrd_avg","rrd_avg","Average Registration Request Delay"],["fname","fname","Pcap filename"]];
arExtScriptIds[_EmailAlertType_Register_expire]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["at","at","Date"],["prev_state_at","prev_state_at","Date of previous state"],["time_from_prev_state","time_from_prev_state","Time from previous state"],["from_domain","from_domain","Src domain"],["digestrealm","digestrealm","Realm"],["from_name","from_name","From name"],["ua","ua","User agent"],["prev_state","prev_state","Previous tate"],["state","state","State"]];
arExtScriptIds[_EmailAlertType_Register_rrd]=[["sipcallerip","sipcallerip","SIP src ip"],["sipcalledip","sipcalledip","SIP dst ip"],["from_num","from_num","Caller number"],["to_num","to_num","Called number"],["contact_num","contact_num","Contact number"],["contact_domain","contact_domain","Contact domain"],["digestusername","digestusername","Username"],["to_domain","to_domain","Dst domain"],["ID","ID","id"],["id_sensor","id_sensor","Sensor ID"],["from_domain","from_domain","Src domain"],["digestrealm","digestrealm","Realm"],["from_name","from_name","From name"],["ua","ua","User agent"],["calldate","calldate","Date of call"],["expires_at","expires_at","Expire time"],["expires","expires","Number of expires"],["state","state","State"],["rrd_avg","rrd_avg","Average Registration Request Delay"],["fname","fname","Pcap filename"]];
arCodec=[[0,"PAYLOAD_PCMU","G.711u"],[3,"PAYLOAD_GSM","GSM"],[4,"PAYLOAD_G723","G723"],[8,"PAYLOAD_PCMA","G.711a"],[9,"PAYLOAD_G722","G.722"],[12,"PAYLOAD_QCELP","QCELP"],[13,"PAYLOAD_CN","CN"],[18,"PAYLOAD_G729","G729"],[97,"PAYLOAD_ILBC","iLBC"],[98,"PAYLOAD_SPEEX","speex"],[301,"PAYLOAD_SILK","SILK"],[302,"PAYLOAD_SILK8","SILK8"],[303,"PAYLOAD_SILK12","SILK12"],[304,"PAYLOAD_SILK16","SILK16"],[305,"PAYLOAD_SILK24","SILK24"],[306,"PAYLOAD_ISAC","ISAC"],[307,"PAYLOAD_ISAC16","ISAC16"],[308,"PAYLOAD_ISAC32","ISAC32"],[311,"PAYLOAD_OPUS","OPUS"],[312,"PAYLOAD_OPUS8","OPUS8"],[313,"PAYLOAD_OPUS12","OPUS12"],[314,"PAYLOAD_OPUS16","OPUS16"],[315,"PAYLOAD_OPUS24","OPUS24"],[316,"PAYLOAD_OPUS48","OPUS48"],[320,"PAYLOAD_AMR","AMR"],[321,"PAYLOAD_AMRWB","AMR WB"],[331,"PAYLOAD_G7221","G7221"],[332,"PAYLOAD_G72218","G72218"],[333,"PAYLOAD_G722112","G722112"],[334,"PAYLOAD_G722116","G722116"],[335,"PAYLOAD_G722124","G722124"],[336,"PAYLOAD_G722148","G722148"],[337,"PAYLOAD_XOPUS","XOPUS"],[338,"PAYLOAD_XOPUS8","XOPUS8"],[339,"PAYLOAD_XOPUS12","XOPUS12"],[340,"PAYLOAD_XOPUS16","XOPUS16"],[341,"PAYLOAD_XOPUS24","XOPUS24"],[342,"PAYLOAD_XOPUS48","XOPUS48"],[343,"PAYLOAD_VXOPUS","VXOPUS"],[344,"PAYLOAD_VXOPUS8","VXOPUS8"],[345,"PAYLOAD_VXOPUS12","VXOPUS12"],[346,"PAYLOAD_VXOPUS16","VXOPUS16"],[347,"PAYLOAD_VXOPUS24","VXOPUS24"],[348,"PAYLOAD_VXOPUS48","VXOPUS48"],[1000,"PAYLOAD_T38","FAX T.38"],[1001,"PAYLOAD_T30","FAX T.30"],[100,"PAYLOAD_CLEARMODE","CLEARMODE"]];
arDelay=[[50,">= 50 ms"],[70,">= 70 ms"],[90,">= 90 ms"],[120,">= 120 ms"],[150,">= 150 ms"],[200,">= 200 ms"],[300,">= 300 ms"]];
arNationalOrInternational=[[0,"national + international"],[1,"only national"],[2,"only international"]];
arTrunk=[[1,"IN"],[2,"OUT"],[3,"INTERNAL"]];
arSipMethod=[[1,"INVITE"],[2,"BYE"],[3,"CANCEL"],[4,"REGISTER"],[5,"MESSAGE"],[6,"INFO"],[7,"SUBSCRIBE"],[8,"OPTIONS"],[9,"NOTIFY"],[10,"ACK"],[11,"PRACK"],[12,"PUBLISH"],[13,"REFER"],[14,"UPDATE"]];
arFirstLastValue=[[0,"Sensors setting"],[1,"First found value"],[2,"Last found value"]];
arAuditActivity=[[_AuditActivity_download_wav,arLang.LauditActivity_download_wav],[_AuditActivity_download_pcap,arLang.LauditActivity_download_pcap],[_AuditActivity_play_wav,arLang.LauditActivity_play_wav],[_AuditActivity_show_fax,arLang.LauditActivity_show_fax],[_AuditActivity_batch_download,arLang.LauditActivity_batch_download],[_AuditActivity_filterFormCDR,arLang.LauditActivity_filterFormCDR],[_AuditActivity_login,arLang.LauditActivity_login],[_AuditActivity_logout,arLang.LauditActivity_logout],[_AuditActivity_liveSnifferStart,arLang.LauditActivity_liveSnifferStart],[_AuditActivity_liveSnifferStop,arLang.LauditActivity_liveSnifferStop]];
arRegState=[[_RegState_OK,arLang.LregState_OK,"#5FC40C"],[_RegState_Failed,arLang.LregState_Failed],[_RegState_UnknownMessageOK,arLang.LregState_UnknownMessageOK],[_RegState_ManyRegMessages,arLang.LregState_ManyRegMessages],[_RegState_Expired,arLang.LregState_Expired,"red"],[_RegState_Unregister,arLang.LregState_Unregister,"#FFD941"]];
arTrackerStatusType=[[_TrackerStatusType_Open,arLang.LtrackerStatusType_Open],[_TrackerStatusType_Closed,arLang.LtrackerStatusType_Closed]];
arTrackerPriority=[[1,arLang.LtrackerPriotity_1],[2,arLang.LtrackerPriotity_2],[3,arLang.LtrackerPriotity_3],[4,arLang.LtrackerPriotity_4],[5,arLang.LtrackerPriotity_5]];
arAlertType=[[_EmailAlertType_RTP,arLang.LemailAlertType_RTP,arLang.LemailAlertType_RTP_descr],[_EmailAlertType_SIP_response,arLang.LemailAlertType_SIP_response,arLang.LemailAlertType_SIP_response_descr]];
if(window.existsCdrReason){arAlertType.push([_EmailAlertType_ReasonSipQ850,arLang.LemailAlertType_ReasonSipQ850,arLang.LemailAlertType_ReasonSipQ850_descr])
}arAlertType.push([_EmailAlertType_CPS,arLang.LemailAlertType_CPS,arLang.LemailAlertType_CPS_descr]);
if(window.existsDscpCdr){arAlertType.push([_EmailAlertType_DSCP,arLang.LemailAlertType_DSCP,arLang.LemailAlertType_DSCP_descr])
}arAlertType.push([_EmailAlertType_ASR,arLang.LemailAlertType_ASR,arLang.LemailAlertType_ASR_descr],[_EmailAlertType_NER,arLang.LemailAlertType_NER,arLang.LemailAlertType_NER_descr],[_EmailAlertType_ACD,arLang.LemailAlertType_ACD,arLang.LemailAlertType_ACD_descr],[_EmailAlertType_InternalProxyError,arLang.LemailAlertType_InternalProxyError,arLang.LemailAlertType_InternalProxyError_descr],[_EmailAlertType_CALL_TIMEDOUT,arLang.LemailAlertType_CALL_TIMEDOUT,arLang.LemailAlertType_CALL_TIMEDOUT_descr],[_EmailAlertType_TimeWithoutCall,arLang.LemailAlertType_TimeWithoutCall,arLang.LemailAlertType_TimeWithoutCall_descr],[_EmailAlertType_ConcurrentCalls,arLang.LemailAlertType_ConcurrentCalls,arLang.LemailAlertType_ConcurrentCalls_descr],[_EmailAlertType_Sensors,arLang.LemailAlertType_Sensors,arLang.LemailAlertType_Sensors_descr],[_EmailAlertType_Fraud_RCC,arLang.LemailAlertType_Fraud_RCC,arLang.LemailAlertType_Fraud_RCC_descr],[_EmailAlertType_Fraud_CHC,arLang.LemailAlertType_Fraud_CHC,arLang.LemailAlertType_Fraud_CHC_descr],[_EmailAlertType_Fraud_CHCR,arLang.LemailAlertType_Fraud_CHCR,arLang.LemailAlertType_Fraud_CHCR_descr],[_EmailAlertType_Fraud_D,arLang.LemailAlertType_Fraud_D,arLang.LemailAlertType_Fraud_D_descr],[_EmailAlertType_Fraud_SPC,arLang.LemailAlertType_Fraud_SPC,arLang.LemailAlertType_Fraud_SPC_descr],[_EmailAlertType_Fraud_RC,arLang.LemailAlertType_Fraud_RC,arLang.LemailAlertType_Fraud_RC_descr],[_EmailAlertType_Fraud_Seq,arLang.LemailAlertType_Fraud_Seq,arLang.LemailAlertType_Fraud_Seq_descr],[_EmailAlertType_Fraud_BilingOverQuota,arLang.LemailAlertType_Fraud_BilingOverQuota,arLang.LemailAlertType_Fraud_BilingOverQuota_descr],[_EmailAlertType_Fraud_BilingHighRate,arLang.LemailAlertType_Fraud_BilingHighRate,arLang.LemailAlertType_Fraud_BilingHighRate_descr]);
arAlertType.push([_EmailAlertType_Register_check_active,arLang.LemailAlertType_Register_check_active,arLang.LemailAlertType_Register_check_active_descr],[_EmailAlertType_Register_unreg,arLang.LemailAlertType_Register_unreg,arLang.LemailAlertType_Register_unreg_desr],[_EmailAlertType_Register_failed,arLang.LemailAlertType_Register_failed,arLang.LemailAlertType_Register_failed_desr],[_EmailAlertType_Register_ua,arLang.LemailAlertType_Register_ua,arLang.LemailAlertType_Register_ua_desr],[_EmailAlertType_Register_short,arLang.LemailAlertType_Register_short,arLang.LemailAlertType_Register_short_desr],[_EmailAlertType_Register_mult,arLang.LemailAlertType_Register_mult,arLang.LemailAlertType_Register_mult_desr],[_EmailAlertType_Register_expire,arLang.LemailAlertType_Register_expire,arLang.LemailAlertType_Register_expire_desr],[_EmailAlertType_Register_rrd,arLang.LemailAlertType_Register_rrd,arLang.LemailAlertType_Register_rrd_desr]);
arAlertType.push([_EmailAlertType_SipMsg_qualify,arLang.LemailAlertType_SipMsg_qualify,arLang.LemailAlertType_SipMsg_qualify_desr]);
arDailyReportType=[[_EmailDailyReportType_RTP,arLang.LemailDailyReportType_RTP],[_EmailDailyReportType_ProxyDegradMOS,arLang.LemailDailyReportType_ProxyDegradMOS],[_EmailDailyReportType_CdrSummary,arLang.LemailDailyReportType_CdrSummary],[_EmailDailyReportType_ConcurrentCallStat,arLang.LemailDailyReportType_ConcurrentCallStat],[_EmailDailyReportType_Chart,arLang.LemailDailyReportType_Chart],[_EmailDailyReportType_ConcurrentCallStat_license_chart,arLang.LemailDailyReportType_ConcurrentCallStat_license_chart]];
arFileFormat_Image_SvgPng=[[_FileFormat_Image_Svg,arLang.LfileFormat_Image_Svg],[_FileFormat_Image_Png,arLang.LfileFormat_Image_Png]];
arCdrFields_forCdrCharts=[[_cdrFieldsCaller,arLang.LcdrFieldsCaller],[_cdrFieldsCalled,arLang.LcdrFieldsCalled],[_cdrFieldsSipIpSrc,arLang.LcdrFieldsSipIpSrc],[_cdrFieldsSipIpDst,arLang.LcdrFieldsSipIpDst],[_cdrFieldsRtpIpSrc,arLang.LcdrFieldsRtpIpSrc],[_cdrFieldsRtpIpDst,arLang.LcdrFieldsRtpIpDst]];
arCdrSideCharts=[[1,_cdrSide_Src,arLang.LcdrSideSrc],[2,_cdrSide_Dst,arLang.LcdrSideDst],[3,_cdrSide_Both,arLang.LcdrSideBoth]];
arCallerCalledSide=[[_side_CallerNum,_side_Caller,arLang.LsideCaller],[_side_CalledNum,_side_Called,arLang.LsideCalled]];
arType_IpOrNumber=[[1,"ip",arLang.Ltype_IpOrNumber_ip],[2,"number",arLang.Ltype_IpOrNumber_number]];
arSipMsg_Type=[[_sipMsg_OPTIONS,arLang.LsipMsg_OPTIONS],[_sipMsg_SUBSCRIBE,arLang.LsipMsg_SUBSCRIBE],[_sipMsg_NOTIFY,arLang.LsipMsg_NOTIFY]];
arReqRespDirection=[["request",arLang.LreqRespDirection_request],["response",arLang.LreqRespDirection_response],["both",arLang.LreqRespDirection_both]];
arTypeFraudAlertRule=[[1,"src_ip__blacklist",arLang.LtypeFraudAlertRule_src_ip__blacklist],[2,"src_ip__blacklist_countries",arLang.LtypeFraudAlertRule_src_ip__blacklist_countries],[3,"src_ip__blacklist_area",arLang.LtypeFraudAlertRule_src_ip__blacklist_area],[4,"src_ip__change",arLang.LtypeFraudAlertRule_src_ip__change],[5,"ua__blacklist",arLang.LtypeFraudAlertRule_ua__blacklist],[6,"dst_num__blacklist",arLang.LtypeFraudAlertRule_dst_num__blacklist],[7,"dst_num__blacklist_countries",arLang.LtypeFraudAlertRule_dst_num__blacklist_countries],[8,"dst_num__blacklist_area",arLang.LtypeFraudAlertRule_dst_num__blacklist_area],[9,"price__per_call",arLang.LtypeFraudAlertRule_price__per_call],[10,"price__during_interval",arLang.LtypeFraudAlertRule_price__during_interval],[11,"same_number",arLang.LtypeFraudAlertRule_same_number],[12,"international_number_limit",arLang.LtypeFraudAlertRule_international_number_limit],[13,"concurrent_calls",arLang.LtypeFraudAlertRule_concurrent_calls]];
arIntervalFraudAlertRule=[[1,"1min",arLang.LIntervalFraudAlertRule_1min],[2,"5min",arLang.LIntervalFraudAlertRule_5min],[3,"15min",arLang.LIntervalFraudAlertRule_15min],[4,"hour",arLang.LIntervalFraudAlertRule_hour],[5,"day",arLang.LIntervalFraudAlertRule_day],[6,"week",arLang.LIntervalFraudAlertRule_week],[7,"month",arLang.LIntervalFraudAlertRule_month]];
arRegisterAlertListType=[[0,arLang.LRegisterAlertListType_none],[1,arLang.LRegisterAlertListType_ip_ua]];
arCdrGroupBy=[];
arMessageGroupBy=[];
arCdrChart_timeAxisTypes={TA_SECONDS:{format:"H:i:s",step:1,factor:[5,10,15,30,60,120]},TA_MINUTES:{format:"d H:i",step:60,factor:[5,10,15,30,60,120]},TA_MINUTES_FROM_ACT:{format:"d H:i",step:60,factor:[5,10,15,30,60,120]},TA_5MINUTES:{format:"d H:i",step:60*5,factor:[3,6,12,24,48]},TA_10MINUTES:{format:"d H:i",step:60*10,factor:[3,6,12,24,48]},TA_QUARTER:{format:"d H:i",step:60*15,factor:[2,4,8,16,32]},TA_QUARTER_FROM_ACT:{format:"d H:i",step:60*15,factor:[2,4,8,16,32]},TA_HOURS:{format:"d H:i",step:60*60},TA_HOURS_FROM_ACT:{format:"d H:i",step:60*60},TA_2HOURS:{format:"d H:i",step:60*60*2},TA_2HOURS_FROM_ACT:{format:"d H:i",step:60*60*2},TA_DAYS:{format:"m-d",step:60*60*24},TA_DAYS_FROM_ACT:{format:"m-d",step:60*60*24},TA_WEEKS:{format:"m-d",step:60*60*24*7},TA_WEEKS_FROM_SUNDAY:{format:"m-d",step:60*60*24*7},TA_WEEKS_FROM_ACT:{format:"m-d",step:60*60*24*7},TA_MONTHS:{format:"Y-m",step:60*60*24*30.5},TA_MONTHS_FROM_ACT:{format:"Y-m",step:60*60*24*30.5},TA_YEARS:{format:"Y",step:60*60*24*365.25},TA_YEARS_FROM_ACT:{format:"Y",step:60*60*24*365.25}};
arTimeIntervals=[["last_hour",arLang.LtimeInterval_last_hour],["last_2h",arLang.LtimeInterval_last_2h],["last_3h",arLang.LtimeInterval_last_3h],["last_8h",arLang.LtimeInterval_last_8h],["last_24h",arLang.LtimeInterval_last_24h],["last_2d",arLang.LtimeInterval_last_2d],["last_3d",arLang.LtimeInterval_last_3d],["last_7d",arLang.LtimeInterval_last_7d],["last_8d",arLang.LtimeInterval_last_8d],["last_30d",arLang.LtimeInterval_last_30d],["last_60d",arLang.LtimeInterval_last_60d],["last_90d",arLang.LtimeInterval_last_90d],["this_hour",arLang.LtimeInterval_this_hour],["today",arLang.LtimeInterval_today,60*60*24],["yesterday",arLang.LtimeInterval_yesterday,60*60*24],["this_week_m",arLang.LtimeInterval_this_week_from_monday,60*60*24*7],["this_week_s",arLang.LtimeInterval_this_week_from_sunday,60*60*24*7],["this_month",arLang.LtimeInterval_this_month,60*60*24*30.5],["prev_month",arLang.LtimeInterval_prev_month,60*60*24*30.5]];
arCdrChart_chartTypes=[["TCH_count",arLang.LtypeChart_TCH_count],["TCH_cps",arLang.LtypeChart_TCH_cps],["TCH_minutes",arLang.LtypeChart_TCH_minutes]];
if(window.rtpQualityUse){arCdrChart_chartTypes.push(["TCH_mos_intervals",arLang.LtypeChart_TCH_mos_intervals],["TCH_mos",arLang.LtypeChart_TCH_mos],["TCH_mos_caller_intervals",arLang.LtypeChart_TCH_mos_caller_intervals],["TCH_mos_caller",arLang.LtypeChart_TCH_mos_caller],["TCH_mos_called_intervals",arLang.LtypeChart_TCH_mos_called_intervals],["TCH_mos_called",arLang.LtypeChart_TCH_mos_called])
}if(existsMosXrCdr&&window.rtpQualityUse){arCdrChart_chartTypes.push(["TCH_mos_xr_avg_intervals",arLang.LtypeChart_TCH_mos_xr_avg_intervals],["TCH_mos_xr_avg",arLang.LtypeChart_TCH_mos_xr_avg],["TCH_mos_xr_avg_caller",arLang.LtypeChart_TCH_mos_xr_avg_caller],["TCH_mos_xr_avg_called",arLang.LtypeChart_TCH_mos_xr_avg_called],["TCH_mos_xr_min_intervals",arLang.LtypeChart_TCH_mos_xr_min_intervals],["TCH_mos_xr_min",arLang.LtypeChart_TCH_mos_xr_min],["TCH_mos_xr_min_caller",arLang.LtypeChart_TCH_mos_xr_min_caller],["TCH_mos_xr_min_called",arLang.LtypeChart_TCH_mos_xr_min_called])
}if(existsMosSilenceCdr&&window.rtpQualityUse){arCdrChart_chartTypes.push(["TCH_mos_silence_avg_intervals",arLang.LtypeChart_TCH_mos_silence_avg_intervals],["TCH_mos_silence_avg",arLang.LtypeChart_TCH_mos_silence_avg],["TCH_mos_silence_avg_caller",arLang.LtypeChart_TCH_mos_silence_avg_caller],["TCH_mos_silence_avg_called",arLang.LtypeChart_TCH_mos_silence_avg_called],["TCH_mos_silence_min_intervals",arLang.LtypeChart_TCH_mos_silence_min_intervals],["TCH_mos_silence_min",arLang.LtypeChart_TCH_mos_silence_min],["TCH_mos_silence_min_caller",arLang.LtypeChart_TCH_mos_silence_min_caller],["TCH_mos_silence_min_called",arLang.LtypeChart_TCH_mos_silence_min_called])
}if(existsMosLqoCdr&&window.rtpQualityUse){arCdrChart_chartTypes.push(["TCH_mos_lqo_caller",arLang.LtypeChart_TCH_mos_lqo_caller],["TCH_mos_lqo_called",arLang.LtypeChart_TCH_mos_lqo_called])
}if(window.rtpQualityUse){arCdrChart_chartTypes.push(["TCH_packet_lost_intervals",arLang.LtypeChart_TCH_packet_lost_intervals],["TCH_packet_lost_caller_intervals",arLang.LtypeChart_TCH_packet_lost_caller_intervals],["TCH_packet_lost_called_intervals",arLang.LtypeChart_TCH_packet_lost_called_intervals],["TCH_packet_lost",arLang.LtypeChart_TCH_packet_lost],["TCH_jitter_intervals",arLang.LtypeChart_TCH_jitter_intervals],["TCH_jitter",arLang.LtypeChart_TCH_jitter],["TCH_delay",arLang.LtypeChart_TCH_delay_avg],["TCH_rtcp_avgjitter_intervals",arLang.LtypeChart_TCH_rtcp_avgjitter_intervals],["TCH_rtcp_avgjitter",arLang.LtypeChart_TCH_rtcp_avgjitter],["TCH_rtcp_maxjitter_intervals",arLang.LtypeChart_TCH_rtcp_maxjitter_intervals],["TCH_rtcp_maxjitter",arLang.LtypeChart_TCH_rtcp_maxjitter],["TCH_rtcp_avgfr_intervals",arLang.LtypeChart_TCH_rtcp_avgfr_intervals],["TCH_rtcp_avgfr",arLang.LtypeChart_TCH_rtcp_avgfr],["TCH_rtcp_maxfr_intervals",arLang.LtypeChart_TCH_rtcp_maxfr_intervals],["TCH_rtcp_maxfr",arLang.LtypeChart_TCH_rtcp_maxfr],["TCH_rtcp_avgrtd_intervals",arLang.LtypeChart_TCH_rtcp_avgrtd_intervals],["TCH_rtcp_avgrtd",arLang.LtypeChart_TCH_rtcp_avgrtd],["TCH_rtcp_maxrtd_intervals",arLang.LtypeChart_TCH_rtcp_maxrtd_intervals],["TCH_rtcp_maxrtd",arLang.LtypeChart_TCH_rtcp_maxrtd])
}arCdrChart_chartTypes.push(["TCH_acd_avg",arLang.LtypeChart_TCH_acd_avg],["TCH_acd",arLang.LtypeChart_TCH_acd],["TCH_asr_avg",arLang.LtypeChart_TCH_asr_avg],["TCH_asr",arLang.LtypeChart_TCH_asr],["TCH_ner_avg",arLang.LtypeChart_TCH_ner_avg],["TCH_ner",arLang.LtypeChart_TCH_ner],["TCH_pdd_intervals",arLang.LtypeChart_TCH_pdd_intervals],["TCH_pdd",arLang.LtypeChart_TCH_pdd],["TCH_sipResp",arLang.LtypeChart_TCH_sipResp],["TCH_sipResponse",arLang.LtypeChart_TCH_sipResponse],["TCH_sipResponse_base",arLang.LtypeChart_TCH_sipResponse_base],["TCH_codecs",arLang.LtypeChart_TCH_codecs],["TCH_IP_src",arLang.LtypeChart_TCH_IP_src],["TCH_IP_dst",arLang.LtypeChart_TCH_IP_dst],["TCH_domain_src",arLang.LtypeChart_TCH_domain_src],["TCH_domain_dst",arLang.LtypeChart_TCH_domain_dst]);
if(window.existsCdrSilence){arCdrChart_chartTypes.push(["TCH_silence",arLang.LtypeChart_TCH_silence],["TCH_silence_caller",arLang.LtypeChart_TCH_silence_caller],["TCH_silence_called",arLang.LtypeChart_TCH_silence_called],["TCH_silence_end",arLang.LtypeChart_TCH_silence_end],["TCH_silence_end_caller",arLang.LtypeChart_TCH_silence_end_caller],["TCH_silence_end_called",arLang.LtypeChart_TCH_silence_end_called])
}if(window.existsCdrClipping){arCdrChart_chartTypes.push(["TCH_clipping",arLang.LtypeChart_TCH_clipping],["TCH_clipping_caller",arLang.LtypeChart_TCH_clipping_caller],["TCH_clipping_called",arLang.LtypeChart_TCH_clipping_called])
}arMessagesChart_chartTypes=[["TCH_count",arLang.LtypeChart_TCH_count_messages],["TCH_cps",arLang.LtypeChart_TCH_cps_messages],["TCH_sipResp",arLang.LtypeChart_TCH_sipResp],["TCH_sipResponse",arLang.LtypeChart_TCH_sipResponse],["TCH_sipResponse_base",arLang.LtypeChart_TCH_sipResponse_base],["TCH_IP_src",arLang.LtypeChart_TCH_IP_src],["TCH_IP_dst",arLang.LtypeChart_TCH_IP_dst],["TCH_domain_src",arLang.LtypeChart_TCH_domain_src],["TCH_domain_dst",arLang.LtypeChart_TCH_domain_dst]];
arSipMsgChart_chartTypes=[["TCH_count",arLang.LtypeChart_TCH_count_sip_msg],["TCH_cps",arLang.LtypeChart_TCH_cps_sip_msg],["TCH_IP_src",arLang.LtypeChart_TCH_IP_src],["TCH_IP_dst",arLang.LtypeChart_TCH_IP_dst],["TCH_domain_src",arLang.LtypeChart_TCH_domain_src],["TCH_domain_dst",arLang.LtypeChart_TCH_domain_dst]];
arCdrChart_chartSeriesTypes=[["TCHS_count_all",arLang.LtypeSeries_TCHS_count,arLang.LsubtypeSeries_TCHS_all,"TCH_total","s_count_all"],["TCHS_count_max",arLang.LtypeSeries_TCHS_concurrent,arLang.LsubtypeSeries_TCHS_max,"TCH_count","s_count_max"],["TCHS_count_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_count","s_count_avg1"],["TCHS_count_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_count","s_count_min1"],["TCHS_count_perc_short_60",arLang.LtypeSeries_TCHS_perc_count,arLang.LsubtypeSeries_TCHS_count_perc_short_60,"TCH_count_perc_short","s_count_perc_short","param","60"],["TCHS_count_perc_short_20","",arLang.LsubtypeSeries_TCHS_count_perc_short_20,"TCH_count_perc_short","s_count_perc_short","param","20"],["TCHS_cps_max",arLang.LtypeSeries_TCHS_cps,arLang.LsubtypeSeries_TCHS_max,"TCH_cps","s_cps_max"],["TCHS_cps_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_cps","s_cps_avg1"],["TCHS_cps_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_cps","s_cps_min1"],["TCHS_minutes_all",arLang.LtypeSeries_TCHS_minutes,arLang.LsubtypeSeries_TCHS_all,"TCH_minutes","s_minutes_all"]];
if(window.rtpQualityUse){arCdrChart_chartSeriesTypes.push(["TCHS_mos_intervals",arLang.LtypeSeries_TCHS_mos,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos","sm_mos_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos","mos_max"],["TCHS_mos_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos","mos_avg"],["TCHS_mos_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos","mos_min"],["TCHS_mos_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos","mos_perc95"],["TCHS_mos_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos","mos_perc99"],["TCHS_mos_caller_intervals",arLang.LtypeSeries_TCHS_mos_caller,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos_caller","sm_mos_caller_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_caller_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos_caller","mos_caller_max"],["TCHS_mos_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_caller","mos_caller_avg"],["TCHS_mos_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_caller","mos_caller_min"],["TCHS_mos_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_caller","mos_caller_perc95"],["TCHS_mos_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_caller","mos_caller_perc99"],["TCHS_mos_called_intervals",arLang.LtypeSeries_TCHS_mos_called,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos_called","sm_mos_called_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_called_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos_called","mos_called_max"],["TCHS_mos_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_called","mos_called_avg"],["TCHS_mos_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_called","mos_called_min"],["TCHS_mos_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_called","mos_called_perc95"],["TCHS_mos_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_called","mos_called_perc99"])
}if(existsMosXrCdr&&window.rtpQualityUse){arCdrChart_chartSeriesTypes.push(["TCHS_mos_xr_avg_intervals",arLang.LtypeSeries_TCHS_mos_xr_avg,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos_xr_avg","sm_mos_xr_avg_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_xr_avg_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos_xr_avg","mos_xr_avg_max"],["TCHS_mos_xr_avg_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_xr_avg","mos_xr_avg_avg"],["TCHS_mos_xr_avg_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_xr_avg","mos_xr_avg_min"],["TCHS_mos_xr_avg_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_xr_avg","mos_xr_avg_perc95"],["TCHS_mos_xr_avg_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_xr_avg","mos_xr_avg_perc99"],["TCHS_mos_xr_avg_caller_max",arLang.LtypeSeries_TCHS_mos_xr_avg_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_xr_avg_caller","mos_xr_avg_caller_max"],["TCHS_mos_xr_avg_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_xr_avg_caller","mos_xr_avg_caller_avg"],["TCHS_mos_xr_avg_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_xr_avg_caller","mos_xr_avg_caller_min"],["TCHS_mos_xr_avg_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_xr_avg_caller","mos_xr_avg_caller_perc95"],["TCHS_mos_xr_avg_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_xr_avg_caller","mos_xr_avg_caller_perc99"],["TCHS_mos_xr_avg_called_max",arLang.LtypeSeries_TCHS_mos_xr_avg_called,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_xr_avg_called","mos_xr_avg_called_max"],["TCHS_mos_xr_avg_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_xr_avg_called","mos_xr_avg_called_avg"],["TCHS_mos_xr_avg_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_xr_avg_called","mos_xr_avg_called_min"],["TCHS_mos_xr_avg_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_xr_avg_called","mos_xr_avg_called_perc95"],["TCHS_mos_xr_avg_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_xr_avg_called","mos_xr_avg_called_perc99"],["TCHS_mos_xr_min_intervals",arLang.LtypeSeries_TCHS_mos_xr_min,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos_xr_min","sm_mos_xr_min_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_xr_min_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos_xr_min","mos_xr_min_max"],["TCHS_mos_xr_min_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_xr_min","mos_xr_min_avg"],["TCHS_mos_xr_min_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_xr_min","mos_xr_min_min"],["TCHS_mos_xr_min_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_xr_min","mos_xr_min_perc95"],["TCHS_mos_xr_min_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_xr_min","mos_xr_min_perc99"],["TCHS_mos_xr_min_caller_max",arLang.LtypeSeries_TCHS_mos_xr_min_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_xr_min_caller","mos_xr_min_caller_max"],["TCHS_mos_xr_min_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_xr_min_caller","mos_xr_min_caller_avg"],["TCHS_mos_xr_min_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_xr_min_caller","mos_xr_min_caller_min"],["TCHS_mos_xr_min_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_xr_min_caller","mos_xr_min_caller_perc95"],["TCHS_mos_xr_min_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_xr_min_caller","mos_xr_min_caller_perc99"],["TCHS_mos_xr_min_called_max",arLang.LtypeSeries_TCHS_mos_xr_min_called,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_xr_min_called","mos_xr_min_called_max"],["TCHS_mos_xr_min_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_xr_min_called","mos_xr_min_called_avg"],["TCHS_mos_xr_min_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_xr_min_called","mos_xr_min_called_min"],["TCHS_mos_xr_min_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_xr_min_called","mos_xr_min_called_perc95"],["TCHS_mos_xr_min_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_xr_min_called","mos_xr_min_called_perc99"])
}if(existsMosSilenceCdr&&window.rtpQualityUse){arCdrChart_chartSeriesTypes.push(["TCHS_mos_silence_avg_intervals",arLang.LtypeSeries_TCHS_mos_silence_avg,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos_silence_avg","sm_mos_silence_avg_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_silence_avg_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos_silence_avg","mos_silence_avg_max"],["TCHS_mos_silence_avg_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_silence_avg","mos_silence_avg_avg"],["TCHS_mos_silence_avg_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_silence_avg","mos_silence_avg_min"],["TCHS_mos_silence_avg_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_silence_avg","mos_silence_avg_perc95"],["TCHS_mos_silence_avg_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_silence_avg","mos_silence_avg_perc99"],["TCHS_mos_silence_avg_caller_max",arLang.LtypeSeries_TCHS_mos_silence_avg_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_silence_avg_caller","mos_silence_avg_caller_max"],["TCHS_mos_silence_avg_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_silence_avg_caller","mos_silence_avg_caller_avg"],["TCHS_mos_silence_avg_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_silence_avg_caller","mos_silence_avg_caller_min"],["TCHS_mos_silence_avg_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_silence_avg_caller","mos_silence_avg_caller_perc95"],["TCHS_mos_silence_avg_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_silence_avg_caller","mos_silence_avg_caller_perc99"],["TCHS_mos_silence_avg_called_max",arLang.LtypeSeries_TCHS_mos_silence_avg_called,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_silence_avg_called","mos_silence_avg_called_max"],["TCHS_mos_silence_avg_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_silence_avg_called","mos_silence_avg_called_avg"],["TCHS_mos_silence_avg_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_silence_avg_called","mos_silence_avg_called_min"],["TCHS_mos_silence_avg_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_silence_avg_called","mos_silence_avg_called_perc95"],["TCHS_mos_silence_avg_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_silence_avg_called","mos_silence_avg_called_perc99"],["TCHS_mos_silence_min_intervals",arLang.LtypeSeries_TCHS_mos_silence_min,arLang.LsubtypeSeries_TCHS_intervals,"TCH_mos_silence_min","sm_mos_silence_min_intervals","multiSeries",null,[[3.1,"#AD1616"],[3.6,"#CA5400"],[4,"#AD8A00"],[4.3,"#7B8A00"],[null,"#0D8A00"]]],["TCHS_mos_silence_min_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_mos_silence_min","mos_silence_min_max"],["TCHS_mos_silence_min_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_silence_min","mos_silence_min_avg"],["TCHS_mos_silence_min_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_silence_min","mos_silence_min_min"],["TCHS_mos_silence_min_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_silence_min","mos_silence_min_perc95"],["TCHS_mos_silence_min_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_silence_min","mos_silence_min_perc99"],["TCHS_mos_silence_min_caller_max",arLang.LtypeSeries_TCHS_mos_silence_min_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_silence_min_caller","mos_silence_min_caller_max"],["TCHS_mos_silence_min_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_silence_min_caller","mos_silence_min_caller_avg"],["TCHS_mos_silence_min_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_silence_min_caller","mos_silence_min_caller_min"],["TCHS_mos_silence_min_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_silence_min_caller","mos_silence_min_caller_perc95"],["TCHS_mos_silence_min_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_silence_min_caller","mos_silence_min_caller_perc99"],["TCHS_mos_silence_min_called_max",arLang.LtypeSeries_TCHS_mos_silence_min_called,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_silence_min_called","mos_silence_min_called_max"],["TCHS_mos_silence_min_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_silence_min_called","mos_silence_min_called_avg"],["TCHS_mos_silence_min_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_silence_min_called","mos_silence_min_called_min"],["TCHS_mos_silence_min_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_silence_min_called","mos_silence_min_called_perc95"],["TCHS_mos_silence_min_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_silence_min_called","mos_silence_min_called_perc99"])
}if(existsMosLqoCdr&&window.rtpQualityUse){arCdrChart_chartSeriesTypes.push(["TCHS_mos_lqo_caller_max",arLang.LtypeSeries_TCHS_mos_lqo_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_lqo_caller","mos_lqo_caller_max"],["TCHS_mos_lqo_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_lqo_caller","mos_lqo_caller_avg"],["TCHS_mos_lqo_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_lqo_caller","mos_lqo_caller_min"],["TCHS_mos_lqo_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_lqo_caller","mos_lqo_caller_perc95"],["TCHS_mos_lqo_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_lqo_caller","mos_lqo_caller_perc99"],["TCHS_mos_lqo_called_max",arLang.LtypeSeries_TCHS_mos_lqo_called,arLang.LsubtypeSeries_TCHS_max,"TCH_mos_lqo_called","mos_lqo_called_max"],["TCHS_mos_lqo_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_mos_lqo_called","mos_lqo_called_avg"],["TCHS_mos_lqo_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_mos_lqo_called","mos_lqo_called_min"],["TCHS_mos_lqo_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_mos_lqo_called","mos_lqo_called_perc95"],["TCHS_mos_lqo_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_mos_lqo_called","mos_lqo_called_perc99"])
}if(window.rtpQualityUse){arCdrChart_chartSeriesTypes.push(["TCHS_packet_lost_intervals",arLang.LtypeSeries_TCHS_packet_lost,arLang.LsubtypeSeries_TCHS_intervals,"TCH_packet_lost","sm_packet_lost_intervals","multiSeries",null,[[0.1,"#00C000"],[0.5,"#7DC000"],[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_packet_lost_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_packet_lost","packet_lost_max"],["TCHS_packet_lost_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_packet_lost","packet_lost_avg"],["TCHS_packet_lost_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_packet_lost","packet_lost_min"],["TCHS_packet_lost_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_packet_lost","packet_lost_perc95"],["TCHS_packet_lost_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_packet_lost","packet_lost_perc99"],["TCHS_packet_lost_caller_intervals",arLang.LtypeSeries_TCHS_packet_lost_caller,arLang.LsubtypeSeries_TCHS_intervals,"TCH_packet_lost_caller","sm_packet_lost_intervals","multiSeries",null,[[0.1,"#00C000"],[0.5,"#7DC000"],[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_packet_lost_called_intervals",arLang.LtypeSeries_TCHS_packet_lost_called,arLang.LsubtypeSeries_TCHS_intervals,"TCH_packet_lost_called","sm_packet_lost_intervals","multiSeries",null,[[0.1,"#00C000"],[0.5,"#7DC000"],[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_jitter_intervals",arLang.LtypeSeries_TCHS_jitter,arLang.LsubtypeSeries_TCHS_intervals,"TCH_jitter","sm_jitter_intervals","multiSeries",null,[[20,"#00C000"],[50,"#AAC000"],[100,"#E9B300"],[200,"#E98400"],[null,"#E90000"]]],["TCHS_jitter_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_jitter","jitter_max"],["TCHS_jitter_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_jitter","jitter_avg"],["TCHS_jitter_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_jitter","jitter_min"],["TCHS_jitter_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_jitter","jitter_perc95"],["TCHS_jitter_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_jitter","jitter_perc99"],["TCHS_delay_max",arLang.LtypeSeries_TCHS_delay_avg,arLang.LsubtypeSeries_TCHS_max,"TCH_delay","delay_max"],["TCHS_delay_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_delay","delay_avg"],["TCHS_delay_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_delay","delay_min"],["TCHS_delay_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_delay","delay_perc95"],["TCHS_delay_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_delay","delay_perc99"],["TCHS_rtcp_avgjitter_intervals",arLang.LtypeSeries_TCHS_rtcp_avgjitter,arLang.LsubtypeSeries_TCHS_intervals,"TCH_rtcp_avgjitter","sm_rtcp_avgjitter_intervals","multiSeries",null,[[20,"#00C000"],[50,"#AAC000"],[100,"#E9B300"],[200,"#E98400"],[null,"#E90000"]]],["TCHS_rtcp_avgjitter_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_rtcp_avgjitter","rtcp_avgjitter_max"],["TCHS_rtcp_avgjitter_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_rtcp_avgjitter","rtcp_avgjitter_avg"],["TCHS_rtcp_avgjitter_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_rtcp_avgjitter","rtcp_avgjitter_min"],["TCHS_rtcp_avgjitter_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_rtcp_avgjitter","rtcp_avgjitter_perc95"],["TCHS_rtcp_avgjitter_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_rtcp_avgjitter","rtcp_avgjitter_perc99"],["TCHS_rtcp_maxjitter_intervals",arLang.LtypeSeries_TCHS_rtcp_maxjitter,arLang.LsubtypeSeries_TCHS_intervals,"TCH_rtcp_maxjitter","sm_rtcp_maxjitter_intervals","multiSeries",null,[[20,"#00C000"],[50,"#AAC000"],[100,"#E9B300"],[200,"#E98400"],[null,"#E90000"]]],["TCHS_rtcp_maxjitter_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_rtcp_maxjitter","rtcp_maxjitter_max"],["TCHS_rtcp_maxjitter_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_rtcp_maxjitter","rtcp_maxjitter_avg"],["TCHS_rtcp_maxjitter_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_rtcp_maxjitter","rtcp_maxjitter_min"],["TCHS_rtcp_maxjitter_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_rtcp_maxjitter","rtcp_maxjitter_perc95"],["TCHS_rtcp_maxjitter_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_rtcp_maxjitter","rtcp_maxjitter_perc99"],["TCHS_rtcp_avgfr_intervals",arLang.LtypeSeries_TCHS_rtcp_avgfr,arLang.LsubtypeSeries_TCHS_intervals,"TCH_rtcp_avgfr","sm_rtcp_avgfr_intervals","multiSeries",null,[[0.1,"#00C000"],[0.5,"#7DC000"],[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_rtcp_avgfr_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_rtcp_avgfr","rtcp_avgfr_max"],["TCHS_rtcp_avgfr_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_rtcp_avgfr","rtcp_avgfr_avg"],["TCHS_rtcp_avgfr_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_rtcp_avgfr","rtcp_avgfr_min"],["TCHS_rtcp_avgfr_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_rtcp_avgfr","rtcp_avgfr_perc95"],["TCHS_rtcp_avgfr_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_rtcp_avgfr","rtcp_avgfr_perc99"],["TCHS_rtcp_maxfr_intervals",arLang.LtypeSeries_TCHS_rtcp_maxfr,arLang.LsubtypeSeries_TCHS_intervals,"TCH_rtcp_maxfr","sm_rtcp_maxfr_intervals","multiSeries",null,[[0.1,"#00C000"],[0.5,"#7DC000"],[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_rtcp_maxfr_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_rtcp_maxfr","rtcp_maxfr_max"],["TCHS_rtcp_maxfr_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_rtcp_maxfr","rtcp_maxfr_avg"],["TCHS_rtcp_maxfr_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_rtcp_maxfr","rtcp_maxfr_min"],["TCHS_rtcp_maxfr_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_rtcp_maxfr","rtcp_maxfr_perc95"],["TCHS_rtcp_maxfr_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_rtcp_maxfr","rtcp_maxfr_perc99"],["TCHS_rtcp_avgrtd_intervals",arLang.LtypeSeries_TCHS_rtcp_avgrtd,arLang.LsubtypeSeries_TCHS_intervals,"TCH_rtcp_avgrtd","sm_rtcp_avgrtd_intervals","multiSeries",null,[[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_rtcp_avgrtd_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_rtcp_avgrtd","rtcp_avgrtd_max"],["TCHS_rtcp_avgrtd_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_rtcp_avgrtd","rtcp_avgrtd_avg"],["TCHS_rtcp_avgrtd_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_rtcp_avgrtd","rtcp_avgrtd_min"],["TCHS_rtcp_avgrtd_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_rtcp_avgrtd","rtcp_avgrtd_perc95"],["TCHS_rtcp_avgrtd_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_rtcp_avgrtd","rtcp_avgrtd_perc99"],["TCHS_rtcp_maxrtd_intervals",arLang.LtypeSeries_TCHS_rtcp_maxrtd,arLang.LsubtypeSeries_TCHS_intervals,"TCH_rtcp_maxrtd","sm_rtcp_maxrtd_intervals","multiSeries",null,[[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]],["TCHS_rtcp_maxrtd_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_rtcp_maxrtd","rtcp_maxrtd_max"],["TCHS_rtcp_maxrtd_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_rtcp_maxrtd","rtcp_maxrtd_avg"],["TCHS_rtcp_maxrtd_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_rtcp_maxrtd","rtcp_maxrtd_min"],["TCHS_rtcp_maxrtd_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_rtcp_maxrtd","rtcp_maxrtd_perc95"],["TCHS_rtcp_maxrtd_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_rtcp_maxrtd","rtcp_maxrtd_perc99"])
}arCdrChart_chartSeriesTypes.push(["TCHS_acd_avg",arLang.LtypeSeries_TCHS_acd_avg,"","TCH_acd_avg","acd_avg"],["TCHS_acd",arLang.LtypeSeries_TCHS_acd,"","TCH_acd","acd"],["TCHS_asr_avg",arLang.LtypeSeries_TCHS_asr_avg,"","TCH_asr_avg","asr_avg"],["TCHS_asr",arLang.LtypeSeries_TCHS_asr,"","TCH_asr","asr"],["TCHS_ner_avg",arLang.LtypeSeries_TCHS_ner_avg,"","TCH_ner_avg","ner_avg"],["TCHS_ner",arLang.LtypeSeries_TCHS_ner,"","TCH_ner","ner"],["TCHS_pdd_intervals",arLang.LtypeSeries_TCHS_pdd,arLang.LsubtypeSeries_TCHS_intervals,"TCH_pdd","sm_pdd_intervals","multiSeries",null,[[1,"#00C000"],[5,"#AAC000"],[10,"#E9B300"],[20,"#E98400"],[null,"#E90000"]]],["TCHS_pdd_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_pdd","pdd_max"],["TCHS_pdd_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_pdd","pdd_avg"],["TCHS_pdd_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_pdd","pdd_min"],["TCHS_pdd_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_pdd","pdd_perc95"],["TCHS_pdd_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_pdd","pdd_perc99"],["TCHS_sipResp",arLang.LtypeSeries_TCHS_sipResp,"XXX","TCH_sipResp","lastSIPresponse","param"],["TCHS_sipResp_2XX","","2XX","TCH_sipResp","lastSIPresponse","param","2XX"],["TCHS_sipResp_3XX","","3XX","TCH_sipResp","lastSIPresponse","param","3XX"],["TCHS_sipResp_4XX","","4XX","TCH_sipResp","lastSIPresponse","param","4XX"],["TCHS_sipResp_5XX","","5XX","TCH_sipResp","lastSIPresponse","param","5XX"],["TCHS_sipResp_6XX","","6XX","TCH_sipResp","lastSIPresponse","param","6XX"],["TCHS_sipResponse",arLang.LtypeSeries_TCHS_sipResponse,"","TCH_sipResponse","sm_lastSIPresponse","multiSeries"],["TCHS_sipResponse_base",arLang.LtypeSeries_TCHS_sipResponse_base,"","TCH_sipResponse_base","sm_lastSIPresponse_base","multiSeries",null,[["0XX/not response","#AAAAAA"],["1XX/1xx","#888888"],["2XX/2xx","#00AA00"],["3XX/3xx","#EA9C00"],["4XX/4xx","#0055FF"],["5XX/5xx","#FF4C11"],["6XX/6xx","#CC0000"]]],["TCHS_codecs",arLang.LtypeSeries_TCHS_codecs,"","TCH_codecs","sm_payload","multiSeries"],["TCHS_IP_src",arLang.LtypeSeries_TCHS_IP_src,"","TCH_IP_src","sm_ip_src","multiSeries"],["TCHS_IP_dst",arLang.LtypeSeries_TCHS_IP_dst,"","TCH_IP_dst","sm_ip_dst","multiSeries"],["TCHS_domain_src",arLang.LtypeSeries_TCHS_domain_src,"","TCH_domain_src","sm_domain_src","multiSeries"],["TCHS_domain_dst",arLang.LtypeSeries_TCHS_domain_dst,"","TCH_domain_dst","sm_domain_dst","multiSeries"]);
if(window.existsCdrSilence){arCdrChart_chartSeriesTypes.push(["TCHS_silence_max",arLang.LtypeSeries_TCHS_silence,arLang.LsubtypeSeries_TCHS_max,"TCH_silence","silence_max"],["TCHS_silence_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_silence","silence_avg"],["TCHS_silence_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_silence","silence_min"],["TCHS_silence_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_silence","silence_perc95"],["TCHS_silence_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_silence","silence_perc99"],["TCHS_silence_caller_max",arLang.LtypeSeries_TCHS_silence_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_silence_caller","silence_caller_max"],["TCHS_silence_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_silence_caller","silence_caller_avg"],["TCHS_silence_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_silence_caller","silence_caller_min"],["TCHS_silence_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_silence_caller","silence_caller_perc95"],["TCHS_silence_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_silence_caller","silence_caller_perc99"],["TCHS_silence_called_max",arLang.LtypeSeries_TCHS_silence_called,arLang.LsubtypeSeries_TCHS_max,"TCH_silence_called","silence_called_max"],["TCHS_silence_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_silence_called","silence_called_avg"],["TCHS_silence_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_silence_called","silence_called_min"],["TCHS_silence_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_silence_called","silence_called_perc95"],["TCHS_silence_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_silence_called","silence_called_perc99"],["TCHS_silence_end_max",arLang.LtypeSeries_TCHS_silence_end,arLang.LsubtypeSeries_TCHS_max,"TCH_silence_end","silence_end_max"],["TCHS_silence_end_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_silence_end","silence_end_avg"],["TCHS_silence_end_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_silence_end","silence_end_min"],["TCHS_silence_end_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_silence_end","silence_end_perc95"],["TCHS_silence_end_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_silence_end","silence_end_perc99"],["TCHS_silence_end_caller_max",arLang.LtypeSeries_TCHS_silence_end_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_silence_end_caller","silence_end_caller_max"],["TCHS_silence_end_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_silence_end_caller","silence_end_caller_avg"],["TCHS_silence_end_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_silence_end_caller","silence_end_caller_min"],["TCHS_silence_end_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_silence_end_caller","silence_end_caller_perc95"],["TCHS_silence_end_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_silence_end_caller","silence_end_caller_perc99"],["TCHS_silence_end_called_max",arLang.LtypeSeries_TCHS_silence_end_called,arLang.LsubtypeSeries_TCHS_max,"TCH_silence_end_called","silence_end_called_max"],["TCHS_silence_end_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_silence_end_called","silence_end_called_avg"],["TCHS_silence_end_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_silence_end_called","silence_end_called_min"],["TCHS_silence_end_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_silence_end_called","silence_end_called_perc95"],["TCHS_silence_end_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_silence_end_called","silence_end_called_perc99"])
}if(window.existsCdrClipping){arCdrChart_chartSeriesTypes.push(["TCHS_clipping_max",arLang.LtypeSeries_TCHS_clipping,arLang.LsubtypeSeries_TCHS_max,"TCH_clipping","clipping_max"],["TCHS_clipping_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_clipping","clipping_avg"],["TCHS_clipping_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_clipping","clipping_min"],["TCHS_clipping_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_clipping","clipping_perc95"],["TCHS_clipping_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_clipping","clipping_perc99"],["TCHS_clipping_caller_max",arLang.LtypeSeries_TCHS_clipping_caller,arLang.LsubtypeSeries_TCHS_max,"TCH_clipping_caller","clipping_caller_max"],["TCHS_clipping_caller_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_clipping_caller","clipping_caller_avg"],["TCHS_clipping_caller_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_clipping_caller","clipping_caller_min"],["TCHS_clipping_caller_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_clipping_caller","clipping_caller_perc95"],["TCHS_clipping_caller_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_clipping_caller","clipping_caller_perc99"],["TCHS_clipping_called_max",arLang.LtypeSeries_TCHS_clipping_called,arLang.LsubtypeSeries_TCHS_max,"TCH_clipping_called","clipping_called_max"],["TCHS_clipping_called_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_clipping_called","clipping_called_avg"],["TCHS_clipping_called_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_clipping_called","clipping_called_min"],["TCHS_clipping_called_perc95","",arLang.LsubtypeSeries_TCHS_perc95,"TCH_clipping_called","clipping_called_perc95"],["TCHS_clipping_called_perc99","",arLang.LsubtypeSeries_TCHS_perc99,"TCH_clipping_called","clipping_called_perc99"])
}arMessagesChart_chartSeriesTypes=[["TCHS_count_all",arLang.LtypeSeries_TCHS_count_messages,arLang.LsubtypeSeries_TCHS_all,"TCH_count","s_count_all"],["TCHS_count_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_count","s_count_max"],["TCHS_count_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_count","s_count_avg1"],["TCHS_count_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_count","s_count_min1"],["TCHS_cps_max",arLang.LtypeSeries_TCHS_cps_messages,arLang.LsubtypeSeries_TCHS_max,"TCH_cps","s_cps_max"],["TCHS_cps_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_cps","s_cps_avg1"],["TCHS_cps_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_cps","s_cps_min1"],["TCHS_sipResp",arLang.LtypeSeries_TCHS_sipResp,"XXX","TCH_sipResp","lastSIPresponse","param"],["TCHS_sipResp_2XX","","2XX","TCH_sipResp","lastSIPresponse","param","2XX"],["TCHS_sipResp_3XX","","3XX","TCH_sipResp","lastSIPresponse","param","3XX"],["TCHS_sipResp_4XX","","4XX","TCH_sipResp","lastSIPresponse","param","4XX"],["TCHS_sipResp_5XX","","5XX","TCH_sipResp","lastSIPresponse","param","5XX"],["TCHS_sipResp_6XX","","6XX","TCH_sipResp","lastSIPresponse","param","6XX"],["TCHS_sipResponse",arLang.LtypeSeries_TCHS_sipResponse,"","TCH_sipResponse","sm_lastSIPresponse","multiSeries"],["TCHS_sipResponse_base",arLang.LtypeSeries_TCHS_sipResponse_base,"","TCH_sipResponse_base","sm_lastSIPresponse_base","multiSeries",null,[["0/not response","#AAAAAA"],["1xx","#888888"],["2xx","#00AA00"],["3xx","#FFAA00"],["4xx","#0055FF"],["5xx","#FF4C11"],["6xx","#CC0000"]]],["TCHS_IP_src",arLang.LtypeSeries_TCHS_IP_src,"","TCH_IP_src","sm_ip_src","multiSeries"],["TCHS_IP_dst",arLang.LtypeSeries_TCHS_IP_dst,"","TCH_IP_dst","sm_ip_dst","multiSeries"],["TCHS_domain_src",arLang.LtypeSeries_TCHS_domain_src,"","TCH_domain_src","sm_domain_src","multiSeries"],["TCHS_domain_dst",arLang.LtypeSeries_TCHS_domain_dst,"","TCH_domain_dst","sm_domain_dst","multiSeries"]];
arSipMsgChart_chartSeriesTypes=[["TCHS_count_all",arLang.LtypeSeries_TCHS_count_sip_msg,arLang.LsubtypeSeries_TCHS_all,"TCH_count","s_count_all"],["TCHS_count_max","",arLang.LsubtypeSeries_TCHS_max,"TCH_count","s_count_max"],["TCHS_count_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_count","s_count_avg1"],["TCHS_count_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_count","s_count_min1"],["TCHS_cps_max",arLang.LtypeSeries_TCHS_cps_sip_msg,arLang.LsubtypeSeries_TCHS_max,"TCH_cps","s_cps_max"],["TCHS_cps_avg","",arLang.LsubtypeSeries_TCHS_avg,"TCH_cps","s_cps_avg1"],["TCHS_cps_min","",arLang.LsubtypeSeries_TCHS_min,"TCH_cps","s_cps_min1"],["TCHS_IP_src",arLang.LtypeSeries_TCHS_IP_src,"","TCH_IP_src","sm_ip_src","multiSeries"],["TCHS_IP_dst",arLang.LtypeSeries_TCHS_IP_dst,"","TCH_IP_dst","sm_ip_dst","multiSeries"],["TCHS_domain_src",arLang.LtypeSeries_TCHS_domain_src,"","TCH_domain_src","sm_domain_src","multiSeries"],["TCHS_domain_dst",arLang.LtypeSeries_TCHS_domain_dst,"","TCH_domain_dst","sm_domain_dst","multiSeries"]];
arCdrChart_chartSeriesData=[["TCHS_count_all",{unit:"count"}],["TCHS_count_max",{unit:"count_peak"}],["TCHS_count_avg",{unit:"count_peak"}],["TCHS_count_min",{unit:"count_peak"}],["TCHS_count_perc_short_60",{unit:"perc"}],["TCHS_count_perc_short_20",{unit:"perc"}],["TCHS_cps_max",{unit:"cps"}],["TCHS_cps_avg",{unit:"cps"}],["TCHS_cps_min",{unit:"cps"}],["TCHS_minutes_all",{unit:"minutes"}],["TCHS_minutes_max",{unit:"minutes"}],["TCHS_minutes_avg",{unit:"minutes"}],["TCHS_minutes_min",{unit:"minutes"}]];
if(window.rtpQualityUse){arCdrChart_chartSeriesData.push(["TCHS_mos_intervals",{unit:"count"}],["TCHS_mos_max",{unit:"mos"}],["TCHS_mos_avg",{unit:"mos"}],["TCHS_mos_min",{unit:"mos"}],["TCHS_mos_perc95",{unit:"mos"}],["TCHS_mos_perc99",{unit:"mos"}],["TCHS_mos_caller_intervals",{unit:"count"}],["TCHS_mos_caller_max",{unit:"mos"}],["TCHS_mos_caller_avg",{unit:"mos"}],["TCHS_mos_caller_min",{unit:"mos"}],["TCHS_mos_caller_perc95",{unit:"mos"}],["TCHS_mos_caller_perc99",{unit:"mos"}],["TCHS_mos_called_intervals",{unit:"count"}],["TCHS_mos_called_max",{unit:"mos"}],["TCHS_mos_called_avg",{unit:"mos"}],["TCHS_mos_called_min",{unit:"mos"}],["TCHS_mos_called_perc95",{unit:"mos"}],["TCHS_mos_called_perc99",{unit:"mos"}])
}if(existsMosXrCdr&&window.rtpQualityUse){arCdrChart_chartSeriesData.push(["TCHS_mos_xr_avg_intervals",{unit:"count"}],["TCHS_mos_xr_avg_max",{unit:"mos"}],["TCHS_mos_xr_avg_avg",{unit:"mos"}],["TCHS_mos_xr_avg_min",{unit:"mos"}],["TCHS_mos_xr_avg_perc95",{unit:"mos"}],["TCHS_mos_xr_avg_perc99",{unit:"mos"}],["TCHS_mos_xr_avg_caller_max",{unit:"mos"}],["TCHS_mos_xr_avg_caller_avg",{unit:"mos"}],["TCHS_mos_xr_avg_caller_min",{unit:"mos"}],["TCHS_mos_xr_avg_caller_perc95",{unit:"mos"}],["TCHS_mos_xr_avg_caller_perc99",{unit:"mos"}],["TCHS_mos_xr_avg_called_max",{unit:"mos"}],["TCHS_mos_xr_avg_called_avg",{unit:"mos"}],["TCHS_mos_xr_avg_called_min",{unit:"mos"}],["TCHS_mos_xr_avg_called_perc95",{unit:"mos"}],["TCHS_mos_xr_avg_called_perc99",{unit:"mos"}],["TCHS_mos_xr_min_intervals",{unit:"count"}],["TCHS_mos_xr_min_max",{unit:"mos"}],["TCHS_mos_xr_min_avg",{unit:"mos"}],["TCHS_mos_xr_min_min",{unit:"mos"}],["TCHS_mos_xr_min_perc95",{unit:"mos"}],["TCHS_mos_xr_min_perc99",{unit:"mos"}],["TCHS_mos_xr_min_caller_max",{unit:"mos"}],["TCHS_mos_xr_min_caller_avg",{unit:"mos"}],["TCHS_mos_xr_min_caller_min",{unit:"mos"}],["TCHS_mos_xr_min_caller_perc95",{unit:"mos"}],["TCHS_mos_xr_min_caller_perc99",{unit:"mos"}],["TCHS_mos_xr_min_called_max",{unit:"mos"}],["TCHS_mos_xr_min_called_avg",{unit:"mos"}],["TCHS_mos_xr_min_called_min",{unit:"mos"}],["TCHS_mos_xr_min_called_perc95",{unit:"mos"}],["TCHS_mos_xr_min_called_perc99",{unit:"mos"}])
}if(existsMosSilenceCdr&&window.rtpQualityUse){arCdrChart_chartSeriesData.push(["TCHS_mos_silence_avg_intervals",{unit:"count"}],["TCHS_mos_silence_avg_max",{unit:"mos"}],["TCHS_mos_silence_avg_avg",{unit:"mos"}],["TCHS_mos_silence_avg_min",{unit:"mos"}],["TCHS_mos_silence_avg_perc95",{unit:"mos"}],["TCHS_mos_silence_avg_perc99",{unit:"mos"}],["TCHS_mos_silence_avg_caller_max",{unit:"mos"}],["TCHS_mos_silence_avg_caller_avg",{unit:"mos"}],["TCHS_mos_silence_avg_caller_min",{unit:"mos"}],["TCHS_mos_silence_avg_caller_perc95",{unit:"mos"}],["TCHS_mos_silence_avg_caller_perc99",{unit:"mos"}],["TCHS_mos_silence_avg_called_max",{unit:"mos"}],["TCHS_mos_silence_avg_called_avg",{unit:"mos"}],["TCHS_mos_silence_avg_called_min",{unit:"mos"}],["TCHS_mos_silence_avg_called_perc95",{unit:"mos"}],["TCHS_mos_silence_avg_called_perc99",{unit:"mos"}],["TCHS_mos_silence_min_intervals",{unit:"count"}],["TCHS_mos_silence_min_max",{unit:"mos"}],["TCHS_mos_silence_min_avg",{unit:"mos"}],["TCHS_mos_silence_min_min",{unit:"mos"}],["TCHS_mos_silence_min_perc95",{unit:"mos"}],["TCHS_mos_silence_min_perc99",{unit:"mos"}],["TCHS_mos_silence_min_caller_max",{unit:"mos"}],["TCHS_mos_silence_min_caller_avg",{unit:"mos"}],["TCHS_mos_silence_min_caller_min",{unit:"mos"}],["TCHS_mos_silence_min_caller_perc95",{unit:"mos"}],["TCHS_mos_silence_min_caller_perc99",{unit:"mos"}],["TCHS_mos_silence_min_called_max",{unit:"mos"}],["TCHS_mos_silence_min_called_avg",{unit:"mos"}],["TCHS_mos_silence_min_called_min",{unit:"mos"}],["TCHS_mos_silence_min_called_perc95",{unit:"mos"}],["TCHS_mos_silence_min_called_perc99",{unit:"mos"}])
}if(existsMosLqoCdr&&window.rtpQualityUse){arCdrChart_chartSeriesData.push(["TCHS_mos_lqo_caller_max",{unit:"mos"}],["TCHS_mos_lqo_caller_avg",{unit:"mos"}],["TCHS_mos_lqo_caller_min",{unit:"mos"}],["TCHS_mos_lqo_caller_perc95",{unit:"mos"}],["TCHS_mos_lqo_caller_perc99",{unit:"mos"}],["TCHS_mos_lqo_called_max",{unit:"mos"}],["TCHS_mos_lqo_called_avg",{unit:"mos"}],["TCHS_mos_lqo_called_min",{unit:"mos"}],["TCHS_mos_lqo_called_perc95",{unit:"mos"}],["TCHS_mos_lqo_called_perc99",{unit:"mos"}])
}if(window.rtpQualityUse){arCdrChart_chartSeriesData.push(["TCHS_packet_lost_intervals",{unit:"count"}],["TCHS_packet_lost_caller_intervals",{unit:"count"}],["TCHS_packet_lost_called_intervals",{unit:"count"}],["TCHS_packet_lost_max",{unit:"packet_loss"}],["TCHS_packet_lost_max",{unit:"packet_loss"}],["TCHS_packet_lost_avg",{unit:"packet_loss"}],["TCHS_packet_lost_min",{unit:"packet_loss"}],["TCHS_packet_lost_perc95",{unit:"packet_loss"}],["TCHS_packet_lost_perc99",{unit:"packet_loss"}],["TCHS_jitter_intervals",{unit:"count"}],["TCHS_jitter_max",{unit:"jitter"}],["TCHS_jitter_avg",{unit:"jitter"}],["TCHS_jitter_min",{unit:"jitter"}],["TCHS_jitter_perc95",{unit:"jitter"}],["TCHS_jitter_perc99",{unit:"jitter"}],["TCHS_delay_max",{unit:"delay"}],["TCHS_delay_avg",{unit:"delay"}],["TCHS_delay_min",{unit:"delay"}],["TCHS_delay_perc95",{unit:"delay"}],["TCHS_delay_perc99",{unit:"delay"}],["TCHS_rtcp_avgjitter_intervals",{unit:"count"}],["TCHS_rtcp_avgjitter_max",{unit:"jitter"}],["TCHS_rtcp_avgjitter_avg",{unit:"jitter"}],["TCHS_rtcp_avgjitter_min",{unit:"jitter"}],["TCHS_rtcp_avgjitter_perc95",{unit:"jitter"}],["TCHS_rtcp_avgjitter_perc99",{unit:"jitter"}],["TCHS_rtcp_maxjitter_intervals",{unit:"count"}],["TCHS_rtcp_maxjitter_max",{unit:"jitter"}],["TCHS_rtcp_maxjitter_avg",{unit:"jitter"}],["TCHS_rtcp_maxjitter_min",{unit:"jitter"}],["TCHS_rtcp_maxjitter_perc95",{unit:"jitter"}],["TCHS_rtcp_maxjitter_perc99",{unit:"jitter"}],["TCHS_rtcp_avgfr_intervals",{unit:"count"}],["TCHS_rtcp_avgfr_max",{unit:"fr"}],["TCHS_rtcp_avgfr_avg",{unit:"fr"}],["TCHS_rtcp_avgfr_min",{unit:"fr"}],["TCHS_rtcp_avgfr_perc95",{unit:"fr"}],["TCHS_rtcp_avgfr_perc99",{unit:"fr"}],["TCHS_rtcp_maxfr_intervals",{unit:"count"}],["TCHS_rtcp_maxfr_max",{unit:"fr"}],["TCHS_rtcp_maxfr_avg",{unit:"fr"}],["TCHS_rtcp_maxfr_min",{unit:"fr"}],["TCHS_rtcp_maxfr_perc95",{unit:"fr"}],["TCHS_rtcp_maxfr_perc99",{unit:"fr"}],["TCHS_rtcp_avgrtd_intervals",{unit:"count"}],["TCHS_rtcp_avgrtd_max",{unit:"ms"}],["TCHS_rtcp_avgrtd_avg",{unit:"ms"}],["TCHS_rtcp_avgrtd_min",{unit:"ms"}],["TCHS_rtcp_avgrtd_perc95",{unit:"ms"}],["TCHS_rtcp_avgrtd_perc99",{unit:"ms"}],["TCHS_rtcp_maxrtd_intervals",{unit:"count"}],["TCHS_rtcp_maxrtd_max",{unit:"ms"}],["TCHS_rtcp_maxrtd_avg",{unit:"ms"}],["TCHS_rtcp_maxrtd_min",{unit:"ms"}],["TCHS_rtcp_maxrtd_perc95",{unit:"ms"}],["TCHS_rtcp_maxrtd_perc99",{unit:"ms"}])
}arCdrChart_chartSeriesData.push(["TCHS_acd_avg",{unit:"acd"}],["TCHS_acd",{unit:"acd"}],["TCHS_asr_avg",{unit:"perc"}],["TCHS_asr",{unit:"perc"}],["TCHS_ner_avg",{unit:"perc"}],["TCHS_ner",{unit:"perc"}],["TCHS_pdd_intervals",{unit:"count"}],["TCHS_pdd_max",{unit:"pdd"}],["TCHS_pdd_avg",{unit:"pdd"}],["TCHS_pdd_min",{unit:"pdd"}],["TCHS_pdd_perc95",{unit:"pdd"}],["TCHS_pdd_perc99",{unit:"pdd"}],["TCHS_sipResp",{unit:"count"}],["TCHS_sipResp_2XX",{unit:"count"}],["TCHS_sipResp_3XX",{unit:"count"}],["TCHS_sipResp_4XX",{unit:"count"}],["TCHS_sipResp_5XX",{unit:"count"}],["TCHS_sipResp_6XX",{unit:"count"}],["TCHS_sipResponse",{unit:"count"}],["TCHS_sipResponse_base",{unit:"count"}],["TCHS_codecs",{unit:"count"}],["TCHS_IP_src",{unit:"count"}],["TCHS_IP_src",{unit:"count"}],["TCHS_domain_src",{unit:"count"}],["TCHS_domain_dst",{unit:"count"}]);
arMessagesChart_chartSeriesData=[["TCHS_count_all",{unit:"count"}],["TCHS_count_max",{unit:"count_peak"}],["TCHS_count_avg",{unit:"count_peak"}],["TCHS_count_min",{unit:"count_peak"}],["TCHS_cps_max",{unit:"cps"}],["TCHS_cps_avg",{unit:"cps"}],["TCHS_cps_min",{unit:"cps"}],["TCHS_sipResp",{unit:"count"}],["TCHS_sipResp_2XX",{unit:"count"}],["TCHS_sipResp_3XX",{unit:"count"}],["TCHS_sipResp_4XX",{unit:"count"}],["TCHS_sipResp_5XX",{unit:"count"}],["TCHS_sipResp_6XX",{unit:"count"}],["TCHS_sipResponse",{unit:"count"}],["TCHS_sipResponse_base",{unit:"count"}],["TCHS_IP_src",{unit:"count"}],["TCHS_IP_src",{unit:"count"}],["TCHS_domain_src",{unit:"count"}],["TCHS_domain_dst",{unit:"count"}]];
arSipMsgChart_chartSeriesData=[["TCHS_count_all",{unit:"count"}],["TCHS_count_max",{unit:"count_peak"}],["TCHS_count_avg",{unit:"count_peak"}],["TCHS_count_min",{unit:"count_peak"}],["TCHS_cps_max",{unit:"cps"}],["TCHS_cps_avg",{unit:"cps"}],["TCHS_cps_min",{unit:"cps"}],["TCHS_IP_src",{unit:"count"}],["TCHS_IP_src",{unit:"count"}],["TCHS_domain_src",{unit:"count"}],["TCHS_domain_dst",{unit:"count"}]];
arCdrChart_chartThemes=[["CdrChart",arLang.LchartTheme_CdrChart],["CdrChartLine",arLang.LchartTheme_CdrChartLine],["CdrChartColumn",arLang.LchartTheme_CdrChartColumn],["CdrChartLineWithGreySum",arLang.LchartTheme_CdrChartLineWithGreySum],["CdrChartArea",arLang.LchartTheme_CdrChartArea]];
arCdrChart_legendPosition=[["top",arLang.LchartLegendPosition_top],["bottom",arLang.LchartLegendPosition_bottom],["left",arLang.LchartLegendPosition_left],["right",arLang.LchartLegendPosition_right],["none",arLang.LchartLegendPosition_none]];
arCdrChart_defChartTypes={TCH_count:{CDR:{series:[{series:"TCHS_count_all",sideAxis:"right",baseType:"column_line",fill:true,color:"grey"},{series:"TCHS_count_max",color:"red"},{series:"TCHS_count_avg",color:"blue"},{series:"TCHS_count_min",color:"green"}],theme:"CdrChartLineWithGreySum",axisTitleLeft:"concurrent calls - max, avg, min",axisTitleRight:"total calls"},MESSAGES:{series:[{series:"TCHS_count_all",color:"blue"}],theme:"CdrChartLineWithGreySum",axisTitleLeft:"total messages"},SIP_MSG:{series:[{series:"TCHS_count_all",color:"blue"}],theme:"CdrChartLineWithGreySum",axisTitleLeft:"total sip msg."}},TCH_cps:{CDR:{series:[{series:"TCHS_cps_max",color:"red"},{series:"TCHS_cps_avg",color:"blue"},{series:"TCHS_cps_min",color:"green"}],theme:"CdrChartLineWithGreySum",axisTitleLeft:"calls per second - max, avg, min"},MESSAGES:{series:[{series:"TCHS_cps_max",color:"red"},{series:"TCHS_cps_avg",color:"blue"},{series:"TCHS_cps_min",color:"green"}],theme:"CdrChartLineWithGreySum",axisTitleLeft:"messages per second - max, avg, min"},SIP_MSG:{series:[{series:"TCHS_cps_max",color:"red"},{series:"TCHS_cps_avg",color:"blue"},{series:"TCHS_cps_min",color:"green"}],theme:"CdrChartLineWithGreySum",axisTitleLeft:"opt., subsc., notify per second - max, avg, min"}},TCH_minutes:{series:[{series:"TCHS_minutes_all",color:"blue"}],theme:"CdrChartLine",axisTitleLeft:"minutes of calls"}};
if(window.rtpQualityUse){Ext.apply(arCdrChart_defChartTypes,{TCH_mos_intervals:{series:[{series:"TCHS_mos_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS - count"},TCH_mos:{series:[{series:"TCHS_mos_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS min(both) - avg, perc 95, perc 99"},TCH_mos_caller_intervals:{series:[{series:"TCHS_mos_caller_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS Caller - count"},TCH_mos_caller:{series:[{series:"TCHS_mos_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Caller - avg, perc 95, perc 99"},TCH_mos_called_intervals:{series:[{series:"TCHS_mos_called_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS Called - count"},TCH_mos_called:{series:[{series:"TCHS_mos_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Called - avg, perc 95, perc 99"}})
}if(existsMosXrCdr&&window.rtpQualityUse){Ext.apply(arCdrChart_defChartTypes,{TCH_mos_xr_avg_intervals:{series:[{series:"TCHS_mos_xr_avg_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS XR avg - count"},TCH_mos_xr_avg:{series:[{series:"TCHS_mos_xr_avg_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_xr_avg_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_xr_avg_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS XR avg (both) - avg, perc 95, perc 99"},TCH_mos_xr_avg_caller:{series:[{series:"TCHS_mos_xr_avg_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_xr_avg_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_xr_avg_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS XR avg Caller - avg, perc 95, perc 99"},TCH_mos_xr_avg_called:{series:[{series:"TCHS_mos_xr_avg_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_xr_avg_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_xr_avg_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS XR avg Called - avg, perc 95, perc 99"},TCH_mos_xr_min_intervals:{series:[{series:"TCHS_mos_xr_min_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS XR min - count"},TCH_mos_xr_min:{series:[{series:"TCHS_mos_xr_min_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_xr_min_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_xr_min_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS XR min (both) - avg, perc 95, perc 99"},TCH_mos_xr_min_caller:{series:[{series:"TCHS_mos_xr_min_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_xr_min_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_xr_min_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS XR min Caller - avg, perc 95, perc 99"},TCH_mos_xr_min_called:{series:[{series:"TCHS_mos_xr_min_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_xr_min_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_xr_min_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS XR min Called - avg, perc 95, perc 99"}})
}if(existsMosSilenceCdr&&window.rtpQualityUse){Ext.apply(arCdrChart_defChartTypes,{TCH_mos_silence_avg_intervals:{series:[{series:"TCHS_mos_silence_avg_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS Silence avg - count"},TCH_mos_silence_avg:{series:[{series:"TCHS_mos_silence_avg_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_silence_avg_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_silence_avg_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Silence avg (both) - avg, perc 95, perc 99"},TCH_mos_silence_avg_caller:{series:[{series:"TCHS_mos_silence_avg_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_silence_avg_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_silence_avg_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Silence avg Caller - avg, perc 95, perc 99"},TCH_mos_silence_avg_called:{series:[{series:"TCHS_mos_silence_avg_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_silence_avg_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_silence_avg_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Silence avg Called - avg, perc 95, perc 99"},TCH_mos_silence_min_intervals:{series:[{series:"TCHS_mos_silence_min_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"MOS Silence min - count"},TCH_mos_silence_min:{series:[{series:"TCHS_mos_silence_min_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_silence_min_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_silence_min_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Silence min (both) - avg, perc 95, perc 99"},TCH_mos_silence_min_caller:{series:[{series:"TCHS_mos_silence_min_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_silence_min_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_silence_min_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Silence min Caller - avg, perc 95, perc 99"},TCH_mos_silence_min_called:{series:[{series:"TCHS_mos_silence_min_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_silence_min_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_silence_min_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS Silence min Called - avg, perc 95, perc 99"}})
}if(existsMosLqoCdr&&window.rtpQualityUse){Ext.apply(arCdrChart_defChartTypes,{TCH_mos_lqo_caller:{series:[{series:"TCHS_mos_lqo_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_lqo_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_lqo_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS LQO Caller - avg, perc 95, perc 99"},TCH_mos_lqo_called:{series:[{series:"TCHS_mos_lqo_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_mos_lqo_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_mos_lqo_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"MOS LQO Called - avg, perc 95, perc 99"}})
}if(window.rtpQualityUse){Ext.apply(arCdrChart_defChartTypes,{TCH_packet_lost_intervals:{series:[{series:"TCHS_packet_lost_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"packet loss - count"},TCH_packet_lost_caller_intervals:{series:[{series:"TCHS_packet_lost_caller_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"packet loss - caller - count"},TCH_packet_lost_called_intervals:{series:[{series:"TCHS_packet_lost_called_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"packet loss - called - count"},TCH_packet_lost:{series:[{series:"TCHS_packet_lost_perc99",color:"#400B12",fill:true},{series:"TCHS_packet_lost_perc95",color:"#861B29",fill:true},{series:"TCHS_packet_lost_avg",color:"#C6253B",fill:true}],theme:"CdrChartLine",axisTitleLeft:"packet loss - avg, perc 95, perc 99"},TCH_jitter_intervals:{series:[{series:"TCHS_jitter_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"jitter - count"},TCH_jitter:{series:[{series:"TCHS_jitter_perc99",color:"#40350B",fill:true},{series:"TCHS_jitter_perc95",color:"#886E1B",fill:true},{series:"TCHS_jitter_avg",color:"#C89726",fill:true}],theme:"CdrChartLine",axisTitleLeft:"jitter - avg, perc 95, perc 99"},TCH_delay:{series:[{series:"TCHS_delay_perc99",color:"#3B0B40",fill:true},{series:"TCHS_delay_perc95",color:"#791B88",fill:true},{series:"TCHS_delay_avg",color:"#BD26C8",fill:true}],theme:"CdrChartLine",axisTitleLeft:"xÌ„ PDV - avg, perc 95, perc 99"},TCH_rtcp_avgjitter_intervals:{series:[{series:"TCHS_rtcp_avgjitter_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"rtcp avg jitter - count"},TCH_rtcp_avgjitter:{series:[{series:"TCHS_rtcp_avgjitter_perc99",color:"#0B4031",fill:true},{series:"TCHS_rtcp_avgjitter_perc95",color:"#1B885A",fill:true},{series:"TCHS_rtcp_avgjitter_avg",color:"#26C87A",fill:true}],theme:"CdrChartLine",axisTitleLeft:"rtcp avg jitter - avg, perc 95, perc 99"},TCH_rtcp_maxjitter_intervals:{series:[{series:"TCHS_rtcp_maxjitter_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"rtcp max jitter - count"},TCH_rtcp_maxjitter:{series:[{series:"TCHS_rtcp_maxjitter_perc99",color:"#0B400C",fill:true},{series:"TCHS_rtcp_maxjitter_perc95",color:"#1D881B",fill:true},{series:"TCHS_rtcp_maxjitter_avg",color:"#2EC826",fill:true}],theme:"CdrChartLine",axisTitleLeft:"rtcp max jitter - avg, perc 95, perc 99"},TCH_rtcp_avgfr_intervals:{series:[{series:"TCHS_rtcp_avgfr_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"rtcp avg fr - count"},TCH_rtcp_avgfr:{series:[{series:"TCHS_rtcp_avgfr_perc99",color:"#34400B",fill:true},{series:"TCHS_rtcp_avgfr_perc95",color:"#60881B",fill:true},{series:"TCHS_rtcp_avgfr_avg",color:"#A7C826",fill:true}],theme:"CdrChartLine",axisTitleLeft:"rtcp avg fr - avg, perc 95, perc 99"},TCH_rtcp_maxfr_intervals:{series:[{series:"TCHS_rtcp_maxfr_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"rtcp max fr - count"},TCH_rtcp_maxfr:{series:[{series:"TCHS_rtcp_maxfr_perc99",color:"#40350B",fill:true},{series:"TCHS_rtcp_maxfr_perc95",color:"#886E1B",fill:true},{series:"TCHS_rtcp_maxfr_avg",color:"#C89D26",fill:true}],theme:"CdrChartLine",axisTitleLeft:"rtcp max fr - avg, perc 95, perc 99"},TCH_rtcp_avgrtd_intervals:{series:[{series:"TCHS_rtcp_avgrtd_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"rtcp avg rtd - count"},TCH_rtcp_avgrtd:{series:[{series:"TCHS_rtcp_avgrtd_perc99",color:"#40350B",fill:true},{series:"TCHS_rtcp_avgrtd_perc95",color:"#886E1B",fill:true},{series:"TCHS_rtcp_avgrtd_avg",color:"#C89D26",fill:true}],theme:"CdrChartLine",axisTitleLeft:"rtcp avg rtd - avg, perc 95, perc 99"},TCH_rtcp_maxrtd_intervals:{series:[{series:"TCHS_rtcp_maxrtd_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"rtcp max rtd - count"},TCH_rtcp_maxrtd:{series:[{series:"TCHS_rtcp_maxrtd_perc99",color:"#40350B",fill:true},{series:"TCHS_rtcp_maxrtd_perc95",color:"#886E1B",fill:true},{series:"TCHS_rtcp_maxrtd_avg",color:"#C89D26",fill:true}],theme:"CdrChartLine",axisTitleLeft:"rtcp max rtd - avg, perc 95, perc 99"}})
}Ext.apply(arCdrChart_defChartTypes,{TCH_acd_avg:{series:[{series:"TCHS_acd_avg",color:"blue"}],theme:"CdrChartColumn",axisTitleLeft:"ACD"},TCH_acd:{series:[{series:"TCHS_acd",color:"blue"}],theme:"CdrChartColumn",axisTitleLeft:"ACD"},TCH_asr_avg:{series:[{series:"TCHS_asr_avg",color:"blue"}],theme:"CdrChartColumn",axisTitleLeft:"ASR"},TCH_asr:{series:[{series:"TCHS_asr",color:"blue"}],theme:"CdrChartColumn",axisTitleLeft:"ASR"},TCH_ner_avg:{series:[{series:"TCHS_ner_avg",color:"blue"}],theme:"CdrChartColumn",axisTitleLeft:"NER"},TCH_ner:{series:[{series:"TCHS_ner",color:"blue"}],theme:"CdrChartColumn",axisTitleLeft:"NER"},TCH_pdd_intervals:{series:[{series:"TCHS_pdd_intervals",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"PDD - count"},TCH_pdd:{series:[{series:"TCHS_pdd_max",color:"red"},{series:"TCHS_pdd_avg",color:"blue"},{series:"TCHS_pdd_min",color:"green"}],theme:"CdrChartLine",axisTitleLeft:"PDD - max, avg, min"},TCH_sipResp:{series:[{series:"TCHS_sipResp_2XX",color:"green"},{series:"TCHS_sipResp_3XX",color:"blue"},{series:"TCHS_sipResp_4XX",color:"orange"},{series:"TCHS_sipResp_5XX",color:"red"},{series:"TCHS_sipResp_6XX",color:"bloodred"}],theme:"CdrChartLine",axisTitleLeft:"SIP response count"},TCH_sipResponse:{series:[{series:"TCHS_sipResponse",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"SIP response count"},TCH_sipResponse_base:{series:[{series:"TCHS_sipResponse_base",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"SIP response count"},TCH_codecs:{series:[{series:"TCHS_codecs",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"codecs count"},TCH_IP_src:{series:[{series:"TCHS_IP_src",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"IP src"},TCH_IP_dst:{series:[{series:"TCHS_IP_dst",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"IP dst"},TCH_domain_src:{series:[{series:"TCHS_domain_src",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"domain src"},TCH_domain_dst:{series:[{series:"TCHS_domain_dst",baseType:"area"}],theme:"CdrChartArea",axisTitleLeft:"domain dst"}});
if(window.existsCdrSilence){Ext.apply(arCdrChart_defChartTypes,{TCH_silence:{series:[{series:"TCHS_silence_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_silence_perc95",color:"#1B6288",fill:true},{series:"TCHS_silence_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Silence max(both) - avg, perc 95, perc 99"},TCH_silence_caller:{series:[{series:"TCHS_silence_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_silence_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_silence_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Silence Caller - avg, perc 95, perc 99"},TCH_silence_called:{series:[{series:"TCHS_silence_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_silence_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_silence_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Silence Called - avg, perc 95, perc 99"},TCH_silence_end:{series:[{series:"TCHS_silence_end_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_silence_end_perc95",color:"#1B6288",fill:true},{series:"TCHS_silence_end_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Last Silence max(both) - avg, perc 95, perc 99"},TCH_silence_end_caller:{series:[{series:"TCHS_silence_end_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_silence_end_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_silence_end_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Last Silence Caller - avg, perc 95, perc 99"},TCH_silence_end_called:{series:[{series:"TCHS_silence_end_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_silence_end_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_silence_end_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Last Silence Called - avg, perc 95, perc 99"}})
}if(window.existsCdrClipping){Ext.apply(arCdrChart_defChartTypes,{TCH_clipping:{series:[{series:"TCHS_clipping_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_clipping_perc95",color:"#1B6288",fill:true},{series:"TCHS_clipping_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Clipped Frames max(both) - avg, perc 95, perc 99"},TCH_clipping_caller:{series:[{series:"TCHS_clipping_caller_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_clipping_caller_perc95",color:"#1B6288",fill:true},{series:"TCHS_clipping_caller_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Clipped Frames Caller - avg, perc 95, perc 99"},TCH_clipping_called:{series:[{series:"TCHS_clipping_called_perc99",color:"#2C9EE5",fill:true},{series:"TCHS_clipping_called_perc95",color:"#1B6288",fill:true},{series:"TCHS_clipping_called_avg",color:"#0B2C40",fill:true}],theme:"CdrChartLine",axisTitleLeft:"Clipped Frames Called - avg, perc 95, perc 99"}})
}arIpProto=[[_IPPROTO_IP,"Dummy protocol for TCP."],[_IPPROTO_ICMP,"Internet Control Message Protocol."],[_IPPROTO_IGMP,"Internet Group Management Protocol."],[_IPPROTO_IPIP,"IPIP tunnels (older KA9Q tunnels use 94)."],[_IPPROTO_TCP,"Transmission Control Protocol."],[_IPPROTO_EGP,"Exterior Gateway Protocol."],[_IPPROTO_PUP,"PUP protocol."],[_IPPROTO_UDP,"User Datagram Protocol."],[_IPPROTO_IDP,"XNS IDP protocol."],[_IPPROTO_TP,"SO Transport Protocol Class 4."],[_IPPROTO_DCCP,"Datagram Congestion Control Protocol."],[_IPPROTO_IPV6,"IPv6 header."],[_IPPROTO_ROUTING,"IPv6 routing header."],[_IPPROTO_FRAGMENT,"IPv6 fragmentation header."],[_IPPROTO_RSVP,"Reservation Protocol."],[_IPPROTO_GRE,"General Routing Encapsulation."],[_IPPROTO_ESP,"encapsulating security payload."],[_IPPROTO_AH,"authentication header."],[_IPPROTO_ICMPV6,"ICMPv6."],[_IPPROTO_NONE,"IPv6 no next header."],[_IPPROTO_DSTOPTS,"IPv6 destination options."],[_IPPROTO_MTP,"Multicast Transport Protocol."],[_IPPROTO_ENCAP,"Encapsulation Header."],[_IPPROTO_PIM,"Protocol Independent Multicast."],[_IPPROTO_COMP,"Compression Header Protocol."],[_IPPROTO_SCTP,"Stream Control Transmission Protocol."],[_IPPROTO_UDPLITE,"UDP-Lite protocol."],[_IPPROTO_RAW,"Raw IP packets."]];
arWeekday=[[1,arLang.Lsunday],[2,arLang.Lmonday],[3,arLang.Ltuesday],[4,arLang.Lwednesday],[5,arLang.Lthursday],[6,arLang.Lfriday],[7,arLang.Lsaturday]];
arDashboardTimeIntervals=[["last_5minutes",arLang.LtimeInterval_last_5minutes,"TA_SECONDS",5*60,60,0,10],["last_15minutes",arLang.LtimeInterval_last_15minutes,"TA_MINUTES",15*60,60,0,20],["last_30minutes",arLang.LtimeInterval_last_30minutes,"TA_MINUTES",30*60,60,0,20],["last_60minutes",arLang.LtimeInterval_last_60minutes,"TA_MINUTES",60*60,60,0,30],["last_120minutes",arLang.LtimeInterval_last_120minutes,"TA_MINUTES",120*60,60,0,60],["last_180minutes",arLang.LtimeInterval_last_180minutes,"TA_MINUTES",180*60,60,0,60],["this_hour",arLang.LtimeInterval_this_hour,"TA_MINUTES",60*60,60*60,0,30],["last_2hours",arLang.LtimeInterval_last_2hours,"TA_MINUTES",2*60*60,60*60,15*60,60],["last_3hours",arLang.LtimeInterval_last_3hours,"TA_MINUTES",3*60*60,60*60,15*60,60],["last_6hours",arLang.LtimeInterval_last_6hours,"TA_5MINUTES",6*60*60,60*60,15*60,60],["last_12hours",arLang.LtimeInterval_last_12hours,"TA_5MINUTES",12*60*60,60*60,15*60,60],["last_24hours",arLang.LtimeInterval_last_24hours,"TA_10MINUTES",24*60*60,60*60,0,300],["last_48hours",arLang.LtimeInterval_last_48hours,"TA_QUARTER",2*24*60*60,60*60,0,300],["last_72hours",arLang.LtimeInterval_last_72hours,"TA_HOURS",3*24*60*60,60*60,0,300],["this_day",arLang.LtimeInterval_this_day,"TA_10MINUTES",24*60*60,24*60*60,0,300],["last_2days",arLang.LtimeInterval_last_2days,"TA_QUARTER",2*24*60*60,24*60*60,0,300],["last_3days",arLang.LtimeInterval_last_3days,"TA_HOURS",3*24*60*60,24*60*60,0,300],["last_7days",arLang.LtimeInterval_last_7days,"TA_HOURS",7*24*60*60,24*60*60,0,600],["last_8days",arLang.LtimeInterval_last_8days,"TA_HOURS",8*24*60*60,24*60*60,0,600],["this_week_m",arLang.LtimeInterval_this_week_from_monday,"TA_HOURS",7*24*60*60,24*60*60,0,600,"monday"],["this_week_s",arLang.LtimeInterval_this_week_from_sunday,"TA_HOURS",7*24*60*60,24*60*60,0,600,"sunday"],["last_30days",arLang.LtimeInterval_last_30days,"TA_2HOURS",30*24*60*60,24*60*60,0,1200],["this_month",arLang.LtimeInterval_this_month,"TA_2HOURS",31*24*60*60,24*60*60,0,1200,"1_day","last_day"]];
arDashboardTimeIntervals_charts_long=[["last_60days",arLang.LtimeInterval_last_60days,"TA_DAYS",60*24*60*60,24*60*60,0,1200],["last_120days",arLang.LtimeInterval_last_120days,"TA_DAYS",120*24*60*60,24*60*60,0,1200],["last_180days",arLang.LtimeInterval_last_180days,"TA_DAYS",180*24*60*60,24*60*60,0,1200],["last_360days",arLang.LtimeInterval_last_360days,"TA_DAYS",360*24*60*60,24*60*60,0,1200]];
arDashboardTimeIntervals_sensors_rrd=[["last_60minutes",arLang.LtimeInterval_last_60minutes,"TA_MINUTES",60*60,60,0,30],["last_24hours",arLang.LtimeInterval_last_24hours,"TA_10MINUTES",24*60*60,60*60,0,300],["last_7days",arLang.LtimeInterval_last_week,"TA_HOURS",7*24*60*60,24*60*60,0,600],["last_30days",arLang.LtimeInterval_last_month,"TA_DAYS",30*24*60*60,24*60*60,0,1200],["last_year",arLang.LtimeInterval_last_year,"TA_DAYS",365*24*60*60,24*60*60,0,1200],["-"],["last_2hours",arLang.LtimeInterval_last_2hours,"TA_MINUTES",2*60*60,60*60,15*60,60],["last_3hours",arLang.LtimeInterval_last_3hours,"TA_MINUTES",3*60*60,60*60,15*60,60],["last_2days",arLang.LtimeInterval_last_2days,"TA_QUARTER",2*24*60*60,24*60*60,0,300],["last_3days",arLang.LtimeInterval_last_3days,"TA_HOURS",3*24*60*60,24*60*60,0,300]];
arExportCsvTimeIntervals=[["past_interval_by_schedule_every",arLang.LtimeInterval_past_interval_by_schedule_every],["past_hour",arLang.LtimeInterval_past_hour],["past_2_hours",arLang.LtimeInterval_past_2_hours],["past_3_hours",arLang.LtimeInterval_past_3_hours],["past_8_hours",arLang.LtimeInterval_past_8_hours],["past_day",arLang.LtimeInterval_past_day],["past_2_days",arLang.LtimeInterval_past_2_days],["past_3_days",arLang.LtimeInterval_past_3_days],["past_month",arLang.LtimeInterval_past_month]];
arCrontabType=[["create_csv_cdr",arLang.LcrontabType_create_csv_cdr],["create_csv_message",arLang.LcrontabType_create_csv_message],["create_csv_reg",arLang.LcrontabType_create_csv_reg]];
arCrontabTypeAt=[["every",arLang.LcrontabTypeAt_every],["at",arLang.LcrontabTypeAt_at]];
arCustomCleaningType=[["cleaning_cdr",arLang.LcustomCleaningType_cleaning_cdr],["cleaning_message",arLang.LcustomCleaningType_cleaning_message]];
arDscp=[[0,"CS0",0],[8,"CS1",1],[10,"AF11",1],[12,"AF12",1],[14,"AF13",1],[16,"CS2",2],[18,"AF21",2],[20,"AF22",2],[22,"AF23",2],[24,"CS3",3],[26,"AF31",3],[28,"AF32",3],[30,"AF33",3],[32,"CS4",4],[34,"AF41",4],[36,"AF42",4],[38,"AF43",4],[40,"CS5",5],[46,"EF",5],[48,"CS6",6],[56,"CS7",7]];
arScreenPopupOn=[["183/180",arLang.LscreenPopupOn_183x180],["200",arLang.LscreenPopupOn_200]];
arCountryOrContinent=[["country",arLang.LcountryOrContinent_country],["continent",arLang.LcountryOrContinent_continent]];
arSendAlertReportIf=[[0,arLang.LarSendAlertReportIf_match],[1,arLang.LarSendAlertReportIf_no_match],[2,arLang.LarSendAlertReportIf_both]];
arDashboardTypePanels=["chart","chart_3d_rtp_stat","grid_rtp_stat","sip_response_pie_chart","top_ip_address_chart","asr_acd_mos_by_sip_ip_grid","asr_acd_mos_by_rtp_ip_grid","asr_acd_mos_by_callerd_grid","asr_acd_mos_by_ua_grid","asr_acd_mos_by_country_by_sip_ip_grid","asr_acd_mos_by_country_by_number_grid","asr_acd_mos_by_sip_response_grid","chart_message","sip_response_pie_chart_message","top_ip_address_chart_message","chart_sip_msg","count_by_sip_ip_grid_message","count_by_callerd_grid_message","count_by_country_by_sip_ip_grid_message","count_by_country_by_number_grid_message","count_by_sip_response_grid_message","sniffer_stat","sniffer_rrd","active_calls_map","active_calls_chart"];
if(!user_can_3d_rtp_charts()){var a=arDashboardTypePanels.indexOf("chart_3d_rtp_stat");
if(a>=0){arDashboardTypePanels.splice(a,1)
}}if(window.enableCollectd){arDashboardTypePanels.push("collectd_rrd")
}arTypeHoliday=[["fixed",arLang.LarTypeHoliday_fixed],["movable",arLang.LarTypeHoliday_movable],["easter_monday",arLang.LarTypeHoliday_easter_monday],["easter_friday",arLang.LarTypeHoliday_easter_friday]];
arCdrSide=[["src",arLang.LcdrSideSrc],["dst",arLang.LcdrSideDst],["both",arLang.LcdrSideBoth]];
arSensorGraphsRRD=[["calls",arLang.LsensorGraphsRRD_calls],["heap",arLang.LsensorGraphsRRD_heap],["SQLq",arLang.LsensorGraphsRRD_SQLq],["SQLf",arLang.LsensorGraphsRRD_SQLf],["tCPU",arLang.LsensorGraphsRRD_tCPU],["memusage",arLang.LsensorGraphsRRD_memusage],["loadavg",arLang.LsensorGraphsRRD_loadavg],["PS",arLang.LsensorGraphsRRD_PS],["PSC",arLang.LsensorGraphsRRD_PSC],["PSS",arLang.LsensorGraphsRRD_PSS],["PSSR",arLang.LsensorGraphsRRD_PSSR],["PSSM",arLang.LsensorGraphsRRD_PSSM],["PSR",arLang.LsensorGraphsRRD_PSR],["PSA",arLang.LsensorGraphsRRD_PSA],["speed",arLang.LsensorGraphsRRD_speed],["drop",arLang.LsensorGraphsRRD_drop],["tacCPU",arLang.LsensorGraphsRRD_tacCPU]];
arColumnsCDRstat=["total_perc","duration_all","asr_all","ner_all","acd_all"];
if(window.rtpQualityUse){arColumnsCDRstat.push("mos_all","mos_perc95_all","mos_perc99_all")
}arTypeIp=[[0,"static",arLang.type_ip_static],[1,"dhcp",arLang.type_ip_dhcp]];
if(existsMosXrCdr&&window.rtpQualityUse){arColumnsCDRstat.push("mos_xr_avg_all","mos_xr_avg_perc95_all","mos_xr_avg_perc99_all","mos_xr_avg_caller_all","mos_xr_avg_caller_perc95_all","mos_xr_avg_caller_perc99_all","mos_xr_avg_called_all","mos_xr_avg_called_perc95_all","mos_xr_avg_called_perc99_all","mos_xr_min_all","mos_xr_min_perc95_all","mos_xr_min_perc99_all","mos_xr_min_caller_all","mos_xr_min_caller_perc95_all","mos_xr_min_caller_perc99_all","mos_xr_min_called_all","mos_xr_min_called_perc95_all","mos_xr_min_called_perc99_all")
}if(existsMosSilenceCdr&&window.rtpQualityUse){arColumnsCDRstat.push("mos_silence_avg_all","mos_silence_avg_perc95_all","mos_silence_avg_perc99_all","mos_silence_avg_caller_all","mos_silence_avg_caller_perc95_all","mos_silence_avg_caller_perc99_all","mos_silence_avg_called_all","mos_silence_avg_called_perc95_all","mos_silence_avg_called_perc99_all","mos_silence_min_all","mos_silence_min_perc95_all","mos_silence_min_perc99_all","mos_silence_min_caller_all","mos_silence_min_caller_perc95_all","mos_silence_min_caller_perc99_all","mos_silence_min_called_all","mos_silence_min_called_perc95_all","mos_silence_min_called_perc99_all")
}if(existsMosLqoCdr&&window.rtpQualityUse){arColumnsCDRstat.push("mos_lqo_caller_all","mos_lqo_caller_perc95_all","mos_lqo_caller_perc99_all","mos_lqo_called_all","mos_lqo_called_perc95_all","mos_lqo_called_perc99_all")
}if(window.rtpQualityUse){arColumnsCDRstat.push("packets_lost_all","packets_lost_perc95_all","packets_lost_perc99_all","jitter_all","jitter_perc95_all","jitter_perc99_all","delay_all","delay_perc95_all","delay_perc99_all")
}arColumnsCDRstat.push("pdd_all","pdd_perc95_all","pdd_perc99_all","cps_max","cps_avg");
if(window.rtpQualityUse){arColumnsCDRstat.push("rtcp_maxfr","rtcp_maxfr_perc95_all","rtcp_maxfr_perc99_all","rtcp_avgfr","rtcp_avgfr_perc95_all","rtcp_avgfr_perc99_all","rtcp_maxjitter","rtcp_maxjitter_perc95_all","rtcp_maxjitter_perc99_all","rtcp_avgjitter","rtcp_avgjitter_perc95_all","rtcp_avgjitter_perc99_all","rtcp_maxrtd","rtcp_maxrtd_perc95_all","rtcp_maxrtd_perc99_all","rtcp_avgrtd","rtcp_avgrtd_perc95_all","rtcp_avgrtd_perc99_all")
}if(existsCdrSilence){arColumnsCDRstat.push("silence_all","silence_perc95_all","silence_perc99_all","silence_end_all","silence_end_perc95_all","silence_end_perc99_all")
}if(existsCdrClipping){arColumnsCDRstat.push("clipping_all","clipping_perc95_all","clipping_perc99_all")
}if(window.fillBillingTable){arColumnsCDRstat.push("price_operator","price_customer","price_difference")
}if(window.disablePercentiles){var b=[];
for(var a=0;
a<arColumnsCDRstat.length;
a++){if(!arColumnsCDRstat[a].match(/_perc9/)){b.push(arColumnsCDRstat[a])
}}arColumnsCDRstat=b
}arColumnsRtpStat={counter:null,mos_f1_min:{agreg:["min","avg","perc95","perc99"],chart:true},mos_f1_avg:{agreg:["min","avg","perc95","perc99"],chart:true},mos_f2_min:{agreg:["min","avg","perc95","perc99"],chart:true},mos_f2_avg:{agreg:["min","avg","perc95","perc99"],chart:true},mos_ad_min:{agreg:["min","avg","perc95","perc99"],chart:true},mos_ad_avg:{agreg:["min","avg","perc95","perc99"],chart:true},jitter_max:{agreg:["max","avg","perc95","perc99"],chart:true},jitter_avg:{agreg:["max","avg","perc95","perc99"],chart:true},loss_max:{agreg:["max","avg","perc95","perc99"],chart:true},loss_avg:{agreg:["max","avg","perc95","perc99"],chart:true}};
arChart3D_rtp_stat=[["mosf1_min",arLang.LarChart3D_rtp_stat_mosf1_min,arLang.LarChart3D_rtp_stat_mosf1_min_pretty],["mosf1_avg",arLang.LarChart3D_rtp_stat_mosf1_avg,arLang.LarChart3D_rtp_stat_mosf1_avg_pretty],["mosf2_min",arLang.LarChart3D_rtp_stat_mosf2_min,arLang.LarChart3D_rtp_stat_mosf2_min_pretty],["mosf2_avg",arLang.LarChart3D_rtp_stat_mosf2_avg,arLang.LarChart3D_rtp_stat_mosf2_avg_pretty],["mosAD_min",arLang.LarChart3D_rtp_stat_mosAD_min,arLang.LarChart3D_rtp_stat_mosAD_min_pretty],["mosAD_avg",arLang.LarChart3D_rtp_stat_mosAD_avg,arLang.LarChart3D_rtp_stat_mosAD_avg_pretty],["jitter_max",arLang.LarChart3D_rtp_stat_jitter_max,arLang.LarChart3D_rtp_stat_jitter_max_pretty],["jitter_avg",arLang.LarChart3D_rtp_stat_jitter_avg,arLang.LarChart3D_rtp_stat_jitter_avg_pretty],["loss_max",arLang.LarChart3D_rtp_stat_loss_max,arLang.LarChart3D_rtp_stat_loss_max_pretty],["loss_avg",arLang.LarChart3D_rtp_stat_loss_avg,arLang.LarChart3D_rtp_stat_loss_avg_pretty]];
arCdrCustomHeadersSpecialType=[["max_length_sip_data",arLang.LarCdrCustomHeadersSpecialType_max_length_sip_data],["max_length_sip_packet",arLang.LarCdrCustomHeadersSpecialType_max_length_sip_packet],["max_retransmission_invite",arLang.LarCdrCustomHeadersSpecialType_max_retransmission_invite]];
arMessageCustomHeadersSpecialType=[["gsm_dcs",arLang.LarMessageCustomHeadersSpecialType_gsm_dcs],["gsm_voicemail",arLang.LarMessageCustomHeadersSpecialType_gsm_voicemail],["max_length_sip_data",arLang.LarMessageCustomHeadersSpecialType_max_length_sip_data],["max_length_sip_packet",arLang.LarMessageCustomHeadersSpecialType_max_length_sip_packet]];
arLogSensorType=[["debug",arLang.LarLogSensorType_debug],["info",arLang.LarLogSensorType_info],["notice",arLang.LarLogSensorType_notice],["warning",arLang.LarLogSensorType_warning],["error",arLang.LarLogSensorType_error],["critical",arLang.LarLogSensorType_critical],["alert",arLang.LarLogSensorType_alert],["emergency",arLang.LarLogSensorType_emergency]];
arSs7State=[["call_setup",arLang.LarSs7State_call_setup],["in_call",arLang.LarSs7State_in_call],["completed",arLang.LarSs7State_completed],["rejected",arLang.LarSs7State_rejected],["canceled",arLang.LarSs7State_canceled]]
}function fillDataArrays(){if(window.enableTestSipUser){arCdrGroupBy.push([_CdrGroupBy_sipUsers,arLang.LcdrGroupBy_sipUsers,"sip_user_id","sip_user_name"])
}arCdrGroupBy.push([_CdrGroupBy_sipResponse,arLang.LcdrGroupBy_sipResponse,"lastSIPresponse"],[_CdrGroupBy_sipResponse_bye_code,arLang.LcdrGroupBy_sipResponse_bye_code,["lastSIPresponse","bye"]]);
if(window.existsCdrReason){arCdrGroupBy.push([_CdrGroupBy_reasonSip,arLang.LcdrGroupBy_reasonSip,"reason_sip"],[_CdrGroupBy_reasonQ850,arLang.LcdrGroupBy_reasonQ850,"reason_q850"])
}arCdrGroupBy.push([_CdrGroupBy_codecs,arLang.LcdrGroupBy_codecs,"x_payload","x_codec"],[_CdrGroupBy_sipIP,arLang.LcdrGroupBy_sipIP,"sipip","sip_ip"]);
if(window.enableGroupCdrByIpGroups){arCdrGroupBy.push([_CdrGroupBy_ipGroup,arLang.LcdrGroupBy_ipGroup,"cb_ip_groups_id","cb_ip_groups_descr"])
}arCdrGroupBy.push([_CdrGroupBy_ua,arLang.LcdrGroupBy_ua,"ua_id","ua"]);
if(window.existsCdrCountryCode){arCdrGroupBy.push([_CdrGroupBy_country_number,arLang.LcdrGroupBy_country_number,"country_code","country","number"],[_CdrGroupBy_country_caller,arLang.LcdrGroupBy_country_caller,"country_code","country","caller"],[_CdrGroupBy_country_called,arLang.LcdrGroupBy_country_called,"country_code","country","called"],[_CdrGroupBy_country_sipip,arLang.LcdrGroupBy_country_sip,"country_code","country","sipip"],[_CdrGroupBy_country_sipcallerip,arLang.LcdrGroupBy_sipcallerip,"country_code","country","sipcallerip"],[_CdrGroupBy_country_sipcalledip,arLang.LcdrGroupBy_sipcalledip,"country_code","country","sipcalledip"])
}arMessageGroupBy.push([_MessageGroupBy_sipResponse,arLang.LmessageGroupBy_sipResponse,"lastSIPresponse"],[_MessageGroupBy_sipIP,arLang.LmessageGroupBy_sipIP,"sipip","sip_ip"],[_MessageGroupBy_ipGroup,arLang.LmessageGroupBy_ipGroup,"cb_ip_groups_id","cb_ip_groups_descr"]);
if(window.existsCdrCountryCode){arMessageGroupBy.push([_MessageGroupBy_country_number,arLang.LmessageGroupBy_country_number,"country_code","country","number"],[_MessageGroupBy_country_caller,arLang.LmessageGroupBy_country_caller,"country_code","country","caller"],[_MessageGroupBy_country_called,arLang.LmessageGroupBy_country_called,"country_code","country","called"],[_MessageGroupBy_country_sipip,arLang.LmessageGroupBy_country_sip,"country_code","country","sipip"],[_MessageGroupBy_country_sipcallerip,arLang.LmessageGroupBy_sipcallerip,"country_code","country","sipcallerip"],[_MessageGroupBy_country_sipcalledip,arLang.LmessageGroupBy_sipcalledip,"country_code","country","sipcalledip"])
}var a=null;
for(var b=0;
b<arCdrChart_chartSeriesTypes.length;
b++){if(arCdrChart_chartSeriesTypes[b][1]){a=arCdrChart_chartSeriesTypes[b][1]
}arCdrChart_chartSeriesTypes[b].splice(3,0,a+(arCdrChart_chartSeriesTypes[b][2]?" - "+arCdrChart_chartSeriesTypes[b][2]:""))
}a=null;
for(var b=0;
b<arMessagesChart_chartSeriesTypes.length;
b++){if(arMessagesChart_chartSeriesTypes[b][1]){a=arMessagesChart_chartSeriesTypes[b][1]
}arMessagesChart_chartSeriesTypes[b].splice(3,0,a+(arMessagesChart_chartSeriesTypes[b][2]?" - "+arMessagesChart_chartSeriesTypes[b][2]:""))
}a=null;
for(var b=0;
b<arSipMsgChart_chartSeriesTypes.length;
b++){if(arSipMsgChart_chartSeriesTypes[b][1]){a=arSipMsgChart_chartSeriesTypes[b][1]
}arSipMsgChart_chartSeriesTypes[b].splice(3,0,a+(arSipMsgChart_chartSeriesTypes[b][2]?" - "+arSipMsgChart_chartSeriesTypes[b][2]:""))
}}function getTCHS_names(){var b={};
for(var a=0;
a<arCdrChart_chartSeriesTypes.length;
a++){if(!Ext.isDefined(b[arCdrChart_chartSeriesTypes[a][0]])){b[arCdrChart_chartSeriesTypes[a][0]]=arCdrChart_chartSeriesTypes[a][3]
}}for(var a=0;
a<arMessagesChart_chartSeriesTypes.length;
a++){if(!Ext.isDefined(b[arMessagesChart_chartSeriesTypes[a][0]])){b[arMessagesChart_chartSeriesTypes[a][0]]=arMessagesChart_chartSeriesTypes[a][3]
}}return(b)
}Ext.ns("CDR");
function showGraph(f,d,c){var a=(new Date).getTime();
var b=new Ext.Window({iconCls:"icon_find",title:c,closable:true,resizable:true,layout:"fit",items:{xtype:"panel",items:{xtype:"image",src:"php/lib/img.php?type=graph&id="+f+"&srcdst="+d+"&load_id="+a,listeners:{render:function(g){g.el.on({load:function(){var h=b.getWidth()+Math.min(Ext.dom.Element.getViewportWidth()-b.getWidth()-10,b.getItems()[0].body.dom.scrollWidth-b.getItems()[0].body.dom.clientWidth);
b.setWidth(h);
b.setPosition((Ext.dom.Element.getViewportWidth()-h)/2);
getDebugLogForLoadId(a)
}})
}}},width:800,height:260,autoScroll:true,border:false}});
b.show()
}function showRtpStreamAnalysis(b,a){CDR.Utils.getCdrRtpStreams({cdr_id:b},function(c){var g=null;
for(var f=0;
f<c.length&&!g;
f++){for(var d=0;
d<c[f].length&&!g;
d++){if(c[f][d].index==a){g=c[f][d]
}}}if(g){rtpStreamAnalysis({cdr_id:b,ssrc:g.ssrc,ip_src:g.saddr,ip_dst:g.daddr,port_src:g.sport,port_dst:g.dport,stream_index:g.index})
}})
}function showGraphOrRtpAnalysis(d,h,a,p,n,b,l){if(!Ext.isDefined(l)){CDR.Utils.getCdrRtpStreams({cdr_id:d,caller:h=="a",called:h=="b",stream_index:a,ip_src:n},function(r){showGraphOrRtpAnalysis(d,h,a,p,n,b,r?r:false)
},this)
}else{if(!l){showGraph(d,h,p?p:findLangS("cdr","text","rtpStream")+" from IP: "+n)
}else{var c=[];
for(var q=0;
q<l.length;
q++){l[q].sort(function(s,r){return(r.received-s.received)
});
for(var m=0;
m<l[q].length;
m++){if(m==0&&c.length){c.push("-")
}var o={cdr_id:d,ssrc:l[q][m].ssrc,ip_src:l[q][m].saddr,ip_dst:l[q][m].daddr,port_src:l[q][m].sport,port_dst:l[q][m].dport,stream_index:l[q][m].index,received:l[q][m].received,firsttime:l[q][m].firsttime,duration:l[q][m].duration};
var k=[];
if(l[q][m].received>2){k.push({text:findLangS("cdr","menu","flowChart"),_type:"flow_chart"})
}k.push({text:findLangS("cdr","menu","rtpStreamAnalysis"),_type:"analysis"});
c.push({text:findLangS("cdr","menu","rtpStream")+": "+CDR.Utils.rtpStreamTextInfo(l[q][m],{packets:true}),_analysisParams:o,_type:"analysis",handler:k?undefined:g,menu:k?{defaults:{handler:g,scope:this,_analysisParams:o},items:k}:undefined,scope:this})
}}var f=new Ext.menu.Menu({items:c});
f.showAtMouse(b);
function g(r){switch(r._type){case"flow_chart":if(r._analysisParams){showGraph(d,r._analysisParams.stream_index-1,findLangS("cdr","text","rtpStream")+" "+CDR.Utils.rtpStreamTextInfo(r._analysisParams,{packets:true,firsttime:true,duration:true}))
}else{showGraph(d,h,p?p:findLangS("cdr","text","rtpStream")+" from IP: "+n)
}break;
case"analysis":rtpStreamAnalysis(r._analysisParams);
break
}}}}}function showHttp_jjDetail(d,g,b){if(!b){ajaxSafeRequest({url:pcap2text_Url_PacketDetail(d,"detailhttp_jj_json"),success:function(h){showHttp_jjDetail(d,g,h.data)
}})
}else{var a=[];
if(b.body){if((b.body[0]=="{"||b.body[0]=="[")&&!isDataEmpty(Ext.decode(b.body))){a.push({xtype:"ParseObjectToTreePanel",data:b.body,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:findLangS("cdr","title","bodyTab")})
}else{if(b.body.match(/\<\?xml/)){a.push({xtype:"ParseXmlPdmlPanel",data:b.body,pdml:false,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:findLangS("cdr","title","bodyTab"),packetDetail:true,enableTbarButtonExpandAll:true})
}}a.push({xtype:"panel",html:b.body_html,autoScroll:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},bodyStyle:{padding:5,font:__font_Monospace,"word-wrap":"break-word","white-space":"normal"},title:findLangS("cdr","title","bodyInRawTab")});
if(b.body.match(/forward_voip":"<iq from/)||b.body.match(/request><iq from/)||b.body.match(/<tangle xmlns/)){var f=b.body.match(/forward_voip":"<iq from/)||b.body.match(/request><iq from/)?b.body.substr(b.body.search("<iq from")):b.body.substr(b.body.search("<tangle xmlns"));
a.push({xtype:"ParseXmlPdmlPanel",data:f,pdml:false,keepTopLevel:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:findLangS("cdr","title","bodyInXmlTab"),packetDetail:true,autoExpandAll:true})
}}if(b.http){a.push({xtype:"panel",html:b.http.replaceall("\r\n","<br>"),autoScroll:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},bodyStyle:{padding:5,font:__font_Monospace},title:findLangS("cdr","title","httpHeaderTab")})
}if(a.length==1){a[0].border=true;
delete a[0].style;
delete a[0].title;
items=a[0]
}else{items={xtype:"tabpanel",items:a,border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}}
}var c=new Ext.Window({iconCls:"icon_find",title:g,closable:true,resizable:true,maximizable:true,layout:"fit",items:items,border:false,width:800,height:640});
c.show()
}}function showWebrtcDetail(d,f,b){if(!b){ajaxSafeRequest({url:pcap2text_Url_PacketDetail(d,"detailwebrtc_json"),success:function(g){showWebrtcDetail(d,f,g.data)
}})
}else{var a=[];
if(b.body){if((b.body[0]=="{"||b.body[0]=="[")&&!isDataEmpty(Ext.decode(b.body))){a.push({xtype:"ParseObjectToTreePanel",data:b.body,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:findLangS("cdr","title","bodyTab")})
}else{if(b.body.match(/\<\?xml/)){a.push({xtype:"ParseXmlPdmlPanel",data:b.body,pdml:false,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:findLangS("cdr","title","bodyTab"),packetDetail:true,enableTbarButtonExpandAll:true})
}}a.push({xtype:"panel",html:b.body_html,autoScroll:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},bodyStyle:{padding:5,font:__font_Monospace,"word-wrap":"break-word","white-space":"normal"},title:findLangS("cdr","title","bodyInRawTab")})
}if(a.length==1){a[0].border=true;
delete a[0].style;
delete a[0].title;
items=a[0]
}else{items={xtype:"tabpanel",items:a,border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}}
}var c=new Ext.Window({iconCls:"icon_find",title:f,closable:true,resizable:true,maximizable:true,layout:"fit",items:items,border:false,width:800,height:640});
c.show()
}}function showPacketDetailEnum(h,k,b){var g=pcap2text_Url_PacketDetail(h,"detailenum_jj");
var d={xtype:"panel",loader:{url:g,loadMask:true},autoScroll:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},bodyStyle:{padding:5,font:__font_Monospace},listeners:{afterrender:function(l){Ext.defer(function(){l.ajaxSafeLoad()
},10,this)
}}};
var f=null;
if(!b){f={xtype:"panel",layout:"fit",border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},listeners:{afterrender:function(l){ajaxSafeRequest({url:"php/pcap2text.php",params:pcap2text_AjaxParams_PacketDetail(h,"detailenum_jj"),success:function(m){l.add(new Tools.ParseXmlPdmlPanel({data:m.data,pdml:true,onlyKeyColumn:true,proportionalFont:true,hideHeaders:true,enableTbarButtonExpandAll:true,enableTbarButtonExpandSipBranch:false,disableIcon:true,border:false}))
},maskEl:l,deferMask:true})
}}}
}var a;
if(f){d.title="text";
f.title="tree";
a={xtype:"tabpanel",items:[f],border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}}
}else{d.border=true;
delete d.style;
a=d
}var c=new Ext.Window({iconCls:"icon_find",title:k,closable:true,resizable:true,maximizable:true,layout:"fit",items:a,border:false,width:800,height:640});
c.show()
}function showPacketDetail(c,k,m,l){var a=pcap2text_Url_PacketDetail(c,"detailraw");
var f=null;
if(!l){var f={xtype:"panel",loader:{url:a,loadMask:true},autoScroll:true,border:false,title:"text",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},bodyStyle:{padding:5,font:__font_Monospace},listeners:{afterrender:function(n){Ext.defer(function(){n.ajaxSafeLoad()
},10,this)
}}}
}var d=null;
if(!m){d={xtype:"panel",layout:"fit",border:false,title:"tree",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},listeners:{afterrender:function(n){ajaxSafeRequest({url:"php/pcap2text.php",params:pcap2text_AjaxParams_PacketDetail(c,"detailpdml_json_session_variable"),success:function(o){n.add(new Tools.ParseXmlPdmlPanel({dataId:o.dataId,pdml:true,onlyKeyColumn:true,proportionalFont:true,hideHeaders:true,enableTbarButtonExpandAll:true,enableTbarButtonExpandSipBranch:true,disableIcon:true,border:false}))
},maskEl:n,deferMask:true})
}}}
}var b=null;
if(c.txt){b={xtype:"panel",layout:"fit",border:false,title:"xml",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},listeners:{afterrender:function(n){ajaxSafeRequest({url:"php/pcap2text.php",params:{action:"txt_data",cdr_ID:c.txt.cdr_ID,time:c.txt.time,type:c.txt.type},success:function(o){n.add(new Tools.ParseXmlPdmlPanel({dataId:o.dataId,xml:true,onlyKeyColumn:true,proportionalFont:true,hideHeaders:true,enableTbarButtonExpandAll:true,disableIcon:true,border:false}))
},maskEl:n,deferMask:true})
}}}
}var g=[];
if(f){g.push(f)
}if(d){g.push(d)
}if(b){g.push(b)
}if(g.length>1){g={xtype:"tabpanel",items:g,border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}}
}else{g=g[0];
delete g.title;
delete g.style
}var h=new Ext.Window({iconCls:"icon_find",title:k,closable:true,resizable:true,maximizable:true,layout:"fit",items:g,border:false,width:800,height:640});
h.show()
}function pcap2text_Url_PacketDetail(b,a){if(Ext.isString(b)){b=Ext.decode(b)
}return("php/pcap2text.php?id="+b.id+"&num="+b.num+"&find_pass="+b.find_pass+"&action="+a+(b.message?"&msg=1":"")+(b.sip_msg?"&sip_msg=1":"")+(b.uniquekey?"&uniquekey="+b.uniquekey:"")+(b.search?"&search="+encodeURIComponent(b.search):"")+(b.type_packets?"&type_packets="+encodeURIComponent(b.type_packets):"")+(b.spec_type?"&spec_type="+encodeURIComponent(b.spec_type):""))
}function pcap2text_AjaxParams_PacketDetail(b,a){if(Ext.isString(b)){b=Ext.decode(b)
}return({id:b.id,num:b.num,action:a,msg:b.message?1:0,sip_msg:b.sip_msg?1:0,ss7:b.ss7?1:0,uniquekey:b.uniquekey,search:b.search,type_packets:b.type_packets,spec_type:b.spec_type})
}Ext.define("CDR.Grid",{extend:"Ext.Panel",alias:"widget.CDRX",subsystem:"cdr",constructor:function(F){var B="CDR"+(F&&F.level>1?"_"+(F.level-1):"");
var t="CDR_model";
if(!Ext.ClassManager.isCreated(t)){Ext.define(t,{extend:"Ext.data.Model",fields:rsCDR,idProperty:"ID"})
}var D=new Ext.data.Store({storeId:"CDRStore",model:t,proxy:{type:"ajax",url:"php/model/sql.php",timeout:60*60*1000,actionMethods:"POST",extraParams:{task:"LISTING",module:"CDR",simple:simpleCdr||undefined,disableRtp:window.disableRtp,deferTotal:!F.level},reader:{rootProperty:"results",totalProperty:"total",idProperty:F.idProperty||"ID"}},pageSize:F.disablePagingToolbar&&!F.enableTbarRibbonPaginator?-1:(F.pageSize||30),sorters:{property:simpleCdr?"calldate2":"calldate2e",direction:"DESC"},remoteFilter:true,remoteSort:true,_grid:this,_params:["dir","limit","module","sort","start","task","simple","disableRtp","deferTotal"]});
if(F.fcaller){D.proxy.extraParams.fcaller=F.fcaller;
D.proxy.extraParams.fcallerd_type=F.fcallerd_type
}if(F.fsipcallerip){D.proxy.extraParams.fsipcallerip=F.fsipcallerip;
D.proxy.extraParams.fsipcallerdip_type=F.fsipcallerdip_type
}if(F.fdatefrom){D.proxy.extraParams.fdatefrom=F.fdatefrom
}if(F.commonFiltersOperator){D.proxy.extraParams.commonFiltersOperator=F.commonFiltersOperator
}if(F.ticket_id){D.proxy.extraParams.ticket_id=F.ticket_id
}if(F.onlyCdrId){D.proxy.extraParams.onlyCdrId=F.onlyCdrId
}if(F.onlyCdrByAuditLogId){D.proxy.extraParams.onlyCdrByAuditLogId=F.onlyCdrByAuditLogId
}if(F.extraParams){Ext.applyIf(D.proxy.extraParams,F.extraParams)
}D.proxy.on("exception",onGridStoreException,D);
D.on("beforeload",this.onBeforeLoad,this);
D.on("load",this.onLoad,this);
if((!F._mainCdrTable||!isInitCdrSelectUrlParams())&&!F.disableAutoLoad&&F.loadAtInit){D.load()
}var w=this.getCdrColumns(F,this);
this.deleteCDR=function(Q,M,R){if(!R){Ext.Msg.confirm(lang.questionText,lang.areYouSure,function(T){if(T=="yes"){this.deleteCDR(Q,M,true)
}},this);
return
}var S={typeDelete:Q};
if(M){S.filter=this.getSelectParams()
}else{var P=this.grid.selModel.getSelection();
if(!P.length){return
}var O=[];
for(var N=0;
N<P.length;
N++){O.push(P[N].data.ID)
}S.ids=O
}ajaxSafeRequest({scope:this,url:"php/model/sql.php",params:{module:"CDR",task:"delete_cdr",params:Ext.encode(S)},success:function(T){this.reload({page:1})
},maskEl:this,maskMsg:this.findLangS("text","deleteCdr"),timeout:60*60*1000})
};
this.createFilterWindow=function(Y,W){this._windowFilter=true;
if(Y){if(this._panel){this._panel.maskLoad()
}else{this.maskLoad()
}Ext.defer(this.createFilterWindow,10,this,[false,W]);
return
}var N=CDR.Filter.getWidthForm();
var U;
var Z=CDR.Filter.getFieldset("common",Ext.applyIf(W||{},{values:D.proxy.extraParams,enableHelpFields:true}));
if(simpleCdr){U={xtype:"container",items:{xtype:"container",items:Z,style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:N},border:false,width:N+__width_Scroller+4,autoScroll:true,style:{"background-color":__color_FormBackground},flex:1}
}else{Z.title=this.findLangS("title","commonTab");
var S=[Z];
var Q=CDR.Filter.getFieldset("rtp",{values:D.proxy.extraParams});
Q.title=this.findLangS("title","RTPtab");
S.push(Q);
if(window.existsDscpCdr){var P=CDR.Filter.getFieldset("dscp",{values:D.proxy.extraParams});
P.title=this.findLangS("title","DSCPtab");
S.push(P)
}var M=CDR.Filter.getFieldset("filters_comb",{values:D.proxy.extraParams});
M.title=this.findLangS("title","filtersCombTab");
S.push(M);
var V=[];
for(var T=0;
T<S.length;
T++){V.push({xtype:"container",layout:"fit",items:{xtype:"container",items:S[T],style:{paddingTop:4,paddingLeft:4,paddingRight:4,marginRight:__width_Scroller,"background-color":__color_FormBackground},width:N},border:false,width:N+__width_Scroller+4,autoScroll:true,title:S[T].title,style:{"background-color":__color_FormBackground}})
}var U=[CDR.Filter.getFieldset_template(),{xtype:"tabpanel",items:V,border:false,flex:1}]
}var X=new Ext.FormPanel({frame:true,url:"php/model/sql.php",border:false,waitMsgTarget:true,layout:{type:"vbox",align:"stretch"},border:false,items:U,buttons:[{scope:this,text:this.findLangS("button","search"),iconCls:"icon_find",handler:function(){if(X.getForm().isValid()){O.call(this,X)
}}},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){R.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",X.el,{enter:function(){if(X.getForm().isValid()){O.call(this,X)
}},scope:this});
CDR.Filter.setContextFields(X);
CDR.Filter.loadTemplates(X,D.proxy.extraParams.ffilterTemplate)
}},width:N+__width_Scroller+4+8});
var R=new Ext.Window({scope:this,iconCls:"icon_find",title:this.findLangS("title","searchForm"),closable:true,border:false,plain:true,layout:"fit",modal:W&&W.modal,items:X,height:Math.min(900,Ext.dom.Element.getViewportHeight()-40),wikiId:"Call_Detail_Record_-_CDR#Filter_Form_button",listeners:{scope:this,activate:function(){if(!R.activated){var ab=X.getForm().getFields();
var ac=null;
for(var ad=0;
ad<ab.getCount();
ad++){var ae=ab.getAt(ad);
if(!(ae instanceof Ext.form.DisplayField)&&ae.name!="callerd_search_type"&&ae.name!="filterTemplate"&&ae._type!="combolabel"){ac=ae;
break
}}if(ac){ac.focus(false,500)
}R.activated=true
}},destroy:function(){this._windowFilter=false
}},createMaskEl:this._panel||this});
R.show();
function O(ab){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getUserCanAudit"},success:function(ac){if(ac.can_audit&&CDR.Filter.isDataSet(ab)){var ae=CDR.Filter.fetchValuesFromFieldset_all(ab,false,true);
var ad=ab.getForm().findField("audit_reason");
if(ad){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveAudit",params:Ext.encode({activity:_AuditActivity_filterFormCDR,activity_name:getDataArrayItem(arAuditActivity,_AuditActivity_filterFormCDR),cdrId:null,filterData:Ext.encode(ae),formData:{reason:ad.getValue()}})},success:function(ag){aa.call(this)
}})
}else{var af=new Tools.AuditForm({activity:_AuditActivity_filterFormCDR,allowBlankReason:true,autoAudit:ac.can_audit==2,filterData:Ext.encode(ae),fceContinue:function(){aa.call(this)
},fceContinueScope:this});
af.audit()
}}else{aa.call(this)
}}})
}function aa(){Ext.apply(D.proxy.extraParams,CDR.Filter.fetchValuesFromFieldset(X,"common"));
if(!simpleCdr){Ext.apply(D.proxy.extraParams,CDR.Filter.fetchValuesFromFieldset(X,"rtp"));
if(window.existsDscpCdr){Ext.apply(D.proxy.extraParams,CDR.Filter.fetchValuesFromFieldset(X,"dscp"))
}Ext.apply(D.proxy.extraParams,CDR.Filter.fetchValuesFromFieldset(X,"filters_comb"))
}Ext.apply(D.proxy.extraParams,CDR.Filter.fetchValuesFromFieldset(X,"template"));
var ac=this.getOrderTypes();
for(var ab=0;
ab<ac.length;
ab++){D.proxy.extraParams[ac[ab][0]]=""
}if(this.reload){this.reload({page:1})
}R.destroy()
}};
this.menuTypeCdrLink=[];
if(user_can_cdr_share_local_public()){this.menuTypeCdrLink.push({text:this.findLangS("menu","localPublic"),handler:H,_menuSubId:"self_protected_link"})
}if(user_can_cdr_share_local_private()){this.menuTypeCdrLink.push({text:this.findLangS("menu","localPrivate"),handler:H,_menuSubId:"self_login_link"})
}if(user_can_cdr_share_voipmonitor_org()){this.menuTypeCdrLink.push({text:this.findLangS("menu","share_voipmonitor_org"),handler:H,_menuSubId:"share_link"})
}this.menuCdrLink=[];
if(this.menuTypeCdrLink.length){for(var A=0;
A<2;
A++){if(A==0&&user_no_rtp()){continue
}this.menuCdrLink.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 2;">'+(A?this.findLangS("menu","shareSip"):this.findLangS("menu","shareSipRtp"))+"</div>");
this.menuCdrLink.push({text:this.findLangS("menu","showLink"),iconCls:"icon_magnifier",handler:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0].handler:undefined,_menuSubId:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0]._menuSubId:undefined,_menuId:"share_cdr_show",_menuId2:A?null:"rtp",scope:this,menu:this.menuTypeCdrLink.length>1?{defaults:{_menuId:"share_cdr_show",_menuId2:A?null:"rtp",scope:this},items:cloneArray(this.menuTypeCdrLink)}:undefined},{text:this.findLangS("menu","sendLinkViaEmail"),iconCls:"icon_email_send",handler:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0].handler:undefined,_menuSubId:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0]._menuSubId:undefined,_menuId:"share_cdr_send",_menuId2:A?null:"rtp",scope:this,menu:this.menuTypeCdrLink.length>1?{defaults:{_menuId:"share_cdr_send",_menuId2:A?null:"rtp",scope:this},items:cloneArray(this.menuTypeCdrLink)}:undefined})
}}var J=[];
if(user_can_write_cdr()){J.push({scope:this,text:this.findLangS("menu","delete"),iconCls:"icon_delete",menu:{scope:this,items:[{text:this.findLangS("menu","allFiltered"),scope:this,iconCls:"icon_table_delete",menu:{scope:this,items:[{scope:this,text:this.findLangS("menu","deleteCDR"),iconCls:"icon_coins_delete",handler:function(){this.deleteCDR("cdr",true)
}},{scope:this,text:this.findLangS("menu","deleteFiles"),iconCls:"icon_cassette_delete",handler:function(){this.deleteCDR("files",true)
}},{scope:this,text:this.findLangS("menu","deleteCDRandFiles"),iconCls:"icon_delete",handler:function(){this.deleteCDR("both",true)
}}]}},{text:this.findLangS("menu","selected"),scope:this,iconCls:"icon_tablerow_delete",menu:{scope:this,items:[{scope:this,text:this.findLangS("menu","deleteCDR"),iconCls:"icon_coins_delete",handler:function(){this.deleteCDR("cdr")
}},{scope:this,text:this.findLangS("menu","deleteFiles"),iconCls:"icon_cassette_delete",handler:function(){this.deleteCDR("files")
}},{scope:this,text:this.findLangS("menu","deleteCDRandFiles"),iconCls:"icon_delete",handler:function(){this.deleteCDR("both")
}}]}}]}})
}if(user_can_tracker()){J.push({text:this.findLangS("menu","newIssueTicket"),iconCls:"icon_tracker",menu:[{text:this.findLangS("menu","allFiltered"),scope:this,iconCls:"icon_table",handler:m,_menuId:"new_ticket_filter"},{text:this.findLangS("menu","selected"),scope:this,iconCls:"icon_tablerow_select",handler:m,disabled:true,_menuId:"new_ticket_selected"}]})
}if(user_can_revaluation_billing()){J.push({text:this.findLangS("menu","revaluationBilling"),iconCls:"icon_coins",_menuId:"revaluation_billing",menu:[{text:this.findLangS("menu","allFiltered"),scope:this,iconCls:"icon_table",handler:r,_menuId:"revaluation_billing_filter"},{text:this.findLangS("menu","selected"),scope:this,iconCls:"icon_tablerow_select",handler:r,disabled:true,_menuId:"revaluation_billing_selected"}]})
}if(user_can_cdr_share()){J.push({text:this.findLangS("menu","shareCdr"),iconCls:"icon_link",_menuId:"share_cdr",disabled:true,menu:this.menuCdrLink})
}if(user_can_pcap()){var y=[];
if(!user_no_rtp()){y.push({text:this.findLangS("menu","downloadSipPcap"),scope:this,handler:function(){this.onDownloadPcap(false)
}},{text:this.findLangS("menu","downloadSipRtpPcap"),scope:this,handler:function(){this.onDownloadPcap(true)
}})
}J.push({text:this.findLangS("menu","downloadPcap"),iconCls:"icon_save",_menuId:"download_pcap",disabled:true,menu:y.length?y:undefined,scope:this,handler:function(){this.onDownloadPcap(false)
}})
}if(user_can_show_fax()){J.push({text:this.findLangS("menu","tryDecodeFax"),iconCls:"icon_fax",_menuId:"try_decode_fax",disabled:true,menu:{defaults:{scope:this,handler:function(N){var M=this.grid.selModel.getSelection();
if(M.length){this.showFax(M[0].data.ID,N._menuId=="try_decode_fax_as_t30"?"T30":"T38")
}}},items:[{text:this.findLangS("menu","tryDecodeFaxAsT30"),_menuId:"try_decode_fax_as_t30"},{text:this.findLangS("menu","tryDecodeFaxAsT38"),_menuId:"try_decode_fax_as_t38"}]}})
}var b=[];
if(user_can_pcap()){b.push({text:this.findLangS("menu","mergeSipPcap"),scope:this,handler:function(){this.onMergePcapSipHistory("pcap",null,"select")
}});
if(!user_no_rtp()){b.push({text:this.findLangS("menu","mergeSipRtpPcap"),scope:this,handler:function(){this.onMergePcapSipHistory("pcaprtp",null,"select")
}})
}}b.push({text:this.findLangS("menu","mergeSipHistory"),scope:this,handler:function(){this.onMergePcapSipHistory("sip_history",null,"select")
}});
J.push({text:this.findLangS("menu","merge"),_menuId:"merge",disabled:true,menu:b});
if(user_is_admin()){J.push({text:this.findLangS("menu","batchDownloadCdr"),menu:{defaults:{scope:this,handler:function(M){CDR.Utils.batchDownloadCdr(null,this.grid.store.proxy.extraParams,this,M._type)
}},items:[{text:"PCAP",iconCls:"icon_save",_type:"pcap"},{text:"AUDIO",iconCls:"icon_audio",_type:"audio"}]}})
}J.push({text:this.findLangS("menu","viewUrl"),_menuId:"viewUrl",scope:this,handler:this.viewUrl});
if(typeDb=="mysql"){var f={text:this.findLangS("menu","exportCSV"),iconCls:"icon_excel",menu:{defaults:{scope:this,handler:this.exportToCsv},items:[{text:this.findLangS("menu","exportCSV_table"),_menuId:"table"},{text:this.findLangS("menu","exportCSV_summary_by_caller"),_menuId:"summary_by_caller"},{text:this.findLangS("menu","exportCSV_summary_by_called"),_menuId:"summary_by_called"}]}};
J.push("-",f);
if(user_id()){menuSelectionRowsConfig={text:this.findLangS("menu","selectionCDR"),iconCls:"icon_selection",menu:{defaults:{scope:this,handler:this.selectionCDR},items:[{text:this.findLangS("menu","selectionCDR_clear"),_menuId:"clear"},{text:this.findLangS("menu","selectionCDR_save"),_menuId:"save"},{text:this.findLangS("menu","selectionCDR_manage"),_menuId:"manage"}]}};
J.push("-",menuSelectionRowsConfig)
}}var p=[];
var h=[];
if(!F.disableMenu){var z=[];
if(typeDb=="mysql"){z.push(f,{xtype:"menuseparator"});
if(user_id()){z.push(menuSelectionRowsConfig,{xtype:"menuseparator"})
}}z.push({text:this.findLangS("menu","enableDns"),xtype:"menucheckitem",checked:user.sqlrow&&user.sqlrow.uc_enable_dns_cdr,_menuId:"enableDns"});
z.push({text:this.findLangS("menu","enableFlags"),menu:[{text:this.findLangS("menu","number"),menu:{defaults:{xtype:"menucheckitem",scope:this,handler:c},items:[{text:this.findLangS("menu","left"),_menuId:"flags_number",_value:"left"},{text:this.findLangS("menu","right"),_menuId:"flags_number",_value:"right"},{text:this.findLangS("menu","disable"),_menuId:"flags_number",_value:"disable"}],listeners:{beforeshow:function(O){for(var N=0;
N<O.items.length;
N++){var M=O.items.get(N);
M.setChecked(M._value==user.sqlrow.uc_enable_flags_cdr_number)
}}}}},{text:this.findLangS("menu","ip"),menu:{defaults:{xtype:"menucheckitem",scope:this,handler:c},items:[{text:this.findLangS("menu","left"),_menuId:"flags_ip",_value:"left"},{text:this.findLangS("menu","right"),_menuId:"flags_ip",_value:"right"},{text:this.findLangS("menu","disable"),_menuId:"flags_ip",_value:"disable"}],listeners:{beforeshow:function(O){for(var N=0;
N<O.items.length;
N++){var M=O.items.get(N);
M.setChecked(M._value==user.sqlrow.uc_enable_flags_cdr_ip)
}}}}}]});
if(existsHttpJj){z.push({text:findLangS("http","menu","showHttpJjViaExternalTransactionId"),scope:this,handler:this.showHttpJjViaExternalTransactionId})
}if(user_is_admin()){z.push({text:this.findLangS("menu","concurrentCallsStats"),scope:this,handler:this.concurrentCallsStats})
}p.push({xtype:"splitbutton",scope:this,text:this.findLangS("button","filterForm"),tooltip:this.findLangS("button_help","filterForm"),iconCls:"icon_find",handler:function(){this.createFilterWindow(true)
},arrowCls:"link_grey",arrowHandler:this.viewUrl,listeners:{scope:this,afterrender:function(M){M.getEl().down(".x-btn-link_grey").dom.setAttribute("data-qtip",this.findLangS("button_help","viewUrl"))
}}},{scope:this,text:this.findLangS("button","quickFilter"),tooltip:this.findLangS("button_help","quickFilter"),iconCls:"icon_find",menu:{scope:this,items:q.call(this),listeners:{scope:this,beforeshow:function(M){a.call(this,M);
L.call(this,M)
}}}},{scope:this,text:this.findLangS("button","resetFilter"),tooltip:this.findLangS("button_help","resetFilter"),iconCls:"icon_find",disabled:true,menu:{scope:this,defaults:{scope:this,handler:function(M){if(M._menuId=="all"||M._menuId=="form"){this.clearFormFilter()
}if(M._menuId=="all"||M._menuId=="order"){this.clearOrder()
}if(M._menuId=="all"||M._menuId=="column"){this.clearColumnFilter()
}if(M._menuId=="all"||M._menuId=="groupFilter"){this.clearGroupFilter()
}if(M._menuId=="all"||M._menuId=="groupSelect"){this.clearGroupSelect(false,true)
}this.clearIgnoreReloadGroup();
this.reload({page:1})
}},items:[{text:this.findLangS("menu","cdrBaseFilters"),_menuId:"form"},{text:this.findLangS("menu","cdrOrder"),_menuId:"order"},{text:this.findLangS("menu","cdrColumnsFilter"),_menuId:"column"},{text:this.findLangS("menu","groupFilters"),_menuId:"groupFilter"},{text:this.findLangS("menu","groupSelect"),_menuId:"groupSelect"},{xtype:"menuseparator"},{text:this.findLangS("menu","all"),_menuId:"all"}],listeners:{scope:this,beforeshow:function(M){l.call(this,M)
}}},_btnId:"reset"},"-",{scope:this,text:this.findLangS("button","menu"),iconCls:"icon_menu_show",menu:{scope:this,items:J}},{scope:this,text:this.findLangS("button","charts"),tooltip:this.findLangS("button_help","charts"),iconCls:"icon_menu_diag_system",handler:this.openCharts,_btnId:"charts",hidden:!user_can_graphs()},{scope:this,text:this.findLangS("button","settings"),tooltip:this.findLangS("button_help","settings"),iconCls:"icon_wrench",_btnId:"settings",menu:{scope:this,defaults:{scope:this,handler:c},items:z,listeners:{scope:this,beforeshow:function(M){M.items.get(M.items.findIndex("_menuId","enableDns")).setChecked(user.sqlrow&&user.sqlrow.uc_enable_dns_cdr)
}}}},"-");
h.push(this.findLangS("button","refreshInterval")+":&thinsp;",{xtype:"numberfield",width:__width_ColumnNum(4)+ +__width_Trigger,minValue:1,maxValue:9999,step:1,enableKeyEvents:true,listeners:{scope:this,change:function(M){this.setTimeoutRefreshInterval(M)
},keyup:function(N,M){this.setTimeoutRefreshInterval(N)
}},fieldStyle:{"text-align":"right"}})
}if(F.enableTbarRibbonDateFromTo){p.push({xtype:"buttongroup",title:this.findLangS("tbar","dateTimeRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("tbar","dateTimeFrom")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:F.extraParams&&F.extraParams.fdatefrom?clone(F.extraParams.fdatefrom):null,_buttonGroup:true,onSetDate:function(N,M){this.setCustomFilter("fdatefrom",M,true)
},onSetDateScope:this},{value:this.findLangS("tbar","dateTimeTo")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:F.extraParams&&F.extraParams.fdateto?clone(F.extraParams.fdateto):null,_buttonGroup:true,onSetDate:function(N,M){this.setCustomFilter("fdateto",M,true)
},onSetDateScope:this}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(F.enableTbarRibbonFilterButton){p.push({xtype:"buttongroup",title:this.findLangS("tbar","menu"),columns:1,defaults:{xtype:"displayfield"},items:[{xtype:"button",text:this.findLangS("tbar","filter"),iconCls:"icon_find",handler:function(){this.createFilterWindow(true,{disableTimeInterval:true,disableSelections:true,modal:true})
},scope:this,style:{marginTop:9,marginBottom:12}}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(!F.disablePagingToolbar){this.pagingToolbar=new Ext.PagingToolbar({store:D,items:F.customMenu?F.customMenu:(F.disableMenu?undefined:p),behindButtonsItems:!F.customMenu&&!F.disableMenu?h:undefined,prependButtons:true,displayInfo:true,listeners:{beforechange:function(M,N){if(N!=M.store.currentPage){M._changePage=true
}}}})
}else{if(F.enableTbarRibbonPaginator){p.push({xtype:"buttongroup",title:this.findLangS("tbar","paginator"),items:{xtype:"pagingtoolbar",store:D,displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud}},style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}var E={store:D,columns:{items:w,defaults:{sortable:false}},border:false,plugins:simpleCdr?undefined:[{ptype:"rowexpander",rowBodyContentCls:"CDR.GridExpPanel",rowBodyContentConfig:{enableChartsInTab:F._enableChartsInTab},expandOnEnter:false,expandOnDblClick:false,noVerticalScroller:F.noVerticalScroller||F.level>1},"gridfilters","columnSort"],clicksToEdit:2,viewConfig:{enableTextSelection:true,listeners:{scope:this,cellcontextmenu:v,expandbody:function(){if(this._panel){this._panel.collapseGroup()
}},render:function(M){M.tip=Ext.create("Ext.tip.ToolTip",{target:M.el,delegate:M.cellSelector,trackMouse:true,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,listeners:{beforeshow:function N(U){var Q=M.getHeaderByCell(U.triggerElement);
var P=Ext.fly(U.triggerElement).up(".x-grid-row");
if(P){var R=M.getRecord(P);
if(Q&&Q.dataIndex=="proxy"&&R&&R.data){var V=Ext.decode(R.data.proxy);
if(V&&V.length>4){htmlProxy=M.store._grid.renderProxy(R.data.proxy);
if(htmlProxy){htmlProxy='<div style="padding-left: 5; padding-right: 5;">'+htmlProxy+"</div>";
U.update(htmlProxy);
return
}}}if(Q&&Q.dataIndex=="note"&&R&&R.data){noteContent=M.store._grid.renderNote(R.data.note);
if(noteContent){var S="note_"+R.data.ID+"_ellipsis";
var T=Ext.get(S);
if(T.dom.style.visibility=="visible"){var W=getSizeHtml(noteContent,false,{"white-space":"nowrap",font:__font_Grid});
var O=(W[0]>250?250:W[0])+10;
U.update('<div style="padding-left: 5; padding-right: 5; width: '+O+'; word-wrap: break-word; white-space: normal;">'+noteContent+"</div>");
return
}}}}U.update(null)
}}})
}},stripeRows:false,getRowClass:d,onFocusEnter:function(M){if(this.grid.rowExpander.isAnyExpand()){Ext.Component.prototype.onFocusEnter.call(this,M)
}else{Ext.view.Table.prototype.onFocusEnter.call(this,M)
}}},selModel:{mode:"MULTI"},listeners:{scope:this,afterrender:function(){if(this._mainCdrTable&&isInitCdrSelectUrlParams()){if(window.cdrId){this.initSelectParams();
this._panel.setTitleCdr();
if(cdrId[0]=="["&&cdrId[cdrId.length-1]=="]"&&Ext.JSON.decode(cdrId)){this.grid.filters.addFilter({dataIndex:"ID",type:"string",value:Ext.JSON.decode(cdrId).join(",")})
}else{this.grid.filters.addFilter({dataIndex:"ID",type:"string",value:cdrId})
}}else{this.initSelectParams();
k.call(this);
if(this._panel){this._panel.setTitleCdr()
}if(window.cdr_group_data&&this._panel&&this._panel.groupPanel){Ext.defer(function(){this._panel.groupPanel.applyGroupData();
this.reload({page:1})
},250,this)
}else{this.reload({page:1})
}}clearInitCdrSelectUrlParams()
}else{if(!this.disableAutoLoad&&!this.loadAtInit){this.initSelectParams();
this.reload({page:1})
}}},columnresize:function(M,N){if(N.dataIndex=="note"){M.ownerCt.store.each(function(O){M.ownerCt._renderRecord(O,O.data,["note"])
})
}},resize:function(R){var S=R.getWidth();
if(!S){return
}var Q=R.getColumnManager().getColumns();
var P=0;
var O=-1;
for(var N=0;
N<Q.length;
N++){if(Q[N].dataIndex=="_filler"){O=N
}else{P+=Q[N].getWidth()
}}if(O>=0){var M=S-P-(R.level?0:__width_Scroller);
if(M>0){Q[O].show();
Q[O].setWidth(M);
if(O!=Q.length-1){R.headerCt.move(O,Q.length-1)
}}else{Q[O].hide()
}}}},level:F.level,decWidthTable:F.decWidthTable,region:"center",panel:this};
if(F._panel){E.viewConfig.loadingText=getLoadMaskWithStopButton_loading_text("cdrGrid_loadMask")
}if(B){E.prefixCls=B;
E.columns.defaults.tdCls=B+"-cell";
Ext.applyIf(E.viewConfig,{setNewTemplate:function(){Ext.grid.View.prototype.setNewTemplate.call(this,arguments);
if(this.prefixCls){this.tpl.html=this.tpl.html.replaceall("x-grid-rowwrap-div",this.prefixCls+"-grid-rowwrap-div").replaceall("x-grid-cell-inner",this.prefixCls+"-grid-cell-inner").replace("x-grid-cell-rowbody",this.prefixCls+"-cell x-grid-cell-rowbody")
}},selectedItemCls:B+"-row-selected",overItemCls:B+"-row-over",focusedItemCls:B+"-row-focused",prefixCls:B});
addGridPrefixClsCss(B)
}this.grid=new Ext.grid.GridPanel(E);
this.grid.applyConfig("CDR.Grid");
this.grid.selModel.on("selectionchange",n,this);
this.idChartContainer="CDR-charts-container"+(F.id?"_"+F.id:"");
if(!F.disableCharts&&user_can_graphs()){this.chartsContainer=new Ext.Panel({id:this.idChartContainer,region:"east",layout:"fit",width:"45%",border:false,collapsible:true,collapsed:true,title:this.findLangS("title","charts"),iconCls:"icon_menu_diag_system",listeners:{scope:this,expand:K,beforecollapse:G,collapse:o},floatCollapsedPanel:function(){}})
}var s=[this.grid];
if(this.chartsContainer){s.push(this.chartsContainer)
}Ext.applyIf(F,{tbar:this.pagingToolbar?this.pagingToolbar:p.length||h.length?p.concat(h):undefined,layout:"border",defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:s});
this.callParent([F]);
function q(){var R=[];
var O=["cur","24h","7d","30d","y"];
for(var P=0;
P<O.length;
P++){var S=O[P]=="cur"?"cur":O[P]=="24h"?new Date((new Date).getTime()-24*60*60*1000):O[P]=="7d"?date((new Date).getTime()/1000-7*24*60*60):O[P]=="30d"?date((new Date).getTime()/1000-30*24*60*60):date((new Date).getTime()/1000-365*24*60*60);
var Q=this.getOrderTypes();
var T={};
for(var N=0;
N<Q.length;
N++){T[Q[N][0]]={text:Q[N].length>=3?(Q[N][2]=="asc"?this.findLangS("menu","orderAsc"):this.findLangS("menu","orderDesc")):Q[N][1],scope:this,handler:I,_dateFrom:S,_findItem:Q[N][0],icon:Q[N].length>=3?__extjs_images_path()+"/grid/hmenu-"+Q[N][2]+".gif":undefined}
}var M=[];
if(window.rtpQualityUse){M.push(T.orderByLoss,T.orderByDelay,{text:this.findLangS("menu","orderByWorstMOS"),menu:[T.orderByFixed1,T.orderByFixed2,T.orderByAdapt]})
}M.push({text:this.findLangS("menu","orderByCallDuration"),menu:[T.orderByCallDuration_asc,T.orderByCallDuration_desc]},{text:this.findLangS("menu","orderBySIP_IP"),menu:[{text:this.findLangS("menu","orderBySrcSIP_IP"),menu:[T.orderBySrcSIP_IP_asc,T.orderBySrcSIP_IP_desc]},{text:this.findLangS("menu","orderByDstSIP_IP"),menu:[T.orderByDstSIP_IP_asc,T.orderByDstSIP_IP_desc]}]},{text:this.findLangS("menu","orderByNumber"),menu:[{text:this.findLangS("menu","orderBySrcNumber"),menu:[T.orderBySrcNumber_asc,T.orderBySrcNumber_desc]},{text:this.findLangS("menu","orderByDstNumber"),menu:[T.orderByDstNumber_asc,T.orderByDstNumber_desc]}]},{text:this.findLangS("menu","orderByCallerName"),menu:[T.orderByCallerName_asc,T.orderByCallerName_desc]},{text:this.findLangS("menu","orderByLastSIPrespNum"),menu:[T.orderByLastSIPrespNum_asc,T.orderByLastSIPrespNum_desc]});
R.push({text:O[P]=="cur"?this.findLangS("menu","orderCurrentData"):O[P]=="24h"?this.findLangS("menu","last24hours"):O[P]=="7d"?this.findLangS("menu","last7days"):O[P]=="30d"?this.findLangS("menu","last30days"):this.findLangS("menu","lastYear"),menu:M});
if(O[P]=="cur"){R.push("-")
}}return R
}function I(O){if(O._dateFrom=="cur"){var N=this.getOrderTypes();
for(var M=0;
M<N.length;
M++){D.proxy.extraParams[N[M][0]]=O._findItem==N[M][0]?1:0
}this.reload({page:1})
}else{D.proxy.extraParams.fdatefrom=O._dateFrom;
D.proxy.extraParams[O._findItem]=1;
this.reload({page:1})
}}function u(N){var M=this.grid.store.proxy.extraParams.fdatefrom;
var O=this.grid.store.proxy.extraParams.fdateto;
this.clearFormFilter();
this.clearOrder();
if(N._templateFilter.config){var P=Ext.decode(N._templateFilter.config);
if(P.fdatefrom||P.fdateto){P.fdatefrom=dateTimeStringToDate(P.fdatefrom);
P.fdateto=dateTimeStringToDate(P.fdateto)
}else{P.fdatefrom=M;
P.fdateto=O
}Ext.apply(D.proxy.extraParams,P);
D.proxy.extraParams.ffilterTemplate=N._templateFilter.id*1
}this.reload({page:1})
}function l(Q){var N=0;
var M=0;
for(var N=0;
N<Q.items.length;
N++){var O=Q.items.get(N);
var P=false;
switch(O._menuId){case"form":P=this.isSetFormFilter();
break;
case"order":P=this.isSetOrder();
break;
case"column":P=this.isSetColumnFilter();
break;
case"groupFilter":P=this.isSetGroupFilter();
break;
case"groupSelect":P=this.isSetGroupSelect();
break;
default:P=M>=2;
break
}O.setVisible(P);
if(P){++M
}}}function a(N){var M=N.items.length-1;
while(M>=0){if(N.items.get(M)._templateFilter){N.remove(M)
}--M
}}function L(M){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrFilterTemplates"},success:function(N){if(N.filterTemplates&&N.filterTemplates.length){M.add({xtype:"menuseparator",_templateFilter:true});
for(var O=0;
O<N.filterTemplates.length;
O++){M.add({text:N.filterTemplates[O].name,scope:this,handler:u,_templateFilter:N.filterTemplates[O]})
}}}})
}function v(X,aa,V,S,ac,W,N){var U=V;
N.stopEvent();
var S=this.grid.store.getAt(W);
var Q=this.grid.getColumnManager().getColumns();
var P=Q[U];
var Z=this.grid.selModel.getSelection();
var M=[];
if(!this.disableMenu){var T=[{text:this.findLangS("menu","bySourceSipIP"),_filterParams:"fip",_filterValue:"sipcallerip"},{text:this.findLangS("menu","bySourceRtpIP"),_filterParams:"frip",_filterValue:"a_saddr"},{text:this.findLangS("menu","byDstSipIP"),_filterParams:"fip",_filterValue:"sipcalledip"},{text:this.findLangS("menu","byDstRtpIP"),_filterParams:"frip",_filterValue:"b_saddr"},{text:this.findLangS("menu","byCaller"),_filterParams:"fcaller",_filterValue:"caller"},{text:this.findLangS("menu","byCalled"),_filterParams:"fcalled",_filterValue:"called"},{text:this.findLangS("menu","byLastResponse"),_filterParams:"fsipresponse",_filterValue:"lastSIPresponseNum"}];
M.push({scope:this,disabled:!user_can_write_cdr(),text:this.findLangS("menu","deleteCDR"),iconCls:"icon_coins_delete",handler:function(){this.deleteCDR("cdr")
}},{scope:this,disabled:!user_can_write_cdr(),text:this.findLangS("menu","deleteFiles"),iconCls:"icon_cassette_delete",handler:function(){this.deleteCDR("files")
}},{scope:this,disabled:!user_can_write_cdr(),text:this.findLangS("menu","deleteCDRandFiles"),iconCls:"icon_delete",handler:function(){this.deleteCDR("both")
}},"-",{text:this.findLangS("menu","filterByCDR"),scope:this,iconCls:"icon_find",menu:[{text:this.findLangS("menu","last30days"),iconCls:"icon_find",menu:{defaults:{scope:this,handler:g,_dateFrom:new Date((new Date).getTime()-30*24*60*60*1000),_rowIndex:W},items:cloneObject(T)}},{text:this.findLangS("menu","lastYear"),iconCls:"icon_find",menu:{defaults:{scope:this,handler:g,_dateFrom:new Date((new Date).getTime()-365*24*60*60*1000),_rowIndex:W},items:cloneObject(T)}},{text:this.findLangS("menu","allTime"),iconCls:"icon_find",menu:{defaults:{scope:this,handler:g,_dateFrom:"allTime",_rowIndex:W},items:cloneObject(T)}},{text:this.findLangS("menu","filterSimilarCDR"),iconCls:"icon_find",handler:g,_filterType:"_filter_similar_CDR",_rowIndex:W,scope:this}]},"-");
var Y=[];
if(user_can_tracker()){Y.push({text:this.findLangS("menu","newIssueTicket"),iconCls:"icon_tracker",menu:[{text:this.findLangS("menu","allFiltered"),scope:this,handler:m,_menuId:"new_ticket_filter"},{text:this.findLangS("menu","selected"),scope:this,handler:m,_menuId:"new_ticket_selected"}]})
}if(user_can_cdr_share()){Y.push({text:this.findLangS("menu","shareCdr"),iconCls:"icon_link",menu:this.menuCdrLink})
}if(Z&&Z.length==1&&user_can_pcap()){var ab=[];
if(!user_no_rtp()){ab.push({text:this.findLangS("menu","downloadSipPcap"),scope:this,handler:function(){this.onDownloadPcap(false)
}},{text:this.findLangS("menu","downloadSipRtpPcap"),scope:this,handler:function(){this.onDownloadPcap(true)
}})
}Y.push({text:this.findLangS("menu","downloadPcap"),iconCls:"icon_save",menu:ab.length?ab:undefined,scope:this,handler:function(){this.onDownloadPcap(false)
}});
if(S.data.a_received+S.data.b_received){Y.push({text:this.findLangS("menu","showRtcpChart"),iconCls:"icon_menu_diag_system",scope:this,handler:function(){var ad=this.grid.selModel.getSelection();
if(ad&&ad.length==1){CDR.RtcpChart.prepareRtcpData(ad[0].data,{maskEl:this})
}}})
}}if(Z&&Z.length==1&&user_can_show_fax()&&(S.data.a_received>0||S.data.b_received>0)){Y.push({text:this.findLangS("menu","tryDecodeFax"),iconCls:"icon_fax",menu:{defaults:{scope:this,handler:function(ad){this.showFax(S.data.ID,ad._menuId=="try_decode_fax_as_t30"?"T30":"T38")
}},items:[{text:this.findLangS("menu","tryDecodeFaxAsT30"),_menuId:"try_decode_fax_as_t30"},{text:this.findLangS("menu","tryDecodeFaxAsT38"),_menuId:"try_decode_fax_as_t38"}]}})
}if(Y.length){for(var R=0;
R<Y.length;
R++){M.push(Y[R])
}M.push("-")
}if(user_is_admin()&&(P.dataIndex=="caller2"||P.dataIndex=="called2")){M.push({text:this.findLangS("menu","batchDownloadCdr")+" - "+(P.dataIndex=="caller2"?S.data.caller:S.data.called),menu:{defaults:{scope:this,handler:function(ad){CDR.Utils.batchDownloadCdr(P.dataIndex=="caller2"?S.data.caller:S.data.called,this.grid.store.proxy.extraParams,this,ad._type)
}},items:[{text:"PCAP",iconCls:"icon_save",_type:"pcap"},{text:"AUDIO",iconCls:"icon_audio",_type:"audio"}]}},"-")
}}if(isClipboardCopySupport()){M.push({text:findLangSd("grid","copyToClipboard"),menu:getCellContextClipboardMenuItems.call(this.grid,W,U,S,P)})
}else{if(M.length&&M[M.length-1]=="-"){M.splice(M.length-1,1)
}}var O=new Ext.menu.Menu({items:M});
O.showAtMouse(N)
}function g(N){var M=this.grid.store.getAt(N._rowIndex);
if(!M){return
}this.clearFormFilter();
if(N._filterType=="_filter_similar_CDR"){this.grid.store.proxy.extraParams.fdatefrom=dateTime(dateTime(M.data.calldate).getTime()/1000-5);
this.grid.store.proxy.extraParams.fdateto=dateTime(dateTime(M.data.calldate).getTime()/1000+5);
this.grid.store.proxy.extraParams.fcaller=(M.data.caller||"").removeTags();
this.grid.store.proxy.extraParams.fcalled=(M.data.called||"").removeTags();
this.grid.store.proxy.extraParams.fdurationgt=Math.max(M.data._duration-5,0);
this.grid.store.proxy.extraParams.fdurationlt=M.data._duration+5
}else{if(N._dateFrom){this.grid.store.proxy.extraParams.fdatefrom=N._dateFrom==="allTime"?null:N._dateFrom
}this.grid.store.proxy.extraParams[N._filterParams]=(M.data[N._filterValue]||"").removeTags()
}this.reload({page:1})
}function K(){this.dockChartsPanel();
this.createChartsPanel(D);
if(!this.chartsContainer.items.getCount()){this.chartsContainer.add(this.chartsPanel)
}var N=this.chartsContainer.header.getTitle();
if(N.getText){N=N.getText()
}if(!N.match(/table/)){this.chartsContainer.header.setStyle({height:24,"padding-top":3,"padding-bottom":0});
this.chartsContainer.header.setTitle('<table cellspacing=0 cellpadding=0 style="position: relative; top: 0; height: 20;"><td><span class="x-panel-header-title-default">'+this.findLangS("title","charts")+'</span><td style="padding-left: 5;"><span id="cdr_charts_dock_title"></span></table>');
var M=new Ext.Panel({border:false,height:19,width:500,layout:"hbox",items:[{xtype:"button",text:this.findLangS("button","undock"),height:19,border:false,style:{marginRight:2},handler:function(){this.undockChartsPanel()
},scope:this},{xtype:"button",text:this.findLangS("button","closeChart"),height:19,border:false,style:{marginRight:2},handler:function(){this.chartsPanel.maskLoad();
Ext.defer(function(){this.chartsPanel.removeAllCharts();
this.unmask();
this.chartsContainer.removeAll(true);
this.chartsPanel=null;
this.chartsContainer.collapse()
},100,this)
},scope:this},{xtype:"button",text:this.findLangS("button","addChart"),iconCls:"icon_add",height:19,border:false,handler:function(){this.chartsPanel.addChart()
},scope:this}],renderTo:"cdr_charts_dock_title",bodyStyle:{background:"transparent"}})
}this.setStateChartsButton()
}function o(){this.chartsContainer.setTitle(this.findLangS("title","charts"));
this.setStateChartsButton()
}function G(){this.chartsContainer.setTitle(this.findLangS("title","charts"))
}function m(M){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkFillCbTracker"},success:function(N){C.call(this,M,N)
}})
}function C(O,Q,P){var N=0;
switch(O._menuId){case"new_ticket_filter":N=this.pagingToolbar.store.totalCount;
break;
case"new_ticket_selected":var M=this.grid.selModel.getSelection();
if(M){N=M.length
}break
}if(!N){Ext.Msg.alert(this.findLangS("title","msgZeroCdrForTicket"),this.findLangS("text","msgZeroCdrForTicket"));
return
}if(N>1000){Ext.Msg.alert(this.findLangS("title","msgToooMuchCdrForTicket"),this.findLangS("text","msgTooooMuchCdrForTicket1")+" "+N+" "+this.findLangS("text","msgTooooMuchCdrForTicket2"));
return
}if(!P&&N>100){Ext.Msg.confirm(this.findLangS("title","LmsgTooMuchCdrForTicket"),this.findLangS("text","msgTooMuchCdrForTicket1")+" "+N+" "+this.findLangS("text","msgTooMuchCdrForTicket2"),function(R){if(R=="yes"){C.call(this,O,Q,true)
}},this);
return
}Tracker.Utils.createNewTicketFormWindow(Q,{attachedCDR:{type:O._menuId,grid:this.grid}},this)
}function r(Q){var R=this;
var N=undefined;
var M=undefined;
switch(Q._menuId){case"revaluation_billing_filter":M=this.grid.store.proxy.extraParams;
break;
case"revaluation_billing_selected":var P=this.grid.selModel.getSelection();
if(P){N=[];
for(var O=0;
O<P.length;
O++){N.push(P[O].data.ID)
}}break
}Billing.Utils.revaluationBilling({cdr_ids:N,cdr_filter:M,onSuccess:function(){R.reload({page:1})
}})
}function H(M,N,O){CDR.Utils.shareCdr(M._menuId,M._menuId2,M._menuSubId,this.grid)
}function n(N){var R=N.getSelection();
var O=this.getTopToolbar();
if(O){var T=["download_pcap"];
for(var P=0;
P<T.length;
P++){var Q=O.findC("_menuId",T[P],true);
if(Q){Q.enableIf(R.length==1)
}}var S=["try_decode_fax"];
for(var P=0;
P<S.length;
P++){var Q=O.findC("_menuId",S[P],true);
if(Q){Q.enableIf(R.length==1&&(R[0].data.a_received>0||R[0].data.b_received>0))
}}var M=["new_ticket_selected","revaluation_billing_selected","share_cdr","merge"];
for(var P=0;
P<M.length;
P++){var Q=O.findC("_menuId",M[P],true);
if(Q){Q.enableIf(R.length)
}}}}function k(){if(window.callid){D.proxy.extraParams.fcallid=callid
}if(window.num){D.proxy.extraParams.fcaller=num;
D.proxy.extraParams.fcallerd_type=0
}else{if(window.caller||window.srcnum){D.proxy.extraParams.fcaller=caller||srcnum;
D.proxy.extraParams.fcallerd_type=1
}if(window.called||window.dstnum){D.proxy.extraParams.fcalled=called||dstnum;
D.proxy.extraParams.fcallerd_type=1
}}if(window.calldate){D.proxy.extraParams.fdatefrom=dateTimeStringToDate(window.calldate);
D.proxy.extraParams.fdateto=dateTimeStringToDate(window.calldate)
}else{if(window.calldatemin){D.proxy.extraParams.fdatefrom=dateTimeStringToDate(window.calldatemin)
}if(window.calldatemax){D.proxy.extraParams.fdateto=dateTimeStringToDate(window.calldatemax)
}}if(window.cdr_filter){var O=Ext.decode(window.cdr_filter);
if(O){for(var M in O){switch(M){case"fdatefrom":case"fdateto":D.proxy.extraParams[M]=dateTimeStringToDate(O[M]);
break;
case"config_cond_by_international":D.proxy.extraParams[M]=Ext.encode(O[M]);
break;
case"ffilters_comb":D.proxy.extraParams[M]=O[M].replaceall("__LF__","\n");
break;
default:D.proxy.extraParams[M]=O[M];
break
}}}}if(window.cdr_group_data&&this._panel&&this._panel.groupPanel){var N=Ext.decode(window.cdr_group_data);
this._panel.groupPanel.setGroupData(N)
}}function d(M,P,O,N){if(M.data.bye==100||M.data.bye==110){return(addBackgroundColorRuleToStyleSheet(M.data.bye==100?"FFE0E0":"FFFCE0",B+"-cell",B))
}}function c(N){if(N._menuId=="enableDns"||N._menuId=="flags_number"||N._menuId=="flags_ip"){if(!user.sqlrow){user.sqlrow={}
}var M;
var O;
switch(N._menuId){case"enableDns":M="uc_enable_dns_cdr";
O=N.checked?1:0;
N.ownerCt.hide();
break;
case"flags_number":M="uc_enable_flags_cdr_number";
O=N._value;
N.ownerCt.ownerCmp.ownerCt.ownerCmp.ownerCt.hide();
break;
case"flags_ip":M="uc_enable_flags_cdr_ip";
O=N._value;
N.ownerCt.ownerCmp.ownerCt.ownerCmp.ownerCt.hide();
break
}user.sqlrow[M]=O;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setItemUserConfigSqlrow",params:Ext.encode({item:M,value:O})},success:function(P){this.reload()
},maskEl:this,deferMask:true})
}}},getCdrColumns:function(f,a,n){var m=this;
var d=window.displaySensorNameCdr?"ID_sensor_name":"ID_sensor";
var k=simpleCdr?[{dataIndex:"ID",align:"right",width:50,sortable:true},{dataIndex:"calldate2",width:70,sortable:true,align:"center"},{headerLang:"duration2s",dataIndex:"duration2",width:60,sortable:true,align:"center",sortBy:{duration:this.findLangS("sortBy","duration"),payload:this.findLangS("sortBy","codec_payload")}},{headerLang:"srcSimple",dataIndex:"caller2",width:150,sortable:true,align:"center"},{headerLang:"dstSimple",dataIndex:"called2",width:100,sortable:true,align:"center"},{dataIndex:"lastresponse",width:100,sortable:true,align:"center"},{dataIndex:"menu",width:100,align:"right",noCopyToClipboard:true,renderer:function(t,p,q,u,s,r){return t&&t.replaceall("__THIS_ID__",a.id)||"&nbsp;"
}}]:[{headerLang:d,dataIndex:"ID",align:"center",width:50,sortable:true,filter:{type:"string"},renderer:function(B,D,q,y,u,C,z){var s="";
if(!m.level&&user_id()){s='<img id="record_check_'+q.data.ID+'" src="'+__extjs_images_path()+"menu/default-"+(q.data.checked?"":"un")+'checked.gif" onClick="Ext.getCmp(\''+m.id+"').evChangeCheckRecord('"+q.data.ID+"');\"><br>"
}var A="";
var t=CDR.Utils.getInfoText(q,{bye:true,stream:true,flags:true,unknown_sensor_id:true});
if(t.length){A="<br><img src=images/icon/exclamation"+(q.data.bye==100||q.data.unknown_sensor_id?"":"_yellow")+'.png data-qtip="'+t.join("<p>")+'" data-dismissDelay=15000>'
}var r="";
var v=CDR.Utils.getInfoText(q,{flag_fas:true,shortText:true});
if(v.length){r+='<br><span style="font-size: 70%;color: red">'+v.join("<br>")+"</span>"
}var p="";
var E=CDR.Utils.getInfoText(q,{flag_zerossrc:true,shortText:true});
if(E.length){p+='<br><span style="font-size: 70%;color: red">'+E.join("<br>")+"</span>"
}var w=window.displaySensorNameCdr&&q.data.sensorname?'&thinsp;<span style="font-size: 80%">'+q.data.sensorname+"</span>":"";
return('<div style = "text-align:center">'+s+B+(q.data.id_sensor?"<br>"+q.data.id_sensor+w:q.data._id_sensor?'<br><i style="color: grey;">'+q.data._id_sensor+"</i>":"")+A+r+p+"</div>")
}},{dataIndex:"calldate2e",width:window.time_precision_cdr_in_ms?80:70,sortable:true,align:"center",sortBy:{calldate:this.findLangS("sortBy","calldate"),callend:this.findLangS("sortBy","callend")}},{dataIndex:"duration2",width:window.time_precision_cdr_in_ms?90:60,sortable:true,align:"center",sortBy:{duration:this.findLangS("sortBy","duration"),progress_time:this.findLangS("sortBy","pdd"),payload:this.findLangS("sortBy","codec_payload")}},{dataIndex:"caller2",width:150,sortable:true,align:"center",sortBy:{caller:this.findLangS("sortBy","callerNumber"),sipcallerip:this.findLangS("sortBy","sipSourceIP")}}];
if(!simpleCdr){if(window.existsCdrProxy){k.push({dataIndex:"proxy",width:100,align:"center",renderer:l})
}k.push({dataIndex:"called2",width:150,sortable:true,align:"center",sortBy:{called:this.findLangS("sortBy","calledNumber"),sipcalledip:this.findLangS("sortBy","sipDestinationIP")}},{dataIndex:"lastresponse",width:100-(f.decWidthTable||0),sortable:"true",align:"center",renderer:function(u,p,r,v,t,s,q){return u+'<br><img src="images/icon/arrows_sip_history.png" style="cursor: pointer;" data-qtip="'+m.findLangS("tooltip","showSipHistory")+'" onClick="Ext.getCmp(\''+m.id+"').showSipHistory('"+r.data.ID+"');\">"
},sortBy:window.existsCdrReason?{lastresponse:this.findLangS("sortBy","lastresponse"),sip_reason:this.findLangS("sortBy","sip_reason"),q850_reason:this.findLangS("sortBy","q850_reason")}:undefined},{dataIndex:"callerrtp2",width:120,align:"right",headerLang:window.rtpQualityUse?null:"callerrtp2_without_rtp"},{dataIndex:"calledrtp2",width:120,align:"right",headerLang:window.rtpQualityUse?null:"calledrtp2_without_rtp"});
if(window.fillBillingTable){k.push({dataIndex:"price_customer",headerLang:"price",width:80,sortable:true,align:"right",renderer:g,sortBy:{price_customer:this.findLangS("sortBy","priceCustomer"),price_operator:this.findLangS("sortBy","priceOperator")}})
}k.push({dataIndex:"menu",width:100,align:"right",noCopyToClipboard:true,renderer:function(t,p,q,u,s,r){return t&&t.replaceall("__THIS_ID__",a.id)||"&nbsp;"
}})
}if(user_show_only_connected_calls()){for(var h=0;
h<k.length;
h++){if(k[h].dataIndex=="lastresponse"){k.splice(h,1);
break
}}}if(window.enableCdrColumnCallId&&!simpleCdr){k.push({dataIndex:"fbasename",width:160,renderer:function(t,p,q,u,s,r){return(renderStringStyle(q.data.fbasename_orig,{forceMultiLine:true}))
},sortable:true})
}var b=getDataCdrCustomHeaders();
if(b&&!simpleCdr){for(var h=0;
h<b.length;
h++){if(b[h].show_as_column*1){k.push({dataIndex:b[h]._column_unique,header:b[h].name,width:b[h].width_column*1||100,renderer:function(p){return(renderStringStyle(p,{forceMultiLine:true}))
},sortable:true})
}}}if(window.existsCdrNote){if(user_id()){k.push({xtype:"actioncolumn",dataIndex:"note",width:100,align:"left",rendererBase:c,items:[{getClass:function(p,q,r){return("icon_note_add")
},handler:function(r,v,p,s,t){var u=r.store.getAt(v);
var q=Ext.create("CDR.Note.Grid",Ext.apply({withoutStore:true,withoutGrid:true},{relFields:{cdr_id:u.data.ID}}));
q.createEditWindow(1,null,{onSubmitSuccess:function(w){r.ownerCt.panel.reloadRecord(u,["note"]);
if(r.rowExpander.isExpand(u)){u.expanderBodyContent.note.reload()
}},onSubmitSuccessScope:this})
},enableHandler:function(s,t,u,w,p,r,q){return(true)
},tooltip:this.findLangS("tooltip","addNote"),scope:this},{getClass:function(p,q,r){return(r.data.note?"icon_note_edit":"icon_blank")
},handler:function(q,u,p,r,s){var t=q.store.getAt(u);
if(q.rowExpander.isExpand(t)){if(t.expanderBodyContent.tabPanel.getActiveTab()==t.expanderBodyContent.note){Ext.Msg.alert("",this.findLangS("text","noteTableIsOpen"));
return
}}else{q.rowExpander.expandRow(u)
}t.expanderBodyContent.tabPanel.setActiveItem(t.expanderBodyContent.note)
},enableHandler:function(s,t,u,w,p,r,q){return(u.data.note)
},tooltip:this.findLangS("tooltip","editNote"),scope:this}],iconDivStyle:"float:left; height:30; width: 18;",iconVert:true,baseContentDivStyle:"text-overflow: ellipsis; overflow: hidden;"})
}else{k.push({dataIndex:"note",width:100,align:"left",renderer:c})
}}for(var h=0;
h<k.length;
h++){k[h].header=this.findLangS("column",k[h].headerLang||k[h].dataIndex)||k[h].header;
if(k[h].xtype=="actioncolumn"&&!k[h].menuText){k[h].menuText=k[h].header
}}k.push({dataIndex:"_filler",menuDisabled:true,removeFromColumnMenu:true,noColumnConfiguration:true});
return(k);
function g(v,s,r,w,u,t,q){if(r.data.price_customer||r.data.price_operator){var p='<table style="font: '+__font_Grid+'; margin-left: auto;"><tr>';
if(r.data.price_customer){p+='<td style="padding-right: 4px; color: grey;">'+t._grid.findLangS("column","price_customer_shortcut")+':</td><td style="text-align: right;">'+formatNumber(r.data.price_customer,r.data.price_customer<0.01?4:2)+'</td><td style="padding-left: 2px; color: grey;">'+(r.data.price_customer_currency_code||"")+"</td>"
}else{p+='<td colspan=3 style="text-align: center; color: grey;">--</td>'
}p+="</tr><tr>";
if(r.data.price_operator){p+='<td style="padding-right: 4px; color: grey;">'+t._grid.findLangS("column","price_operator_shortcut")+':</td><td style="text-align: right;">'+formatNumber(r.data.price_operator,r.data.price_operator<0.01?4:2)+'</td><td style="padding-left: 2px; color: grey;">'+(r.data.price_operator_currency_code||"")+"</td>"
}else{p+='<td colspan=3 style="text-align: center; color: grey;">--</td>'
}p+="</tr></table>";
return(p)
}else{return("")
}}function l(u,r,q,v,t,s,p){return(s._grid.renderProxy(u,4))
}function c(y,r,t,v,A,z,w){var s=z._grid.renderNote(y);
if(!s){return("")
}var q="note_"+t.data.ID;
var B="note_"+t.data.ID+"_container";
var u="note_"+t.data.ID+"_ellipsis";
var p='<div id="'+B+'" style="height: 40; overflow: hidden;"><div id="'+q+'" style="word-wrap: break-word; white-space: normal;">'+s+'</div></div><div id="'+u+'" style="visibility: hidden; height: 0; overflow: hidden;"><div style="font: '+__font_Grid+'; height: 12; margin-top: -6;"><b>...</b></div></div>';
Ext.defer(function(){var E=Ext.fly(w.getNode(v)).dom.clientHeight;
if(w.ownerCt.rowExpander.isExpand(t)){E-=t.expanderBodyContent.getHeight()+2
}E-=6;
var D=Ext.get(q);
var C=Ext.get(B);
var F=Ext.get(u);
if(D.getHeight()>E){C.setHeight(E-5);
F.setStyle({visibility:"visible",height:5})
}else{F.setStyle({visibility:"hidden",height:0});
C.setHeight(E)
}},1,this);
return(p)
}function o(p,r,q){Ext.defer(function(){var s=Ext.get(a.id+"/"+p.data.ID+"/"+r);
if(s){Ext.QuickTips.register({target:s,text:q})
}},100,this)
}},reconfigureCdrColumns:function(){var a=this.getCdrColumns(this,this,true);
this.grid.reconfigure(this.grid.store,a);
this.grid.applyConfig()
},reload:function(b,c,a){if(c){this.grid.store.on("load",c,a,{single:true})
}if(b&&b.page){this.grid.store.currentPage=b.page;
Ext.apply(b,{start:(b.page-1)*this.grid.store.pageSize})
}this.grid.store.load(b);
if(this._panel){this._panel.setTitleCdr()
}},reactivate:function(){var b=this.getTopToolbar();
if(b){var a=b.findC("_menuId","revaluation_billing",true);
if(a){a[window.fillBillingTable?"show":"hide"]()
}}},reloadRecord:function(a,b){ajaxSafeRequest({scope:this,url:this.grid.store.proxy.url,params:{module:"CDR",task:"SINGLEROW",ID:a.data.ID,taskParams:Ext.encode({keyField:"ID"})},success:function(c){this.grid._renderRecord(a,c.data,b)
}})
},onBeforeLoad:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(simpleCdr){beginLoadMaskWithStopButton_store(this.grid.store,"cdrGrid_loadMask")
}},onLoad:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}var a=this.getTopToolbar();
if(a){var b=this.getTopToolbar().find("_btnId","reset");
b=b&&b.length?b[0]:null;
if(b){b.setDisabled(!this.isSetFilter()&&!this.isSetOrder())
}}if(simpleCdr){endLoadMaskWithStopButton_store(this.grid.store)
}if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(ActiveModule=="CDR"&&this.isVisible()&&!reloginForm&&!this._windowFilter&&!this.grid.rowExpander.isAnyExpand()){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}},initSelectParams:function(){if(!this.disableMenu){for(var a in this.grid.store.proxy.extraParams){if(this.grid.store._params.indexOf(a)<0){this.grid.store.proxy.extraParams[a]=""
}}this.grid.store.proxy.extraParams.fdatefrom=CDR.Filter.getDefaultDateFrom()
}},getSelectParams:function(){var b={};
for(var a in this.grid.store.proxy.extraParams){if(this.grid.store._params.indexOf(a)<0){b[a]=this.grid.store.proxy.extraParams[a]
}}return b
},setRelFields:function(a,b){Ext.apply(this.grid.store.proxy.extraParams,a);
if(b){this.reload({page:1})
}},setCustomFilter:function(c,b,a){if(Ext.isObject(c)){Ext.apply(this.grid.store.proxy.extraParams,c)
}else{if(b!==null){this.grid.store.proxy.extraParams[c]=b
}else{if(Ext.isDefined(this.grid.store.proxy.extraParams[c])){this.grid.store.proxy.extraParams[c]=null;
delete this.grid.store.proxy.extraParams[c]
}}}if(a){this.reload({page:1})
}},isSetFormFilter:function(){var b=cloneObject(this.grid.store.proxy.extraParams);
CDR.Filter.optimizeFilterItems(b);
for(var a in b){if(Ext.isString(a)&&Ext.isDefined(b[a])&&b[a]!==""&&b[a]!==null&&!a.match(/^order.*/)&&!a.match(/^groupfilter_.*/)&&!a.match(/^group_.*/)&&!["fsipcallerdip_with_proxy","fcallerd_search_type"].inArray(a)&&this.grid.store._params.indexOf(a)<0&&(a!="fdatefrom"||!b.fdatefrom||(b.fdatefrom.getTime?b.fdatefrom.getTime():date(b.fdatefrom))!=CDR.Filter.getDefaultDateFrom().getTime())){return true
}}return false
},clearFormFilter:function(){for(var a in this.grid.store.proxy.extraParams){if(a.match&&!a.match(/^order.*/)&&!a.match(/^groupfilter_.*/)&&!a.match(/^group_.*/)&&this.grid.store._params.indexOf(a)<0){this.grid.store.proxy.extraParams[a]=""
}}this.grid.store.proxy.extraParams.fdatefrom=CDR.Filter.getDefaultDateFrom();
this.grid.store.proxy.extraParams.fdateto=null
},isSetOrder:function(){for(var a in this.grid.store.proxy.extraParams){if(Ext.isString(a)&&Ext.isDefined(this.grid.store.proxy.extraParams[a])&&this.grid.store.proxy.extraParams[a]!==""&&this.grid.store.proxy.extraParams[a]!==null&&a.match(/^order.+/)){return true
}}return false
},clearOrder:function(){for(var a in this.grid.store.proxy.extraParams){if(a.match&&a.match(/^order.+/)){this.grid.store.proxy.extraParams[a]=""
}}},getOrderTypes:function(){return([["orderByLoss",this.findLangS("menu","orderByWorstLoss")],["orderByDelay",this.findLangS("menu","orderByWorstDelay")],["orderByFixed1",this.findLangS("menu","orderByFixed1")],["orderByFixed2",this.findLangS("menu","orderByFixed2")],["orderByAdapt",this.findLangS("menu","orderByAdaptive")],["orderByCallDuration_asc",this.findLangS("menu","orderByCallDuration"),"asc"],["orderByCallDuration_desc",this.findLangS("menu","orderByCallDuration"),"desc"],["orderBySrcSIP_IP_asc",this.findLangS("menu","orderBySrcSIP_IP"),"asc"],["orderBySrcSIP_IP_desc",this.findLangS("menu","orderBySrcSIP_IP"),"desc"],["orderByDstSIP_IP_asc",this.findLangS("menu","orderByDstSIP_IP"),"asc"],["orderByDstSIP_IP_desc",this.findLangS("menu","orderByDstSIP_IP"),"desc"],["orderBySrcNumber_asc",this.findLangS("menu","orderBySrcNumber"),"asc"],["orderBySrcNumber_desc",this.findLangS("menu","orderBySrcNumber"),"desc"],["orderByDstNumber_asc",this.findLangS("menu","orderByDstNumber"),"asc"],["orderByDstNumber_desc",this.findLangS("menu","orderByDstNumber"),"desc"],["orderByCallerName_asc",this.findLangS("menu","orderByCallerName"),"asc"],["orderByCallerName_desc",this.findLangS("menu","orderByCallerName"),"desc"],["orderByLastSIPrespNum_asc",this.findLangS("menu","orderByLastSIPrespNum"),"asc"],["orderByLastSIPrespNum_desc",this.findLangS("menu","orderByLastSIPrespNum"),"desc"]])
},isSetColumnFilter:function(){var a=false;
if(this.grid.filters&&this.grid.filters.filters&&this.grid.filters.filters.getCount()){this.grid.filters.filters.each(function(b){if(b.active){a=true;
return false
}})
}return a
},clearColumnFilter:function(){if(this.grid.filters){this.grid.filters.clearFilters()
}},setGroupSelect:function(f,d,a,b,c){if(!c){this.clearGroupSelect()
}this.grid.store.proxy.extraParams["group_"+f+(d?"_"+d:"")]=a;
if(b){this.reload({page:1})
}},setGroupSelectByDataRecord:function(g,f,a,c,d){if(Ext.isArray(g)){for(var b=0;
b<g.length;
b++){this.setGroupSelectByDataRecord(g[b],f,a,c&&b==g.length-1,b>0)
}}else{this.setGroupSelect(g,f,a[g],c,d)
}},isSetGroupSelect:function(){for(var a in this.grid.store.proxy.extraParams){if(Ext.isString(a)&&Ext.isDefined(this.grid.store.proxy.extraParams[a])&&this.grid.store.proxy.extraParams[a]!==""&&this.grid.store.proxy.extraParams[a]!==null&&a.match(/^group_.*/)){return true
}}return false
},clearGroupSelect:function(c,a){var d=false;
for(var b in this.grid.store.proxy.extraParams){if(b.match&&b.match(/^group_.*/)&&!Ext.isEmpty(this.grid.store.proxy.extraParams[b])){this.grid.store.proxy.extraParams[b]=null;
d=true
}}if(d){if(c){this.reload()
}if(a&&this._panel){this._panel.deselectAllGroupSelects()
}return true
}return false
},setGroupFilter:function(b,d,a,c){if(b.match(/^groupfilter_/)){b=b.substr(12)
}if(c&&b.match(new RegExp("^groupfilterL"+c+"_"))){b=b.substr(14)
}this.grid.store.proxy.extraParams["groupfilter"+(c?"L"+c:"")+"_"+b]=d;
if(!a){this.reload({page:1})
}},isSetGroupFilter:function(b){for(var a in this.grid.store.proxy.extraParams){if(Ext.isString(a)&&Ext.isDefined(this.grid.store.proxy.extraParams[a])&&this.grid.store.proxy.extraParams[a]!==""&&this.grid.store.proxy.extraParams[a]!==null&&a.match(b?new RegExp("^groupfilterL"+b+"_.*"):/^groupfilter_.*/)){return true
}}return false
},clearGroupFilter:function(b){for(var a in this.grid.store.proxy.extraParams){if(a.match&&a.match(b?new RegExp("^groupfilterL"+b+"_.*"):/^groupfilter_.*/)){this.grid.store.proxy.extraParams[a]=null
}}if(!b){this.clearGroupFilter(2);
if(this._panel){this._panel.deselectAllGroupFilters()
}}},isSetFilter:function(){return this.isSetFormFilter()||this.isSetColumnFilter()||this.isSetGroupFilter()||this.isSetGroupFilter(2)||this.isSetGroupSelect()
},clearIgnoreReloadGroup:function(){if(this._panel){this._panel.clearIgnoreReloadGroup()
}},doDownloadWav:function(b,a,c){CDR.Utils.prepareDownloadPcapWav(b,{panel:this,fceSuccess:function(d){if(a){var f=new Tools.AuditForm({cdrId:b,activity:_AuditActivity_download_wav,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(d,300)
},fceCancel:function(){unlinkPrepareFileHash(d)
},fceContinueScope:this});
f.audit()
}else{downloadPrepareFileHash(d)
}},wav:c?"ogg":true})
},doDownloadOgg:function(b,a){this.doDownloadWav(b,a,true)
},doDownloadSound:function(b,a,c,d){var f=new Ext.menu.Menu({defaults:{handler:function(g){this.doDownloadWav(b,a,g._ogg)
},scope:this},items:[{text:"OGG",_ogg:true},{text:"WAV"}]});
f.showAtMouse(d)
},doDownloadPcap:function(b,a,c){CDR.Utils.prepareDownloadPcapWav(b,{panel:this,fceSuccess:function(d){if(a){var f=new Tools.AuditForm({cdrId:b,activity:_AuditActivity_download_pcap,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(d,300)
},fceCancel:function(){unlinkPrepareFileHash(d)
},fceContinueScope:this});
f.audit()
}else{downloadPrepareFileHash(d)
}},disableRtp:c})
},doShareCdrSipRtp:function(b,a,c){if(this.menuCdrLink.length){var d=new Ext.menu.Menu({items:this.menuCdrLink});
d.showAtMouse(c)
}else{Ext.Msg.alert("",this.findLangS("text","sharingIsNotPermitted"))
}},doShareCdrSip:function(b,a,c){if(this.menuTypeCdrLink.length){var d=new Ext.menu.Menu({items:[{text:this.findLangS("menu","showLink"),iconCls:"icon_magnifier",handler:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0].handler:undefined,_menuSubId:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0]._menuSubId:undefined,_menuId:"share_cdr_show",_menuId2:null,scope:this,menu:this.menuTypeCdrLink.length>1?{defaults:{_menuId:"share_cdr_show",scope:this},items:cloneArray(this.menuTypeCdrLink)}:undefined},{text:this.findLangS("menu","sendLinkViaEmail"),iconCls:"icon_email_send",handler:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0].handler:undefined,_menuSubId:this.menuTypeCdrLink.length==1?this.menuTypeCdrLink[0]._menuSubId:undefined,_menuId:"share_cdr_send",_menuId2:null,scope:this,menu:this.menuTypeCdrLink.length>1?{defaults:{_menuId:"share_cdr_send",scope:this},items:cloneArray(this.menuTypeCdrLink)}:undefined}]});
d.showAtMouse(c)
}else{Ext.Msg.alert("",this.findLangS("text","sharingIsNotPermitted"))
}},doPlayFlashWavPlayer:function(b,c,a,d){CDR.Utils.doPlayFlashWavPlayer(b,{panel:this,expand:c,audit:a,event:d})
},getRowIndexForCdrId:function(a){return this.grid.store.findBy(function(b){return b.data.ID==a
})
},getRecordForCdrId:function(a){var b=this.getRowIndexForCdrId(a);
if(b<0){return null
}return this.grid.store.getAt(b)
},reloadCharts:function(){if(this.chartsPanel&&this.chartsPanel.getEl&&this.chartsPanel.getEl()&&this.chartsPanel.isVisible()){this.chartsPanel.reloadCharts(true)
}},createChartsPanel:function(a){if(!this.chartsPanel){this.chartsPanel=new CDR.Chart({filtersFromParent:a.proxy.extraParams,border:false,childPanel:true,disableCreateBtnAdd:true});
this.setStateChartsButton()
}return(this.chartsPanel)
},createChartsWindow:function(){this.createChartsPanel;
this.chartsWindow=new Ext.Window({id:"CDR-charts-window",title:'<table cellspacing=0 cellpadding=0 style="position: relative; top: 1; height: 19;"><td><span class="x-panel-header-title-default">'+this.findLangS("title","charts")+'</span><td style="padding-left: 5;"><span id="cdr_charts_undock_title"></span></table>',layout:"fit",width:Ext.dom.Element.getViewportWidth()*9/10,height:Ext.dom.Element.getViewportHeight()*9/10,maximizable:true,modal:false,listeners:{scope:this,close:function(){this.chartsWindow.removeAll(false);
this.chartsWindow=null;
this.setStateChartsButton()
},afterrender:function(){var a=new Ext.Panel({border:false,height:19,width:500,layout:"hbox",items:[{xtype:"button",text:this.findLangS("button","dock"),height:19,border:false,style:{marginRight:2},handler:function(){this.dockChartsPanel()
},scope:this},{xtype:"button",text:this.findLangS("button","addChart"),iconCls:"icon_add",height:19,border:false,handler:function(){this.chartsPanel.addChart()
},scope:this}],renderTo:"cdr_charts_undock_title",bodyStyle:{background:"transparent"}})
}}});
this.chartsWindow.show();
this.chartsWindow.add(this.chartsPanel);
this.setStateChartsButton()
},undockChartsPanel:function(){this.chartsContainer.removeAll(false);
this.chartsContainer.collapse();
this.createChartsWindow();
this.setStateChartsButton()
},dockChartsPanel:function(){if(this.chartsWindow){this.chartsWindow.removeAll(false);
this.chartsWindow.destroy();
this.chartsWindow=null;
this.chartsContainer.expand();
this.setStateChartsButton()
}},openCharts:function(){if(!this.chartsWindow&&this.chartsContainer.getState().collapsed){this.chartsContainer.expand();
this.setStateChartsButton()
}},setStateChartsButton:function(){if(this.getEl()){var a=this.getTopToolbar();
if(a){var b=a.find("_btnId","charts");
if(b&&b.length){b[0].enableIf(!this.chartsWindow&&this.chartsContainer.getState().collapsed)
}}}},showFax:function(a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getUserCanAudit"},success:function(c){if(c.can_audit){var d=new Tools.AuditForm({cdrId:a,activity:_AuditActivity_show_fax,autoAudit:c.can_audit==2,fceContinue:function(){CDR.Utils.showFax(this,a,b)
},fceCancel:function(){},fceContinueScope:this});
d.audit()
}else{CDR.Utils.showFax(this,a,b)
}}})
},onDownloadPcap:function(b){var a=this.grid.selModel.getSelection();
if(a&&a.length==1){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getUserCanAudit"},success:function(c){this.doDownloadPcap(a[0].data.ID,c.can_audit,!b)
}})
}},onMergePcapSipHistory:function(h,a,g,b,c){var k=0;
var d=null;
if(g=="select"){var l=this.grid.selModel.getSelection();
if(l){k=l.length
}if(!k){Ext.Msg.alert(this.findLangS("title","msgZeroCdrForMerge"),this.findLangS("text","msgZeroCdrForMerge"));
return
}if(!b&&k>10){Ext.Msg.confirm(this.findLangS("title","msgTooMuchCdrForMerge"),this.findLangS("text","msgTooMuchCdrForMerge1")+" "+k+" "+this.findLangS("text","msgTooMuchCdrForMerge2"),function(m){if(m=="yes"){this.onMergePcapSipHistory(h,a,g,true,c)
}},this);
return
}d=[];
for(var f=0;
f<l.length;
f++){d.push(l[f].data.ID)
}}else{if(g=="array"){d=a;
a=null
}}Tools.Pcaps.mergePcap({masterCdrId:a,selectedId:d,filter:g=="filter"?this.grid.store.proxy.extraParams:null,rtp:h=="pcaprtp",with_http:true,downloadPcap:h=="pcap"||h=="pcaprtp",onSuccess:function(){if(h=="pcap"||h=="pcaprtp"){var m=arguments[0];
if(m.audit){var p=new Tools.AuditForm({cdrId:d||m.ids,activity:_AuditActivity_download_pcap,autoAudit:m.audit==2,fceContinue:function(){downloadPrepareFileHash(m,300)
},fceCancel:function(){unlinkPrepareFileHash(m)
},fceContinueScope:this});
p.audit()
}else{downloadPrepareFileHash(m)
}}else{var o=arguments[0];
var n=Ext.Date.format(new Date,__format_DateTimeDb);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"mergeSipHistory",params:Ext.encode({mergeUniqueKey:o,uniquekey:n})},success:function(q){new CDR.SipHistoryWithDiagramPanel({cdrId:"multi",autoOpenWindow:true,windowTitle:this.findLangS("title","sipHistory_merge"),sipHistoryConfig:{initStoreData:q.results,uniquekey:n},diagramConfig:{uniquekey:n},_mergeParams:{masterCdrId:a,selectedId:d,filter:g=="filter"?this.grid.store.proxy.extraParams:null,rtp:h=="pcaprtp",with_http:true,uniquekey:n},disableSvgPaint:c&&c.disableSvgPaint})
},maskEl:this})
}},onSuccessScope:this,maskElId:this.id})
},exportToCsv:function(a){switch(a._menuId){case"table":formPostSafe("php/model/sql.php","POST",{module:"CDR",task:"CSV",dummy:new Date(),timeout:60*60});
break;
case"summary_by_caller":case"summary_by_called":beginLoadMaskWithStopButton_ajax(this,"cdrSummaryCsv");
var b=ajaxSafeRequest({scope:this,url:"php/model/sql.php",params:{module:"CDR",task:"summary_by_callerd",by:a._menuId=="summary_by_caller"?"caller":"called",filter:Ext.encode(this.grid.store.proxy.extraParams),timeout:60*60,prepare:true},success:function(c){downloadPrepareFileHash(c);
endLoadMaskWithStopButton_ajax(this)
},error2:function(){endLoadMaskWithStopButton_ajax(this)
},failure:function(c){if(!b._aborted){alertAjaxFailure(c)
}endLoadMaskWithStopButton_ajax(this)
},timeout:60*60*1000});
startLoadMaskWithStopButton_ajax(this,b)
}},selectionCDR:function(a){switch(a._menuId){case"clear":ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"userSelectionCdr",params:Ext.encode({clear:true})},success:function(){this.grid.store.each(function(b){if(b.data.checked){b.data.checked=false;
b.commit()
}})
}});
break;
case"save":this.saveSelectionCDR();
break;
case"manage":this.manageSelectionCDR();
break
}},saveSelectionCDR:function(a){if(!Ext.isDefined(a)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"userSelectionCdr",params:Ext.encode({getCount:true})},success:function(f){if(f.count*1){this.saveSelectionCDR(f.count)
}else{Ext.Msg.alert("",this.findLangS("text","currentSelectionIsEmpty"))
}}});
return
}var d=new Ext.FormPanel({frame:true,border:false,items:[{xtype:"textfield",name:"name",fieldLabel:findLangS(this.subsystem,"field","selectionName"),width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),allowBlank:false},{xtype:"checkbox",name:"priv",fieldLabel:findLangS(this.subsystem,"field","privateSelection"),checked:true,labelWidth:__width_FieldChar(15)}],buttons:[{text:findLangS(this.subsystem,"button","save"),iconCls:"icon_save",handler:function(){b.call(this)
},scope:this},{text:findLangS(this.subsystem,"button","cancel"),iconCls:"icon_cancel",handler:function(){d.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",d.el,{enter:function(){b.call(this)
},scope:this})
}}});
var c=new Ext.Window({layout:"fit",items:d,border:false,title:findLangS(this.subsystem,"title","saveSelection"),modal:true,closable:true,listeners:{scope:this,activate:function(){d.getForm().findField("name").focus(false,200)
}}});
c.show();
function b(f){if(d.getForm().isValid()){var g=d.getForm().getFieldValues();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"userSelectionCdr",params:Ext.encode({save:true,formValues:g,enableUpdate:f})},success:function(h){d.destroyWindow()
},error:function(k,h){if(k.error=="name_duplication"){Ext.Msg.confirm(findLangS(this.subsystem,"title","msgDuplicationName"),findLangS(this.subsystem,"text","msgDuplicationName"),function(l){if(l=="yes"){b.call(this,true)
}else{d.destroyWindow()
}},this)
}else{alertAjaxError(h)
}},failure:function(){d.getEl().unmask()
},maskEl:d})
}}},manageSelectionCDR:function(){var a=new Ext.ux.grid.GridForm({subsystem:"cdr",storeId:"SelectionCDR",url:"php/model/sql.php",module:"user_selections",recordStruct:rsUserSelections,sortField:"name",columns:[{dataIndex:"name",widthCh:40,flex:1}],enableDelete:true,tbar:[{text:this.findLangS("button","restoreToCurrentSelection"),iconCls:"icon_restore_default",handler:function(){var c=a.getSelectionModel();
var d=c.getSelection();
if(d&&d.length==1){this.restoreToCurrentSelection(d[0])
}},_id:"restoreToCurrentSelection",scope:this,disabled:true}],onSelectionChange:function(c){var d=c.getSelection();
this.enableBtn("restoreToCurrentSelection",d&&d.length==1)
},width:300,height:300});
var b=new Ext.Window({layout:"fit",items:a,border:false,title:this.findLangS("title","manageSavedSelections"),modal:true,closable:true});
b.show()
},restoreToCurrentSelection:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"userSelectionCdr",params:Ext.encode({restore:true,id:a.data.id})},success:function(b){this.grid.store.each(function(c){c.data.checked=b.ids.isIn(c.data.ID);
c.commit()
})
}})
},renderProxy:function(d,a){rsltValue=null;
if(d){var c=Ext.decode(d);
if(c&&c.length){rsltValue="";
for(var b=0;
b<(a?Math.min(a,c.length):c.length);
b++){if(rsltValue){rsltValue+="<br>"
}rsltValue+=c[b][0];
if(c[b].length>1&&c[b][1]){rsltValue+="<br><i>"+c[b][1]+"</i>"
}}if(a&&c.length>a){rsltValue+="<br><b>...</b>"
}}}return(rsltValue)
},prepareNoteLines:function(b){var c=[];
if(b){var d=Ext.decode(b);
if(d&&d.length){for(var a=0;
a<d.length;
a++){c=c.concat(d[a].note.split("\n"))
}}}return(c)
},renderNote:function(b){rsltNote=null;
if(b){var c=this.prepareNoteLines(b);
if(c.length){rsltNote="";
for(var a=0;
a<c.length;
a++){if(rsltNote){rsltNote+="<br>"
}rsltNote+=c[a]
}}}return(rsltNote)
},viewUrl:function(){var f=window.location.origin+window.location.pathname;
var d={};
var c=CDR.Filter.getArrayOfAllFields();
for(var b in this.grid.store.proxy.extraParams){if(Ext.isString(b)&&c.inArray(b.substr(1))&&Ext.isDefined(this.grid.store.proxy.extraParams[b])&&this.grid.store.proxy.extraParams[b]!==null&&this.grid.store.proxy.extraParams[b]!==""){d[b]=this.grid.store.proxy.extraParams[b]
}}if(d.ffilters_comb){d.ffilters_comb=d.ffilters_comb.replaceall("\n","__LF__")
}var a={};
if(this._panel.groupPanel){a=this._panel.groupPanel.getGroupData()
}if(!isDataEmpty(d)||!isDataEmpty(a)){f+="?"
}if(!isDataEmpty(d)){CDR.Filter.optimizeFilterItems(d);
f+="cdr_filter="+encodeURIjson(Ext.encode(d))
}if(!isDataEmpty(a)){if(!isDataEmpty(d)){f+="&"
}f+="cdr_group_data="+encodeURIjson(Ext.encode(a))
}var g='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+f+'" target="_blank">'+f+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(findLangS(this.subsystem,"title","viewUrl"),g,function(){var h=Ext.getCmp("copy_button");
if(h){h.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(h){return(h.clipboardText)
},getClipTextParams:{clipboardText:f},id:"copy_button",renderTo:"copy_button_div"})
},showHttpJjViaExternalTransactionId:function(){new HTTP.ViewHttp({_window:true})
},showSipHistory:function(b){var a=this.grid.store.getById(b);
new CDR.SipHistoryWithDiagramPanel({cdrId:b,cdrRecordData:a&&a.data,autoOpenWindow:true,windowTitle:this.findLangS("title","sipHistory")})
},evChangeCheckRecord:function(b){var a=this.grid.store.getById(b*1);
if(a){var c={id:a.data.ID,calldate:a.data.calldate};
if(a.data.checked){c.remove=true
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"userSelectionCdr",params:Ext.encode(c)},success:function(){a.data.checked=!a.data.checked;
a.commit()
}})
}},concurrentCallsStats:function(){new Tools.CallStatsChart({autoCalcCallStats:22,cdrFilter:this.grid.store.proxy.extraParams,header:"Concurrent calls stats",text:"Number of concurrent calls (only connected calls)",buttons:false})
}});
Ext.define("CDR.SummaryPanel",{extend:"Ext.Panel",alias:"widget.CDR_summaryPanel",subsystem:"cdr",constructor:function(Q){var f=312;
var J=532-(Q.grid&&Q.grid.decWidthTable||0);
var v=Math.max(J,Q.widthExpArea-f-34);
var P=250;
var W=CDR.Utils.getAllRtpStreams(Q.record.data,{sortDescByReceived:true,receivedGt:2});
if(Q.record){var a=Q.record.data.embedplayer_indirect;
a=a.replaceall("__PANEL_ID__",Q.grid?Q.grid.ownerCt.id:Q.id);
if(Q.record.data.menu_pcap){Q.record.data.menu_pcap=Q.record.data.menu_pcap.replaceall("__THIS_ID__",Q.grid?Q.grid.ownerCt.id:Q.id)
}if(Q.record.data.menu_wav){Q.record.data.menu_wav=Q.record.data.menu_wav.replaceall("__THIS_ID__",Q.grid?Q.grid.ownerCt.id:Q.id)
}}var Z=CDR.Utils.getInfoText(Q.record,{all:true});
var n="";
if(Z.length){n='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;"><img src=images/icon/exclamation'+(Q.record.data.bye==100||Q.record.data.unknown_sensor_id?"":"_yellow")+'.png></th></tr></thead><tbody><tr><td><div style="width: '+J+'px; word-wrap: break-word;white-space: normal;">'+(Z.length>1?"&#x25CF;&thinsp;"+Z.join('<p style="margin-top: 3px; margin-bottom: 0px;">&#x25CF;&thinsp;'):Z[0])+"</div></td></tr></tbody></table>"
}var T="";
var O=getDataCdrCustomHeaders();
if(O){for(var X=0;
X<O.length;
X++){if(Q.record.data[O[X]._column_unique]){T+='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">'+O[X].name+'</th></tr></thead><tbody><tr><td><div style="width: '+J+'px; word-wrap: break-word;white-space: normal;">'+htmlEncode(Q.record.data[O[X]._column_unique])+"</div></td></tr></tbody></table>"
}}}var G="";
if(Q.record.data.proxy){var D=Ext.decode(Q.record.data.proxy);
if(D&&D.length){G="<table>";
for(var X=0;
X<D.length;
X++){G+='<tr><td style="padding: 0;">'+D[X][0];
if(D[X].length>1&&D[X][1]){G+='<td style="padding: 0; padding-left: 5;"><i>'+D[X][1]+"</i>"
}}G+="</table>"
}}var c="";
var o="";
if(Q.record.data.allrtpstreams){var D=Ext.decode(Q.record.data.allrtpstreams);
if(D&&D.length){for(var X=0;
X<D.length;
X++){if(Q.record.data.a_saddr==D[X]["daddr"]&&Q.record.data.b_saddr==D[X]["saddr"]){c=D[X]["sport"]||"";
o=D[X]["dport"]||"";
break
}}}}var S="";
if(Q.record.data.allsiprequests){var D=Ext.decode(Q.record.data.allsiprequests);
if(D&&D.length){S='<table border="0" cellspacing="0" cellpadding="0" style="border-spacing: 0; border-collapse: collapse;">';
for(var X=0;
X<D.length;
X++){S+='<tr><td style="padding: 0;">'+D[X]["SIPrequest"];
if(D[X]["cnt"]>1){S+='<td style="padding: 0; padding-left: 5px;">'+D[X]["cnt"]+"x"
}}S+="</table>"
}}var r="";
if(Q.record.data.allsipresponses){var D=Ext.decode(Q.record.data.allsipresponses);
if(D&&D.length){r='<table border="0" cellspacing="0" cellpadding="0" style="border-spacing: 0; border-collapse: collapse;">';
for(var X=0;
X<D.length;
X++){r+='<tr><td style="padding: 0;">'+D[X]["SIPresponse"]
}r+="</table>"
}}var y="";
if(S||r){var H="";
if(S&&r){H+='<table border="0" cellspacing="0" cellpadding="0" style="border-spacing: 0; border-collapse: collapse;"><tr><td style="padding: 0; font-size: 70%; width: '+(J/2-4)+'px; vertical-align: top; padding-bottom: 2px;"><i><b>requests</b><br>stored according to sniffer configuration</i><td style="padding: 0; font-size: 70%; width: '+(J/2-4)+'px; vertical-align: top; padding-bottom: 2px;"><i><b>responses</b></i><tr><td style="padding: 0; vertical-align: top;">'+S+'<td style="padding: 0; vertical-align: top;">'+r+"</table>"
}else{if(S){H+=S
}else{H+=r
}}y='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">'+(S&&r?"sip requests & responses":S?'sip requests<span style="font-size: 80%;">&nbsp / stored according to sniffer configuration</span>':"sip responses")+'</th></tr></thead><tbody><tr><td><div style="width: '+J+'px; word-wrap: break-word;white-space: normal;">'+H+"</div></td></tr></tbody></table>"
}var g="";
if(Q.record.data.max_retransmission_invite){g='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">max. retransmission invite</th></tr></thead><tbody><tr><td><div style="width: '+J+'px; word-wrap: break-word;white-space: normal;">'+Q.record.data.max_retransmission_invite+"</div></td></tr></tbody></table>"
}var A="";
if(Q.record.data.hold){var s=Q.record.data.hold.split(",");
dataHoldInfo="<table>";
for(var X=0;
X<s.length;
X++){var M;
if(s[X].charAt(0)==="+"){M=s[X].substr(1)+"s HOLD"
}else{M=s[X].substr(1)+"s UNHOLD"
}dataHoldInfo+='<tr><td style="padding: 0;">'+M
}dataHoldInfo+="</table>";
A+='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">CALL HOLDS / UNHOLDS</th></tr></thead><tbody><tr><td><div style="width: '+J+'px; word-wrap: break-word;white-space: normal;">'+dataHoldInfo+"</div></td></tr></tbody></table>"
}var b="";
if(Q.record.data.caller_silence||Q.record.data.called_silence||Q.record.data.caller_silence_end||Q.record.data.called_silence_end){b="<tr><td>silence<td>"+(Q.record.data.caller_silence?Q.record.data.caller_silence+"%":"")+(Q.record.data.caller_silence_end?"<br>end silence: "+Q.record.data.caller_silence_end+"s":"")+"<td>"+(Q.record.data.called_silence?Q.record.data.called_silence+"%":"")+(Q.record.data.called_silence_end?"<br>end silence: "+Q.record.data.called_silence_end+"s":"")
}var L="";
if(Q.record.data.caller_clipping||Q.record.data.called_clipping){L="<tr><td>clipped frames<td>"+(Q.record.data.caller_clipping?(Q.record.data.caller_clipping>=(Math.pow(2,16)-1)?">":"")+Q.record.data.caller_clipping:"")+"<td>"+(Q.record.data.called_clipping?(Q.record.data.called_clipping>=(Math.pow(2,16)-1)?">":"")+Q.record.data.called_clipping:"")
}var E="";
if(Q.record.data.flags&3){E="<tr><td>change source RTP port<td>"+(Q.record.data.flags&1?"yes":"")+"<td>"+(Q.record.data.flags&2?"yes":"")
}var m="word-wrap: break-word; white-space: normal;";
var N="";
for(var X=0;
X<2;
X++){var w=X==0?"a":"b";
var Y=CDR.Utils.rtpStream_ab(Q.record.data,w,W);
if(Y){N+=F(Y,w)
}}var K=CDR.Utils.rtpStreams_next(Q.record.data,W);
if(K){for(var X=0;
X<K.length;
X++){N+=F(K[X])
}}var p=new Ext.Template('<div id="summary_panel_'+(Q.grid&&Q.grid.level||0)+'_{ID}">','<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-right: 4px;">',"<thead><tr>","<th>Start","<th>Duration","<th>PDD","<th>Ringing","<th>Connected","<th>Last SIP response","<th>Caller","<th>Called",(Q.enableDownloadPcap&&Q.record.data.menu_pcap?"<th>PCAP":""),(Q.record.data.menu_wav?"<th>AUDIO":""),"</tr></thead>","<tbody><tr>","<td>{calldate}","<td>{duration}","<td>"+(Q.record.data.progress_time?formatNumber(Q.record.data.progress_time,window.time_precision_cdr_in_ms?3:0)+"s":""),"<td>"+(Q.record.data.ringing_time?formatNumber(Q.record.data.ringing_time,window.time_precision_cdr_in_ms?3:0)+"s":""),"<td>{connect_duration}","<td>{sipresponse}","<td>"+Q.record.data.caller_with_domain+(Q.record.data.whohanged=="caller"?'<img src="images/icon/hangup8.gif"/>':""),"<td>"+Q.record.data.called_with_domain+(Q.record.data.whohanged=="callee"?'<img src="images/icon/hangup8.gif"/>':""),(Q.enableDownloadPcap&&Q.record.data.menu_pcap?"<td>"+Q.record.data.menu_pcap:""),(Q.record.data.menu_wav?"<td>"+Q.record.data.menu_wav:""),"</tr></tbody>","</table>",a||"",'<table border="0">','<tr><td style="vertical-align: top;">','<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-bottom: 4px; width: '+f+'px; table-layout: fixed;">','<colgroup><col width="30%"><col width="35%"><col width="35%"></colgroup>',"<thead><tr><th>&nbsp;<th>Caller<th>Called</tr></thead>","<tbody>","<tr><td>SIP IP",'<td style="'+m+'">'+Q.record.data.sipcallerip+(Q.record.data.sipcaller_host?"<br><i>{sipcaller_host}</i>":"")+(window.existsDscpCdr&&Q.record.data.dscp!==null?"<br><i>DSCP "+getDscpCode(Q.record.data.dscp,1,1)+"</i>":""),'<td style="'+m+'">'+Q.record.data.sipcalledip+(Q.record.data.sipcalled_host?"<br><i>{sipcalled_host}</i>":"")+(window.existsDscpCdr&&Q.record.data.dscp!==null?"<br><i>DSCP "+getDscpCode(Q.record.data.dscp,0,1)+"</i>":""),(Q.record.data.sipcallerport||Q.record.data.sipcalledport?"<tr><td>SIP Port<td>"+(Q.record.data.sipcallerport||"")+"<td>"+(Q.record.data.sipcalledport||""):""),"<tr><td>RTP IP",'<td style="'+m+'">'+(Q.record.data.callerrtp&&Q.record.data.callerrtp!="0.0.0.0"?(Q.record.data.callerrtp+(Q.record.data.callerrtp_host?"<br><i>{callerrtp_host}</i>":"")+(window.existsDscpCdr&&Q.record.data.dscp!==null?"<br><i>DSCP "+getDscpCode(Q.record.data.dscp,1,0)+"</i>":"")):""),'<td style="'+m+'">'+(Q.record.data.calledrtp&&Q.record.data.calledrtp!="0.0.0.0"?(Q.record.data.calledrtp+(Q.record.data.calledrtp_host?"<br><i>{calledrtp_host}</i>":"")+(window.existsDscpCdr&&Q.record.data.calledrtp!="0.0.0.0"&&Q.record.data.dscp!==null?"<br><i>DSCP "+getDscpCode(Q.record.data.dscp,0,0)+"</i>":"")):""),"<tr><td>RTP Port","<td>"+o,"<td>"+c,window.existsCdrSdp?'<tr><td>SDP<td style="'+m+'"><div id="sdp_caller_container_'+(Q.grid&&Q.grid.level||0)+'_{ID}"><img src='+__extjs_images_path()+'grid/loading.gif></div><td style="'+m+'"><div id="sdp_called_container_'+(Q.grid&&Q.grid.level||0)+'_{ID}"><img src='+__extjs_images_path()+"grid/loading.gif></div>":"",window.existsCdrProxy&&Q.record.data.proxy?"<tr><td>Proxy IP<td colspan=2>"+G:"",'<tr><td>User Agent<td style="'+m+'">{a_ua}<td style="'+m+'">{b_ua}',"<tr><td>Codec<td>{a_codec}<td>{b_codec}","<tr><td>Received packets<td>{a_received}<td>{b_received}",window.existsLastRtpFromEnd?"<tr><td>Seconds between last RTP and last SIP packet<td>"+(Ext.isEmpty(Q.record.data.a_last_rtp_from_end)?"":formatNumber(Q.record.data.a_last_rtp_from_end,window.time_precision_cdr_in_ms?3:0))+"<td>"+(Ext.isEmpty(Q.record.data.b_last_rtp_from_end)?"":formatNumber(Q.record.data.b_last_rtp_from_end,window.time_precision_cdr_in_ms?3:0)):"",window.rtpQualityUse?"<tr><td>Lost packets<td>{a_lost}<td>{b_lost}<tr><td>MOS fixed 50<td>{a_mos_f1}<td>{b_mos_f1}<tr><td>MOS fixed 200<td>{a_mos_f2}<td>{b_mos_f2}<tr><td>MOS adaptive 500<td>{a_mos_adapt}<td>{b_mos_adapt}"+(existsMosXrCdr?"<tr><td>MOS XR (avg/min)<td>"+(Q.record.data.a_mos_xr*1||"&nbsp;")+"/"+(Q.record.data.a_mos_xr_min*1||"&nbsp;")+"<td>"+(Q.record.data.b_mos_xr*1||"&nbsp;")+"/"+(Q.record.data.b_mos_xr_min*1||"&nbsp;"):"")+(existsMosSilenceCdr?"<tr><td>MOS Silence (avg/min)<td>"+(Q.record.data.a_mos_silence*1||"&nbsp;")+"/"+(Q.record.data.a_mos_silence_min*1||"&nbsp;")+"<td>"+(Q.record.data.b_mos_silence*1||"&nbsp;")+"/"+(Q.record.data.b_mos_silence_min*1||"&nbsp;"):"")+(existsMosLqoCdr?"<tr><td>MOS LQO<td>"+(Q.record.data.a_mos_lqo*1||"&nbsp;")+"<td>"+(Q.record.data.b_mos_lqo*1||"&nbsp;"):"")+'<tr><td>Max RTP jitter<td>{a_maxjitter}<td>{b_maxjitter}<tr><td>Avg RTP jitter<td>{a_avgjitter}<td>{b_avgjitter}<tr><td>Max RTCP jitter<td>{a_rtcp_maxjitter}<td>{b_rtcp_maxjitter}<tr><td>Avg RTCP jitter<td>{a_rtcp_avgjitter}<td>{b_rtcp_avgjitter}<tr><td>Max RTCP &#37; loss<td>{a_rtcp_maxfr}<td>{b_rtcp_maxfr}<tr><td>Avg RTCP &#37; loss<td>{a_rtcp_avgfr}<td>{b_rtcp_avgfr}<tr><td>RTCP fraction lost pkts<td>{a_rtcp_fraclost_pktcount}<td>{b_rtcp_fraclost_pktcount}<tr><td data-qtip="'+findLangS("cdr","tooltip","maxRtd")+'">Max RTCP Rtd<td>{a_rtcp_maxrtd}<td>{b_rtcp_maxrtd}<tr><td data-qtip="'+findLangS("cdr","tooltip","avgRtd")+'">Avg RTCP Rtd<td>{a_rtcp_avgrtd}<td>{b_rtcp_avgrtd}<tr><td>PDV 50 - 70<td>{a_d50}<td>{b_d50}<tr><td>PDV 70 - 90<td>{a_d70}<td>{b_d70}<tr><td>PDV 90 - 120<td>{a_d90}<td>{b_d90}<tr><td>PDV 120 - 150<td>{a_d120}<td>{b_d120}<tr><td>PDV 150 - 200<td>{a_d150}<td>{b_d150}<tr><td>PDV 200 - 300<td>{a_d200}<td>{b_d200}<tr><td>PDV > 300<td>{a_d300}<td>{b_d300}<tr><td>&sum;&nbsp;PDV<td>{a_delay_sum}<td>{b_delay_sum}<tr><td data-qtip="'+findLangS("cdr","tooltip","xPDV")+'">x&#772;&nbsp;PDV<td>{a_delay_avg}<td>{b_delay_avg}<tr><td>1 loss in a row<td>{a_sl1}<td>{b_sl1}<tr><td>2 loss in a row<td>{a_sl2}<td>{b_sl2}<tr><td>3 loss in a row<td>{a_sl3}<td>{b_sl3}<tr><td>4 loss in a row<td>{a_sl4}<td>{b_sl4}<tr><td>5 loss in a row<td>{a_sl5}<td>{b_sl5}<tr><td>6 loss in a row<td>{a_sl6}<td>{b_sl6}<tr><td>7 loss in a row<td>{a_sl7}<td>{b_sl7}<tr><td>8 loss in a row<td>{a_sl8}<td>{b_sl8}<tr><td>9 loss in a row<td>{a_sl9}<td>{b_sl9}<tr><td>10 loss in a row<td>{a_sl10}<td>{b_sl10}'+b+L+E:"","</tr>","</table>",'</td><td style="vertical-align: top;">',n,'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;">','<thead><tr><th style="text-align: left;">CALL ID</th></tr></thead>',"<tbody><tr><td>",'<div style="width: '+J+'px; word-wrap: break-word; white-space: normal;">',"{fbasename_orig}","</div>","</td></tr></tbody>","</table>",y,A,g,T,window.rtpQualityUse?N:"",'<div style="height: 4px;">',"</td></tr>","</table>","</div>");
Ext.applyIf(Q,{title:this.findLangS("title","summaryTab"),html:p.applyTemplate(Q.record&&Q.record.data||{}),iconCls:"icon_table_lightning",listeners:{scope:this,resize:R,afterrender:function(){d();
if(window.rtpQualityUse){u()
}}}});
this.callParent([Q]);
var B=this;
function d(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getDynamicCdrContent",params:Ext.encode({panel:"summary",cdrId:Q.record.data.ID,calldate:Q.record.data.calldate})},success:function(aa){z(true,aa.sdp_caller);
z(false,aa.sdp_called)
}})
}function u(){l(CDR.Utils.rtpStreams_indexes(CDR.Utils.rtpStreams_ab(Q.record.data,W)),true)
}function l(ab,aa){Ext.defer(function(){CDR.RtcpChart.prepareRtcpData(Q.record.data,{streamsIndex:ab,onChartsConfig:function(ai,af){var al=CDR.Utils[aa?"rtpStreams_ab":"rtpStreams_next"](Q.record.data,W);
var ad=CDR.Utils.rtpStreams_indexes(al);
if(ad){for(var ah=0;
ah<ad.length;
ah++){q(ad[ah])
}}var ae=[];
if(ai){for(var ah in ai){if(Ext.isNumeric(ah)){var ag=ai[ah]._title==Q.record.data.calledrtp;
var ak="rtcp_chart_"+U(ah);
var ac=Ext.get(ak);
if(ac){ac.dom.innerHTML="";
new Ext.Panel({layout:"fit",items:ai[ah],border:false,renderTo:ak,height:P});
V(ah);
t();
ae.push(ah)
}}}}if(ad){for(var ah=0;
ah<ad.length;
ah++){if(!ae.isIn(ad[ah])){q(ad[ah])
}}}if(aa){var aj=CDR.Utils.rtpStreams_next(Q.record.data,W);
if(aj&&aj.length){l(CDR.Utils.rtpStreams_indexes(aj))
}}},onChartsConfigScope:this,silent:true})
},100,this)
}function R(){var ae=this.getWidth();
if(ae>0&&this.autoResize){for(var ab=0;
ab<W.length;
ab++){var ad=["rtp_chart","rtcp_chart"];
for(var aa=0;
aa<ad.length;
aa++){var ac=Ext.get(ad[aa]+"_"+U(W[ab].index));
if(ac){ac.setWidth(ae-360)
}}}}t()
}function t(){var ac="summary_panel_"+(Q.grid&&Q.grid.level||0)+"_"+Q.record.data.ID;
var ab=Ext.get(ac);
if(ab){var aa=ab.getHeight()+5;
if(aa&&aa!=B.getHeight()){B.setHeight(aa)
}}}function C(){for(var aa=0;
aa<W.length;
aa++){k(W[aa].index)
}}function k(ac){var ab="rtcp_chart_container_"+U(ac);
var aa=Ext.get(ab);
if(aa){aa.dom.style.visibility="hidden";
aa.dom.style.height=0
}}function q(ab){var ac="rtcp_chart_"+U(ab);
var aa=Ext.get(ac);
if(aa){aa.dom.innerHTML='<table cellspacing=0 cellpadding=0><tr><td style="vertical-align: middle; padding: 2px; padding-left: 4px;"><span>RTCP not found</span></table>'
}}function h(ab){var ac="rtcp_chart_"+U(ab);
var aa=Ext.get(ac);
if(aa){aa.dom.innerHTML=""
}}function I(){for(var aa=0;
aa<W.length;
aa++){V(W[aa].index)
}}function V(ac){var ab="rtcp_chart_container_"+U(ac);
var aa=Ext.get(ab);
if(aa){aa.dom.style.visibility="";
aa.dom.style.height=""
}}function z(ad,ac){var af="sdp_calle"+(ad?"d":"r")+"_container_"+(Q.grid&&Q.grid.level||0)+"_"+Q.record.data.ID;
var ae=Ext.get(af);
if(ae){var ab="";
if(ac&&ac.length){for(var aa=0;
aa<ac.length;
aa++){if(ab){ab+="<br>"
}ab+=ac[aa].ip+":"+ac[aa].port
}}ae.dom.innerHTML=ab
}}function F(af,aj){var ag=aj?("main "+(aj=="a"?"caller (a)":"called (b)")+" "):(af.flags&(1<<2)?"caller ":af.flags&(1<<3)?"called ":"");
var ai=ag.toUpperCase()+"RTP stream "+CDR.Utils.rtpStreamTextInfo(af,{packets:true,firsttime:true,duration:true,duration_miss_indic:true});
var ac=ag.toUpperCase()+"RTP stream "+CDR.Utils.rtpStreamTextInfo(af,{packets:true,firsttime:true,duration:true});
var ae=aj?"'"+aj+"'":af.index-1;
var ah=aj?aj:af.index-1;
var ad=(new Date).getTime()+"_"+af.index;
var aa=Q.record.data.ID;
return('<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;"><table cellspacing=0 cellpadding=0 style="width: 100%"><th style="text-align: left; padding: 0; text-transform: none;">'+ai+'<th style="text-align: right; padding: 0"><img style="cursor: pointer;" onClick="rtpStreamAnalysis({cdr_id: \''+aa+"',"+(af.ssrc?"ssrc: '"+af.ssrc+"',":"")+(af.saddr?"ip_src: '"+af.saddr+"',":"")+(af.daddr?"ip_dst: '"+af.daddr+"',":"")+(af.sport?"port_src: '"+af.sport+"',":"")+(af.dport?"port_dst: '"+af.dport+"',":"")+(af.index?"stream_index: '"+af.index+"',":"")+'})" src="images/icon/magnifier.png" data-qtip="'+findLangS("cdr","tooltip","rtpStreamAnalysis")+'"/></table></th></tr></thead><tbody><tr><td><div id="rtp_chart_'+U(af.index)+'" style="width: '+v+'px; overflow-x: scroll;"><img style="cursor: pointer;" onClick="showGraph('+aa+", "+ae+", '"+ac+'\')" src="php/lib/img.php?type=graph&id='+aa+"&srcdst="+ah+"&load_id="+ad+'" onload="getDebugLogForLoadId('+ad+')"/></div></td></tr></tbody></table><div id="rtcp_chart_container_'+U(af.index)+'" border="0" bordercolor="#C5C5C5" class="cdr_expand_table" style="border-top: 0px; margin-left: 4px;"><table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="border-top: hidden;"><tbody><tr><td><div id="rtcp_chart_'+U(af.index)+'" style="width: '+v+'px;"><table cellspacing=0 cellpadding=0><tr><td style="vertical-align: middle; padding: 2px;"><img src='+__extjs_images_path()+'grid/loading.gif><td style="vertical-align: middle; padding: 2px; padding-left: 5px;"><span>loading RTCP</span></table></div></td></tr></tbody></table></div>')
}function U(aa){return((Q.grid&&Q.grid.level||0)+"_"+Q.record.data.ID+"_"+aa)
}},doDownloadPcap:function(b,a,c){CDR.Utils.prepareDownloadPcapWav(b,{panel:this,fceSuccess:function(d){if(a){var f=new Tools.AuditForm({cdrId:b,activity:_AuditActivity_download_pcap,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(d,300)
},fceCancel:function(){unlinkPrepareFileHash(d)
},fceContinueScope:this});
f.audit()
}else{downloadPrepareFileHash(d)
}},disableRtp:c})
},doDownloadSound:function(b,a,c,d){var f=new Ext.menu.Menu({defaults:{handler:function(g){this.doDownloadWav(b,a,g._ogg)
},scope:this},items:[{text:"OGG",_ogg:true},{text:"WAV"}]});
f.showAtMouse(d)
},doDownloadWav:function(b,a,c){CDR.Utils.prepareDownloadPcapWav(b,{panel:this,fceSuccess:function(d){if(a){var f=new Tools.AuditForm({cdrId:b,activity:_AuditActivity_download_wav,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(d,300)
},fceCancel:function(){unlinkPrepareFileHash(d)
},fceContinueScope:this});
f.audit()
}else{downloadPrepareFileHash(d)
}},wav:c?"ogg":true})
},doDownloadOgg:function(b,a){this.doDownloadWav(b,a,true)
},doPlayFlashWavPlayer:function(b,c,a,d){CDR.Utils.doPlayFlashWavPlayer(b,{panel:this,expand:c,audit:a,event:d})
}});
Ext.define("CDR.SipHistoryPanel",{extend:"Ext.ux.grid.GridForm",alias:"widget.CDR_sipHistoryPanel",subsystem:"cdr",ip_port_separator:"&thinsp;:&thinsp;",constructor:function(c){var h=[];
a();
var d=0;
var b={};
this.widthIpColumn=31;
this.heightIpColumn=95;
this.verticalTextViaSvg=Ext.ieVersion>=11;
c=Ext.applyIf(c||{},{storeId:"CDR_tshark_"+c.cdrId,url:"php/pcap2text.php?action=brief_data&id="+c.cdrId+(c&&c.uniquekey?"&uniquekey="+c.uniquekey:""),recordStruct:rsCDR_tshark,sortField:"time",columns:this.getColumns(null,c),columnsDefaults:{sortable:false},stripeRows:false,disableInsertButton:true,disableEditButton:true,disableDeleteButton:true,fullColumnSize:"msg",fullColumnSizeDecrement:2,getRowClass:g,viewConfigListeners:{scope:this,itemmouseenter:this.onMouseEnter,itemmouseleave:this.onMouseLeave},enableColumnMove:false});
this.callParent([c]);
this.on("columnhide",this.onColumnHide,this);
this.on("columnshow",this.onColumnShow,this);
this.on("afterlayout",this.onAfterLayout,this);
this.store.on("load",this.onLoad,this);
function g(k,n,m,l){return(addBackgroundColorRuleToStyleSheet(rgbToHex(hsvToRgb(f(k.data.srcip,k.data.dstip),24,100)),"x-grid-cell"))
}function a(){var m=360;
var k=8;
var l=m/k;
while(h.length<1000){var o=parseInt(Math.random()*m);
for(var n=0;
n<k;
n++){hue=o+n*l;
if(hue>=m){hue-=m
}h.push(hue)
}}}function f(l,k){if(!Ext.isDefined(b[l+k])&&!Ext.isDefined(b[k+l])){b[l+k]=h[d];
if(d<h.length-1){++d
}else{d=0
}}return(Ext.isDefined(b[l+k])?b[l+k]:b[k+l])
}},getColumns:function(b,h){if(!h){h=this
}var d=[{headerLang:"time_s",dataIndex:"time",widthNum:10,align:"right",sortable:true,renderer:g,menuDisabled:true,height:this.heightIpColumn}];
if(this.columnsI&&this.columnsI.length){for(var c=0;
c<this.columnsI.length;
c++){d.push({header:this.columnsI[c],width:this.widthIpColumn,align:"left",sortable:false,columnI:this.columnsI[c],columnI_index:c,renderer:f,menuText:this.columnsI[c]+(this.hostnames[this.columnsI[c]]?" - "+this.hostnames[this.columnsI[c]]:""),menuDisabled:!h._enableIpColumnsHide})
}}else{d.push({dataIndex:"srcip",widthCh:14,menuDisabled:true},{dataIndex:"direction",widthCh:8,align:"center",menuDisabled:true},{dataIndex:"dstip",widthCh:14,menuDisabled:true})
}d.push({xtype:"actioncolumn",headerLang:"sipMsg",dataIndex:"msg",widthCh:80,rendererBase:a,items:[{getClass:function(k,l,m){return(m.data.type!="rtp"||m.data.rtp_received>2?"icon_magnifier":"icon_blank")
},handler:function(l,r,k,m,n){var p=l.store.getAt(r);
var q={id:this.cdrId,num:p.data.num,find_pass:p.data.find_pass,message:false,uniquekey:this.uniquekey,search:l.store.proxy.extraParams.search,type_packets:l.store.proxy.extraParams.type_packets,spec_type:p.data.spec_type};
if(p.data.type=="http_jj"){showHttp_jjDetail(q,"HTTP detail")
}else{if(p.data.type=="webrtc"){showWebrtcDetail(q,"WEBRTC detail")
}else{if(p.data.type=="enum_jj"){showPacketDetailEnum(q,this.findLangS("title","packetDetail"))
}else{if(p.data.type=="rtp"){if(p.data.rtp_received>2){var o=new Ext.menu.Menu({items:[{text:this.findLangS("menu","flowChart"),handler:function(){showGraph(p.data.cdr_ID,p.data.order,"Caller source RTP stream from IP: "+p.data.srcip)
},scope:this},{text:this.findLangS("menu","rtpStreamAnalysis"),handler:function(){rtpStreamAnalysis({cdr_id:p.data.cdr_ID,ssrc:p.data.rtp_ssrc,ip_src:p.data.srcip,ip_dst:p.data.dstip,port_src:p.data.srcport,port_dst:p.data.dstport,stream_index:p.data.index,maskEl:this})
},scope:this}]});
o.showAtMouse(n)
}}else{if(p.data.spec_type=="ss7"){q.id=p.data.src_id;
q.ss7=true
}if(p.data.txt_type){q.txt={time:p.data.txt_time,type:p.data.txt_type,cdr_ID:p.data.cdr_ID}
}showPacketDetail(q,this.findLangS("title","packetDetail"),false,p.data.spec_type=="ss7"||p.data.protocol&&(p.data.protocol.match(/SKINNY/)||p.data.protocol.match(/MGCP/)||p.data.protocol.match(/T38/)))
}}}}},enableHandler:function(n,o,p,q,k,m,l){return(p.data.type!="rtp"||p.data.rtp_received>2)
},scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20",menuDisabled:true,flex:h.flexMsg});
for(var c=0;
c<d.length;
c++){d[c].header=(d[c].headerLang||d[c].dataIndex)&&this.findLangS("column",d[c].headerLang||d[c].dataIndex)||d[c].header;
if(d[c].columnI){d[c].header=this.getHeaderIpText(d[c].columnI_index)
}}return(d);
function g(p,m,l,q,o,n,k){return(formatNumber(p,6))
}function a(q,l,n,o,t,s,p){l.style="padding-left: 2";
var r=null;
var u=null;
switch(n.data.type){case"sip":case"request":case"response":if(p.ownerCt.cdrRecordData&&(p.ownerCt.cdrRecordData.flags&(1<<10))&&n.data.protocol&&n.data.protocol.match&&n.data.protocol.match(/sip/i)){var k=null;
if(n.data.packet_len>0){k=n.data.packet_len
}else{if(n.data.msg&&n.data.msg.match){var m=n.data.msg.match(/ len:(\d+)/);
if(m&&m.length>=2&&m[1]>0){k=m[1]
}}}if(k>1500){r=findLangS("cdr","text","longSIPpacket")
}}break;
case"rtp":if(p.ownerCt.cdrRecordData&&n.data.flags&1&&(window.existsCdrRtpSport||window.existsCdrRtpDport)){r=findLangS("cdr","text","rtpStreamUsedInAnotherCall")+". "+findLangSd("clickForShowIt")+".";
u="Ext.getCmp('"+p.ownerCt.id+"').showCallsWithEqRtpStream('"+n.data.num+"');"
}break
}if(r||u){q='<table style="border: none; border-collapse: collapse; padding: 0; margin: 0;table-layout: fixed; font: '+__font_Grid+';"><tr><td>'+q+'<td><img src="images/icon/exclamation_yellow.png" style="'+(u?"cursor: pointer; ":"")+'margin-left: 6px; height: 14px;" '+(r?'data-qtip="'+r+'" ':"")+(u?'onClick="'+u+'" ':"")+"></table>"
}return(q)
}function f(w,l,p,u,z,y,v){columnWidth=31;
l.style="padding: 0";
var s=this.columnsI.indexOf(this.getSrcColumnInfo(p));
var r=this.columnsI.indexOf(this.getDstColumnInfo(p));
var k=s>r;
var t=k?r:s;
var q=k?s:r;
var o=p.data.type=="rtp"||p.data.type=="t38"?"red":p.data.type=="request"?"blue":"black";
var n=null;
var m=null;
if(z-1>t&&z-1<q){n="images/arrow2_"+columnWidth+"x21-SH-L-"+o+".png"
}else{if(z-1==t){n=k?"images/arrow2_"+columnWidth+"x21-SH-LT-"+o+".png":"images/arrow2_"+columnWidth+"x21-SH-RF-"+o+".png";
m=k?p.data.dstport:p.data.srcport
}else{if(z-1==q){n=k?"images/arrow2_"+columnWidth+"x21-SH-LF-"+o+".png":"images/arrow2_"+columnWidth+"x21-SH-RT-"+o+".png";
m=k?p.data.srcport:p.data.dstport
}else{n="images/arrow2_"+columnWidth+"x21-SH-B.png"
}}}w='<div style="background-image: url('+n+'); height: 20;">'+(m?'<table style="margin-left: auto; margin-right: auto;"><tr><td style="font-size: 50%; color: #707070;">'+m+"</td></tr></table>":"")+"</div>";
return(w)
}},onLoad:function(k,d,g,a){if(this._enableIpColumnsHide){var h=this.getWiresharkFilterCmp();
if(h){var c=h.getValue();
if(!c||c!=this.getColumnsWiresharkFilter(true)){delete this.hideIp
}}}this.ip_both_side=[];
this.columnsI=[];
this.ip=[];
this.hostnames=[];
if(d&&d.length){for(var f=0;
f<d.length;
f++){if(d[f].data.srcip==d[f].data.dstip&&!this.ip_both_side.isIn(d[f].data.srcip)){this.ip_both_side.push(d[f].data.srcip)
}}for(var f=0;
f<d.length;
f++){var b=this.getSrcColumnInfo(d[f]);
if(!this.columnsI.isIn(b)){this.columnsI.push(b)
}var l=this.getDstColumnInfo(d[f]);
if(!this.columnsI.isIn(l)){this.columnsI.push(l)
}if(!this.ip.isIn(d[f].data.srcip)){this.ip.push(d[f].data.srcip)
}if(!this.ip.isIn(d[f].data.dstip)){this.ip.push(d[f].data.dstip)
}}if(this.ip.length){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getHostnames",params:Ext.encode({ip:this.ip,cdr:true,dns_lookup:(!user.sqlrow||user.sqlrow.uc_enable_dns_cdr)})},success:function(m){this.hostnames=m.hostnames;
for(var o=0;
o<this.columnsI.length;
o++){var p=this.columnsI[o].indexOf(this.ip_port_separator);
if(p>0){var q=this.columnsI[o].substr(0,p);
var n=this.columnsI[o].substr(p+this.ip_port_separator.length);
if(this.hostnames[q]){this.hostnames[this.columnsI[o]]=this.hostnames[q]+this.ip_port_separator+n
}}}this.setGrid(k,d)
},maskEl:this,deferMask:true});
return
}}this.setGrid(k,d)
},setGrid:function(b,a){if(a&&a.length>30){this.setHeight(600);
this.fullColumnSizeDecrementScroller=true;
this.fullColumnSizeDecrement=0
}var c=this.getColumns(a);
this.setColumns(c);
this.adjustFullColumnSize()
},onAfterLayout:function(){this.headerCt.items.each(function(a){if(a.columnI){var c=a.el.down("div");
if(c){c.setStyle({padding:0,margin:0,width:this.widthIpColumn,height:this.heightIpColumn})
}var b=a.el.down("span");
if(b){b.setStyle({display:"block",padding:0,margin:0,width:this.widthIpColumn,height:this.heightIpColumn})
}}})
},getHeaderIpText:function(c,b){var a=this.columnsI[c];
if(!b){b="black"
}return(this.verticalTextViaSvg?'<table style="width:'+(this.widthIpColumn)+"; height: "+(this.heightIpColumn)+';"><tr><td style="width:'+(this.widthIpColumn)+"; height: "+(this.heightIpColumn)+';"><svg width="'+this.widthIpColumn+'" height="'+(this.heightIpColumn)+'">'+(this.hostnames&&this.hostnames[a]?'<text font-family="tahoma,arial,verdana,sans-serif" font-weight="normal" font-size="11px" style="fill:'+b+'" transform="translate('+(this.widthIpColumn-17)+","+(this.heightIpColumn-6)+')rotate(-90)">'+a+'</text><text font-family="tahoma,arial,verdana,sans-serif" font-weight="normal" font-size="10px" style="fill:'+b+'" transform="translate('+(this.widthIpColumn-6)+","+(this.heightIpColumn-6)+')rotate(-90)">'+this.hostnames[a]+"</text>":'<text font-family="tahoma,arial,verdana,sans-serif" font-weight="normal" font-size="11px" style="fill:'+b+'" transform="translate('+(this.widthIpColumn-8)+","+(this.heightIpColumn-6)+')rotate(-90)">'+a+"</text>")+"</td></tr></table>":(this.hostnames&&this.hostnames[a]?this._getHeaderIpText_ip_hostname(a,this.hostnames[a],b):this._getHeaderIpText_info(a,b)))
},_getHeaderIpText_info:function(d,b){var c=2;
var a=8;
return('<div style="-webkit-transform: rotate(-90deg);-moz-transform: rotate(-90deg); -o-transform: rotate(-90deg); margin-top: '+(this.heightIpColumn-this.widthIpColumn+a-c)+'px; white-space: nowrap;"><p style="padding: 0; margin: 0; text-align: center; width: '+(this.heightIpColumn)+"px; padding-left: "+(c)+"px; color: "+b+';">'+d+"</p></div>")
},_getHeaderIpText_ip_hostname:function(f,b,c){var d=2;
var a=-2;
return('<div style="-webkit-transform: rotate(-90deg);-moz-transform: rotate(-90deg); -o-transform: rotate(-90deg); margin-top: '+(this.heightIpColumn-this.widthIpColumn+a-d)+'px; white-space: nowrap;"><p style="padding: 0; margin: 0; text-align: center; width: '+(this.heightIpColumn)+"px; padding-left: "+(d)+"px; padding-right: "+(d)+"px; color: "+c+';">'+f+'</p><p style="padding: 0; margin: 0; text-align: center; width: '+(this.heightIpColumn)+"px; margin-top: -2px; padding-bottom: 1px; padding-left: "+(d)+"px; font-weight: bold; font-size: 90%; color: "+c+';">'+b+"</p></div>")
},setHeaderIpText:function(c,b){if(Ext.isString(c)&&this.columnsI){c=this.columnsI.indexOf(c);
if(c<0){return
}}var a=this.headerCt.items.get(c+1);
if(a){var d=a.el.down("span");
if(d){d.dom.innerHTML=this.getHeaderIpText(c,b)
}}},setHeaderSipMsg:function(a){var b=null;
for(var c=0;
c<this.headerCt.items.getCount();
c++){if(this.headerCt.items.get(c).dataIndex=="msg"){b=this.headerCt.items.get(c);
break
}}if(!b){return
}var d=b.el.down("span");
if(d){var f=this.findLangS("column","sipMsg");
if(a){f+='<table style="font: '+__font_Grid+'; margin-left: 5px;"><tr><td style="font-style: italic;">'+this.findLangS("column","srcip")+':</td><td style="padding-left: 10px;">'+a.data.srcip+(a.data.srcport?" : "+a.data.srcport:"")+'</td><td style="padding-left: 10px;">'+(this.hostnames&&this.hostnames[a.data.srcip]||"")+'</td></tr><tr><td style="font-style: italic;">'+this.findLangS("column","dstip")+':</td><td style="padding-left: 10px;">'+a.data.dstip+(a.data.dstport?" : "+a.data.dstport:"")+'</td><td style="padding-left: 10px;">'+(this.hostnames&&this.hostnames[a.data.dstip]||"")+"</td></tr></table>"
}d.dom.innerHTML=f
}},onMouseEnter:function(b,a){this.setHeaderIpText(a.data.srcip,"red");
this.setHeaderIpText(a.data.dstip,"red");
this.setHeaderSipMsg(a)
},onMouseLeave:function(b,a){this.setHeaderIpText(a.data.srcip,"black");
this.setHeaderIpText(a.data.dstip,"black");
this.setHeaderSipMsg()
},onColumnHide:function(b,a){if(this._enableIpColumnsHide&&a.columnI&&ip_is_valid(a.columnI)){if(!this.hideIp){this.hideIp={}
}this.hideIp[a.columnI]=true;
this.setWiresharkFilter()
}},onColumnShow:function(b,a){if(this._enableIpColumnsHide&&this.hideIp&&a.columnI&&ip_is_valid(a.columnI)){this.hideIp[a.columnI]=false;
delete this.hideIp[a.columnI];
this.setWiresharkFilter()
}},setWiresharkFilter:function(){var a=this.getWiresharkFilterCmp();
if(a){if(this.getColumnsWiresharkFilter()){if(!Ext.isDefined(this.wiresharkFilterBase)){this.wiresharkFilterBase=a.getValue()||""
}a.setValue(this.getColumnsWiresharkFilter(true));
a.onSearch()
}else{if(this.wiresharkFilterBase){a.setValue(this.wiresharkFilterBase);
a.onSearch()
}else{a.onClear()
}}}},getColumnsWiresharkFilter:function(a){var b=[];
for(var c in this.hideIp){b.push("not(ip.addr=="+c+")")
}ips=b.join(" and ");
if(b.lengt>1){ips="( "+ips+" )"
}if(a&&this.wiresharkFilterBase){ips=this.wiresharkFilterBase+" and "+ips
}return(ips)
},getWiresharkFilterCmp:function(){if(this.ownerCt&&this.ownerCt.ownerCt){var a=this.ownerCt.ownerCt;
var b=a.getTopToolbar&&a.getTopToolbar();
if(b){return(b.findC("name","filter"))
}}return(null)
},showCallsWithEqRtpStream:function(h){var b=null;
this.store.each(function(l){if(l.data.num==h){b=l
}});
if(b){var a=dateTimeStringToDate(this.cdrRecordData.calldate);
var d=dateTimeStringToDate(this.cdrRecordData.callend);
a.setTime(a.getTime()-5*60*1000);
d.setTime(d.getTime()+5*60*1000);
var k=b.data.srcip+":"+b.data.srcport+"\n"+b.data.dstip+":"+b.data.dstport;
var c={fdatefrom:a,fdateto:d,frtp_stream_used_in_another_call:true,frtp_ip_port_source:k};
var g=new CDR.Grid({extraParams:c,disableCharts:true,disableMenu:true,disablePagingToolbar:false,enableTbarRibbonDateFromTo:false,enableTbarRibbonFilterButton:false,enableTbarRibbonPaginator:false,loadAtInit:true,border:false});
var f=new Ext.Window({layout:"fit",items:g,width:Math.round(Ext.dom.Element.getViewportWidth()*7/8),height:Math.round(Ext.dom.Element.getViewportHeight()*7/8),modal:true,closable:true,maximizable:true});
f.show()
}},getSrcColumnInfo:function(a){return(a.data.srcip?(this.ip_both_side.isIn(a.data.srcip)?a.data.srcip+this.ip_port_separator+a.data.srcport:a.data.srcip):a.data.spec_type=="ss7"?a.data.ss7_opc:null)
},getDstColumnInfo:function(a){return(a.data.dstip?(this.ip_both_side.isIn(a.data.dstip)?a.data.dstip+this.ip_port_separator+a.data.dstport:a.data.dstip):a.data.spec_type=="ss7"?a.data.ss7_dpc:null)
}});
Ext.define("CDR.SipHistoryWithDiagramPanel",{extend:"Ext.Panel",subsystem:"cdr",constructor:function(g){this.origConfig=cloneObject(g||{});
this.sipHistory=new CDR.SipHistoryPanel(Ext.applyIf(g&&g.sipHistoryConfig||{},{cdrId:g.cdrId,cdrRecordData:g.cdrRecordData,border:false,extraParams:{search:g._search,type_packets:g._type_packets},listeners:{scope:this,afterrender:function(){if(!g.enableAutoLoadSipHistory){if(!g.autoOpenWindow&&!g.disableEmptyInfo){gridEmptyInfo(this.sipHistory)
}this.sipHistory.store.load()
}}},fullColumnSizeDecrement:g.forWindowWithoutBorder?2:0,fullColumnSizeDecrementScroller:g&&g.autoOpenWindow,enableAutoLoad:!!g.enableAutoLoadSipHistory,titleLang:g.disableTitle?undefined:"messagesTab",_enableIpColumnsHide:true,border:g.forWindowWithoutBorder&&g.disableTabPanel,style:g.forWindowWithoutBorder&&!g.disableTabPanel?__style_SubgridBorder():g.forPanel?__style_SubgridBorderTop():undefined}));
if(!g.disableEmptyInfo){this.sipHistory.store.on("load",function(t){gridEmptyInfo(this.sipHistory)
},this)
}else{if(g.disableSipHistoryIfEmpty){this.sipHistory.store.on("load",function(t){this.sipHistory.enableIf(t.getCount());
if(t.getCount()){this.sipHistory.unmask()
}},this)
}}if(!g.withoutDiagram){var d=(new Date).getTime();
this.diagramUrl="php/pcap2text.php?action=getMSC&id="+g.cdrId+(g.autoOpenWindow?"&undock=1":"")+(g.diagramConfig&&g.diagramConfig.uniquekey?"&uniquekey="+g.diagramConfig.uniquekey:"")+(!user.sqlrow||user.sqlrow.uc_enable_dns_cdr?"&dns_lookup=1":"")+"&load_id="+d;
this.diagram=new Ext.Panel({loader:{url:this.diagramUrl+(g._search?"&search="+encodeURIComponent(g._search):"")+(g._type_packets?"&type_packets="+encodeURIComponent(g._type_packets):""),loadMask:true,success:function(){if(this.height){delete this.height;
this.updateLayout()
}getDebugLogForLoadId(d)
}},border:false,overflowY:g&&(g.autoOpenWindow||g.enableScrollers)?"auto":undefined,overflowX:g&&(g.autoOpenWindow||g.enableScrollers)?"auto":undefined,title:this.findLangS("title","diagramTab"),listeners:{scope:this,afterrender:function(){Ext.defer(function(){this.diagram.ajaxSafeLoad()
},10,this)
}},height:50})
}var o=[this.sipHistory];
if(this.diagram){o.push(this.diagram)
}this.sipHistoryWithDiagramContainer=g.disableTabPanel?new Ext.Panel({layout:"fit",border:false,items:o}):new Ext.TabPanel({activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,items:o,cls:g.forWindowWithoutBorder?"frame_window-background-color":"panel-background-color",style:{"background-color":g.forWindowWithoutBorder?undefined:"#EFEFEF"},tabBar:{renderTpl:__tpl_simplyTabPanel}});
var m=[];
if(!g.disableTbar){m.push({xtype:"button",iconCls:"icon_reload",handler:function(){this.sipHistory.reload();
if(this.diagram){this.diagram.loader.load()
}},scope:this},{xtype:"displayfield",fieldCls:"x-form-item-label",fieldStyle:{paddingTop:0,marginTop:-1,color:"chocolate"},_id:"reload_info"},"-");
if(!g.autoOpenWindow&&!g.disableUndock){m.push({text:this.findLangS("button","undock"),scope:this,handler:b},"-")
}m.push({xtype:"displayfield",value:this.findLangS("button","wiresharkFilter")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",name:"filter",value:g._search,_gridForm:this,_buttonGroup:true,onChangeValue:h,scope:this,width:__width_ColumnChar(35)});
m.push({xtype:"displayfield",value:this.findLangS("button","typePackets")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",name:"type_packets",value:g._type_packets||"ALL",_gridForm:this,_buttonGroup:true,multiSelect:true,aData:[["sip","sip"],["rtp","rtp"],["http","http"],["web","web"],["ss7","ss7"]],textAliasAll:"ALL",_arraySeparator:",",_stringValue:true,listeners:{select:function(t){n.call(this,t.getValue())
},scope:this},width:__width_ColumnChar(15)});
if(user_can_pcap()){m.push("-",{text:this.findLangS("button","downloadPCAP"),iconCls:"icon_save",scope:this,handler:k})
}if(window.enableSvgPaint&&!g.disableSvgPaint){m.push("-",{text:this.findLangS("button","prepareSvgDiagram"),scope:this,handler:f})
}m.push({xtype:"button",text:this.findLangS("button","exportSipHistory"),scope:this,menu:{defaults:{scope:this},items:[{text:this.findLangS("menu","exportSipHistoryTxtPkt"),handler:l},{text:this.findLangS("menu","exportSipHistoryDiagramView"),handler:a}]}})
}g=Ext.applyIf(g,{border:false,tbar:g.disableTbar||!m.length?undefined:m,layout:"fit",items:[this.sipHistoryWithDiagramContainer],listeners:{scope:this,destroy:function(){if(this._mergeParams&&this._mergeParams.uniquekey){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"deleteMergeData",params:Ext.encode({uniquekey:this._mergeParams.uniquekey})}})
}}}});
this.callParent([g]);
if(this.autoOpenWindow){this.openWindow()
}function b(){var t=cloneObject(this.origConfig);
t.autoOpenWindow=true;
t.windowTitle=t.title;
t.style=null;
t.title=null;
t._search=q.call(this);
t._type_packets=s.call(this);
t.enableAutoLoadSipHistory=false;
t.wikiId=null;
new CDR.SipHistoryWithDiagramPanel(t)
}function h(t){this.sipHistory.setExtraParams({search:t},true);
c.call(this)
}function n(t){this.sipHistory.setExtraParams({type_packets:t},true);
c.call(this)
}function c(){if(this.diagram){this.diagram.loader.url=this.diagramUrl+(this.sipHistory.store.proxy.extraParams.search?"&search="+encodeURIComponent(this.sipHistory.store.proxy.extraParams.search):"")+(this.sipHistory.store.proxy.extraParams.type_packets?"&type_packets="+encodeURIComponent(this.sipHistory.store.proxy.extraParams.type_packets):"");
this.diagram.loader.load()
}}function q(){var t=this.getTopToolbar();
if(t){filterField=t.findC("name","filter");
if(filterField){return(filterField.getValue())
}}}function s(){var t=this.getTopToolbar();
if(t){typePacketsField=t.findC("name","type_packets");
if(typePacketsField){return(typePacketsField.getValue())
}}}function k(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getUserCanAudit"},success:function(t){r.call(this,t.can_audit)
}})
}function r(t){if(t){var u=new Tools.AuditForm({cdrId:this.cdrId=="multi"&&this._mergeParams&&this._mergeParams.selectedId&&this._mergeParams.selectedId.length?this._mergeParams.selectedId:this.cdrId,activity:_AuditActivity_download_pcap,autoAudit:t==2,mergeParams:this._mergeParams,fceContinue:function(v){p.call(this,v)
},fceContinueScope:this});
u.audit()
}else{p.call(this)
}}function p(t){if(this._mergeParams){Tools.Pcaps.mergePcap(Ext.apply(cloneObject(this._mergeParams),{search:q.call(this),type_packets:s.call(this),audit_log_id:t,downloadPcap:true,onSuccess:function(u){downloadPrepareFileHash(u)
},onSuccessScope:this,maskElId:this.id}))
}else{CDR.Utils.prepareDownloadPcapWav(this.cdrId,{panel:this,search:q.call(this),type_packets:s.call(this)})
}}function a(){var t={cdrid:g.cdrId};
if(this._mergeParams&&this._mergeParams.uniquekey){t.uniquekey=this._mergeParams.uniquekey
}formPostSafe("php/pcap2text.php","POST",{action:"savesipdiagram",params:Ext.encode(t)})
}function l(){var w=[];
var v=/SIP/;
var u;
this.sipHistory.store.each(function(z){if(v.test(z.data.protocol)){w.push(z.data.num);
if(!u){u=z.data.spec_type
}}});
var t=(g.cdrRecordData&&g.cdrRecordData.caller)?g.cdrRecordData.caller:"";
var y={cdrid:g.cdrId,caller:t,pktnums:w.join()};
if(u!=""){y.spec_type=u
}if(this._mergeParams&&this._mergeParams.uniquekey){y.uniquekey=this._mergeParams.uniquekey
}formPostSafe("php/pcap2text.php","POST",{action:"detailsipallraw",params:Ext.encode(y)})
}function f(){var y=[];
this.sipHistory.store.each(function(z){y.push({srcip:z.data.srcip,srcport:z.data.srcport,dstip:z.data.dstip,dstport:z.data.dstport,protocol:z.data.protocol,type:z.data.type})
});
var w=new SvgPaint.Panel({id_autosuffix:true,titleLang:null,iconCls:null,border:false});
var u=Math.min(1280,Ext.dom.Element.getViewportWidth()-20);
var t=Ext.dom.Element.getViewportHeight()-30;
var v=new Ext.Window({title:findLangS("svg_paint","title","panel"),iconCls:"icon_computers",closable:true,maximizable:true,resizable:true,layout:"fit",items:w,width:u,height:t});
v.show();
w.createNewPaintFromData({typeData:"sip_history",data:{data:y,ip:this.sipHistory.ip,hostnames:this.sipHistory.hostnames}})
}},openWindow:function(){var b=Math.min(1280,Ext.dom.Element.getViewportWidth()-20);
var a=Ext.dom.Element.getViewportHeight()-30;
var c=new Ext.Window({title:this.windowTitle,closable:true,maximizable:true,resizable:true,layout:"fit",items:this,width:b,height:a,wikiId:"Call_Detail_Record_-_CDR#SIP:history",listeners:{activate:function(){c.focus()
}}});
c.show()
},setReloadInfo:function(a){var b=this.getTopToolbar().findC("_id","reload_info");
if(b){b.setValue(a)
}}});
Ext.define("CDR.Note.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"cdr",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"CdrNoteStore",url:"php/model/sql.php",module:"cdr_note",recordStruct:rsCdrNote,sortField:"created_at",remoteSort:true,columns:[{dataIndex:"created_at",widthCh:12,renderer:c},{dataIndex:"created_name",widthCh:15},{dataIndex:"note",widthCh:100,renderer:b}],fullColumnSize:"note",fullColumnSizeDecrement:2,fpDefaults:{xtype:"textfield",widthCh:50,labelCh:12},fpItems:function(g,f){var d=[{xtype:"textarea",name:"note",allowBlank:false,heightL:10}];
if(f){d.push({xtype:"filefield",name:"file",buttonText:this.findLangS("button","selectFile")})
}return(d)
},propRecordText:function(d){return(d.note.substr(0,20))
},enableEdit:true,enableSearchX:false,subjectLang:"note",hideHeaders:false,stripeRows:false,fileField:"attachment"});
this.callParent([a]);
if(this.autoIcon){this.store.on("load",function(d){this.setIconCls(d.getCount()?"icon_note":"icon_note_empty")
},this)
}function c(l,g,f,m,k,h,d){return(Ext.Date.format(l,__format_DateDb)+"<br>"+Ext.Date.format(l,__format_TimeDb))
}function b(n,f,h,l,p,o,m){var k="";
if(h.data.attachment_name&&h.data.attachment_th_size&&m){var d=m.ownerCt;
k+='<a href="#" gridid="'+d.id+'" recordid="'+h.data.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).openAttachment(this.attributes.recordid.nodeValue);"><img src="'+getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"cdr_note",id:h.data.id,thumbnail:true})+'" align="right" hspace="5" vspace="5" gridid="'+d.id+'" onload="Ext.getCmp(this.attributes.gridid.nodeValue).updateLayout();"></a>'
}if(h.data.note){k+='<div style="white-space: normal;">'+h.data.note.replaceall("\n","<br>")+"</div>"
}if(h.data.attachment_name){k+="<div>"+this.findLangS("text","attachedFile")+":&nbsp;<b>"+getLinkUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"cdr_note",id:h.data.id},false)+h.data.attachment_name+"</a></b></div>"
}if(h.data.changed_name||h.data.chenged_at){var g=(h.data.changed_name||"")+(h.data.changed_at?(h.data.changed_name?" - ":"")+Ext.Date.format(h.data.changed_at,__format_DateTime):"");
if(g){k+='<div style="font-size: 80%; text-align: right;"><i>'+this.findLangS("text","lastModifiedBy")+": <b>"+g+"</b></i></div>"
}}return(k)
}},isEnableEditRecord:function(a){return(user_is_admin()||user_id()===a.data.created_uid)
},isEnableDeleteRecord:function(a){return(user_is_admin()||user_id()===a.data.created_uid)
},openAttachment:function(b){var a=this.store.getById(b*1);
if(!a){return
}openAttachment(a,"cdr_note")
},onChangeRecords:function(a,b,c){if(this.cdrGrid){this.cdrGrid.panel.reloadRecord(this.cdrRecord,["note"])
}if(this.autoIcon){this.setIconCls(this.store.getCount()?"icon_note":"icon_note_empty")
}}});
Ext.define("CDR.ChartsPanel",{extend:"Ext.Panel",alias:"widget.CDR_chartsPanel",subsystem:"cdr",constructor:function(b){var d=[];
if(!b.disableTbar){d.push({xtype:"displayfield",value:this.findLangS("field","interval")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",name:"interval",value:"last_24h",editable:false,aData:arTimeIntervals,_buttonGroup:true,width:__width_ColumnChar(25),listeners:{scope:this,select:f}},{xtype:"displayfield",value:this.findLangS("field","filter")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",name:"filter",value:_cdrFieldsCaller,editable:false,aData:arCdrFields_forCdrCharts,_buttonGroup:true,width:__width_ColumnChar(20),listeners:{scope:this,select:f}},{xtype:"displayfield",value:this.findLangS("field","direction")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",name:"side",value:_cdrSide_Both,editable:false,aData:{data:arCdrSideCharts,fields:["id_numb","id_str","descr"]},valueField:"id_str",displayField:"descr",_buttonGroup:true,width:__width_ColumnChar(20),listeners:{scope:this,select:f}},{text:this.findLangS("button","applyFilterToParentTable"),iconCls:"icon_find",scope:this,handler:a})
}this.chartBar=new Ext.tab.Bar({dock:"top",plain:true,border:false,bodyBorder:false,style:{"background-color":__color_PanelBackgroud},listeners:{scope:this,change:h},renderTpl:__tpl_simplyTabPanel});
var k=this.getChartBarItems(b,b.charts);
for(var g=0;
g<k.length;
g++){this.chartBar.add(k[g])
}this.contentContainer=new Ext.Panel({layout:"fit",border:false,tbar:d.length?d:undefined,flex:b.flexContainer?1:undefined,disabled:true});
var m=[{xtype:"container",items:this.chartBar,height:24,style:{"background-color":b.tabBackgroundColor||__color_PanelBackgroud}},this.contentContainer];
this.chartContainer=new Ext.Panel({layout:"fit",border:false,hidden:true});
if(!b.disableFilteredCdr){this.filteredCdrTable=new CDR.Grid({layout:"fit",disableCharts:true,disableMenu:true,pageSize:15,loadAtInit:false,disableAutoLoad:true,border:false,level:2,decWidthTable:29,hidden:true});
this.filteredCdrTable.grid.store.on("load",function(){gridEmptyInfo(this.filteredCdrTable.grid)
},this)
}if(!b.disableRtcpChart){this.rtcpChart=new Ext.TabPanel({layout:"fit",border:false,plain:true,bodyBorder:false,cls:"panel-background-color",height:this.flexContainer?undefined:500,hidden:true,activeTab:0,tabBar:{renderTpl:__tpl_simplyTabPanel}})
}b=Ext.applyIf(b||{},{layout:{type:"vbox",align:"stretch"},items:m,border:false,listeners:{scope:this,activate:c,afterrender:l}});
if(!b.disableTitle){Ext.applyIf(b,{title:this.findLangS("title","chartsTab"),iconCls:"icon_menu_diag_system"})
}this.callParent([b]);
function c(){if(!this.firstActivate){Ext.defer(function(){this.chartBar.setActiveTab(this.chartBar.items.get(0))
},50,this);
if(!this.disableRtcpChart){Ext.defer(function(){CDR.RtcpChart.prepareRtcpData(this.cdrRecord,{onChartsConfig:function(o,n){if(!o){return
}for(var p=0;
p<2;
p++){var q=CDR.Utils.rtpStream_ab(n,p==0?"a":"b");
if(q&&o[q.index]){this.rtcpChart.add({layout:"fit",items:o[q.index],title:(p==0?"A":"B")+" "+CDR.Utils.rtpStreamTextInfo(q),border:false});
this.rtcpChart.show()
}}var r=CDR.Utils.rtpStreams_next(n);
if(r){for(var p=0;
p<r.length;
p++){if(o[r[p].index]){this.rtcpChart.add({layout:"fit",items:o[r[p].index],title:CDR.Utils.rtpStreamTextInfo(r[p]),border:false})
}this.rtcpChart.show()
}}if(this.rtcpChart.items.length){this.rtcpChart.setActiveTab(this.rtcpChart.items.get(0));
this.chartBar.findC("_rtcpChart",true).show()
}},onChartsConfigScope:this,silent:true});
this.existsRtcpCharts=true
},250,this)
}this.firstActivate=true
}}function l(){if(this.callOnActivateAfterRender){c.call(this)
}}function h(n,o){this.selectChartTab=o;
f.call(this)
}function f(){if(!this.selectChartTab){return
}if(this.selectChartTab._chart){this.createChart()
}else{if(this.selectChartTab._rtcpChart){this.showRtcpChart()
}else{if(this.selectChartTab._filteredCdr){this.showFilteredCdr()
}else{if(this.selectChartTab._settingChartConfig){this.showSettingChartConfig()
}}}}}function a(){this.parentGrid.panel.clearFormFilter();
this.parentGrid.panel.setCustomFilter(this.getFilter(true),null,true)
}},getChartBarItems:function(b,a,f){var d=[];
for(var c=0;
c<a.length;
c++){d.push({text:b.charts[c].name,closable:false,_chart:b.charts[c]})
}if(!Ext.isDefined(f)||f){d.push({text:this.findLangS("title","rtcpChartTabChart"),closable:false,_rtcpChart:true,hidden:!Ext.isDefined(f)})
}if(!b.disableFilteredCdr){d.push({text:this.findLangS("button","filteredCdr"),iconCls:"icon_menu_cdr",closable:false,_filteredCdr:true})
}if(user_is_admin()){d.push({text:this.findLangS("title","settingChartsTab"),iconCls:"icon_wrench",closable:false,_settingChartConfig:true})
}return(d)
},prepareForTypeItem:function(a){this.contentContainer.enable();
this.contentContainer.unmask();
if(this.contentContainer.typeItem!=a){if(a!="chart"){if(this.chartContainer){this.chartContainer.hide();
this.chartContainer.removeAll(true);
this.chartPanel=null
}}if(a!="cdr"){if(this.filteredCdrTable){this.filteredCdrTable.hide()
}}if(a!="rtcp_chart"){if(this.rtcpChart){this.rtcpChart.hide()
}}if(a!="chart_config"){if(this.settingChartConfig){this.settingChartConfig.hide();
this.settingChartConfig.destroy();
this.settingChartConfig=null
}}this.contentContainer.removeAll(false);
switch(a){case"chart":this.showTopToolbar();
this.contentContainer.add(this.chartContainer);
this.chartContainer.show();
break;
case"cdr":this.showTopToolbar();
this.contentContainer.add(this.filteredCdrTable);
this.filteredCdrTable.show();
break;
case"rtcp_chart":this.hideTopToolbar();
this.contentContainer.add(this.rtcpChart);
this.rtcpChart.show();
break;
case"chart_config":this.hideTopToolbar();
if(this.settingChartConfig){this.contentContainer.add(this.settingChartConfig);
this.settingChartConfig.show()
}break
}this.contentContainer.typeItem=a
}},createChart:function(){this.prepareForTypeItem("chart");
var a=this.getChartConfig();
if(a){if(!this.chartPanel){var b=this.chartPanelConfig?cloneObject(this.chartPanelConfig):{};
Ext.applyIf(b,{_enableBtnRemove:false,_disableAlertInvalidQuery:true,height:this.flexContainer?undefined:500});
this.chartPanel=new CDR.Chart.ChartPanel(b);
this.chartContainer.removeAll(true);
this.chartContainer.add(this.chartPanel)
}this.chartPanel.unmask();
this.chartPanel.loadChart(a,false,{fceInvalidQuery:this.onInvalidQuery,fceInvalidQueryScope:this})
}},reloadChart:function(b){if(!this.chartPanel){return
}if(b){Ext.apply(this,b)
}var a=this.getChartConfig();
if(a){this.chartPanel.loadChart(a,false,{fceInvalidQuery:this.onInvalidQuery,fceInvalidQueryScope:this})
}},showRtcpChart:function(){this.prepareForTypeItem("rtcp_chart")
},showFilteredCdr:function(){this.prepareForTypeItem("cdr");
this.filteredCdrTable.clearFormFilter();
this.filteredCdrTable.setCustomFilter(this.getFilter(true),null,true)
},showSettingChartConfig:function(){this.prepareForTypeItem("chart_config");
if(!this.settingChartConfig){var a=this;
this.settingChartConfig=new Settings.CdrCharts.Grid({onChangeRecords:function(){a.evChangeChartsConfig()
}});
this.contentContainer.add(this.settingChartConfig)
}},onInvalidQuery:function(){this.chartContainer.removeAll(true);
this.chartPanel=null;
this.chartContainer.add({layout:{type:"vbox",align:"center",pack:"center"},border:false,items:{xtype:"displayfield",value:CDR.Chart.ChartPanel.prototype.LmsgInvalidQueryDescr,fieldStyle:{"font-weight":"bold","font-size":"120%"}},height:100})
},getChartConfig:function(){if(!this.selectChartTab){return
}if(!this.filters){var a=this.getComboParams();
if(!a.interval||!a.filterField||!a.filterSide){return(null)
}}chartConfig=Ext.decode(this.selectChartTab._chart.config_chart);
if(this.filters||this.dateFrom||this.dateTo){chartConfig.dateFrom=this.dateFrom;
chartConfig.dateTo=this.dateTo;
chartConfig.filters=this.filters
}else{var b=getTimeInterval(a.interval);
chartConfig.typeTimeInterval=a.interval;
chartConfig.dateFrom=b[0];
chartConfig.dateTo=b[1];
chartConfig.filters=this.getFilter(false)
}chartConfig._title=this.selectChartTab._chart.name;
return(chartConfig)
},getFilter:function(d){if(this.filters){return(filters)
}var c={};
var a=this.getComboParams();
if(!a.interval||!a.filterField||!a.filterSide){return(c)
}if(d){var b=getTimeInterval(a.interval);
chartConfig.typeTimeInterval=a.interval;
c.fdatefrom=b[0];
c.fdateto=b[1]
}switch(a.filterField){case _cdrFieldsCaller:if(a.filterSide==_cdrSide_Dst){c.fcalled=this.cdrRecord.caller
}else{c.fcaller=this.cdrRecord.caller
}c.fcallerd_type=a.filterSide==_cdrSide_Both?0:1;
break;
case _cdrFieldsCalled:if(a.filterSide==_cdrSide_Dst){c.fcalled=this.cdrRecord.called
}else{c.fcaller=this.cdrRecord.called
}c.fcallerd_type=a.filterSide==_cdrSide_Both?0:1;
break;
case _cdrFieldsSipIpSrc:if(a.filterSide==_cdrSide_Dst){c.fsipcalledip=this.cdrRecord.sipcallerip
}else{c.fsipcallerip=this.cdrRecord.sipcallerip
}c.fsipcallerdip_type=a.filterSide==_cdrSide_Both?0:1;
break;
case _cdrFieldsSipIpDst:if(a.filterSide==_cdrSide_Dst){c.fsipcalledip=this.cdrRecord.sipcalledip
}else{c.fsipcallerip=this.cdrRecord.sipcalledip
}c.fsipcallerdip_type=a.filterSide==_cdrSide_Both?0:1;
break;
case _cdrFieldsRtpIpSrc:if(a.filterSide==_cdrSide_Dst){c.fb_saddr=this.cdrRecord.callerrtp
}else{c.fa_saddr=this.cdrRecord.callerrtp
}c.fab_saddr_type=a.filterSide==_cdrSide_Both?0:1;
break;
case _cdrFieldsRtpIpDst:if(a.filterSide==_cdrSide_Dst){c.fb_saddr=this.cdrRecord.calledrtp
}else{c.fa_saddr=this.cdrRecord.calledrtp
}c.fab_saddr_type=a.filterSide==_cdrSide_Both?0:1;
break
}return(c)
},getComboParams:function(){if(this.disableTbar){return({})
}var c=this.contentContainer.getTopToolbar();
if(!c){return({})
}var b=c.find("name","interval")[0];
var a=c.find("name","filter")[0];
var d=c.find("name","side")[0];
return({interval:b.getValue(),filterField:a.getValue(),filterSide:d.getValue()})
},showTopToolbar:function(){if(!this.disableTbar){var a=this.contentContainer.getTopToolbar();
if(a){if(this.contentContainer.toolbarHeight){a.setHeight(this.contentContainer.toolbarHeight)
}if(a&&a.items){a.items.each(function(b){b.enable()
})
}a.show()
}}},hideTopToolbar:function(){if(!this.disableTbar){var a=this.contentContainer.getTopToolbar();
if(a){if(!this.contentContainer.toolbarHeight){this.contentContainer.toolbarHeight=a.getHeight()
}a.setHeight(0);
a.hide()
}}},evChangeChartsConfig:function(b){if(!b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrCharts"},success:function(d){this.evChangeChartsConfig(d.charts)
}});
return
}this.charts=b;
var a=this.getChartBarItems(this,this.charts,this.existsRtcpCharts?true:false);
while(this.chartBar.items.get(0)._chart){this.chartBar.remove(this.chartBar.items.get(0))
}for(var c=a.length-1;
c>=0;
c--){if(a[c]._chart){this.chartBar.insert(0,a[c])
}}}});
Ext.define("CDR.RtcpChart",{singleton:true,subsystem:"cdr",prepareRtcpData:function(a,b){if(!b){b={}
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"prepareDataForRtcpChart",params:Ext.encode({id:a.ID,streamsIndex:b.streamsIndex})},success:function(c){if(!isDataEmpty(c)){if(b.onPrepare){b.onPrepare.call(b.onPrepareScope,c)
}else{var d=this.createRtcpChartsConfig(a,c);
if(b.onChartsConfig){b.onChartsConfig.call(b.onChartsConfigScope,d,a)
}else{this.showRtcpCharts(d,a)
}}}else{if(b.onPrepare){b.onPrepare.call(b.onPrepareScope,null)
}if(b.onChartsConfig){b.onChartsConfig.call(b.onChartsConfigScope,null,a)
}if(!b.silent){Ext.Msg.alert(findLangS(this.subsystem,"title","rtcpChart"),findLangS(this.subsystem,"text","selectedCdrDoesNotContainRtcpData"))
}}},error:function(c,d,f){if(!b.silent){alertAjaxError(d)
}},maskEl:b.maskEl,timeout:5*60*1000})
},createRtcpChartsConfig:function(a,f){var h=[];
for(var g in f){if(Ext.isNumeric(g)&&f[g].length){var l=CDR.Utils.getRtpStreamByIndex(a,g);
var k=new Ext.data.JsonStore({data:f[g],fields:[{name:"timestamp",type:"float"},{name:"jitter",type:"float"},{name:"fraction",type:"float"}]});
var b=[{type:"numeric",position:"left",fields:"jitter",title:"jitter [ms]",grid:true,gridColor:"#FFEBEB",minimum:0},{type:"numeric",position:"right",fields:"fraction",title:"packet loss [%]",grid:true,gridColor:"#EBEBFF",minimum:0},{type:"numeric",position:"bottom",fields:"timestamp",title:l?"RTCP from "+l.saddr+" / time":"RTCP / time",grid:true,gridColor:"#EBEBEB",minimum:0}];
var c=[{title:"jitter",axis:"left",yField:"jitter",_color:"red"},{title:"packet loss (fraction lost)",axis:"right",yField:"fraction",_color:"blue"}];
for(var d=0;
d<c.length;
d++){Ext.apply(c[d],{type:"line",xField:"timestamp",smooth:true,style:{stroke:c[d]._color,lineWidth:2},marker:{type:"circle",size:2,radius:2,stroke:c[d]._color,fill:c[d]._color},tips:{trackMouse:true,width:120,height:35,renderer:function(p,o,n){var m=n.series._yField;
var q=n.series._title;
if(m&&q){tipTitle="";
tipTitle="<b><i>"+q+"</i></b><br>";
tipTitle+=roundNumber(o.get(m),3);
p.setTitle(tipTitle)
}}}})
}h[g]={xtype:"cartesian",store:k,axes:b,series:c,legend:{docked:"bottom",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:2},background:{fill:"white"},border:false,theme:"CdrChart",insetPadding:4}
}}return(h)
},showRtcpCharts:function(c,a){if(!c||!c.length){Ext.Msg.alert("",findLangS(this.subsystem,"text","chartIsNotAvailable"));
return
}var b=[];
for(var d=0;
d<2;
d++){var f=CDR.Utils.rtpStream_ab(a,d==0?"a":"b");
if(f&&c[f.index]){b.push({layout:"fit",items:c[f.index],title:(d==0?"A":"B")+" "+CDR.Utils.rtpStreamTextInfo(f),border:false})
}}var h=CDR.Utils.rtpStreams_next(a);
if(h){for(var d=0;
d<h.length;
d++){if(c[h[d].index]){b.push({layout:"fit",items:c[h[d].index],title:CDR.Utils.rtpStreamTextInfo(h[d]),border:false})
}}}var g=new Ext.Window({iconCls:"icon_menu_diag_system",title:findLangS(this.subsystem,"title","rtcpChart"),closable:true,resizable:true,maximizable:true,layout:"fit",items:{xtype:"tabpanel",items:b,border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},border:false,width:Math.min(Ext.dom.Element.getViewportWidth()*9/10,800),height:Math.min(Ext.dom.Element.getViewportHeight()*9/10,640)});
g.show()
}});
Ext.define("CDR.GridExpPanel",{extend:"Ext.Panel",subsystem:"cdr",constructor:function(B){this.tabPanel=new Ext.TabPanel({items:{xtype:"CDR_summaryPanel",border:false,record:B.record,grid:B.grid,widthExpArea:B.widthExpArea,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},wikiId:"Call_Detail_Record_-_CDR#Summary"},activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:B.grid.prefixCls+"-cell expander-area-panel",listeners:{scope:this,afterrender:function(){setWikiInTab(this.tabPanel,this.tabPanel.getActiveTab())
},tabchange:function(D,C,E){setWikiInTab(this.tabPanel,C,E)
}},tabBar:{renderTpl:__tpl_simplyTabPanel}});
this.sipHistoryWithChart=new CDR.SipHistoryWithDiagramPanel({cdrId:B.record.data.ID,cdrRecordData:B.record.data,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","sipHistoryTab"),enableAutoLoadSipHistory:true,disableSvgPaint:B.grid.panel&&B.grid.panel.disableSvgPaint,wikiId:"Call_Detail_Record_-_CDR#SIP:history"});
this.sipHistoryWithChart.sipHistory.store.on("load",function(C){if(C.proxy.reader.rawData&&C.proxy.reader.rawData.errors&&(C.proxy.reader.rawData.errors.missingPcapInTar||C.proxy.reader.rawData.errors.snifferError)){this.sipHistoryWithChart.setIconCls("icon_light_switch");
this.sipHistoryWithChart.setReloadInfo(C.proxy.reader.rawData.errors.snifferError||(C.proxy.reader.rawData.errors.missingPcapInTar?this.findLangS("text","dataAreNotYetWrittenToDisk"):lang.alertAjaxErrorMsgUnknown))
}else{if(C.getCount()>0){this.sipHistoryWithChart.setIconCls("icon_light_on");
this.sipHistoryWithChart.setReloadInfo("")
}else{this.sipHistoryWithChart.setIconCls("icon_light_off");
this.sipHistoryWithChart.setReloadInfo("")
}}},this);
this.tabPanel.add(this.sipHistoryWithChart);
if((!B.grid.level||B.grid.level<2)&&(!B.grid.panel||!B.grid.panel.disableLegs)){var k=[];
if(user_can_pcap()){k.push({text:this.findLangS("menu","mergeSipPcap"),scope:this,handler:function(){this.similarCDR.onMergePcapSipHistory("pcap",B.record.data.ID,"filter")
}});
if(!user_no_rtp()){k.push({text:this.findLangS("menu","mergeSipRtpPcap"),scope:this,handler:function(){this.similarCDR.onMergePcapSipHistory("pcaprtp",B.record.data.ID,"filter")
}})
}}k.push({text:this.findLangS("menu","mergeSipHistory"),scope:this,handler:function(){this.similarCDR.onMergePcapSipHistory("sip_history",B.record.data.ID,"filter")
}});
var d=(B.record.data.caller||"").removeTags();
if(d.length>6){d=d.substr(d.length-6)
}if(d.length){d="[%"+d+"]"
}var p=(B.record.data.called||"").removeTags();
if(p.length>6){p=p.substr(p.length-6)
}if(p.length){p="[%"+p+"]"
}var u=[{xtype:"displayfield",value:this.findLangS("field","searchInterval_s"),fieldCls:"x-toolbar-text"},{xtype:"numberfield",value:defaultLegsByCidInterval,width:40,minValue:1,maxValue:60,step:5,enableKeyEvents:true,editable:false,listeners:{scope:this,change:function(D){var C=D.getValue();
debug_log(C);
defaultLegsByCidInterval=C;
this.similarCDR.setCustomFilter({fdatefrom:dateTime(dateTime(this.record.data.calldate).getTime()/1000-C),fdateto:dateTime(dateTime(this.record.data.calldate).getTime()/1000+C)},null,true)
}},fieldStyle:{"text-align":"right"}},"-",{text:this.findLangS("menu","merge"),menu:k},"-",{xtype:"displayfield",value:this.findLangS("tbar","conditionCallerCalled"),fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",value:"and",_gridForm:this,_buttonGroup:true,aData:[["and","AND"],["or","OR"]],listeners:{select:function(C){this.similarCDR.setCustomFilter({fcallerd_type:C.getValue()=="and"?1:"or"},null,true)
},scope:this},width:__width_ColumnChar(4)+__width_Trigger},"-"];
if(user_can_cdr_share_local_public()||user_can_cdr_share_local_private()){function s(D){var C=[];
var E=[];
this.similarCDR.grid.store.each(function(F){C.push(F.data.ID);
E.push(F.data)
});
CDR.Utils.shareCdr(D._menuId,D._menuId2,D._menuSubId,{ids:C,data:E,merge:true})
}var r=[];
if(user_can_cdr_share_local_public()){r.push({text:this.findLangS("menu","localPublic"),handler:s,_menuSubId:"self_protected_link"})
}if(user_can_cdr_share_local_private()){r.push({text:this.findLangS("menu","localPrivate"),handler:s,_menuSubId:"self_login_link"})
}var f=[];
for(var v=0;
v<3;
v++){if(v==0&&user_no_rtp()){continue
}f.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 2;">'+(v==0?this.findLangS("menu","shareSipRtp"):v==1?this.findLangS("menu","shareSip"):this.findLangS("menu","shareSipHistory"))+"</div>");
var n=v==0?"rtp":v==1?null:"sip_history";
for(var t=0;
t<2;
t++){f.push({text:this.findLangS("menu",t?"sendLinkViaEmail":"showLink"),iconCls:t?"icon_email_send":"icon_magnifier",handler:r.length==1?r[0].handler:undefined,_menuSubId:r.length==1?r[0]._menuSubId:undefined,_menuId:t?"share_cdr_send":"share_cdr_show",_menuId2:n,scope:this,menu:r.length>1?{defaults:{_menuId:t?"share_cdr_send":"share_cdr_show",_menuId2:n,scope:this},items:cloneArray(r)}:undefined})
}}u.push({iconCls:"icon_link",text:this.findLangS("button","shareShowCdr"),menu:f},"-")
}this.similarCDR=new CDR.Grid({title:this.findLangS("title","legsByCIDtab"),layout:"fit",disableCharts:true,disableMenu:true,pageSize:15,loadAtInit:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},extraParams:{fdatefrom:dateTime(dateTime(B.record.data.calldate).getTime()/1000-defaultLegsByCidInterval),fdateto:dateTime(dateTime(B.record.data.calldate).getTime()/1000+defaultLegsByCidInterval),fcaller:d,fcalled:p,fcallerd_type:1,orderSuffix:"ID DESC"},tabPanel:this,level:2,listeners:{scope:this,afterrender:function(){gridEmptyInfo(this.similarCDR.grid)
}},customMenu:u,decWidthTable:29,wikiId:"Call_Detail_Record_-_CDR#Legs_by_CID"});
this.similarCDR.grid.store.on("load",function(C){if(C.getCount()>1){if(!C._firstLoaded){C._firstLoaded=true
}this.similarCDR.setIconCls("icon_light_on")
}else{this.similarCDR.setIconCls("icon_light_off")
}gridEmptyInfo(this.similarCDR.grid)
},this);
this.tabPanel.add(this.similarCDR);
var o=[];
var g=[];
var w=getDataCdrCustomHeaders();
if(w){for(var v=0;
v<w.length;
v++){if(w[v].default_for_legs_by_header*1){var c=w[v]._column_unique;
o.push(c);
g.push(B.record.data[c])
}}}var A=[];
if(user_can_pcap()){A.push({text:this.findLangS("menu","mergeSipPcap"),scope:this,handler:function(){this.relatedCDR.onMergePcapSipHistory("pcap",B.record.data.ID,"filter")
}});
if(!user_no_rtp()){A.push({text:this.findLangS("menu","mergeSipRtpPcap"),scope:this,handler:function(){this.relatedCDR.onMergePcapSipHistory("pcaprtp",B.record.data.ID,"filter")
}})
}}A.push({text:this.findLangS("menu","mergeSipHistory"),scope:this,handler:function(){this.relatedCDR.onMergePcapSipHistory("sip_history",B.record.data.ID,"filter")
}});
var z=[{xtype:"displayfield",value:this.findLangS("field","relatedInterval_s"),fieldCls:"x-toolbar-text"},{xtype:"numberfield",value:defaultLegsByHeaderInterval,width:55,minValue:10,maxValue:3600*4,step:100,enableKeyEvents:true,editable:false,listeners:{scope:this,change:function(D){var C=D.getValue();
debug_log(C);
defaultLegsByHeaderInterval=C;
this.relatedCDR.setCustomFilter({fdatefrom:dateTime(dateTime(this.record.data.calldate).getTime()/1000-C),fdateto:dateTime(dateTime(this.record.data.calldate).getTime()/1000+C)},null,true)
}},fieldStyle:{"text-align":"right"}},"-",{text:this.findLangS("menu","merge"),menu:A},"-"];
if(user_can_cdr_share_local_public()||user_can_cdr_share_local_private()){function y(D){var C=[];
var E=[];
this.relatedCDR.grid.store.each(function(F){C.push(F.data.ID);
E.push(F.data)
});
CDR.Utils.shareCdr(D._menuId,D._menuId2,D._menuSubId,{ids:C,data:E,merge:true})
}var r=[];
if(user_can_cdr_share_local_public()){r.push({text:this.findLangS("menu","localPublic"),handler:y,_menuSubId:"self_protected_link"})
}if(user_can_cdr_share_local_private()){r.push({text:this.findLangS("menu","localPrivate"),handler:y,_menuSubId:"self_login_link"})
}var f=[];
for(var v=0;
v<3;
v++){if(v==0&&user_no_rtp()){continue
}f.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 2;">'+(v==0?this.findLangS("menu","shareSipRtp"):v==1?this.findLangS("menu","shareSip"):this.findLangS("menu","shareSipHistory"))+"</div>");
var n=v==0?"rtp":v==1?null:"sip_history";
for(var t=0;
t<2;
t++){f.push({text:this.findLangS("menu",t?"sendLinkViaEmail":"showLink"),iconCls:t?"icon_email_send":"icon_magnifier",handler:r.length==1?r[0].handler:undefined,_menuSubId:r.length==1?r[0]._menuSubId:undefined,_menuId:t?"share_cdr_send":"share_cdr_show",_menuId2:n,scope:this,menu:r.length>1?{defaults:{_menuId:t?"share_cdr_send":"share_cdr_show",_menuId2:n,scope:this},items:cloneArray(r)}:undefined})
}}z.push({iconCls:"icon_link",text:this.findLangS("button","shareShowCdr"),menu:f},"-")
}this.relatedCDR=new CDR.Grid({title:this.findLangS("title","legsByHeaderTab"),idProperty:"ID_comb",layout:"fit",disableCharts:true,disableMenu:true,pageSize:15,loadAtInit:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},extraParams:{fdatefrom:dateTime(dateTime(B.record.data.calldate).getTime()/1000-defaultLegsByHeaderInterval),fdateto:dateTime(dateTime(B.record.data.calldate).getTime()/1000+defaultLegsByHeaderInterval),middle_calldate:B.record.data.calldate,findRelatedViaCustomHeaderField:o.length?Ext.encode(o):null,findRelatedViaCustomHeaderFieldContent:o.length?Ext.encode(g):null,findRelatedViaCustomHeaderCallId:B.record.data.fbasename_orig,findRelatedViaCallId:B.record.data.fbasename_orig},tabPanel:this,level:2,listeners:{scope:this,afterrender:function(){gridEmptyInfo(this.relatedCDR.grid)
}},customMenu:z,decWidthTable:29,wikiId:"Call_Detail_Record_-_CDR#Legs_by_header"});
this.relatedCDR.grid.store.on("load",function(C){if(C.getCount()>1){if(!C._firstLoaded){C._firstLoaded=true
}this.relatedCDR.setIconCls("icon_light_on")
}else{this.relatedCDR.setIconCls("icon_light_off")
}gridEmptyInfo(this.relatedCDR.grid)
},this);
this.tabPanel.add(this.relatedCDR);
if(window.existsCdrNote){this.note=new CDR.Note.Grid({title:this.findLangS("title","noteTab"),iconCls:"icon_note",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},relFields:{cdr_id:B.record.data.ID},enableEdit:user_id()>0,cdrGrid:B.grid,cdrRecord:B.record,autoIcon:true});
this.tabPanel.add(this.note)
}}Ext.apply(B,{items:this.tabPanel,border:false,listeners:{scope:this,afterrender:function(){if(B.enableChartsInTab){m.call(this)
}else{if(!B.grid.panel||!B.grid.panel.disableSvgPaint){a.call(this)
}else{if(!B.grid.panel||!B.grid.panel.disableMap){q.call(this)
}}}}}});
this.callParent([B]);
function m(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrCharts"},success:function(C){if(C.charts){this.cdrCharts=new CDR.ChartsPanel({cdrRecord:B.record.data,parentGrid:B.grid,charts:C.charts,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},wikiId:"Call_Detail_Record_-_CDR#Charts"});
this.tabPanel.add(this.cdrCharts)
}if(!B.grid.panel||!B.grid.panel.disableSvgPaint){a.call(this)
}else{if(!B.grid.panel||!B.grid.panel.disableMap){q.call(this)
}}},maskEl:this,deferMask:true})
}function a(){if(B.grid.panel&&B.grid.panel.disableMap){q.call(this);
return
}var F=[];
var C=["sipcallerip","sipcalledip","callerrtp","calledrtp","callerrtp2","calledrtp2"];
for(var D=0;
D<C.length;
D++){if(B.record.data[C[D]]){F.push(B.record.data[C[D]])
}}if(B.record.data.proxy){var E=Ext.decode(B.record.data.proxy);
if(E&&E.length){for(var D=0;
D<E.length;
D++){F.push(E[D][0])
}}}if(F.length){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getSvgPaints",params:Ext.encode({ips:F})},success:function(G){if(G.svgPaints&&G.svgPaints.length){l.call(this,G.svgPaints)
}else{this.svgPainterInfo=new Ext.Panel({title:this.findLangS("title","networkMapTab"),iconCls:"icon_computers",layout:{type:"vbox",align:"center",pack:"center"},border:false,items:{xtype:"displayfield",value:this.findLangS("text","thereIsNoNodeInNetworkMap"),fieldStyle:{"font-weight":"bold","font-size":"120%"}},height:80,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel.add(this.svgPainterInfo)
}q.call(this)
}})
}else{q.call(this)
}}function l(C){this.svgPainter=new SvgPaint.Panel({id_autosuffix:true,svgPaints:C,disableEdit:true,title:this.findLangS("title","networkMapTab"),iconCls:"icon_computers",border:false,height:500,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel.add(this.svgPainter)
}function q(){if(B.grid.panel&&B.grid.panel.disableMap){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getGeoPosProviders"},success:function(C){b.call(this,C.prov)
}})
}function b(C){var D=[];
if(B.record.data.geopos_lat&&B.record.data.geopos_lng){D.push({posType:"geop",pos:{lat:B.record.data.geopos_lat,lng:B.record.data.geopos_lng}})
}this.map=new GMap.Panel({typeData:"cdr",data:B.record.data,pos:D,prov_sip:C,sip:{src:B.record.data.sipcallerip,dst:B.record.data.sipcalledip},initMarkers:["sip","geop"],switchMarkers:["sip","geop"],selectProvMarkers:["sip"],initDisabledMarkers:["sip"],controlMarkersIfPos:["geop"],height:500,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},wikiId:"Call_Detail_Record_-_CDR#map",onAfterCreateMap:h,onAfterCreateMapScope:this});
this.tabPanel.add(this.map)
}function h(){if(this._activatedMap){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getGeoPos",params:Ext.encode({ip:{sip_src:B.record.data.sipcallerip,sip_dst:B.record.data.sipcalledip}})},success:function(C){if(C.pos&&C.pos.length){this.map.initPos(C.pos,"sip")
}if(C.errors&&user_is_admin()){this.map.evGetPosError(C.errors,{onCloseSetCustomerGeoIP:function(D){if(D){h.call(this)
}},onCloseSetCustomerGeoIP_scope:this})
}},error:function(C,D,E){if(C.errors){this.map.evGetPosError(C.errors,{onCloseSetCustomerGeoIP:function(F){if(F){h.call(this)
}},onCloseSetCustomerGeoIP_scope:this})
}else{alertAjaxError(D)
}},maskEl:this.map});
this._activatedMap=true
}},onAfterRender:function(){}});
Ext.define("CDR.GroupPanel",{extend:"Ext.Panel",widget:"widget.CDRX-GroupPanel",subsystem:"cdr",constructor:function(c){this.group_by=_CdrGroupBy_sipResponse;
var k="CDR_stats_model";
if(!Ext.ClassManager.isCreated(k)){Ext.define(k,{extend:"Ext.data.Model",fields:rsCDR_stats,idProperty:"id"})
}this.CDR_stats_Store=new Ext.data.Store({storeId:"CDR_stats_Store",model:k,proxy:{type:"ajax",url:"php/model/sql.php",timeout:60*60*1000,actionMethods:"POST",extraParams:{task:"LISTING",module:"CDR_stats"},reader:{rootProperty:"results",totalProperty:"total",idProperty:"id"}},pageSize:-1,_grid:this,_params:["dir","limit","module","sort","start","task","simple"]});
this.CDR_stats_Store.proxy.on("exception",onGridStoreException,this.CDR_stats_Store);
this.CDR_stats_Grid=new Ext.grid.GridPanel({store:this.CDR_stats_Store,columns:{items:this.getCdrStatsColumns(false,true,true),defaults:{sortable:true}},selModel:{mode:"SINGLE",allowDeselect:true},viewConfig:{enableTextSelection:true,loadingText:getLoadMaskWithStopButton_loading_text("cdrStat_loadMask")},border:true,region:"center",showMosXrColumns:true,showMosSilenceColumns:true,showMosLqoColumns:true,showCheckBoxes:false,listeners:{scope:this,resize:function(t,u,r,s,w,v){if(!t._ignoreSaveWidth&&u<10000&&u!=s){if(this._width_old&&this.getWidth()==this._width_old){setConfigParameter("CDR.GroupPanel_stats_width",u)
}this._width_old=this.getWidth()
}},cellcontextmenu:function(){onContextClipboardMenu.apply(this.CDR_stats_Grid,arguments)
}}});
this.CDR_stats_Grid.applyConfig("CDR.GroupPanel_stats");
this.CDR_pieStats_Store=this.createStorePieChart(true);
var q=this.CDR_pieStats_Store;
this.CDR_pieStats_Chart=new Ext.chart.PolarChart({store:this.CDR_pieStats_Store,shadow:false,series:[{type:"pie",angleField:"total",label:{field:"descr_comb",display:"rotate",contrast:true,font:"9px Arial",renderer:function(w,t,s,v,r){var u=0;
v.store.each(function(z){u+=z.get("total")
});
var y=v.store.getAt(r);
if(y&&y.data.total<u*1/100){return({hidden:true})
}}},tips:{trackMouse:true,width:150,height:46,renderer:function(t,s,r){var u=0;
q.each(function(v){u+=v.get("total")
});
t.setTitle(s.get("descr_comb").replace("\n","<br>")+"<br>"+Math.round(s.get("total")/u*100*10)/10+"%")
},scope:this},listeners:{scope:this,itemclick:function(r,t,s){m.call(this,t.record.data.stat_data_id)
}}}],legend:{docked:"right",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:3,_disableUpdateSurface:true},border:false,padding:5,plugins:{ptype:"chartitemevents",moveEvents:true}});
var o=Ext.dom.Element.getViewportWidth()<1100;
var l=[];
this.comboGroupBy=new Ext.ux.combobox.ComboBoxA({name:"group_by",value:this.group_by,fieldLabel:this.findLangS("title","groupBy"),labelWidth:__width_FieldChar(8),aData:arCdrGroupBy,width:120,listConfig:{maxHeight:Ext.dom.Element.getViewportHeight()/3-50},listeners:{scope:this,select:function(t,s,r){this.group_by=t.getValue();
this.reloadCdrStats(this._cdrGrid,this._cdrGrid.store,true,true);
if(this._cdrGrid.clearGroupSelect(true)){this._ignoreReloadCdrStats=true
}Ext.defer(function(){this.CDR_stats_Grid.focus()
},100,this)
}}});
this.groupStat=new GroupStat.Panel({type:"cdr",cdrGrid:c._cdrGrid,cdrStore:c._cdrGrid.grid.store,tabDock:"top",startTab:"topCalls",disableFirstChangeTabMask:true,disableFirstChangeTabLoad:true,flex:3,style:{marginTop:-2},initItemsMainTabBar:[{text:this.findLangS("title","pieChart"),content:this.CDR_pieStats_Chart,_id:"pie"}],evChangeTab:function(r){this.CDR_stats_Grid.showCheckBoxes=r._id=="pie";
this.CDR_stats_Grid.reconfigure(this.CDR_stats_Store,this.getCdrStatsColumns());
this.CDR_stats_Grid.applyConfig()
},evChangeTabScope:this,tabBackgroundColor:__color_FormBackground,region:"center",wikiIdInTabBar:"Call_Detail_Record_-_CDR#CDR_group_panel",collapsiblePanel:this,disableFilteredCdr:true,groupPanel:this});
this.CDR_stats_Grid.flex=1;
this.comboGroupBy.flex=1;
l.push({layout:"border",items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:"hbox",items:[this.comboGroupBy,{xtype:"button",iconCls:"icon_columns",menu:[],listeners:{scope:this,click:function(s,t){s.menu.removeAll();
var u=this.CDR_stats_Grid.headerCt.getMenuItems(0)[3].menu;
for(var r=1;
r<u.length;
r++){s.menu.add(u[r])
}s.showMenu(true)
}},style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},this.CDR_stats_Grid,{xtype:"container",height:1}],region:"west",border:false,split:true,flex:1},this.groupStat],border:false,flex:1});
c=Ext.applyIf(c||{},{layout:"fit",border:false,height:Ext.dom.Element.getViewportHeight()/3,items:{xtype:"form",layout:{type:"hbox",align:"stretch"},bodyStyle:__style_FormBackground({padding:5}),border:false,defaults:{bodyStyle:__style_FormBackground()},items:l},listeners:{resize:a,collapse:function(){this.CDR_stats_Grid.getView().getEl().setStyle({"overflow-y":"hidden"})
},beforeExpand:function(){this.CDR_stats_Grid.getView().getEl().setStyle({"overflow-y":"auto"})
},scope:this},style:{"border-top":"1px solid "+__color_PanelBorder}});
CDR.GroupPanel.superclass.constructor.call(this,c);
var d=getConfigParameter("CDR.GroupPanel_stats_width");
if(d){this.CDR_stats_Grid.on("afterrender",function(){this.CDR_stats_Grid._ignoreSaveWidth=true;
this.CDR_stats_Grid.ownerCt.flex=undefined;
this.CDR_stats_Grid.ownerCt.setWidth(d*1);
delete this.CDR_stats_Grid._ignoreSaveWidth
},this)
}this.CDR_stats_Grid.store.on("beforeload",g,this);
this.CDR_stats_Grid.store.on("load",f,this);
this.CDR_stats_Grid.on("cellclick",function(){Ext.defer(p,250,this)
},this);
function a(){if(this.layout.layout){this._panel.updateLayout()
}}function p(){if(this._suppressOnMouseDown){this._suppressOnMouseDown=false;
return
}this.clearSelectGroupStat();
var r=this.CDR_stats_Grid.selModel.getSelection();
if(r&&r.length){this._cdrGrid.setGroupSelectByDataRecord(this.getGroupFieldId(),this.getGroupNameSuffix(),r[0].data,true);
this._ignoreReloadCdrStats=true
}else{this._cdrGrid.clearGroupSelect(true);
this._ignoreReloadCdrStats=true
}this.reloadGroupStat()
}function g(){beginLoadMaskWithStopButton_store(this.CDR_stats_Store,"cdrStat_loadMask")
}function f(){endLoadMaskWithStopButton_store(this.CDR_stats_Store);
this.CDR_stats_Store.each(function(s){s.data.checked=true;
s.commit()
});
if(this._selectedRecordId){var r=this.CDR_stats_Grid.store.getById(this._selectedRecordId);
if(r){this.CDR_stats_Grid.selModel.select([r],true)
}if(!this.CDR_stats_Grid.selModel.getCount()){this._cdrGrid.clearGroupSelect(true)
}this._selectedRecordId=null
}if(!loadStoreIsCancel(this.CDR_stats_Grid.store)){this.refreshStorePieChart();
this.reloadGroupStat()
}}function b(s,r){this.CDR_stats_Grid.showMosXrColumns=r;
this.CDR_stats_Grid.reconfigure(this.CDR_stats_Store,this.getCdrStatsColumns());
this.CDR_stats_Grid.applyConfig()
}function h(s,r){this.CDR_stats_Grid.showMosSilenceColumns=r;
this.CDR_stats_Grid.reconfigure(this.CDR_stats_Store,this.getCdrStatsColumns());
this.CDR_stats_Grid.applyConfig()
}function n(s,r){this.CDR_stats_Grid.showMosLqoColumns=r;
this.CDR_stats_Grid.reconfigure(this.CDR_stats_Store,this.getCdrStatsColumns());
this.CDR_stats_Grid.applyConfig()
}function m(s){var u=null;
for(var t=0;
t<this.CDR_stats_Store.getCount();
t++){var r=this.CDR_stats_Store.getAt(t);
if(r.data.id==s){u=r;
break
}}if(u){this.CDR_stats_Grid.getSelectionModel().select([u]);
this._cdrGrid.setGroupSelectByDataRecord(this.getGroupFieldId(),this.getGroupNameSuffix(),u.data,true);
this._ignoreReloadCdrStats=true;
this.reloadGroupStat()
}}},getCdrStatsColumns:function(b,t,r,v){var a=[];
if(b||this.CDR_stats_Grid&&this.CDR_stats_Grid.showCheckBoxes){a.push({xtype:"checkcolumn",header:"<img src=images/pie.png>",dataIndex:"checked",width:28,listeners:{scope:this,checkchange:function(H,G,I){var F=this.CDR_stats_Store.getAt(G);
if(F){F.data.checked=I;
F.commit();
this.refreshStorePieChart()
}}},_show:true})
}switch(this.group_by){case _CdrGroupBy_sipUsers:a.push({headerLang:"groupSipUser",dataIndex:"sip_user_name",width:__width_ColumnChar(20),_show:true});
break;
case _CdrGroupBy_sipIP:a.push({headerLang:"groupSipIP_hostName",dataIndex:"sipip",width:__width_ColumnChar(20),renderer:k,_show:true});
break;
case _CdrGroupBy_codecs:a.push({headerLang:"groupCodec",dataIndex:"x_codec",width:__width_ColumnChar(18),_show:true});
break;
case _CdrGroupBy_sipResponse:case _CdrGroupBy_sipResponse_bye_code:a.push({xtype:"actioncolumn",headerLang:"groupLastSIPresponse",dataIndex:"lastSIPresponse",width:__width_ColumnChar(25),rendererBase:this.group_by==_CdrGroupBy_sipResponse_bye_code?y:renderString,items:[{getClass:function(F,G,H){return("icon_menu_diag_system")
},handler:function(H,L,G,I,J){this._suppressOnMouseDown=true;
var K=H.store.getAt(L);
var F=new GroupStat.Panel({cdrGroupRecord:K,cdrGrid:this._cdrGrid,cdrStore:this._cdrGrid.grid.store,tabBackgroundColor:__color_WindowFrame});
F.createWindow({title:this.findLangS("title","advancedStatistics")+" - "+K.data.lastSIPresponse},true)
},tooltip:function(F,G,H){return(this.findLangS("button_help","advancedStatistics"))
},scope:this}],iconTdStyle:"width: 16;",baseContentFirst:true,_show:true});
break;
case _CdrGroupBy_ipGroup:a.push({headerLang:"groupIP_group",dataIndex:"cb_ip_groups_descr",width:__width_ColumnChar(20),_show:true});
break;
case _CdrGroupBy_reasonSip:a.push({headerLang:"groupReasonSip",dataIndex:"reason_sip",width:__width_ColumnChar(25),_show:true});
break;
case _CdrGroupBy_reasonQ850:a.push({headerLang:"groupReasonQ850",dataIndex:"reason_q850",width:__width_ColumnChar(25),renderer:p,_show:true});
break;
case _CdrGroupBy_ua:a.push({headerLang:"groupUa",dataIndex:"ua",width:__width_ColumnChar(25),_show:true});
break;
case _CdrGroupBy_country_number:case _CdrGroupBy_country_caller:case _CdrGroupBy_country_called:case _CdrGroupBy_country_sipip:case _CdrGroupBy_country_sipcallerip:case _CdrGroupBy_country_sipcalledip:a.push({headerLang:"groupCountry",dataIndex:"country",width:__width_ColumnChar(25),renderer:A,_show:true});
break
}a.push({dataIndex:"cnt_all",width:__width_ColumnNum(6),align:"right",renderer:m,_show:true},{dataIndex:"cnt_ok",width:__width_ColumnNum(6),align:"right",renderer:D,_show:true});
a.push({headerLang:"sum_duration_min",dataIndex:"duration_all",width:__width_ColumnNum(7),align:"right",renderer:n,_show:true},{dataIndex:"acd_all",width:__width_ColumnNum(6),align:"right",renderer:d,_show:true});
if(this.group_by!=_CdrGroupBy_sipResponse){a.push({dataIndex:"asr_all",width:__width_ColumnNum(6),align:"right",renderer:h},{dataIndex:"ner_all",width:__width_ColumnNum(6),align:"right",renderer:z})
}if(window.rtpQualityUse){a.push({dataIndex:"mos_all",width:__width_ColumnNum(6),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_perc95_all",width:__width_ColumnNum(6),align:"right",renderer:o})
}if(existsMosXrCdr&&(t||this.CDR_stats_Grid&&this.CDR_stats_Grid.showMosXrColumns)){a.push({dataIndex:"mos_xr_avg_all",width:__width_ColumnNum(8),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_xr_avg_perc95_all",width:__width_ColumnNum(9),align:"right",renderer:o})
}a.push({dataIndex:"mos_xr_min_all",width:__width_ColumnNum(8),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_xr_min_perc95_all",width:__width_ColumnNum(9),align:"right",renderer:o})
}}if(existsMosSilenceCdr&&(r||this.CDR_stats_Grid&&this.CDR_stats_Grid.showMosSilenceColumns)){a.push({dataIndex:"mos_silence_avg_all",width:__width_ColumnNum(8),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_silence_avg_perc95_all",width:__width_ColumnNum(9),align:"right",renderer:o})
}a.push({dataIndex:"mos_silence_min_all",width:__width_ColumnNum(8),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_silence_min_perc95_all",width:__width_ColumnNum(9),align:"right",renderer:o})
}}if(existsMosLqoCdr&&(v||this.CDR_stats_Grid&&this.CDR_stats_Grid.showMosLqoColumns)){a.push({dataIndex:"mos_lqo_caller_all",width:__width_ColumnNum(6),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_lqo_caller_perc95_all",width:__width_ColumnNum(7),align:"right",renderer:o})
}a.push({dataIndex:"mos_lqo_called_all",width:__width_ColumnNum(6),align:"right",renderer:o});
if(!window.disablePercentiles){a.push({dataIndex:"mos_lqo_called_perc95_all",width:__width_ColumnNum(7),align:"right",renderer:o})
}}a.push({dataIndex:"packets_lost_all",width:__width_ColumnNum(6),align:"right",renderer:u});
if(!window.disablePercentiles){a.push({dataIndex:"packets_lost_perc95_all",width:__width_ColumnNum(6),align:"right",renderer:u})
}a.push({dataIndex:"jitter_all",width:__width_ColumnNum(6),align:"right",renderer:g});
if(!window.disablePercentiles){a.push({dataIndex:"jitter_perc95_all",width:__width_ColumnNum(6),align:"right",renderer:g})
}a.push({dataIndex:"delay_all",width:__width_ColumnNum(7),align:"right",headerLang:"delay_all_avg",renderer:q});
if(!window.disablePercentiles){a.push({dataIndex:"delay_perc95_all",width:__width_ColumnNum(7),align:"right",headerLang:"delay_perc95_all_avg",renderer:q})
}}a.push({dataIndex:"short_60",width:__width_ColumnNum(6),align:"right",renderer:B},{dataIndex:"short_20",width:__width_ColumnNum(6),align:"right",renderer:B});
if(window.existsCdrSilence){a.push({dataIndex:"silence_all",width:__width_ColumnNum(6),align:"right",headerLang:"silence_all",renderer:c});
if(!window.disablePercentiles){a.push({dataIndex:"silence_perc95_all",width:__width_ColumnNum(6),align:"right",headerLang:"silence_perc95_all",renderer:c})
}a.push({dataIndex:"silence_end_all",width:__width_ColumnNum(6),align:"right",headerLang:"silence_end_all",renderer:E});
if(!window.disablePercentiles){a.push({dataIndex:"silence_end_perc95_all",width:__width_ColumnNum(6),align:"right",headerLang:"silence_end_perc95_all",renderer:E})
}}if(window.existsCdrClipping){a.push({dataIndex:"clipping_all",width:__width_ColumnNum(6),align:"right",headerLang:"clipping_all",renderer:C});
if(!window.disablePercentiles){a.push({dataIndex:"clipping_perc95_all",width:__width_ColumnNum(6),align:"right",headerLang:"clipping_perc95_all",renderer:C})
}}if(window.fillBillingTable){a.push({dataIndex:"price_customer",width:__width_ColumnNum(12),align:"right",renderer:l},{dataIndex:"price_operator",width:__width_ColumnNum(12),align:"right",renderer:l})
}var s=null;
if(window.rtpQualityUse){if(window.disablePercentiles){s=["mos_all","mos_xr_avg_all","mos_silence_avg_all","mos_lqo_caller_all","mos_lqo_called_all","packets_lost_all","delay_all"]
}else{s=["mos_perc95_all","mos_xr_avg_perc95_all","mos_silence_avg_perc95_all","mos_lqo_caller_perc95_all","mos_lqo_called_perc95_all","packets_lost_perc95_all","delay_perc95_all"]
}}for(var w=0;
w<a.length;
w++){if(a[w].header){continue
}a[w].header=this.findLangS("column",a[w].headerLang||a[w].dataIndex);
if(a[w].xtype=="actioncolumn"){a[w].menuText=a[w].header
}if(s&&s!=="all"&&!a[w]._show&&!s.isIn(a[w].dataIndex)){a[w].hidden=true
}}function y(J,F,G,K,I,H){return(J+(CDR.Utils.getByeText(G.data.bye,true)?' / <span data-qtip="'+CDR.Utils.getByeText(G.data.bye)+'" data-dismissDelay=15000>'+CDR.Utils.getByeText(G.data.bye,true)+"</span>":""))
}function p(J,F,G,K,I,H){if(G.data.reason_q850_cause){if(J.match(/\d+ \(text missing\)/)){if(parseInt(J)==G.data.reason_q850_cause&&G.data.reason_q850_cause_text){return(G.data.reason_q850_cause+" "+G.data.reason_q850_cause_text)
}}else{if(parseInt(J)!=G.data.reason_q850_cause){return(G.data.reason_q850_cause+" "+J)
}}}return(J)
}function k(J,F,G,K,I,H){return(G.data.sip_ip+(G.data.sip_hostname?("<br><i>"+G.data.sip_hostname+"</i>"):""))
}function A(J,F,G,K,I,H){return((existsFlag(G.data.country_code)?'<img src="images/blank.png" class="flag flag-'+G.data.country_code+'" style="margin-bottom: -1px;" /> ':"")+J+" "+G.data.country_code)
}function m(J,F,G,K,I,H){return(G.data.cnt_all)
}function D(L,F,I,M,K,J){var H=0;
J.each(function(N){H+=N.data.cnt_all
});
var G=formatNumber(I.data.cnt_all/H*100,2)+"%";
return(G)
}function n(J,F,G,K,I,H){return(G.data.duration_all===null?"":formatNumber(G.data.duration_all/60,1)+"m")
}function d(J,F,G,K,I,H){return(G.data.acd_all===null?"":formatNumber(G.data.acd_all,0)+"s")
}function h(J,F,G,K,I,H){return(G.data.asr_all===null?"":formatNumber(G.data.asr_all,0)+"%")
}function z(J,F,G,K,I,H){return(G.data.ner_all===null?"":formatNumber(G.data.ner_all,0)+"%")
}function o(J,F,G,K,I,H){return(H._grid.CDR_stats_Grid.columnManager.getColumns()[I].dataIndex.match("_perc9")||H._grid.CDR_stats_Grid.columnManager.getColumns()[I].dataIndex.match("_lqo")?(J===null?"":formatNumber(J,2)):(G.data.mos_all===null?"":formatNumber(G.data.mos_all,2)))
}function u(J,F,G,K,I,H){return(H._grid.CDR_stats_Grid.columnManager.getColumns()[I].dataIndex.match("_perc9")?(J===null?"":formatNumber(J,2)+"%"):(G.data.packets_lost_all===null?"":formatNumber(G.data.packets_lost_all,2)+"%"))
}function g(J,F,G,K,I,H){return(H._grid.CDR_stats_Grid.columnManager.getColumns()[I].dataIndex.match("_perc9")?(J===null?"":formatNumber(J,2)):(G.data.jitter_all===null?"":formatNumber(G.data.jitter_all,2)))
}function q(J,F,G,K,I,H){return(H._grid.CDR_stats_Grid.columnManager.getColumns()[I].dataIndex.match("_perc9")?(J===null?"":formatNumber(J,1)+__unit_xPDV):(G.data.delay_all===null?"":formatNumber(G.data.delay_all,1)+__unit_xPDV))
}function c(J,F,G,K,I,H){return(J?formatNumber(J,0)+"%":"")
}function E(J,F,G,K,I,H){return(J?formatNumber(J,0)+"s":"")
}function C(J,F,G,K,I,H){return(J?formatNumber(J,0):"")
}function f(G,F,H){return(G+'<br><span style="color: green">'+F+'</span><br><span style="color: red">'+H+"</span>")
}function B(J,F,G,K,I,H){return(J?formatNumber(J,0)+" %":"")
}function l(J,F,G,K,I,H){return(J?formatNumber(J,J<0.01?4:2)+(G.data.price_currency_code?' <span style="color: grey;">'+G.data.price_currency_code+"</span>":""):"")
}return a
},getForm:function(){return(this.items.get(0).getForm())
},reloadCdrStats:function(c,f,d,b){if(this._ignoreReloadCdrStats){this._ignoreReloadCdrStats=false;
if(!b){return
}}if(d){this.CDR_stats_Grid.reconfigure(this.CDR_stats_Store,this.getCdrStatsColumns());
this.CDR_stats_Grid.applyConfig()
}else{var a=this.CDR_stats_Grid.selModel.getSelection();
if(a&&a.length){this._selectedRecordId=a[0].internalId
}}this.setBaseParamsCdrStats(c);
this.CDR_stats_Store.removeAll();
this.CDR_stats_Store.load()
},setBaseParamsCdrStats:function(d){this.resetBaseParamsCdrStats();
Ext.apply(this.CDR_stats_Store.proxy.extraParams,d.getSelectParams());
this.CDR_stats_Store.proxy.extraParams.group_by=this.group_by;
var a=[];
var f=false;
for(var b=0;
b<this.CDR_stats_Grid.headerCt.items.getCount();
b++){var c=this.CDR_stats_Grid.headerCt.items.get(b);
if(!c.hidden&&c.dataIndex){a.push(c.dataIndex);
if(c.dataIndex.match("_perc95")||c.dataIndex.match("_perc99")){f=true
}}}this.CDR_stats_Store.proxy.extraParams.needColumns=Ext.encode(a);
if(f){this.CDR_stats_Store.proxy.extraParams.needPercentile=1
}else{delete this.CDR_stats_Store.proxy.extraParams.needPercentile
}},resetBaseParamsCdrStats:function(){for(var a in this.CDR_stats_Store.proxy.extraParams){if(this.CDR_stats_Store._params.indexOf(a)<0){this.CDR_stats_Store.proxy.extraParams[a]=""
}}},getGroupFieldId:function(){return(getDataArrayItem(arCdrGroupBy,this.group_by,0,2))
},getGroupFieldDescr:function(){return(getDataArrayItem(arCdrGroupBy,this.group_by,0,3)||this.getGroupFieldId())
},getGroupNameSuffix:function(){return(getDataArrayItem(arCdrGroupBy,this.group_by,0,4))
},deselectAllGroupSelects:function(){this.CDR_stats_Grid.getSelectionModel().deselectAll(true)
},deselectAllGroupFilters:function(){if(this.groupStat){this.groupStat.deselectAll(true);
this._ignoreReloadCdrStats=true
}},clearIgnoreReloadGroup:function(){this._ignoreReloadCdrStats=false
},refreshStorePieChart:function(){var a=this.createStorePieChart();
if(!checkEqStore(a,this.CDR_pieStats_Store)){this.CDR_pieStats_Chart.isInitializing=true;
this.CDR_pieStats_Store.removeAll();
for(var b=0;
b<a.getCount();
b++){this.CDR_pieStats_Store.add(a.getAt(b).data)
}this.CDR_pieStats_Chart.isInitializing=false;
this.CDR_pieStats_Chart.processData()
}a.removeAll()
},createStorePieChart:function(f){var k=new Ext.data.ArrayStore({fields:["id","id2","id_comb","descr","descr2","descr_comb","total","stat_data_id"]});
if(f){return(k)
}var d=this.getGroupFieldId();
var h=this.getGroupFieldDescr();
for(var c=0;
c<Math.min(this.CDR_stats_Store.getCount(),20);
c++){var a=this.CDR_stats_Store.getAt(c);
if(a.data.checked){var g={};
if(Ext.isArray(d)){for(var b=0;
b<Math.min(d.length,2);
b++){g[b==0?"id":"id2"]=a.data[d[b]]
}}else{g.id=a.data[d]
}g.id_comb=g.id+(g.id2?" / "+g.id2:"");
if(Ext.isArray(h)){for(var b=0;
b<Math.min(h.length,2);
b++){g[b==0?"descr":"descr2"]=h[b]=="bye"?CDR.Utils.getByeText(a.data[h[b]],true):a.data[h[b]]
}}else{g.descr=a.data[h];
if(h=="sip_ip"&&a.data.sip_hostname){g.descr+="\n"+a.data.sip_hostname
}}g.descr_comb=g.descr+(g.descr2?"\n"+g.descr2:"");
g.total=a.data.cnt_all;
g.stat_data_id=a.data.id;
k.add(g)
}}return(k)
},setGroupData:function(a){if(a&&a.group_by){this.group_by=a.group_by
}},applyGroupData:function(){this.comboGroupBy.setValue(this.group_by);
this.CDR_stats_Grid.reconfigure(this.CDR_stats_Store,this.getCdrStatsColumns());
this.CDR_stats_Grid.applyConfig()
},getGroupData:function(){var d=["group_by"];
var b={};
for(var a=0;
a<d.length;
a++){var c=this.findC("name",d[a]);
if(c){value=c.getValue();
if(value){b[d[a]]=value
}}}return(b)
},reloadGroupStat:function(){Ext.defer(function(){this.groupStat.reload(true,true)
},100,this)
},clearSelectGroupStat:function(){this.groupStat.clearSelect()
}});
Ext.define("CDR.Panel",{extend:"Ext.Panel",alias:"widget.CDRPanelX",subsystem:"cdr",constructor:function(){this.cdrGrid=new CDR.Grid({collapsible:false,region:"center",border:false,floatable:false,_panel:this,_mainCdrTable:true,_enableChartsInTab:true});
var c=[this.cdrGrid];
if(enableGroupsCdr&&!simpleCdr&&user_show_cdr_group()){this.groupPanel=new CDR.GroupPanel({id:"CDR-group-panel",collapsible:true,collapsedCls:"no-border",region:"south",floatable:true,span:true,border:false,title:this.findLangS("title","groups"),_panel:this,_cdrGrid:this.cdrGrid,collapsible:true,header:false});
this.cdrGrid._groupPanel=this.groupPanel;
c.push(this.groupPanel);
this.cdrGrid.grid.store.on("beforeload",a,this);
this.cdrGrid.grid.store.on("load",b,this)
}config={id:"CDR-panel",title:this.findLangS("title","CDR"),iconCls:"icon_menu_cdr",layout:"border",bodyBorder:false,defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:c,listeners:{scope:this,afterrender:function(){if(!Ext.isIE){var d=Ext.get("CDR-panel_header");
if(d){d.setStyle({"padding-top":1,"padding-bottom":1})
}}}},wikiId:"Call_Detail_Record_-_CDR",wikiButtonMarginTop:-1};
this.callParent([config]);
function a(){beginLoadMaskWithStopButton_store(this.cdrGrid.grid.store,"cdrGrid_loadMask")
}function b(){endLoadMaskWithStopButton_store(this.cdrGrid.grid.store);
if(this.cdrGrid.pagingToolbar){if(!this.cdrGrid.pagingToolbar._changePage&&!loadStoreIsCancel(this.cdrGrid.grid.store)){if(this.groupPanel){this.groupPanel.reloadCdrStats(this.cdrGrid,this.cdrGrid.grid.store)
}if(this.cdrGrid.chartsPanel){this.cdrGrid.reloadCharts()
}}this.cdrGrid.pagingToolbar._changePage=false
}}},deselectAllGroupFilters:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupFilters()
}},deselectAllGroupSelects:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupSelects()
}},clearIgnoreReloadGroup:function(){if(this.groupPanel){this.groupPanel.clearIgnoreReloadGroup()
}},setTitleCdr:function(){if(Ext.isIE){var d=this.findLangS("title","CDR");
if(this.cdrGrid.grid.store.proxy.extraParams.fdatefrom){d+="&nbsp;&nbsp;&nbsp;from date&nbsp;"+Ext.Date.format(this.cdrGrid.grid.store.proxy.extraParams.fdatefrom,__format_Date)
}if(this.cdrGrid.grid.store.proxy.extraParams.fdateto){d+="&nbsp;&nbsp;&nbsp;to date&nbsp;"+Ext.Date.format(this.cdrGrid.grid.store.proxy.extraParams.fdateto,__format_Date)
}this.setTitle(d);
return
}var c=this.getDateFrom();
var b=this.getDateTo();
if(!this.formTitle){this.setTitle('<div id="cdr_title" style="position: relative; left: 0; top: 0; width: 500; height: 22"/>');
var a=getStdMenuTimeFrom(this,function(f){this.cdrGrid.grid.store.proxy.extraParams.fdatefrom=dateTimeM(getTimeInterval(f._typeTimeFrom)[0]);
this.cdrGrid.grid.store.proxy.extraParams.fdateto=getTimeInterval(f._typeTimeFrom)[1];
this.cdrGrid.grid.store.proxy.extraParams.flast_days=null;
this.cdrGrid.grid.store.proxy.extraParams.flast_minutes=null;
if(this.cdrGrid.grid.store.proxy.extraParams.fdateto){this.cdrGrid.grid.store.proxy.extraParams.fdateto.timeDefined=false
}this.formTitle.getForm().findField("fdatefrom").setValue(clone(this.cdrGrid.grid.store.proxy.extraParams.fdatefrom));
this.formTitle.getForm().findField("fdateto").setValue(clone(this.cdrGrid.grid.store.proxy.extraParams.fdateto));
this.cdrGrid.reload({page:1})
});
a.items.push({xtype:"menuseparator"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:"Last ",fieldCls:"x-menu-item-text"},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",width:50,_id:"last_days",minValue:0,maxValue:365,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}},select:function(f){if(!f._disableChangeEvent){this.setLastDays(f.getValue(),Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_minutes").getValue())
}},change:function(f){if(!f._disableChangeEvent){this.setLastDays(f.getValue(),Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_minutes").getValue())
}},scope:this},tooltip:lang.days},{xtype:"displayfield",value:lang.days,fieldCls:"x-menu-item-text"}],style:{marginBottom:1}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",width:50,_id:"last_minutes",minValue:0,maxValue:24*60,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}},select:function(f){if(!f._disableChangeEvent){this.setLastDays(Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_days").getValue(),f.getValue())
}},change:function(f){if(!f._disableChangeEvent){this.setLastDays(Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_days").getValue(),f.getValue())
}},scope:this},tooltip:lang.minutes},{xtype:"displayfield",value:lang.minutes,fieldCls:"x-menu-item-text"}]}]}],style:{marginLeft:27}});
a.listeners={beforeshow:function(h){var g=h.findC("_id","last_days");
if(g){g._disableChangeEvent=true;
g.setValue(this.cdrGrid.grid.store.proxy.extraParams.flast_days||"");
delete g._disableChangeEvent
}var f=h.findC("_id","last_minutes");
if(f){f._disableChangeEvent=true;
f.setValue(this.cdrGrid.grid.store.proxy.extraParams.flast_minutes||"");
delete f._disableChangeEvent
}},scope:this};
this.formTitle=new Ext.form.FormPanel({items:{layout:{type:"hbox",align:"middle"},xtype:"container",items:[{xtype:"displayfield",value:"CDR - from date&nbsp;",fieldCls:"x-panel-header-title-default",width:94,height:16},{xtype:"DateField2T",name:"fdatefrom",value:clone(c),format:__format_DateTimeM,width:125+__width_Trigger,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){this.cdrGrid.grid.store.proxy.extraParams.fdatefrom=f;
this.cdrGrid.reload({page:1})
},blur:function(f){var g=f.getValue();
if(g){g.timeDefined=true
}if(!eqDate(g,this.cdrGrid.grid.store.proxy.extraParams.fdatefrom)){this.cdrGrid.grid.store.proxy.extraParams.fdatefrom=g;
this.cdrGrid.reload({page:1})
}},specialkey:function(g,f){if(f.getKey()==f.ENTER){var h=g.rawToValue(g.getRawValue());
if(h){h.timeDefined=true
}if(!eqDate(h,this.cdrGrid.grid.store.proxy.extraParams.fdatefrom)){this.cdrGrid.grid.store.proxy.extraParams.fdatefrom=h;
this.cdrGrid.reload({page:1})
}}}},t2menu:a},{xtype:"displayfield",value:"&nbsp;&nbsp;to date",fieldCls:"x-panel-header-title-default",width:51,height:16},{xtype:"datefield",name:"fdateto",value:clone(b),format:__format_Date,width:90,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){f.timeDefined=false;
this.cdrGrid.grid.store.proxy.extraParams.fdateto=f;
this.cdrGrid.reload({page:1})
},blur:function(g){var f=g.getValue();
if(f){f.timeDefined=false
}if(!eqDate(f,this.cdrGrid.grid.store.proxy.extraParams.fdateto)){this.cdrGrid.grid.store.proxy.extraParams.fdateto=f;
this.cdrGrid.reload({page:1})
}},specialkey:function(h,g){if(g.getKey()==g.ENTER){var f=h.rawToValue(h.getRawValue());
if(f){f.timeDefined=false
}if(!eqDate(f,this.cdrGrid.grid.store.proxy.extraParams.fdateto)){this.cdrGrid.grid.store.proxy.extraParams.fdateto=f;
this.cdrGrid.reload({page:1})
}}}}}]},border:false,bodyStyle:{background:"transparent"},renderTo:"cdr_title",width:600})
}else{this.formTitle.getForm().findField("fdatefrom").setValue(clone(c));
this.formTitle.getForm().findField("fdateto").setValue(clone(b))
}},collapseGroup:function(){if(this.groupPanel){this.groupPanel.collapse()
}},reactivate:function(){if(window.needCdrColumnsReconfigure){this.cdrGrid.reconfigureCdrColumns();
window.needCdrColumnsReconfigure=false
}this.cdrGrid.reactivate();
this.cdrGrid.reload()
},changeTimezone:function(){this.cdrGrid.reload()
},setLastDays:function(c,b){this.cdrGrid.grid.store.proxy.extraParams.flast_days=c;
this.cdrGrid.grid.store.proxy.extraParams.flast_minutes=b;
if(this.setLastDaysTimer){clearTimeout(this.setLastDaysTimer);
delete this.setLastDaysTimer
}var a=this;
this.setLastDaysTimer=setTimeout(function(){a.cdrGrid.reload({page:1});
delete a.setLastDaysTimer
},500)
},getDateFrom:function(){var c=this.cdrGrid.grid.store.proxy.extraParams.fdatefrom;
if(this.cdrGrid.grid.store.proxy.extraParams.flast_minutes>0){var a=new Date(dateTime().getTime()-this.cdrGrid.grid.store.proxy.extraParams.flast_minutes*60*1000);
if(this.cdrGrid.grid.store.proxy.extraParams.flast_days>0){c=date(a);
for(var b=0;
b<this.cdrGrid.grid.store.proxy.extraParams.flast_days;
b++){c=date_prev(c)
}c=completeDateTime(c,a)
}else{c=a
}}else{if(this.cdrGrid.grid.store.proxy.extraParams.flast_days>0){c=date();
for(var b=0;
b<this.cdrGrid.grid.store.proxy.extraParams.flast_days;
b++){c=date_prev(c)
}}}return(c)
},getDateTo:function(){return(this.cdrGrid.grid.store.proxy.extraParams.flast_days>0||this.cdrGrid.grid.store.proxy.extraParams.flast_minutes>0?null:this.cdrGrid.grid.store.proxy.extraParams.fdateto)
}});
Ext.define("CDR.Filter",{singleton:true,subsystem:"cdr",getFieldset:function(b,a){a=a||{};
a.prop=a.prop||{};
if(this["getFieldset_"+b]){return(this["getFieldset_"+b](a))
}},getFieldset_template:function(c){var d=8;
var g=__width_FieldChar(d);
c=Ext.applyIf(c||{},{width:__width_Form(g,180),labelWidth:g});
var a={xtype:"ComboBoxA",name:"filterTemplate",fieldLabel:findLangS(this.subsystem,"field","template"),_tpl:"{textMenu}",width:c.width,labelWidth:c.labelWidth,listConfig:{minWidth:250},aData:{data:[],fields:["id","name","user_id","user_name","textMenu","filterConfig","priv","user_ids","group_ids"]},listeners:{scope:this,select:function(l){var k=l.findFormPanel();
if(k){CDR.Filter.selectFilterTemplate(k,l)
}}},disabled:true,__filter:"cdr",disableTimeInterval:c.disableTimeInterval,disableSelections:c.disableSelections};
var b=[a];
if(!c.disableSaveDeleteFilterButtons){var f=new Ext.Button({text:findLangS(this.subsystem,"button","saveTemplate"),handler:function(l){var k=l.findFormPanel();
if(k){CDR.Filter.saveFilterConfig(k)
}},scope:this,style:{marginLeft:4},hidden:true,_btnId:"saveFilterTemplate"});
var h=new Ext.Button({text:findLangS(this.subsystem,"button","deleteTemplate"),handler:function(l){var k=l.findFormPanel();
if(k){CDR.Filter.deleteFilterConfig(k)
}},scope:this,style:{marginLeft:4},hidden:true,_btnId:"deleteFilterTemplate"});
b.push(f,h)
}if(user&&user.sqlrow&&user.sqlrow.can_audit*1==1){b.push({flex:1,border:false},{xtype:"textarea",name:"audit_reason",width:300,height:60,labelWidth:90,fieldLabel:findLangS(this.subsystem,"field","reasonForAuditLog")})
}return({xtype:"container",layout:"hbox",items:b,style:{paddingBottom:__height_FieldSeparator}})
},getFieldset_common:function(A){Ext.applyIf(A.prop,{fieldaWidth:__width_FieldChar(22),fieldbWidth:__width_FieldChar(22),fieldwWidth:__width_FieldChar(35),fieldFullWidth:__width_FieldChar(62)+4,label1Width:__width_FieldChar(14),label11Width:__width_FieldChar(24),label2aWidth:__width_FieldChar(22),label21aWidth:__width_FieldChar(12),label2bWidth:__width_FieldChar(13),btnSwitchWidth:16,btnSwitchHeight:16,label1Style:{},label1CheckboxStyle:{"margin-left":10},label1aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label1alStyle:{"margin-right":__width_LabelFieldSeparator},label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var r=[];
if(!A.disableTimeInterval){r.push({items:[{xtype:"displayfield_vo3",value:"dateRange:",helpText:"dateRangeHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"dateFrom",_type:"label2ap"},{xtype:"datetimefield",name:"datefrom",value:A.values.fdatefrom,_type:"fielda",inEditor:true,zeroTimeEmpty:true,allowBlankDate:false},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"dateTo",_type:"label2b"},{xtype:"datetimefield",name:"dateto",value:A.values.fdateto,_type:"fieldb",inEditor:true,zeroTimeEmpty:true}]},{items:[{xtype:"displayfield_vo3",value:"lastDaysMinutes:",helpText:"lastDaysMinutesHelp",_type:"label1al"},{xtype:"numberfield",name:"last_days",value:A.values.flast_days,_type:"fielda",minValue:0,maxValue:365,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(D){var C=D.getValue();
if(C==1||C===null){Ext.defer(function(){D.setValue(null)
},1)
}}}},{xtype:"displayfield_vo3",value:lang.days,_type:"label",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"last_minutes",value:A.values.flast_minutes,_type:"fielda",minValue:0,maxValue:24*60,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(D){var C=D.getValue();
if(C==1||C===null){Ext.defer(function(){D.setValue(null)
},1)
}}}},{xtype:"displayfield_vo3",value:lang.minutes,_type:"label",style:{marginLeft:2}}]})
}if(!A.disableSelections&&user_id()){r.push({items:[{xtype:"displayfield_vo3",value:"currentSelection:",helpText:"currentSelectionHelp",_type:"label1al"},{xtype:"checkbox",name:"current_selection",checked:A.values.fcurrent_selection,height:__height_Field,_type:"fielda"}]},{items:[{xtype:"displayfield_vo3",value:"namedSelection:",helpText:"namedSelectionHelp",_type:"label1al"},{xtype:"ComboBoxX",name:"named_selection",value:A.values.fnamed_selection,_type:"fielda",width:A.prop.fieldwWidth,valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_selections",recordStruct:rsUserSelections,extraParams:{public_all_users:true},sortField:"name",columns:[{fields:"name",widthCh:40}],_clearButton:true,editable:false,_autoDisableIfEmpty:true,_autoDisableIfEmptyHandler:function(D,C){if(C&&C.length){D.ownerCt.show()
}}}],hidden:true})
}r.push({items:[{xtype:"container",items:{xtype:"image",src:"images/icon/page_wrench.png",width:14,height:14,helpText:findLangS(this.subsystem,"field_filter","numTriggerHelp"),style:{marginTop:4,marginRight:2,cursor:"pointer"},listeners:{click:{element:"el",fn:function(D,F){var C=Ext.getCmp(F.id).findFormPanel();
if(C){var E=C.getForm().findField("callerd_search_type");
if(E){E.expand()
}}}},scope:this}},width:14,height:14,style:{marginRight:2}},{xtype:"ComboBoxA",name:"callerd_search_type",value:A.values.fcallerd_search_type||0,_type:"combolabel_main",aData:[[0,"num"],[1,"num_start"],[2,"num_end"],[3,"num_contain"],[4,"num_regexp"]],hideTrigger:true,_decWidth:16,_autoSetFirstIfSetEmpty:true},{xtype:"ComboBoxA",name:"callerd_type",value:A.values.fcallerd_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"caller",value:A.values.fcaller,_type:"fielda",helpFieldId:"callerd"},{xtype:"button",name:"callerd_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"called",value:A.values.fcalled,_type:"fieldb",helpFieldId:"callerd"}]},{helpId:"callerd"});
if(window.existsCdrCountryCode){r.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByNumber:",helpText:"countryCodeByNumberHelp",_type:"label1"},{xtype:"ComboBoxA",name:"country_code_callerd_type",value:A.values.fcountry_code_callerd_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"country_tree_field",name:"country_code_caller",value:A.values.fcountry_code_caller,_type:"fielda",helpFieldId:"country_code_caller"},{xtype:"button",name:"country_code_callerd_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"country_code_called_label",value:"called",_type:"label2b"},{xtype:"country_tree_field",name:"country_code_called",value:A.values.fcountry_code_called,_type:"fieldb",helpFieldId:"country_code_called"}]},{helpId:"country_code_by_number"});
r.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByNumberCallerCalledCmp:",helpText:"countryCodeByNumberCallerCalledCmpHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"country_code_callerd_cmp",value:A.values.fcountry_code_callerd_cmp,_type:"fielda",aData:[[1,"eq"],[2,"not_eq"]],_clearButton:true}]})
}r.push({items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_group_id_type",value:A.values.fcallerd_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbNumberGroups",name:"caller_group_id",value:A.values.fcaller_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,helpFieldId:"callerd"},{xtype:"button",name:"callerd_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbNumberGroups",name:"called_group_id",value:A.values.fcalled_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,helpFieldId:"callerd"}]},{helpId:"callerd_group"});
if(!disableShowDomain){r.push({items:[{xtype:"displayfield_vo3",value:"domain:",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_domain_type",value:A.values.fcallerd_domain_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"caller_domain",value:A.values.fcaller_domain,_type:"fielda",helpFieldId:"callerd_domain"},{xtype:"button",name:"callerd_domain_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_domain_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"called_domain",value:A.values.fcalled_domain,_type:"fieldb",helpFieldId:"callerd_domain"}]},{helpId:"callerd_domain"},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_domain_group_id_type",value:A.values.fcallerd_domain_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbDomainGroups",name:"caller_domain_group_id",value:A.values.fcaller_domain_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,helpFieldId:"callerd_domain",extraParams:{side:A.values.fcallerd_domain_group_id_type?_side_CallerNum:null}},{xtype:"button",name:"callerd_domain_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_domain_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbDomainGroups",name:"called_domain_group_id",value:A.values.fcalled_domain_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,helpFieldId:"callerd_domain",extraParams:{side:_side_CalledNum}}]},{helpId:"callerd_domain"})
}r.push({items:[{xtype:"displayfield_vo3",value:"callerName:",_type:"label1al"},{xtype:"textfield",name:"callername",value:A.values.fcallername,_type:"fielda"}]},{items:[{xtype:"displayfield_vo3",value:"IP:",helpText:"IPHelp",_type:"label1"},{xtype:"ComboBoxA",name:"sipcallerdip_type",value:A.values.fsipcallerdip_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"sipcallerip",value:A.values.fsipcallerip,_type:"fielda",helpFieldId:"sipcallerdip"},{xtype:"button",name:"sipcallerdip_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"sipcalledip_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"sipcalledip",value:A.values.fsipcalledip,_type:"fieldb",helpFieldId:"sipcallerdip"}]},{helpId:"sipcallerdip"});
r.push({items:[window.existsCdrProxy?{xtype:"checkbox",name:"sipcallerdip_with_proxy",checked:Ext.isDefined(A.values.fsipcallerdip_with_proxy)?A.values.fsipcallerdip_with_proxy:false,boxLabel:"sipcallerdip_with_proxy",_type:"label1checkbox",helpText:findLangS(this.subsystem,"field_filter","sipcallerdip_with_proxyHelp")}:{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"sipcallerdip_group_id_type",value:A.values.fsipcallerdip_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbIpGroups",name:"sipcallerip_group_id",value:A.values.fsipcallerip_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,helpFieldId:"sipcallerdip"},{xtype:"button",name:"sipcallerdip_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"sipcalledip_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbIpGroups",name:"sipcalledip_group_id",value:A.values.fsipcalledip_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,helpFieldId:"sipcallerdip"}]});
if(window.existsCdrProxy){r.push({items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"displayfield_vo3",name:"proxyip_label",value:"proxyIp:",_type:"label2a"},{xtype:"textfield",name:"proxyip",value:A.values.fproxyip,_type:"fielda"}]})
}if(window.existsCdrCountryCode){r.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByIP:",helpText:"countryCodeByIPHelp",_type:"label1"},{xtype:"ComboBoxA",name:"country_code_sipcallerdip_type",value:A.values.fcountry_code_sipcallerdip_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"country_tree_field",name:"country_code_sipcallerip",value:A.values.fcountry_code_sipcallerip,_type:"fielda",helpFieldId:"country_code_sipcallerip"},{xtype:"button",name:"country_code_sipcallerdip_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"country_code_sipcalledip_label",value:"called",_type:"label2b"},{xtype:"country_tree_field",name:"country_code_sipcalledip",value:A.values.fcountry_code_sipcalledip,_type:"fieldb",helpFieldId:"country_code_sipcalledip"}]},{helpId:"country_code_by_number"});
r.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByIPCallerCalledCmp:",helpText:"countryCodeByIPCallerCalledCmpHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"country_code_sipcallerdip_cmp",value:A.values.fcountry_code_sipcallerdip_cmp,_type:"fielda",aData:[[1,"eq"],[2,"not_eq"]],_clearButton:true}]})
}if(window.existsSipPortCdr){r.push({items:[{xtype:"displayfield_vo3",value:"Port:",helpText:"PortHelp",_type:"label1"},{xtype:"ComboBoxA",name:"sipcallerdport_type",value:A.values.fsipcallerdport_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"sipcallerport",value:A.values.fsipcallerport,_type:"fielda"},{xtype:"button",name:"sipcallerdport_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"sipcalledport_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"sipcalledport",value:A.values.fsipcalledport,_type:"fieldb"}]})
}r.push({items:[{xtype:"displayfield_vo3",value:"codec:",helpText:"codecHelp",_type:"label1al"},{xtype:"CBX_Codec",name:"codec",value:A.values.fcodec,_type:"fielda",hideLabel:true,multiSelect:true,_clearButton:true,width:A.prop.fieldwWidth,_arraySeparator:","}]},{items:[{xtype:"displayfield_vo3",value:"exclude_codec:",helpText:"exclude_codecHelp",_type:"label1al"},{xtype:"CBX_Codec",name:"exclude_codec",value:A.values.fexclude_codec,_type:"fielda",hideLabel:true,multiSelect:true,_clearButton:true,width:A.prop.fieldwWidth,_arraySeparator:","}]});
r.push({items:[{xtype:"displayfield_vo3",value:"callDuration:",helpText:"callDurationHelp",_type:"label11"},{xtype:"displayfield_vo3",value:"operGt",_type:"label21a"},{xtype:"textfield",name:"durationgt",value:A.values.fdurationgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"durationlt",value:A.values.fdurationlt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"connectDuration:",helpText:"connectDurationHelp",_type:"label11"},{xtype:"displayfield_vo3",value:"operGt",_type:"label21a"},{xtype:"textfield",name:"connect_durationgt",value:A.values.fconnect_durationgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"connect_durationlt",value:A.values.fconnect_durationlt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"PDD:",helpText:"PDD_Help",_type:"label11"},{xtype:"displayfield_vo3",value:"operGt",_type:"label21a"},{xtype:"textfield",name:"pddgt",value:A.values.fpddgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"pddlt",value:A.values.fpddlt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"ringingTime:",helpText:"ringingTimeHelp",_type:"label11"},{xtype:"displayfield_vo3",value:"operGt",_type:"label21a"},{xtype:"textfield",name:"ringinggt",value:A.values.fringinggt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"ringinglt",value:A.values.fringinglt,_type:"fieldb"}]});
if(window.existsCdrSipHistory){r.push({items:[{xtype:"displayfield_vo3",value:"allSIPRequests:",helpText:"allSIPRequestsHelp",_type:"label1al"},{xtype:"ListViewEditField",name:"allsiprequests",value:A.values.fallsiprequests,width:A.prop.fieldwWidth,fieldsStore:["request","count"],columns:[{dataIndex:"request",flex:1},{dataIndex:"count",width:__width_ColumnNum(4),renderer:function(C){return(C?">="+C+"x":"")
}}],formItems:function(C,D){return([{xtype:"ComboBoxX",name:"request",url:"php/model/sql.php",module:"cdr_sip_request",recordStruct:rsCdrSipRequest,valueField:"request",displayField:"request",sortField:"request",columns:[{fields:"request",widthCh:20}],_stringValue:true,fieldLabel:"request",width:__width_Form(__width_FieldChar(10),__width_FieldChar(20)),labelWidth:__width_FieldChar(10),allowBlank:false},{xtype:"numberfield",name:"count",minValue:0,maxValue:100,fieldLabel:"count",width:__width_Form(__width_FieldChar(10),__width_FieldNum(5)),labelWidth:__width_FieldChar(10)}])
},getValueFromForm:function(C,D){return({request:D.fieldValues.request,count:D.fieldValues.count})
}}]})
}r.push({items:[{xtype:"displayfield_vo3",value:"lastSIPResponse:",helpText:"lastSIPResponseHelp",_type:"label1al"},{xtype:"textfield",name:"sipresponse",value:A.values.fsipresponse,_type:"fielda"}]});
if(window.existsCdrResponses||window.existsCdrSipHistory){r.push({items:[{xtype:"displayfield_vo3",value:"allSIPResponse:",helpText:"allSIPResponseHelp",_type:"label1al"},{xtype:"textfield",name:"allsipresponse",value:A.values.fallsipresponse,_type:"fielda"}]})
}if(window.existsCdrReason){r.push({items:[{xtype:"displayfield_vo3",value:"reasonSip:",helpText:"reasonSipHelp",_type:"label1al"},{xtype:"textfield",name:"reason_sip",value:A.values.freason_sip,_type:"fielda"}]},{items:[{xtype:"displayfield_vo3",value:"reasonQ850:",helpText:"reasonQ850Help",_type:"label1al"},{xtype:"textfield",name:"reason_q850",value:A.values.freason_q850,_type:"fielda"}]})
}else{r.push({items:[{xtype:"displayfield_vo3",value:"reasonSipQ850:",helpText:"reasonSipHelp",_type:"label1al"},{xtype:"button",iconCls:"icon_exclamation",text:lang.clickMe,handler:function(){Ext.Msg.alert("",findLangS(this.subsystem,"text","missingReasonColumns"))
},scope:this,style:{marginRight:2}},{xtype:"displayfield",value:findLangS(this.subsystem,"text","missingReasonColumns").substr(0,60)+"...",width:A.prop.fieldFullWidth-__width_FieldChar(10),fieldStyle:{"font-style":"italic"},listeners:{scope:this,afterrender:function(C){C.getEl().dom.setAttribute("data-qtip",findLangS(this.subsystem,"text","missingReasonColumns"))
}}}]})
}r.push({items:[{xtype:"displayfield_vo3",value:"trunk:",helpText:"trunkHelp",_type:"label1al"},{xtype:"CBX_Trunk",name:"trunk",value:A.values.ftrunk,_type:"fielda",hideLabel:true,_clearButton:true}]});
r.push({items:[{xtype:"displayfield_vo3",value:"whoHangup:",helpText:"whoHangupHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"who_hangup",value:A.values.fwho_hangup,_type:"fielda",aData:{data:arCallerCalledSide,fields:["id_numb","id_str","descr"]},valueField:"id_numb",displayField:"descr",_clearButton:true}]});
if(window.existsCdrFlags){r.push({items:[{xtype:"displayfield_vo3",value:"unconfirmedBye:",helpText:"unconfirmedByeHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"unconfirmed_bye",value:A.values.funconfirmed_bye,_type:"fielda",aData:{data:[[4,findLangS(this.subsystem,"text","unconfirmedBye"),findLangS(this.subsystem,"text","unconfirmedBye_help")],[8,findLangS(this.subsystem,"text","aloneUnconfirmedBye"),findLangS(this.subsystem,"text","aloneUnconfirmedBye_help")]],fields:["id","descr","qtip"]},multiSelect:true,_clearButton:true,width:A.prop.fieldwWidth,_arraySeparator:","}]})
}var d=findLangS(this.subsystem,"text");
var b=[];
var w=findLangS(this.subsystem,"field_filter","byeCodeHelp")+':<br><br><table class="x-tip-body x-tip-body-default x-tip-body-default"><col width="100">';
for(var n in d){var h=n.match(/^byeText_(\d+)$/);
if(h){var s=h[1];
b.push([s,findLangS(this.subsystem,"text","byeTextShort_"+s),findLangS(this.subsystem,"text","byeText_"+s)]);
w+='<tr><td valign="top" style="padding-top: 3px;">'+findLangS(this.subsystem,"text","byeTextShort_"+s)+'</td><td valign="top" style="padding-top: 3px; padding-left: 5px;">'+findLangS(this.subsystem,"text","byeText_"+s)+"</td></tr>"
}}w+="</table>";
r.push({items:[{xtype:"displayfield_vo3",value:"byeCode:",helpTextSpecify:w,_type:"label1al"},{xtype:"ComboBoxA",name:"bye_code",value:A.values.fbye_code,_type:"fielda",aData:{data:b,fields:["id","descr","qtip"]},multiSelect:true,_clearButton:true,width:A.prop.fieldwWidth,_arraySeparator:","}]});
r.push({items:[{xtype:"displayfield_vo3",value:"byeCorrect:",helpText:"byeCorrectHelp",_type:"label1al"},{xtype:"checkbox",name:"bye",checked:A.values.fbye,height:__height_Field}]},{items:[{xtype:"displayfield_vo3",value:"oneWay:",helpText:"oneWayHelp",_type:"label1al"},{xtype:"checkbox",name:"one_way",checked:A.values.fone_way,height:__height_Field}]},{items:[{xtype:"displayfield_vo3",value:"missingRtp:",helpText:"missingRtpHelp",_type:"label1al"},{xtype:"checkbox",name:"missing_rtp",checked:A.values.fmissing_rtp,height:__height_Field}]});
if(window.existsCdrFlags){r.push({items:[{xtype:"displayfield_vo3",value:"missingSrtpKey:",helpText:"missingSrtKeyHelp",_type:"label1al"},{xtype:"checkbox",name:"missing_srtp_key",checked:A.values.fmissing_srtp_key,height:__height_Field}]},{items:[{xtype:"displayfield_vo3",value:"detectFAS:",helpText:"detectFAShelp",_type:"label1al"},{xtype:"checkbox",name:"detect_fas",checked:A.values.fdetect_fas,height:__height_Field}]},{items:[{xtype:"displayfield_vo3",value:"detectZeroSSRC:",helpText:"detectZeroSSRChelp",_type:"label1al"},{xtype:"checkbox",name:"detect_zerossrc",checked:A.values.fdetect_zerossrc,height:__height_Field}]},{items:[{xtype:"displayfield_vo3",value:"detectSIPALG:",helpText:"detectSIPALGhelp",_type:"label1al"},{xtype:"checkbox",name:"is_sipalg_detected",checked:A.values.fis_sipalg_detected,height:__height_Field}]})
}if(window.existsCdrFlags){var l=["audio","image","video"];
var c=[];
for(var y=0;
y<l.length;
y++){c.push([l[y],findLangS(this.subsystem,"text","sdpMediaType_"+l[y])])
}r.push({items:[{xtype:"displayfield_vo3",value:"sdpMediaType:",helpText:"sdpMediaTypeHelpHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"sdp_media_type",value:A.values.fsdp_media_type,_type:"fielda",aData:c,multiSelect:true,_clearButton:true,_stringValue:true,_arraySeparator:","},{xtype:"displayfield_vo3",value:"sdpMediaType_multipleSelectOperator:",helpText:"sdpMediaType_multipleSelectOperatorHelp",fieldStyle:A.prop.labelFieldStyle,style:{marginLeft:6},_id:"sdp_media_type_multiple_operator_label"},{xtype:"ComboBoxA",name:"sdp_media_type_multiple_operator",value:A.values.fsdp_media_type_multiple_operator||"and",_type:"field",aData:[["and","and"],["or","or"]],width:__width_FieldChar(4)+__width_Trigger,_stringValue:true}]})
}var u=["missing","exists","one_way","two_way"];
var p=[];
for(var y=0;
y<u.length;
y++){p.push([u[y],findLangS(this.subsystem,"text","rtpState_"+u[y])])
}r.push({items:[{xtype:"displayfield_vo3",value:"rtpState:",helpText:"rtpStateHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"rtp_state",value:A.values.frtp_state,_type:"fielda",aData:p,_clearButton:true}]});
if(window.existsCdrFlags){var q=["none","caller","called","caller_or_called","caller_and_called"];
var k=[];
for(var y=0;
y<q.length;
y++){k.push([q[y],findLangS(this.subsystem,"text","changeSrcRtpPort_"+q[y])])
}r.push({items:[{xtype:"displayfield_vo3",value:"changeSrcRtpPort:",helpText:"changeSrcRtpPortHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"change_src_rtp_port",value:A.values.fchange_src_rtp_port,_type:"fielda",aData:k,_clearButton:true}]});
var g=["request_with_response","request_without_response","no_request"];
var m=[];
for(var y=0;
y<g.length;
y++){m.push([g[y],findLangS(this.subsystem,"text","televentRequestResponse_"+g[y])])
}r.push({items:[{xtype:"displayfield_vo3",value:"televentRequestResponse:",helpText:"televentRequestResponseHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"televent_request_response",value:A.values.ftelevent_request_response,_type:"fielda",aData:m,width:A.prop.fieldwWidth,_clearButton:true}]})
}r.push({items:[{xtype:"displayfield_vo3",value:"sipAgent:",helpText:"sipAgentHelp",_type:"label1"},{xtype:"ComboBoxA",name:"ab_ua_type",value:A.values.fab_ua_type||0,_type:"combolabel",aData:[[0,"uaCallerOrCalled"],[1,"uaCaller"]]},{xtype:"textfield",name:"a_ua",value:A.values.fa_ua,_type:"fielda"},{xtype:"button",name:"ab_ua_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"b_ua_label",value:"uaCalled",_type:"label2b"},{xtype:"textfield",name:"b_ua",value:A.values.fb_ua,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"ab_ua_group_id_type",value:A.values.fab_ua_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbUaGroups",name:"a_ua_group_id",value:A.values.fa_ua_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"ab_ua_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"b_ua_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbUaGroups",name:"b_ua_group_id",value:A.values.fb_ua_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]},{items:[{xtype:"displayfield_vo3",value:"saddr:",helpText:"saddrHelp",_type:"label1"},{xtype:"ComboBoxA",name:"ab_saddr_type",value:A.values.fab_saddr_type||0,_type:"combolabel",aData:[[0,"ab_saddr"],[1,"a_saddr"]]},{xtype:"textfield",name:"a_saddr",value:A.values.fa_saddr,_type:"fielda"},{xtype:"button",name:"ab_saddr_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"b_saddr_label",value:"b_saddr",_type:"label2b"},{xtype:"textfield",name:"b_saddr",value:A.values.fb_saddr,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"ab_saddr_group_id_type",value:A.values.fab_saddr_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbIpGroups",name:"a_saddr_group_id",value:A.values.fa_saddr_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"ab_saddr_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"b_saddr_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbIpGroups",name:"b_saddr_group_id",value:A.values.fb_saddr_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]},{items:[{xtype:"displayfield_vo3",value:"callID:",helpText:"callIDHelp",_type:"label1al"},{xtype:"textfield",name:"callid",value:A.values.fcallid,_type:"fielda",width:A.prop.fieldwWidth}]});
if(window.existsCdrNote){r.push({items:[{xtype:"displayfield_vo3",value:"note:",helpText:"noteHelp",_type:"label1al"},{xtype:"textfield",name:"note",value:A.values.fnote,_type:"fielda",width:A.prop.fieldwWidth}]})
}if(window.existsCdrMaxRetransmissionInvite){r.push({items:[{xtype:"displayfield_vo3",value:"maxRetransmissionInvite:",helpText:"maxRetransmissionInviteHelp",_type:"label11"},{xtype:"displayfield_vo3",value:"operGt",_type:"label21a"},{xtype:"textfield",name:"max_retransmission_invite_gt",value:A.values.fmax_retransmission_invite_gt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"max_retransmission_invite_lt",value:A.values.fmax_retransmission_invite_lt,_type:"fieldb"}]})
}if(window.existsCdrFlags){r.push({items:[{xtype:"displayfield_vo3",value:"ipFragmented:",helpText:"ipFragmentedHelp",_type:"label1al"},{xtype:"ComboBoxA",name:"ip_fragmented",value:A.values.fip_fragmented,_type:"fielda",aData:[["no",findLangS(this.subsystem,"text","ipFragmentedNo")],["sip",findLangS(this.subsystem,"text","ipFragmentedSip")],["rtp",findLangS(this.subsystem,"text","ipFragmentedRtp")],["sip_or_rtp",findLangS(this.subsystem,"text","ipFragmentedSipOrRtp")]],_clearButton:true}]})
}var z=getDataCdrCustomHeaders();
if(z){for(var y=0;
y<z.length;
y++){if(z[y].special_type=="max_length_sip_data"||z[y].special_type=="max_length_sip_packet"||z[y].special_type=="max_retransmission_invite"){r.push({items:[{xtype:"displayfield_vo3",value:z[y].name+":",_type:"label11"},{xtype:"displayfield_vo3",value:"operGt",_type:"label21a"},{xtype:"textfield",name:z[y]._column_unique+"_ge",value:A.values["f"+z[y]._column_unique+"_ge"],_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:z[y]._column_unique+"_lt",value:A.values["f"+z[y]._column_unique+"_lt"],_type:"fieldb"}]})
}else{r.push({items:[{xtype:"displayfield_vo3",value:z[y].name+":",_type:"label1al"},{xtype:"textfield",name:z[y]._column_unique,value:A.values["f"+z[y]._column_unique],_type:"fielda",width:A.prop.fieldwWidth}]})
}}r.push({items:[{xtype:"displayfield_vo3",value:"custhead_group:",helpText:"custhead_groupHelp",_type:"label1al"},{xtype:"ComboBoxX",name:"custhead_group_id",value:A.values.fcusthead_group_id||0,_type:"fielda",width:A.prop.fieldwWidth,valueField:"id",displayField:"descr",url:"php/model/sql.php",module:"cb_custhead_cdr_groups",recordStruct:rsCbCustheadCdrGroups,sortField:"descr",columns:[{fields:"descr",widthCh:25},{fields:"custom_header",widthCh:25}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true}]})
}r.push({items:[{xtype:"displayfield_vo3",value:"sensor:",helpText:"sensorHelp",_type:"label1al"},{xtype:"CBX_sensor",name:"sensor_id",value:A.values.fsensor_id||0,_type:"fielda",_noLabel:true,_addEmptySensorId:true,_clearButton:true}]});
if(user_can_alerts_show_sent()){r.push({items:[{xtype:"displayfield_vo3",value:"alertSent:",helpText:"alertSentHelp",_type:"label1al"},{xtype:"CBX_alertsSent",name:"alert_sent_id",value:A.values.falert_sent_id||0,_type:"fielda",extraParams:{only_with_cdr:true},_noLabel:true,_clearButton:true,_maxLenDescr:12,width:A.prop.fieldwWidth}]})
}if(user_can_reports_show_sent()){r.push({items:[{xtype:"displayfield_vo3",value:"reportSent:",helpText:"reportSentHelp",_type:"label1al"},{xtype:"CBX_dailyReportsSent",name:"daily_report_sent_id",value:A.values.fdaily_report_sent_id||0,_type:"fielda",extraParams:{only_with_cdr:true},_noLabel:true,_clearButton:true,_maxLenDescr:12,width:A.prop.fieldwWidth}]})
}for(var y=0;
y<r.length;
y++){if(r[y].items){for(var v=0;
v<r[y].items.length;
v++){if(r[y].items[v].xtype&&r[y].items[v].xtype.match("CBX_")){r[y].items[v].storeAutoLoad=false
}switch(r[y].items[v]._type){case"fielda":Ext.applyIf(r[y].items[v],{width:A.prop.fieldaWidth});
break;
case"fieldb":Ext.applyIf(r[y].items[v],{width:A.prop.fieldbWidth});
break;
case"label1":Ext.applyIf(r[y].items[v],{width:A.prop.label1Width,style:A.prop.label1Style,fieldStyle:A.prop.labelFieldStyle});
break;
case"label11":Ext.applyIf(r[y].items[v],{width:A.prop.label11Width,style:A.prop.label1Style,fieldStyle:A.prop.labelFieldStyle});
break;
case"label1checkbox":Ext.applyIf(r[y].items[v],{width:A.prop.label1Width-A.prop.label1CheckboxStyle["margin-left"],style:A.prop.label1CheckboxStyle,fieldStyle:A.prop.labelFieldStyle});
break;
case"label1a":case"label1ap":case"label1al":Ext.applyIf(r[y].items[v],{width:A.prop.label1Width+A.prop.label2aWidth,style:["label1a","label1ap"].isIn(r[y].items[v]._type)?A.prop.label1aStyle:A.prop.label1alStyle,fieldStyle:clone(A.prop.labelFieldStyle)});
if(r[y].items[v]._type=="label1ap"){Ext.applyIf(r[y].items[v].fieldStyle,{paddingRight:20})
}break;
case"label2a":case"label2ap":Ext.applyIf(r[y].items[v],{width:A.prop.label2aWidth,style:A.prop.label2aStyle,fieldStyle:clone(A.prop.labelFieldStyle)});
if(r[y].items[v]._type=="label2ap"){Ext.applyIf(r[y].items[v].fieldStyle,{paddingRight:20})
}break;
case"label21a":Ext.applyIf(r[y].items[v],{width:A.prop.label21aWidth,style:A.prop.label2aStyle,fieldStyle:A.prop.labelFieldStyle});
break;
case"label2b":Ext.applyIf(r[y].items[v],{width:A.prop.label2bWidth,style:A.prop.label2bStyle,fieldStyle:A.prop.labelFieldStyle});
break;
case"label":Ext.applyIf(r[y].items[v],{fieldStyle:A.prop.labelFieldStyle});
break;
case"combolabel":Ext.applyIf(r[y].items[v],{width:A.prop.label2aWidth,style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(D){var C=D.findFormPanel();
if(C){CDR.Filter.setContextFields(C)
}}}});
break;
case"combolabel_main":Ext.applyIf(r[y].items[v],{width:A.prop.label1Width-(r[y].items[v]._decWidth||0),fieldStyle:{"text-align":"left",background:__color_FormBackground,border:"none","padding-left":"0px !important"},listeners:{select:function(D){var C=D.findFormPanel();
if(C){var E=C.getForm().findField("caller");
if(E){E.focus(false,200)
}CDR.Filter.setContextFields(C)
}},afterrender:function(C){C.inputWrap.setStyle({border:"none"})
}}});
break;
case"btnswitch":Ext.applyIf(r[y].items[v],{width:A.prop.btnSwitchWidth,border:false,style:{background:"transparent",marginTop:2,marginLeft:4,marginRight:4,height:A.prop.btnSwitchHeight},cls:"icon_arrow_switch_lr",handler:function(D){var C=D.findFormPanel();
if(C){CDR.Filter.switchContentFields(C,D.name)
}}});
break;
case"btnswitch_filler":Ext.applyIf(r[y].items[v],{xtype:"container",layout:"hbox",width:A.prop.btnSwitchWidth+8,height:10,border:true});
break
}switch(r[y].items[v]._type){case"field":case"fielda":case"fieldb":cascadeApplyIf(r[y].items[v],{listeners:{}},"listeners",{change:function(D){var C=D.findFormPanel();
if(C){CDR.Filter.setContextFields(C,true,D)
}},select:function(D){var C=D.findFormPanel();
if(C){CDR.Filter.setContextFields(C,true,D)
}},beforetriggeraction:B,focus:B});
break
}}}if(r[y].helpId){if(A.enableHelpFields){Ext.applyIf(r[y],{xtype:"displayfield",value:findLangS(this.subsystem,"field_filter_help",r[y].helpId),style:{marginLeft:20,paddingBottom:0,paddingBottom:0},fieldStyle:{"font-style":"italic","font-size":"90%"},hidden:true})
}}else{Ext.applyIf(r[y],{xtype:"container",layout:"hbox",style:{paddingBottom:__height_FieldSeparator}})
}}if(!A.enableHelpFields){var a=[];
for(var y=0;
y<r.length;
y++){if(!r[y].helpId){a.push(r[y])
}}r=a
}return(this.completeFields(r));
function B(D){var C=D.findFormPanel();
if(C){Ext.defer(function(){o(D,D.helpFieldId,C)
},250)
}}function o(G,F,C){if(mouseState.down){Ext.defer(function(){o(G,F,C)
},250);
return
}var D=G.isExpanded;
var E=false;
if(C._activeFieldWithHelp){E=t(C._activeFieldWithHelp.helpFieldId,C,G)||E;
C._activeFieldWithHelp=null
}if(G&&F){C._activeFieldWithHelp=G;
E=f(G.helpFieldId,C)||E
}if(G.doAlign){G.doAlign()
}if(G.adjustPickerPosition){G.adjustPickerPosition()
}if(D&&E){Ext.defer(function(){G.expand()
},10)
}}function f(H,D){var I=CDR.Filter.getFormTabPanel(D);
if(I){var E=D.findC("helpId",H);
if(E&&E.value&&!E.isVisible()){if(!I._origHeight){I._origHeight=I.getHeight()
}var C=I.getActiveTab();
var G=null;
if(C&&C.getEl()&&C.getEl().getScrollTop){G=C.getEl().getScrollTop()
}E.show();
if(G&&C&&C.getEl()&&C.getEl().setScrollTop){C.getEl().setScrollTop(G)
}var F=getCascadeMaxHeight(I);
if(F!=I._origHeight){I.setHeight(F)
}return(true)
}}return(false)
}function t(I,D,H){var J=CDR.Filter.getFormTabPanel(D);
if(J){var E=D.findC("helpId",I);
if(E&&E.value&&E.isVisible()){var C=J.getActiveTab();
var G=null;
var F=null;
if(C&&C.getEl()&&C.getEl().getScrollTop){G=C.getEl().getScrollTop();
if(H.getEl()){F=getAbsolutePosition(H.getEl().dom,C.id)
}}E.hide();
if(J._origHeight&&J._origHeight!=J.getHeight()){J.setHeight(J._origHeight)
}if(G&&C&&C.getEl()&&C.getEl().setScrollTop){C.getEl().setScrollTop(G);
if(H.getEl()){newPosFieldInActiveTab=getAbsolutePosition(H.getEl().dom,C.id);
if(F&&F.length>1&&F[1]&&newPosFieldInActiveTab&&newPosFieldInActiveTab[1]&&newPosFieldInActiveTab[1]<F[1]&&F[1]-newPosFieldInActiveTab[1]<G){C.getEl().setScrollTop(G-(F[1]-newPosFieldInActiveTab[1]))
}}}return(true)
}}return(false)
}},getFieldset_rtp1:function(c){Ext.applyIf(c.prop,{fieldaWidth:__width_FieldChar(10),fieldbWidth:__width_FieldChar(10),fieldnWidth:__width_FieldNum(5),field_ip_port:__width_FieldNum(18),label1Width:__width_FieldChar(20),label11Width:__width_FieldChar(30),label2aWidth:__width_FieldChar(8),label21aWidth:__width_FieldChar(6),label2bWidth:__width_FieldChar(13),labelComboCallerCalledWidth:__width_FieldChar(15),label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelComboCallerCalledStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator,"margin-left":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[];
if(window.existsCdrRtpSport){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTPport:",helpText:"RTPportHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"rtp_port_sd_type",value:c.values.frtp_port_sd_type||0,_type:"callerd_combo",aData:[[0,"sourceOrDest"],[1,"source"]]},{xtype:"numberfield",name:"rtp_port_source",value:c.values.frtp_port_source,width:c.prop.fieldaWidth,minValue:1,maxValue:65535},{xtype:"container",width:c.prop.field_ip_port-c.prop.fieldaWidth},{xtype:"displayfield_vo3",name:"rtp_port_dest_label",value:"dest",style:{marginLeft:__width_FieldSeparator*2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"rtp_port_dest",value:c.values.frtp_port_dest,width:c.prop.fieldaWidth,minValue:1,maxValue:65535}],style:{paddingBottom:__height_FieldSeparator}});
a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTPip_port:",helpText:"RTPip_portHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"rtp_ip_port_sd_type",value:c.values.frtp_ip_port_sd_type||0,_type:"callerd_combo",aData:[[0,"sourceOrDest"],[1,"source"]]},{xtype:"ListViewEditField",name:"rtp_ip_port_source",value:c.values.frtp_ip_port_source,width:c.prop.field_ip_port,typeValue:"ip_or_port_or_net",enableIP_0:true,enablePort_0:true,newValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),editValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),newValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_new"),editValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_edit")},{xtype:"displayfield_vo3",name:"rtp_ip_port_dest_label",value:"dest",style:{marginLeft:__width_FieldSeparator*2,marginRight:__width_FieldSeparator}},{xtype:"ListViewEditField",name:"rtp_ip_port_dest",value:c.values.frtp_ip_port_dest,width:c.prop.field_ip_port,typeValue:"ip_or_port_or_net",enableIP_0:true,enablePort_0:true,newValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),editValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),newValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_new"),editValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_edit")}],style:{paddingBottom:__height_FieldSeparator}})
}else{a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTPport:",helpText:"RTPportHelp",width:c.prop.label1Width},{xtype:"displayfield_vo3",value:"",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"numberfield",name:"rtp_port",width:c.prop.fieldaWidth,value:c.values.frtp_port,minValue:1,maxValue:65535}],style:{paddingBottom:__height_FieldSeparator}});
a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTPip_port:",helpText:"RTPip_portHelp",width:c.prop.label1Width},{xtype:"displayfield_vo3",value:"",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"ListViewEditField",name:"rtp_ip_port",value:c.values.frtp_ip_port,width:c.prop.field_ip_port,typeValue:"ip_or_port_or_net",enableIP_0:true,enablePort_0:true,newValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),editValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),newValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_new"),editValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_edit")}],style:{paddingBottom:__height_FieldSeparator}})
}if(window.existsCdrRtpFlags){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTPstreamUsedInAnotherCall:",helpText:"RTPstreamUsedInAnotherCallHelp",style:{marginRight:__width_FieldSeparator}},{xtype:"checkbox",name:"rtp_stream_used_in_another_call",checked:c.values.frtp_stream_used_in_another_call}],style:{paddingBottom:__height_FieldSeparator}})
}if(window.existsCdrSdp){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"SDPip_port:",helpText:"SDPip_portHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"sdp_ip_port_sd_type",value:c.values.fsdp_ip_port_sd_type||0,_type:"callerd_combo",aData:[[0,"sourceOrDest"],[1,"source"]]},{xtype:"ListViewEditField",name:"sdp_ip_port_source",value:c.values.fsdp_ip_port_source,width:c.prop.field_ip_port,typeValue:"ip_or_port_or_net",enableIP_0:true,enablePort_0:true,newValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),editValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),newValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_new"),editValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_edit")},{xtype:"displayfield_vo3",name:"sdp_ip_port_dest_label",value:"dest",style:{marginLeft:__width_FieldSeparator*2,marginRight:__width_FieldSeparator}},{xtype:"ListViewEditField",name:"sdp_ip_port_dest",value:c.values.fsdp_ip_port_dest,width:c.prop.field_ip_port,typeValue:"ip_or_port_or_net",enableIP_0:true,enablePort_0:true,newValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),editValue_fieldLabel:findLangS(this.subsystem,"field_filter","ip_net_port_label"),newValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_new"),editValue_title:findLangS(this.subsystem,"field_filter","ip_net_port_title_edit")}],style:{paddingBottom:__height_FieldSeparator}})
}if(window.rtpQualityUse){a.push({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:5}}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTCPj:",helpText:"RTCPjHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"rtcp_jitter_callerd_type",value:c.values.frtcp_jitter_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:"RTCPjMax",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_maxjitter",width:c.prop.fieldaWidth,value:c.values.frtcp_maxjitter},{xtype:"displayfield_vo3",value:"RTCPjAvg",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_avgjitter",width:c.prop.fieldbWidth,value:c.values.frtcp_avgjitter}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"rtcp_jitter_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:"RTCPjMax",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_maxjitter_called",width:c.prop.fieldaWidth,value:c.values.frtcp_maxjitter_called},{xtype:"displayfield_vo3",value:"RTCPjAvg",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_avgjitter_called",width:c.prop.fieldbWidth,value:c.values.frtcp_avgjitter_called}],style:{paddingBottom:__height_FieldSeparator},_id:"rtcp_jitter_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTCPl:",helpText:"RTCPlHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"rtcp_fr_callerd_type",value:c.values.frtcp_fr_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:"RTCPlMax",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_maxfr",width:c.prop.fieldaWidth,value:c.values.frtcp_maxfr},{xtype:"displayfield_vo3",value:"RTCPjAvg",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_avgfr",width:c.prop.fieldbWidth,value:c.values.frtcp_avgfr}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"rtcp_fr_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:"RTCPlMax",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_maxfr_called",width:c.prop.fieldaWidth,value:c.values.frtcp_maxfr_called},{xtype:"displayfield_vo3",value:"RTCPjAvg",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_avgfr_called",width:c.prop.fieldbWidth,value:c.values.frtcp_avgfr_called}],style:{paddingBottom:__height_FieldSeparator},_id:"rtcp_fr_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"RTCPrtd:",helpText:"RTCPrtdHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"rtcp_rtd_callerd_type",value:c.values.frtcp_rtd_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:"RTCPrtdMax",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_maxrtd",width:c.prop.fieldaWidth,value:c.values.frtcp_maxrtd},{xtype:"displayfield_vo3",value:"RTCPrtdAvg",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_avgrtd",width:c.prop.fieldbWidth,value:c.values.frtcp_avgrtd}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"rtcp_rtd_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:"RTCPrtdMax",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_maxrtd_called",width:c.prop.fieldaWidth,value:c.values.frtcp_maxrtd_called},{xtype:"displayfield_vo3",value:"RTCPrtdAvg",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_avgrtd_called",width:c.prop.fieldbWidth,value:c.values.frtcp_avgrtd_called}],style:{paddingBottom:__height_FieldSeparator},_id:"rtcp_rtd_called"});
if(existsFracLostPktC){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"frLostPkts:",helpText:"frLostPktsHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"rtcp_frl_pkt_callerd_type",value:c.values.frtcp_frl_pkt_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_frl_pkt_ge",width:c.prop.fieldaWidth,value:c.values.frtcp_frl_pkt_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_frl_pkt_lt",width:c.prop.fieldbWidth,value:c.values.frtcp_frl_pkt_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"rtcp_frl_pkt_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"rtcp_frl_pkt_ge_called",width:c.prop.fieldaWidth,value:c.values.frtcp_frl_pkt_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"rtcp_frl_pkt_lt_called",width:c.prop.fieldbWidth,value:c.values.frtcp_frl_pkt_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"rtcp_frl_pkt_called"})
}else{a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"frLostPkts:",helpText:"frLostPktsHelp:",width:c.prop.label1Width},{xtype:"button",iconCls:"icon_exclamation",text:lang.clickMe,handler:function(){Ext.Msg.alert("",findLangS(this.subsystem,"text","missingFracLostPktCColumns"))
},scope:this,style:{marginRight:2,marginLeft:__width_FieldSeparator}},{xtype:"displayfield",value:findLangS(this.subsystem,"text","missingFracLostPktCColumns").substr(0,80)+"...",width:c.prop.fieldFullWidth,fieldStyle:{"font-style":"italic"},listeners:{scope:this,afterrender:function(f){f.getEl().dom.setAttribute("data-qtip",findLangS(this.subsystem,"text","missingFracLostPktCColumns"))
}}}],style:{paddingBottom:__height_FieldSeparator}})
}}if(window.existsLastRtpFromEnd){a.push({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:5}}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"a_lastRtpFromEnd:",helpText:"a_lastRtpFromEndHelp",width:c.prop.label11Width},{xtype:"displayfield_vo3",value:"=",width:c.prop.label21aWidth,style:c.prop.label2aStyle},{xtype:"numberfield",name:"a_last_rtp_from_end_eq",value:c.values.fa_last_rtp_from_end_eq,width:c.prop.fieldnWidth,minValue:0,maxValue:999,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:">",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"a_last_rtp_from_end_gt",value:c.values.fa_last_rtp_from_end_gt,width:c.prop.fieldnWidth,minValue:0,maxValue:999,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"a_last_rtp_from_end_lt",value:c.values.fa_last_rtp_from_end_lt,width:c.prop.fieldnWidth,minValue:0,maxValue:999,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",width:c.prop.label11Width},{xtype:"displayfield",width:c.prop.label21aWidth,style:c.prop.label2aStyle},{xtype:"radiobuttonsgroup",layout:"hbox",name:"ab_last_rtp_from_end_or",value:c.values.fab_last_rtp_from_end_or||false,items:[{boxLabel:"and",inputValue:0},{boxLabel:"or",inputValue:1,style:{marginLeft:5}}],flex:1}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"b_lastRtpFromEnd:",helpText:"b_lastRtpFromEndHelp",width:c.prop.label11Width},{xtype:"displayfield_vo3",value:"=",width:c.prop.label21aWidth,style:c.prop.label2aStyle},{xtype:"numberfield",name:"b_last_rtp_from_end_eq",value:c.values.fb_last_rtp_from_end_eq,width:c.prop.fieldnWidth,minValue:0,maxValue:999,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:">",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"b_last_rtp_from_end_gt",value:c.values.fb_last_rtp_from_end_gt,width:c.prop.fieldnWidth,minValue:0,maxValue:999,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"b_last_rtp_from_end_lt",value:c.values.fb_last_rtp_from_end_lt,width:c.prop.fieldnWidth,minValue:0,maxValue:999,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}})
}for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){switch(a[d].items[b]._type){case"callerd_combo":Ext.applyIf(a[d].items[b],{width:c.prop.labelComboCallerCalledWidth,style:{"margin-right":__width_LabelFieldSeparator,"margin-left":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f)
}}}});
break;
case"callerd_called_label":Ext.applyIf(a[d].items[b],{width:c.prop.labelComboCallerCalledWidth,style:c.prop.labelComboCallerCalledStyle,fieldStyle:{"padding-right":__width_Trigger+3}});
break
}if(a[d].items[b].xtype.match(/displayfield/)){if(a[d].items[b].fieldStyle){Ext.applyIf(a[d].items[b].fieldStyle,c.prop.labelFieldStyle)
}else{a[d].items[b].fieldStyle=c.prop.labelFieldStyle
}}}}}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}},select:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}}},function(f){return(f.xtype=="textfield"||f.xtype=="numberfield"||f.xtype=="radiobuttonsgroup")
});
return(this.completeFields(a))
},getFieldset_rtp2:function(a){Ext.applyIf(a.prop,{labelWidth:__width_FieldChar(16)+4,labelComboCallerCalledWidth:__width_FieldChar(15),labelComboCallerCalledStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator,"margin-left":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var h=[];
if(window.rtpQualityUse){var c=[["mosf1","mosf1_called","Fixed 50",60],["mosf2","mosf2_called","Fixed 200",60],["mosadapt","mosadapt_called","Adaptive 500",100]];
if(existsMosLqoCdr){c.push(["mos_lqo_caller","mos_lqo_called","LQO",60])
}for(var d=0;
d<3;
d++){var k=[];
k.push(d==0?{xtype:"displayfield_vo3",value:"MOS:",helpText:"MOSHelp",width:a.prop.labelWidth}:d==1?{xtype:"ComboBoxA",name:"mos_callerd_type",value:a.values.fmos_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]}:{xtype:"displayfield_vo3",name:"mos_called_label",value:"called",_type:"callerd_called_label"});
for(var f=0;
f<c.length;
f++){k.push(d==0?{xtype:"displayfield_vo3",value:c[f][2],width:c[f][3],style:{marginRight:__width_FieldSeparator}}:{xtype:"textfield",name:c[f][d-1],value:a.values["f"+c[f][d-1]],width:c[f][3],fieldStyle:{width:45},style:{marginRight:__width_FieldSeparator,paddingRight:c[f][3]-45}})
}h.push({xtype:"container",layout:"hbox",items:k,style:{paddingBottom:__height_FieldSeparator},_id:d==2?"mos_called":undefined})
}var l=[50,70,90,120,150,200,300];
for(var d=0;
d<3;
d++){var g=[];
g.push(d==0?{xtype:"displayfield_vo3",value:"delay:",helpText:"delayHelp",width:a.prop.labelWidth/2}:d==1?{xtype:"ComboBoxA",name:"_d_callerd_type",value:a.values.f_d_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]}:{xtype:"displayfield_vo3",name:"_d_called_label",value:"called",_type:"callerd_called_label"});
if(d==0){g.push({xtype:"checkbox",name:"_d_strict",checked:a.values.f_d_strict,width:a.prop.labelWidth/2,boxLabel:findLangS(this.subsystem,"field_filter","delay_strict"),helpText:findLangS(this.subsystem,"field_filter","delay_strictHelp")})
}for(var f=0;
f<l.length;
f++){g.push(d==0?{xtype:"displayfield_vo3",value:"> "+l[f],width:45,style:{marginRight:__width_FieldSeparator}}:{xtype:"textfield",name:"_d"+l[f]+(d==2?"_called":""),value:a.values["f_d"+l[f]+(d==2?"_called":"")],width:45,fieldStyle:{width:45},style:{marginRight:__width_FieldSeparator}})
}h.push({xtype:"container",layout:"hbox",items:g,style:{paddingBottom:__height_FieldSeparator},_id:d==2?"_d_called":undefined})
}for(var d=0;
d<3;
d++){var b=[];
b.push(d==0?{xtype:"displayfield_vo3",value:"loss:",helpText:"lossHelp",width:a.prop.labelWidth/2}:d==1?{xtype:"ComboBoxA",name:"loss_callerd_type",value:a.values.floss_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]}:{xtype:"displayfield_vo3",name:"loss_called_label",value:"called",_type:"callerd_called_label"});
if(d==0){b.push({xtype:"checkbox",name:"loss_strict",checked:a.values.floss_strict,width:a.prop.labelWidth/2,boxLabel:findLangS(this.subsystem,"field_filter","loss_strict"),helpText:findLangS(this.subsystem,"field_filter","loss_strictHelp")})
}for(var f=0;
f<10;
f++){b.push(d==0?{xtype:"displayfield_vo3",value:String(f+1),width:45,style:{marginRight:__width_FieldSeparator}}:{xtype:"textfield",name:"loss"+(f+1)+(d==2?"_called":""),value:a.values["floss"+(f+1)+(d==2?"_called":"")],width:45,fieldStyle:{width:45},style:{marginRight:__width_FieldSeparator}})
}h.push({xtype:"container",layout:"hbox",items:b,style:{paddingBottom:__height_FieldSeparator},_id:d==2?"loss_called":undefined})
}}for(var f=0;
f<h.length;
f++){if(h[f].items){for(var d=0;
d<h[f].items.length;
d++){switch(h[f].items[d]._type){case"callerd_combo":Ext.applyIf(h[f].items[d],{width:a.prop.labelComboCallerCalledWidth,style:{"margin-right":__width_LabelFieldSeparator,"margin-left":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(n){var m=n.findFormPanel();
if(m){CDR.Filter.setContextFields(m)
}}}});
break;
case"callerd_called_label":Ext.applyIf(h[f].items[d],{width:a.prop.labelComboCallerCalledWidth,style:a.prop.labelComboCallerCalledStyle,fieldStyle:{"padding-right":__width_Trigger+3}});
break
}if(h[f].items[d].xtype.match(/displayfield/)){if(h[f].items[d].fieldStyle){Ext.applyIf(h[f].items[d].fieldStyle,a.prop.labelFieldStyle)
}else{h[f].items[d].fieldStyle=a.prop.labelFieldStyle
}}}}}recurseCascadeApplyIf(h,{listeners:{}},"listeners",{change:function(n){var m=n.findFormPanel();
if(m){CDR.Filter.setContextFields(m,true,n)
}},select:function(n){var m=n.findFormPanel();
if(m){CDR.Filter.setContextFields(m,true,n)
}}},function(m){return(m.xtype=="textfield")
});
return(this.completeFields(h))
},getFieldset_rtp3:function(c){Ext.applyIf(c.prop,{fieldaWidth:__width_FieldChar(10),fieldbWidth:__width_FieldChar(10),fieldFullWidth:__width_FieldChar(80),label1Width:__width_FieldChar(14),label2aWidth:__width_FieldChar(8),label2bWidth:__width_FieldChar(13),labelComboCallerCalledWidth:__width_FieldChar(15),label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelComboCallerCalledStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator,"margin-left":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[];
if(window.rtpQualityUse){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"delaySum",helpText:"delaySumHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"delay_sum_callerd_type",value:c.values.fdelay_sum_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"delay_sum_ge",width:c.prop.fieldaWidth,value:c.values.fdelay_sum_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"delay_sum_lt",width:c.prop.fieldbWidth,value:c.values.fdelay_sum_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"delay_sum_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"delay_sum_ge_called",width:c.prop.fieldaWidth,value:c.values.fdelay_sum_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"delay_sum_lt_called",width:c.prop.fieldbWidth,value:c.values.fdelay_sum_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"delay_sum_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"delayAvg",helpText:"delayAvgHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"delay_avg_callerd_type",value:c.values.fdelay_avg_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"delay_avg_ge",width:c.prop.fieldaWidth,value:c.values.fdelay_avg_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"delay_avg_lt",width:c.prop.fieldbWidth,value:c.values.fdelay_avg_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"delay_avg_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"delay_avg_ge_called",width:c.prop.fieldaWidth,value:c.values.fdelay_avg_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"delay_avg_lt_called",width:c.prop.fieldbWidth,value:c.values.fdelay_avg_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"delay_avg_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"jitterMax",helpText:"jitterMaxHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"jitter_max_callerd_type",value:c.values.fjitter_max_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"jitter_max_ge",width:c.prop.fieldaWidth,value:c.values.fjitter_max_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"jitter_max_lt",width:c.prop.fieldbWidth,value:c.values.fjitter_max_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"jitter_max_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"jitter_max_ge_called",width:c.prop.fieldaWidth,value:c.values.fjitter_max_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"jitter_max_lt_called",width:c.prop.fieldbWidth,value:c.values.fjitter_max_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"jitter_max_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"jitterAvg",helpText:"jitterAvgHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"jitter_avg_callerd_type",value:c.values.fjitter_avg_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"jitter_avg_ge",width:c.prop.fieldaWidth,value:c.values.fjitter_avg_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"jitter_avg_lt",width:c.prop.fieldbWidth,value:c.values.fjitter_avg_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"jitter_avg_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"jitter_avg_ge_called",width:c.prop.fieldaWidth,value:c.values.fjitter_avg_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"jitter_avg_lt_called",width:c.prop.fieldbWidth,value:c.values.fjitter_avg_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"jitter_avg_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosMin:",helpText:"mosMinHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_min_callerd_type",value:c.values.fmos_min_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_min_ge",width:c.prop.fieldaWidth,value:c.values.fmos_min_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_min_lt",width:c.prop.fieldbWidth,value:c.values.fmos_min_lt},{xtype:"displayfield_vo3",width:20},{xtype:"checkbox",name:"mos_min_chart_field",value:c.values.fmos_min_chart_field,boxLabel:findLangS(this.subsystem,"field_filter","chart_filter"),helpText:findLangS(this.subsystem,"field_filter","chart_filterHelp")}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_min_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_min_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_min_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_min_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_min_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_min_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosF1Min",helpText:"mosF1MinHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_f1_min_callerd_type",value:c.values.fmos_f1_min_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_f1_min_ge",width:c.prop.fieldaWidth,value:c.values.fmos_f1_min_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_f1_min_lt",width:c.prop.fieldbWidth,value:c.values.fmos_f1_min_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_f1_min_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_f1_min_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_f1_min_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_f1_min_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_f1_min_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_f1_min_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosF2Min",helpText:"mosF2MinHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_f2_min_callerd_type",value:c.values.fmos_f2_min_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_f2_min_ge",width:c.prop.fieldaWidth,value:c.values.fmos_f2_min_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_f2_min_lt",width:c.prop.fieldbWidth,value:c.values.fmos_f2_min_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_f2_min_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_f2_min_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_f2_min_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_f2_min_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_f2_min_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_f2_min_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosAdaptMin",helpText:"mosAdaptMinHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_adapt_min_callerd_type",value:c.values.fmos_adapt_min_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_adapt_min_ge",width:c.prop.fieldaWidth,value:c.values.fmos_adapt_min_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_adapt_min_lt",width:c.prop.fieldbWidth,value:c.values.fmos_adapt_min_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_adapt_min_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_adapt_min_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_adapt_min_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_adapt_min_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_adapt_min_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_adapt_min_called"});
if(existsMosXrCdr){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosXrAvg:",helpText:"mosXrAvgHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_xr_avg_callerd_type",value:c.values.fmos_xr_avg_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_xr_avg_ge",width:c.prop.fieldaWidth,value:c.values.fmos_xr_avg_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_xr_avg_lt",width:c.prop.fieldbWidth,value:c.values.fmos_xr_avg_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_xr_avg_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_xr_avg_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_xr_avg_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_xr_avg_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_xr_avg_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_xr_avg_called"});
a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosXrMin:",helpText:"mosXrMinHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_xr_min_callerd_type",value:c.values.fmos_xr_min_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_xr_min_ge",width:c.prop.fieldaWidth,value:c.values.fmos_xr_min_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_xr_min_lt",width:c.prop.fieldbWidth,value:c.values.fmos_xr_min_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_xr_min_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_xr_min_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_xr_min_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_xr_min_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_xr_min_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_xr_min_called"})
}if(existsMosSilenceCdr){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosSilenceAvg:",helpText:"mosSilenceAvgHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_silence_avg_callerd_type",value:c.values.fmos_silence_avg_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_silence_avg_ge",width:c.prop.fieldaWidth,value:c.values.fmos_silence_avg_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_silence_avg_lt",width:c.prop.fieldbWidth,value:c.values.fmos_silence_avg_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_silence_avg_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_silence_avg_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_silence_avg_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_silence_avg_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_silence_avg_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_silence_avg_called"});
a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"mosSilenceMin:",helpText:"mosSilenceMinHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"mos_silence_min_callerd_type",value:c.values.fmos_silence_min_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_silence_min_ge",width:c.prop.fieldaWidth,value:c.values.fmos_silence_min_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_silence_min_lt",width:c.prop.fieldbWidth,value:c.values.fmos_silence_min_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"mos_silence_min_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"mos_silence_min_ge_called",width:c.prop.fieldaWidth,value:c.values.fmos_silence_min_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"mos_silence_min_lt_called",width:c.prop.fieldbWidth,value:c.values.fmos_silence_min_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"mos_silence_min_called"})
}a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"packetLossPerc:",helpText:"packetLossPercHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"packet_loss_perc_callerd_type",value:c.values.fpacket_loss_perc_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"packet_loss_perc_ge",width:c.prop.fieldaWidth,value:c.values.fpacket_loss_perc_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"packet_loss_perc_lt",width:c.prop.fieldbWidth,value:c.values.fpacket_loss_perc_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"packet_loss_perc_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"packet_loss_perc_ge_called",width:c.prop.fieldaWidth,value:c.values.fpacket_loss_perc_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"packet_loss_perc_lt_called",width:c.prop.fieldbWidth,value:c.values.fpacket_loss_perc_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"packet_loss_perc_called"})
}if(window.existsCdrSilence){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"silence:",helpText:"silenceHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"silence_callerd_type",value:c.values.fsilence_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"silence_ge",width:c.prop.fieldaWidth,value:c.values.fsilence_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"silence_lt",width:c.prop.fieldbWidth,value:c.values.fsilence_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"silence_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"silence_ge_called",width:c.prop.fieldaWidth,value:c.values.fsilence_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"silence_lt_called",width:c.prop.fieldbWidth,value:c.values.fsilence_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"silence_called"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"silenceEnd:",helpText:"silenceEndHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"silence_end_callerd_type",value:c.values.fsilence_end_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"silence_end_ge",width:c.prop.fieldaWidth,value:c.values.fsilence_end_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"silence_end_lt",width:c.prop.fieldbWidth,value:c.values.fsilence_end_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"silence_end_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"silence_end_ge_called",width:c.prop.fieldaWidth,value:c.values.fsilence_end_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"silence_end_lt_called",width:c.prop.fieldbWidth,value:c.values.fsilence_end_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"silence_end_called"})
}else{a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"silence:",helpText:"silenceHelp",width:c.prop.label1Width},{xtype:"button",iconCls:"icon_exclamation",text:lang.clickMe,handler:function(){Ext.Msg.alert("",findLangS(this.subsystem,"text","missingSilenceColumns"))
},scope:this,style:{marginRight:2,marginLeft:__width_FieldSeparator}},{xtype:"displayfield",value:findLangS(this.subsystem,"text","missingSilenceColumns").substr(0,80)+"...",width:c.prop.fieldFullWidth-__width_FieldChar(10),fieldStyle:{"font-style":"italic"},listeners:{scope:this,afterrender:function(f){f.getEl().dom.setAttribute("data-qtip",findLangS(this.subsystem,"text","missingSilenceColumns"))
}}}],style:{paddingBottom:__height_FieldSeparator}})
}if(existsCdrClipping){a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"clipping:",helpText:"clippingHelp",width:c.prop.label1Width},{xtype:"ComboBoxA",name:"clipping_callerd_type",value:c.values.fclipping_callerd_type||0,_type:"callerd_combo",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"clipping_ge",width:c.prop.fieldaWidth,value:c.values.fclipping_ge},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"clipping_lt",width:c.prop.fieldbWidth,value:c.values.fclipping_lt}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",width:c.prop.label1Width},{xtype:"displayfield_vo3",name:"clipping_called_label",value:"called",_type:"callerd_called_label"},{xtype:"displayfield_vo3",value:">=",width:c.prop.label2aWidth,style:c.prop.label2aStyle},{xtype:"textfield",name:"clipping_ge_called",width:c.prop.fieldaWidth,value:c.values.fclipping_ge_called},{xtype:"displayfield_vo3",value:"<",width:c.prop.label2bWidth,style:c.prop.label2bStyle},{xtype:"textfield",name:"clipping_lt_called",width:c.prop.fieldbWidth,value:c.values.fclipping_lt_called}],style:{paddingBottom:__height_FieldSeparator},_id:"clipping_called"})
}else{a.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"clipping:",helpText:"clippingHelp",width:c.prop.label1Width},{xtype:"button",iconCls:"icon_exclamation",text:lang.clickMe,handler:function(){Ext.Msg.alert("",findLangS(this.subsystem,"text","missingClippingColumns"))
},scope:this,style:{marginRight:2,marginLeft:__width_FieldSeparator}},{xtype:"displayfield",value:findLangS(this.subsystem,"text","missingClippingColumns").substr(0,80)+"...",width:c.prop.fieldFullWidth-__width_FieldChar(10),fieldStyle:{"font-style":"italic"},listeners:{scope:this,afterrender:function(f){f.getEl().dom.setAttribute("data-qtip",findLangS(this.subsystem,"text","missingClippingColumns"))
}}}],style:{paddingBottom:__height_FieldSeparator}})
}for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){switch(a[d].items[b]._type){case"callerd_combo":Ext.applyIf(a[d].items[b],{width:c.prop.labelComboCallerCalledWidth,style:{"margin-right":__width_LabelFieldSeparator,"margin-left":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f)
}}}});
break;
case"callerd_called_label":Ext.applyIf(a[d].items[b],{width:c.prop.labelComboCallerCalledWidth,style:c.prop.labelComboCallerCalledStyle,fieldStyle:{"padding-right":__width_Trigger+3}});
break
}if(a[d].items[b].xtype.match(/displayfield/)){if(a[d].items[b].fieldStyle){Ext.applyIf(a[d].items[b].fieldStyle,c.prop.labelFieldStyle)
}else{a[d].items[b].fieldStyle=c.prop.labelFieldStyle
}}}}}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}},select:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}}},function(f){return(f.xtype=="textfield"||f.xtype=="numberfield"||f.xtype=="radiobuttonsgroup")
});
return(this.completeFields(a))
},getFieldset_rtp4:function(c){Ext.applyIf(c.prop,{fieldnWidth:__width_FieldNum(5)+__width_Trigger,label1Width:__width_FieldChar(30),label1Style:{"text-align":"left","margin-right":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"rtp_streams_ge:",helpText:"rtp_streams_geHelp",width:c.prop.label1Width,style:c.prop.label1Style},{xtype:"numberfield",name:"rtp_streams_ge",value:c.values.frtp_streams_ge,width:c.prop.fieldnWidth,minValue:1,maxValue:99,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"rtp_stream_packets_ge:",helpText:"rtp_stream_packets_geHelp",width:c.prop.label1Width,style:c.prop.label1Style},{xtype:"numberfield",name:"rtp_stream_packets_ge",value:c.values.frtp_stream_packets_ge,width:c.prop.fieldnWidth,minValue:1,maxValue:99999,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"rtp_stream_packets_le:",helpText:"rtp_stream_packets_leHelp",width:c.prop.label1Width,style:c.prop.label1Style},{xtype:"numberfield",name:"rtp_stream_packets_le",value:c.values.frtp_stream_packets_le,width:c.prop.fieldnWidth,minValue:1,maxValue:99999,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}}];
for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){if(a[d].items[b].xtype.match(/displayfield/)){if(a[d].items[b].fieldStyle){Ext.applyIf(a[d].items[b].fieldStyle,c.prop.labelFieldStyle)
}else{a[d].items[b].fieldStyle=c.prop.labelFieldStyle
}}}}}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}},select:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}}},function(f){return(f.xtype=="textfield"||f.xtype=="numberfield"||f.xtype=="radiobuttonsgroup")
});
return(this.completeFields(a))
},getFieldset_rtp:function(c){var b=this.getFieldset_rtp1(cloneObject(c));
var a=this.getFieldset_rtp2(cloneObject(c));
var g=this.getFieldset_rtp3(cloneObject(c));
var f=this.getFieldset_rtp4(cloneObject(c));
var d=b;
if(a.length){d=d.concat({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:5}}},a)
}if(g.length){d=d.concat({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:5}}},g)
}if(f.length){d=d.concat({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:5}}},f)
}return(d)
},getFieldset_dscp:function(c){Ext.applyIf(c.prop,{fieldnWidth:__width_FieldNum(5),label1Width:__width_FieldChar(14),labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var f=20;
var a=[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"dscp_caller_sip:",helpText:"dscp_caller_sipHelp",fieldClass:"x-form-field",width:c.prop.label1Width,fieldStyle:{"text-align":"right"}},{xtype:"displayfield_vo3",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_sip_eq",value:c.values.fdscp_caller_sip_eq,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_sip_ge",value:c.values.fdscp_caller_sip_ge,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_sip_lt",value:c.values.fdscp_caller_sip_lt,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"dscp_called_sip:",helpText:"dscp_called_sipHelp",fieldClass:"x-form-field",width:c.prop.label1Width,fieldStyle:{"text-align":"right"}},{xtype:"displayfield_vo3",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_sip_eq",value:c.values.fdscp_called_sip_eq,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_sip_ge",value:c.values.fdscp_called_sip_ge,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_sip_lt",value:c.values.fdscp_called_sip_lt,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"dscp_caller_rtp:",helpText:"dscp_caller_rtpHelp",fieldClass:"x-form-field",width:c.prop.label1Width,fieldStyle:{"text-align":"right"}},{xtype:"displayfield_vo3",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_rtp_eq",value:c.values.fdscp_caller_rtp_eq,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_rtp_ge",value:c.values.fdscp_caller_rtp_ge,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_rtp_lt",value:c.values.fdscp_caller_rtp_lt,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_vo3",value:"dscp_called_rtp:",helpText:"dscp_called_rtpHelp",fieldClass:"x-form-field",width:c.prop.label1Width,fieldStyle:{"text-align":"right"}},{xtype:"displayfield_vo3",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_rtp_eq",value:c.values.fdscp_called_rtp_eq,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_rtp_ge",value:c.values.fdscp_called_rtp_ge,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_vo3",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_rtp_lt",value:c.values.fdscp_called_rtp_lt,width:c.prop.fieldnWidth,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}}];
for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){if(a[d].items[b].xtype.match(/displayfield/)){if(a[d].items[b].fieldStyle){Ext.applyIf(a[d].items[b].fieldStyle,c.prop.labelFieldStyle)
}else{a[d].items[b].fieldStyle=c.prop.labelFieldStyle
}}}}}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(h){var g=h.findFormPanel();
if(g){CDR.Filter.setContextFields(g,true,h)
}},select:function(h){var g=h.findFormPanel();
if(g){CDR.Filter.setContextFields(g,true,h)
}}},function(g){return(g.xtype=="numberfield")
});
return(this.completeFields(a))
},getFieldset_filters_comb:function(c){var d=new Ext.Panel({width:"100%",height:100,style:{paddingTop:4},bodyStyle:{padding:5,"background-color":__color_FormBackground}});
var b=new CDR.Filter.Combinations.Grid({name:"filters_comb",value:c.values.ffilters_comb,width:"100%",height:400,logicRslt:d,listeners:{change:function(g){var f=g.findFormPanel();
if(f){CDR.Filter.setContextFields(f,true,g)
}}}});
var a=[b,d,{xtype:"displayfield",value:findLangS(this.subsystem,"text","dataTimeIgnoredInCombinationTemplates")}];
return(this.completeFields(a))
},completeFields:function(a){if(Ext.isArray(a)){for(var c=0;
c<a.length;
c++){this.completeFields(a[c])
}return(a)
}if(a.items&&a.xtype!="radiobuttonsgroup"&&a.xtype!="gridpanel"&&a.xtype!="grid"&&a.xtype!="andOrCombinationTable"){this.completeFields(a.items);
return(a)
}if(a.xtype&&a.xtype.match(/^displayfield/)&&a.value){var g=a.value;
var d=false;
if(g.match(/:$/)){g=g.substr(0,g.length-1);
d=true
}var f=findLangS(this.subsystem,"field_filter",g);
if(f){a.value=f;
if(d){a.value+=":"
}}if(a.helpText){a.helpText=findLangS(this.subsystem,"field_filter",a.helpText)||findLangS(this.subsystem,"field_filter",a.helpText+"Help")
}else{if(a.helpTextSpecify){a.helpText=a.helpTextSpecify
}}}if(a.xtype=="checkbox"&&a.boxLabel){var b=findLangS(this.subsystem,"field_filter",a.boxLabel);
if(b){a.boxLabel=b
}}if(a.aData){for(var c=0;
c<a.aData.length;
c++){if(Ext.isArray(a.aData[c])&&a.aData[c].length==2){var f=findLangS(this.subsystem,"field_filter",a.aData[c][1]);
if(f){a.aData[c][1]=f+(a._type=="combolabel_main"?":":"")
}}}}a.__filter="cdr";
return(a)
},fetchValuesFromFieldset:function(a,g,l,c,f){var b={};
var m=this.getArrayOfFields(g,l);
if(m){for(var d=0;
d<m.length;
d++){var h=this.findFilterField(a,m[d]);
if(h){var k=h.getValue();
if(!c||!Ext.isEmpty(k)){b[(f?"":"f")+m[d]]=k
}}}}return(b)
},fetchValuesFromFieldset_all:function(g,k,a,h){var c=["common","rtp","dscp","filters_comb"];
var d={};
for(var b=0;
b<c.length;
b++){var f=this.fetchValuesFromFieldset(g,c[b],k,a,h);
Ext.apply(d,f)
}return(d)
},fetchValuesFromFieldset_all_template:function(g,k,a,h){var c=["common","rtp","dscp","filters_comb","template"];
var d={};
for(var b=0;
b<c.length;
b++){var f=this.fetchValuesFromFieldset(g,c[b],k,a,h);
Ext.apply(d,f)
}return(d)
},setValueFieldsFieldset:function(a,f,d,g){if(!f||!a){return
}var c=this.getArrayOfFields(d);
if(c){for(var b=0;
b<c.length;
b++){var h=this.findFilterField(f,c[b]);
if(h){h.setValue(a["f"+c[b]])
}}}this.setContextFields(f)
},setValueFieldsFieldset_all:function(a,f,g){var c=["common","rtp","dscp","filters_comb"];
var d={};
for(var b=0;
b<c.length;
b++){this.setValueFieldsFieldset(a,f,c[b],g)
}},getArrayOfFields:function(c,f){if(c=="rtp"){return(this.getArrayOfFields("rtp1").concat(this.getArrayOfFields("rtp2")).concat(this.getArrayOfFields("rtp3")).concat(this.getArrayOfFields("rtp4")))
}var a=c=="common"?["datefrom","dateto","last_days","last_minutes","current_selection","named_selection","callerd_search_type","caller","called","country_code_caller","country_code_called","country_code_callerd_cmp","caller_group_id","called_group_id","caller_domain","called_domain","caller_domain_group_id","called_domain_group_id","callername","sipcallerip","sipcalledip","country_code_sipcallerip","country_code_sipcalledip","country_code_sipcallerdip_cmp","sipcallerip_group_id","sipcalledip_group_id","sipcallerdip_with_proxy","proxyip","sipcallerport","sipcalledport","codec","exclude_codec","durationgt","durationlt","connect_durationgt","connect_durationlt","pddgt","pddlt","ringinggt","ringinglt","sipresponse","allsiprequests","allsipresponse","reason_sip","reason_q850","bye","one_way","missing_rtp","missing_srtp_key","detect_fas","detect_zerossrc","is_sipalg_detected","sdp_media_type","sdp_media_type_multiple_operator","rtp_state","change_src_rtp_port","televent_request_response","trunk","who_hangup","unconfirmed_bye","bye_code","a_ua","b_ua","a_ua_group_id","b_ua_group_id","a_saddr","b_saddr","a_saddr_group_id","b_saddr_group_id","max_retransmission_invite_gt","max_retransmission_invite_lt","ip_fragmented","callid","note","sensor_id","custhead_group_id","alert_sent_id","daily_report_sent_id"]:c=="rtp1"?["rtp_port_source","rtp_port_dest","rtp_ip_port_source","rtp_ip_port_dest","rtp_port","rtp_ip_port","rtp_stream_used_in_another_call","sdp_ip_port_source","sdp_ip_port_dest","rtcp_maxjitter","rtcp_avgjitter","rtcp_maxjitter_called","rtcp_avgjitter_called","rtcp_maxfr","rtcp_avgfr","rtcp_maxfr_called","rtcp_avgfr_called","rtcp_maxrtd","rtcp_avgrtd","rtcp_maxrtd_called","rtcp_avgrtd_called","a_last_rtp_from_end_eq","a_last_rtp_from_end_gt","a_last_rtp_from_end_lt","b_last_rtp_from_end_eq","b_last_rtp_from_end_gt","b_last_rtp_from_end_lt","ab_last_rtp_from_end_or"]:c=="rtp2"?["mosf1","mosf2","mosadapt","mosf1_called","mosf2_called","mosadapt_called","mos_lqo_caller","mos_lqo_called","_d_strict","_d50","_d70","_d90","_d120","_d150","_d200","_d300","_d50_called","_d70_called","_d90_called","_d120_called","_d150_called","_d200_called","_d300_called","loss_strict","loss1","loss2","loss3","loss4","loss5","loss6","loss7","loss8","loss9","loss10","loss1_called","loss2_called","loss3_called","loss4_called","loss5_called","loss6_called","loss7_called","loss8_called","loss9_called","loss10_called"]:c=="rtp3"?["rtcp_frl_pkt_ge","rtcp_frl_pkt_lt","rtcp_frl_pkt_ge_called","rtcp_frl_pkt_lt_called","delay_sum_ge","delay_sum_lt","delay_sum_ge_called","delay_sum_lt_called","delay_avg_ge","delay_avg_lt","delay_avg_ge_called","delay_avg_lt_called","jitter_max_ge","jitter_max_lt","jitter_max_ge_called","jitter_max_lt_called","jitter_avg_ge","jitter_avg_lt","jitter_avg_ge_called","jitter_avg_lt_called","mos_f1_min_ge","mos_f1_min_lt","mos_f1_min_ge_called","mos_f1_min_lt_called","mos_f2_min_ge","mos_f2_min_lt","mos_f2_min_ge_called","mos_f2_min_lt_called","mos_adapt_min_ge","mos_adapt_min_lt","mos_adapt_min_ge_called","mos_adapt_min_lt_called","mos_min_ge","mos_min_lt","mos_min_ge_called","mos_min_lt_called","mos_min_chart_field","mos_xr_min_ge","mos_xr_min_lt","mos_xr_min_ge_called","mos_xr_min_lt_called","mos_xr_avg_ge","mos_xr_avg_lt","mos_xr_avg_ge_called","mos_xr_avg_lt_called","mos_silence_min_ge","mos_silence_min_lt","mos_silence_min_ge_called","mos_silence_min_lt_called","mos_silence_avg_ge","mos_silence_avg_lt","mos_silence_avg_ge_called","mos_silence_avg_lt_called","packet_loss_perc_ge","packet_loss_perc_lt","packet_loss_perc_ge_called","packet_loss_perc_lt_called","silence_ge","silence_lt","silence_ge_called","silence_lt_called","silence_end_ge","silence_end_lt","silence_end_ge_called","silence_end_lt_called","clipping_ge","clipping_lt","clipping_ge_called","clipping_lt_called"]:c=="rtp4"?["rtp_streams_ge","rtp_stream_packets_ge","rtp_stream_packets_le"]:c=="dscp"?["dscp_caller_sip_eq","dscp_caller_sip_ge","dscp_caller_sip_lt","dscp_called_sip_eq","dscp_called_sip_ge","dscp_called_sip_lt","dscp_caller_rtp_eq","dscp_caller_rtp_ge","dscp_caller_rtp_lt","dscp_called_rtp_eq","dscp_called_rtp_ge","dscp_called_rtp_lt"]:c=="filters_comb"?["filters_comb"]:c=="template"?["filterTemplate"]:[];
if(c=="common"){var d=getDataCdrCustomHeaders();
if(d){for(var b=0;
b<d.length;
b++){if(d[b].special_type=="max_length_sip_data"||d[b].special_type=="max_length_sip_packet"||d[b].special_type=="max_retransmission_invite"){a.push(d[b]._column_unique+"_ge");
a.push(d[b]._column_unique+"_lt")
}else{a.push(d[b]._column_unique)
}}}}if(!f){if(c=="common"){var g=this.abFields_Types();
if(g.length){a=a.concat(g)
}}if(c=="rtp1"){var g=this.rtp1AbFields_Types();
if(g.length){a=a.concat(g)
}}if(c=="rtp2"){var g=this.rtp2AbFields_Types();
if(g.length){a=a.concat(g)
}}if(c=="rtp3"){var g=this.rtp3AbFields_Types();
if(g.length){a=a.concat(g)
}}if(c=="rtp4"){var g=this.rtp4AbFields_Types();
if(g.length){a=a.concat(g)
}}}return(a.length?a:null)
},getArrayOfAllFields:function(a){return(this.getArrayOfFields("common").concat(this.getArrayOfFields("rtp1")).concat(this.getArrayOfFields("rtp2")).concat(this.getArrayOfFields("rtp3")).concat(this.getArrayOfFields("rtp4")).concat(this.getArrayOfFields("dscp")).concat(this.getArrayOfFields("filters_comb")))
},setContextFields:function(d,p,A){if(!d){return
}if(d.findField){d=d.owner
}var t=this.fetchValuesFromFieldset_all(d,false,false,true);
this.enableField(d,"datefrom",Ext.isEmpty(t.last_days)&&Ext.isEmpty(t.last_minutes)&&!t.current_selection&&!t.named_selection);
this.enableField(d,"dateto",Ext.isEmpty(t.last_days)&&Ext.isEmpty(t.last_minutes)&&!t.current_selection&&!t.named_selection);
this.enableField(d,"last_days",!t.current_selection&&!t.named_selection);
this.enableField(d,"last_minutes",!t.current_selection&&!t.named_selection);
var y=Ext.apply({},this.abFields_labelContext(),this.rtp1AbFields_labelContext());
for(var g in y){var b=this.findFilterField(d,g);
if(b){fieldValue=b.getValue();
if(fieldValue==null){b.setValue(0);
fieldValue=0
}for(var v=0;
v<y[g].length;
v++){if(y[g][v]){var f=this.findFilterField(d,y[g][v]);
if(f){f.setVisible(fieldValue==1)
}}}}}var z=this.findFilterField(d,"callerd_search_type");
if(z){var B=z.getValue()==0;
var l=this.findFilterField(d,"caller_group_id");
if(l){l.enableIf(B);
if(!B){l.setValue(null)
}}var w=this.findFilterField(d,"called_group_id");
if(w){w.enableIf(B);
if(!B){w.setValue(null)
}}}var q=this.findFilterField(d,"sdp_media_type");
if(q){var o=q.getValue();
var a=o&&o.match&&o.match(",");
var c=this.findFilterField(d,"sdp_media_type_multiple_operator");
if(c){c.enableIf(a)
}var k=d.findC("_id","sdp_media_type_multiple_operator_label");
if(k){k.enableIf(a)
}}var n=this.rtpAbFields();
for(var v=0;
v<n.length;
v++){if(!n[v]["l"]){var b=this.findFilterField(d,n[v]["t"]);
if(b){fieldValue=b.getValue();
var r=d.findC("_id",n[v]["b"]);
if(r){r.showIf(fieldValue)
}}}}this.enableField(d,"dscp_caller_sip_eq",Ext.isEmpty(t.dscp_caller_sip_ge)&&Ext.isEmpty(t.dscp_caller_sip_lt));
this.enableField(d,"dscp_caller_sip_ge",Ext.isEmpty(t.dscp_caller_sip_eq));
this.enableField(d,"dscp_caller_sip_lt",Ext.isEmpty(t.dscp_caller_sip_eq));
this.enableField(d,"dscp_called_sip_eq",Ext.isEmpty(t.dscp_called_sip_ge)&&Ext.isEmpty(t.dscp_called_sip_lt));
this.enableField(d,"dscp_called_sip_ge",Ext.isEmpty(t.dscp_called_sip_eq));
this.enableField(d,"dscp_called_sip_lt",Ext.isEmpty(t.dscp_called_sip_eq));
this.enableField(d,"dscp_caller_rtp_eq",Ext.isEmpty(t.dscp_caller_rtp_ge)&&Ext.isEmpty(t.dscp_caller_rtp_lt));
this.enableField(d,"dscp_caller_rtp_ge",Ext.isEmpty(t.dscp_caller_rtp_eq));
this.enableField(d,"dscp_caller_rtp_lt",Ext.isEmpty(t.dscp_caller_rtp_eq));
this.enableField(d,"dscp_called_rtp_eq",Ext.isEmpty(t.dscp_called_rtp_ge)&&Ext.isEmpty(t.dscp_called_rtp_lt));
this.enableField(d,"dscp_called_rtp_ge",Ext.isEmpty(t.dscp_called_rtp_eq));
this.enableField(d,"dscp_called_rtp_lt",Ext.isEmpty(t.dscp_called_rtp_eq));
if(A&&A.name=="ab_last_rtp_from_end_or"&&t.ab_last_rtp_from_end_or){if(!(Ext.isEmpty(t.a_last_rtp_from_end_eq)&&Ext.isEmpty(t.a_last_rtp_from_end_gt)&&Ext.isEmpty(t.a_last_rtp_from_end_lt))&&Ext.isEmpty(t.b_last_rtp_from_end_eq)&&Ext.isEmpty(t.b_last_rtp_from_end_gt)&&Ext.isEmpty(t.b_last_rtp_from_end_lt)){t.b_last_rtp_from_end_eq=t.a_last_rtp_from_end_eq;
this.setValueField(d,"b_last_rtp_from_end_eq",t.a_last_rtp_from_end_eq);
t.b_last_rtp_from_end_gt=t.a_last_rtp_from_end_gt;
this.setValueField(d,"b_last_rtp_from_end_gt",t.a_last_rtp_from_end_gt);
t.b_last_rtp_from_end_lt=t.a_last_rtp_from_end_lt;
this.setValueField(d,"b_last_rtp_from_end_lt",t.a_last_rtp_from_end_lt)
}}this.enableField(d,"a_last_rtp_from_end_eq",Ext.isEmpty(t.a_last_rtp_from_end_gt)&&Ext.isEmpty(t.a_last_rtp_from_end_lt));
this.enableField(d,"a_last_rtp_from_end_gt",Ext.isEmpty(t.a_last_rtp_from_end_eq));
this.enableField(d,"a_last_rtp_from_end_lt",Ext.isEmpty(t.a_last_rtp_from_end_eq));
this.enableField(d,"b_last_rtp_from_end_eq",Ext.isEmpty(t.b_last_rtp_from_end_gt)&&Ext.isEmpty(t.b_last_rtp_from_end_lt));
this.enableField(d,"b_last_rtp_from_end_gt",Ext.isEmpty(t.b_last_rtp_from_end_eq));
this.enableField(d,"b_last_rtp_from_end_lt",Ext.isEmpty(t.b_last_rtp_from_end_eq));
if(p){var h=this.findFilterField(d,"filterTemplate");
if(h){var u=h.getValue();
var s=h.findRecordByValue(u);
if(u&&s){h.setValue(null);
h.setRawValue(s.data.name+" *");
this.lastTemplateData=s.data
}}}var m=this.findFilterField(d,"caller_domain_group_id");
if(m){m.setSide(t.callerd_domain_group_id_type?_side_CallerNum:null)
}this.enablerSaveDeleteFilterTemplates(d)
},switchContentFields:function(d,h){if(!d){return
}if(d.findField){d=d.owner
}var g=this.abFields_switch();
if(g[h]){var c=[];
for(var b=0;
b<2;
b++){for(var a=0;
a<2;
a++){var f=this.findFilterField(d,g[h][a]);
if(b){f.setValue(c[a?0:1])
}else{c[a]=f.getValue()
}}}}},loadTemplates:function(a,b){if(!a.getForm().findField("filterTemplate")){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrFilterTemplates"},success:function(c){this.fillStoreTemplates(a,c.filterTemplates);
if(b){this.setFilterTemplate(a,b);
this.enablerSaveDeleteFilterTemplates(a)
}}})
},fillStoreTemplates:function(a,b){var d=a.getForm().findField("filterTemplate");
if(b){for(var c=0;
c<b.length;
c++){this.addTemplate(d,b[c])
}}d.enableIf(b&&b.length);
this.enablerSaveDeleteFilterTemplates(a)
},addTemplate:function(d,g,c,a){var f=0;
for(var b=0;
b<d.store.getCount();
b++){if(d.store.getAt(b).data.name<=g.name){++f
}else{break
}}d.addMenuItem({id:g.id*1,name:g.name,user_id:g.user_id*1,user_name:g.user_name,textMenu:(c?'<span style="color: green;">':"")+g.name+(g.user_name?'<span style="font-size: 70%;"> / '+g.user_name+"</span>":"")+(c?"</span>":""),filterConfig:g.config,priv:g.priv*1,user_ids:g.user_ids,group_ids:g.group_ids},a,false,f)
},selectFilterTemplate:function(a,c){this.lastTemplateData=null;
var g=this.fetchValuesFromFieldset_all(a);
var b=c.getValue();
var f=c.findRecordByValue(b);
if(f.data.filterConfig){var d=Ext.decode(f.data.filterConfig);
if(d.fdatefrom||d.fdateto){d.fdatefrom=dateTimeStringToDate(d.fdatefrom);
d.fdateto=dateTimeStringToDate(d.fdateto)
}else{d.fdatefrom=g.fdatefrom;
d.fdateto=g.fdateto
}this.setValueFieldsFieldset_all(d,a)
}c.setValue(b);
this.enablerSaveDeleteFilterTemplates(a)
},setFilterTemplate:function(a,c){var b=a.getForm().findField("filterTemplate");
b.setValue(c)
},enablerSaveDeleteFilterTemplates:function(d){if(!d){return
}if(d.getForm){basicForm=d.getForm()
}else{if(d.findField){basicForm=d;
d=basicForm.owner
}}var c=basicForm.findField("filterTemplate");
if(!c){return
}var g=d.findC("_btnId","saveFilterTemplate");
var h=d.findC("_btnId","deleteFilterTemplate");
if(!g&&!h){return
}var b=c.getValue();
var f=c.findRecordByValue(b);
var a=this.isDataSet(d);
if(g){g.setVisible(a&&(!f||!f.data.user_id||user_is_admin()||user_can_edit_all_templates()||f.data.user_id==user_id()));
g.setText(findLangS(this.subsystem,"button",f?"editTemplate":"saveTemplate"))
}if(h){h.setVisible(f&&(user_is_admin()||user_can_delete_all_templates()||user_id==f.data.user_id))
}},isDataSet:function(a){if(a.getForm){a=a.getForm()
}var b=this.fetchValuesFromFieldset_all(a,true,true);
delete b.fdatefrom;
delete b.fdateto;
return(isDataSet(b))
},getDefaultDateFrom:function(){return(defaultCdrTypeInterval=="specified_days"?date((new Date).getTime()/1000-defaultCdrInterval*24*60*60):dateTimeM(getTimeInterval(defaultCdrTypeInterval)[0]))
},saveFilterConfig:function(b,o){if(!b){return
}if(!user_is_admin()&&!Ext.isDefined(o)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCountOtherUsersInGroup"},success:function(v){this.saveFilterConfig(b,v.count)
}});
return
}var s;
if(b.getForm){s=b.getForm()
}else{if(b.findField){s=b;
b=s.owner
}}var d=s.findField("filterTemplate");
var f=d.getValue();
var h=d.findRecordByValue(f);
var t={};
var c={};
var m={};
var k=this.fetchValuesFromFieldset_all(b);
if(f&&h){t={name:h.data.name,priv:h.data.priv,user_ids:h.data.user_ids,group_ids:h.data.group_ids};
var n=h.data.filterConfig&&Ext.decode(h.data.filterConfig);
if(n){c={date_from:n.fdatefrom,date_to:n.fdateto,last_days:n.flast_days,last_minutes:n.flast_minutes};
m={current_selection:n.fcurrent_selection,named_selection:n.fnamed_selection}
}}else{if(this.lastTemplateData){t={name:this.lastTemplateData.name,priv:this.lastTemplateData.priv,user_ids:this.lastTemplateData.user_ids,group_ids:this.lastTemplateData.group_ids}
}if(k){c={date_from:k.fdatefrom,date_to:k.fdateto,last_days:k.flast_days,last_minutes:k.flast_minutes};
m={current_selection:k.fcurrent_selection,named_selection:k.fnamed_selection}
}}var l=[{xtype:"textfield",name:"name",fieldLabel:findLangS(this.subsystem,"field","templateName"),value:t.name,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),disabled:f&&h,allowBlank:false},{xtype:"checkbox",name:"priv",fieldLabel:findLangS(this.subsystem,"field","privateTemplate"),checked:t.priv,labelWidth:__width_FieldChar(15),listeners:{change:function(y){var v=y.getValue();
var z=r.getForm().findField("user_ids");
if(z){z.enableIf(!v)
}var w=r.getForm().findField("group_ids");
if(w){w.enableIf(!v)
}}}}];
if(user_is_admin()||o){l.push({xtype:"ComboBoxX",name:"user_ids",fieldLabel:findLangS(this.subsystem,"field","showForUsers"),value:t.user_ids,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,disabled:t.priv,_autoDisableIfEmpty:true})
}if(user_is_admin()){l.push({xtype:"ComboBoxX",name:"group_ids",fieldLabel:findLangS(this.subsystem,"field","showForGroups"),value:t.group_ids,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"group_list",recordStruct:rsGroupList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,disabled:t.priv,_autoDisableIfEmpty:true})
}if(!d.disableTimeInterval){l.push({xtype:"container",layout:"hbox",items:[{xtype:"form",items:{xtype:"datetimefield",name:"datefrom",value:c.date_from,fieldLabel:findLangS(this.subsystem,"field","dateRange")+" - "+findLangS(this.subsystem,"field","from"),width:__width_FormChar(15,23),labelWidth:__width_FieldChar(15),zeroTimeEmpty:true,disabled:c.last_days>0||c.last_minutes>0||m.current_selection||m.named_selection},border:false,bodyStyle:__style_FormBackground()},{xtype:"displayfield",value:findLangS(this.subsystem,"field","to")+":",style:{marginRight:__width_FieldSeparator}},{xtype:"datetimefield",name:"dateto",value:c.date_to,zeroTimeEmpty:true,disabled:c.last_days>0||c.last_minutes>0||m.current_selection||m.named_selection}]});
l.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:findLangS(this.subsystem,"field","lastDaysMinutes")+":",width:__width_FieldChar(15),style:{marginRight:__width_LabelFieldSeparator}},{xtype:"numberfield",name:"last_days",value:c.last_days,hideLabel:true,minValue:0,maxValue:365,width:__width_FieldNum(4)+__width_Trigger,labelWidth:__width_FieldChar(15),fieldStyle:{"text-align":"right"},disabled:m.current_selection||m.named_selection,listeners:{afterrender:function(v){if(m.current_selection||m.named_selection){v.disable()
}},spindown:function(w){var v=w.getValue();
if(v==1||v===null){Ext.defer(function(){w.setValue(null)
},1)
}},select:p,change:p}},{xtype:"displayfield",value:lang.days,style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"last_minutes",value:c.last_minutes,hideLabel:true,minValue:0,maxValue:24*60,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},disabled:m.current_selection||m.named_selection,listeners:{afterrender:function(v){if(m.current_selection||m.named_selection){v.disable()
}},spindown:function(w){var v=w.getValue();
if(v==1||v===null){Ext.defer(function(){w.setValue(null)
},1)
}},select:p,change:p}},{xtype:"displayfield",value:lang.minutes,style:{marginLeft:2}}]})
}if(!d.disableSelections){l.push({xtype:"checkbox",name:"current_selection",checked:m.current_selection,fieldLabel:findLangS(this.subsystem,"field","currentSelection"),width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),height:__height_Field,listeners:{change:u}},{xtype:"ComboBoxX",name:"named_selection",value:m.named_selection,fieldLabel:findLangS(this.subsystem,"field","namedSelection"),width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_selections",recordStruct:rsUserSelections,extraParams:{public_all_users:true},sortField:"name",columns:[{fields:"name",widthCh:40}],_clearButton:true,editable:false,_autoDisableIfEmpty:true,listeners:{select:a}})
}var r=new Ext.FormPanel({frame:true,border:false,items:l,buttons:[{text:findLangS(this.subsystem,"button","save"),iconCls:"icon_save",handler:q,scope:this},{text:findLangS(this.subsystem,"button","cancel"),iconCls:"icon_cancel",handler:function(){r.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",r.el,{enter:q,scope:this})
}}});
var g=new Ext.Window({layout:"fit",items:r,border:false,title:findLangS(this.subsystem,"title",f&&h?"editTemplate":"saveTemplate"),modal:true,closable:true,listeners:{scope:this,activate:function(){r.getForm().findField("name").focus(false,200)
}}});
g.show();
function q(){if(r.getForm().isValid()){var w=["name","priv","user_ids","group_ids"];
var v={};
for(var y=0;
y<w.length;
y++){var A=r.getForm().findField(w[y]);
if(A){v[w[y]]=A.getValue()
}}var z=this.fetchValuesFromFieldset_all(b);
if(!d.disableTimeInterval){z.fdatefrom=r.getForm().findField("datefrom").getValue();
z.fdateto=r.getForm().findField("dateto").getValue();
z.flast_days=r.getForm().findField("last_days").getValue();
z.flast_minutes=r.getForm().findField("last_minutes").getValue()
}if(!d.disableSelections){z.fcurrent_selection=r.getForm().findField("current_selection").getValue();
z.fnamed_selection=r.getForm().findField("named_selection").getValue()
}this.saveFilterConfigAjax(v,z,f>0,f,r,d,b);
if(!d.disableTimeInterval){s.findField("datefrom").setValue(z.fdatefrom);
s.findField("dateto").setValue(z.fdateto);
s.findField("last_days").setValue(z.flast_days);
s.findField("last_minutes").setValue(z.flast_minutes)
}if(!d.disableSelections){s.findField("current_selection").setValue(z.fcurrent_selection);
s.findField("named_selection").setValue(z.fnamed_selection)
}}}function p(){var z=r.getForm().findField("last_days").getValue();
var y=r.getForm().findField("last_minutes").getValue();
var w=r.getForm().findField("datefrom");
var v=r.getForm().findField("dateto");
w.enableIf(Ext.isEmpty(z)&&Ext.isEmpty(y));
v.enableIf(Ext.isEmpty(z)&&Ext.isEmpty(y))
}function u(){var y=r.getForm().findField("current_selection").getValue();
var z=r.getForm().findField("named_selection").getValue();
var B=r.getForm().findField("datefrom");
var A=r.getForm().findField("dateto");
var w=r.getForm().findField("last_days");
var v=r.getForm().findField("last_minutes");
B.enableIf(!y&&!z);
A.enableIf(!y&&!z);
w.enableIf(!y&&!z);
v.enableIf(!y&&!z)
}function a(){u()
}},saveFilterConfigAjax:function(c,g,b,k,h,d,f){var a=arguments;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({id:k,subsystem:"cdr_filters",name:c.name,user_id:user_id(),priv:c.priv,user_ids:c.user_ids,group_ids:c.group_ids,config:Ext.encode(g),enableUpdate:b})},success:function(l){this.addTemplate(d,l.row,true,true);
d.enable();
d.setValue(l.id);
this.enablerSaveDeleteFilterTemplates(f);
h.destroyWindow()
},error:function(m,l){if(m.error=="name_duplication"){Ext.Msg.confirm(findLangS(this.subsystem,"title","msgDuplicationName"),findLangS(this.subsystem,"text","msgDuplicationName"),function(n){if(n=="yes"){var o=a;
o[2]=true;
this.saveFilterConfigAjax.apply(this,o)
}else{h.destroyWindow()
}},this)
}else{alertAjaxError(l)
}},failure:function(){h.getEl().unmask()
},maskEl:h})
},deleteFilterConfig:function(a){var b=a.getForm().findField("filterTemplate");
var c=b.findRecordByValue(b.getValue());
Ext.Msg.confirm(findLangS(this.subsystem,"title","msgDeleteFilter"),findLangS(this.subsystem,"text","msgDeleteFilter"),function(d){if(d=="yes"){this.deleteFilterConfigAjax(c.data.id,a,b)
}},this)
},deleteFilterConfigAjax:function(b,a,c){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"deleteTemplate",params:Ext.encode({id:b})},success:function(d){c.deleteMenuItem(b);
c.setValue(null);
if(!c.store.getCount()){c.disable()
}this.enablerSaveDeleteFilterTemplates(a)
}})
},findFilterField:function(c,d){if(!c){return(null)
}if(c.findField){c=c.owner
}var a=c.getItems(d,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(a[b].__filter=="cdr"){return(a[b])
}}}return(null)
},enableField:function(b,d,a){var c=this.findFilterField(b,d);
if(c){c.enableIf(a)
}},setValueField:function(a,d,b){var c=this.findFilterField(a,d);
if(c){c.setValue(b)
}},getFormTabPanel:function(a){if(a.items){for(var b=0;
b<a.items.getCount();
b++){var c=a.items.get(b);
if(c.xtype=="tabpanel"){return(c)
}}}return(null)
},getCountMainItems:function(a){var c=0;
for(var b=0;
b<a.length;
b++){if(!a[b].helpId){++c
}}return(c)
},redukFilterItems:function(c){if(Ext.isString(c)){c=Ext.decode(c)
}var b=CDR.Filter.getArrayOfAllFields();
filterItemsReduk={};
for(var a in c){if(Ext.isString(a)&&b.inArray(a.substr(1))&&Ext.isDefined(c[a])&&c[a]!==null&&c[a]!==""){filterItemsReduk[a]=c[a]
}}this.optimizeFilterItems(filterItemsReduk);
return(filterItemsReduk)
},optimizeFilterItems:function(h){var g=this.abFields_typeAB();
for(var f in g){if(Ext.isDefined(h["f"+f])){var l=g[f][0];
var k=g[f][1];
if(!h["f"+l]&&!h["f"+k]){delete h["f"+f]
}}}var a=["current_selection","bye","ab_last_rtp_from_end_or","callerd_search_type","_d_strict","loss_strict","one_way","missing_rtp","rtp_stream_used_in_another_call","mos_min_chart_field"];
for(var f=0;
f<a.length;
f++){if(Ext.isDefined(h["f"+a[f]])&&!h["f"+a[f]]){delete h["f"+a[f]]
}}var b=false;
for(var f=0;
f<4&&!b;
f++){var n=this.getArrayOfFields(f==0?"rtp1":f==1?"rtp2":f==2?"rtp3":"rtp4",true);
for(var d in h){if(n.inArray(d.substr(1))&&h[d]){b=true
}}}if(!b){for(var f=0;
f<4;
f++){var c=f==0?this.rtp1AbFields:f==1?this.rtp2AbFields:f==2?this.rtp3AbFields:this.rtp4AbFields;
for(var d=0;
d<c.length;
d++){if(Ext.isDefined(h["f"+c[d]["t"]])){delete h["f"+c[d]["t"]]
}}}}if(Ext.isDefined(h.fsipcallerdip_with_proxy)){var m=false;
for(var d in h){if(d.match&&d.match(/sipcalle[rd]ip/)&&h[d]){m=true;
break
}}if(!m){delete h.fsipcallerdip_with_proxy
}}},abFields_Types:function(){var a=[];
for(var b in this.abFields){if(this.abFields[b].t){a.push(this.abFields[b].t)
}}return(a)
},rtp1AbFields_Types:function(){var a=[];
for(var b in this.rtp1AbFields){if(this.rtp1AbFields[b].t){a.push(this.rtp1AbFields[b].t)
}}return(a)
},rtp2AbFields_Types:function(){var a=[];
for(var b in this.rtp2AbFields){if(this.rtp2AbFields[b].t){a.push(this.rtp2AbFields[b].t)
}}return(a)
},rtp3AbFields_Types:function(){var a=[];
for(var b in this.rtp3AbFields){if(this.rtp3AbFields[b].t){a.push(this.rtp3AbFields[b].t)
}}return(a)
},rtp4AbFields_Types:function(){return([])
},abFields_labelContext:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].sw&&this.abFields[b].l&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].sw,this.abFields[b].l,this.abFields[b].b]
}}return(a)
},rtp1AbFields_labelContext:function(){var a={};
for(var b in this.rtp1AbFields){if(this.rtp1AbFields[b].t&&this.rtp1AbFields[b].l&&this.rtp1AbFields[b].b){a[this.rtp1AbFields[b].t]=[this.rtp1AbFields[b].sw,this.rtp1AbFields[b].l,this.rtp1AbFields[b].b]
}}return(a)
},abFields_switch:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].sw&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].sw]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields_typeAB:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields:[{t:"callerd_type",a:"caller",b:"called",l:"called_label",sw:"callerd_switch"},{t:"country_code_callerd_type",a:"country_code_caller",b:"country_code_called",l:"country_code_called_label",sw:"country_code_callerd_switch"},{t:"callerd_group_id_type",a:"caller_group_id",b:"called_group_id",l:"called_group_id_label",sw:"callerd_group_id_switch"},{t:"callerd_domain_type",a:"caller_domain",b:"called_domain",l:"called_domain_label",sw:"callerd_domain_switch"},{t:"callerd_domain_group_id_type",a:"caller_domain_group_id",b:"called_domain_group_id",l:"called_domain_group_id_label",sw:"callerd_domain_group_id_switch"},{t:"sipcallerdip_type",a:"sipcallerip",b:"sipcalledip",l:"sipcalledip_label",sw:"sipcallerdip_switch"},{t:"country_code_sipcallerdip_type",a:"country_code_sipcallerip",b:"country_code_sipcalledip",l:"country_code_sipcalledip_label",sw:"country_code_sipcallerdip_switch"},{t:"sipcallerdip_group_id_type",a:"sipcallerip_group_id",b:"sipcalledip_group_id",l:"sipcalledip_group_id_label",sw:"sipcallerdip_group_id_switch"},{t:"sipcallerdport_type",a:"sipcallerport",b:"sipcalledport",l:"sipcalledport_label",sw:"sipcallerdport_switch"},{t:"ab_ua_type",a:"a_ua",b:"b_ua",l:"b_ua_label",sw:"ab_ua_switch"},{t:"ab_ua_group_id_type",a:"a_ua_group_id",b:"b_ua_group_id",l:"b_ua_group_id_label",sw:"ab_ua_group_id_switch"},{t:"ab_saddr_type",a:"a_saddr",b:"b_saddr",l:"b_saddr_label",sw:"ab_saddr_switch"},{t:"ab_saddr_group_id_type",a:"a_saddr_group_id",b:"b_saddr_group_id",l:"b_saddr_group_id_label",sw:"ab_saddr_group_id_switch"}],rtp1AbFields:[{t:"rtp_port_sd_type",a:"rtp_port_source",b:"rtp_port_dest",l:"rtp_port_dest_label"},{t:"rtp_ip_port_sd_type",a:"rtp_ip_port_source",b:"rtp_ip_port_dest",l:"rtp_ip_port_dest_label"},{t:"sdp_ip_port_sd_type",a:"sdp_ip_port_source",b:"sdp_ip_port_dest",l:"sdp_ip_port_dest_label"},{t:"rtcp_jitter_callerd_type",b:"rtcp_jitter_called"},{t:"rtcp_rtd_callerd_type",b:"rtcp_rtd_called"},{t:"rtcp_fr_callerd_type",b:"rtcp_fr_called"},{t:"rtcp_frl_pkt_callerd_type",b:"rtcp_frl_pkt_called"}],rtp2AbFields:[{t:"mos_callerd_type",b:"mos_called"},{t:"_d_callerd_type",b:"_d_called"},{t:"loss_callerd_type",b:"loss_called"}],rtp3AbFields:[{t:"mos_min_callerd_type",b:"mos_min_called"},{t:"delay_sum_callerd_type",b:"delay_sum_called"},{t:"delay_avg_callerd_type",b:"delay_avg_called"},{t:"jitter_max_callerd_type",b:"jitter_max_called"},{t:"jitter_avg_callerd_type",b:"jitter_avg_called"},{t:"mos_f1_min_callerd_type",b:"mos_f1_min_called"},{t:"mos_f2_min_callerd_type",b:"mos_f2_min_called"},{t:"mos_adapt_min_callerd_type",b:"mos_adapt_min_called"},{t:"mos_xr_avg_callerd_type",b:"mos_xr_avg_called"},{t:"mos_xr_min_callerd_type",b:"mos_xr_min_called"},{t:"mos_silence_avg_callerd_type",b:"mos_silence_avg_called"},{t:"mos_silence_min_callerd_type",b:"mos_silence_min_called"},{t:"packet_loss_perc_callerd_type",b:"packet_loss_perc_called"},{t:"silence_callerd_type",b:"silence_called"},{t:"silence_end_callerd_type",b:"silence_end_called"},{t:"clipping_callerd_type",b:"clipping_called"}],rtp4AbFields:[],rtpAbFields:function(){return(this.rtp1AbFields.concat(this.rtp2AbFields).concat(this.rtp3AbFields).concat(this.rtp4AbFields))
},getWidthForm:function(){return(__width_FieldChar(102))
}});
Ext.define("CDR.Fields.Templates",{extend:"Ext.ux.combobox.ComboBoxA",alias:"widget.CDR_templates",subsystem:"cdr",constructor:function(a){Ext.applyIf(a||{},{_tpl:"{textMenu}",aData:{data:[],fields:["id","name","user_id","user_name","textMenu","filterConfig","priv","user_ids","group_ids"]},__filter:"cdr",listeners:{scope:this,afterrender:this.onAfterRender,select:function(){if(this.onSelect){this.onSelect()
}}}});
this.callParent([a])
},onAfterRender:function(){if(this.templates){this.addTemplates(this.templates)
}else{if(this._templatesOwner2.templates){this.templates=this._templatesOwner2.templates;
this.addTemplates(this.templates)
}else{this.loadTemplates()
}}},loadTemplates:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrFilterTemplates",params:Ext.encode({no_filters_comb:this._noFiltersComb})},success:function(a){if(a.filterTemplates&&a.filterTemplates.length){this.templates=a.filterTemplates;
if(this._templatesOwner2){this._templatesOwner2.templates=this.templates;
this.onAfterSetTemplates()
}this.addTemplates(this.templates)
}}})
},addTemplates:function(b){if(b&&b.length){for(var a=0;
a<b.length;
a++){this.addTemplate(b[a])
}}if(this._customFilter){this.addMenuItem({id:-1,name:"custom_filter",user_id:null,user_name:null,textMenu:"<span>"+findLangS(this.subsystem,"filtersCombination","custom_filter")+"</span>",filterConfig:null,priv:null,user_ids:null,group_ids:null},false,false,0)
}},addTemplate:function(f,c,a){var d=0;
for(var b=0;
b<this.store.getCount();
b++){if(this.store.getAt(b).data.name<=f.name){++d
}else{break
}}this.addMenuItem({id:f.id*1,name:f.name,user_id:f.user_id*1,user_name:f.user_name,textMenu:(c?'<span style="color: green;">':"")+(this._templatePrefix?(this._templatePrefix+" "):"")+f.name+(f.user_name?'<span style="font-size: 70%;"> / '+f.user_name+"</span>":"")+(c?"</span>":""),filterConfig:f.config,priv:f.priv*1,user_ids:f.user_ids,group_ids:f.group_ids},a,false,d)
}});
Ext.define("CDR.Filter.Combinations.Grid",{extend:"Ext.ux.andOrCombination.Table",subsystem:"cdr",constructor:function(a){var c=this;
Ext.applyIf(a,{modelName:"filtersCombinationTable",fields:[{name:"template_id",type:"int"},{name:"template_name"},{name:"template_user_name"},{name:"logic_level",type:"int"},{name:"actions",type:"int"},{name:"id",type:"int"},{name:"not",type:"int"},{name:"filter_descr"},{name:"filter_cfg"}],columnNot:true,columnId:true,columnsNext:[{dataIndex:"template_id",header:this.findLangS("filtersCombination","col_filter_template"),renderer:b,editor:new Ext.grid.CellEditor({field:{xtype:"CDR_templates",_templatesOwner2:this,_noFiltersComb:true,_customFilter:true,_templatePrefix:this.findLangS("filtersCombination","template_prefix"),onSelect:function(){c.focus()
}},listeners:{startedit:function(){Ext.defer(function(){this.field.expand()
},100,this)
},beforestartedit:function(f,d,g){if(g==-1){return(false)
}}}}),flex:1,sortable:false}],cellediting:true,fieldSeparator:"||F||",tbar:[{text:this.findLangS("filtersCombination","btn_add"),iconCls:"icon_add",handler:this.newTemplate,scope:this}]});
this.callParent([a]);
function b(l,d,g,m,k,h){var f="";
if(g.data.template_id==-1){f='<div style="cursor: pointer;" data-qtip="'+this.findLangS("filtersCombination","tooltip_edit_custom_filter")+'" onClick="Ext.getCmp(\''+this.id+"').editCustomFilter('"+g.data.id+'\');"><div style="float:left; height:13; width: 20;"><img src="images/icon/filter_'+(g.data.filter_cfg?"blue":"grey")+'.png" style="width: 14; height: 14"></div><div style="padding-left: 20px;"><span style="color: blue;">'+(g.data.filter_descr||this.findLangS("filtersCombination","custom_filter"))+"</span></div></div>"
}else{if(g.data.template_id&&g.data.template_name){f=g.data.template_name;
if(g.data.template_user_name){f+='<span style="font-size: 70%;"> / '+g.data.template_user_name+"</span>"
}}else{f+='<span style="color: red;">'+this.findLangS("filtersCombination","missing_filter_or_template")+"</span>"
}}return(f)
}},onAfterRender:function(){if(!this.templates){this.loadTemplates()
}this.callParent()
},onAfterEditRecord:function(a){if(a.data.template_id==-1){a.data.template_name="custom_filter";
a.data.template_user_name=null;
Ext.defer(function(){this.editCustomFilter(a.data.id)
},100,this)
}else{if(this.templates&&this.templates.length){for(var b=0;
b<this.templates.length;
b++){if(a.data.template_id==this.templates[b].id){a.data.template_name=this.templates[b].name;
a.data.template_user_name=this.templates[b].user_name;
a.data.filter_cfg=Ext.encode(CDR.Filter.redukFilterItems(this.templates[b].config))
}}}}this.callParent()
},loadTemplates:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrFilterTemplates",params:Ext.encode({no_filters_comb:true})},success:function(a){if(a.filterTemplates&&a.filterTemplates.length){this.templates=a.filterTemplates
}}})
},onAfterSetTemplates:function(){},newTemplate:function(){var a=this.addRecord({template_id:this.templates&&this.templates.length?0:-1});
if(this.templates&&this.templates.length){this.startCellEdit(a)
}},editCustomFilter:function(a){var h=null;
this.store.each(function(q){if(q.data.id==a){h=q
}});
if(!h){return
}var k=h.data.filter_cfg?(Ext.decode(h.data.filter_cfg)||{}):{};
var n=CDR.Filter.getFieldset("common",{disableTimeInterval:true,disableSelections:true,values:k});
var c=CDR.Filter.getFieldset("rtp",{values:k});
var b=window.existsDscpCdr?CDR.Filter.getFieldset("dscp",{values:k}):null;
var p=705;
var m=__height_Form(n.length);
var g=[{xtype:"container",items:n,title:this.findLangS("title","commonTab"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:p,height:m},{xtype:"container",items:c,title:this.findLangS("title","RTPtab"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:p,height:m}];
if(b){g.push({xtype:"container",items:b,title:this.findLangS("title","DSCPtab"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:p,height:m})
}var f=[{xtype:"textfield",name:"filter_descr",value:h.data.filter_descr,fieldLabel:this.findLangS("filtersCombination","field_description"),width:__width_FormChar(15,35)},{xtype:"tabpanel",items:g,border:false}];
var l=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,items:f,buttons:[{scope:this,text:this.findLangS("button","ok"),iconCls:"icon_ok",handler:function(){if(l.getForm().isValid()){o.call(this);
d.destroy()
}}},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){d.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",l.el,{enter:function(){if(l.getForm().isValid()){o.call(this);
d.destroy()
}},scope:this});
CDR.Filter.setContextFields(l)
}}});
var d=new Ext.Window({scope:this,title:this.findLangS("filtersCombination","title_custom_filter"),closable:true,border:false,plain:true,layout:"fit",modal:true,items:l,formPanelForAutoAdjustSize:l});
d.show();
function o(){h.data.filter_cfg=Ext.encode(CDR.Filter.redukFilterItems(CDR.Filter.fetchValuesFromFieldset_all(l,false,true)));
h.data.filter_descr=l.getForm().findField("filter_descr").getValue();
h.commit();
this.setLogicRslt();
this.fireEvChange()
}},setLogicRslt:function(){var b=this.getLogicRslt();
if(this.logicRslt){var a="";
if(!this.store.getCount()){a+='<span style="color: orange;">'+this.findLangS("filtersCombination","error_filters_table_is_empty")+"</span>"
}else{if(!this.checkFillAllFilters()){a+='<span style="color: red;">'+this.findLangS("filtersCombination","error_missing_filter_or_template_in_any_row")+" "+this.getNoFillIdFilters().join(",")+"</span>"
}}if(b){b=this.substIdsInLogicRslt(b);
if(a){a+="<br><br>"
}a+='<span style="word-wrap: break-word; white-space: normal;">';
a+=b;
a+="</span>"
}this.logicRslt.setHtml(a)
}},substIdsInLogicRslt:function(b){while(rsltMatch=b.match(/[id:[0-9]+]/)){var c=parseInt(rsltMatch[0].substr(4));
var a=this.getRecordForId(c);
if(a.data.template_id>0){b=b.replace(rsltMatch[0],'[<span style="color: blue;">'+a.data.template_name+"</span>]")
}else{if(a.data.template_id==-1&&a.data.filter_cfg){b=b.replace(rsltMatch[0],'[<span style="color: blue;">'+(a.data.filter_descr||(this.findLangS("filtersCombination","custom_filter")+" id:"+c))+"</span>]")
}else{b=b.replace(rsltMatch[0],'[id:<span style="color: red;">'+c+"</span>]")
}}}return(b)
},checkFillAllFilters:function(){if(!this.store.getCount()){return(null)
}for(var b=0;
b<this.store.getCount();
b++){var a=this.store.getAt(b);
if(!this.checkFillFilter(a)){return(false)
}}return(true)
},getNoFillIdFilters:function(){if(!this.store.getCount()){return(null)
}var c=[];
for(var b=0;
b<this.store.getCount();
b++){var a=this.store.getAt(b);
if(!this.checkFillFilter(a)){c.push(a.data.id)
}}return(c.length?c:null)
},checkFillFilter:function(a){return(a.data.template_id>0||(a.data.template_id==-1&&a.data.filter_cfg))
}});
Ext.define("CDR.Utils",{singleton:true,subsystem:"cdr",downloadPcapWav:function(a,c,b){formPostSafe(c?"php/pcap2wav.php":"php/pcap.php","POST",{id:a,action:c?(c=="ogg"?"ogg":"wav"):undefined,disable_rtp:b?true:undefined,with_http:true,timeout:30*60*1000})
},testDownloadPcapWav:function(a,b,f,d,c){ajaxSafeRequest({scope:a,url:d?"php/pcap2wav.php":"php/pcap.php",params:{id:b,action:d?(d=="ogg"?"ogg":"wav"):undefined,disable_rtp:c?true:undefined,with_http:true,test:true},success:function(g){f.call(a)
},maskEl:a,timeout:30*60*1000})
},prepareDownloadPcapWav:function(b,a){ajaxSafeRequest({scope:a.panel,url:a.wav?"php/pcap2wav.php":"php/pcap.php",params:{id:b,action:a.wav?(a.wav=="ogg"?"ogg":"wav"):undefined,disable_rtp:a.disableRtp?true:undefined,search:a.search?a.search:undefined,type_packets:a.type_packets?a.type_packets:undefined,filter_rtp:a.filter_rtp?a.filter_rtp:undefined,with_http:true,prepare:true},success:function(c){if(a.fceSuccess){a.fceSuccess.call(a.panel,c)
}else{downloadPrepareFileHash(c)
}},error2:function(){if(a.fceError){a.fceError.call(a.panel)
}},failure2:function(){if(a.fceFailure){a.fceFailure.call(a.panel)
}},maskEl:a.panel,timeout:30*60*1000})
},doPlayFlashWavPlayer:function(b,a){if(!window.disableHtmlAudioPlayer&&!Ext.isIE){CDR.Utils.prepareDownloadPcapWav(b,{panel:a.panel,fceSuccess:function(c){function d(){if(window.existsSox){CDR.Utils.playChunkPlayer({cdrId:b,audioFile:c})
}else{new Tools.WavPlayerWS({sound:downloadPrepareFileHashUrl(c,120),sound_fail:"php/pcap2wav.php?id="+b})
}}if(a.audit){var f=new Tools.AuditForm({cdrId:b,activity:_AuditActivity_play_wav,autoAudit:a.audit==2,fceContinue:function(){d()
},fceCancel:function(){unlinkPrepareFileHash(c)
},fceContinueScope:a.panel});
f.audit()
}else{d()
}},wav:window.existsSox||Ext.isSafari?"wav":"ogg",filter_rtp:a.filter_rtp?a.filter_rtp:undefined});
return
}CDR.Utils.testDownloadPcapWav(a.panel,b,function(){function c(){CDR.Utils.playFlashWavPlayer(b,a.expand,a.panel,a.event)
}if(a.audit){var d=new Tools.AuditForm({cdrId:b,activity:_AuditActivity_play_wav,autoAudit:a.audit==2,fceContinue:function(){c()
},fceContinueScope:a.panel});
d.audit()
}else{c()
}},true)
},playChunkPlayer:function(b){var l="CDR_RTP_model";
if(!Ext.ClassManager.isCreated(l)){Ext.define(l,{extend:"Ext.data.Model",fields:rsCdrRtp})
}var d=new Ext.data.Store({storeId:"CDR_RTP_store",model:l,proxy:{type:"ajax",url:"php/model/sql.php",timeout:60*60*1000,actionMethods:"POST",extraParams:{task:"LISTING",module:"CDR_RTP",cdr_id:b.cdrId},reader:{rootProperty:"results",totalProperty:"total"}},sorters:{property:"firsttime",direction:"ASC"},remoteSort:false,listeners:{load:function(r,q){r.each(function(s){s.data.checked=true;
s.commit()
});
m(r,q)
}}});
var f=[{xtype:"checkcolumn",dataIndex:"checked",header:'<img src="'+__extjs_images_path()+'menu/default-checked.gif" style="margin-left: 1px;">',checked:true,width:28,sortable:false,hideable:false,draggable:false,resizable:false,menuDisabled:true,listeners:{scope:this,checkchange:function(s,r,t){var q=d.getAt(r);
if(q){q.data.checked=t;
q.commit();
p(q)
}}}},{xtype:"actioncolumn",header:"",width:28,draggable:false,resizable:false,menuDisabled:true,items:[{getClass:function(q,r,s){return("icon_table_switch_select")
},handler:function(t,y,r,u,v){for(var s=0;
s<t.store.getCount();
s++){var q=t.store.getAt(s);
q.data.checked=s==y;
q.commit()
}var w=t.store.getAt(y);
p(w)
},tooltip:findLangS(this.subsystem,"tooltip","selectOnlyThisRow"),scope:this}],iconDivStyle:"margin-left: 5px;"},{dataIndex:"firsttime",align:"right",width:__width_ColumnNum(8),renderer:function(u,q,r,v,t,s){return(formatNumber(u,3))
}},{dataIndex:"codec",align:"left",width:__width_ColumnChar(10)},{dataIndex:"received",align:"right",width:__width_ColumnNum(8)},{dataIndex:"saddr",align:"left",width:__width_ColumnNum(20),renderer:function(u,q,r,v,t,s){return(u?u+(s.hostnames&&s.hostnames[u]?"<br>"+s.hostnames[u]:""):"")
}},{dataIndex:"sport",align:"right",width:__width_ColumnNum(10),renderer:function(u,q,r,v,t,s){return(u||"")
}},{dataIndex:"daddr",align:"left",width:__width_ColumnNum(20),renderer:function(u,q,r,v,t,s){return(u?u+(s.hostnames&&s.hostnames[u]?"<br>"+s.hostnames[u]:""):"")
}},{dataIndex:"dport",align:"right",width:__width_ColumnNum(10),renderer:function(u,q,r,v,t,s){return(u||"")
}},{dataIndex:"ssrc",align:"right",width:__width_ColumnChar(15),renderer:function(u,q,r,v,t,s){return(u?"0x"+u.toString(16):"")
}},{dataIndex:"loss",align:"right",width:__width_ColumnNum(8),renderer:function(u,q,r,v,t,s){return(u||"")
}},{dataIndex:"maxjitter_mult10",align:"right",width:__width_ColumnNum(8),renderer:function(u,q,r,v,t,s){return(u?formatNumber(u/10,1):"")
}}];
for(var g=0;
g<f.length;
g++){if(!Ext.isDefined(f[g].header)){f[g].header=findLangS(this.subsystem,"column",f[g].dataIndex)
}}var k=new Ext.grid.GridPanel({store:d,columns:{items:f,defaults:{sortable:true}},listeners:{scope:this,afterrender:function(r){var q=r.headerCt.items.get(0);
q.on("headerclick",function(){h(r,q)
},this)
},afterlayout:function(r,q){n.center()
}}});
d.load();
var n=new Tools.ChunkPlayer({configPanel:k,audioFile:b.audioFile});
var o=null;
function h(t,s){a(s,!s.checked);
for(var r=0;
r<t.store.getCount();
r++){var q=t.store.getAt(r);
q.data.checked=s.checked;
q.commit()
}p()
}function a(q,r){if(!q){q=k.headerCt.items.get(0)
}q.checked=r;
q.setText('<img src="'+__extjs_images_path()+"menu/default-"+(q.checked?"":"un")+'checked.gif">')
}function p(w){n.stop(true);
if(w){for(var v=0;
v<d.getCount();
v++){var q=d.getAt(v);
if(q.id!=w.id&&w.data.saddr==q.data.saddr&&w.data.daddr==q.data.daddr&&w.data.sport==q.data.sport&&w.data.dport==q.data.dport&&w.data.ssrc==q.data.ssrc&&w.data.payload==q.data.payload){q.data.checked=w.data.checked;
q.commit()
}}var z=true;
for(var v=0;
v<d.getCount();
v++){if(!d.getAt(v).data.checked){z=false;
break
}}a(null,z)
}var y=[];
for(var v=0;
v<d.getCount();
v++){var u=d.getAt(v).data;
if(u.checked){var s={};
s.saddr=u.saddr;
s.daddr=u.daddr;
if(u.sport){s.sport=u.sport
}if(u.dport){s.dport=u.dport
}if(u.ssrc){s.ssrc="0x"+u.ssrc.toString(16)
}for(var t=0;
t<d.getCount();
t++){var r=d.getAt(t).data;
if(t!=v&&!r.checked&&r.saddr==u.saddr&&r.daddr==u.daddr&&r.sport==u.sport&&r.dport==u.dport&&r.ssrc==u.ssrc&&r.payload!=u.payload){s.payload=u.payload;
break
}}y.push(s)
}}if(!y.length){y="none"
}else{if(y.length==d.getCount()){y=null
}}if(o){clearTimeout(o)
}o=setTimeout(function(){c(y)
},1000)
}function c(q){n.stop(true);
if(q=="none"){n.prepareRawAudioFile("none");
return
}n.playerWindow.maskLoad();
CDR.Utils.prepareDownloadPcapWav(b.cdrId,{fceSuccess:function(r){n.prepareRawAudioFile(r);
n.playerWindow.unmask()
},fceError:function(){n.prepareRawAudioFile("none");
n.playerWindow.unmask()
},fceFailure:function(){n.prepareRawAudioFile("none");
n.playerWindow.unmask()
},wav:window.existsSox||Ext.isSafari?"wav":"ogg",filter_rtp:q?Ext.encode(q):undefined})
}function m(r,q){if(q&&q.length){var t=[];
for(var s=0;
s<q.length;
s++){if(!t.isIn(q[s].data.saddr)){t.push(q[s].data.saddr)
}if(!t.isIn(q[s].data.daddr)){t.push(q[s].data.daddr)
}}if(t.length){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getHostnames",params:Ext.encode({ip:t,cdr:true,dns_lookup:(!user.sqlrow||user.sqlrow.uc_enable_dns_cdr)})},success:function(v){if(v.hostnames){r.hostnames=v.hostnames;
var u=false;
for(var y=0;
y<r.getCount();
y++){var w=r.getAt(y);
if(v.hostnames[w.data.saddr]||v.hostnames[w.data.daddr]){w.commit();
u=true
}}if(u){n.playerWindow.updateLayout()
}}},maskEl:this,deferMask:true})
}}}},playFlashWavPlayer:function(c,d,b,f){if(!window.disableHtmlAudioPlayer&&!Ext.isIE){new Tools.WavPlayerWS({sound:"php/pcap2wav.php?id="+c+"&action="+((Ext.isChrome||Ext.isGecko||Ext.isGecko2||Ext.isGecko3)?"ogg":"wav")});
return
}if(f&&!d&&(window.dedicatedWavPlayer?!f.ctrlKey&&!f.shiftKey:f.ctrlKey||f.shiftKey)){new Tools.WavPlayer({sound:"php/pcap2wav.php?id="+c});
return
}var a=b.grid?b.getRecordForCdrId(c):b.record?b.record:b.store&&b.store.findRecord("ID",c);
if(!a){return
}var g=this.getDivWavPlayer(c,d,b);
if(g.children.length>1){var h=this.getFlashWavPlayer(c,g,d,this);
if(h&&h.doPlay){h.attachHandler("PLAYER_STOPPED","onWavPlayerStopped",Ext.encode({panelId:b.id,cdrId:c,expand:d}));
h.doPlay()
}else{Ext.defer(this.playFlashWavPlayer,100,this,[c,d,b])
}}else{this.createFlashWavPlayer(c,true,a,d,b)
}},createFlashWavPlayer:function(f,d,b,g,a){if(!b){b=a.grid?a.getRecordForCdrId(f):a.record?a.record:a.store&&a.store.findRecord("ID",f)
}var h=this.getDivWavPlayer(f,g,a);
var k=this.getImgWavPlayer(f,h,g,a);
if(!h||!k){return
}var c=document.createElement("div");
c.style.width=k.width;
c.style.height=k.height;
k.style.visibility="hidden";
k.style.height=0;
h.appendChild(c);
c.innerHTML=this.getHtmlFlashWavPlayer(f,c.style.width,c.style.height,g);
if(d){Ext.defer(this.playFlashWavPlayer,100,this,[f,g,a])
}},destroyFlashWavPlayer:function(b,c,a){var d=this.getDivWavPlayer(b,c,a);
var f=this.getImgWavPlayer(b,d,c,a);
if(!d||!f){return
}d.removeChild(d.children[1]);
f.style.visibility="visible";
f.style.height=c?15:10
},getHtmlFlashWavPlayer:function(b,d,a,c){var f=c?"#ffffff":"#dddddd";
return'<embed src="swf/wavplayer2.swf?gui=full&h='+a+"&w="+d+"&sound=php/pcap2wav.php?id="+b+'" bgcolor="'+f+'" width="'+d+'" height="'+a+'" name="haxe" quality="high" align="middle" scale="noscale" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />'
},getDivWavPlayer:function(c,d,b){if(b.grid){var h=b.getRowIndexForCdrId(c);
if(h>=0){var f=b.grid.view.getNode(h);
if(f){var g=Ext.get(f);
if(g){return Ext.DomQuery.selectNode(d?"div.wav-player-expand-png":"div.wav-player-png",g.dom)
}}}}else{if(b.record){return Ext.DomQuery.selectNode(d?"div.wav-player-expand-png":"div.wav-player-png",b.dom)
}else{if(b.store){var a=b.store.findRecord("ID",c);
if(a){var h=b.store.indexOf(a);
if(h>=0){var f=b.view.getNode(h);
if(f){var g=Ext.get(f);
if(g){return Ext.DomQuery.selectNode(d?"div.wav-player-expand-png":"div.wav-player-png",g.dom)
}}}}}}}return null
},getImgWavPlayer:function(b,d,c,a){if(!d){d=this.getDivWavPlayer(b,c)
}if(!d){return null
}return Ext.DomQuery.selectNode("img",d)
},getFlashWavPlayer:function(b,d,c,a){if(!d){d=this.getDivWavPlayer(b,c,a)
}if(!d){return null
}return Ext.DomQuery.selectNode("embed",d)
},shareCdr:function(g,d,l,a,b){if(g=="share_cdr_send"&&isDataEmpty(b)){var m=new Tools.EmailForm({windowsTitle:findLangS(this.subsystem,"title","shareCdrSendLinkViaEmail"),from:user.sqlrow.email,subject:findLangS(this.subsystem,"field","shareCdr_mailSubject"),message:findLangS(this.subsystem,"field","shareCdr_mailMessage"),signature:findLangS(this.subsystem,"field","shareCdr_mailSignature")+(user.sqlrow.name||""),fceSubmit:function(n){this.shareCdr(g,d,l,a,{emailFields:n})
},fceSubmitScope:this});
m.createWindow();
return
}var c=[];
var h=false;
if(a.ids){if(a.ids.length){c=a.ids;
h=true
}}else{var k=a.selModel.getSelection();
if(!k){return
}for(var f=0;
f<k.length;
f++){c.push(k[f].data.ID)
}}if(!c.length){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"shareCdr",params:Ext.encode({type:g,type2:d,subType:l,id:c,merge:h,emailFields:b&&b.emailFields})},success:function(n){switch(g){case"share_cdr_show":if(n.linkA&&n.linkA.length==(h?1:(a.ids?a.data.length:k.length))){var q='<table style="font: '+__font_Grid+'; table-layout: fixed;">'+(n.linkA.length>1?'<col width="90"><col width="120">':"")+'<col width="400"><col width="100">';
for(var o=0;
o<n.linkA.length;
o++){q+="<tr>"+(n.linkA.length>1?'<td style="padding: 3;">'+(a.ids?a.data[o].calldate_userformat:k[o].data.calldate_userformat)+'</td><td style="padding: 3;">'+(a.ids?a[o].caller+"<br>"+a[o].called:k[o].data.caller+"<br>"+k[o].data.called)+"</td>":"")+'<td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+n.linkA[o]+'" target="_blank">'+n.linkA[o]+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div_'+(o+1)+'" style="height: 18;"/>';
"</div></td><tr>"
}q+="</table>";
var p=400+6+100+6+(n.linkA.length>1?120+6+90+6:0)+30;
Ext.Msg.show({title:findLangS(this.subsystem,"title","shareCdr"),msg:q,buttons:Ext.Msg.OK,minWidth:p,width:p,fn:function(){for(var s=0;
s<n.linkA.length;
s++){var r=Ext.getCmp("copy_button_"+(s+1));
if(r){r.destroy()
}}}});
for(var o=0;
o<n.linkA.length;
o++){new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(r){return(r.clipboardText)
},getClipTextParams:{clipboardText:n.linkA[o]},id:"copy_button_"+(o+1),renderTo:"copy_button_div_"+(o+1)})
}}break;
case"share_cdr_send":alertAjaxSuccess(lang.emailSent);
break
}},maskEl:a.ids?null:a})
},batchDownloadCdr:function(c,b,a,d){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getCdrViaFilter",params:Ext.encode({number:c,filter:b,columns:["id as cdr_id","caller","called","calldate"],countMax:1000})},success:function(f){if(f.countMaxExceeded){Ext.Msg.alert(lang.information,findLangS("cdr","limitCdrForBatchDownloadIs")+" "+1000+".<br>"+findLangS("cdr","limitCdrForBatchDownloadSolution"));
return
}var k=f.rows;
var h=null;
if(k&&k.length){h=[];
for(var g=0;
g<k.length;
g++){h.push(k[g].cdr_id)
}}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getUserCanAudit"},success:function(l){if(l.can_audit){var m=new Tools.AuditForm({cdrId:h,activity:_AuditActivity_batch_download,autoAudit:l.can_audit==2,autoAuditParams:{fileFormat:d},fceContinue:function(){this.doBatchDownloadCdr(k,c,d)
},fceCancel:function(){},fceContinueScope:this});
m.audit()
}else{this.doBatchDownloadCdr(k,c,d)
}}})
},maskEl:a,scope:this})
},doBatchDownloadCdr:function(c,b,f){var a=new Tools.BatchDownloadCdr({CDR:true,number:b,data:c,file_format:f});
var d=new Ext.Window({title:a.windowTitle+(b?" - "+b:""),iconCls:a.iconCls,layout:"fit",items:a,border:false,modal:true,closable:true,resizable:false});
d.show()
},showFax:function(a,b,c){ajaxSafeRequest({scope:this,url:"php/pcap2pdf.php",params:{id:b,prepare:true,decodeAs:c},success:function(d){CDR.Utils._showFax(d)
},error:function(d,f){if(d.try_t30){Ext.Msg.confirm(lang.alertAjaxErrorHeader,getStringAjaxError(d,null,true)+"<br><br>"+findLangS(this.subsystem,"text","questionTryDecodeAsT30"),function(g){if(g=="yes"){CDR.Utils.showFax(a,b,"T30")
}})
}else{alertAjaxError(f)
}},maskEl:a})
},_showFax:function(c){var g=Math.min(850,Ext.dom.Element.getViewportWidth()-20);
var b=Ext.dom.Element.getViewportHeight()-50;
var a=null;
if(c.txt){a=c.txt.split("\n").join("<br>");
delete c.txt
}c.inline=true;
var f=[{title:findLangS(this.subsystem,"title","faxContent"),layout:"fit",xtype:"container",items:{xtype:"box",layout:"fit",autoEl:{tag:"embed",src:downloadPrepareFileHashUrl(c),type:"application/pdf"}},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}}];
if(a){var d=200000;
if(a.length>d){a=a.substr(0,d)+"<br>... hide "+(a.length-d)+" next bytes"
}f.push({title:findLangS(this.subsystem,"title","faxCreateLog"),layout:"fit",xtype:"panel",html:a,autoScroll:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},bodyStyle:{padding:5,font:__font_Monospace}})
}else{delete f[0].title
}var h=new Ext.Window({iconCls:"icon_fax",closable:true,maximizable:true,resizable:true,layout:"fit",items:f.length>1?{xtype:"tabpanel",items:f,border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}}:f[0],border:false,width:g,height:b});
h.show()
},getByeText:function(b,a){if(b<100){return("")
}return(b==100?findLangS(this.subsystem,"text",a?"kernelPacketLoss_short":"kernelPacketLoss"):findLangS(this.subsystem,"text",(a?"byeTextShort_":"byeText_")+b))
},getInfoText:function(c,d){var b=[];
if((d.all||d.bye)&&c.data.bye>=100){var a=CDR.Utils.getByeText(c.data.bye,d.shortText);
if(a){b.push(a)
}}if((d.all||d.stream)&&c.data.rtp_stream_used_in_another_call){b.push(findLangS("cdr","text","rtpStreamUsedInAnotherCall"))
}if(d.all||d.flags){if(c.data.flags&4){b.push(findLangS("cdr","text","unconfirmedBye"))
}if(c.data.flags&8){b.push(findLangS("cdr","text","aloneUnconfirmedBye"))
}if(c.data.flags&16){b.push(findLangS("cdr","text","srtpWithoutKey"))
}}if((d.all||d.flag_fas)&&(c.data.flags&32)){b.push(findLangS("cdr","text","fasDetected"+(d.shortText?"_short":"")))
}if((d.all||d.flag_zerossrc)&&(c.data.flags&64)){b.push(findLangS("cdr","text","zerossrcDetected"+(d.shortText?"_short":"")))
}if((d.all||d.unknown_sensor_id)&&c.data.unknown_sensor_id){b.push(findLangS("cdr","text","unknowSensorId"))
}return(b)
},getCdrRtpStreams:function(b,c,a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrRtpStreams",params:Ext.encode(b)},success:function(d){c.call(a,d.streams)
}})
},getAllRtpStreams:function(b,d){var a=Ext.decode(b.allrtpstreams);
if(!a||!a.length){for(var f=0;
f<2;
f++){var g=f==0?["a","b"]:["b","a"];
if(!Ext.isEmpty(b[g[0]+"_index"])){if(!a||!a.length){a=[]
}a.push({calldate:b.calldate,cdr_ID:b.ID,index:(b[g[0]+"_index"]*1+1).toString(),received:b[g[0]+"_received"],saddr:b[g[0]+"_saddr"],daddr:b[g[1]+"_saddr"]?b[g[1]+"_saddr"]:"unknown",duration:null})
}}}if(a&&a.length){for(var f=0;
f<a.length;
f++){if(!Ext.isDefined(a[f].index)||Ext.isEmpty(a[f].index)){a[f].index=(f+1).toString();
a[f].fake_index=true
}}if(d&&Ext.isDefined(d.receivedGt)){var c=[];
for(var f=0;
f<a.length;
f++){if(a[f].received>d.receivedGt){c.push(a[f])
}}if(c.length){a=c
}else{return(null)
}}if(d&&d.sortDescByReceived){a.sort(function(k,h){return(h.received-k.received)
})
}return(a)
}return(null)
},getRtpStreamByIndex:function(b,c,a){if(!a){a=CDR.Utils.getAllRtpStreams(b)
}if(a){for(var d=0;
d<a.length;
d++){if(a[d].index==c){return(a[d])
}}}return(null)
},rtpStream_ab:function(b,h,a){if(!a){a=CDR.Utils.getAllRtpStreams(b,{sortDescByReceived:true})
}if(a){var g=b.a_index?b.a_index*1+1:-1;
var f=b.b_index?b.b_index*1+1:-1;
var d=false;
for(var c=0;
c<a.length;
c++){if(!a[c].fake_index){if(h.toUpperCase()=="A"?a[c].index==g:a[c].index==f){return(a[c])
}}else{d=true
}}if(d){for(var c=0;
c<a.length;
c++){if(h.toUpperCase()=="A"?a[c].saddr==b.a_saddr:a[c].saddr==b.b_saddr){return(a[c])
}}}}return(null)
},rtpStreams_ab:function(b,a){var f=[];
for(var c=0;
c<2;
c++){var d=CDR.Utils.rtpStream_ab(b,c==0?"a":"b",a);
if(d){f.push(d)
}}return(f.length>0?f:null)
},rtpStreams_next:function(b,a){if(!a){a=CDR.Utils.getAllRtpStreams(b,{sortDescByReceived:true})
}if(a){var g=this.rtpStream_ab(b,"A",a);
var h=this.rtpStream_ab(b,"B",a);
var f=g?g.index:-1;
var d=h?h.index:-1;
var k=[];
for(var c=0;
c<a.length;
c++){if(a[c].index!=f&&a[c].index!=d){k.push(a[c])
}}return(k.length>0?k:null)
}return(null)
},rtpStreams_indexes:function(c){var a=[];
if(c){for(var b=0;
b<c.length;
b++){a.push(c[b].index)
}}return(a.length>0?a:null)
},rtpStreamTextInfo:function(b,a){return((b.ip_src?b.ip_src+(b.port_src?" : "+b.port_src:"")+" -> "+b.ip_dst+(b.port_dst?" : "+b.port_dst:""):b.saddr+(b.sport?" : "+b.sport:"")+" -> "+b.daddr+(b.dport?" : "+b.dport:""))+(b.ssrc?" SSRC: "+(b.ssrc*1).toString(16).toUpperCase():"")+(a&&a.packets?(b.received?" packets: "+b.received:""):"")+(a&&a.firsttime?(b.firsttime?" start: "+formatNumber(b.firsttime,3)+"s":""):"")+(a&&a.duration?("duration" in b?(b.duration?" duration: "+formatNumber(b.duration,3)+"s":""):(a&&a.duration_miss_indic&&window.langS_php&&window.langS_php.CDRtooltips.miss_rtp_duration?' duration: <span data-qtip="'+window.langS_php.CDRtooltips.miss_rtp_duration+'"> missing db column</span>':"")):""))
}});
function onWavPlayerStopped(b){b=Ext.decode(b);
var a=Ext.getCmp(b.panelId);
CDR.Utils.destroyFlashWavPlayer(b.cdrId,b.expand,a)
}function isInitCdrSelectUrlParams(){return(window.cdrId||window.callid||window.num||window.srcnum||window.dstnum||window.caller||window.called||window.calldate||window.calldatemin||window.calldatemax||window.cdr_filter||window.cdr_group_data)
}function clearInitCdrSelectUrlParams(){window.cdrId=null;
window.callid=null;
window.num=null;
window.srcnum=null;
window.dstnum=null;
window.caller=null;
window.called=null;
window.calldate=null;
window.calldatemin=null;
window.calldatemax=null;
window.cdr_filter=null;
window.cdr_group_data=null
}Ext.define("LoadMaskWithStopButton",{extend:"Ext.Panel",constructor:function(b){var a=[{xtype:"displayfield",value:"Loading ...",style:{margin:"4px","margin-top":"0px"},fieldStyle:{"font-size":11}},{xtype:"displayfield",width:25,style:{margin:"4px","margin-top":"0px","margin-left":"8px","margin-right":"10px"},fieldStyle:{"font-size":11},_id:"secTime"},{xtype:"button",text:"stop load",iconCls:"icon_cancel",style:{"border-style":"solid","border-color":"#BBBBBB","background-color":"#F8F8F8",padding:"2px !important"},handler:function(){if(this.stopFunction){this.stopFunction.call(this.stopFunctionScope||this)
}},scope:this}];
if(user_can_show_sql_query()&&!b.disableShowQuery){a.push({xtype:"button",text:"Q",iconCls:"icon_magnifier",style:{"margin-left":"5px","border-style":"solid","border-color":"#BBBBBB","background-color":"#F8F8F8",padding:"2px !important"},handler:function(){showQuery(this.store)
},scope:this})
}b=Ext.applyIf(b||{},{width:user_can_show_sql_query()&&!b.disableShowQuery?221:180,height:22,border:false,layout:"hbox",items:a,bodyStyle:{"background-color":"#EEEEEE"},listeners:{scope:this,close:this.onClose,destroy:this.onDestroy}});
this.callParent([b]);
this.timer=Ext.TaskManager.start({run:this.onTimer,interval:1000,scope:this})
},onTimer:function(){this.secTime=(this.secTime||0)+1;
var a=this.findC("_id","secTime");
if(a&&a.getEl()){a.setValue(this.secTime+"s")
}},onClose:function(){if(this.timer){Ext.TaskManager.stop(this.timer);
delete this.timer
}},onDestroy:function(){if(this.timer){Ext.TaskManager.stop(this.timer);
delete this.timer
}}});
function beginLoadMaskWithStopButton_store(a,d,c){if(a._loadMask){a._loadMask.destroy();
a._loadMask=null;
abortLoadStore(a)
}deleteElementById(d);
function b(){if(a._loadMask_loaded){return
}if(Ext.get(d)&&Ext.get(d).getWidth()){a._loadMask=new LoadMaskWithStopButton({renderTo:d,store:a,disableShowQuery:c,stopFunction:function(){abortLoadStore(a)
}})
}else{Ext.defer(b,20)
}}a._loadMask_loaded=false;
b()
}function endLoadMaskWithStopButton_store(a){a._loadMask_loaded=true;
if(a._loadMask){a._loadMask.destroy();
delete a._loadMask;
delete a._loadMask_loaded
}}function beginLoadMaskWithStopButton_ajax(b,c,a){if(b._loadMask){b._loadMask.destroy();
b._loadMask=null
}deleteElementById(c);
b.getEl().mask(getLoadMaskWithStopButton_loading_text(c,true),"x-mask-loading");
b._loadMask_timestampId=(new Date).getTime();
b._loadMask_id=c||b._loadMask_timestampId;
b._loadMask_abortTask=a
}function startLoadMaskWithStopButton_ajax(a,b){var c=a._loadMask_id;
if(Ext.get(c)&&Ext.get(c).getWidth()){a._loadMask=new LoadMaskWithStopButton({renderTo:c,disableShowQuery:true,stopFunction:function(){if(b&&b.xhr&&b.xhr.abort){abortRequest(b,a._loadMask_timestampId);
if(a._loadMask_abortTask){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:a._loadMask_abortTask,params:Ext.encode({timestampId:a._loadMask_timestampId})}})
}endLoadMaskWithStopButton_ajax(a)
}}})
}}function endLoadMaskWithStopButton_ajax(a){if(a.getEl()){if(a.getEl().getData()){a.getEl().unmask()
}if(a._loadMask){if(a._loadMask.destroy){a._loadMask.destroy()
}delete a._loadMask;
delete a._loadMask_id;
delete a._loadMask_timestampId;
delete a._loadMask_abortTask
}}}function getLoadMaskWithStopButton_loading_text(b,a){return('<div id="'+b+'" class="zero-styles" style="width: '+(user_can_show_sql_query()&&!a?220:180)+'; height: 22; padding-left: 0; padding-top: 0; padding-right: 0; padding-bottom: 0; background-image: none; border: 0px; "></div>')
}Ext.ns("CDR");
Ext.define("CDR.Chart",{extend:"Ext.Panel",alias:"widget.CDR_ChartPanelX",subsystem:"charts",constructor:function(b){b=b||{};
this.maxRows=3;
this.maxColumns=3;
this.chartPanels=[];
this.chartContainers=[];
this.chartContainersH=[];
if(!b.filtersFromParent){this.dateFrom=b.chartWindow?b.dateFrom:date((new Date).getTime()/1000-defaultCdrInterval*24*60*60)
}for(var c=0;
c<this.maxRows;
c++){this.chartContainers[c]=[];
for(var a=0;
a<this.maxColumns;
a++){this.chartContainers[c][a]=new CDR.Chart.ChartPanel({layout:"fit",border:false,flex:1,disabled:true})
}this.chartContainersH[c]=new Ext.Panel({layout:{type:"hbox",align:"stretch"},border:false,flex:1,items:this.chartContainers[c],bodyStyle:{"background-color":"grey"}})
}var d=[];
if(!b.filtersFromParent){d.push({xtype:"buttongroup",title:this.findLangS("title","date_range"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("field","from")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:this.dateFrom,_gridForm:this,_buttonGroup:true,onSetDate:function(g,f){this.dateFrom=f
},scope:this},{value:this.findLangS("field","to")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:b.dateTo,_gridForm:this,_buttonGroup:true,onSetDate:function(g,f){this.dateTo=f
},scope:this}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(!b.btnAdd&&!b.disableCreateBtnAdd){this.btnAdd=new Ext.Button({iconCls:"icon_add",handler:!user_can_messages()?function(){this.addChart()
}:undefined,scope:this,menu:user_can_messages()?{defaults:{handler:function(f){this.addChart(f._typeChart)
},scope:this},items:[{text:"CDR",_typeChart:"CDR"},{text:"MESSAGES",_typeChart:"MESSAGES"},{text:"SIP Opt., Subsc., Notify",_typeChart:"SIP_MSG"}]}:undefined});
d.push(this.btnAdd)
}b=Ext.applyIf(b,{layout:"fit",border:true,items:{layout:{type:"vbox",align:"stretch"},border:false,items:this.chartContainersH,tbar:d.length?d:undefined,listeners:{scope:this,afterrender:function(){this.setChartsLayout()
},destroy:function(){this.removeAllCharts()
}},bodyStyle:{"background-color":"grey"}}});
if(!b.chartWindow&&!b.childPanel){b=Ext.applyIf(b,{layout:"fit",id:"CDR_Chart-panel",title:this.findLangS("title","charts"),iconCls:"icon_menu_diag_system",wikiId:"Charts"})
}this.callParent([b]);
if(b.chartWindow){b.chartWindow.on("beforeclose",function(){if(this.chartPanels.length){this.maskLoad();
Ext.defer(function(){this.removeAllCharts();
this.unmask();
this.chartWindow.close()
},100,this);
return(false)
}},this)
}},addChart:function(b){if(!b){b="CDR"
}var a=this.chartPanels.length;
if(a==this.maxRows*this.maxColumns){return
}var c={chartType:"TCH_count"};
if(!this.filtersFromParent){Ext.apply(c,{dateFrom:this.dateFrom,dateTo:this.dateTo})
}new CDR.Chart.ConfigForm({filtersFromParent:this.filtersFromParent,chartDefault:c,onApply:function(d){this.chartPanels.push(new CDR.Chart.ChartPanel({chartsOwner:this}));
this.chartPanels[a].loadChart(d,true,{fceInvalidQuery:function(){this.deleteChart(this.chartPanels[a])
},fceInvalidQueryScope:this,fceError:function(k,h,f,g){alertAjaxError(g);
this.deleteChart(this.chartPanels[a])
},fceErrorScope:this,fceFailure:function(h,g,f){if(!requestIsAborted(f)){alertAjaxFailure(f)
}this.deleteChart(this.chartPanels[a])
},fceFailureScope:this});
if(this.btnAdd){this.btnAdd.setDisabled(a==this.maxRows*this.maxColumns-1)
}},onApplyScope:this,_typeChart:b})
},deleteChart:function(a){var b=null;
for(var c=0;
c<this.chartPanels.length;
c++){if(this.chartPanels[c]==a){b=c;
break
}}if(b!==null){this.chartPanels[b].destroy();
this.chartPanels.splice(b,1)
}},removeChart:function(a){this.maskLoad();
Ext.defer(function(){var b=null;
for(var c=0;
c<this.chartPanels.length;
c++){if(this.chartPanels[c]==a){b=c;
break
}}if(b!==null){this.chartPanels[b].destroy();
this.chartPanels.splice(b,1);
this.setChartsLayout()
}this.unmask();
if(this.btnAdd){this.btnAdd.setDisabled(false)
}},100,this)
},removeAllCharts:function(){while(this.chartPanels.length){var a=this.chartPanels.length-1;
this.chartPanels[a].destroy();
this.chartPanels.splice(a,1)
}},setChartsLayout:function(f){var a=this.chartPanels.length;
var g=a<=2?1:a<=4?2:3;
this.body.setStyle({"background-color":this.chartPanels.length?"grey":__color_PanelBackgroud});
var h=parseInt(a/g)+(a%g?1:0);
var d=0;
for(var c=0;
c<this.maxColumns;
c++){this.chartContainersH[c].flex=c<h?1:0;
this.chartContainersH[c].el.setStyle({"padding-bottom":c<h-1?1:0});
for(var b=0;
b<this.maxRows;
b++){this.chartContainers[c][b].flex=b<g?1:0;
this.chartContainers[c][b].el.setStyle({"padding-right":b<g-1?1:0});
this.chartContainers[c][b].removeAll(false);
if(c<h&&b<g&&d<a){this.chartContainers[c][b].setDisabled(false);
this.chartContainers[c][b].add(this.chartPanels[d]);
this.chartContainers[c][b].unmask();
++d
}else{this.chartContainers[c][b].setDisabled(true)
}}}this.updateLayout()
},reloadCharts:function(a){for(var b=0;
b<this.chartPanels.length;
b++){this.chartPanels[b].reloadChart(a)
}},changeTimezone:function(){this.reloadCharts()
}});
Ext.define("CDR.Chart.ChartPanel",{extend:"Ext.Panel",subsystem:"charts",constructor:function(a){a=Ext.applyIf(a||{},{layout:"absolute",border:false,listeners:{resize:function(){this.setToolsPanelPosition()
},scope:this}});
this.callParent([a])
},loadChart:function(g,f,b){this.completeChartConfig(g);
if(!g._typeChart){g._typeChart="CDR"
}for(var c=0;
c<g.series.length;
c++){g.series[c].varName2="s_"+(c+1)
}var a=new CDR.Chart.Store({chartConfig:g});
var d=this;
this.loadRequest=a.loadChartData({onLoad:function(h,k){if(h){this.clearChart();
this.createChart(g,k,f);
if(b&&b.fceOkQuery){b.fceOkQuery.call(b.fceOkQueryScope||this,b.fceOkQueryParam)
}}else{if(!this._disableAlertInvalidQuery){Ext.Msg.alert(d.findLangS("text","msgInvalidQuery"),g._typeChart=="CDR"?d.findLangS("text","msgInvalidQueryDescr"):g._typeChart=="MESSAGES"?d.findLangS("text","msgInvalidQueryDescr_messages"):g._typeChart=="SIP_MSG"?d.findLangS("text","msgInvalidQueryDescr_sip_msg"):d.findLangS("text","msgInvalidQueryDescr_records"),function(){if(b&&b.fceInvalidQuery){b.fceInvalidQuery.call(b.fceInvalidQueryScope||this,b.fceInvalidQueryParam,k)
}},this)
}else{if(b&&b.fceInvalidQuery){b.fceInvalidQuery.call(b.fceInvalidQueryScope||this,b.fceInvalidQueryParam,k)
}}if(f){if(this.chartsOwner&&this.chartsOwner.removeChart){Ext.defer(this.chartsOwner.deleteChart,100,this.chartsOwner,[this])
}}else{delete k
}}},onError:b&&b.fceError?function(l,h,k){b.fceError.call(b.fceErrorScope||this,b.fceErrorParam,l,h,k)
}:undefined,onFailure:b&&b.fceFailure?function(k,h){b.fceFailure.call(b.fceFailureScope||this,b.fceFailureParam,k,h)
}:undefined,scope:this,maskCmp:this._disableMaskOnLoad?undefined:this.chartsOwner||this})
},createChart:function(c,a,b){this.chart=new CDR.Chart.Chart({store:a,anchor:"0, 0",_id:"chart",_chartPanel:this,_typeChart:c._typeChart});
this.addChart();
if(b&&this.chartsOwner&&this.chartsOwner.setChartsLayout){this.chartsOwner.setChartsLayout()
}},addChart:function(){var a=[{flex:1}];
if(this._enableBtns!==false){if((!this.chart.store.chartConfig||!this.chart.store.chartConfig.filtersFromParent)&&this._enableBtnNextPrev!==false){a.push({xtype:"button",iconCls:"x-tbar-page-prev",handler:function(b){this.chart.timeShift(false)
},tooltip:this.findLangS("tooltip","prev")},{xtype:"button",iconCls:"x-tbar-page-next",handler:function(b){this.chart.timeShift(true)
},tooltip:this.findLangS("tooltip","next")})
}a.push({xtype:"button",iconCls:"icon_save2_blue",handler:function(b){this.saveChart("svg")
},tooltip:this.findLangS("tooltip","saveAsSVG")},{xtype:"button",iconCls:"icon_save2_pdf",handler:function(b,c){if(this.chart.engine==Ext.draw.engine.Svg){var d=new Ext.menu.Menu({defaults:{handler:function(f){this.saveChart(f._saveType)
},scope:this},items:[{text:this.findLangS("menu","simpleConvert"),_saveType:"pdf"},{text:this.findLangS("menu","pageFormat"),_saveType:"pdf_page"}]});
d.showAtMouse(c)
}else{this.saveChart("pdf_page")
}},tooltip:this.findLangS("tooltip","saveAsPDF")});
if(this._enableBtnTracker!==false&&user_can_tracker()){a.push({xtype:"button",iconCls:"icon_tracker",handler:function(b){this.newTrackerTicket()
},tooltip:this.findLangS("tooltip","newTrackerTicket")})
}if(this._enableBtnEdit!==false){a.push({xtype:"button",iconCls:"icon_edit",handler:function(b){this.editChartConfig()
},tooltip:this.findLangS("tooltip","editChart")})
}if(this._enableBtnRemove!==false){a.push({xtype:"button",iconCls:"icon_remove",handler:function(b){this.removeChart()
},tooltip:this.findLangS("tooltip","closeChart")})
}if(this._enableBtnUndock){a.push({xtype:"button",text:this.findLangS("button","undock"),handler:this.undock,scope:this,border:true,tooltip:this.findLangS("tooltip","undockChart"),height:17,style:{marginLeft:4,marginTop:2,marginRight:4},innerStyle:{marginTop:-5}})
}}this.add([this.chart,this._enableBtns!==false?new Ext.panel.Panel({layout:"hbox",x:5,y:5,width:20*(a.length-1)+(this._enableBtnUndock?35:0),border:false,_id:"tools",defaults:{border:false,style:{background:"transparent"},scope:this},items:a,hidden:true}):undefined]);
Ext.defer(this.setToolsPanelPosition,100,this)
},editChartConfig:function(){new CDR.Chart.ConfigForm({chartConfig:this.chart.store.chartConfig,onApply:function(a){this.loadChart(a)
},onApplyScope:this})
},setToolsPanelPosition:function(){if(!this.getEl()||this._enableBtns===false){return
}if(!this.items||this.items.getCount()<2||this.items.items[1]._id!="tools"||!this.items.items[1].getEl()){return
}var b=this.getWidth();
var c=this.getPosition();
var a=this.items.items[1].getWidth()||this.items.items[1].width;
this.items.items[1].show();
this.items.items[1].setStyle({"z-index":10});
this.items.items[1].setXY([c[0]+b-a,c[1]])
},clearChart:function(){this.removeAll(true)
},removeChart:function(){if(this.chartsOwner&&this.chartsOwner.removeChart){this.chartsOwner.removeChart(this)
}},okChart:function(){return(this.chart&&this.chart.store&&this.chart.store.getCount()&&this.chart.store.validData)
},saveChart:function(a){this.chart.saveChart(a)
},newTrackerTicket:function(){this.chart.newTrackerTicket()
},reloadChart:function(a){this.chart.reloadChart(null,a)
},reloadChartWithNewChartConfig:function(b,a,c){if(b&&c&&this.chart.store&&this.chart.store.chartConfig&&this.chart.store.chartConfig.series){b.series=this.chart.store.chartConfig.series
}this.chart.reloadChart(b,a)
},onReloadChart:function(){this.chart.setVisible(this.chart.store.validData);
this.enableIf(this.chart.store.validData)
},undock:function(){var b=Ext.dom.Element.getViewportWidth()-20;
var a=Ext.dom.Element.getViewportHeight()-50;
var c=new Ext.Window({title:this.undockTitle,iconCls:this.undockCls||"icon_menu_diag_system",closable:true,maximizable:true,resizable:true,layout:"fit",items:this.chart,border:false,width:b,height:a,modal:true,listeners:{scope:this,beforeclose:function(){c.removeAll(false);
this.removeAll();
this.addChart()
}}});
c.show()
},completeChartConfig:function(b){if(!b){return
}if(b.series){for(var a=0;
a<b.series.length;
a++){this.completeSeries(b.series[a])
}}},completeSeries:function(a){if(a.series=="TCHS_sipResponse_base"&&!a.multiSeriesIntervals){a.multiSeriesIntervals=getDataArrayItem(arCdrChart_chartSeriesTypes,a.series,0,8)
}}});
Ext.define("CDR.Chart.Chart",{extend:"Ext.chart.CartesianChart",subsystem:"charts",constructor:function(d){d=d||{};
legendPosition=d.store.chartConfig.legendPosition||"top";
var c=d.store.chartConfig.title||f(d.store.chartConfig.series);
if(!d.store.chartConfig._title){d.store.chartConfig._title=c
}if(!d.store.chartConfig.theme){d.store.chartConfig.theme="CdrChart"
}Ext.applyIf(d,{xtype:"cartesian",animation:false,border:false,axes:d.store.chartConfig.combinationToArea?l.call(this,d.store.chartConfig,d.store.chartData,d.store):k.call(this,d.store.chartConfig,d.store.chartData,d.store),series:d.store.chartConfig.defSeries?d.store.chartConfig.defSeries:d.store.chartConfig.combinationToArea?m.call(this,d.store.chartConfig,d.store.chartData,d.store,d):g.call(this,d.store.chartConfig,d.store.chartData,d.store,d),shadow:true,theme:d.store.chartConfig.theme,background:"white",legend:d.store.chartConfig.legendPosition=="none"?false:{docked:legendPosition,type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:3},insetPadding:{top:d.paddingTop||4,bottom:4,left:4,right:4},_saveType:"auto",_saveViaSenchaIo:false,_typeChart:"CDR",plugins:{ptype:"chartitemevents",moveEvents:true},interactions:[{type:"itemhighlight",sticky:false}],listeners:{scope:this,render:function(){ch=this;
if(!this._init_zindex_processed){for(var p=0;
p<this.series.length;
p++){if(this.series[p]._style&&this.series[p]._style.zIndex){this.series[p].sprites[0].setAttributes({zIndex:this.series[p]._style.zIndex})
}}this._init_zindex_processed=true
}}}});
if(c&&!["none","blank"].isIn(c)){var b=0;
var n=0;
if(legendPosition=="top"){b=30;
n=14
}else{b=30;
n=14
}d.insetPadding.top=b;
Ext.applyIf(d,{sprites:[{type:"text",text:c,font:"bold 13px tahoma,arial,verdana,sans-serif",width:200,height:20,x:10,y:n}]})
}this.callParent([d]);
function k(B,q,w){var L=this;
var I=[];
for(var J=0;
J<B.series.length;
J++){if(B.series[J]._multipleFactorAxis){B.series[J]._multipleFactorAxis=null;
this.applyMultipleFactorAxis(q.axis,B.series[J],q.multiSeriesItems,w)
}}for(var J=0;
J<2;
J++){var G=null;
var v=null;
var A=null;
for(var H=0;
H<B.series.length&&G===null;
H++){if(B.series[H].sideAxis==(J?"right":"left")){if(v===null){v=H
}if(B.series[H].primaryAxis){G=H
}}}if(G===null){G=v
}if(G!==null){B.series[G]._primary=true;
B.series[G]._primaryMain=true;
var D=[G];
var F=[];
var E=a(B.series[G],q.multiSeriesItems);
var A=B.series[G].primaryAxis?B.series[G].color:null;
var N=[B.series[G].color];
for(var H=0;
H<B.series.length;
H++){if(B.series[H].sideAxis==(J?"right":"left")&&H!=G){if(B.series[H].unit==B.series[G].unit){D.push(H);
E=E.concat(a(B.series[H],q.multiSeriesItems));
N.push(B.series[H].color);
B.series[H]._primary=true
}else{F.push(H)
}}}var M=null;
var C=null;
var y=1;
if(B.series[G].percent){M=100;
C=100
}else{for(var H=0;
H<D.length;
H++){M=Math.max(M,this.getMaxSeries(q.axis,B.series[D[H]],q.multiSeriesItems));
C=Math.max(C,this.getMaxSeries(q.axis,B.series[D[H]],q.multiSeriesItems,true))
}y=1;
if(M){if(M<0.5){while(M<0.5){M*=10;
C*=10;
y*=10
}for(var H=0;
H<D.length;
H++){B.series[D[H]]._multipleFactorAxis=y;
this.applyMultipleFactorAxis(q.axis,B.series[D[H]],q.multiSeriesItems,w)
}}for(var H=0;
H<F.length;
H++){var s=this.getMaxSeries(q.axis,B.series[F[H]],q.multiSeriesItems);
if(s){B.series[F[H]]._multipleFactorAxis=M/s;
this.applyMultipleFactorAxis(q.axis,B.series[F[H]],q.multiSeriesItems,w)
}}}}var r={type:"numeric",position:(J?"right":"left"),grid:J==0,gridColor:"#E0E0E0",fields:E,renderer:function(R,Q,P,S){var O=R.config.label;
return(O._scope.renderChartValue(Q/(O._multipleFactorPrimaryAxis||1),O._type,"axes"))
},label:{_type:B.series[G].percent?"%":B.series[G].varName,_multipleFactorPrimaryAxis:y,_scope:this},minimum:0,title:B[J?"axisTitleRight":"axisTitleLeft"]||B.series[G].title,minAxisWidth:B[J?"rightAxisMinWidth":"leftAxisMinWidth"]*1,_iPrimaryFirst:G};
var z=this.renderChartValue_config(B.series[G].percent?"%":B.series[G].varName);
Ext.apply(r,{_decPrecision:z.decAxes,_maxTickSteps:function(){return(L.getHeight()?Math.min(Math.max(Math.floor(L.getHeight()/20),4),20):10)
}});
var t=window.charts_suppress_limit_value?0:(J?B.rightLimitLineValue:B.leftLimitLineValue);
if(B.series[G].percent){r.maximum=Math.max(100,t*1);
r.constrain=false
}else{if(t&&t>M){r.maximum=t*1;
r.constrain=false
}}var u=this.getAxisLimits(B,q,J==0?"left":"right",r);
if(u){r.limits=u
}var K=A||N.length==1&&N[0];
if(K){var p=lightColor(K,1.5,1.2);
r.label.fill=p;
r.labelTitle={fill:K};
r.axisStyle={stroke:p}
}I.push(r)
}else{if(B[J?"rightAxisMinWidth":"leftAxisMinWidth"]*1>0){var r={type:"category",position:(J?"right":"left"),fields:[0],minimum:0,maximum:1,majorTickSteps:0,renderer:function(Q,P,O,R){return("")
},title:"-",labelTitle:{fill:"white"},disableTicks:true,minAxisWidth:B[J?"rightAxisMinWidth":"leftAxisMinWidth"]*1};
I.push(r)
}}}I.push(o.call(this,B,q,w));
return(I)
}function l(u,t,p){var r=[];
for(var q=0;
q<u.series.length;
q++){r.push(a(u.series[q])[0])
}var v=[];
var s={type:"numeric",position:"left",grid:true,gridColor:"#E0E0E0",fields:r,renderer:function(A,z,y,B){var w=A.config.label;
return(w._scope.renderChartValue(z,w._type,"axes"))
},label:{_type:u.series[0].varName,_scope:this},minimum:0,title:u.axisTitleLeft||u.series[0].title};
v.push(s);
v.push(o.call(this,u,t,p));
return(v)
}function a(s,q){var p=[];
var t=s.varName2;
if(s.multiSeries){if(q[t]){for(var r=0;
r<q[t].length;
r++){p.push("y_"+t+"_"+r+(s.percent?"_perc":""))
}}}else{p.push("y_"+t)
}return(p)
}function g(J,t,D,R){var E=[];
for(var O=0;
O<J.series.length;
O++){var w=J.series[O].baseType=="column"?"bar":J.series[O].baseType=="column_line"?(t.axis.length>80?"line":"bar"):J.series[O].baseType;
var v=undefined;
if(!Ext.isEmpty(J.series[O].color)){v={base:J.series[O].color,light:lightColor(J.series[O].color)}
}var P={lineWidth:w=="bar"?2:w=="line"||w=="trend"?(R.lineWidth||2):undefined,lineDash:J.series[O].lineType=="dashed"?[10,2]:J.series[O].lineType=="dotted"?[2,2]:undefined,minGapWidth:1};
var G=J.series[O].markers?{type:"circle",size:2,radius:2}:undefined;
var q=undefined;
if(Ext.isDefined(v)){Ext.apply(P,{_seriesColor:v,stroke:w=="line"||w=="trend"?v.base:v.light,fill:w=="line"||w=="trend"?v.base:v.light});
if(J.series[O].markers){Ext.apply(G,{stroke:v.base})
}q={fillStyle:w=="line"||w=="trend"?v.light:v.light,strokeStyle:w=="line"||w=="trend"?v.light:v.base}
}if(J.series[O].opacity){P.opacity=J.series[O].opacity
}if(w=="line"||w=="trend"){P.zIndex=20000+O
}var z=[];
var U=[];
if(J.series[O].multiSeries){var Q=J.series[O].varName2;
if(t.multiSeriesItems[Q]){for(var N=0;
N<t.multiSeriesItems[Q].length;
N++){z.push("y_"+Q+"_"+N+(J.series[O].percent?"_perc":""));
var T=t.multiSeriesItems[Q][N];
if(J.series[0].multiSeriesIntervals){for(var M=0;
M<J.series[0].multiSeriesIntervals.length;
M++){if(Ext.isString(J.series[0].multiSeriesIntervals[M][0])){var K=J.series[0].multiSeriesIntervals[M][0];
if(K.match("/")&&K.split("/")[0]==T){T=K.split("/")[1]
}}}}U.push(T)
}}}else{var y="y_"+J.series[O].varName2;
var T=J.series[O].title;
if(J.series[O].paramSeries){if(J.series[O].titleBase){var T=J.series[O].titleBase
}}var s="";
if(J.series[O].filter&&J.series[O].filter.series_title){s+=J.series[O].filter.series_title
}if(J.series[O].timeOffset&&J.series[O].timeOffset.name){if(s){s+=" / "
}s+=J.series[O].timeOffset.name
}if(s){T=s
}z.push(y);
U.push(T)
}for(var N=0;
N<U.length;
N++){if(U[N].length>26){U[N]=U[N].substr(0,26)+"..."
}}for(var N=0;
N<(w=="area"?1:z.length);
N++){var B=w=="area"&&t.axis.length>80;
var u=w=="area"&&!B;
var L={title:w=="area"?U:U[N],type:w=="area"?(B?"area":"bar"):(w=="trend"?"line":w),stacked:w=="area",xField:"x",yField:w=="area"?z:z[N],axis:J.series[O].sideAxis,_multipleFactorAxis:J.series[O]._multipleFactorAxis||1,_percent:J.series[O].percent,tips:{trackMouse:true,renderer:function(X,ae,an){var af="";
var am=null;
var ac=null;
var ad=null;
var ah=an.series&&an.series._chart.store.chartConfig;
if(ae.data.x&&ae.data.x.getTime&&ah&&ah.timeAxis){am=clone(ae.data.x);
ac=clone(new Date(dateTime(ae.data.x).getTime()+arCdrChart_timeAxisTypes[ah.timeAxis].step*1000));
if(!Ext.isArray(an.series._yField)){for(var al=0;
al<ah.series.length;
al++){if("y_"+ah.series[al].varName2==an.series._yField){if(ah.series[al].timeOffset){am=C(am,ah.series[al].timeOffset);
ac=C(ac,ah.series[al].timeOffset)
}break
}}}ad=trimTimeFormatString(am,ac)+" - "+trimTimeFormatString(ac,am)
}if(Ext.isArray(an.series._yField)){var ab=an.series._yField;
var Z=ab.length&&ab[0].match(/_perc$/);
var V=0;
if(!Z){for(var al=0;
al<ab.length;
al++){if(!an.series._title[al]||!an.record.data[ab[al]]){continue
}var ai=an.record.data[ab[al]];
V+=ai/(an.series._multipleFactorAxis||1)
}}for(var al=0;
al<ab.length;
al++){if(!an.series._title[al]||!an.record.data[ab[al]]){continue
}if(!af){if(ad){af+='<p style="font-weight: normal; color: black; margin: 0; padding-left: 3px; padding-bottom: 2px; white-space:nowrap;">'+ad+"</p>"
}af+='<table style="font-size: 11;">'
}var aj="#FFFFFF";
if(an.series._legendColors){aj=an.series._multiSeriesIntervalsFix?h(an.series._legendColors,an.series._title[al]):an.series._legendColors[an.series._title[al]]
}else{if(an.series.colorArrayStyle){aj=an.series.colorArrayStyle[al%an.series.colorArrayStyle.length]
}else{if(an.series._chart.theme._colors){var W=0;
for(var ak=0;
ak<an.series._chart.series.length;
ak++){if(an.series._chart.series[ak].id==an.series.id){break
}++W
}aj=an.series._chart.theme._colors[(al+W)%an.series._chart.theme._colors.length]
}}}af+="<tr>";
af+='<td style="color: '+aj+'; white-space:nowrap;">';
af+="<b><i>"+an.series._title[al]+"</i></b>";
af+='<td style="text-align: right; padding-left: 20px; white-space:nowrap;">';
var ai=an.series._scope.renderChartValue(an.record.data[ab[al]]/(an.series._multipleFactorAxis||1),Z?"%":an.series._varName,"tip");
af+="<b>"+ai+"</b>";
if(Z){af+='<td style="text-align: right; padding-left: 20px; white-space:nowrap;">';
ai=an.series._scope.renderChartValue(an.record.data[ab[al].substr(0,ab[al].length-5)],an.series._varName,"tip");
af+="<b>"+ai+"</b>"
}else{af+='<td style="text-align: right; padding-left: 20px; white-space:nowrap;">';
ai=roundNumber(ai/V*100,1)+" %";
af+="<b>"+ai+"</b>"
}}widthInc=30
}else{var Y=an.series._yField;
if(Y){af+='<p style="font-weight: normal; color: black; margin: 0; padding-left: 3px; padding-bottom: 2px; white-space:nowrap;">'+ad+"</p>";
af+='<table style="font-size: 11;">';
if(an.series._title){var aj="#FFFFFF";
if(an.series&&an.series._style&&an.series._style.fillStyle){aj=lightColor(an.series._style.fillStyle,1,0.7)
}af+="<tr>";
af+='<td style="color: '+aj+'; white-space:nowrap;">';
af+="<b><i>"+an.series._title+"</i></b>"
}var ai=an.series._scope.renderChartValue(ae.get(Y)/(an.series._multipleFactorAxis||1),an.series._varName,"tip");
af+='<td style="text-align: right; padding-left: 20px; white-space:nowrap;"><b>'+ai+"</b>"
}}if(af&&af.length){if(af&&af.length){af+="</table>"
}if(ah){if(!ah.disableClickHereForAnalyze&&Ext.isArray(an.series._yField)){var aa=false;
for(var al=0;
al<ah.series.length;
al++){if(ah.series[al].varName.match(/^sm_.*_intervals$/)){aa=true
}}if(aa){af+='<p style="font-weight: normal; color: chocolate; margin: 0; padding-left: 3px; padding-top: 2px; white-space:nowrap;"><i>click for analyze top IP adresses</i></p>'
}}}window.chartsTipCount=window.chartsTipCount?window.chartsTipCount+1:1;
Ext.defer(function(){if(window.chartsTipCount>0){--window.chartsTipCount
}},100,this);
if(window.chartsTipCount==1){var ag=getSizeHtml(af);
X.setWidth(ag[0]+10);
X.setHeight(ag[1]+5);
X.setTitle(af)
}}else{X.setTitle(null)
}}},_scope:this,_varName:J.series[O].varName};
if(w!="area"){Ext.apply(L,{smooth:J.series[O].smooth,fill:J.series[O].fill,style:P});
if(G){L.marker=G
}if(q){L.highlight=true;
L.highlightCfg=q
}}else{Ext.apply(L,{style:{minGapWidth:1}});
if(t.multiSeriesColors&&t.multiSeriesColors[J.series[O].varName2]){var A=cloneObject(t.multiSeriesColors[J.series[O].varName2]);
var p=cloneObject(t.multiSeriesColors[J.series[O].varName2]);
if(J.series.length>1){for(var F in A){A[F]=lightColor(A[F],1.5,1.5)
}for(var F in p){p[F]=lightColor(p[F],1.5,1.5)
}}var S=[];
for(var F in A){S.push(A[F])
}Ext.apply(L,{_multiSeriesColors:A,_legendColors:p,colors:S})
}else{if(J.series[0].chartType=="TCH_sipResponse_base"&&J.series[0].multiSeriesIntervals){var A=cloneObject(J.series[0].multiSeriesIntervals);
var p=cloneObject(J.series[0].multiSeriesIntervals);
var S=[];
for(var O=0;
O<L.title.length;
O++){S.push(h(A,L.title[O]))
}Ext.apply(L,{_multiSeriesColors:A,_legendColors:p,_multiSeriesIntervalsFix:true,colors:S})
}else{if(Ext.chart.theme[J.theme]){var I=Ext.create("Ext.chart.theme."+J.theme,{}).getColors();
var p={};
for(var r=0;
r<L.title.length;
r++){p[L.title[r]]=I[r%I.length]
}var S=[];
for(var H=0;
H<I.length;
H++){S.push(I[H])
}Ext.apply(L,{_legendColors:p,colors:S})
}}}if(L.type=="bar"){Ext.apply(L,{highlight:true,highlightCfg:{lineWidth:2,opacity:0.5}})
}else{if(L.type=="area"){if(!L.marker){L.marker={opacity:0}
}Ext.apply(L,{highlight:true,highlightCfg:{type:"circle",radius:5,lineWidth:2,opacity:1}})
}}}Ext.apply(L,{listeners:{scope:this,itemmouseover:function(V,X,W){V._chart.setHighlightSeries(V);
if(V._chart.isEnableEvClick(V,X,W)){this.setStyle("cursor","pointer")
}},itemmouseout:function(V,X,W){V._chart.setHighlightSeries(null);
this.setStyle("cursor","auto")
}}});
if(Ext.isArray(L.yField)){L.listeners.itemclick=function(V,X,W){V._chart.evClick(V,X,W)
}
}E.push(L)
}}return(E);
function C(W,V){if(V.hours){W=decHour(W,V.hours)
}if(V.days){W=decDay(W,V.days)
}if(V.months){W=decMonth(W,V.months)
}return(W)
}}function m(w,s,r,q){var p=[];
var v=[];
for(var u=0;
u<w.series.length;
u++){var y=a(w.series[u]);
p=p.concat(y);
v.push(w.series[u].filter&&w.series[u].filter.series_title?w.series[u].filter.series_title:y[0])
}var z=s.axis.length>80;
var t={title:v,type:z?"area":"bar",stacked:true,yField:p,xField:"x",axis:"left",highlight:z,tips:{trackMouse:true,width:150,height:34,renderer:function(G,F,E){var D=null;
var H=null;
if(Ext.isArray(E.series._yField)){var A=E.series._yField.indexOf(E.yField||E.storeField);
if(A>=0){D=E.series._yField[A];
var C=E.series._scope.store.chartConfig.series;
for(var B=0;
B<C.length;
B++){if(D==a(C[B])[0]){H=C[B].filter&&C[B].filter.series_title?C[B].filter.series_title:D;
break
}}}}if(D){tipTitle="";
if(H){tipTitle="<b><i>"+H+"</i></b><br>"
}tipTitle+=E.series._scope.renderChartValue(F.get(D),E.series._varName,"tip");
this.setTitle(tipTitle)
}}},_scope:this,_varName:w.series[0].varName};
return([t])
}function o(s,r,p){var q=this;
var t={position:"bottom",fields:"x",grid:true,gridColor:"#E0E0E0",renderer:function(w,v,u,y){return s.timeAxis?Ext.Date.format(Ext.isDate(v)?v:new Date(v),arCdrChart_timeAxisTypes[s.timeAxis].format):(Ext.isOpera?"Â ":"")
},label:{rotate:{degrees:-60}},title:this.getTitleTimeAxis(s,r),limits:[{value:-1}]};
Ext.apply(t,{type:"category",_typeTimeAxis:s.timeAxis,_maxTickSteps:function(){return(q.getWidth()?Math.min(Math.max(Math.floor(q.getWidth()/40),4),40):20)
}});
return(t)
}function f(t){var u="";
for(var s=0;
s<2;
s++){var r=null;
var p=null;
for(var q=0;
q<t.length&&r===null;
q++){if(t[q].sideAxis==(s?"right":"left")){if(p===null){p=q
}if(t[q].primaryAxis){r=q
}}}if(r===null){r=p
}if(r!==null){u=u+(u?" / ":"")+(t[r].titleBase||t[r].title)
}}return(u)
}function h(p,s){var q="#000000";
for(var r=0;
r<p.length;
r++){if(Ext.isString(p[r][0])&&p[r][0].match("/")?s==p[r][0].split("/")[0]||s==p[r][0].split("/")[1]:s==p[r][0]){q=p[r][1]
}}return(q)
}},renderChartValue_config:function(g){var k=["","y_","s_","y_s_"];
var b=["","_all","_max","_avg","_min","_avg1","_min1","_perc95","_perc99"];
var h=null;
var a=0;
var f=1;
for(var d=0;
d<k.length;
d++){for(var c=0;
c<b.length;
c++){if(g==k[d]+"%"+b[c]){h="%";
a=1;
break
}else{if(g==k[d]+"delay"+b[c]){h=__unit_xPDV;
a=1;
break
}else{if(g==k[d]+"acd"+b[c]){h="s";
break
}else{if(g==k[d]+"pdd"+b[c]){h="s";
a=1;
break
}else{if(g==k[d]+"asr"+b[c]){h="%";
break
}else{if(g==k[d]+"ner"+b[c]){h="%";
break
}else{if(g==k[d]+"packet_lost"+b[c]){h="%";
a=3;
f=3;
break
}else{if(g==k[d]+"rtcp_avgfr"+b[c]||g==k[d]+"rtcp_maxfr"+b[c]){h="%";
a=1;
f=1;
break
}else{if(g==k[d]+"silence_end_caller"+b[c]||g==k[d]+"silence_end_called"+b[c]){h="s";
a=0;
f=0;
break
}else{if(g==k[d]+"silence_caller"+b[c]||g==k[d]+"silence_called"+b[c]){h="%";
a=0;
f=0;
break
}else{if(g==k[d]+"clipping"+b[c]||g==k[d]+"clipping_caller"+b[c]||g==k[d]+"clipping_called"+b[c]){a=0;
f=0;
break
}}}}}}}}}}}}}return({unit:h,decAxes:a,decTip:f})
},renderChartValue:function(c,b,d){if(d=="axes"&&c==0){return(Ext.isOpera?"Â ":"")
}var a=this.renderChartValue_config(b);
if(d=="axes"){if(roundNumber(c,a.decAxes+(a.decAxes==0?2:1))==roundNumber(c,a.decAxes)){return(roundNumber(c,a.decAxes)+(a.unit?" "+a.unit:""))
}else{return(Ext.isOpera?"Â ":"")
}}else{return(roundNumber(c,a.decTip)+(a.unit?" "+a.unit:""))
}},reloadChart:function(f,c){var d=this;
f=f||this.store.chartConfig;
if(f&&!f._typeChart){f._typeChart="CDR"
}var a=f.timeAxis;
applyFiltersFromParentToChartConfig(f);
if(f.filtersFromParent){adjustChartConfigTimeAxisForFiltersFromParent(f)
}if(f.timeAxis!=a){this._chartPanel.loadChart(f);
return
}var b=this.store.chartData&&this.store.chartData.multiSeriesItems&&this.store.chartData.multiSeriesItems.s_1?this.store.chartData.multiSeriesItems.s_1:null;
this.store.loadChartData({onLoad:function(g,k){if(g=="olddata"){Ext.Msg.alert(findLangS("charts","text","msgInvalidNewQuery"),f._typeChart=="CDR"?findLangS("charts","text","msgInvalidNewQueryDescr"):f._typeChart=="MESSAGES"?findLangS("charts","text","msgInvalidNewQueryDescr_messages"):f._typeChart=="SIP_MSG"?findLangS("charts","text","msgInvalidNewQueryDescr_sip_msg"):findLangS("charts","text","msgInvalidNewQueryDescr_records"))
}if(d.getEl()){var m=k.chartData&&k.chartData.multiSeriesItems&&k.chartData.multiSeriesItems.s_1?k.chartData.multiSeriesItems.s_1:null;
var h=false;
if(b||m){if(!b!=!m||b.length!=m.length){h=true
}else{for(var l=0;
l<b.length;
l++){if(b[l]!=m[l]){h=true
}}}}if(h&&d._chartPanel){d._chartPanel.clearChart();
d._chartPanel.createChart(f,k)
}else{d.adjustMultipleFactorSecondaryAxis(k.chartConfig,k.chartData,k);
d.updateTitleTimeAxis(f,k.chartData);
d.updateAxisLimits(f,k.chartData)
}if(d._chartPanel){d.updateLayout();
d._chartPanel.onReloadChart()
}}},onError:d._chartPanel&&d._chartPanel.onError?function(g){d._chartPanel.onError(g)
}:undefined,onFailure:d._chartPanel&&d._chartPanel.onFailure?function(g){d._chartPanel.onFailure(g)
}:undefined,chartConfig:f,chart:this,maskCmp:this._chartPanel&&this._chartPanel._disableMaskOnReload?undefined:this._chartPanel},c)
},timeShift:function(b){var c=cloneChartConfig(this.store.chartConfig);
if(!c.dateFrom){c.dateFrom=dateTime()
}if(!c.dateTo){c.dateTo=date(dateTime().getTime()/1000+24*3600)
}var a=(c.dateTo.getTime()-c.dateFrom.getTime())/1000/2*(b?1:-1);
c.dateFrom=new Date(c.dateFrom.getTime()+a*1000);
c.dateTo=new Date(c.dateTo.getTime()+a*1000);
this.reloadChart(c)
},serializeNode:function(c){var a="";
if(c.nodeType===document.TEXT_NODE){return(htmlEncode(c.nodeValue))
}a+="<"+c.nodeName;
if(c.attributes.length){for(var b=0;
b<c.attributes.length;
b++){a+=" "+c.attributes[b].name+'="'+c.attributes[b].value+'"'
}}if(c.childNodes&&c.childNodes.length){a+=">";
for(var b=0;
b<c.childNodes.length;
b++){a+=this.serializeNode(c.childNodes[b])
}a+="</"+c.nodeName+">"
}else{a+="/>"
}return a
},getSvg:function(){if(this.engine!=Ext.draw.engine.Svg){return(undefined)
}var g=this.innerElement.getSize(),b=Array.prototype.slice.call(this.items.items),k=this.surfaceZIndexes,f,d,a,h;
for(d=1;
d<b.length;
d++){if(Ext.getClassName(b[d])!="Ext.draw.engine.Svg"){continue
}a=b[d];
h=k[a.type];
f=d-1;
while(f>=0&&k[b[f].type]>h){b[f+1]=b[f];
f--
}b[f+1]=a
}var c='<?xml version="1.0" standalone="yes"?><svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg" width="'+g.width+'" height="'+g.height+'">';
for(f=0;
f<b.length;
f++){a=b[f];
rect=a.getRect();
c+='<g transform="translate('+rect[0]+","+rect[1]+')">';
c+=a.svgElement.dom.innerHTML||this.serializeNode(a.svgElement.dom);
c+="</g>"
}c+="</svg>";
return(c)
},saveChart:function(a){ajaxSafeRequest({url:"php/reports/charts.php",params:{task:"testSaveChart",params:Ext.encode({chartConfigData:this.store.chartConfig,svg:Ext.isDefined(a)&&a=="pdf_page"?undefined:this.getSvg(),saveType:Ext.isDefined(a)?(a=="pdf_page"?"pdf":a):this._saveType})},success:function(b){this.doSaveChart(a)
},scope:this,maskEl:this})
},doSaveChart:function(a){formPostSafe("php/reports/charts.php","POST",{task:"saveChart",params:Ext.encode({chartConfigData:this.store.chartConfig,svg:Ext.isDefined(a)&&a=="pdf_page"?undefined:this.getSvg(),saveType:Ext.isDefined(a)?(a=="pdf_page"?"pdf":a):this._saveType})})
},newTrackerTicket:function(b){if(!b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkFillCbTracker"},success:function(c){this.newTrackerTicket(c)
}});
return
}var a=this.getSvg();
Tracker.Utils.createNewTicketFormWindow(b,{chart:{svg:a}},this)
},updateTitleTimeAxis:function(c,b){var a=this.getTimeAxis();
if(a){a.setTitle(this.getTitleTimeAxis(c,b))
}},getTitleTimeAxis:function(c,b){if(c._disableLegendTimeAxis){return(null)
}c=c||this.store.chartConfig;
var g="";
if((c.dateFrom&&c.dateFrom.getTime)||(c.dateTo&&c.dateTo.getTime)){var f=c.dateFrom&&c.dateFrom.getTime?c.dateFrom:null;
var d=c.dateTo&&c.dateTo.getTime?c.dateTo:null;
var a=c&&c._titleTimeAxis_autoOffset&&b?b.timeOffsetClientToClientOs:0;
if(a){if(f){f=new Date(f.getTime()+a*60*1000)
}if(d){d=new Date(d.getTime()+a*60*1000)
}}g=(f&&d&&(f.getTime()==d.getTime()||(f.timeDefined&&d.timeDefined&&!time_sec(f)&&!time_sec(d)&&date(f).getTime()==date_prev(d).getTime())))?Ext.Date.format(f,!time_sec(f)?"Y-m-d":!(time_sec(f)%60)?"Y-m-d H:i":"Y-m-d H:i:s"):((f?"from "+Ext.Date.format(f,!time_sec(f)?"Y-m-d":!(time_sec(f)%60)?"Y-m-d H:i":"Y-m-d H:i:s"):"")+(f&&d?" ":"")+(d?"to "+Ext.Date.format(!time_sec(d)&&d.timeDefined?date_prev(d):d,!time_sec(d)?"Y-m-d":(date(f).getTime()==date(d).getTime()?(!(time_sec(d)%60)?"H:i":"H:i:s"):(!(time_sec(d)%60)?"Y-m-d H:i":"Y-m-d H:i:s"))):""))
}if(g){g+=" / "
}g+=arLang["LtimeAxis_"+(b.timeAxisForce?b.timeAxisForce:c.timeAxis)];
return(g)
},updateAxisLimits:function(k,h){for(var f=0;
f<2;
f++){var a=f==0?"left":"right";
var g=null;
for(var c=0;
c<this.axes.length;
c++){if(this.axes[c]._position==a){g=this.axes[c];
break
}}if(g){var b=Ext.Array.from(g.getLimits());
var d=this.getAxisLimits(k,h,f==0?"left":"right",g)||[];
while(d.length<b.length){d.push({})
}if(d.length){g.setLimits(d);
if(g.limits){g.renderLimits()
}this.updateLayout()
}}}},getAxisLimits:function(m,g,k,c){var a=null;
var f=m[k+"LimitLineValue"];
var o=m[k+"LimitLineColor"];
if(f&&o){if(!a){a=[]
}a.push({value:f,line:{strokeStyle:o,lineDash:[6,3],title:{text:f,fontSize:11}}})
}if(m[k+"PercTrend"]&&(m[k+"Perc95_Color"]||m[k+"Perc99_Color"])){for(var h=0;
h<2;
h++){var n=h==0?95:99;
var l=m[k+"PercTrend"];
var d=m[k+"Perc"+n+"_Color"];
if(d){var b=this.getPercSeries(n,l,g.axis,m.series[c._iPrimaryFirst],g.multiSeriesItems,true);
if(b){if(!a){a=[]
}a.push({value:b,line:{strokeStyle:d,lineDash:[2,2],title:{text:"perc "+n,fontSize:11}}})
}}}}return(a)
},needTimeLineIndicationUpdateLayout:function(){this._needTimeLineIndicationUpdateLayout_flag=3
},setTimeLineIndication:function(f){var c=this._chartPanel&&(this._chartPanel._enableTimeLineIndication||this._chartPanel.chartConfig&&this._chartPanel.chartConfig._enableTimeLineIndication)||this.store&&this.store.chartConfig&&this.store.chartConfig._enableTimeLineIndication;
var g=this._chartPanel&&(this._chartPanel._timeLineIndication_timeOffsetH||this._chartPanel.chartConfig&&this._chartPanel.chartConfig._timeLineIndication_timeOffsetH)||this.store&&this.store.chartConfig&&this.store.chartConfig._timeLineIndication_timeOffsetH;
var b=this.store&&this.store.chartConfig&&this.store.chartConfig._timeLineIndication_autoOffset&&this.store.chartData?this.store.chartData.timeOffsetClientToClientOs:0;
if(!c){return
}if(!Ext.isDefined(f)){var f=(this.store&&this.store._loadTime)||new Date;
if(g){f=new Date(f.getTime()+g*60*60*1000)
}else{if(b){f=new Date(f.getTime()+b*60*1000)
}}}var a=this.getIndexStoreForTime(f);
if(a<0){return
}var d=this.getTimeAxis();
if(d){d.setLimits({value:a,line:{strokeStyle:"red",lineDash:[6,3]}});
if(this._needTimeLineIndicationUpdateLayout_flag>0){this.updateLayout();
--this._needTimeLineIndicationUpdateLayout_flag
}}},getTimeAxis:function(){var b=null;
for(var a=0;
a<this.axes.length;
a++){if(this.axes[a]._position=="bottom"){b=this.axes[a]
}}return(b)
},getIndexStoreForTime:function(g){var c=-1;
if(this.store){var a=-1;
for(var b=0;
b<this.store.getCount();
b++){var d=this.store.getAt(b).data;
var f=Math.abs(g.getTime()-d.x);
if(c<0||f<a){a=f;
c=b
}}}return(c)
},redraw:function(){if(this._disableRedraw||this.store&&this.store._disableRedraw){return
}this.callParent();
this.setTimeLineIndication()
},adjustMultipleFactorSecondaryAxis:function(h,g,a){for(var c=0;
c<2;
c++){var k=null;
var d=1;
for(var b=0;
b<h.series.length;
b++){if(h.series[b].sideAxis==(c?"right":"left")&&h.series[b]._primary){k=Math.max(k,this.getMaxSeries(g.axis,h.series[b],g.multiSeriesItems));
this.applyMultipleFactorAxis(g.axis,h.series[b],g.multiSeriesItems,a);
if(h.series[b]._multipleFactorAxis){d=h.series[b]._multipleFactorAxis
}}}if(d&&d!=1){k*=d
}for(var b=0;
b<h.series.length;
b++){if(h.series[b].sideAxis==(c?"right":"left")&&!h.series[b]._primary){var f=this.getMaxSeries(g.axis,h.series[b],g.multiSeriesItems);
if(f){h.series[b]._multipleFactorAxis=k/f;
this.applyMultipleFactorAxis(g.axis,h.series[b],g.multiSeriesItems,a)
}}}}},getMaxSeries:function(b,f,c,k){var m=null;
for(var g=0;
g<b.length;
g++){var l=f.varName2;
if(f.multiSeries){if(c[l]){if(k){var h=0;
for(var d=0;
d<c[l].length;
d++){var a=l+"_"+d;
h+=b[g].data&&b[g].data[a]||0
}m=Math.max(m,h)
}else{for(var d=0;
d<c[l].length;
d++){var a=l+"_"+d;
m=Math.max(m,b[g].data&&b[g].data[a]||0)
}}}}else{m=Math.max(m,b[g].data&&b[g].data[l]||0)
}}return(m)
},getPercSeries:function(o,k,c,g,d,m){var p=[];
for(var h=0;
h<c.length;
h++){var n=g.varName2;
if(g.multiSeries){if(d[n]){if(m){var l=null;
for(var f=0;
f<d[n].length;
f++){var a=n+"_"+f;
if(c[h].data&&!Ext.isEmpty(c[h].data[a])){if(Ext.isEmpty(l)){l=0
}l+=c[h].data&&c[h].data[a]||0
}}if(!Ext.isEmpty(l)){p.push(l)
}}else{for(var f=0;
f<d[n].length;
f++){var a=n+"_"+f;
if(c[h].data&&!Ext.isEmpty(c[h].data[a])){p.push(c[h].data&&c[h].data[a]||0)
}}}}}else{if(c[h].data&&!Ext.isEmpty(c[h].data[n])){p.push(c[h].data&&c[h].data[n]||0)
}}}if(p.length){var b=0;
for(var h=p.length-1;
h>=0;
h--){if(!p[h]){++b
}else{break
}}if(b<p.length){if(b){p.splice(p.length-b,b)
}p.sort(function(s,r){return(s-r)
});
var q=Math.min(Math.round(p.length*o/100),p.length-1);
if(k=="desc"){q=p.length-1-q
}return(p[q])
}}return(null)
},applyMultipleFactorAxis:function(c,g,d,b){for(var h=0;
h<c.length;
h++){if(b.data.items[h]&&c[h].data){var k=g.varName2;
if(g.multiSeries){if(d[k]){for(var f=0;
f<d[k].length;
f++){var a=k+"_"+f;
var l=c[h].data[a]||0;
b.data.items[h].data["y_"+a]=l*(g._multipleFactorAxis||1)
}}}else{var l=c[h].data[k]||0;
b.data.items[h].data["y_"+k]=l*(g._multipleFactorAxis||1)
}}}},isGapLess:function(b,d){var k=0;
for(var f=0;
f<b.length;
f++){var g=true;
var h=d.varName2;
if(d.multiSeries){if(multiSeriesItems[h]){for(var c=0;
c<multiSeriesItems[h].length;
c++){var a=h+"_"+c;
var l=b[f].data&&b[f].data[a];
if(l){g=false
}}}}else{var l=b[f].data&&b[f].data[h];
if(l){g=false
}}if(g){++k
}else{k=0
}if(k>=2){return(false)
}}return(true)
},isEnableEvClick:function(b,d,c){if(!Ext.isArray(b._yField)){return(false)
}chartConfig=this.store.chartConfig;
if(chartConfig.disableClickHereForAnalyze){return(false)
}for(var a=0;
a<this.store.chartConfig.series.length;
a++){if(this.store.chartConfig.series[a].varName.match(/^sm_.*_intervals$/)){return(true)
}}},evClick:function(b,d,c){if(!Ext.isArray(b._yField)){return
}chartConfig=this.store.chartConfig;
if(chartConfig.disableClickHereForAnalyze){return
}for(var a=0;
a<this.store.chartConfig.series.length;
a++){if(this.store.chartConfig.series[a].varName.match(/^sm_.*_intervals$/)){this.evClick_interval(this.store.chartConfig.series[a].chartType,b,d,this.store.chartConfig.series[a]);
return
}}},evClick_interval:function(d,b,g,k){debug_log(d);
debug_log(b);
debug_log(k);
debug_log(g);
chartConfig=this.store.chartConfig;
var h=chartConfig.timeAxis;
var a=g.record.data.x;
var f=new Date(dateTime(g.record.data.x).getTime()+arCdrChart_timeAxisTypes[h].step*1000);
var c=chartConfig.filters;
debug_log(a);
debug_log(f);
debug_log(h);
ajaxSafeRequest({url:"php/reports/charts.php",params:{task:"intervalDetail",params:Ext.encode({type:d+(d.match(/_intervals$/)?"":"_intervals"),time_from:a,time_to:f,filter:c,multiSeriesIntervals:k.multiSeriesIntervals||null})},success:function(l){new CDR.Chart.IntervalDetail.Grid.Panel({type:d,timeFrom:a,timeTo:f,data:{ip:l.ip,types:l.types,aliases:l.aliases,colors:l.colors},chart:this,showWindow:true})
},error:function(l,m){var n=getStringAjaxError(l);
if(n=="empty interval"){Ext.Msg.alert(findLangS("charts","text","emptyIntervalMsgHeader"),findLangS("charts","text","emptyIntervalMsgText"))
}else{alertAjaxError(m)
}},scope:this,maskEl:this.ownerCt})
}});
Ext.define("CDR.Chart.Store",{extend:"Ext.data.ArrayStore",subsystem:"charts",constructor:function(b){b=b||{};
b.fields=["x"];
for(var d=0;
d<b.chartConfig.series.length;
d++){var c=b.chartConfig.series[d];
var f=c.varName2;
if(c.multiSeries){for(var a=0;
a<50;
a++){b.fields.push("y_"+f+"_"+a);
if(c.percent){b.fields.push("y_"+f+"_"+a+"_perc")
}}}else{b.fields.push("y_"+f)
}}b.data=[];
this.callParent([b]);
this.chartConfig=cloneChartConfig(b.chartConfig);
if(b.chartData){this.setStoreData(b.chartData)
}},loadChartData:function(a,b){var g=false;
var c=(new Date).getTime();
if(a.maskCmp&&a.maskCmp.getEl()&&a.maskCmp.getEl().mask){beginLoadMaskWithStopButton_ajax(a.maskCmp,"loadChartData_loadMask_"+a.maskCmp.id);
c=a.maskCmp._loadMask_timestampId;
g=true
}var f=a.chartConfig||this.chartConfig;
this._disableRedraw=true;
var d=ajaxSafeRequest({scope:this,url:a&&a.url||"php/reports/charts.php",params:{task:f._typeChart=="CDR"?"getCdrChart":f._typeChart=="MESSAGES"?"getMessagesChart":f._typeChart=="SIP_MSG"?"getSipMsgChart":null,params:Ext.encode(f)},success:function(k){if(k.axis){if(!f.timeAxis){f.timeAxis=k.timeAxis
}var l={axis:k.axis,timeAxisForce:k.timeAxisForce,multiSeriesItems:k.multiSeriesItems,multiSeriesColors:k.multiSeriesColors,timeOffsetClientToClientOs:k.timeOffsetClientToClientOs};
if(this.setStoreData(l,f,b)){this._loadTime=new Date;
if(!k.binaryCalc&&window.debug){Ext.Msg.alert(findLangS("charts","text","msgPhpCalcWarningMsgHeader"),findLangS("charts","text","msgPhpCalcWarningMsgText"));
window.warningChartPhpCalc=true
}this.chartData=l;
this.chartConfig=cloneChartConfig(f);
this.fields=["x"];
for(var h=0;
h<f.series.length;
h++){this.fields.push("y_"+f.series[h].varName2)
}}}else{if(this.validData){if(b){this.validData=false
}else{this.useOldData=true
}}}this.useCache=k.useCache;
this.existsCache=k.existsCache;
this._disableRedraw=false;
if(a.onLoad){a.onLoad.call(a.scope,this.validData?(this.useOldData?"olddata":true):false,this)
}if(b&&!this.validData){this.removeAll()
}if(g){endLoadMaskWithStopButton_ajax(a.maskCmp)
}},error:a.onError?function(h,k){this._disableRedraw=false;
a.onError.call(a.scope,getStringAjaxError(h),h,k)
}:undefined,failure:a.onFailure?function(h){this._disableRedraw=false;
a.onFailure.call(a.scope,getStringAjaxFailure(h),h)
}:undefined,errorFailure2:function(){if(g){endLoadMaskWithStopButton_ajax(a.maskCmp)
}this.removeAll()
},timeout:60*60*1000,timestampId:c});
if(g){startLoadMaskWithStopButton_ajax(a.maskCmp,d);
if(this.chartConfig&&this.chartConfig.startSecTimeMask){a.maskCmp._loadMask.secTime=this.chartConfig.startSecTimeMask
}}return(d)
},setStoreData:function(d,c,a){var b=this.validData;
this.validData=false;
this.useOldData=false;
this._setStoreData(d,c,a);
if(this.validData){return(true)
}else{if(!a&&b){this._setStoreData(this.chartData,c);
this.useOldData=true
}}return(false)
},_setStoreData:function(f,d,a){this.removeAll();
for(var c=0;
c<f.axis.length;
c++){var b=this.setStoreDataItem(f.axis[c],f.multiSeriesItems,d);
this.add(b);
if(b._valid){this.validData=true
}}if(!this.validData&&!a){this.removeAll()
}},setStoreDataItem:function(c,d,k){var h={x:dateTimeStringToDate(c.timeFromStr)};
for(var g=0;
g<k.series.length;
g++){var l=k.series[g].varName2;
if(k.series[g].multiSeries){if(d[l]){for(var f=0;
f<d[l].length;
f++){var b=l+"_"+f;
var m=c.data&&c.data[b];
h["y_"+b]=m||0;
if(k.series[g].percent){var a=l+"_"+f+"_perc";
var m=c.data&&c.data[a];
h["y_"+a]=m||0
}if(!h._valid&&m){h._valid=true
}}}}else{var m=c.data&&c.data[l];
h["y_"+l]=m||0;
if(!h._valid&&m){h._valid=true
}}}return(h)
}});
Ext.define("CDR.Chart.IntervalDetail.Grid.Panel",{extend:"Ext.Panel",constructor:function(v){Ext.applyIf(v,{sortByColumn:"sum"});
if(v.type&&v.type.match&&v.type.match(/_intervals$/)){v.type=v.type.substr(0,v.type.length-10)
}this.filterFields={TCH_mos:{src_lt:"fmos_min_lt",src_ge:"fmos_min_ge",dst_lt:"fmos_min_lt_called",dst_ge:"fmos_min_ge_called",both_lt:"fmos_min_lt",both_ge:"fmos_min_ge",src_select:"fmos_min_callerd_type",dst_select:"fmos_min_callerd_type",set_chart_field:"fmos_min_chart_field"},TCH_mos_xr_avg:{src_lt:"fmos_xr_avg_lt",src_ge:"fmos_xr_avg_ge",dst_lt:"fmos_xr_avg_lt_called",dst_ge:"fmos_xr_avg_ge_called",both_lt:"fmos_xr_avg_lt",both_ge:"fmos_xr_avg_ge",src_select:"fmos_xr_avg_callerd_type",dst_select:"fmos_xr_avg_callerd_type"},TCH_mos_xr_min:{src_lt:"fmos_xr_min_lt",src_ge:"fmos_xr_min_ge",dst_lt:"fmos_xr_min_lt_called",dst_ge:"fmos_xr_min_ge_called",both_lt:"fmos_xr_min_lt",both_ge:"fmos_xr_min_ge",src_select:"fmos_xr_min_callerd_type",dst_select:"fmos_xr_min_callerd_type"},TCH_mos_silence_avg:{src_lt:"fmos_silence_avg_lt",src_ge:"fmos_silence_avg_ge",dst_lt:"fmos_silence_avg_lt_called",dst_ge:"fmos_silence_avg_ge_called",both_lt:"fmos_silence_avg_lt",both_ge:"fmos_silence_avg_ge",src_select:"fmos_silence_avg_callerd_type",dst_select:"fmos_silence_avg_callerd_type"},TCH_mos_silence_min:{src_lt:"fmos_silence_min_lt",src_ge:"fmos_silence_min_ge",dst_lt:"fmos_silence_min_lt_called",dst_ge:"fmos_silence_min_ge_called",both_lt:"fmos_silence_min_lt",both_ge:"fmos_silence_min_ge",src_select:"fmos_silence_min_callerd_type",dst_select:"fmos_silence_min_callerd_type"},TCH_packet_lost:{src_lt:"fpacket_loss_perc_lt",src_ge:"fpacket_loss_perc_ge",dst_lt:"fpacket_loss_perc_lt_called",dst_ge:"fpacket_loss_perc_ge_called",both_lt:"fpacket_loss_perc_lt",both_ge:"fpacket_loss_perc_ge",src_select:"fpacket_loss_perc_callerd_type",dst_select:"fpacket_loss_perc_callerd_type"}};
var w=this;
var k=[{name:"ip",type:"string"}];
for(var b=0;
b<3;
b++){var t=b==0?"":(b==1?"src_":"dst_");
for(var s=0;
s<v.data.aliases.length;
s++){k.push({name:t+v.data.aliases[s],type:"number"})
}k.push({name:t+"sum",type:"number"})
}var p=[];
for(var s=0;
s<v.data.ip.length;
s++){var l={ip:v.data.ip[s].ip};
var q=false;
for(var r=0;
r<p.length;
r++){if(p[r].ip==l.ip){l=p[r];
q=true
}}var g=v.data.types.indexOf(v.data.ip[s].value);
if(g>=0){var f=(v.data.ip[s].src_dst=="src"?"src_":"dst_")+v.data.aliases[g];
l[f]=(l[f]||0)+v.data.ip[s].cnt*1
}if(!q){p.push(l)
}}var o=0;
for(var s=0;
s<p.length;
s++){var d=[0,0,0];
for(var r=0;
r<v.data.aliases.length;
r++){p[s][v.data.aliases[r]]=(p[s]["src_"+v.data.aliases[r]]||0)+(p[s]["dst_"+v.data.aliases[r]]||0);
d[0]+=(p[s]["src_"+v.data.aliases[r]]||0)+(p[s]["dst_"+v.data.aliases[r]]||0);
d[1]+=p[s]["src_"+v.data.aliases[r]]||0;
d[2]+=p[s]["dst_"+v.data.aliases[r]]||0
}p[s].sum=d[0];
p[s].src_sum=d[1];
p[s].dst_sum=d[2];
if(d[1]>o){o=d[1]
}if(d[2]>o){o=d[2]
}}var h=new Ext.data.JsonStore({fields:k,data:p,_max_sum:o});
h.sort([{property:v.sortByColumn,direction:"DESC"},{property:"ip",direction:"ASC"}]);
var m=230;
var n=this.getGridColumns(v.sortByColumn,v.data,m);
var a=new Ext.grid.Panel({store:h,columns:{defaults:{sortable:false},items:n},viewConfig:{_panel:this,listeners:{scope:this,render:function(y){y.tip=Ext.create("Ext.tip.ToolTip",{target:y.el,delegate:y.cellSelector,trackMouse:true,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,listeners:{beforeshow:function z(D){var B=y.getRecord(Ext.fly(D.triggerElement).up(".x-grid-row"));
var C=y.getHeaderByCell(D.triggerElement);
if(B&&C&&(C.dataIndex=="src"||C.dataIndex=="dst")){var A=w.createTipText(B.data,C.dataIndex);
if(A){D.update(A);
return
}}D.update(null)
}}})
}}},border:false,style:__style_SubgridBorder()});
var c=[];
c.push({xtype:"displayfield",value:"sort by:",fieldCls:"x-form-item-label",fieldStyle:{paddingTop:0,marginBottom:2}},{text:'<b style="font-size: 110%;">âˆ‘</b> SUM',enableToggle:true,toggleHandler:u,_field:"sum",pressed:v.sortByColumn=="sum"});
for(var s=0;
s<v.data.types.length;
s++){c.push({text:'<div style="float: left; width: 12; height: 12; background-color: '+v.data.colors[v.data.types[s]]+'; margin-right: 5; margin-top: 1;"></div>'+v.data.types[s],enableToggle:true,toggleHandler:u,_field:v.data.aliases[s],pressed:v.sortByColumn==v.data.aliases[s]})
}Ext.applyIf(v,{layout:"fit",items:a,tbar:c,border:false});
this.callParent([v]);
if(v.showWindow){this.window=this.createWindow();
this.window.show()
}function u(z){if(w._disableToggleSortBy){return
}var B=w.getTopToolbar();
if(z._field!="sum"){var A=B.findC("_field","sum");
if(A){w._disableToggleSortBy=true;
A.toggle(false);
delete w._disableToggleSortBy
}}for(var y=0;
y<v.data.aliases.length;
y++){if(z._field!=v.data.aliases[y]){var A=B.findC("_field",v.data.aliases[y]);
if(A){w._disableToggleSortBy=true;
A.toggle(false);
delete w._disableToggleSortBy
}}}if(!z.pressed){w._disableToggleSortBy=true;
z.toggle(true);
delete w._disableToggleSortBy
}w.sortByColumn=z._field;
h.sort({property:w.sortByColumn,direction:"DESC"},{property:"ip",direction:"ASC"});
a.reconfigure(h,w.getGridColumns(w.sortByColumn,w.data,m))
}},getGridColumns:function(a,g,f){var d=this;
var c=[{xtype:"actioncolumn",rendererBase:renderString,dataIndex:"ip",text:"IP",flex:1,items:[{getClass:function(h,k,l){return("icon_menu_cdr")
},handler:function(k,p,h,l,m){var o=k.store.getAt(p);
var n=this.createContextMenu(o.data);
n.showAtMouse(m)
},tooltip:"select CDR records",scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"},{dataIndex:a,text:"# "+(a=="sum"?"âˆ‘":g.types[g.aliases.indexOf(a)]),width:__width_ColumnChar(17),align:"right"},{dataIndex:"dst",text:"IN",renderer:function(o,h,l,p,n,m,k){return(k._panel.renderValueBar(l.data,2,f-10,m))
},width:f},{dataIndex:"src",text:"OUT",renderer:function(o,h,l,p,n,m,k){return(k._panel.renderValueBar(l.data,1,f-10,m))
},width:f}];
for(var b=0;
b<c.length;
b++){if(!c[b].text){c[b].text=gridColumns[b].dataIndex
}}return(c)
},renderValueBar:function(c,g,a,k){if(Ext.isNumber(g)){g=g==0?"":(g==1?"src_":"dst_")
}if(g[g.length-1]!="_"){g+="_"
}var f=c[g+"sum"];
var l="<table><tr>";
for(var d=0;
d<this.config.data.aliases.length;
d++){var h=g+this.config.data.aliases[d];
if(c[h]){var b=a*c[h]/k._max_sum;
if(b){l+='<td bgcolor="'+this.config.data.colors[this.config.data.types[d]]+'" style="height: 10px; width: '+b+'px;">'
}}}l+="</table>";
return(l)
},createTipText:function(h,f){if(Ext.isNumber(f)){f=f==0?"":(f==1?"src_":"dst_")
}if(f[f.length-1]!="_"){f+="_"
}var a="";
for(var d=0;
d<this.config.data.aliases.length;
d++){var c=f+this.config.data.aliases[d];
if(h[c]){if(!a){a+='<table style="font-size: 11;"><tr><td colspan="2" style="padding-bottom: 4px; width: 1px; white-space:nowrap;"><b>IP: '+h.ip+" / "+(f=="src_"?"OUT":"IN")+"</b>"
}var b=this.config.data.colors[this.config.data.types[d]]||"black";
a+="<tr>";
a+='<td style="color: '+b+'; width: 1px; white-space:nowrap;">';
a+="<b><i>"+this.config.data.types[d]+"</i></b>",a+='<td style="padding-left: 10px; width: 1px; white-space:nowrap;">';
var g=h[c];
a+="<b>"+g+"</b>"
}}if(a&&a.length){a+="</table>";
return(a)
}return(null)
},createContextMenu:function(u){var h=[];
for(var s=0;
s<this.config.data.types.length;
s++){var k=null;
var t=null;
var d=this.config.data.types[s].match(/>= ([\d\.]+)/);
if(d&&d.length==2){k=d[1]*1
}var n=this.config.data.types[s].match(/< ([\d\.]+)/);
if(n&&n.length==2){t=n[1]*1
}h.push({valueTo:t?t:undefined,valueToText:"< "+t,valueFrom:k?k:undefined,valueFromText:">= "+k})
}var m=[];
var o=[];
var c=[];
for(var s=0;
s<3;
s++){var p=[];
var f=s==0?"src_":(s==1?"dst_":"");
var l=s==0?"src":(s==1?"dst":"both");
for(var r=0;
r<this.config.data.aliases.length;
r++){if(u[f+this.config.data.aliases[r]]){var g={_valueSrcDst:l,_ip:u.ip,handler:q,scope:this};
if(h[r].valueFrom){g.text=h[r].valueFromText;
g._valueFilterFrom=h[r].valueFrom
}if(h[r].valueTo){if(g.text){g.text+=" AND "
}else{g.text=""
}g.text+=h[r].valueToText;
g._valueFilterTo=h[r].valueTo
}p.push(g)
}}switch(s){case 0:m=p;
break;
case 1:o=p;
break;
case 2:c=p;
break
}}var b=[];
if(this.filterFields[this.type]){b.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 4;">select CDR records</div>');
if(m.length){b.push({text:"IP "+u.ip+" / OUT",menu:m})
}if(o.length){b.push({text:"IP "+u.ip+" / IN",menu:o})
}if(m.length&&o.length&&c.length){b.push({text:"IP "+u.ip+" / IN or OUT",menu:c})
}}b.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 4;">add filter to chart</div>');
if(m.length){b.push({text:"IP "+u.ip+" / OUT",_valueSrcDst:"src",_ip:u.ip,handler:a,scope:this})
}if(o.length){b.push({text:"IP "+u.ip+" / IN",_valueSrcDst:"dst",_ip:u.ip,handler:a,scope:this})
}if(m.length&&o.length&&c.length){b.push({text:"IP "+u.ip+" / IN or OUT",_valueSrcDst:"both",_ip:u.ip,handler:a,scope:this})
}return(new Ext.menu.Menu({items:b}));
function q(w){var v={fdatefrom:this.timeFrom,fdateto:this.timeTo};
var B=[];
B.push("from: "+trimTimeFormatString(this.timeFrom,this.timeTo));
B.push("to: "+trimTimeFormatString(this.timeTo,this.timeFrom));
if(w._ip){var A=w._ip;
switch(w._valueSrcDst){case"src":v.fsipcallerip=A;
v.fsipcallerdip_type=1;
break;
case"dst":v.fsipcalledip=A;
v.fsipcallerdip_type=1;
break;
default:v.fsipcallerip=A;
break
}B.push("IP: "+A);
switch(w._valueSrcDst){case"src":B.push("OUT");
break;
case"dst":B.push("IN");
break
}}if(w._valueFilterTo||w._valueFilterFrom){if(w._valueFilterTo){switch(w._valueSrcDst){case"src":v[this.filterFields[this.type].src_lt]=w._valueFilterTo;
break;
case"dst":v[this.filterFields[this.type].dst_lt]=w._valueFilterTo;
break;
default:v[this.filterFields[this.type].both_lt]=w._valueFilterTo;
break
}}if(w._valueFilterFrom){switch(w._valueSrcDst){case"src":v[this.filterFields[this.type].src_ge]=w._valueFilterFrom;
break;
case"dst":v[this.filterFields[this.type].dst_ge]=w._valueFilterFrom;
break;
default:v[this.filterFields[this.type].both_ge]=w._valueFilterFrom;
break
}}switch(w._valueSrcDst){case"src":if(this.filterFields[this.type].src_select){v[this.filterFields[this.type].src_select]=1
}break;
case"dst":if(this.filterFields[this.type].dst_select){v[this.filterFields[this.type].dst_select]=1
}break;
default:if(this.filterFields[this.type].both_select){v[this.filterFields[this.type].both_select]=1
}break
}if(this.filterFields[this.type].set_chart_field){v[this.filterFields[this.type].set_chart_field]=true
}B.push(w.text)
}var z=new CDR.Grid({extraParams:v,disableCharts:true,disableMenu:true,disablePagingToolbar:true,enableTbarRibbonDateFromTo:true,enableTbarRibbonFilterButton:true,enableTbarRibbonPaginator:true,loadAtInit:true,border:false});
var y=new Ext.Window({layout:"fit",items:z,title:"CDR "+B.join(", "),width:Math.round(Ext.dom.Element.getViewportWidth()*7/8),height:Math.round(Ext.dom.Element.getViewportHeight()*7/8),modal:true,closable:true,maximizable:true});
y.show()
}function a(w){var z=cloneObject(this.chart.store.chartConfig);
var B="value analysis";
if(w._ip){if(!z.filters){z.filters={}
}var A=w._ip;
switch(w._valueSrcDst){case"src":z.filters.fsipcallerip=A;
z.filters.fsipcallerdip_type=1;
break;
case"dst":z.filters.fsipcalledip=A;
z.filters.fsipcallerdip_type=1;
break;
default:z.filters.fsipcallerip=A;
break
}B+=" - IP: "+A;
switch(w._valueSrcDst){case"src":B+=" / OUT";
break;
case"dst":B+=" / IN";
break
}}z.disableClickHereForAnalyze=true;
var v=new CDR.Chart.ChartPanel();
var y=this.createWindow(v,B,{maximizable:true});
y.show();
v.loadChart(z)
}},createWindow:function(b,d,c){var a=new Ext.Window(Ext.applyIf(c||{},{layout:"fit",items:b||this,width:800,height:600,title:d||("value analysis (top IP) - ["+trimTimeFormatString(this.timeFrom,this.timeTo)+" - "+trimTimeFormatString(this.timeTo,this.timeFrom)+"]"),modal:true,border:false}));
return(a)
}});
Ext.define("CDR.Chart.ConfigForm",{extend:"Ext.form.Panel",subsystem:"charts",constructor:function(H){H=H||{};
if(!H._typeChart&&H.chartConfig){H._typeChart=H.chartConfig._typeChart||"CDR"
}if(!H._typeChart){H._typeChart="CDR"
}if(H.chartConfig&&H.chartConfig.filtersFromParent){H.filtersFromParent=H.chartConfig.filtersFromParent
}var G=12;
var E=__width_FieldChar(G);
this.disableClearChartType=0;
this.disableLoadTypeTimeAxises=0;
this.fixTypeTimeAxis=null;
this.initMinSeries=6;
this.cfgFieldsBase=["chartType"];
if(!H.cdrChartConfig){this.cfgFieldsBase.push("timeAxis")
}if(H.dailyReportConfig){this.cfgFieldsBase.push("typeTimeInterval","intervalOffset")
}else{if(!H.cdrChartConfig&&!H.filtersFromParent){this.cfgFieldsBase.push("typeTimeInterval","intervalOffset","dateFrom","dateTo")
}}this.cfgFieldsAppearance=[];
if(!H.disableChartTitle){this.cfgFieldsAppearance.push("title")
}this.cfgFieldsAppearance.push("axisTitleLeft","axisTitleRight","leftAxisMinWidth","rightAxisMinWidth","legendPosition","combinationToArea","maximumAreaItems","leftLimitLineValue","leftLimitLineColor","leftPercTrend","leftPerc95_Color","leftPerc99_Color","rightLimitLineValue","rightLimitLineColor","rightPercTrend","rightPerc95_Color","rightPerc99_Color");
this.seriesFields=["series_a","series_b","param","sideAxis","primaryAxis","baseType","lineType","color","trend","fill","markers","smooth","percent"];
this.seriesFieldsDefault=[null,null,"left",false,"line","solid",null,false,false];
if(!H.chartConfig&&!H.chartDefault){return
}var P=H.chartConfig?H.chartConfig.chartType:H.chartDefault.chartType;
var y=cloneObject(H._typeChart=="CDR"?arCdrChart_chartTypes:H._typeChart=="MESSAGES"?arMessagesChart_chartTypes:H._typeChart=="SIP_MSG"?arSipMsgChart_chartTypes:null);
for(var Q=0;
Q<y.length;
Q++){y[Q][2]=y[Q][1]
}var c={xtype:"ComboBoxA",name:"chartType",fieldLabel:this.findLangS("field","templates"),_tpl:"{descrMenu}",width:__width_Form(E,180)+6,labelWidth:E+19,listConfig:{minWidth:250},aData:{data:y,fields:["id","descr","descrMenu","customId","chartConfig"]},value:P,_initValue:P,listeners:{scope:this,select:S}};
var l=null;
if(!H.cdrChartConfig){var m=H.chartConfig?H.chartConfig.timeAxis:H.chartDefault.timeAxis;
l={xtype:"ComboBoxA",name:"timeAxis",fieldLabel:this.findLangS("field","timeAxis"),width:__width_Form(E,180),aData:{data:[],fields:["id","descr","count"]},tpl:H.dailyReportConfig?undefined:'<tpl for="."><tpl if="[xindex]==1"><table class="comboBox-menuList" style="table-layout: fixed; text-align: left; width: 177;"><col width=137><col width=40></tpl><tr class="x-boundlist-item"><td style="font-size: 12;">{descr}</td><td style="font-size: 11; text-align: right; color: grey">{count}</td></tr><tpl if="[xcount-xindex]==0"></table></tpl></tpl>',listConfig:{minWidth:185},value:m,_initValue:m,allowBlank:false};
if(H.dashboardConfig){Ext.apply(l,{labelWidth:E+19,width:__width_Form(E,180)+6,emptyText:this.findLangS("text","autoSet"),allowBlank:true,_clearButton:true,style:{marginTop:__height_FieldSeparator}})
}}if(!H.cdrChartConfig&&!H.dashboardConfig){if(!H.disableSaveDeleteChartButtons){this.btnSaveChartConfig=new Ext.Button({text:this.findLangS("button","saveTemplate"),handler:this.saveChartConfig,scope:this,style:{marginLeft:4}});
this.btnDeleteChartConfig=new Ext.Button({text:this.findLangS("button","deleteTemplate"),handler:this.deleteChartConfig,scope:this,style:{marginLeft:4}})
}var N=H.dailyReportConfig?(H.dailyReportConfigData&&H.dailyReportConfigData.at_or_every=="every"?"last_hour":"yesterday"):H.chartConfig?H.chartConfig.typeTimeInterval:H.chartDefault.typeTimeInterval;
var M=null;
var b=null;
var w=H.chartConfig&&H.chartConfig.intervalOffset||0;
var D=!H.dailyReportConfig;
if(N){var z=getTimeInterval(N,{prevInterval:H.prevInterval,prevIntervalHourTolerance:H.prevIntervalHourTolerance,actTime:null,forChart:true,intervalOffset:w});
M=z[0];
b=z[1];
if(N=="today"||N=="yesterday"){var u=H.chartConfig?H.chartConfig.dateFrom:H.chartDefault.dateFrom;
var t=H.chartConfig?H.chartConfig.dateTo:H.chartDefault.dateTo;
if(u&&time_sec(u)){M=completeDateTime(z[0],u)
}if(t&&time_sec(t)){b=completeDateTime(z[1]?z[1]:z[0],t)
}}}else{M=H.chartConfig?H.chartConfig.dateFrom:H.chartDefault.dateFrom;
b=H.chartConfig?H.chartConfig.dateTo:H.chartDefault.dateTo
}var d=[];
if(!H.filtersFromParent){d.push({xtype:"ComboBoxA",name:"typeTimeInterval",fieldLabel:this.findLangS("field","timeInterval"),value:N,aData:arTimeIntervals,asFilter:H.dailyReportConfig?(H.dailyReportConfigData&&H.dailyReportConfigData.at_or_every=="every"?["last_hour","last_2h","last_3h","last_8h","last_24h"]:["today","yesterday","this_week_m","this_week_s","this_month","prev_month","last_30d","last_60d","last_90d"]):undefined,_clearButton:!H.dailyReportConfig,width:__width_Form(E,180),listeners:{scope:this,select:v},allowBlank:!H.dailyReportConfig})
}d.push(l);
var K=[{xtype:"container",layout:"hbox",items:[{xtype:"container",items:d}]}];
if(!H.filtersFromParent){var I={xtype:"datetimefield",name:"dateTo",fieldLabel:this.findLangS("field","to"),value:b,disabled:N,inEditor:true,zeroTimeEmpty:true,labelWidth:__width_FieldChar(6),width:__width_Form(__width_FieldDateTimeM,__width_FieldChar(6)),listeners:{scope:this,select:h,change:h}};
if(D){I={xtype:"container",layout:"hbox",items:[I,{xtype:"displayfield_h16",value:this.findLangS("field","intervalOffset")+":",style:{marginLeft:20,marginRight:__width_FieldSeparator},helpText:this.findLangS("tooltip","intervalOffsetHelp")},{xtype:"numberfield",name:"intervalOffset",minValue:0,hideLabel:true,value:w,width:__width_FieldNum(3)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{scope:this,change:v}},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",style:{marginLeft:__width_FieldSeparator}}]}
}K[0].items.push({width:20,border:false},{xtype:"container",items:[{xtype:"datetimefield",name:"dateFrom",fieldLabel:this.findLangS("field","from"),value:M,disabled:N,inEditor:true,zeroTimeEmpty:true,labelWidth:__width_FieldChar(6),listeners:{scope:this,select:h,change:h}},I]})
}}else{K=null
}var s=[];
var J=[{header:"series",name:"series_a",width:160,widthHeader:215+__width_FieldSeparator,colspan:2},{header:null,name:"series_b",width:55},{header:"param",name:"param",width:__width_FieldChar(6)},{header:"sideAxis",name:"sideAxis",width:__width_FieldChar(5)+__width_Trigger-2},{header:"baseType",name:"baseType",width:__width_FieldChar(6)+__width_Trigger+2},{header:"lineType",name:"lineType",width:__width_FieldChar(6)+__width_Trigger+1},{header:"color",name:"color",width:15+__width_Trigger*2-4,style:{marginRight:8}},{header:"primaryAxis",v:true,name:"primaryAxis",width:16,tdAttrs:{align:"center"}},{header:"trend",v:true,name:"trend",width:16,tdAttrs:{align:"center"}},{header:"fill",v:true,name:"fill",width:16,tdAttrs:{align:"center"}},{header:"markers",v:true,name:"markers",width:16,tdAttrs:{align:"center"}},{header:"smooth",v:true,name:"smooth",width:16,tdAttrs:{align:"center"}},{header:"percent",v:true,name:"percent",width:16,tdAttrs:{align:"center"}},{header:"filters",v:true,name:"filter",width:18,style:{marginLeft:2,marginRight:0},tdAttrs:{align:"center"}},{header:"tools",v:true,name:"tools",width:18,style:{marginLeft:2,marginRight:0},tdAttrs:{align:"center"}}];
for(var Q=0;
Q<J.length;
Q++){if(!J[Q].header){continue
}J[Q].header=this.findLangS("column",J[Q].header);
if(J[Q].v){J[Q].header='<svg width="16" height="40"><text x="0" y="0" fill="black" text-anchor="left" transform="rotate(-90 0,0) translate(-38,9)" font-family="tahoma, arial, verdana, sans-serif" font-size=11>'+J[Q].header+"</text></svg>"
}}var O=[];
for(var Q=0;
Q<J.length;
Q++){if(!J[Q].header){continue
}O.push({xtype:"displayfield",value:J[Q].header,colspan:J[Q].colspan,width:J[Q].widthHeader||J[Q].width,tdAttrs:{align:"center",valign:"bottom"},style:J[Q].style||{marginRight:__width_FieldSeparator}})
}this.seriesHeader=new Ext.Container({layout:{type:"table",columns:J.length,tableAttrs:{border:0}},items:O});
this._headerSeries=J;
this._onChangePrimary=p;
this.seriesRows=[];
for(var Q=0;
Q<this.initMinSeries;
Q++){this.seriesRows.push(this.createSeriesRow(Q,H))
}var C=[];
var a=null;
if(H.chartDefault&&H.chartDefault.chartType&&arCdrChart_defChartTypes[H.chartDefault.chartType]){a=arCdrChart_defChartTypes[H.chartDefault.chartType][H._typeChart]||arCdrChart_defChartTypes[H.chartDefault.chartType]
}if(!H.disableChartTitle){C.push({xtype:"textfield",name:"title",fieldLabel:this.findLangS("field","title"),width:__width_Form(E,300),value:H.chartConfig?H.chartConfig.title:a?a.title:null})
}C.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"axisTitleLeft",fieldLabel:this.findLangS("field","axisTitleLeft"),width:__width_Form(E,300),value:H.chartConfig?H.chartConfig.axisTitleLeft:a?a.axisTitleLeft:null},{xtype:"numberfield",name:"leftAxisMinWidth",fieldLabel:this.findLangS("field","minAxisWidth"),labelWidth:__width_FieldChar(15),width:__width_FormChar(15,6),value:H.chartConfig?H.chartConfig.leftAxisMinWidth:null,minValue:0,maxValue:100,step:5,style:{marginLeft:__width_FieldSeparator*2}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"leftLimitLineValue",fieldLabel:this.findLangS("field","limitLineValue"),width:__width_Form(E,__width_FieldChar(11)),value:H.chartConfig?H.chartConfig.leftLimitLineValue:null,style:{marginLeft:E+20},enableKeyEvents:true,listeners:{scope:this,keyup:this.setContextSeriesFields,change:this.setContextSeriesFields}},{xtype:"colorpickerfield",name:"leftLimitLineColor",fieldLabel:this.findLangS("field","limitLineColor"),labelWidth:__width_FieldChar(6),width:__width_FormChar(6,8)+__width_Trigger,value:H.chartConfig&&H.chartConfig.leftLimitLineColor||"#E92424",style:{marginLeft:__width_FieldSeparator*2}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"ComboBoxA",name:"leftPercTrend",fieldLabel:this.findLangS("field","percTrend"),aData:[["asc",this.findLangS("combodata","asc")],["desc",this.findLangS("combodata","desc")]],width:__width_Form(E,__width_FieldChar(11)),value:H.chartConfig?H.chartConfig.leftPercTrend:null,_clearButton:true,style:{marginLeft:E+20},listeners:{scope:this,select:this.setContextSeriesFields}},{xtype:"colorpickerfield",name:"leftPerc95_Color",fieldLabel:this.findLangS("field","perc95_Color"),labelWidth:__width_FieldChar(6),width:__width_FormChar(6,8)+__width_Trigger,value:H.chartConfig&&H.chartConfig.leftPerc95_Color,style:{marginLeft:__width_FieldSeparator*2}},{xtype:"colorpickerfield",name:"leftPerc99_Color",fieldLabel:this.findLangS("field","perc99_Color"),labelWidth:__width_FieldChar(6),width:__width_FormChar(6,8)+__width_Trigger,value:H.chartConfig&&H.chartConfig.leftPerc99_Color,style:{marginLeft:__width_FieldSeparator*2}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"axisTitleRight",fieldLabel:this.findLangS("field","axisTitleRight"),width:__width_Form(E,300),value:H.chartConfig?H.chartConfig.axisTitleRight:a?a.axisTitleRight:null},{xtype:"numberfield",name:"rightAxisMinWidth",fieldLabel:this.findLangS("field","minAxisWidth"),labelWidth:__width_FieldChar(15),width:__width_FormChar(15,6),value:H.chartConfig?H.chartConfig.rightAxisMinWidth:null,minValue:0,maxValue:100,step:5,style:{marginLeft:__width_FieldSeparator*2}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"rightLimitLineValue",fieldLabel:this.findLangS("field","limitLineValue"),width:__width_Form(E,__width_FieldChar(11)),value:H.chartConfig?H.chartConfig.rightLimitLineValue:null,style:{marginLeft:E+20},enableKeyEvents:true,listeners:{scope:this,keyup:this.setContextSeriesFields,change:this.setContextSeriesFields}},{xtype:"colorpickerfield",name:"rightLimitLineColor",fieldLabel:this.findLangS("field","limitLineColor"),labelWidth:__width_FieldChar(6),width:__width_FormChar(6,8)+__width_Trigger,value:H.chartConfig&&H.chartConfig.rightLimitLineColor||"#E92424",style:{marginLeft:__width_FieldSeparator*2}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"ComboBoxA",name:"rightPercTrend",fieldLabel:this.findLangS("field","percTrend"),aData:[["asc",this.findLangS("combodata","asc")],["desc",this.findLangS("combodata","desc")]],_clearButton:true,width:__width_Form(E,__width_FieldChar(11)),value:H.chartConfig?H.chartConfig.rightPercTrend:null,style:{marginLeft:E+20},listeners:{scope:this,select:this.setContextSeriesFields}},{xtype:"colorpickerfield",name:"rightPerc95_Color",fieldLabel:this.findLangS("field","perc95_Color"),labelWidth:__width_FieldChar(6),width:__width_FormChar(6,8)+__width_Trigger,value:H.chartConfig&&H.chartConfig.rightPerc95_Color,style:{marginLeft:__width_FieldSeparator*2}},{xtype:"colorpickerfield",name:"rightPerc99_Color",fieldLabel:this.findLangS("field","perc99_Color"),labelWidth:__width_FieldChar(6),width:__width_FormChar(6,8)+__width_Trigger,value:H.chartConfig&&H.chartConfig.rightPerc99_Color,style:{marginLeft:__width_FieldSeparator*2}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"ComboBoxA",name:"legendPosition",fieldLabel:this.findLangS("field","legendPosition"),width:__width_Form(E,300),value:H.chartConfig?H.chartConfig.legendPosition:a?a.legendPosition:"top",aData:arCdrChart_legendPosition});
var r=[{xtype:"container",layout:"hbox",items:[c,this.btnSaveChartConfig||{border:false},this.btnDeleteChartConfig||{border:false}]}];
if(H.dashboardConfig&&l){r.push(l)
}var T=CDR.Filter.getWidthForm()-8;
if(K){r.push({xtype:"fieldset",title:this.findLangS("fieldset","dateRange"),items:K,width:T,style:__style_RedukFieldSet()})
}this.seriesRowsContainer=new Ext.Container({layout:"vbox",items:this.seriesRows});
r.push({xtype:"fieldset",title:this.findLangS("fieldset","series"),layout:"vbox",items:[this.seriesHeader,this.seriesRowsContainer,{layout:{type:"table",columns:J.length,tableAttrs:{border:0}},defaults:{style:{marginRight:__width_FieldSeparator}},items:s,border:false,bodyStyle:{"background-color":__color_FormBackground}},{xtype:"checkbox",name:"combinationToArea",checked:H.chartConfig&&H.chartConfig.combinationToArea,boxLabel:this.findLangS("field","combinationToArea"),listeners:{scope:this,change:function(){this.clearChartType();
this.setContextSeriesFields()
}}},{xtype:"numberfield",name:"maximumAreaItems",value:H.chartConfig&&H.chartConfig.maximumAreaItems,minValue:1,maxValue:20,fieldLabel:this.findLangS("field","maximumAreaItems"),width:__width_FormChar(17,5),labelWidth:__width_FieldChar(17)}],width:T,style:__style_RedukFieldSet()},{xtype:"fieldset",title:this.findLangS("fieldset","description"),items:C,width:T,style:__style_RedukFieldSet()});
U(r,this);
var A=[{xtype:"container",fieldDefaults:{labelWidth:E},items:r,title:this.findLangS("title","baseChartData")}];
if(!H.filtersFromParent&&!H.disableFilters&&!H.disableFilterCommon){if(H._typeChart=="CDR"){var F=CDR.Filter.getFieldset("common",{values:H.chartConfig&&H.chartConfig.filters||{},disableTimeInterval:true,disableSelections:true});
var q=CDR.Filter.getFieldset_template({disableTimeInterval:true,disableSelections:true});
F.splice(0,0,{xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:0,marginBottom:5}}});
F.splice(0,0,q);
A.push({xtype:"container",items:F,title:this.findLangS("title","filtersCommon")})
}else{if(H._typeChart=="MESSAGES"){var R=Message.Filter.getFieldset({values:H.chartConfig&&H.chartConfig.filters||{},disableTimeInterval:true});
A.push({xtype:"container",items:R,title:this.findLangS("title","filters")})
}else{if(H._typeChart=="SIP_MSG"){var R=SipMsg.Filter.getFieldset({modelType:"stored",values:H.chartConfig&&H.chartConfig.filters||{},disableTimeInterval:true});
A.push({xtype:"container",items:R,title:this.findLangS("title","filters")})
}}}}if(H._typeChart=="CDR"&&!H.filtersFromParent&&!H.disableFilters&&!H.disableFilterRTP){var n=CDR.Filter.getFieldset("rtp",{values:H.chartConfig&&H.chartConfig.filters||{}});
A.push({xtype:"container",items:n,title:this.findLangS("title","filtersRtp")});
if(window.existsDscpCdr){var g=CDR.Filter.getFieldset("dscp",{values:H.chartConfig&&H.chartConfig.filters||{}});
A.push({xtype:"container",items:g,title:this.findLangS("title","filtersDscp")})
}var L=CDR.Filter.getFieldset("filters_comb",{values:H.chartConfig&&H.chartConfig.filters||{}});
A.push({xtype:"container",items:L,title:this.findLangS("title","filtersComb")})
}var f=CDR.Filter.getWidthForm();
var o={xtype:"tabpanel",items:[],border:false};
for(var Q=0;
Q<A.length;
Q++){o.items.push({xtype:"container",layout:"fit",items:{xtype:"container",items:A[Q],style:{paddingTop:4,paddingLeft:4,paddingRight:4,marginRight:__width_Scroller,"background-color":__color_FormBackground},width:f},border:false,width:f+__width_Scroller+4,autoScroll:true,title:A[Q].title,style:{"background-color":__color_FormBackground}})
}if(!H.disableSaveCancelFormButtons){Ext.applyIf(H,{buttons:[{text:this.findLangS("button","apply"),iconCls:"icon_save",handler:k,scope:this},{text:this.findLangS("button","cancel"),iconCls:"icon_cancel",handler:function(){this.destroyWindow()
},scope:this}]})
}Ext.applyIf(H,{layout:"fit",frame:true,border:false,items:o,seriesFilters:[],seriesTimeOffset:[],seriesIntervals:[],flex:1,listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",this.el,{enter:k,scope:this});
if(this.chartConfig&&this.chartConfig.series){this.setSeriesFields(this.chartConfig.series)
}else{if(this.chartDefault&&this.chartDefault.chartType&&a){var Y=cloneChartConfig(a,this.filtersFromParent);
this.completeSeries(Y.series);
this.setSeriesFields(Y.series)
}}this.loadTypeCharts();
this.enablerSaveDeleteChartConfig();
if(!this.dailyReportConfig&&!this.cdrChartConfig&&!this.dashboardConfig){this.loadTypeTimeAxises();
this.updateTimeIntervalTask={run:function(){++this.disableLoadTypeTimeAxises;
this.setTimeInterval();
--this.disableLoadTypeTimeAxises
},interval:30000,scope:this};
this.taskRunner=new Ext.util.TaskRunner();
this.taskRunner.start(this.updateTimeIntervalTask);
this.getForm().findField("chartType").focus(false,500)
}if(H._typeChart=="CDR"){CDR.Filter.setContextFields(this);
CDR.Filter.loadTemplates(this,H.chartConfig&&H.chartConfig.filters?H.chartConfig.filters.ffilterTemplate:null)
}else{if(H._typeChart=="MESSAGES"){Message.Filter.setContextFields(this)
}else{if(H._typeChart=="SIP_MSG"){SipMsg.Filter.setContextFields(this)
}}}var V=["leftLimitLineColor","rightLimitLineColor"];
for(var W=0;
W<V.length;
W++){var Z=this.getForm().findField(V[W]);
if(Z){var X=Z.getValue();
if(!Ext.isEmpty(X)){Z.setValue(X)
}}}},destroy:function(){if(!this.dailyReportConfig&&!this.cdrChartConfig&&!this.dashboardConfig){this.taskRunner.stop(this.updateTimeIntervalTask)
}}}});
if(!this.disableCreateWindow){Ext.apply(H,{width:f+__width_Scroller+4+8})
}this.callParent([H]);
if(!this.disableCreateWindow){this.window=new Ext.Window({layout:"fit",title:this.findLangS("title","chartConfiguration"),closable:true,modal:true,border:false,resizable:false,items:this,wikiId:"Charts#Chart_configuration",height:Math.min(900,Ext.dom.Element.getViewportHeight()-40)});
if(!this.disableShowWindow){this.window.show()
}}function k(){var W=this.getChartConfig();
var V=this.checkErrorInChartConfig(W);
if(V){Ext.Msg.alert(lang.error,V);
return
}if(this.getForm().isValid()){this.onApply.call(this.onApplyScope,W);
this.destroyWindow()
}}function S(V){this.maskLoad();
Ext.defer(function(){this.lastChartTypeId=null;
this.lastChartTypeName=null;
var Z=null;
var W=V.getValue();
if(W){var Y=V.findRecordByValue(V.getValue());
Z=this.completeChartConfig(W,Y&&Y.data.customId&&Y.data.chartConfig);
this.chartConfig=cloneChartConfig(Z,this.filtersFromParent)
}if(Z){++this.disableClearChartType;
this.fixTypeTimeAxis=Z.timeAxis;
this.setSeriesFields(Z.series);
this.setFilterFields(Z.filters);
if(Y&&Y.data.customId){for(var X=0;
X<this.cfgFieldsBase.length;
X++){if(this.cfgFieldsBase[X]!="chartType"){var aa=this.getForm().findField(this.cfgFieldsBase[X]);
if(aa){aa.setValue(Z[this.cfgFieldsBase[X]])
}}}}for(var X=0;
X<this.cfgFieldsAppearance.length;
X++){this.getForm().findField(this.cfgFieldsAppearance[X]).setValue(Z[this.cfgFieldsAppearance[X]])
}--this.disableClearChartType;
this.fixTypeTimeAxis=null
}this.setTimeInterval();
this.enablerSaveDeleteChartConfig();
this.unmask()
},100,this)
}function v(V){this.setTimeInterval();
this.clearChartType()
}function h(){if(this.rendered){this.loadTypeTimeAxises();
this.clearChartType();
this.onChangeTimeInterval()
}}function p(W,V){if(V){var Y=this.getForm().findField("sideAxis_"+W._indexSeries).getValue();
for(var X=0;
X<this.seriesRows.length;
X++){if(X!=W._indexSeries&&Y==this.getForm().findField("sideAxis_"+X).getValue()){this.getForm().findField("primaryAxis_"+X).setValue(false)
}}}this.clearChartType()
}function U(V,X){if(Ext.isArray(V)){for(var W=0;
W<V.length;
W++){B(V[W],X)
}}else{if(V){B(V,X)
}}}function B(W,V){if(W.xtype&&W.name&&!W.listeners){Ext.apply(W,{listeners:{scope:V,change:V.clearChartType,select:V.clearChartType}})
}if(W.items){U(W.items,V)
}}},createSeriesRow:function(c,b){var g=[];
for(var d=0;
d<this._headerSeries.length;
d++){var f=null;
switch(this._headerSeries[d].name){case"series_a":f={xtype:"ComboBoxA",aData:{data:b._typeChart=="CDR"?arCdrChart_chartSeriesTypes:b._typeChart=="MESSAGES"?arMessagesChart_chartSeriesTypes:b._typeChart=="SIP_MSG"?arSipMsgChart_chartSeriesTypes:[],fields:["id_main","descr1","descr2","comb","id"]},aFilter:function(h){return(h[1])
},valueField:"id",displayField:"descr1",_clearButton:true,listeners:{scope:this,select:function(l,k){if(k===null){this.clearChartType();
this.setSeriesFields(this.getSeries())
}else{this.createSeriesRowIfNeed();
this.clearChartType();
this.fillComboSeriesB(l._indexSeries,l.getValue());
this.setFirstValueInComboSeriesB(l._indexSeries);
for(var h=0;
h<2;
h++){this.setContextSeriesFields(l,"select");
this.setDefaultParamSeries(l);
this.setDefaultIntervalsSeries(l)
}}}},allowBlank:b.dashboardConfig&&c==0?false:true};
break;
case"series_b":f={xtype:"ComboBoxA",aData:{data:b._typeChart=="CDR"?arCdrChart_chartSeriesTypes:b._typeChart=="MESSAGES"?arMessagesChart_chartSeriesTypes:b._typeChart=="SIP_MSG"?arSipMsgChart_chartSeriesTypes:[],fields:["id","descr1","descr2","comb","id_a"]},aFilter:function(k,h){return(k[4]==h)
},displayField:"descr2",listeners:{scope:this,select:function(k){this.clearChartType();
for(var h=0;
h<2;
h++){this.setContextSeriesFields();
this.setDefaultParamSeries(k);
this.setDefaultIntervalsSeries(k)
}}},allowBlank:b.dashboardConfig&&c==0?false:true};
break;
case"param":f={xtype:"textfield",allowBlank:false};
break;
case"sideAxis":f={xtype:"ComboBoxA",aData:["left","right"],listeners:{scope:this,select:function(h){this.clearChartType();
this.setContextSeriesFields()
}}};
break;
case"baseType":f={xtype:"ComboBoxA",aData:["line","column","column_line","area"],aFilter:function(k,h){return(!h||!Ext.isArray(h)||h.isIn(k[0]))
},listeners:{scope:this,select:function(h){this.clearChartType();
this.setContextSeriesFields()
}}};
break;
case"lineType":f={xtype:"ComboBoxA",aData:["solid","dashed","dotted"]};
break;
case"color":f={xtype:"colorpickerfield",allowBlank:false,_color_and_background:true};
break;
case"primaryAxis":case"trend":case"fill":case"markers":case"smooth":case"percent":f={xtype:"checkbox"};
if(this._headerSeries[d].name=="primaryAxis"){Ext.applyIf(f,{listeners:{scope:this,change:this._onChangePrimary}})
}break;
case"filter":f={xtype:"container",items:{xtype:"button",border:false,style:{background:"none",marginTop:-5},innerStyle:{"padding-left":7},tooltip:this.findLangS("tooltip","seriesFilter"),iconCls:"icon_filter_blue",width:18,height:18,_id:"filter_"+c,_indexSeries:c,handler:function(h){this.setSeriesFilter(h._indexSeries)
},scope:this}};
break;
case"tools":f={xtype:"container",items:{xtype:"button",border:false,style:{background:"none",marginTop:-5},innerStyle:{"padding-left":7},tooltip:this.findLangS("tooltip","seriesTools"),iconCls:"icon_wrench_small",width:18,height:18,_id:"tools_"+c,_indexSeries:c,handler:function(h){this.setSeriesTools(h,h._indexSeries)
},scope:this}};
break
}Ext.applyIf(f,{name:this._headerSeries[d].name+"_"+c,width:this._headerSeries[d].width,style:this._headerSeries[d].style||{marginRight:__width_FieldSeparator},tdAttrs:this._headerSeries[d].tdAttrs,_indexSeries:c});
if(f.aData&&f.aData.length&&Ext.isString(f.aData[0])){for(var a=0;
a<f.aData.length;
a++){f.aData[a]=[f.aData[a],this.findLangS("combodata",f.aData[a])]
}}g.push(f)
}return(new Ext.Container({layout:{type:"table",columns:this._headerSeries.length,tableAttrs:{border:0}},items:g,_indexSeries:c}))
},getChartConfig:function(b,d){var f=this.chartConfig?cloneChartConfig(this.chartConfig,this.filtersFromParent):{};
f._typeChart=this._typeChart;
for(var c=0;
c<this.cfgFieldsBase.length;
c++){var h=this.getForm().findField(this.cfgFieldsBase[c]);
if(h){f[this.cfgFieldsBase[c]]=h.getValue()
}}for(var c=0;
c<this.cfgFieldsAppearance.length;
c++){f[this.cfgFieldsAppearance[c]]=this.getForm().findField(this.cfgFieldsAppearance[c]).getValue()
}if(b&&f.typeTimeInterval&&(!d||d&&(f.typeTimeInterval=="today"||f.typeTimeInterval=="yesterday"))){var a=getTimeInterval(f.typeTimeInterval,{prevInterval:this.prevInterval,prevIntervalHourTolerance:this.prevIntervalHourTolerance,actTime:null,forChart:true,intervalOffset:f.intervalOffset});
if((f.typeTimeInterval=="today"||f.typeTimeInterval=="yesterday")&&this.getForm().findField("dateFrom")){var k=this.getForm().findField("dateFrom").getValue();
var g=this.getForm().findField("dateTo").getValue();
if(k&&time_sec(k)){a[0]=completeDateTime(d?0:a[0],k)
}if(g&&time_sec(g)){a[1]=completeDateTime(d?0:(a[1]?a[1]:a[0]),g)
}}f.dateFrom=a[0];
f.dateTo=a[1]
}f.series=this.getSeries();
f.filters={};
if(this.filtersFromParent){applyFiltersFromParentToChartConfig(f,this.filtersFromParent)
}else{if(!this.disableFilters){if(this._typeChart=="CDR"){if(!this.disableFilterCommon){Ext.apply(f.filters,CDR.Filter.fetchValuesFromFieldset(this,"common"),CDR.Filter.fetchValuesFromFieldset(this,"template"))
}if(!this.disableFilterRTP){Ext.apply(f.filters,CDR.Filter.fetchValuesFromFieldset(this,"rtp"));
if(window.existsDscpCdr){Ext.apply(f.filters,CDR.Filter.fetchValuesFromFieldset(this,"dscp"))
}Ext.apply(f.filters,CDR.Filter.fetchValuesFromFieldset(this,"filters_comb"))
}}else{if(this._typeChart=="MESSAGES"){Ext.apply(f.filters,Message.Filter.fetchValuesFromFieldset(this))
}else{if(this._typeChart=="SIP_MSG"){Ext.apply(f.filters,SipMsg.Filter.fetchValuesFromFieldset(this))
}}}}}return(f)
},setChartConfigFields:function(b){++this.disableClearChartType;
for(var a=0;
a<this.cfgFieldsBase.length;
a++){var d=this.getForm().findField(this.cfgFieldsBase[a]);
if(d){d.setValue(b[this.cfgFieldsBase[a]]);
if(this.cfgFieldsBase[a]=="timeAxis"&&b[this.cfgFieldsBase[a]]!=d.setValue()){d._initValue=b[this.cfgFieldsBase[a]]
}}}for(var a=0;
a<this.cfgFieldsAppearance.length;
a++){this.getForm().findField(this.cfgFieldsAppearance[a]).setValue(b[this.cfgFieldsAppearance[a]])
}this.setSeriesFields(b.series);
this.setFilterFields(b.filters);
if((b.typeTimeInterval=="today"||b.typeTimeInterval=="yesterday")&&this.getForm().findField("dateFrom")){var g=false;
var f=this.getForm().findField("dateFrom").getValue();
var c=this.getForm().findField("dateTo").getValue();
if(b.dateFrom&&time_sec(b.dateFrom)){g=true;
f=completeDateTime(f,dateTime(b.dateFrom))
}if(b.dateTo&&time_sec(b.dateTo)){g=true;
c=completeDateTime(c?c:f,dateTime(b.dateTo))
}if(g){++this.disableLoadTypeTimeAxises;
this.getForm().findField("dateFrom").setValue(f);
this.getForm().findField("dateTo").setValue(c);
--this.disableLoadTypeTimeAxises
}}--this.disableClearChartType
},setSeriesFields:function(f){++this.disableClearChartType;
if(f){var b=0;
for(var d=0;
d<f.length;
d++){if(f[d].series){b=d+1
}}while(b+1>this.seriesRows.length){this.addSeriesRow()
}}for(var d=0;
d<this.seriesRows.length;
d++){for(var c=0;
c<this.seriesFields.length;
c++){var h=this.seriesFields[c]+"_"+d;
var g=this.getForm().findField(h);
if(g){if(!f||d>=f.length||!f[d]||!f[d].series){g.setValue(null)
}else{switch(this.seriesFields[c]){case"series_a":var a=getDataArrayItem(g.aData.data,f[d]["series"],g.aData.fields.indexOf("id_main"),g.aData.fields.indexOf("id"));
g.setValue(a);
this.fillComboSeriesB(d,a);
break;
case"series_b":g.setValue(f[d]["series"]);
break;
default:g.setValue(f[d][this.seriesFields[c]])
}}}}this.seriesFilters[d]=f&&d<f.length?f[d]["filter"]:null;
this.setSeriesFilterBtnIconCls(d,this.seriesFilters[d]&&isDataSet(this.seriesFilters[d]));
this.seriesTimeOffset[d]=f&&d<f.length?f[d]["timeOffset"]:null;
this.seriesIntervals[d]=f&&d<f.length?f[d]["multiSeriesIntervals"]:null;
this.setSeriesToolsBtnIconCls(d,this.isMultiSeriesIntervals(this.getSeriesForIndexSeries(d))?this.seriesIntervals[d]&&this.isDiffIntervalSeries(this.seriesIntervals[d],d):this.seriesTimeOffset[d]&&isDataSet(this.seriesTimeOffset[d]))
}this.setContextSeriesFields();
--this.disableClearChartType
},setFilterFields:function(a){if(!this.disableFilters){if(this._typeChart=="CDR"){if(!this.disableFilterCommon){CDR.Filter.setValueFieldsFieldset(a,this,"common");
CDR.Filter.loadTemplates(this,a&&a.ffilterTemplate)
}if(!this.disableFilterRTP){CDR.Filter.setValueFieldsFieldset(a,this,"rtp");
if(window.existsDscpCdr){CDR.Filter.setValueFieldsFieldset(a,this,"dscp")
}CDR.Filter.setValueFieldsFieldset(a,this,"filters_comb")
}}else{if(this._typeChart=="MESSAGES"){Message.Filter.setValueFieldsFieldset(a,this)
}else{if(this._typeChart=="SIP_MSG"){SipMsg.Filter.setValueFieldsFieldset(a,this)
}}}}},getSeries:function(){var d=[];
for(var c=0;
c<this.seriesRows.length;
c++){var f=this.getForm().findField("series_a_"+c);
if(f&&f.getValue()){var b={};
for(var a=0;
a<this.seriesFields.length;
a++){var h=this.seriesFields[a]+"_"+c;
var g=this.getForm().findField(h);
if(g){b[this.seriesFields[a]]=g.getValue()
}}b.filter=this.seriesFilters[c];
b.timeOffset=this.seriesTimeOffset[c];
b.multiSeriesIntervals=this.seriesIntervals[c];
d.push(b)
}}this.completeSeries(d);
return(d)
},setContextSeriesFields:function(h,z){var w=null;
var m=this.getForm().findField("combinationToArea");
var G=m.getValue();
var c=this.getForm().findField("maximumAreaItems");
var q=false;
var n=null;
var u=false;
var a=false;
for(var B=0;
B<this.seriesRows.length;
B++){var f=this.getForm().findField("series_a_"+B);
var b=this.getForm().findField("series_b_"+B);
if(f&&b){var g=f.getValue();
var d=b.getValue();
var t=this.getSeriesFromAB(g,d,f);
var C=this.isParamSeries(t);
var D=this.isMultiSeries(t);
var k=this.isMultiSeriesIntervals(t);
var p={};
for(var y=1;
y<this.seriesFields.length;
y++){var o=this.seriesFields[y];
var l=this.seriesFields[y]+"_"+B;
var h=this.getForm().findField(l);
if(h){var s=h.getValue();
p[o]=h.getValue();
var A=false;
if(t){switch(this.seriesFields[y]){case"series_b":A=b.store.getCount()>1;
break;
case"param":A=C;
break;
case"sideAxis":case"primaryAxis":A=!G;
break;
case"baseType":case"lineType":case"color":A=!D&&!G;
break;
case"trend":A=true;
break;
case"fill":case"markers":case"smooth":A=(p.baseType=="line"||p.baseType=="column_line"||p.baseType=="trend")&&!D&&!G;
break;
case"percent":A=D;
break
}}h.setDisabled(!A);
if(!A&&o=="param"){h.setValue(null)
}if(t){if(s===null){var F=this.seriesFields[y]=="baseType"&&D?"area":this.seriesFieldsDefault[y-1];
h.setValue(F);
s=F
}else{if(this.seriesFields[y]=="baseType"){if(D?(s!="area"):(s=="area")){var r=D?"area":this.seriesFieldsDefault[y-1];
h.setValue(r);
s=r
}}}p[o]=h.getValue();
if(this.seriesFields[y]=="baseType"){h.fillData(D?["area"]:["line","column","column_line"]);
h.setValue(s)
}}else{h.setValue(null)
}if(t){if(B==0){n=t
}else{if(n!=t){w=false
}else{if(B==1&&w===null){w=true
}}}switch(this.seriesFields[y]){case"baseType":if(s=="area"){w=false;
q=true
}break;
case"sideAxis":switch(s){case"left":u=true;
break;
case"right":a=true;
break
}break
}}}}var E=this.findC("_id","filter_"+B);
E.showIf(t);
var v=this.findC("_id","tools_"+B);
v._isMultiseriesIntervals=!!k;
v.showIf(t&&(k||!D))
}}if(m){m.enableIf(w);
m.showIf(w);
if(!w){m.setValue(false)
}}if(c){c.enableIf(q);
c.showIf(q);
if(!q){c.setValue(null)
}}this.fieldEnableIf(["axisTitleLeft","leftAxisMinWidth","leftLimitLineValue","leftPercTrend"],u);
this.fieldEnableIf("leftLimitLineColor",u&&this.getFieldValue("leftLimitLineValue"));
this.fieldEnableIf("leftPerc95_Color",u&&this.getFieldValue("leftPercTrend"));
this.fieldEnableIf("leftPerc99_Color",u&&this.getFieldValue("leftPercTrend"));
this.fieldEnableIf(["axisTitleRight","rightAxisMinWidth","rightLimitLineValue","rightPercTrend"],a);
this.fieldEnableIf("rightLimitLineColor",a&&this.getFieldValue("rightLimitLineValue"));
this.fieldEnableIf("rightPerc95_Color",a&&this.getFieldValue("rightPercTrend"));
this.fieldEnableIf("rightPerc99_Color",a&&this.getFieldValue("rightPercTrend"))
},createSeriesRowIfNeed:function(){var a=this.getForm().findField("series_a_"+(this.seriesRows.length-1));
if(a.getValue()){this.addSeriesRow()
}},addSeriesRow:function(){var a=this.createSeriesRow(this.seriesRows.length,this);
this.seriesRows.push(a);
this.seriesRowsContainer.add(a)
},fillComboSeriesB:function(a,c){var b=this.getForm().findField("series_b_"+a);
b.fillData(c)
},setFirstValueInComboSeriesB:function(a){var b=this.getForm().findField("series_b_"+a);
b.setFirstValue()
},getSeriesFromAB:function(c,b,k){if(!k){k=this.getForm().findField("series_a_0")
}var f=k.aData.data;
var g=k.aData.fields.indexOf("id");
var h=null;
var a=0;
for(var d=0;
d<f.length;
d++){if(f[d][g]==c){h=f[d][0];
++a
}}if(a==1){return(h)
}return(b)
},getSeriesForIndexSeries:function(f){var d=this.getForm().findField("series_a_"+f);
var c=this.getForm().findField("series_b_"+f);
if(d&&c){var b=d.getValue();
var a=c.getValue();
return(this.getSeriesFromAB(b,a))
}return(null)
},setDefaultParamSeries:function(c){var b=this.getSeriesForIndexSeries(c._indexSeries);
var a=this.getDefaultParamSeries(b);
if(a){var d=this.getForm().findField("param_"+c._indexSeries);
if(d){d.setValue(a)
}}},setDefaultIntervalsSeries:function(c){var b=this.getSeriesForIndexSeries(c._indexSeries);
var a=this.getDefaultIntervalsSeries(b);
if(a){this.seriesIntervals[c._indexSeries]=a
}},clearChartType:function(){if(!this.disableClearChartType){var d=this.getForm().findField("chartType");
var c=d.getValue();
var a=d.getRawValue();
var b=d.findRecordByValue(c);
if(c&&a&&b){d.setValue(null);
this.enablerSaveDeleteChartConfig();
if(b.data&&b.data.customId){d.setRawValue(a+" *");
this.lastChartTypeId=c;
this.lastChartTypeName=a
}}}},loadTypeCharts:function(){ajaxSafeRequest({scope:this,url:"php/reports/charts.php",params:{task:this._typeChart=="CDR"?"getCdrChartTypeCharts":this._typeChart=="MESSAGES"?"getMessagesChartTypeCharts":this._typeChart=="SIP_MSG"?"getSipMsgChartTypeCharts":null},success:function(a){this.fillStoreTypeCharts(a.typeCharts)
}})
},fillStoreTypeCharts:function(c){var b=this.getForm().findField("chartType");
if(c){for(var a=0;
a<c.length;
a++){var d="TCH_custom_"+c[a].id;
this.addTypeChart(b,{id:d,name:c[a].name,customId:c[a].id,chartConfig:c[a].config})
}}if(b._initValue&&!b._initValueSet){b.setValue(b._initValue);
b._initValueSet=true
}this.enablerSaveDeleteChartConfig()
},addTypeChart:function(g,f,c,a){var d=0;
for(var b=0;
b<g.store.getCount();
b++){if(!(g.store.getAt(b).data.id.match&&g.store.getAt(b).data.id.match(/^TCH_custom/))){++d
}else{if(g.store.getAt(b).data.descr<=f.name){++d
}else{break
}}}g.addMenuItem({id:f.id,descr:f.name,descrMenu:(c?'<span style="color: green;">':f.customId?'<span style="color: blue;">':"")+f.name+(c||f.customId?"</span>":""),customId:f.customId,chartConfig:f.chartConfig},a,false,d)
},loadTypeTimeAxises:function(){if(this.cdrChartConfig){return
}var b=this.fixTypeTimeAxis;
if(!this.disableLoadTypeTimeAxises&&!this.dashboardConfig){if(this.dailyReportConfig){var a=this.getForm().findField("typeTimeInterval").getValue();
if(!a){a="this_month"
}var c;
switch(a){case"last_hour":case"last_2h":case"last_3h":c=[["TA_MINUTES",3],["TA_QUARTER",2],["TA_HOURS",1]];
break;
case"last_8h":c=[["TA_5MINUTES",3],["TA_QUARTER",2],["TA_HOURS",1]];
break;
case"last_24h":case"today":case"yesterday":c=[["TA_QUARTER",2],["TA_HOURS",1]];
break;
case"this_week_m":case"this_week_s":c=[["TA_HOURS",2],["TA_DAYS",1]];
break;
case"this_month":case"prev_month":case"last_30d":case"last_60d":case"last_90d":c=[["TA_DAYS",2],["TA_WEEKS",1]];
break;
default:c=[["TA_HOURS",2]["TA_DAYS",1]]
}this.fillStoreTypeTimeAxises(c,b)
}else{var d={};
if(this.filtersFromParent){applyDateFromToFromFiltersFromParent(d,this.filtersFromParent,this._typeChart)
}else{Ext.applyIf(d,{dateFrom:this.getForm().findField("dateFrom").getValue(),dateTo:this.getForm().findField("dateTo").getValue()})
}ajaxSafeRequest({scope:this,url:"php/reports/charts.php",params:{task:this._typeChart=="CDR"?"getCdrChartTypeTimeAxises":this._typeChart=="MESSAGES"?"getMessagesChartTypeTimeAxises":this._typeChart=="SIP_MSG"?"getSipMsgChartTypeTimeAxises":null,params:Ext.encode(d)},success:function(f){this.fillStoreTypeTimeAxises(f.typeTimeAxises,b)
}})
}}},fillStoreTypeTimeAxises:function(a,k,g){var d=this.getForm().findField("timeAxis");
var f=k||d.getValue()||d._initValue;
var b=null;
if(d.store){d.store.removeAll()
}if(a.length){var l=[];
var h;
for(var c=0;
c<a.length;
c++){l.push([a[c][0],arLang["LtimeAxis_"+a[c][0]],a[c][1]]);
if(f===a[c][0]){h=true
}if(b===null&&a[c][1]<200){b=a[c][0]
}}d.store.loadData(l);
d.store.proxy.data=l;
++this.disableClearChartType;
d.setValue(h||g?f:b||a[0]);
--this.disableClearChartType
}},completeChartConfig:function(a,c,b){if(!b){if(c){b=Ext.isString(c)?Ext.decode(c):c
}else{if(a){defChartType=this._typeChart&&arCdrChart_defChartTypes[a][this._typeChart]||arCdrChart_defChartTypes[a];
b=cloneChartConfig(defChartType,this.filtersFromParent)
}}}if(b){if(!b._typeChart){b._typeChart=this._typeChart||"CDR"
}if(!this._typeChart){this._typeChart=b._typeChart
}if(b.dateFrom&&Ext.isString(b.dateFrom)){b.dateFrom=dateTimeStringToDate(b.dateFrom);
if(!Ext.isDefined(b.dateFrom.timeDefined)&&b.isDashboardExport){b.dateFrom.timeDefined=true
}}if(b.dateTo&&Ext.isString(b.dateTo)){b.dateTo=dateTimeStringToDate(b.dateTo);
if(!Ext.isDefined(b.dateTo.timeDefined)&&b.isDashboardExport){b.dateTo.timeDefined=true
}}this.completeSeries(b.series)
}return(b)
},completeSeries:function(c){for(var b=0;
b<c.length;
b++){if(c[b].series_a||c[b].series_b){c[b].series=this.getSeriesFromAB(c[b].series_a,c[b].series_b);
delete c[b].series_a;
delete c[b].series_b
}Ext.applyIf(c[b],{sideAxis:"left",baseType:"line",lineType:"solid",trend:false,fill:false,markers:false,smooth:true});
if(Ext.isDefined(c[b].color)){c[b].color=aliasColorToHexRgb(c[b].color)
}var d=this.getDataSeries(c[b].series);
if(d){var a=this.getData2Series(c[b].series);
Ext.applyIf(c[b],{varName:d[5],varName2:"s_"+(b+1),title:d[3],titleBase:this.formatTitleBase(d[4],d[1],c[b].param),chartType:d[4],multiSeries:d.length>6?d[6]=="multiSeries":null,multiSeriesIntervals:d.length>8?d[6]=="multiSeries"&&d[8]:null,paramSeries:d.length>6?d[6]=="param":null,param:d.length>7?d[6]=="param"&&d[7]:null,unit:a&&a.unit})
}}},formatTitleBase:function(b,a,c){return(b=="TCH_count_perc_short"?a+" <"+c+"s":a+(a&&c?" - "+c:""))
},getDataSeries:function(a){var c=this._typeChart=="CDR"?arCdrChart_chartSeriesTypes:this._typeChart=="MESSAGES"?arMessagesChart_chartSeriesTypes:this._typeChart=="SIP_MSG"?arSipMsgChart_chartSeriesTypes:[];
for(var b=0;
b<c.length;
b++){if(c[b][0]==a){return(c[b])
}}return(null)
},getData2Series:function(a){var c=this._typeChart=="CDR"?arCdrChart_chartSeriesData:this._typeChart=="MESSAGES"?arMessagesChart_chartSeriesData:this._typeChart=="SIP_MSG"?arSipMsgChart_chartSeriesData:[];
for(var b=0;
b<c.length;
b++){if(c[b][0]==a){return(c[b][1])
}}return(null)
},isParamSeries:function(a){var b=this.getDataSeries(a);
return(b&&b.length>6&&b[6]=="param")
},getDefaultParamSeries:function(a){var b=this.getDataSeries(a);
return(b&&b.length>7&&b[6]=="param"?b[7]:null)
},getDefaultIntervalsSeries:function(a){var b=this.getDataSeries(a);
return(b&&b.length>8&&b[6]=="multiSeries"?b[8]:null)
},isDiffIntervalSeries:function(g,c){var f=this.getSeriesForIndexSeries(c);
var a=this.getDefaultIntervalsSeries(f);
if(!a&&!g){return(false)
}if(!a&&g&&g.length||a&&!g||a.length!=g.length){return(true)
}for(var d=0;
d<g.length;
d++){for(var b=0;
b<2;
b++){if(g[d][b]!=a[d][b]){return(true)
}}}return(false)
},isMultiSeries:function(a){var b=this.getDataSeries(a);
return(b&&b.length>6&&b[6]=="multiSeries")
},isMultiSeriesIntervals:function(a){var b=this.getDataSeries(a);
return(b&&b.length>8&&b[6]=="multiSeries"&&b[8])
},saveChartConfig:function(){var d=this.getForm().findField("chartType");
var a=new Ext.FormPanel({frame:true,border:false,items:{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","chartName"),value:this.lastChartTypeName,width:__width_FormChar(12,25),allowBlank:false},buttons:[{text:this.findLangS("button","saveTemplate"),iconCls:"icon_save",handler:b,scope:this},{text:this.findLangS("button","cancel"),iconCls:"icon_cancel",handler:function(){a.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",a.el,{enter:b,scope:this})
}}});
var c=new Ext.Window({layout:"fit",items:a,border:false,title:this.findLangS("title","saveChartConfig"),modal:true,closable:true,listeners:{scope:this,activate:function(){a.getForm().findField("name").focus(false,200)
}}});
c.show();
function b(){if(a.getForm().isValid()){var f=a.getForm().findField("name").getValue();
var g=this.getChartConfig();
this.saveChartConfigAjax(f,g,false,a,d)
}}},saveChartConfigAjax:function(c,d,b,a,f){ajaxSafeRequest({scope:this,url:"php/reports/charts.php",params:{task:"saveChartConfig",params:Ext.encode({name:c,user_id:user_id(),config:Ext.encode(d),enableUpdate:b,typeChart:this._typeChart})},success:function(g){var h="TCH_custom_"+g.id;
this.addTypeChart(f,{id:h,name:c,customId:g.id,chartConfig:Ext.encode(d)},true,true);
f.setValue(h);
this.enablerSaveDeleteChartConfig();
a.destroyWindow()
},error:function(h,g){if(h.error=="name_duplication"){Ext.Msg.confirm(this.findLangS("text","msgDuplicationNameTitle"),this.findLangS("text","msgDuplicationNameText"),function(k){if(k=="yes"){this.saveChartConfigAjax(c,d,true,a,f)
}else{a.destroyWindow()
}},this)
}else{alertAjaxError(g)
}},maskEl:a})
},deleteChartConfig:function(){var b=this.getForm().findField("chartType");
var a=b.findRecordByValue(b.getValue());
Ext.Msg.confirm(this.findLangS("text","msgDeleteChartConfirmTitle"),this.findLangS("text","msgDeleteChartConfirmText"),function(c){if(c=="yes"){this.deleteChartConfigAjax(a.data.customId,b)
}},this)
},deleteChartConfigAjax:function(b,a){ajaxSafeRequest({scope:this,url:"php/reports/charts.php",params:{task:"deleteChartConfig",params:Ext.encode({id:b})},success:function(c){a.deleteMenuItem("TCH_custom_"+b);
a.setValue(null);
this.enablerSaveDeleteChartConfig()
}})
},setTimeInterval:function(){if(this.filtersFromParent||this.cdrChartConfig||this.dashboardConfig){return
}++this.disableClearChartType;
var b=this.getForm().findField("typeTimeInterval").getValue();
var d=this.getForm().findField("intervalOffset");
var a=d&&d.getValue()||null;
if(b){var c=getTimeInterval(b,{prevInterval:this.prevInterval,prevIntervalHourTolerance:this.prevIntervalHourTolerance,actTime:null,forChart:true,intervalOffset:a});
++this.disableLoadTypeTimeAxises;
if(b=="today"||b=="yesterday"){var g=this.getForm().findField("dateFrom").getValue();
var f=this.getForm().findField("dateTo").getValue();
if(g&&time_sec(g)){c[0]=completeDateTime(c[0],g)
}if(f&&time_sec(f)){c[1]=completeDateTime(c[1]?c[1]:c[0],f)
}}this.getForm().findField("dateFrom").setValue(c[0]);
this.getForm().findField("dateTo").setValue(c[1]);
--this.disableLoadTypeTimeAxises;
this.loadTypeTimeAxises();
this.clearChartType();
this.lastTimeInterval={type:b,interval:c};
this.onChangeTimeInterval()
}else{this.lastTimeInterval=null;
this.onChangeTimeInterval()
}if(b=="today"||b=="yesterday"){this.getForm().findField("dateFrom").enableTime(true);
this.getForm().findField("dateTo").enableTime(true)
}else{this.getForm().findField("dateFrom").setDisabled(b||this.dailyReportConfig);
this.getForm().findField("dateTo").setDisabled(b||this.dailyReportConfig)
}--this.disableClearChartType
},onChangeTimeInterval:function(){var a=this.getForm().findField("intervalOffset");
if(a){a.enableIf(this.lastTimeInterval&&this.lastTimeInterval.interval[2].applicableIntervalOffset)
}},enablerSaveDeleteChartConfig:function(){var c=this.getForm().findField("chartType");
if(!c.store){return
}var a=c.getValue();
var b=c.findRecordByValue(a);
if(this.btnSaveChartConfig){this.btnSaveChartConfig.setVisible(!b&&!a&&!(c._initValue&&!c._initValueSet))
}if(this.btnDeleteChartConfig){this.btnDeleteChartConfig.setVisible(b&&b.data.customId&&(user_is_admin()||user_can_delete_all_templates()||b.data.user_id==user_id()))
}},setSeriesFilter:function(k){if(this._typeChart=="CDR"){var n=CDR.Filter.getFieldset("common",{disableTimeInterval:true,disableSelections:true,values:this.seriesFilters[k]||{}});
var d=CDR.Filter.getFieldset("rtp",{values:this.seriesFilters[k]||{}});
var c=window.existsDscpCdr?CDR.Filter.getFieldset("dscp",{values:this.seriesFilters[k]||{}}):null;
var a=CDR.Filter.getFieldset("filters_comb",{values:this.seriesFilters[k]||{}});
var o=705;
var m=__height_Form(n.length);
var h=[{xtype:"container",items:n,title:this.findLangS("title","filterCommon"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o,height:m},{xtype:"container",items:d,title:this.findLangS("title","filterRTP"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o,height:m}];
if(c){h.push({xtype:"container",items:c,title:this.findLangS("title","filterDSCP"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o,height:m})
}h.push({xtype:"container",items:a,title:this.findLangS("title","filterFiltersComb"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o,height:m});
var g=[{xtype:"textfield",name:"series_title",value:(this.seriesFilters[k]||{}).series_title,fieldLabel:this.findLangS("field","seriesTitle"),width:__width_FormChar(15,35)},{xtype:"tabpanel",items:h,border:false}]
}else{if(this._typeChart=="MESSAGES"){var g=Message.Filter.getFieldset({disableTimeInterval:true,values:this.seriesFilters[k]||{}});
var o=705;
var m=__height_Form(g.length);
var g=[{xtype:"textfield",name:"series_title",value:(this.seriesFilters[k]||{}).series_title,fieldLabel:this.findLangS("field","seriesTitle"),width:__width_FormChar(15,35)},{xtype:"tabpanel",items:[{xtype:"container",items:g,title:this.findLangS("title","filterCommon"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o,height:m}],border:false}]
}else{if(this._typeChart=="SIP_MSG"){var g=SipMsg.Filter.getFieldset({modelType:"stored",disableTimeInterval:true,values:this.seriesFilters[k]||{}});
var o=705;
var m=__height_Form(g.length);
var g=[{xtype:"textfield",name:"series_title",value:(this.seriesFilters[k]||{}).series_title,fieldLabel:this.findLangS("field","seriesTitle"),width:__width_FormChar(15,35)},{xtype:"tabpanel",items:[{xtype:"container",items:g,title:this.findLangS("title","filterCommon"),style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o,height:m}],border:false}]
}}}var l=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,items:g,buttons:[{scope:this,text:this.findLangS("button","ok"),iconCls:"icon_ok",handler:function(){if(l.getForm().isValid()){b.call(this);
f.destroy()
}}},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){f.destroy()
}},{scope:this,iconCls:"icon_cross",text:this.findLangS("button","remove"),handler:function(){this.seriesFilters[k]=null;
this.setSeriesFilterBtnIconCls(k,false);
f.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",l.el,{enter:function(){if(l.getForm().isValid()){b.call(this);
f.destroy()
}},scope:this});
if(this._typeChart=="CDR"){CDR.Filter.setContextFields(l)
}else{if(this._typeChart=="MESSAGES"){Message.Filter.setContextFields(l)
}else{if(this._typeChart=="SIP_MSG"){SipMsg.Filter.setContextFields(l)
}}}}}});
var f=new Ext.Window({scope:this,title:this.findLangS("title","seriesFilter"),closable:true,border:false,plain:true,layout:"fit",modal:true,items:l,formPanelForAutoAdjustSize:l});
f.show();
function b(){if(this._typeChart=="CDR"){this.seriesFilters[k]=CDR.Filter.fetchValuesFromFieldset_all(l,false,true)
}else{if(this._typeChart=="MESSAGES"){this.seriesFilters[k]=Message.Filter.fetchValuesFromFieldset(l,false,true)
}else{if(this._typeChart=="SIP_MSG"){this.seriesFilters[k]=SipMsg.Filter.fetchValuesFromFieldset(l,false,true)
}}}this.seriesFilters[k].series_title=l.getForm().findField("series_title").getValue();
if(isDataSet(this.seriesFilters[k])){this.setSeriesFilterBtnIconCls(k,true)
}else{this.seriesFilters[k]=null;
this.setSeriesFilterBtnIconCls(k,false)
}this.clearChartType()
}},setSeriesTools:function(b,a){if(b._isMultiseriesIntervals){this.setSeriesTools_intervals(a)
}else{this.setSeriesTools_timeOffset(a)
}},setSeriesTools_timeOffset:function(f){var a="charts";
var l=this.seriesTimeOffset[f]||[];
var k=30;
var c=5;
var d=15;
var b=new Ext.form.Panel({xtype:"form",frame:true,border:false,autoWidth:true,autoHeight:true,items:[{xtype:"textfield",name:"name",fieldLabel:findLangS(a,"field","time_offset_name_title"),width:__width_FormChar(d,k),labelWidth:__width_FieldChar(d)},{xtype:"numberfield",name:"hours",fieldLabel:findLangS(a,"field","time_offset_hours"),minValue:1,maxValue:7*24,width:__width_Form(__width_FieldChar(d),__width_FieldNum(c)),labelWidth:__width_FieldChar(d)},{xtype:"numberfield",name:"days",fieldLabel:findLangS(a,"field","time_offset_days"),minValue:1,maxValue:31,width:__width_Form(__width_FieldChar(d),__width_FieldNum(c)),labelWidth:__width_FieldChar(d)},{xtype:"numberfield",name:"months",fieldLabel:findLangS(a,"field","time_offset_months"),minValue:1,maxValue:12,width:__width_Form(__width_FieldChar(d),__width_FieldNum(c)),labelWidth:__width_FieldChar(d)}],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:h},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){b.ownerCt.close()
}}],listeners:{scope:this,afterrender:function(n){for(var m in l){var o=n.getForm().findField(m);
if(o){o.setValue(l[m])
}}Ext.create("Ext.util.KeyNav",b.el,{enter:h,scope:this})
}}});
var g=new Ext.Window({title:findLangS(a,"title","time_offset"),layout:"fit",items:b,border:false,modal:true,closable:true,resizable:false,listeners:{scope:this,activate:function(){b.getForm().findField("name").focus(false,200)
}}});
g.show();
function h(){if(b.getForm().isValid()){var m=b.getForm().getFieldValues();
l={};
for(var n in m){if(m[n]){l[n]=m[n]
}}if(isDataSet(l)){this.seriesTimeOffset[f]=l;
this.setSeriesToolsBtnIconCls(f,true)
}else{this.seriesTimeOffset[f]=null;
this.setSeriesToolsBtnIconCls(f,false)
}b.ownerCt.close()
}}},setSeriesTools_intervals:function(l){var c="charts";
var k=this.seriesIntervals[l]||[];
var n=k.length>0;
for(var g=0;
g<k.length;
g++){if(!Ext.isString(k[g][0])){n=false;
break
}}var h=[];
var f=[];
var b=[];
if(n){h.push({name:"descr"},{name:"color"});
f.push({dataIndex:"descr",flex:1,renderer:function d(t,q,p,u,s,r,o){return(Ext.isString(t)&&t.match("/")?t.split("/")[1]:t)
}})
}else{h.push({name:"order",type:"float"},{name:"interval_limit"},{name:"interval_last",type:"bool"},{name:"color"});
f.push({dataIndex:"interval_limit",flex:1,renderer:function d(t,q,p,u,s,r,o){return(p.data.interval_last?findLangS(c,"text","interval_last"):t)
}});
b.push({xtype:"checkbox",name:"interval_last"},{xtype:"textfield",name:"interval_limit",widthNum:12})
}f.push({dataIndex:"color",flex:1,renderer:function d(t,q,p,u,s,r,o){return(renderStringStyle(t,{color:t||"black"}))
}});
b.push({xtype:"colorpickerfield",name:"color",widthCh:12});
var a=new Ext.ux.grid.GridForm({subsystem:c,subjectLang:"interval",memoryStore:true,recordStruct:h,sortField:n?undefined:"order",columns:f,fpItems:b,enableEdit:true,enableInsert:!n,enableDelete:!n,width:200,height:250,prepareDataForSave:function(p,o,q){if(n){p.descr=q.descr
}else{p.order=p.interval_last?1000000000:p.interval_limit*1
}},setContextItems:function(o,r,s,u,t,q,p){if(!n){this.enableFieldIf("interval_limit",!this.getValueField("interval_last"))
}},listeners:{afterrender:function(){for(var o=0;
o<k.length;
o++){a.store.add(n?{descr:k[o][0],color:k[o][1]}:{order:o<k.length-1?k[o][0]:1000000000,interval_limit:k[o][0],interval_last:o==k.length-1,color:k[o][1]})
}}}});
var m=new Ext.Window({title:findLangS(c,"title",n?"colors":"intervals"),layout:"fit",items:{xtype:"container",layout:{type:"vbox",align:"center"},items:[a,{xtype:"button",text:lang.okButtonText,iconCls:"icon_ok",style:{marginTop:6,marginBottom:6},scope:this,handler:function(){if(n){var q=cloneArray(this.seriesIntervals[l]);
for(var p=0;
p<a.store.getCount();
p++){var r=a.store.getAt(p).data;
for(var o=0;
o<q.length;
o++){if(q[o][0]==r.descr){q[o][1]=r.color
}}}this.seriesIntervals[l]=q;
this.setSeriesToolsBtnIconCls(l,this.isDiffIntervalSeries(q,l))
}else{var q=[];
for(var p=0;
p<a.store.getCount();
p++){var r=a.store.getAt(p).data;
q.push([p<a.store.getCount()-1?r.interval_limit:null,r.color])
}if(q.length){this.seriesIntervals[l]=q;
this.setSeriesToolsBtnIconCls(l,this.isDiffIntervalSeries(q,l))
}else{this.seriesIntervals[l]=null;
this.setSeriesToolsBtnIconCls(l,false)
}}this.clearChartType();
m.close()
}}]},border:false,modal:true,closable:true,resizable:false});
m.show()
},setSeriesFilterBtnIconCls:function(a,c){var b=this.findC("_id","filter_"+a);
if(b){b.setIconCls(c?"icon_filter_red":"icon_filter_blue")
}},setSeriesToolsBtnIconCls:function(a,c){var b=this.findC("_id","tools_"+a);
if(b){b.setIconCls(c?"icon_wrench_small_red":"icon_wrench_small")
}},checkErrorInChartConfig:function(b){if(!b.series||!b.series.length){return(this.findLangS("text","errorMissingSeries"))
}var c=0;
for(var a=0;
a<b.series.length;
a++){if(b.series[a].baseType=="area"){++c
}}if(c>1){return(this.findLangS("text","errorMultipleArea"))
}return(false)
},getFieldValue:function(b){var a=this.getForm().findField(b);
if(a){return(a.getValue())
}return(undefined)
},fieldEnableIf:function(d,a){if(Ext.isArray(d)){for(var b=0;
b<d.length;
b++){this.fieldEnableIf(d[b],a)
}}else{var c=this.getForm().findField(d);
if(c){c.enableIf(a)
}}}});
Ext.define("Ext.chart.theme.CdrChart",{extend:"Ext.chart.theme.Base",alias:"chart.theme.CdrChart",constructor:function(a){a.axis={left:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},right:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},bottom:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}}};
this.callParent([a])
}});
Ext.define("Ext.chart.theme.CdrChartLine",{extend:"Ext.chart.theme.CdrChart",alias:"chart.theme.CdrChartLine",constructor:function(a){a.colors=["red","blue","green"];
this.callParent([a])
}});
Ext.define("Ext.chart.theme.CdrChartColumn",{extend:"Ext.chart.theme.CdrChart",alias:"chart.theme.CdrChartColumn",constructor:function(a){a.colors=["blue"];
this.callParent([a])
}});
Ext.define("Ext.chart.theme.CdrChartLineWithGreySum",{extend:"Ext.chart.theme.CdrChart",alias:"chart.theme.CdrChartLineWithGreySum",constructor:function(a){a.colors=["lightgrey","red","blue","green"];
this.callParent([a])
}});
Ext.define("Ext.chart.theme.CdrChartArea",{extend:"Ext.chart.theme.CdrChart",alias:"chart.theme.CdrChartArea",constructor:function(a){a.colors=["#94ae0a","#115fa6","#a61120","#ff8809","#ffd13e","#a61187","#24ad9a","#7c7474","#a66111","#6101f9","#1622ce","#a7115a","#ff6309","#24ad5f","#a68810","#9602ff","#1589b3","#ff3209"];
this.callParent([a])
}});
function cloneChartConfig(c,b){var a=cloneObject(c);
a.filtersFromParent=b||c.filtersFromParent;
return(a)
}function applyFiltersFromParentToChartConfig(c,a,b){if(!b){b=c._typeChart
}a=a||c.filtersFromParent;
if(!a){return
}if(!Ext.isDefined(c.filters)){c.filters={}
}Ext.apply(c.filters,a);
applyDateFromToFromFiltersFromParent(c,a,b);
c.filtersFromParent=a
}function adjustChartConfigTimeAxisForFiltersFromParent(f,c,g){if(!g){g=f._typeChart
}c=c||f.filtersFromParent;
if(!c){return
}var h=null;
var a=null;
var d=null;
var l=null;
if(g=="CDR"){if(c.flast_days||c.flast_minutes){h=c.flast_days;
a=c.flast_minutes
}else{d=c.fdatefrom;
l=c.fdateto
}}else{if(g=="MESSAGES"){var b=Ext.decode(c.form_filters);
if(b){if(b.last_days||b.last_minutes){h=b.last_days;
a=b.last_minutes
}else{d=dateTimeStringToDate(b.calldate_from);
l=dateTimeStringToDate(b.calldate_to)
}}}}var k=h||a?getLengthTimeAxisForCustomInterval(f.timeAxis,h,a):d||l?getLengthTimeAxisForTimeRange(f.timeAxis,d,l):null;
if(k>5&&k<500){return
}if(h||a){f.timeAxis=getChartTimeAxisForCustomInterval(h,a)
}else{if(d||l){f.timeAxis=getChartTimeAxisForTimeRange(d,l)
}}}function applyDateFromToFromFiltersFromParent(a,b,c){var k=null;
var h=null;
var g=null;
var f=null;
if(c=="CDR"){if(b.flast_days||b.flast_minutes){k=b.flast_days;
h=b.flast_minutes
}else{g=b.fdatefrom;
f=b.fdateto
}}else{if(c=="MESSAGES"){var d=Ext.decode(b.form_filters);
if(d){if(d.last_days||d.last_minutes){k=d.last_days;
h=d.last_minutes
}else{g=dateTimeStringToDate(d.calldate_from);
f=dateTimeStringToDate(d.calldate_to)
}}}}if(k||h){a.dateFrom=dateTime();
if(h){a.dateFrom=new Date(a.dateFrom.getTime()-h*60*1000)
}if(k){a.dateFrom=decDay(a.dateFrom,k)
}if(!h){a.dateFrom=date(a.dateFrom)
}a.dateTo=null
}else{if(g||f){a.dateFrom=g;
a.dateTo=f
}}}function getNumericAxisConfig(k,f,b){for(var d=-b;
d<20;
d++){for(var c=0;
c<3;
c++){var h=Math.pow(10,d)*(c==0?1:(c==1?2:5));
var a=Math.floor(k/h)*h+((k%h)?h:0);
var g=Math.round(a/h);
if(g<=f){return({max:a,step:h,count:g})
}}}return(null)
}Ext.define("CDR.Chart.MosJitterLoss.Panel",{extend:"Ext.Panel",constructor:function(a){a=Ext.applyIf(a||{},{layout:{type:"vbox",align:"stretch"},items:[],border:false});
this.callParent([a]);
this.chartConfig=[];
this.chartPanels=[];
for(var b=0;
b<3;
b++){this.chartConfig[b]=this.getChartConfig(b);
this.chartPanels[b]=new CDR.Chart.ChartPanel({_enableBtnTracker:false,_enableBtnEdit:false,_enableBtnRemove:false,_enableBtnUndock:a.undockTitle,undockTitle:a.undockTitle,_disableAlertInvalidQuery:true});
this.add({xtype:"panel",layout:"fit",items:this.chartPanels[b],flex:1})
}},loadCharts:function(){for(var a=0;
a<3;
a++){this.loadChart(a)
}},loadChart:function(a){this.chartPanels[a].loadChart(this.chartConfig[a],false,{fceOkQuery:function(){},fceInvalidQuery:function(){Ext.defer(function(){this.chartPanels[a].disable()
},100,this)
},fceOkQueryScope:this,fceInvalidQueryScope:this})
},getChartConfig:function(c){var a=c==0?{chartType:"TCH_mos",varName:"sm_mos_intervals",series:"TCHS_mos_intervals",axisTitleLeft:"MOS"}:c==1?{chartType:"TCH_jitter",varName:"sm_jitter_intervals",series:"TCHS_jitter_intervals",axisTitleLeft:"jitter"}:{chartType:"TCH_packet_lost",varName:"sm_packet_lost_intervals",series:"TCHS_packet_lost_intervals",axisTitleLeft:"packetr loss"};
a.multiSeriesIntervals=getDataArrayItem(arCdrChart_chartSeriesTypes,a.series,0,8);
Ext.applyIf(a,{baseType:"area",multiSeries:true,sideAxis:"left"});
var b={series:[a],title:"",axisTitleLeft:a.axisTitleLeft,chartType:null,dateFrom:this.dateFrom,dateTo:this.dateTo,filters:this.filters,filtersFromParent:null,legendPosition:null,title:"none",theme:"CdrChartArea",legendPosition:"top"};
return(b)
},createWindow:function(a){var a=cloneObject(a||{});
Ext.applyIf(a,{iconCls:"icon_menu_diag_system",closable:true,maximizable:true,resizable:true,layout:"fit",items:this,border:false,width:Ext.dom.Element.getViewportWidth()/2,height:Ext.dom.Element.getViewportHeight()-50,modal:false});
this.window=new Ext.Window(a);
this.window.show()
}});
function getChartTimeAxisForStdDashboardInterval(a,b){if(!b){b=arDashboardTimeIntervals
}return(getDataArrayItem(b,a,0,2))
}function getChartTimeAxisForCustomInterval(b,a){return(getChartTimeAxisForTimeS((b||0)*24*60*60+(a||0)*60))
}function getChartTimeAxisForTimeRange(a,b){if(!a){a=new Date()
}if(!b){b=new Date()
}else{if(!time_sec(b)&&b.timeDefined===false){b=date_next(b)
}}return(getChartTimeAxisForTimeS((b.getTime()-a.getTime())/1000))
}function getChartTimeAxisForTimeS(a){return(a<=5*60?"TA_SECONDS":a<=6*60*60?"TA_MINUTES":a<=2*24*60*60?"TA_QUARTER":a<=8*24*60*60?"TA_HOURS":"TA_DAYS")
}function getChartTimeAxisesForTimeS(f,g,d){if(!Ext.isDefined(g)){g=2
}if(!Ext.isDefined(d)){d=500
}var a=[];
for(var c in arCdrChart_timeAxisTypes){var b=Math.ceil(f/arCdrChart_timeAxisTypes[c].step);
if(b>=g&&b<=d){a.push([c,b])
}}return(a)
}function getLengthTimeAxisForCustomInterval(b,f,d){if(!b){return(null)
}var c=arCdrChart_timeAxisTypes[b];
if(!c){return(null)
}var a=c.step;
return((f*24*60*60+d*60)/a)
}function getLengthTimeAxisForTimeRange(d,a,c){if(!d){return(null)
}var f=arCdrChart_timeAxisTypes[d];
if(!f){return(null)
}var b=f.step;
if(!a){a=new Date()
}if(!c){c=new Date()
}else{if(!time_sec(c)&&c.timeDefined===false){c=date_next(c)
}}return((c.getTime()-a.getTime())/1000/b)
}Ext.ns("GroupStat");
Ext.define("GroupStat.Panel",{extend:"Ext.Panel",subsystem:"group_stat",constructor:function(c){if(!c){c={}
}var f=[];
if(c.initItemsMainTabBar){for(var d=0;
d<c.initItemsMainTabBar.length;
d++){var h=c.initItemsMainTabBar[d];
Ext.applyIf(h,{closable:false,_custom:true});
f.push(h)
}}f.push({text:this.findLangS("title","distribution"),closable:false,_id:"distribution"});
if(c.type=="cdr"&&window.rtpQualityUse){f.push({text:this.findLangS("title","callQuality"),closable:false,_id:"callQuality"})
}f.push({text:this.findLangS("title",c.type=="cdr"||c.cdrGroupRecord?"topCalls":c.type=="message"||c.messageGroupRecord?"topCalls_msg":null),closable:false,_id:"topCalls"},{text:this.findLangS("title",c.type=="cdr"||c.cdrGroupRecord?"topCallDistribution":c.type=="message"||c.messageGroupRecord?"topCallDistribution_msg":null),closable:false,_id:"topCallDistribution"});
this.mainTabBar=new Ext.tab.Bar({dock:c.tabDock||"top",plain:true,border:false,items:f,listeners:{scope:this,change:this.onChangeTab},style:{marginTop:1}});
this.contentContainer=new Ext.Panel({border:false,layout:"fit",style:c.tabDock=="bottom"?Ext.apply(__style_SubgridBorderBottom(),{}):Ext.apply(__style_SubgridBorder(),{marginBottom:1}),flex:1});
var a=this.mainTabBar;
var b=25;
if(c.tabDock!="bottom"&&(c.wikiIdInTabBar||c.collapsiblePanel)){this.mainTabBar.flex=1;
var g=[{xtype:"container",flex:1,height:b-1}];
if(c.wikiIdInTabBar){g.push(new Ext.panel.Tool(getWikiObject({xtype:"tool",id:c.wikiIdInTabBar,marginTop:2})))
}if(c.collapsiblePanel){g.push(Ext.widget({xtype:"tool",type:"collapse-bottom",handler:function(){c.collapsiblePanel.collapse()
},style:{marginLeft:3,marginTop:2}}))
}a={xtype:"container",layout:{type:"hbox",stretch:true},items:[this.mainTabBar,{xtype:"container",width:100,height:b,layout:{type:"hbox"},items:g,style:{"background-color":c.tabBackgroundColor||__color_PanelBackgroud,"border-bottom":"1px solid "+__color_PanelBorder,padding:0}}],height:b,style:{"background-color":c.tabBackgroundColor||__color_PanelBackgroud}}
}else{a={xtype:"container",items:this.mainTabBar,height:b,style:{"background-color":c.tabBackgroundColor||__color_PanelBackgroud}}
}Ext.apply(c,{layout:{type:"vbox",align:"stretch"},items:c.tabDock=="bottom"?[this.contentContainer,a]:[a,this.contentContainer],border:false,listeners:{scope:this,afterrender:this.onAfterRender}});
this.callParent([c]);
this.groupByData={sip_src_ip:{code:"2s",filterName:"groupfilter_sipcallerip",filterField:"sipip",filter2field:"fsipcallerip",filter2field2:"fsipcallerdip_type",filter2field_msg:"sipcallerip",filter2field2_msg:"sipcallerdip_type",topCalls_group2:"sip_dst_ip"},sip_dst_ip:{code:"2d",filterName:"groupfilter_sipcalledip",filterField:"sipip",filter2field:"fsipcalledip",filter2field2:"fsipcallerdip_type",filter2field_msg:"sipcalledip",filter2field2_msg:"sipcallerdip_type",topCalls_group2:"sip_src_ip"},rtp_src_ip:{code:"a_saddr",filterName:"groupfilter_a_saddr",filterField:"rtpip",filter2field:"fa_saddr",filter2field2:"fab_saddr_type",topCalls_group2:"rtp_dst_ip"},rtp_dst_ip:{code:"b_saddr",filterName:"groupfilter_b_saddr",filterField:"rtpip",filter2field:"fb_saddr",filter2field2:"fab_saddr_type",topCalls_group2:"rtp_src_ip"},src_phone_num:{code:"caller",filterName:"groupfilter_caller",filterField:"phone_numb",filter2field:"fcaller",filter2field2:"fcallerd_type",filter2field_msg:"caller",filter2field2_msg:"callerd_type",enableNullValue:true,topCalls_group2:"dst_phone_num"},dst_phone_num:{code:"called",filterName:"groupfilter_called",filterField:"phone_numb",filter2field:"fcalled",filter2field2:"fcallerd_type",filter2field_msg:"called",filter2field2_msg:"callerd_type",enableNullValue:true,topCalls_group2:"src_phone_num"},a_ua:{code:"a_ua",filterName:"groupfilter_a_ua_id",filterField:"ua_id",filter2field:"fa_ua_id",filter2field2:"fab_ua_id_type",chartField:"ua",topCalls_group2:"b_ua"},b_ua:{code:"b_ua",filterName:"groupfilter_b_ua_id",filterField:"ua_id",filter2field:"fb_ua_id",filter2field2:"fab_ua_id_type",chartField:"ua",topCalls_group2:"a_ua"},country_by_caller:{code:"country_by_caller",filterName:"groupfilter_country_code_caller",filterField:"country_code",filter2field:"fcountry_code_caller",filter2field2:"fcountry_code_callerd_type",filter2field_msg:"country_code_caller",filter2field2_msg:"country_code_callerd_type",chartField:"country",topCalls_group2:"country_by_called"},country_by_called:{code:"country_by_called",filterName:"groupfilter_country_code_called",filterField:"country_code",filter2field:"fcountry_code_called",filter2field2:"fcountry_code_callerd_type",filter2field_msg:"country_code_called",filter2field2_msg:"country_code_callerd_type",chartField:"country",topCalls_group2:"country_by_caller"},country_by_sipcallerip:{code:"country_by_sipcallerip",filterName:"groupfilter_country_code_sipcallerip",filterField:"country_code",filter2field:"fcountry_code_sipcallerip",filter2field2:"fcountry_code_sipcallerdip_type",filter2field_msg:"country_code_sipcallerip",filter2field2_msg:"country_code_sipcallerdip_type",chartField:"country",topCalls_group2:"country_by_sipcalledip"},country_by_sipcalledip:{code:"country_by_sipcalledip",filterName:"groupfilter_country_code_sipcalledip",filterField:"country_code",filter2field:"fcountry_code_sipcalledip",filter2field2:"fcountry_code_sipcallerdip_type",filter2field_msg:"country_code_sipcalledip",filter2field2_msg:"country_code_sipcallerdip_type",chartField:"country",topCalls_group2:"country_by_sipcallerip"}}
},onAfterRender:function(){var b=0;
if(this.startTab){for(var a=0;
a<this.mainTabBar.items.length;
a++){if(this.mainTabBar.items.get(a)._id==this.startTab){b=a;
break
}}}Ext.defer(function(){this.mainTabBar.setActiveTab(this.mainTabBar.items.get(b))
},200,this);
if(this.type=="cdr"||this.cdrGroupRecord){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCdrCharts"},success:function(c){if(c.charts){this.chartsTypes=c.charts;
this.mainTabBar.add({text:this.findLangS("title","charts"),closable:false,_id:"charts"})
}if(user_can_3d_rtp_charts()){this.mainTabBar.add({text:this.findLangS("title","rtp_stat"),closable:false,_id:"rtp_stat"})
}}})
}},onChangeTab:function(a,b){this._counterChangeTab=(this._counterChangeTab||0)+1;
this.activeTabId=b._id;
if(!this.disableFirstChangeTabMask||this._counterChangeTab>1){this.hideAll();
this.contentContainer.maskLoad()
}if(this._counterChangeTab>1){Ext.defer(function(){this._onChangeTab(a,b)
},1000,this)
}else{this._onChangeTab(a,b)
}if(this.evChangeTab){this.evChangeTab.call(this.evChangeTabScope,b)
}},_onChangeTab:function(a,b){if(this._destroyOnChangeTab){this.destroyAll()
}switch(b._id){case"distribution":this.createChartDistribution(b);
break;
case"callQuality":this.createChartCallQuality(b);
break;
case"topCalls":this.createGridTopCalls(this.disableFirstChangeTabMask&&this._counterChangeTab==1);
break;
case"topCallDistribution":this.createChartTopCalls();
break;
case"charts":this.createCharts();
break;
case"rtp_stat":this.createRtpStat();
break;
default:this.contentContainer.unmask();
if(b.contentPanel){b.contentPanel.show()
}else{b.contentPanel=new Ext.Panel({layout:"fit",items:b.content,border:false,listeners:{destroy:function(c){c.removeAll()
}}});
this.contentContainer.add(b.contentPanel)
}}},destroyInactiveTabs:function(){if(this.chartDistributionPanel&&this.activeTabId!="distribution"){this.chartDistributionPanel.destroy();
this.chartDistributionPanel=null
}if(this.chartCallQualityPanel&&this.activeTabId!="callQuality"){this.chartCallQualityPanel.destroy();
this.chartCallQualityPanel=null
}if(this.gridTopCallsPanel&&this.activeTabId!="topCalls"){this.gridTopCallsPanel.destroy();
this.gridTopCallsPanel=null
}if(this.chartTopCallsPanel&&this.activeTabId!="topCallDistribution"){this.chartTopCallsPanel.destroy();
this.chartTopCallsPanel=null
}if(this.chartsPanel&&this.activeTabId!="charts"){this.chartsPanel.destroy();
this.chartsPanel=null
}if(this.rtpStatPanel&&this.activeTabId!="rtp_stat"){this.rtpStatPanel.destroy();
this.rtpStatPanel=null
}},createChartDistribution:function(a){if(this.chartDistributionPanel){this.chartDistributionPanel.show();
this.contentContainer.unmask();
return
}this.chartDistributionPanel=new GroupStat.ChartType.Panel({typeChart:this.type=="cdr"||this.cdrGroupRecord?"distribution":this.type=="message"||this.messageGroupRecord?"distribution_msg":null,height:500,unmaskEl:this.contentContainer,mainPanel:this,undockTitle:a.text});
this.contentContainer.add(this.chartDistributionPanel)
},createChartCallQuality:function(a){if(this.chartCallQualityPanel){this.chartCallQualityPanel.show();
this.contentContainer.unmask();
return
}this.chartCallQualityPanel=new GroupStat.ChartType.Panel({typeChart:"mos_intervals",height:500,unmaskEl:this.contentContainer,mainPanel:this,undockTitle:a.text});
this.contentContainer.add(this.chartCallQualityPanel)
},createGridTopCalls:function(a){if(this.gridTopCallsPanel){this.gridTopCallsPanel.show();
this.contentContainer.unmask();
return
}this.gridTopCallsPanel=new GroupStat.GridTopCalls.Panel({groupByData:this.groupByData,mainPanel:this,disableAutoLoad:a});
this.contentContainer.add(this.gridTopCallsPanel);
this.contentContainer.unmask()
},createChartTopCalls:function(){if(this.chartTopCallsPanel){this.chartTopCallsPanel.show();
this.contentContainer.unmask();
return
}this.chartTopCallsPanel=new GroupStat.ChartTopCalls.Panel({groupByData:this.groupByData,mainPanel:this});
this.contentContainer.add(this.chartTopCallsPanel);
this.contentContainer.unmask()
},createCharts:function(){if(this.chartsPanel){this.chartsPanel.show();
this.contentContainer.unmask();
return
}var b={charts:this.chartsTypes,border:false,disableTbar:true,disableFilteredCdr:true,disableRtcpChart:true,disableTitle:true,callOnActivateAfterRender:true,flexContainer:true,chartPanelConfig:{_enableBtnTracker:false,_enableBtnEdit:false},mainPanel:this};
Ext.apply(b,{dateFrom:this.getDateFrom(),dateTo:this.getDateTo(),filters:this.getChartFilter()});
this.chartsPanel=new CDR.ChartsPanel(b);
var a=this;
this.chartsPanel.reload=function(){a.chartsPanel.reloadChart({dateFrom:a.getDateFrom(),dateTo:a.getDateTo(),filters:a.getChartFilter()})
};
this.contentContainer.add(this.chartsPanel);
this.contentContainer.unmask()
},createRtpStat:function(){if(this.rtpStatPanel){this.rtpStatPanel.show();
this.contentContainer.unmask();
this.rtpStatPanel.chart.startLoadInterval(10000);
return
}this.rtpStatPanel=new GroupStat.RtpStat.Panel({mainPanel:this});
this.contentContainer.add(this.rtpStatPanel);
this.contentContainer.unmask()
},getFilter:function(b){var f={};
if(this.type=="cdr"||this.cdrGroupRecord){var h=this.cdrStore.proxy.extraParams;
var d=CDR.Filter.getArrayOfAllFields();
for(var c in h){if(Ext.isString(c)&&(c[0]=="f"&&d.isIn(c.substr(1))||c=="config_cond_by_international"||this.groupPanel&&c.match(/^group_/))){f[c]=h[c]
}}if(b&&b.chart){delete f.fdatefrom;
delete f.fdateto
}if(this.cdrGroupRecord){f.groupfilter_lastSIPresponse=this.cdrGroupRecord.data.lastSIPresponse;
if(this.cdrGroupRecord.data.bye){f.groupfilter_bye=this.cdrGroupRecord.data.bye
}}if(b&&b.nextFilters){Ext.apply(f,b.nextFilters)
}if(this.groupPanel){f.enableGroups=true;
f.enableGroupFilters=false
}if(b&&Ext.isDefined(b.enableGroupFilters)){f.enableGroupFilters=b.enableGroupFilters
}}else{if(this.type=="message"||this.messageGroupRecord){var a={};
var h=this.messageStore.proxy.extraParams;
var g=this.messageGrid.form_filters;
var d=Message.Filter.getArrayOfFields();
for(var c in g){if(Ext.isString(c)&&d.isIn(c)){f[c]=g[c]
}}for(var c in h){if(Ext.isString(c)&&this.groupPanel&&c.match(/^group_/)){a[c]=h[c]
}}if(b&&b.chart){delete f.calldate_from;
delete f.calldate_to
}if(this.messageGroupRecord){f.groupfilter_lastSIPresponse=this.messageGroupRecord.data.lastSIPresponse
}if(b&&b.nextFilters){Ext.apply(f,b.nextFilters)
}if(b&&b.nextExtraParams){Ext.apply(f,b.nextExtraParams)
}if(this.groupPanel){a.enableGroups=true;
a.enableGroupFilters=false
}if(b&&Ext.isDefined(b.enableGroupFilters)){a.enableGroupFilters=b.enableGroupFilters
}if(isDataSet(a)){f.extraParams=a
}if(b&&b.extraParams){var h={};
if(isDataSet(f.extraParams)){h=f.extraParams;
delete f.extraParams
}h.form_filters=Ext.encode(f);
return(h)
}}}return(f)
},getChartFilter:function(a){if(!a){a={}
}a.chart=true;
return(this.getFilter(a))
},getDateFrom:function(){var a=this.getFilter();
return(this.type=="cdr"||this.cdrGroupRecord?(this.cdrGrid&&this.cdrGrid._panel&&this.cdrGrid._panel.getDateFrom?this.cdrGrid._panel.getDateFrom():a.fdatefrom):this.type=="message"||this.messageGroupRecord?(this.messageGrid&&this.messageGrid._panel&&this.messageGrid._panel.getDateFrom?this.messageGrid._panel.getDateFrom():a.calldate_from):null)
},getDateTo:function(){var a=this.getFilter();
return(this.type=="cdr"||this.cdrGroupRecord?(this.cdrGrid&&this.cdrGrid._panel&&this.cdrGrid._panel.getDateTo?this.cdrGrid._panel.getDateTo():a.fdateto):this.type=="message"||this.messageGroupRecord?(this.messageGrid&&this.messageGrid._panel&&this.messageGrid._panel.getDateTo?this.messageGrid._panel.getDateTo():a.calldate_to):null)
},createWindow:function(c,a){if(!c){c={}
}Ext.apply(c,{iconCls:"icon_menu_diag_system",width:Ext.dom.Element.getViewportWidth()*9/10,height:Ext.dom.Element.getViewportHeight()*9/10,maximizable:true,modal:false,layout:"fit",items:[this],border:false});
var b=new Ext.Window(c);
if(a){b.show()
}return(b)
},reload:function(b,a){if(this._ignoreReload){this._ignoreReload=false;
return
}if(this.chartDistributionPanel&&(!b||this.activeTabId=="distribution")){this.chartDistributionPanel.reload()
}if(this.chartCallQualityPanel&&(!b||this.activeTabId=="callQuality")){this.chartCallQualityPanel.reload()
}if(this.gridTopCallsPanel&&(!b||this.activeTabId=="topCalls")){this.gridTopCallsPanel.reload()
}if(this.chartTopCallsPanel&&(!b||this.activeTabId=="topCallDistribution")){this.chartTopCallsPanel.reload()
}if(this.chartsPanel&&(!b||this.activeTabId=="charts")){this.chartsPanel.reload()
}if(this.rtpStatPanel&&(!b||this.activeTabId=="rtp_stat")){this.rtpStatPanel.reload()
}if(a){this.destroyInactiveTabs()
}},clearSelect:function(){if(this.gridTopCallsPanel){this.gridTopCallsPanel.clearSelect()
}},deselectAll:function(a){if(this.gridTopCallsPanel){this.gridTopCallsPanel.deselectAll(a);
this.gridTopCallsPanel.deselectAllInNextLevel(null,a)
}},hideAll:function(){if(this.chartDistributionPanel){this.chartDistributionPanel.hide()
}if(this.chartCallQualityPanel){this.chartCallQualityPanel.hide()
}if(this.gridTopCallsPanel){this.gridTopCallsPanel.hide()
}if(this.chartTopCallsPanel){this.chartTopCallsPanel.hide()
}if(this.chartsPanel){this.chartsPanel.hide()
}if(this.rtpStatPanel){if(this.rtpStatPanel.chart){this.rtpStatPanel.chart.stopLoadInterval()
}this.rtpStatPanel.hide()
}for(var a=0;
a<this.mainTabBar.items.length;
a++){var b=this.mainTabBar.items.get(a);
if(b._custom&&b.contentPanel){b.contentPanel.hide()
}}},destroyAll:function(){this.contentContainer.removeAll(true);
this.chartDistributionPanel=null;
this.chartCallQualityPanel=null;
this.gridTopCallsPanel=null;
this.chartTopCallsPanel=null;
this.chartsPanel=null;
this.rtpStatPanel=null;
for(var a=0;
a<this.mainTabBar.items.length;
a++){var b=this.mainTabBar.items.get(a);
if(b._custom&&b.contentPanel){b.contentPanel=null
}}}});
Ext.define("GroupStat.ChartType.Panel",{extend:"Ext.Panel",subsystem:"group_stat",constructor:function(a){this.chartConfig=GroupStat.Charts.getChartConfig({typeChart:a.typeChart,dateFrom:a.mainPanel.getDateFrom(),dateTo:a.mainPanel.getDateTo(),filters:a.mainPanel.getChartFilter()});
this.chartPanel=new CDR.Chart.ChartPanel({_enableBtnTracker:false,_enableBtnEdit:false,_enableBtnRemove:false,_enableBtnUndock:true,undockTitle:a.undockTitle,_disableAlertInvalidQuery:true});
Ext.applyIf(a,{layout:"fit",items:this.chartPanel,border:false,height:a.height});
this.callParent([a]);
Ext.defer(function(){if(a.unmaskEl){a.unmaskEl.unmask()
}this.loadChart(a.unmaskEl)
},100,this)
},loadChart:function(a){if(!this.chartPanel){this.chartPanel=new CDR.Chart.ChartPanel({_enableBtnTracker:false,_enableBtnEdit:false,_enableBtnRemove:false,_enableBtnUndock:true,undockTitle:this.undockTitle,_disableAlertInvalidQuery:true});
this.add(this.chartPanel)
}this.chartPanel.loadChart(this.chartConfig,false,{fceOkQuery:function(){if(a){a.unmask()
}if(this.invalidQueryInfoPanel){this.invalidQueryInfoPanel.destroy();
this.invalidQueryInfoPanel=null
}},fceInvalidQuery:function(){if(a){a.unmask()
}this.removeAll(true);
this.chartPanel=null;
this.invalidQueryInfoPanel=new Ext.Panel({layout:{type:"vbox",align:"center",pack:"center"},border:false,items:{xtype:"displayfield",value:this.chartConfig._typeChart=="MESSAGES"?CDR.Chart.ChartPanel.prototype.LmsgInvalidQueryDescr_messages:CDR.Chart.ChartPanel.prototype.LmsgInvalidQueryDescr,fieldStyle:{"font-weight":"bold","font-size":"120%"}},height:100});
this.add(this.invalidQueryInfoPanel)
},fceOkQueryScope:this,fceInvalidQueryScope:this})
},reload:function(){Ext.apply(this.chartConfig,{dateFrom:this.mainPanel.getDateFrom(),dateTo:this.mainPanel.getDateTo(),filters:this.mainPanel.getChartFilter()});
this.mask();
this.loadChart(this)
}});
Ext.define("GroupStat.GridTopCalls.Panel",{extend:"Ext.Panel",subsystem:"group_stat",constructor:function(c){var f=this;
var k=[];
var a=["sip_src_ip","sip_dst_ip"];
if(this.getType(c)=="cdr"){a.push("rtp_src_ip","rtp_dst_ip","src_phone_num","dst_phone_num","a_ua","b_ua");
if(window.existsCdrCountryCode){a.push("country_by_caller","country_by_called","country_by_sipcallerip","country_by_sipcalledip")
}}else{if(this.getType(c)=="message"){a.push("src_phone_num","dst_phone_num");
if(window.existsMessageCountryCode){a.push("country_by_caller","country_by_called","country_by_sipcallerip","country_by_sipcalledip")
}}}var h=[];
for(var d=0;
d<a.length;
d++){h.push([a[d],this.findLangS("menu",a[d])])
}var b=new Ext.ux.combobox.ComboBoxA({xtype:"ComboBoxA",aData:h,listeners:{scope:this,select:function(){g.call(this)
}},width:__width_ColumnChar(40),listConfig:{maxHeight:Ext.dom.Element.getViewportHeight()/3-60}});
k.push({xtype:"displayfield",value:this.findLangS("text","groupBy")+":",fieldCls:"x-toolbar-text"},b);
if(!c.disableColumnsConfiguration){k.push("->",{xtype:"button",iconCls:"icon_columns",menu:[],listeners:{scope:this,click:function(m){m.menu.removeAll();
var n=this.gridPanel.headerCt.getMenuItems(0)[3].menu;
for(var l=1;
l<n.length;
l++){m.menu.add(n[l])
}m.showMenu(true)
}}})
}this.gridPanel=new Ext.ux.grid.GridForm({storeId:"GroupStatStore",url:"php/model/sql.php",module:this.getType(c)=="cdr"?"CDR_stats":this.getType(c)=="message"?"message_stats":null,recordStruct:this.getType(c)=="cdr"?rsCDR_stats:this.getType(c)=="message"?rsMessage_stats:null,columns:[{dataIndex:"",header:"&nbsp;"}],proxy_timeout:60*60*1000,tbar:k,enableAutoLoad:false,plugins:c.mainPanel&&!c.disableExpander?[{ptype:"rowexpander",rowBodyContentCls:"GroupStat.GridTopCalls.GridExpPanel",rowBodyContentConfig:{mainPanel:c.mainPanel},expandOnEnter:false,expandOnDblClick:false,enableSelectRowOnClick:false}]:undefined,prefixCls:"group_stat",stripeRows:false,panel:this,listeners:{scope:this,afterrender:function(){Ext.defer(function(){b.setValue(this.groupBy||"sip_src_ip");
g.call(this,this.disableAutoLoad)
},200,this)
},destroy:function(){if(this.level&&this.isSetGroupFilter()){this.clearGroupFilter();
this.reloadMainGrid(true)
}}},selModel:{mode:"SINGLE",allowDeselect:true},viewConfig:{loadingText:getLoadMaskWithStopButton_loading_text("gridTopCalls_loadMask"),listeners:{scope:this,expandbody:function(){if(this.mainPanel&&this.mainPanel.groupPanel){var l=Ext.dom.Element.getViewportHeight()-200;
var m=Math.min(550,l);
if(this.mainPanel.groupPanel.getHeight()<m){this.mainPanel.groupPanel.setHeight(m)
}}},cellcontextmenu:function(){onContextClipboardMenu.apply(this.gridPanel,arguments)
}}},enableAutoLoad:false,contextMenu:function(l,n){if(n.dataIndex=="sipip"){var o=l.data[n.dataIndex];
var m=l.data.sip_hostname;
return([{text:findLangS(this.subsystem,"grid",(m?"editIpLookup":"addIpLookup")),iconCls:m?"icon_edit":"icon_add",handler:function(){f.addIpToHostname(o,m,f.gridPanel)
},scope:this}])
}},bufferedRenderer:false,prefixCls:c.level?"level_"+c.level:undefined,autoCollapseAllBeforeChangeHeader:true});
this.gridPanel.applyConfig(c.type=="cdr"||c.mainPanel&&c.mainPanel.type=="cdr"?"CDR.GroupPanel_topCalls":c.mainPanel&&c.mainPanel.cdrGroupRecord?"CDR.AdvancedStatistics_topCalls":c.type=="message"||c.mainPanel&&c.mainPanel.type=="message"?"Message.GroupPanel_topCalls":c.mainPanel&&c.mainPanel.messageGroupRecord?"Message.AdvancedStatistics_topCalls":null);
this.gridPanel.selModel.on("selectionchange",this.onSelectionChange,this);
this.gridPanel.store.on("beforeload",this.onBeforeLoad,this);
this.gridPanel.store.on("load",this.onLoad,this);
Ext.applyIf(c,{layout:"fit",items:this.gridPanel,border:false});
this.callParent([c]);
function g(l){this.doGrid(b.getValue(),l);
Ext.defer(function(){this.gridPanel.focus()
},100,this)
}},doGrid:function(n,a){if(this.isSetGroupFilter()){this.clearGroupFilter();
this.reloadMainGrid(true)
}this.deselectAll(true);
var b=[];
this.groupBy=n;
this.groupByCode=this.groupByData[n].code;
this.gridPanel.groupByFilterName=this.groupByData[n].filterName;
this.gridPanel.groupByFilterField=this.groupByData[n].filterField;
this.gridPanel.groupByFilter_enableNullValue=this.groupByData[n].enableNullValue;
var c=null;
switch(n){case"sip_src_ip":case"sip_dst_ip":c={headerLang:"groupSipIP_hostName",dataIndex:"sipip",renderer:h};
break;
case"rtp_src_ip":case"rtp_dst_ip":c={headerLang:"groupRtpIP_hostName",dataIndex:"rtpip",renderer:l};
break;
case"src_phone_num":case"dst_phone_num":case"caller":case"called":c={headerLang:"groupPhoneNumb",dataIndex:"phone_numb"};
break;
case"a_ua":case"b_ua":c={headerLang:"groupUa",dataIndex:"ua"};
break;
case"country_by_caller":case"country_by_called":case"country_by_sipcallerip":case"country_by_sipcalledip":c={headerLang:"groupCountry",dataIndex:"country",renderer:v};
break
}if(this.type||this.mainPanel&&this.mainPanel.groupPanel){if(this.getType()=="cdr"){c.width=__width_ColumnChar(20)
}else{if(this.getType()=="message"){c.minWidth=200;
c.flex=1
}else{c.width=__width_ColumnChar(20)
}}}else{c.minWidth=150;
c.flex=1
}b.push(c);
var m=null;
if(this.getType()=="cdr"){b.push({dataIndex:"cnt_all",width:__width_ColumnNum(6),align:"right"},{dataIndex:"cnt_ok",width:__width_ColumnNum(6),align:"right",renderer:w},{headerLang:"sum_duration_min",dataIndex:"duration_all",width:__width_ColumnNum(9),align:"right",renderer:o},{dataIndex:"acd_all",width:__width_ColumnNum(6),align:"right",renderer:d},{dataIndex:"asr_all",width:__width_ColumnNum(6),align:"right",renderer:g},{dataIndex:"ner_all",width:__width_ColumnNum(6),align:"right",renderer:t});
if(window.rtpQualityUse){b.push({dataIndex:"mos_all",width:__width_ColumnNum(6),align:"right",renderer:p});
if(!window.disablePercentiles){b.push({dataIndex:"mos_perc95_all",width:__width_ColumnNum(6),align:"right",renderer:p})
}b.push({dataIndex:"packets_lost_all",width:__width_ColumnNum(6),align:"right",renderer:r});
if(!window.disablePercentiles){b.push({dataIndex:"packets_lost_perc95_all",width:__width_ColumnNum(6),align:"right",renderer:r})
}b.push({dataIndex:"jitter_all",width:__width_ColumnNum(6),align:"right",renderer:f});
if(!window.disablePercentiles){b.push({dataIndex:"jitter_perc95_all",width:__width_ColumnNum(6),align:"right",renderer:f})
}b.push({dataIndex:"delay_all",width:__width_ColumnNum(7),align:"right",headerLang:"delay_all_avg",renderer:q});
if(!window.disablePercentiles){b.push({dataIndex:"delay_perc95_all",width:__width_ColumnNum(7),align:"right",headerLang:"delay_perc95_all_avg",renderer:q})
}}if(window.fillBillingTable){b.push({dataIndex:"price_operator",width:__width_ColumnNum(7),align:"right",headerLang:"price_operator",renderer:k});
b.push({dataIndex:"price_customer",width:__width_ColumnNum(7),align:"right",headerLang:"price_customer",renderer:k});
b.push({dataIndex:"price_difference",width:__width_ColumnNum(7),align:"right",headerLang:"price_difference",renderer:k})
}m="cdr"
}else{if(this.getType()=="message"){b.push({dataIndex:"cnt_all",width:__width_ColumnNum(10),align:"right"},{dataIndex:"cnt_perc",width:__width_ColumnNum(7),align:"right",renderer:w});
m="messages"
}}if(m){for(var s=0;
s<b.length;
s++){b[s].header=findLangS(m,"column",b[s].headerLang||b[s].dataIndex)
}}this.gridPanel.store.sorters.clear();
if(!this.groupByCode){this.gridPanel.reconfigure(this.gridPanel.store,[]);
this.gridPanel.store.removeAll();
return
}this.gridPanel.reconfigure(this.gridPanel.store,b);
this.gridPanel.applyConfig();
var u=this.getExtraParams();
this.gridPanel.setNewExtraParams(u,!a);
function h(C,y,z,D,B,A){return(z.data.sip_ip+(z.data.sip_hostname?("<br><i>"+z.data.sip_hostname+"</i>"):""))
}function l(C,y,z,D,B,A){return(z.data.rtp_ip+(z.data.rtp_hostname?("<br><i>"+z.data.rtp_hostname+"</i>"):""))
}function w(E,y,B,F,D,C){var A=0;
C.each(function(G){A+=G.data.cnt_all
});
var z=formatNumber(B.data.cnt_all/A*100,2)+"%";
return(z)
}function o(y){return(y===null?"":formatNumber(y/60,1)+"min")
}function d(y){return(y===null?"":formatNumber(y,0)+"s")
}function g(y){return(y===null?"":formatNumber(y,0)+"%")
}function t(y){return(y===null?"":formatNumber(y,0)+"%")
}function p(y){return(y===null?"":formatNumber(y,2))
}function r(y){return(y===null?"":formatNumber(y,2)+"%")
}function f(y){return(y===null?"":formatNumber(y,2))
}function q(C,y,z,D,B,A){return(C===null?"":formatNumber(C,1)+__unit_xPDV)
}function v(C,y,z,D,B,A){return((existsFlag(z.data.country_code)?'<img src="images/blank.png" class="flag flag-'+z.data.country_code+'" style="margin-bottom: -1px;" /> ':"")+C+" "+z.data.country_code)
}function k(y){return(y===null?"":formatNumber(y,2))
}},reload:function(){if(!this.gridPanel.store.proxy.extraParams||!this.gridPanel.store.proxy.extraParams.group_by){Ext.defer(function(){this.reload()
},100,this);
return
}this._loading=true;
this._loading_clear_select=false;
var a=this.gridPanel.selModel.getSelection();
if(a&&a.length){this._selected_before_reload=a[0].data[this.gridPanel.groupByFilterField]
}else{this._selected_before_reload=null
}var b=this.getExtraParams();
this.gridPanel.setNewExtraParams(b,true)
},deselectAllInNextLevel:function(b,a){this.gridPanel.forEachExpanderBodyContent(function(d,c){if(b&&b.id==c.id){return
}if(d.gridPanel_topCalls){d.gridPanel_topCalls.deselectAll(a)
}})
},clearSelect:function(){if(!this.mainPanel){return
}this.deselectAll();
if(this.mainPanel.type=="cdr"){this.mainPanel.cdrGrid.clearGroupFilter(this.level)
}else{if(this.mainPanel.type=="message"){this.mainPanel.messageGrid.clearGroupFilter(this.level)
}}},isSetGroupFilter:function(){if(!this.mainPanel){return(false)
}if(this.mainPanel.type=="cdr"){return(this.mainPanel.cdrGrid.isSetGroupFilter(this.level))
}else{if(this.mainPanel.type=="message"){return(this.mainPanel.messageGrid.isSetGroupFilter(this.level))
}}return(false)
},clearGroupFilter:function(){if(!this.mainPanel){return
}if(this.mainPanel.type=="cdr"){this.mainPanel.cdrGrid.clearGroupFilter(this.level)
}else{if(this.mainPanel.type=="message"){this.mainPanel.messageGrid.clearGroupFilter(this.level)
}}},reloadMainGrid:function(a){if(!this.mainPanel){return
}if(this.mainPanel.type=="cdr"){if(a){this.mainPanel.groupPanel._ignoreReloadCdrStats=true
}this.mainPanel.cdrGrid.reload({page:1})
}else{if(this.mainPanel.type=="message"){if(a){this.mainPanel.groupPanel._ignoreReloadMessageStats=true
}this.mainPanel.messageGrid.reload({page:1})
}}},autoSelectParent:function(){if(!this.level){return
}var a=this.parentGrid.getSelection();
if(a.length==1&&a[0].id==this.parentRecord.id){return
}this._ignore_selection_change=true;
this.parentGrid.setSelection([this.parentRecord]);
this._ignore_selection_change=false
},deselectAll:function(a){this._ignore_selection_change=true;
this.gridPanel.selModel.deselectAll(a);
this._ignore_selection_change=false;
this._selection_old=null
},onBeforeLoad:function(){beginLoadMaskWithStopButton_store(this.gridPanel.store,"gridTopCalls_loadMask")
},onLoad:function(){if(!this.mainPanel){return
}this._loading=false;
endLoadMaskWithStopButton_store(this.gridPanel.store);
if(this._loading_clear_select){this._loading_clear_select=false;
if(this._selected_before_reload){this._ignore_selection_change=true;
var a=[];
this.gridPanel.store.each(function(b){if(b.data[this.gridPanel.groupByFilterField]==this._selected_before_reload){a.push(b)
}},this);
if(a.length){this.gridPanel.selModel.select(a)
}else{if(this.mainPanel.type=="cdr"){this.mainPanel.cdrGrid.clearGroupFilter(this.level);
this.mainPanel.cdrGrid.reload({page:1})
}else{if(this.mainPanel.type=="message"){this.mainPanel.messageGrid.clearGroupFilter(this.level);
this.mainPanel.messageGrid.reload({page:1})
}}}this._ignore_selection_change=false;
this._selected_before_reload=null
}}},getExtraParams:function(){if(!this.mainPanel){return
}var f=this.mainPanel.getFilter({extraParams:true,nextFilters:this.nextFilters});
f.group_by=this.groupByCode;
var a=[];
var d=false;
for(var b=0;
b<this.gridPanel.headerCt.items.getCount();
b++){var c=this.gridPanel.headerCt.items.get(b);
if(!c.hidden&&c.dataIndex){a.push(c.dataIndex);
if(c.dataIndex.match("_perc95")||c.dataIndex.match("_perc99")){d=true
}}}f.needColumns=Ext.encode(a);
if(d){f.needPercentile=1
}return(f)
},onSelectionChange:function(a){if(!this.mainPanel){return
}if(this._ignore_selection_change||!this.mainPanel.groupPanel){return
}this._loading_clear_select=false;
var b=this.gridPanel.selModel.getSelection();
if(!this._selection_old||this._selection_old!=(b&&b.length&&b[0].data?b[0].data[this.gridPanel.groupByFilterField]:-1)){if(b&&b.length){if(this.level){this.mainPanel.cdrGrid.clearGroupFilter(this.level)
}if(this.mainPanel.type=="cdr"){this.mainPanel.cdrGrid.setGroupFilter(this.gridPanel.groupByFilterName,b[0].data[this.gridPanel.groupByFilterField]==""&&this.gridPanel.groupByFilter_enableNullValue?"NULL":b[0].data[this.gridPanel.groupByFilterField],true,this.level)
}else{if(this.mainPanel.type=="message"){this.mainPanel.messageGrid.setGroupFilter(this.gridPanel.groupByFilterName,b[0].data[this.gridPanel.groupByFilterField]==""&&this.gridPanel.groupByFilter_enableNullValue?"NULL":b[0].data[this.gridPanel.groupByFilterField],true,this.level)
}}if(this.level){this.parentGrid.panel.deselectAllInNextLevel(this.parentRecord,true);
this.autoSelectParent()
}else{this.deselectAllInNextLevel(b[0],true)
}this.reloadMainGrid(true)
}else{if(this._loading){this._loading_clear_select=true
}else{if(this.mainPanel.type=="cdr"){this.mainPanel.cdrGrid.clearGroupFilter(this.level)
}else{if(this.mainPanel.type=="message"){this.mainPanel.messageGrid.clearGroupFilter(this.level)
}}this.reloadMainGrid(true)
}}}if(!this._loading_clear_select){this._selection_old=b&&b.length&&b[0].data?b[0].data[this.gridPanel.groupByFilterField]:-1
}},addIpToHostname:function(d,a,c){var b=Ext.create("Tools.HostnameTable.Grid",{withoutGrid:true,fpConfig:{listeners:{afterrender:function(f){b.getField("ip").setValue(d);
if(a){b.getField("name").setValue(a)
}b.setReadOnly("ip",true);
Ext.defer(function(){b.getField("name").focus(false,200)
},200)
}}},newText:findLangS(this.subsystem,"grid","newIpLookup")});
if(a){b.newText=findLangS(this.subsystem,"grid","editIpLookup");
b.loadRecordByParams({ip:d},function(f,g){b.createEditWindow(0,null,{record:f.getAt(0),onSubmitSuccess:function(h){if(c){c.store.load()
}},onSubmitSuccessScope:this})
},this)
}else{b.createEditWindow(1,null,{onSubmitSuccess:function(f){if(c){c.store.load()
}},onSubmitSuccessScope:this})
}},getType:function(a){if(!a){a=this
}return(a.type=="cdr"||a.mainPanel&&(a.mainPanel.type=="cdr"||a.mainPanel.cdrGroupRecord)?"cdr":a.type=="message"||a.mainPanel&&(a.mainPanel.type=="message"||a.mainPanel.messageGroupRecord)?"message":null)
}});
Ext.define("GroupStat.ChartTopCalls.Panel",{extend:"Ext.Panel",subsystem:"group_stat",constructor:function(b){var f=[];
var a=["sip_src_ip","sip_dst_ip"];
if(b.mainPanel.type=="cdr"||b.mainPanel.cdrGroupRecord){a.push("rtp_src_ip","rtp_dst_ip","src_phone_num","dst_phone_num","a_ua","b_ua");
if(window.existsCdrCountryCode){a.push("country_by_caller","country_by_called","country_by_sipcallerip","country_by_sipcalledip")
}}else{if(b.mainPanel.type=="message"||b.mainPanel.messageGroupRecord){a.push("src_phone_num","dst_phone_num");
if(window.existsMessageCountryCode){a.push("country_by_caller","country_by_called","country_by_sipcallerip","country_by_sipcalledip")
}}}var d=[];
for(var c=0;
c<a.length;
c++){d.push([a[c],this.findLangS("menu",a[c])])
}this.comboMenuGroupBy=new Ext.ux.combobox.ComboBoxA({xtype:"ComboBoxA",aData:d,listeners:{scope:this,select:this.doChart},width:__width_ColumnChar(40),listConfig:{maxHeight:Ext.dom.Element.getViewportHeight()/3-60}});
this.comboTypeChart=null;
if(b.mainPanel.type=="cdr"||b.mainPanel.cdrGroupRecord){this.comboTypeChart=new Ext.ux.combobox.ComboBoxA({xtype:"ComboBoxA",aData:[["run",findLangS(this.subsystem,"chart","callDistribution_run")],["begin",findLangS(this.subsystem,"chart","callDistribution_begin")],["end",findLangS(this.subsystem,"chart","callDistribution_end")]],listeners:{scope:this,select:this.doChart},width:__width_ColumnChar(10)})
}this.fieldMaxGraphs=new Ext.form.field.Number({value:5,listeners:{scope:this,select:this.doChart,change:this.doChart},width:__width_ColumnChar(4),minValue:2,maxValue:9});
f.push({xtype:"displayfield",value:this.findLangS("text","groupBy")+":",fieldCls:"x-toolbar-text"},this.comboMenuGroupBy);
if(this.comboTypeChart){f.push({xtype:"displayfield",value:this.findLangS("text","typeChart")+":",fieldCls:"x-toolbar-text"},this.comboTypeChart)
}f.push({xtype:"displayfield",value:this.findLangS("text","maxGraphs")+":",fieldCls:"x-toolbar-text"},this.fieldMaxGraphs);
this.chartContainer=new Ext.Panel({layout:"fit",border:false});
Ext.applyIf(b,{layout:"fit",tbar:f,items:this.chartContainer,border:false,listeners:{scope:this,afterrender:function(){Ext.defer(function(){this.comboMenuGroupBy.setValue("sip_src_ip");
if(this.comboTypeChart){this.comboTypeChart.setValue("run")
}this.doChart()
},200,this)
}}});
this.callParent([b])
},doChart:function(){this._doChart({groupBy:this.comboMenuGroupBy.getValue(),typeChart:this.comboTypeChart?this.comboTypeChart.getValue():"run",maxGraphs:this.fieldMaxGraphs.getValue()})
},_doChart:function(d){if(d.records){this.chartContainer.removeAll();
var b=GroupStat.Charts.getChartConfig({typeChart:this.mainPanel.type=="cdr"||this.mainPanel.cdrGroupRecord?"topCallDistribution":this.mainPanel.type=="message"||this.mainPanel.messageGroupRecord?"topCallDistribution_msg":null,params:d,groupByData:this.groupByData,dateFrom:this.mainPanel.getDateFrom(),dateTo:this.mainPanel.getDateTo(),filters:this.mainPanel.getChartFilter()});
if(d.startSecTimeMask){b.startSecTimeMask=d.startSecTimeMask
}var c=this.findLangS("title",this.mainPanel.type=="cdr"||this.mainPanel.cdrGroupRecord?"topCallDistribution":this.mainPanel.type=="message"||this.mainPanel.messageGroupRecord?"topCallDistribution_msg":null);
if(d.groupBy&&this.findLangS("menu",d.groupBy)){c+=" / "+this.findLangS("menu",d.groupBy)
}if(d.typeChart&&this.findLangS("chart","callDistribution_"+d.typeChart)){c+=" - "+this.findLangS("chart","callDistribution_"+d.typeChart)
}this.chartPanel=new CDR.Chart.ChartPanel({_enableBtnTracker:false,_enableBtnEdit:false,_enableBtnRemove:false,_enableBtnUndock:true,undockTitle:c,_disableAlertInvalidQuery:true,height:500});
Ext.defer(function(){this.chartContainer.unmask();
this.chartPanel.loadChart(b,false,{fceOkQuery:function(){this.chartContainer.unmask()
},fceOkQueryScope:this,fceInvalidQuery:function(){this.chartContainer.unmask()
},fceInvalidQueryScope:this})
},100,this);
this.chartContainer.add(this.chartPanel)
}else{if(this.store){delete this.store
}var a="topCallDistributionModel";
if(!Ext.ClassManager.isCreated(a)){Ext.define("topCallDistributionModel",{extend:"Ext.data.Model",fields:this.mainPanel.type=="cdr"||this.mainPanel.cdrGroupRecord?rsCDR_stats:this.mainPanel.type=="message"||this.mainPanel.messageGroupRecord?rsMessage_stats:null,idProperty:"id"})
}var f=this.mainPanel.getFilter({extraParams:true});
f.group_by=this.groupByData[d.groupBy].code;
f.task="LISTING";
f.module=this.mainPanel.type=="cdr"||this.mainPanel.cdrGroupRecord?"CDR_stats":this.mainPanel.type=="message"||this.mainPanel.messageGroupRecord?"message_stats":null;
this.store=new Ext.data.Store({storeId:"topCallDistributionStore",model:a,proxy:{type:"ajax",url:"php/model/sql.php",timeout:60*60*1000,actionMethods:"POST",extraParams:f,reader:{rootProperty:"results",totalProperty:"total",idProperty:"id"}},pageSize:-1});
this.store.on("beforeload",function(g){beginLoadMaskWithStopButton_store(g,"chartTopCalls_loadMask",true);
this.chartContainer.getEl().mask(getLoadMaskWithStopButton_loading_text("chartTopCalls_loadMask",true),"x-mask-loading")
},this);
this.store.on("load",function(h,g,m,k){var l=h._loadMask&&h._loadMask.secTime||0;
endLoadMaskWithStopButton_store(h);
this.chartContainer.getEl().unmask();
if(m&&g&&g.length){this._doChart(Ext.apply({records:g,startSecTimeMask:l},d))
}},this);
this.store.proxy.on("exception",function(){this.chartContainer.getEl().unmask()
},this);
this.store.load()
}},reload:function(){this.doChart()
}});
Ext.define("GroupStat.GridTopCalls.GridExpPanel",{extend:"Ext.Panel",subsystem:"group_stat",constructor:function(b){var a=[];
if(b.mainPanel.type=="cdr"||b.mainPanel.cdrGroupRecord){a.push({text:this.findLangS("title","topCalls"),closable:false,_id:"topCalls"});
if(window.rtpQualityUse){a.push({text:this.findLangS("title","callQuality"),closable:false,_id:"callQuality"})
}a.push({text:this.findLangS("title","callDistribution"),closable:false,_id:"callDistribution"},{text:this.findLangS("title","packetLossDistribution"),closable:false,_id:"packetLossDistribution"},{text:this.findLangS("title","jitterDistribution"),closable:false,_id:"jitterDistribution"},{text:this.findLangS("title","pdvDistribution"),closable:false,_id:"pdvDistribution"});
if(!b.mainPanel.disableFilteredCdr){a.push({text:this.findLangS("title","cdr"),closable:false,_id:"cdr"})
}}else{if(b.mainPanel.type=="message"||b.mainPanel.messageGroupRecord){a.push({text:this.findLangS("title","topCalls_msg"),closable:false,_id:"topCalls"},{text:this.findLangS("title","callDistribution_msg"),closable:false,_id:"callDistribution_msg"})
}}this.tabBar=new Ext.tab.Bar({dock:"top",plain:true,border:false,bodyBorder:false,cls:"group_stat-cell expander-area-panel",items:a,listeners:{scope:this,change:this.onChangeTab},activeTab:0,renderTpl:__tpl_simplyTabPanel});
this.contentContainer=new Ext.Panel({border:false,layout:"fit",style:__style_SubgridBorder(),flex:1});
Ext.applyIf(b,{layout:{type:"vbox",align:"stretch"},items:[this.tabBar,this.contentContainer],border:false,height:400,listeners:{scope:this,afterrender:this.onAfterRender}});
this.callParent([b])
},onAfterRender:function(){Ext.defer(function(){this.tabBar.setActiveTab(this.tabBar.items.get(0))
},200,this)
},onChangeTab:function(a,b){this.contentContainer.maskLoad();
var c={};
c[this.grid.groupByFilterName]=this.record.data[this.grid.groupByFilterField];
Ext.defer(function(){this.contentContainer.removeAll();
switch(b._id){case"topCalls":case"cdr":this.createGrid({typeGrid:b._id,nextFilters:c});
break;
default:this.createChart({typeChart:b._id,nextFilters:c,undockTitle:b.text});
break
}},200,this)
},createChart:function(a){if(this.mainPanel.type=="cdr"||this.mainPanel.cdrGroupRecord){var b=this.grid.panel.mainPanel.getChartFilter({nextFilters:a.nextFilters,enableGroupFilters:true})
}else{if(this.mainPanel.type=="message"||this.mainPanel.messageGroupRecord){var b=this.grid.panel.mainPanel.getChartFilter({nextExtraParams:a.nextFilters,enableGroupFilters:true})
}}var c=GroupStat.Charts.getChartConfig({typeChart:a.typeChart,dateFrom:this.grid.panel.mainPanel.getDateFrom(),dateTo:this.grid.panel.mainPanel.getDateTo(),filters:b,nextFilters:a.nextFilters});
this.chartPanel=new CDR.Chart.ChartPanel({_enableBtnTracker:false,_enableBtnEdit:false,_enableBtnRemove:false,_enableBtnUndock:true,undockTitle:a.undockTitle,_disableAlertInvalidQuery:true,height:500});
Ext.defer(function(){this.contentContainer.unmask();
this.chartPanel.loadChart(c,false,{fceOkQuery:function(){this.contentContainer.unmask()
},fceOkQueryScope:this,fceInvalidQuery:function(){this.contentContainer.unmask();
this.contentContainer.removeAll(true);
this.contentContainer.add({layout:{type:"vbox",align:"center",pack:"center"},border:false,items:{xtype:"displayfield",value:this.mainPanel.type=="message"?CDR.Chart.ChartPanel.prototype.LmsgInvalidQueryDescr_messages:CDR.Chart.ChartPanel.prototype.LmsgInvalidQueryDescr,fieldStyle:{"font-weight":"bold","font-size":"120%"}},height:100})
},fceInvalidQueryScope:this})
},100,this);
this.contentContainer.add(this.chartPanel)
},createGrid:function(a){switch(a.typeGrid){case"topCalls":this.gridPanel_topCalls=new GroupStat.GridTopCalls.Panel({level:2,type:this.grid.panel.mainPanel.type,groupBy:this.grid.panel.groupByData[this.grid.panel.groupBy].topCalls_group2,disableExpander:true,disableColumnsConfiguration:true,groupByData:this.grid.panel.mainPanel.groupByData,nextFilters:a.nextFilters,mainPanel:this.grid.panel.mainPanel,parentGrid:this.grid,parentGridPanel:this.grid.panel,parentRecord:this.record});
this.contentContainer.add(this.gridPanel_topCalls);
this.contentContainer.unmask();
break;
case"cdr":this.gridPanel_cdr=new CDR.Grid({layout:"fit",id:"filteredCdr",disableCharts:true,disableMenu:true,pageSize:15,loadAtInit:false,disableAutoLoad:true,border:false});
this.contentContainer.add(this.gridPanel_cdr);
this.contentContainer.unmask();
var b=this.grid.panel.mainPanel.getFilter({nextFilters:a.nextFilters});
this.gridPanel_cdr.setCustomFilter(b,null,true);
break
}}});
Ext.define("GroupStat.Charts",{subsystem:"group_stat",singleton:true,getChartConfig:function(v){var b=[];
var q=null;
var p=null;
var n=null;
var t=null;
var r=null;
var k=null;
var c="CDR";
var a=true;
switch(v.typeChart){case"distribution":case"callDistribution":b.push({chartType:"TCH_count",varName:"s_count_all",color:"#AAAAAA",baseType:"line",fill:true,lineType:"solid",lineWidth:1,smooth:false,title:findLangS(this.subsystem,"chart","callDistribution_run")},{chartType:"TCH_count",varName:"s_count_all_fi",color:"#00FF00",baseType:"bar",lineType:"dotted",fill:true,opacity:100,title:findLangS(this.subsystem,"chart","callDistribution_begin")},{chartType:"TCH_count",varName:"s_count_all_li",color:"#0000FF",baseType:"bar",lineType:"dotted",fill:true,opacity:100,title:findLangS(this.subsystem,"chart","callDistribution_end")});
q=[{type:"line",xField:"x",yField:["y_s_1"],axis:"left",fill:true,markerConfig:{radius:0,size:0},smooth:false,stacked:false,style:{lineWidth:2,lineDash:[2,2],fill:lightColor("#AA88FF"),stroke:"#AA88FF"},title:findLangS(this.subsystem,"chart","callDistribution_run")},{type:"bar",xField:"x",yField:["y_s_2","y_s_3"],axis:"left",highlight:false,stacked:false,style:{minGapWidth:1,inGroupGapWidth:0},colors:["#00A7E3","#00719A"],renderer:function(C,A,E,z){var D=C._field;
var B=this._yField.indexOf(D);
var y=this._colors[B];
C.setAttributes({fill:y,stroke:y});
return({fillStyle:y,strokeStyle:y})
},getLegendColor:function(y){return(this.config.colors[y])
},title:[findLangS(this.subsystem,"chart","callDistribution_begin"),findLangS(this.subsystem,"chart","callDistribution_end")]}];
r=findLangS(this.subsystem,"chart","callDistribution");
t="CdrChartLine";
break;
case"distribution_msg":case"callDistribution_msg":b.push({chartType:"TCH_count",varName:"s_count_all",title:findLangS(this.subsystem,"chart","callDistribution_msg")});
q=[{type:"bar",xField:"x",yField:["y_s_1"],axis:"left",highlight:false,stacked:false,colors:["#00A7E3"],renderer:function(C,A,E,z){var D=C._field;
var B=this._yField.indexOf(D);
var y=this._colors[B];
C.setAttributes({fill:y,stroke:y});
return({fillStyle:y,strokeStyle:y})
},getLegendColor:function(y){return(this.config.colors[y])
},title:[findLangS(this.subsystem,"chart","callDistribution_msg")],style:{minGapWidth:1}}];
r=findLangS(this.subsystem,"chart","callDistribution_msg");
t="CdrChartLine";
c="MESSAGES";
a=false;
break;
case"mos_intervals":case"callQuality":p="TCH_mos_intervals";
n=true;
break;
case"topCallDistribution":case"topCallDistribution_msg":if(v.typeChart=="topCallDistribution_msg"){c="MESSAGES"
}var h=[];
var w=[];
for(var m=0;
m<Math.min(v.params.records.length,v.params.maxGraphs);
m++){var u=v.params.records[m].data;
var g=v.groupByData[v.params.groupBy].filterField;
var s=u[g];
var f=v.groupByData[v.params.groupBy].chartField||g;
var o=u[f];
var d={};
if(v.typeChart=="topCallDistribution"){d[v.groupByData[v.params.groupBy].filter2field]=s;
d[v.groupByData[v.params.groupBy].filter2field2]=1
}else{if(v.typeChart=="topCallDistribution_msg"){d[v.groupByData[v.params.groupBy].filter2field_msg]=s;
d[v.groupByData[v.params.groupBy].filter2field2_msg]=1
}}b.push({chartType:"TCH_count",varName:v.params.typeChart=="run"?"s_count_all":v.params.typeChart=="begin"?"s_count_all_fi":"s_count_all_li",baseType:"line",fill:true,lineType:"solid",lineWidth:1,smooth:false,filter:d});
h.push("y_s_"+(m+1));
debug_log(s);
debug_log(o);
w.push(o)
}q=[{type:"bar",xField:"x",yField:h,axis:"left",highlight:false,stacked:true,colors:["#94ae0a","#115fa6","#a61120","#ff8809","#ffd13e","#a61187","#24ad9a","#7c7474","#a66111"],renderer:function(C,A,E,z){var D=C._field;
var B=this._yField.indexOf(D);
var y=this._colors[B];
C.setAttributes({fill:y,stroke:y});
return({fillStyle:y,strokeStyle:y})
},getLegendColor:function(y){return(this.config.colors[y])
},title:w,style:{minGapWidth:1}}];
break;
case"packetLoss":case"packetLossDistribution":p="TCH_packet_lost_intervals";
n=true;
break;
case"mos":case"mosDistribution":p="TCH_mos_intervals";
n=true;
break;
case"jitter":case"jitterDistribution":p="TCH_jitter_intervals";
n=true;
break;
case"pdv":case"pdvDistribution":p="TCH_delay";
break
}if(p){b=this.getSeriesFromDefChartTypes(p);
t=arCdrChart_defChartTypes[p].theme;
r=arCdrChart_defChartTypes[p].axisTitleLeft;
k=arCdrChart_defChartTypes[p].axisTitleRight
}if(n){for(var m=0;
m<b.length;
m++){Ext.applyIf(b[m],{baseType:"area",multiSeries:true,sideAxis:"left"})
}}else{for(var m=0;
m<b.length;
m++){Ext.applyIf(b[m],{baseType:"line",fill:false,lineType:"solid",markers:false,multiSeries:null,param:"",paramSeries:null,primaryAxis:false,sideAxis:"left",smooth:true,color:"#000000",titleBase:b[m].title})
}}var l={_typeChart:c,series:b,title:"",axisTitleLeft:r,axisTitleRight:k,chartType:null,dateFrom:v.dateFrom,dateTo:v.dateTo,filters:v.filters,filtersFromParent:null,legendPosition:null,title:"none",theme:t,defSeries:q,legendPosition:a?"top":"none"};
return(l)
},getSeriesFromDefChartTypes:function(b){if(!arCdrChart_defChartTypes[b]){return
}var f=arCdrChart_defChartTypes[b].series;
var d=[];
for(var c=0;
c<f.length;
c++){var g=f[c].series;
var a=arCdrChart_chartSeriesTypes[getDataArrayIndex(arCdrChart_chartSeriesTypes,g)];
d.push({chartType:a[4],series:g,varName:a[5],color:f[c].color,title:a[2],multiSeriesIntervals:a.length>=9?a[8]:undefined})
}return(d)
}});
Ext.define("GroupStat.RtpStat.Panel",{extend:"Ext.Panel",subsystem:"group_stat",constructor:function(c){this.typeBar=new Ext.tab.Bar({dock:"top",plain:true,border:false,bodyBorder:false,style:{"background-color":__color_PanelBackgroud},listeners:{scope:this,change:a},renderTpl:__tpl_simplyTabPanel});
for(var d=0;
d<arChart3D_rtp_stat.length;
d++){this.typeBar.add({text:arChart3D_rtp_stat[d][1],_type:arChart3D_rtp_stat[d][0],closable:false})
}this.contentContainer=new Ext.Panel({layout:"fit",border:false,flex:1,disabled:true});
c=Ext.applyIf(c||{},{layout:{type:"vbox",align:"stretch"},items:[this.typeBar,this.contentContainer],border:false,listeners:{scope:this,activate:f,afterrender:b}});
this.callParent([c]);
function f(){if(!this.firstActivate){Ext.defer(function(){this.typeBar.setActiveTab(this.typeBar.items.get(0))
},50,this);
this.firstActivate=true
}}function b(){f.call(this)
}function a(g,h){this.selectChartTab=h;
this.createChart(h)
}},createChart:function(a){this.contentContainer.maskLoad();
if(this.chart){this.chart.destroy();
delete this.chart;
this.contentContainer.removeAll();
this.contentContainer.disable()
}var c=window.activePanel.id;
this.chart=new Ext.Chart3D.rtp_stat({typeChart:a._type,enable_dns_ip_lookup:true,enable_context_mos_jitter_loss:true,enable_context_cdr_filter:true,_rtpStat_panel:this,onLoadData:{scope:this,success:function(d){this.contentContainer.unmask();
if(d.empty){this.contentContainer.disable()
}else{this.contentContainer.enable()
}},error:function(d,f){this.contentContainer.unmask();
this.contentContainer.disable()
}},enableRefresh:function(){return(c==window.activePanel.id)
}});
var b=this;
this.chart.createChart(function(){b.chart.startLoadInterval(10000)
});
this.contentContainer.add(this.chart.chart)
},reload:function(){if(this.chart){this.chart.loadData()
}}});
Ext.ns("SPY");
Ext.define("SPY.Grid",{extend:"Ext.grid.GridPanel",alias:"widget.SPYX",subsystem:"activecalls",constructor:function(b){var a="SPY_model";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:rsSPY,idProperty:"id"})
}var d=new Ext.data.Store({id:"SPYstore",storeId:"SPYstore",model:a,proxy:{type:"ajax",url:"php/model/sql.php",actionMethods:"POST",extraParams:{task:"LISTING",module:"SPY",international:undefined,sensor_id:b._panel.sensorId},reader:{rootProperty:"results",totalProperty:"total",idProperty:"id",keepRawData:true},listeners:{scope:this,exception:function(h,g,f){this.setError(getStringStoreException(h,g,f))
}}},pageSize:30,sortInfo:{property:"ID",direction:"DESC"},remoteSort:true});
Ext.apply(b,{store:d,columns:{items:this.getColumns(),defaults:{sortable:false}},selModel:{mode:"SINGLE"},border:false,viewConfig:{enableTextSelection:true,getRowClass:function(f,g){switch(f.data.disposition){case"ANSWERED":return"row-green-bg";
case"NO ANSWER":return"row-red-bg"
}},scrollToTop:Ext.emptyFn,listeners:{scope:this,cellcontextmenu:c,bodyscroll:function(){this._scrollTop=this.view.getEl().dom.scrollTop;
this._scrollTopCurrentPage=this.store.currentPage
}},loadMask:true}});
this.callParent([b]);
function c(q,r,o,m,s,p,g){if(isClipboardCopySupport()){var f=this;
var n=o;
g.stopEvent();
var m=this.store.getAt(p);
var l=this.getColumnManager().getColumns();
var k=l[n];
var h=new Ext.menu.Menu({items:getCellContextClipboardMenuItems.call(this,p,n,m,k)});
h.showAtMouse(g)
}}},getColumns:function(){var b=[{headerLang:"sensor",dataIndex:"id_sensor",width:60,align:"center",renderer:function(l,d,g,m,k,h){var f="";
if(l>0){f+=l.toString()
}if(g.data.sensor_name){if(f){f+="<br>"
}f+=g.data.sensor_name
}if(g.data.sensor_color_background){d.style="background-color: "+g.data.sensor_color_background
}return f
}},{headerLang:"time",dataIndex:"calldate",width:window.time_precision_cdr_in_ms?80:60,align:"center"},{dataIndex:"duration",width:60,align:"center",renderer:function(k,d,f,l,h,g){if(f.data.connect_duration){k+="<br>"+f.data.connect_duration
}return k
}},{header:this.codecText,dataIndex:"callercodec",width:60,align:"center"},{dataIndex:"caller",width:100,align:"center",renderer:function(k,d,f,l,h,g){if(f.data.callerdomain){k+="<br>"+f.data.callerdomain
}return k
}},{dataIndex:"called",width:100,align:"center",renderer:function(k,d,f,l,h,g){if(f.data.calleddomain){k+="<br>"+f.data.calleddomain
}return k
}},{headerLang:"callerip",dataIndex:"callerip2",width:enableSqlIpReverseLookup||enableIpReverseLookup?120:100,align:enableSqlIpReverseLookup||enableIpReverseLookup?"left":"right"},{headerLang:"calledip",dataIndex:"calledip2",width:enableSqlIpReverseLookup||enableIpReverseLookup?120:100,align:enableSqlIpReverseLookup||enableIpReverseLookup?"left":"right"},{headerLang:"calleragent",dataIndex:"calleragent",width:120,align:"left"},{headerLang:"calledagent",dataIndex:"calledagent",width:120,align:"left"},{headerLang:"callername",dataIndex:"callername",width:80,align:"left"}];
if(window.existsCdrProxy){b.push({headerLang:"sipproxies",dataIndex:"sipproxies",width:60,align:"right"})
}b.push({dataIndex:"lastSIPresponseNum",width:60,align:"right"});
var c=getDataCdrCustomHeaders();
if(c){for(var a=0;
a<c.length;
a++){if(c[a].show_as_column_spy*1){b.push({dataIndex:c[a]._column_unique,header:c[a].name,width:c[a].width_column_spy*1||100,renderer:function(d){return(renderStringStyle(d,{forceMultiLine:true}))
}})
}}}b.push({dataIndex:"menu",width:80,align:"right",noCopyToClipboard:true,renderer:function(k,d,f,l,h,g){return k&&k.replaceall("__THIS_ID__",this.id)||"&nbsp;"
}});
for(var a=0;
a<b.length;
a++){if(!b[a].header){b[a].header=this.findLangS("column",b[a].headerLang||b[a].dataIndex)
}}return(b)
},reconfigureColumns:function(){this.reconfigure(this.store,this.getColumns());
this.applyConfig()
},onLoadStore:function(b,a,f){if(!b||!b.proxy){return
}this.evaluateError(b,a,f);
if(f){if(this.store.currentPage>1&&(this.store.currentPage-1)*this.store.pageSize>this.store.totalCount){this.store.currentPage=1;
this.store.fireEvent("load")
}var d=null;
if(this.selectionRecordData&&a&&a.length){for(var c=0;
c<a.length;
c++){if(a[c].data.id_sensor==this.selectionRecordData.id_sensor&&a[c].data.caller==this.selectionRecordData.caller&&a[c].data.called==this.selectionRecordData.called&&a[c].data.callerip==this.selectionRecordData.callerip&&a[c].data.calledip==this.selectionRecordData.calledip){d=a[c];
break
}}}if(d){this.getSelectionModel().select(d)
}else{if(this._scrollTop){if(this._scrollTopCurrentPage==this.store.currentPage){this.view.getEl().dom.scrollTop=this._scrollTop
}else{this._scrollTop=null
}if(this.selectionRecordData){this.deleteSelectionRecord()
}}}if(this.store.currentPage!=this.store.proxy.reader.rawData.page){this.store.currentPage=this.store.proxy.reader.rawData.page;
this._panel.pagingToolbar.onLoad(this.store)
}}this.deleteSelectionRecord()
},onBeforeLoadStore:function(a){var b=this.getSelectionModel().getSelection();
if(b&&b.length==1&&b[0].data){this.setSelectionRecord({id_sensor:b[0].data.id_sensor,caller:b[0].data.caller,called:b[0].data.called,callerip:b[0].data.callerip,calledip:b[0].data.calledip})
}},setSelectionRecord:function(a){this.selectionRecordData=a;
this._panel.setExtraParam("selectionRecord",Ext.encode(a))
},deleteSelectionRecord:function(){if(this.selectionRecordData){delete this.selectionRecordData;
this._panel.clearExtraParam("selectionRecord")
}},deselectAll:function(){this.getSelectionModel().deselectAll()
},evaluateError:function(d,c,h){if(h){var a=true;
var g="";
var b=d.proxy.reader.rawData.rsltSensors;
if(!isDataEmpty(b)){for(var f in b){if(!b[f]["success"]){a=false;
if(g){g+=" , &nbsp;&nbsp;"
}g+=(b[f]["name"]&&b[f]["name"]!=b[f]["host"]?b[f]["name"]+" - ":"")+b[f]["host"]+"&thinsp;:&thinsp;"+(b[f]["port"]||"undefined")+" - "+(b[f]["error"]||"unknown error")
}}}if(c&&c.length){this.clearError()
}if(!c||!c.length){if(a){this.setError(this.findLangS("text","noActiveCalls"),"#00D000")
}else{this.setError(g)
}}else{if(!a){this.setError(g,"#CEB600")
}}}},clearError:function(){if(this.errorPanel){this.errorPanel.setHeight(0)
}},setError:function(b,a){if(b==getStringAjaxFailure_errorIsNotSpecified()){b=findLangSd("grid","connectionToServerLost")
}b+=" - "+findLangSd("grid","tryingAgaing");
if(!a){a="red"
}if(this.errorPanel){this.errorPanel.setHeight(20);
this.errorPanel.items.get(0).setValue(b);
this.errorPanel.body.setStyle({"background-color":a})
}else{this.errorPanel=new Ext.Panel({border:false,height:20,bodyStyle:{"background-color":a},items:{xtype:"displayfield",value:b,fieldStyle:{font:"bold 11px tahoma,arial,verdana,sans-serif",color:"white"},style:{marginLeft:5,"white-space":"nowrap"}},dock:"top"})
}this.addDocked(this.errorPanel)
},liveplay:function(c,b){if(!window.AudioContext&&!window.webkitAudioContext||!window.requestAnimationFrame){Ext.Msg.alert(lang.compatibilityProblem,"Your web browser does not implemented the necessary modules. We recommend to use actual version Google chrome or Mozilla Firefox.");
return
}this.prepareChunkPlayer=true;
var a=user_id()+"_"+time_sec(new Date)+"_"+Math.ceil(Math.random()*100);
ajaxSafeRequest({scope:this,url:"php/model/sql.php?module=SPY&task=SPYCALL&sensor_id="+c+"&callref="+b+"&listen_id="+a,success:function(d){var f=window.existsSox?Tools.ChunkPlayer:Tools.ChunkPlayer_old;
this.chunkPlayer=new f({mode:"live",stereo:false,url:"php/model/sql.php?module=SPY&task=READAUDIO&sensor_id="+c+"&callref="+b+"&listen_id="+a+(!window.existsSox?"&old_player=1":""),urlClose:"php/model/sql.php?module=SPY&task=SPYCALL&stop=1&sensor_id="+c+"&callref="+b+"&listen_id="+a,listen_id:a})
},error:function(d,f){if(getStringAjaxError(d)=="liveaudio is disabled"){Ext.Msg.alert("",this.findLangS("text","liveaudioIsDisabled"))
}else{alertAjaxError(f)
}}});
this.prepareChunkPlayer=false
}});
Ext.define("SPY.Charts.calls_per_ip",{subsystem:"activecalls",constructor:function(a){this.store=[];
this.chart=[];
for(var b=0;
b<2;
b++){this.store[b]=new Ext.data.ArrayStore({fields:["descr","total"],data:[]});
this.chart[b]=new Ext.chart.CartesianChart({xtype:"cartesian",flipXY:true,store:this.store[b],shadow:false,animation:false,border:false,axes:[{type:"numeric",position:"bottom",fields:["total"],grid:true,minimum:0,title:findLangS(this.subsystem,"title",b==0?"recordsByCallerIP":"recordsByCalledIP"),_decPrecision:0,_maxTickSteps:20,renderer:function(f,d,c,g){return(roundNumber(d,0))
}},{type:"category",position:"left",fields:["descr"]}],theme:"SpyBar",series:[{type:"bar",xField:"descr",yField:["total"],highlight:false,label:{display:"insideEnd",field:"total",orientation:"horizontal",color:"#333","text-anchor":"middle",renderer:function(c){return(roundNumber(c,0))
}}}],hidden:true})
}this.storeComb=new Ext.data.ArrayStore({fields:["descr","total_src","total_dst","total"],data:[]});
this.chartComb=new Ext.chart.CartesianChart({xtype:"cartesian",flipXY:true,store:this.storeComb,shadow:false,animation:false,border:false,legend:{docked:"right",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:2},axes:[{type:"numeric",position:"bottom",fields:["total_src","total_dst"],grid:true,minimum:0,_decPrecision:0,_maxTickSteps:20,renderer:function(f,d,c,g){return(roundNumber(d,0))
}},{type:"category",position:"left",fields:["descr"]}],theme:"SpyBar",series:[{type:"bar",xField:"descr",yField:["total_src","total_dst"],title:[findLangS(this.subsystem,"title","caller"),findLangS(this.subsystem,"title","called")],highlight:false,stacked:true,label:{display:"insideEnd",field:["total_src","total_dst"],orientation:"horizontal",contrast:true,"text-anchor":"middle",renderer:function(c){return(c?roundNumber(c,0):null)
}}}],hidden:true});
this.panelChart=[];
this.panelChart[0]=new Ext.Panel({region:"west",border:false,margin:"0 2 0 0",width:"50%",layout:"fit",items:this.chart[0]});
this.panelChart[1]=new Ext.Panel({region:"center",border:false,margin:"0 0 0 2",width:"50%",layout:"fit",items:this.chart[1]});
this.panelChartComb=new Ext.Panel({region:"center",border:false,margin:"0 0 0 0",width:"100%",layout:"fit",items:this.chartComb});
Ext.applyIf(this,a)
},refreshCharts:function(g,m){if(!g||!g.srcIp||!g.dstIp||isDataEmpty(g.srcIp)||isDataEmpty(g.dstIp)){for(var h=0;
h<2;
h++){if(!this.chart[h].hidden){this.chart[h].hide()
}}if(!this.chartComb.hidden){this.chartComb.hide()
}return
}if(!m){if(!this.chartComb.hidden){this.chartComb.hide()
}for(var h=0;
h<2;
h++){if(this.chart[h].hidden){this.chart[h].show()
}}}else{for(var h=0;
h<2;
h++){if(!this.chart[h].hidden){this.chart[h].hide()
}}if(this.chartComb.hidden){this.chartComb.show()
}}if(!m){for(var h=0;
h<2;
h++){this.store[h].removeAll()
}}else{this.storeComb.removeAll()
}for(var h=0;
h<2;
h++){var n=h==0?g.srcIp:g.dstIp;
for(var f=0;
f<n.length;
f++){var l=n[f].descr;
var b=n[f].cnt;
if(!m){this.store[h].add({descr:l,total:b})
}else{var a=false;
for(var d=0;
d<this.storeComb.getCount();
d++){var c=this.storeComb.getAt(d);
if(c.data.descr==l){if(h==0){c.data.total_src+=b
}else{c.data.total_dst+=b
}c.data.total+=b;
a=true;
break
}}if(!a){this.storeComb.add({descr:l,total_src:h==0?b:0,total_dst:h==1?b:0,total:b})
}}}}if(m){this.storeComb.sort([{property:"total",direction:"ASC"}]);
while(this.storeComb.getCount()>15){this.storeComb.removeAt(0)
}}},show:function(b){if(b){this._panel.add(this.panelChartComb)
}else{for(var a=0;
a<2;
a++){this._panel.add(this.panelChart[a])
}}}});
Ext.define("SPY.Charts.realtime",{constructor:function(a){var b=false;
this.timeAxisConfig=b?{valueStep:2*1000,length:30*1000,typeStep:Ext.Date.SECOND,mainStepLength:2*1000}:{valueStep:2*1000,length:(a.chartLengthMinutes||30)*60*1000,typeStep:Ext.Date.MINUTE,mainStepLength:60*1000};
this.timeAxisConfig.typeStepLength=this.timeAxisConfig.typeStep==Ext.Date.MINUTE?60*1000:1000;
this.timeAxisConfig.fromTime=this.timeAxisConfig.typeStep==Ext.Date.MINUTE?timeMinuteFloor(new Date()):new Date(Math.floor(timeSecondFloor(new Date()).getTime()/this.timeAxisConfig.mainStepLength)*this.timeAxisConfig.mainStepLength);
this.timeAxisConfig.toTime=new Date(this.timeAxisConfig.fromTime.getTime()+this.timeAxisConfig.length);
this.chart_data={};
this.chart_series={};
this.chart_series_used=[];
this.store=null;
this.chart=null;
this.panelChart=new Ext.Panel({region:"center",border:false,margin:"0 0 0 0",width:"100%",layout:"fit"});
Ext.applyIf(this,a);
if(this.enableScheduler){this.loadScheduler_start()
}},show:function(){this._panel.add(this.panelChart)
},loadScheduler_start:function(a){this._loadScheduler_active=true;
if(a){loadScheduler_load()
}else{this.loadScheduler_setTimeout()
}},loadScheduler_stop:function(){this.loadScheduler_clearTimeout();
this._loadScheduler_active=false
},loadScheduler_load:function(){this.loadScheduler_clearTimeout();
this.load()
},loadScheduler_clearTimeout:function(){if(this._loadScheduler_timeoutId){clearTimeout(this._loadScheduler_timeoutId);
delete this._loadScheduler_timeoutId
}},loadScheduler_setTimeout:function(){this.loadScheduler_clearTimeout();
if(this._loadScheduler_active){this._loadScheduler_timeoutId=setTimeout(Ext.bind(this.loadScheduler_load,this),this.timeAxisConfig.valueStep)
}},load:function(a){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"realtimeCalls",params:a?Ext.encode(a):undefined},success:function(b){switch(this._type){case"sensors":this.addData(b.countCallsSensors);
break;
case"src_ip":this.addData(b.srcIp);
break;
case"dst_ip":this.addData(b.dstIp);
break
}this.loadScheduler_setTimeout();
if(this.onLoad){this.onLoad.call(this.onLoadScope)
}},error:function(){this.loadScheduler_setTimeout();
if(this.onError){this.onError.call(this.onLoadScope)
}},failure:function(){this.loadScheduler_setTimeout();
if(this.onFailure){this.onFailure.call(this.onLoadScope)
}},scope:this})
},addData:function(a){if(!a||isDataEmpty(a)){return
}var h=new Date;
var g=h.getTime();
var f={};
switch(this._type){case"sensors":for(var b in a){var k="sensor_"+b;
this.incSeriesData(k,a[b].name,a[b].color_chart||a[b].color_background,a[b].cnt);
f[k]=a[b].cnt
}break;
case"src_ip":case"dst_ip":for(var d=0;
d<a.length;
d++){var k="ip_"+ip_to_id(a[d].ip);
this.incSeriesData(k,a[d].hostnameShort||a[d].ip,null,a[d].cnt);
f[k]=a[d].cnt
}break
}this.chart_data[g]=f;
var c=this.getChartSeriesUsed();
if(!this.chart||!this.checkChartSeriesUsed(c)){this.destroyChart();
this.createStore(c);
this.fillStore();
this.createChart()
}else{this.addDataToStore(g,f)
}if(g>this.timeAxisConfig.toTime.getTime()){this.timeShift(h)
}},removeData:function(b){var a=this.chart_data[b];
for(var c in a){this.decSeriesData(c,a[c])
}delete this.chart_data[b]
},incSeriesData:function(d,c,a,b){if(Ext.isDefined(this.chart_series[d])){this.chart_series[d].cnt+=b
}else{this.chart_series[d]={description:c,color:a,cnt:b}
}},decSeriesData:function(b,a){if(Ext.isDefined(this.chart_series[b])){this.chart_series[b].cnt-=a;
if(this.chart_series[b].cnt<=0){delete this.chart_series[b]
}}},checkChartSeriesUsed:function(c){if(c.length!=this.chart_series_used.length){return(false)
}for(var b=0;
b<c.length;
b++){var d=false;
for(var a=0;
a<this.chart_series_used.length;
a++){if(c[b].id==this.chart_series_used[a].id){d=true
}}if(!d){return(false)
}}return(true)
},getChartSeriesUsed:function(){var a=[];
for(var b in this.chart_series){a.push({id:b,description:this.chart_series[b].description,color:this.chart_series[b].color,cnt:this.chart_series[b].cnt})
}switch(this._type){case"sensors":a.sort(function(d,c){return(d.description<c.description?-1:d.description>c.description?1:0)
});
break;
case"src_ip":case"dst_ip":a.sort(function(d,c){return(c.cnt-d.cnt)
});
while(a.length>15){a.splice(a.length-1)
}break
}return(a)
},createStore:function(c){this.chart_series_used=c;
if(this.store){this.store.removeAll();
delete this.store
}var a=[];
a.push({name:"time_int",type:"integer"},{name:"time",type:"date",dateFormat:__format_DateTimeDb});
for(var b=0;
b<this.chart_series_used.length;
b++){a.push({name:this.chart_series_used[b].id,type:"integer"})
}this.store=new Ext.data.JsonStore({fields:a,data:[]})
},fillStore:function(){for(var a in this.chart_data){this.addDataToStore(a,this.chart_data[a])
}},addDataToStore:function(c,b){var a={time_int:c*1,time:new Date(c*1)};
Ext.apply(a,b);
this.store.add(a)
},createChart:function(){this.chart=new Ext.chart.CartesianChart({store:this.store,series:this.createSeries(),axes:[this.createNumericAxis(),this.createTimeAxis()],legend:{docked:"right",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:2},border:false,theme:"CdrChartArea",animation:false,_getIndexNearPoint_toleranceX:60000});
this.panelChart.add(this.chart)
},destroyChart:function(){if(this.chart){this.chart.destroy();
delete this.chart
}},createSeries:function(){var d=[];
var c=[];
var b=[];
for(var a=0;
a<this.chart_series_used.length;
a++){d.push(this.chart_series_used[a].description);
c.push(this.chart_series_used[a].id);
b.push(this.chart_series_used[a].color)
}return({type:"area",title:d,xField:"time",yField:c,renderer:function(l,h,m,g){var k=this._yField.indexOf(l._field);
var f=this._data_colors[k];
if(f){l.setAttributes({fill:f,stroke:f})
}},getLegendColor:function(g){if(this._title){var h=g%this._title.length;
var f=this._data_colors[h];
if(f){return(f)
}}},_data_colors:b,tips:{trackMouse:true,renderer:function(s,m,q){var p="";
var h=null;
var f=null;
if(m.data.time){h=clone(m.data.time);
f=Ext.Date.format(h,__format_DateTime)
}var g=q.series._yField;
var n=0;
for(var l=0;
l<g.length;
l++){if(!q.series._title[l]||!q.record.data[g[l]]){continue
}if(!p){if(f){p+='<p style="font-weight: normal; color: black; margin: 0; padding-left: 3px; padding-bottom: 2px; white-space:nowrap;">'+f+"</p>"
}p+='<table style="font-size: 11;">'
}var k="#FFFFFF";
if(q.series._data_colors[l]){k=q.series._data_colors[l]
}else{if(q.series._chart.theme._colors){k=q.series._chart.theme._colors[l%q.series._chart.theme._colors.length]
}}p+="<tr>";
p+='<td style="color: '+lightColor(k,1,0.7)+'; white-space:nowrap;">';
p+="<b><i>"+q.series._title[l]+"</i></b>";
p+='<td style="text-align: right; padding-left: 20px; white-space:nowrap;">';
var o=q.record.data[g[l]];
p+="<b>"+o+"</b>";
n+=o
}p+="<tr>";
p+="<td>";
p+="<b>&sum;</b>";
p+='<td style="text-align: right; padding-left: 20px; white-space:nowrap;">';
p+="<b>"+n+"</b>";
if(p&&p.length){if(p&&p.length){p+="</table>"
}window.chartsTipCount=window.chartsTipCount?window.chartsTipCount+1:1;
Ext.defer(function(){if(window.chartsTipCount>0){--window.chartsTipCount
}},100,this);
if(window.chartsTipCount==1){var r=getSizeHtml(p);
s.setWidth(r[0]+10);
s.setHeight(r[1]+5);
s.setTitle(p)
}}else{s.setTitle(null)
}}}})
},createNumericAxis:function(){var b=[];
for(var a=0;
a<this.chart_series_used.length;
a++){b.push(this.chart_series_used[a].id)
}return({type:"numeric",position:"left",minimum:0,fields:b,grid:true,gridColor:"#F0F0F0",_decPrecision:0,_maxTickSteps:10,renderer:function(f,d,c,g){return(roundNumber(d))
}})
},createTimeAxis:function(){return({type:"time",position:"bottom",fields:"time",dateFormat:this.timeAxisConfig.typeStep==Ext.Date.MINUTE?"H:i":"i:s",step:[this.timeAxisConfig.typeStep,this.timeAxisConfig.mainStepLength/this.timeAxisConfig.typeStepLength],constrain:true,fromDate:this.timeAxisConfig.fromTime,toDate:this.timeAxisConfig.toTime,grid:true,gridColor:"#F0F0F0",label:{rotate:{degrees:-90}}})
},timeShift:function(c){c=this.timeAxisConfig.typeStep==Ext.Date.MINUTE?timeMinuteCeil(c):new Date(Math.ceil(timeSecondCeil(c).getTime()/this.timeAxisConfig.mainStepLength)*this.timeAxisConfig.mainStepLength);
var a=c.getTime()-this.timeAxisConfig.toTime.getTime();
this.timeAxisConfig.fromTime=new Date(this.timeAxisConfig.fromTime.getTime()+a);
this.timeAxisConfig.toTime=c;
while(this.store.getCount()&&this.store.getAt(0).data.time.getTime()<(this.timeAxisConfig.fromTime.getTime()-10*this.timeAxisConfig.mainStepLength)){this.store.removeAt(0)
}var b;
while((b=this.getFirstIndexInChartData())&&b<(this.timeAxisConfig.fromTime.getTime()-10*this.timeAxisConfig.mainStepLength)){this.removeData(b)
}this.setTimeForTimeAxis(this.timeAxisConfig.fromTime,this.timeAxisConfig.toTime)
},setTimeForTimeAxis:function(c,b){for(var a=0;
a<this.chart.axes.length;
a++){if(this.chart.axes[a].type=="time"){this.chart.axes[a].setFromDate(c);
this.chart.axes[a].setToDate(b);
break
}}},getFirstIndexInChartData:function(){for(var a in this.chart_data){return(a)
}return(null)
}});
Ext.define("SPY.Charts.Panel",{extend:"Ext.Panel",subsystem:"activecalls",constructor:function(b){this.activeChartType="calls_per_ip_stacked";
Ext.apply(b,{title:a()?undefined:(Ext.isIE?this.findLangS("title","activeCallsPerIP"):'<table cellspacing=0 cellpadding=0 style="position: relative; top: 0; height: 0;"><td><span class="x-panel-header-title-default">'+this.findLangS("title","charts")+'</span><td style="padding-left: 5;"><span id="chart_panel_title_items"></span></table>'),collapsible:a()?undefined:true,collapsedCls:"no-border",floatable:true,span:true,border:false,height:a()?"100%":"55%",layout:"border",listeners:{scope:this,afterrender:function(){if(!Ext.isIE&&!a()){this.btnSwitchTypeChart=new Ext.Button({text:this.findLangS("button","stackedChart"),pressed:true,enableToggle:true,toggleHandler:this.toggleSwitchTypeChart,scope:this,height:19,border:false});
this.tab=new Ext.tab.Bar({dock:"top",plain:true,border:false,bodyBorder:false,style:{"background-color":__color_PanelBackgroud,"margin-top":"2px"},listeners:{scope:this,change:function(g,h){this.activeChartType=h._chartType;
this.showActiveChartType()
}}});
var d=[{text:this.findLangS("title","calls_per_ip"),closable:false,_chartType:"calls_per_ip"},{text:this.findLangS("title","calls_per_ip_stacked"),closable:false,_chartType:"calls_per_ip_stacked"},{text:this.findLangS("title","realtime_calls"),closable:false,_chartType:"realtime_sensors"},{text:this.findLangS("title","realtime_top_source_ip"),closable:false,_chartType:"realtime_src_ip"},{text:this.findLangS("title","realtime_top_destination_ip"),closable:false,_chartType:"realtime_dst_ip"}];
this.tab.add(d);
var f=-1;
for(var c=0;
c<d.length;
c++){if(d[c]._chartType==this.activeChartType){f=c;
break
}}if(f>=0){this.tab.setActiveTab(this.tab.items.get(f))
}this.barContainer=new Ext.Container({layout:"hbox",height:19,border:false,items:this.tab,renderTo:"chart_panel_title_items",style:{"margin-top":"-4px",overflow:"visible !important"},listeners:{scope:this,afterrender:function(g){this.getEl().down(".x-title-text").dom.style.overflow="visible"
}}})
}this.showActiveChartType()
},resize:function(c){if(this.barContainer&&this.barContainer.getEl()){this.barContainer.setWidth(c.getWidth()-(this.barContainer.getPosition()[0]-c.getPosition()[0])-50)
}}}});
this.callParent([b]);
if(!a()){this.create_realtime("sensors");
this.create_realtime("src_ip");
this.create_realtime("dst_ip")
}function a(){return(b._panel.hideGridAtInit())
}},refreshCharts:function(b){var a=false;
if(!b){if(this._refreshCharts_lastData){b=this._refreshCharts_lastData
}else{return
}}switch(this.activeChartType){case"calls_per_ip":this.create_calls_per_ip();
this.calls_per_ip.refreshCharts(b,false);
break;
case"calls_per_ip_stacked":this.create_calls_per_ip();
this.calls_per_ip.refreshCharts(b,true);
break
}if(this.realtime_sensors&&!this.realtime_sensors.enableScheduler){this.realtime_sensors.addData(b.countCallsSensors)
}if(this.realtime_src_ip&&!this.realtime_src_ip.enableScheduler){this.realtime_src_ip.addData(b.srcIp)
}if(this.realtime_dst_ip&&!this.realtime_dst_ip.enableScheduler){this.realtime_dst_ip.addData(b.dstIp)
}if(!a){this._refreshCharts_lastData=b
}},showActiveChartType:function(){this.removeAll(false);
switch(this.activeChartType){case"calls_per_ip":this.create_calls_per_ip();
this.calls_per_ip.show(false);
this.refreshCharts();
break;
case"calls_per_ip_stacked":this.create_calls_per_ip();
this.calls_per_ip.show(true);
this.refreshCharts();
break;
case"realtime_sensors":this.create_realtime("sensors");
this.realtime_sensors.show();
break;
case"realtime_src_ip":this.create_realtime("src_ip");
this.realtime_src_ip.show();
break;
case"realtime_dst_ip":this.create_realtime("dst_ip");
this.realtime_dst_ip.show();
break
}},create_calls_per_ip:function(){if(!this.calls_per_ip){this.calls_per_ip=new SPY.Charts.calls_per_ip({_panel:this})
}},create_realtime:function(a){if(!this["realtime_"+a]){this["realtime_"+a]=new SPY.Charts.realtime({enableScheduler:false,_type:a,_panel:this})
}}});
Ext.define("SPY.iiidCharts",{extend:"Ext.Panel",subsystem:"activecalls",constructor:function(a){this.typeCharts=["mosf1_min","mosf2_min","jitter_max","loss_max"];
Ext.apply(a,{title:this.findLangS("title","RealtimeRTP"),collapsible:true,collapsedCls:"no-border",floatable:true,span:true,layout:"fit",listeners:{scope:this,resize:this.onResize,expand:this.onExpand,collapse:this.onCollapse},_manualCollapse:window.spy_disable_3d_rtp});
this.callParent([a])
},onExpand:function(){delete this._manualCollapse;
this.createContents();
this.setDisable3dRtp(0)
},onCollapse:function(){if(this._autoCollapse){delete this._autoCollapse
}else{if(this.getEl()){this._manualCollapse=true;
this.setDisable3dRtp(1)
}}},createContents:function(){if(!this._contentsCreated){this._createContents();
this._contentsCreated=true
}},_createContents:function(){if(this.getWidth()&&this.getHeight()){this.createCharts();
this.createChartsLayout()
}else{Ext.defer(function(){this._createContents()
},500,this)
}},createCharts:function(){this.charts=[];
for(var a=0;
a<this.typeCharts.length;
a++){this.charts[a]=new Ext.Chart3D.rtp_stat({typeChart:this.typeCharts[a],title:getDataArrayItem(arChart3D_rtp_stat,this.typeCharts[a],0,2),enable_dns_ip_lookup:"default",enable_context_mos_jitter_loss:true,enable_context_cdr:true,chartConfig2:{},filters:{sensor_id:this._panel.sensorId}})
}var b=this;
for(var a=0;
a<this.charts.length;
a++){this.charts[a].createChart(function(c){if(!c||c.task!="re_create"){this._created=true;
if(b.isCreatedAllCharts()){b.loadData(true)
}}})
}},destroyCharts:function(){if(this.charts){for(var a=0;
a<this.charts.length;
a++){if(this.charts[a].chart){this.charts[a].chart.deleteChart3D()
}this.charts[a].destroy()
}delete this.charts
}},createChartsLayout:function(){if(!this.charts||!this.charts.length){return
}var d=this.getLayoutType(this.getWidth(),this.getHeight());
if(!d){return
}var f={layout:{type:"vbox",align:"stretch"},items:[],border:false};
switch(d){case"r4c1":for(var c=0;
c<this.charts.length;
c++){f.items.push({xtype:"panel",layout:"fit",items:this.charts[c].chart,border:false,flex:1,listeners:{afterrender:b}})
}break;
case"r2c2":var a;
for(var c=0;
c<this.charts.length;
c++){if(!(c%2)){if(c){f.items.push(a)
}a={layout:{type:"hbox",align:"stretch"},items:[],border:false,flex:1}
}a.items.push({xtype:"panel",layout:"fit",items:this.charts[c].chart,border:false,flex:1,listeners:{afterrender:b}})
}f.items.push(a);
break
}this.add(f);
this._activeLayoutType=d;
function b(g){if(!g.header){return
}var k=g.header.getEl();
if(k){k.setStyle("background-image","none");
k.setStyle("background-color","transparent")
}var h=g.body;
if(h){h.setStyle("border-width","0px")
}}},destroyChartsLayout:function(){this.removeAll(false)
},loadData:function(b){if(!this.collapsed&&this.isCreatedAllCharts()){for(var a=0;
a<this.charts.length;
a++){if(!this.charts[a]._loadingData){this.charts[a].filters={sensor_id:this._panel.sensorId};
this.charts[a].loadData(function(){},this,b)
}}}},onResize:function(b,c,a){if(!this.charts||!this.charts.length){return
}Ext.defer(this._onResize,100,this)
},_onResize:function(){if(!this.charts||!this.charts.length){return
}var b=this.getLayoutType(this.getWidth(),this.getHeight());
if(b&&b!=this._activeLayoutType){for(var a=0;
a<this.charts.length;
a++){if(this.charts[a].chart){this.charts[a].chart.AdjustPerspective_suppress=true
}}this.destroyChartsLayout();
this.createChartsLayout();
Ext.defer(function(){for(var c=0;
c<this.charts.length;
c++){if(this.charts[c].chart){delete this.charts[c].chart.AdjustPerspective_suppress;
this.charts[c].chart.adjustPerspective()
}}},250,this)
}},getLayoutType:function(b,a){return(b&&a?(b<a*0.7?"r4c1":"r2c2"):undefined)
},isCreatedAllCharts:function(){if(!this.charts||!this.charts.length){return(false)
}for(var a=0;
a<this.charts.length;
a++){if(!this.charts[a]._created){return(false)
}}return(true)
},resizeTo:function(){if(!this.charts||!this.charts.length){return
}for(var a=0;
a<this.charts.length;
a++){this.charts[a].resizeTo()
}},evResize_suppress:function(){if(!this.charts||!this.charts.length){return
}for(var a=0;
a<this.charts.length;
a++){this.charts[a].chart.evResize_suppress=true
}},evResize_enable:function(){if(!this.charts||!this.charts.length){return
}for(var a=0;
a<this.charts.length;
a++){delete this.charts[a].chart.evResize_suppress
}},setDisable3dRtp:function(a){if(window.DEMO){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"spy",name:"disable_3d_rtp",config:a,user_id:user_id(),enableUpdate:true})}})
}});
Ext.define("SPY.Panel",{extend:"Ext.Panel",alias:"widget.SPY_tablePanelX",subsystem:"activecalls",constructor:function(a){this.defaultSensorId=window._default_sensors_for_active_call?window._default_sensors_for_active_call:(user.sqlrow._count_enable_sensors>0?(user.sqlrow.enable_sensors?user.sqlrow.enable_sensors.join(","):(window.localSensorId||_sensorId_all)):_sensorId_all);
this.sensorId=this.defaultSensorId;
this.spyGrid=new SPY.Grid({_panel:this});
this.spyBarCharts=new SPY.Charts.Panel({id:"spy-chart-panel",region:"south",_panel:this});
if(user_can_3d_rtp_charts()){this.iiidCharts=new SPY.iiidCharts({region:"east",width:10,collapsed:true,_collapsed:true,animCollapse:false,_panel:this})
}var c=this.createToolbar();
this.pagingToolbar=new Ext.PagingToolbar({pageSize:this.spyGrid.store.pageSize,store:this.spyGrid.store,displayInfo:true,items:c[0],behindButtonsItems:c[1],prependButtons:true,listeners:{scope:this,beforechange:function(d,f){if(f!=d.store.currentPage){this.spyGrid.deselectAll()
}}}});
var b=[{layout:"border",bodyBorder:false,border:false,defaults:{split:this.hideGridAtInit()?undefined:true,animFloat:false,autoHide:false,useSplitTips:true},items:[{collapsible:false,layout:"fit",border:false,items:this.spyGrid,region:"center"},this.spyBarCharts],region:"center"}];
if(this.iiidCharts){b.push(this.iiidCharts)
}Ext.apply(a,{id:"SPY_table-panel",title:"ActiveCalls",iconCls:"icon_menu_diag_monitor",layout:"fit",border:true,items:{layout:"border",bodyBorder:false,border:false,defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:b,tbar:this.pagingToolbar,listeners:{scope:this,afterrender:function(){Ext.defer(this.create_iiidCharts,500,this)
},resize:this.onResize}}});
this.callParent([a]);
this.spyGrid.store.on("load",this.onLoadSpyStore,this);
this.spyGrid.store.on("beforeload",this.onBeforeLoadSpyStore,this);
this.spyGrid.store.loadPage(1);
Ext.TaskManager.start({run:this.checkRunRefresh,interval:1000,scope:this})
},createToolbar:function(){this.nationalOrInterantionalCombo=new Ext.ux.combobox.ComboBoxA({value:0,aData:arNationalOrInternational,width:__width_ColumnChar(24),editable:false,listeners:{scope:this,select:function(d){var c=d.getValue();
switch(c){case 0:this.clearExtraParam("international");
break;
case 1:this.setExtraParam("international",0);
break;
case 2:this.setExtraParam("international",1);
break
}this.loadFirstPageSpyStore()
}}});
this.connectedCheckBox=new Ext.form.field.Checkbox({fieldStyle:{marginLeft:5,marginTop:-2},listeners:{scope:this,change:function(d,c){this.setExtraParam("connected",c?1:0);
this.loadFirstPageSpyStore()
}}});
this.refreshIntervalSpinner=new Ext.form.field.Number({value:window.debug?30:2,width:__width_ColumnNum(3)+__width_Trigger,minValue:0.1,maxValue:window.debug?999:30,allowDecimals:true,decimalPrecision:1,step:0.1,enableKeyEvents:true,listeners:{scope:this,change:function(c){this.setTimeoutInterval.call(this)
},keyup:function(d,c){if(c.keyCode==c.ENTER){this.setTimeoutInterval.call(this)
}}},fieldStyle:{"text-align":"right"}});
this.comboSensor=new Fields.CBX_sensor({_noLabel:true,value:this.defaultSensorId,width:120,_listWidth:25,_addEmptySensorId:true,_addAll:true,_multiSelect2:true,listeners:{scope:this,select:function(d){var c=d.getValue();
this.sensorId=c;
this.setExtraParam("sensor_id",c);
this.loadFirstPageSpyStore()
}},_hideEmptyIfNotNeed:true,_hideAllIfNotNeed:this.defaultSensorId!=_sensorId_all,_evSelectMode2:true});
this.filterText=new Ext.ux.form.SearchField({width:100,store:this.spyGrid.store,paramName:"filter",fieldStyle:{"text-align":"right"}});
var b=[this.nationalOrInterantionalCombo,this.connectedCheckBox,this.findLangS("field","connected"),"-",this.findLangS("field","sensor")+":&thinsp;",this.comboSensor,this.findLangS("field","filter")+":&thinsp;",this.filterText,"-"];
var a=[this.findLangS("field","refreshInterval")+":&thinsp;",this.refreshIntervalSpinner];
return([b,a])
},setExtraParam:function(a,b){if(this.spyGrid&&this.spyGrid.store&&this.spyGrid.store.proxy){this.spyGrid.store.proxy.extraParams[a]=b
}},getExtraParam:function(a){if(this.spyGrid&&this.spyGrid.store&&this.spyGrid.store.proxy){return(this.spyGrid.store.proxy.extraParams[a])
}return(null)
},clearExtraParam:function(a){if(this.spyGrid&&this.spyGrid.store&&this.spyGrid.store.proxy&&Ext.isDefined(this.spyGrid.store.proxy.extraParams[a])){delete this.spyGrid.store.proxy.extraParams[a]
}},loadFirstPageSpyStore:function(){if(this.spyGrid&&this.spyGrid.store){this.spyGrid.store.loadPage(1)
}},refreshSpyStore:function(a){this.clearTimeoutId();
if(a||ActiveModule=="SPY_table"&&this.isVisible()&&!reloginForm){if(!this.spyGrid||this.spyGrid.chunkPlayer&&this.spyGrid.chunkPlayer.playerWindow.getEl()||this.spyGrid.prepareChunkPlayer||this.spyGrid.store.proxy._request.xhr||Ext.WindowMgr.zIndexStack.last()){this.setTimeoutId()
}else{if(this.spyGrid.store){this.spyGrid.view.loadMask.setDisabled(true);
this.spyGrid.store.load(this.spyGrid.store.lastOptions);
Ext.defer(function(){this.spyGrid.view.loadMask.setDisabled(false)
},100,this)
}}}},onLoadSpyStore:function(b,a,c){this._lastLoadSpyStoreTime=(new Date()).getTime();
this.clearTimeoutId();
if(b&&b.proxy){this.spyGrid.onLoadStore(b,a,c);
if(c){this.spyBarCharts.refreshCharts(b.proxy.reader.rawData);
if(this.iiidCharts){this.iiidCharts.loadData()
}}}this.setTimeoutId()
},onBeforeLoadSpyStore:function(a){if(a&&a.proxy){this.spyGrid.onBeforeLoadStore(a)
}},checkRunRefresh:function(){if(this._lastLoadSpyStoreTime&&!this.spyGrid.store.proxy._request.xhr&&((new Date()).getTime()-this._lastLoadSpyStoreTime)/1000>this.refreshIntervalSpinner.getValue()*2){this._lastLoadSpyStoreTime=(new Date()).getTime();
this.refreshSpyStore()
}},clearTimeoutId:function(){if(this._timeoutId){clearInterval(this._timeoutId);
delete this._timeoutId
}},setTimeoutId:function(){this._timeoutId=setTimeout(Ext.bind(this.refreshSpyStore,this),this.refreshIntervalSpinner.getValue()*1000)
},setTimeoutInterval:function(){this.clearTimeoutId();
this.setTimeoutId()
},hideGridAtInit:function(){return(window.activecalls&&window.hidegrid)
},create_iiidCharts:function(){this.setWidth_iiidCharts(true);
Ext.defer(function(){this._created_iiidCharts=true
},100,this)
},setWidth_iiidCharts:function(d){if(!this.iiidCharts){return
}var c=this.getWidth();
var b=this.spyGrid.headerCt.getEl().down(".x-box-inner").getWidth();
if(!b){return
}var a=c-b-8;
if(a>300){this.iiidCharts.setWidth(a);
if(d&&!this.iiidCharts._manualCollapse){if(this.iiidCharts.collapsed&&this.iiidCharts._collapsed){this.iiidCharts._collapsed=false;
this.iiidCharts.expand()
}else{this.iiidCharts.createContents()
}}}else{this.iiidCharts.setWidth(c/4);
if(d&&!this.iiidCharts.collapsed&&!this.iiidCharts._collapsed){this.iiidCharts._autoCollapse=true;
this.iiidCharts._collapsed=true;
this.iiidCharts.collapse()
}}},onResize:function(b,c,a){if(!this.iiidCharts){return
}this.iiidCharts.evResize_suppress();
this.setWidth_iiidCharts(false);
if(this._created_iiidCharts){this.iiidCharts.evResize_enable();
Ext.defer(function(){this.setWidth_iiidCharts(true);
this.iiidCharts.resizeTo()
},100,this)
}},reactivate:function(){if(window.needSpyColumnsReconfigure){this.spyGrid.reconfigureColumns();
window.needSpyColumnsReconfigure=false
}this.loadFirstPageSpyStore()
},showGmap:function(){new GMap.PanelExt({mainPos:[0,0],disableLoadGeoipData:true,border:false,windowConfig:{autoShow:true,title:findLangS("gmap","title","activeCallsMap")},zoom:2,selectSensors:this.getExtraParam("sensor_id")})
}});
Ext.define("SPY.MapPanel",{extend:"Ext.Panel",alias:"widget.SPY_mapPanelX",subsystem:"activecalls",constructor:function(a){this.defaultSensorId=window._default_sensors_for_active_call?window._default_sensors_for_active_call:(user.sqlrow._count_enable_sensors>0?(user.sqlrow.enable_sensors?user.sqlrow.enable_sensors.join(","):(window.localSensorId||_sensorId_all)):_sensorId_all);
this.sensorId=this.defaultSensorId;
this.comboSensor=new Fields.CBX_sensor({_noLabel:true,value:this.defaultSensorId,width:120,_listWidth:25,_addEmptySensorId:true,_addAll:true,_multiSelect2:true,listeners:{scope:this,select:function(c){var b=c.getValue();
this.sensorId=b;
this.mapPanel.selectSensors=this.sensorId;
this.mapPanel.reload()
}},_hideEmptyIfNotNeed:true,_hideAllIfNotNeed:this.defaultSensorId!=_sensorId_all,_evSelectMode2:true});
this.mapPanel=new GMap.PanelExt({mainPos:[0,0],disableLoadGeoipData:true,border:false,zoom:2,disableTitle:true,disableIcon:true,selectSensors:this.sensorId,_timeoutRefreshInterval:30,tbar:[this.findLangS("field","sensor")+":",this.comboSensor],enableAutoReload:function(){return(ActiveModule=="SPY_map")
}});
Ext.apply(a,{id:"SPY_map-panel",title:"ActiveCalls",iconCls:"icon_google_maps",layout:"fit",border:true,items:this.mapPanel});
this.callParent([a])
},reactivate:function(){this.mapPanel.reload()
}});
Ext.define("Ext.chart.theme.SpyBar",{extend:"Ext.chart.theme.Base",alias:"chart.theme.SpyBar",constructor:function(a){a.axis={left:{label:{font:"11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},bottom:{label:{font:"11px Tahoma, Arial, Helvetica, Sans-serif"},title:{font:"bold 12px Tahoma, Arial, Helvetica, Sans-serif",fill:"black"}}};
this.callParent([a])
}});
Ext.ns("Livepacket");
Ext.define("Livepacket.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Livepacket.GridX",subsystem:"livepacket",constructor:function(r){var l=[];
m();
var u=0;
var q={};
var k=80;
var s=21;
this.btnStartStopSniffer=new Ext.Button({text:this.Lstart,iconCls:"icon_rec_start",enableToggle:true,toggleHandler:this.onBtnStartStopSniffer,scope:this,width:k,height:s});
this.btnPause=new Ext.Button({text:this.Lpause,iconCls:"icon_rec_pause",enableToggle:true,toggleHandler:this.onBtnPause,scope:this,disabled:true,width:k,height:s});
this.btnClear=new Ext.Button({text:this.Lclear,iconCls:"icon_delete",handler:this.onBtnClear,scope:this,disabled:true,width:k,height:s});
this.btnDownloadPcap=new Ext.Button({text:this.LdownloadPCAP,iconCls:"icon_save2_blue",width:k,disabled:true,height:s,menu:{defaults:{scope:this,handler:this.downloadPcap},items:[{text:this.LselectRecords,_selected:true,_menuId:"_downloadPcapSelected",disabled:true},{text:this.LallRecords}]}});
var d=120;
this.filterSensor=new Fields.CBX_sensor({value:null,_initSetLocalSensor:true,_noLabel:true,width:d,_addEmptySensorId:true,_hideEmptyIfNotNeed:true,_buttonGroup:true,allowBlank:false});
this.filterSipType=new Ext.ux.combobox.ComboBoxA({value:"I, R",aData:[["I","INVITE"],["R","REGISTER"],["O","OPTIONS"],["S","SUBSCRIBE"],["M","MESSAGE"],["N","NOTIFY"]],displayField:"id",_tpl:"{descr}",_arraySeparator:", ",_stringValue:true,width:d,multiSelect:true,_buttonGroup:true});
this.filterIP=new Ext.ux.form.ButtonGroupField({width:d,_buttonGroup:true});
this.filterNumber=new Ext.ux.form.ButtonGroupField({width:d,_buttonGroup:true});
this.filterHeaderType=new Ext.ux.combobox.ComboBoxA({value:"F, T",aData:[["F","FROM"],["T","TO"]],displayField:"id",_tpl:"{descr}",_arraySeparator:", ",_stringValue:true,width:d,multiSelect:true,_buttonGroup:true});
this.filterVlan=new Ext.ux.form.ButtonGroupField({width:d,_buttonGroup:true});
this.filterPort=new Ext.ux.form.ButtonGroupField({width:d,_buttonGroup:true});
this.filterHeader=new Ext.ux.form.ButtonGroupField({width:d,_buttonGroup:true});
var p={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:64,style:{background:__color_TabGroupBackgroud,"border-width":0},listeners:{scope:this,beforechange:this.doSuspendLiveLoad}};
var a=[{xtype:"buttongroup",columns:1,items:[{xtype:"container",height:10},this.btnStartStopSniffer,{xtype:"container",height:2},this.btnPause,{xtype:"container",height:10}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",columns:1,items:[{xtype:"container",height:10},this.btnClear,{xtype:"container",height:2},this.btnDownloadPcap,{xtype:"container",height:10}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",columns:6,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:6},{value:this.LsensorText+":",fieldCls:"x-toolbar-text"},this.filterSensor,{value:this.LipText+":",fieldCls:"x-toolbar-text"},this.filterIP,{value:this.LfilterPortText+":",fieldCls:"x-toolbar-text"},this.filterPort,{value:this.LsipTypeText+":",fieldCls:"x-toolbar-text"},this.filterSipType,{value:this.LnumberText+":",fieldCls:"x-toolbar-text"},this.filterNumber,{value:this.LfilterVlanText+":",fieldCls:"x-toolbar-text"},this.filterVlan,{value:this.LheaderTypeText+":",fieldCls:"x-toolbar-text"},this.filterHeaderType,{value:this.LheaderText+":",fieldCls:"x-toolbar-text"},this.filterHeader,{xtype:"container",colspan:2}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",items:p,style:{background:__color_TabGroupBackgroud,"border-width":0}}];
var b=[{header:this.LcreatedAtText,dataIndex:"created_at",widthCh:14,align:"center",renderer:o},{header:this.LsipcalerIP_portText,dataIndex:"sipcallerip",widthCh:22,align:"right",renderer:n},{header:this.LsipcaledIP_portText,dataIndex:"sipcalledip",widthCh:22,align:"right",renderer:v},{header:this.LisTcpText,dataIndex:"istcp",widthCh:5,align:"center",renderer:f},{header:this.LdescriptionText,dataIndex:"description",widthCh:40,align:"left"},{header:this.LcallidText,dataIndex:"callid",widthCh:27,align:"left"}];
r=Ext.applyIf(r||{},{storeId:"LivepacketTableStore",url:"php/model/sql.php",module:"livepacket",recordStruct:rsLivepacket,remoteSort:true,pageSize:60,columnsDefaults:{sortable:false},columns:b,tbar:a,paginator:p,prefixCls:"livepacket",stripeRows:false,selModel:{mode:"MULTI"},plugins:[{ptype:"rowexpander",rowBodyContentCls:"Livepacket.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],getRowClass:c,listeners:{scope:this,afterrender:t}});
this.callParent([r]);
this.store.on("load",this.onLoadStore,this);
this.selModel.on("selectionchange",g,this);
function o(C,z,y,D,B,A,w){return(Ext.Date.format(C,__format_Time)+'<span style="color: grey; font-size: 80%;">.'+String(Math.round(y.data.microseconds/1000)).lpad(3,"0")+"&thinsp;ms</span>")
}function n(C,z,y,D,B,A,w){return(C+' : <span style="margin-left: 3px; width: 28px; display: inline-block; text-align: right;">'+y.data.sport+"</span>")
}function v(C,z,y,D,B,A,w){return(C+' : <span style="margin-left: 3px; width: 28px; display: inline-block; text-align: right;">'+y.data.dport+"</span>")
}function f(C,z,y,D,B,A,w){return(C?"T":"U")
}function g(y){var z=y.getSelection();
var w=this.getTopToolbar().findC("_menuId","_downloadPcapSelected",true);
w.enableIf(z.length)
}function c(w,A,z,y){return(addBackgroundColorRuleToStyleSheet(rgbToHex(hsvToRgb(h(w.data.callid),24,100)),"livepacket-cell"))
}function t(){this.filterSensor.isValid()
}function m(){var z=360;
var w=8;
var y=z/w;
while(l.length<1000){var B=parseInt(Math.random()*z);
for(var A=0;
A<w;
A++){hue=B+A*y;
if(hue>=z){hue-=z
}l.push(hue)
}}}function h(w){if(!q[w]){q[w]=l[u];
if(u<l.length-1){++u
}else{u=0
}}return(q[w])
}},onBtnStartStopSniffer:function(a,b){if(this._disableStartStopEvent){return
}if(b){if(!this.filterSensor.getValue()){this._disableStartStopEvent=true;
this.btnStartStopSniffer.toggle(false);
this._disableStartStopEvent=false;
Ext.Msg.alert(lang.error,this.findLangS("firstSelectSensor"))
}else{if(!this.filterIP.getValue()&&!this.filterNumber.getValue()&&!this.filterHeader.getValue()){Ext.Msg.confirm(lang.warning,this.findLangS("warningStartWithoutFilter"),function(c){if(c=="yes"){this.doStartLiveLoad()
}else{this._disableStartStopEvent=true;
this.btnStartStopSniffer.toggle(false);
this._disableStartStopEvent=false
}},this)
}else{this.doStartLiveLoad()
}}}else{this.doStopLiveLoad()
}},onBtnPause:function(a,b){if(b){this.suspendLiveLoad()
}else{this.resumeLiveLoad()
}},onBtnClear:function(a){Ext.Msg.confirm(this.LmsgClearHeader,this.LmsgClearText,function(b){if(b=="yes"){this.doClear()
}},this)
},doClear:function(){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"clear"},success:function(a){huePaletteCallId={};
this.reloadFirstPage()
},scope:this,maskEl:this})
},getLastIdInGrid:function(){var a=this.store.getCount();
if(a){return(this.store.getAt(a-1).data.id*1)
}return(null)
},doStartLiveLoad:function(){if(this._disableStartStopEvent){return
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"livepacketStart",params:Ext.encode({sensor:this.filterSensor.getValue(),filter_sip_type:this.filterSipType.getValue(),filter_ip:this.filterIP.getValue(),filter_number:this.filterNumber.getValue(),filter_header_type:this.filterHeaderType.getValue(),filter_header:this.filterHeader.getValue(),filter_vlan:this.filterVlan.getValue(),filter_port:this.filterPort.getValue()})},success:function(a){this.startLiveLoad()
},errorFailure2:function(){this._disableStartStopEvent=true;
this.btnStartStopSniffer.toggle(false);
this._disableStartStopEvent=false
},scope:this,maskEl:this})
},doStopLiveLoad:function(){if(this._disableStartStopEvent){return
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"livepacketStop",params:Ext.encode({sensor:this.filterSensor.getValue()})},success:function(a){this.stopLiveLoad()
},errorFailure2:function(){this._disableStartStopEvent=true;
this.btnStartStopSniffer.toggle(true);
this._disableStartStopEvent=false
},scope:this,maskEl:this})
},startLiveLoad:function(a){if(this.liveLoadData){return
}this.liveLoadData={count:0,initpage:this.store.currentPage};
this.store.removeAll();
this.liveLoadData.scheduler=Ext.TaskManager.start({run:this.liveLoad,interval:1000,scope:this});
if(a){this._disableStartStopEvent=true;
this.btnStartStopSniffer.toggle(true);
this._disableStartStopEvent=false
}this.onChangeState()
},stopLiveLoad:function(){if(this.liveLoadData){Ext.TaskManager.stop(this.liveLoadData.scheduler);
if(this.liveLoadData.count){this.store.currentPage+=100;
this.store.load()
}else{this.store.loadPage(this.liveLoadData.initpage||1)
}this.liveLoadData=null
}this.btnPause.toggle(false);
if(this.btnStartStopSniffer.pressed){this._disableStartStopEvent=true;
this.btnStartStopSniffer.toggle(false);
this._disableStartStopEvent=false
}this.onChangeState()
},doSuspendLiveLoad:function(){if(this.liveLoadData){this.btnPause.toggle(true)
}},suspendLiveLoad:function(){if(this.liveLoadData){this.liveLoadData.suspended=true;
this.onChangeState()
}},resumeLiveLoad:function(){if(this.liveLoadData){this.liveLoadData.suspended=false;
this.onChangeState()
}},setFilterParameters:function(a){if(a.filter_sip_type){this.filterSipType.setValue(a.filter_sip_type)
}if(a.filter_ip){this.filterIP.setValue(a.filter_ip)
}if(a.filter_number){this.filterNumber.setValue(a.filter_number)
}if(a.filter_header_type){this.filterHeaderType.setValue(a.filter_header_type)
}if(a.filter_header){this.filterHeader.setValue(a.filter_header)
}if(a.filter_vlan){this.filterVlan.setValue(a.filter_vlan)
}if(a.filter_port){this.filterPort.setValue(a.filter_port)
}},onChangeState:function(){this.btnStartStopSniffer.setText(this.liveLoadData?this.Lstop:this.Lstart);
this.btnStartStopSniffer.setIconCls(this.liveLoadData?"icon_rec_stop":"icon_rec_start");
this.btnPause.setText(this.liveLoadData&&this.liveLoadData.suspended?this.Lunpause:this.Lpause);
this.btnPause.setIconCls(this.liveLoadData&&this.liveLoadData.suspended?"icon_rec_paused":"icon_rec_pause");
this.btnPause.enableIf(this.liveLoadData);
this.btnClear.enableIf(!this.liveLoadData);
this.filterSensor.enableIf(!this.liveLoadData);
this.filterSipType.enableIf(!this.liveLoadData);
this.filterIP.enableIf(!this.liveLoadData);
this.filterNumber.enableIf(!this.liveLoadData);
this.filterHeaderType.enableIf(!this.liveLoadData);
this.filterHeader.enableIf(!this.liveLoadData);
this.filterVlan.enableIf(!this.liveLoadData);
this.filterPort.enableIf(!this.liveLoadData)
},liveLoad:function(){if(this.liveLoadData&&!this.liveLoadData.suspended){this.fetchLastPage()
}},fetchLastPage:function(){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"fetch_last_page",page_size:this.pageSize},success:function(a){this.updateLastPage(a.total,a.rows)
},scope:this})
},updateLastPage:function(g,h){if(!this.liveLoadData||!h){return
}var f=this.getLastIdInGrid();
if(!this.liveLoadData.from_id&&h.length){this.liveLoadData.from_id=h[Math.min(5,h.length-1)].id*1
}for(var c=h.length-1;
c>=0;
c--){if(h[c]["id"]*1>=this.liveLoadData.from_id&&h[c]["id"]*1>f){this.store.add(h[c]);
++this.liveLoadData.count
}if(this.store.getCount()>this.pageSize){this.store.removeAt(0)
}}var d=this.store.getCount();
if(d){var a=false;
for(var c=0;
c<d;
c++){if(this.isExpandRowIndex(c)){a=true
}}if(!a){var b=Ext.get(this.getView().getNode(d-1));
if(b){b.scrollIntoView(this.getView().getEl())
}}}this.store.totalCount=g;
this.store.currentPage=parseInt(g/this.pageSize)+(g%this.pageSize?1:0);
this.store.fireEvent("load");
this.btnDownloadPcap.enableIf(d)
},onLoadStore:function(b,a){if(a){this.btnClear.enableIf(a.length);
this.btnDownloadPcap.enableIf(a.length);
if(b.currentPage>Math.ceil(b.totalCount/b.pageSize)){b.currentPage=Math.ceil(b.totalCount/b.pageSize);
b.fireEvent("load")
}}},downloadPcap:function(d){this.maskLoad();
Ext.defer(this.unmask,1000,this);
var a;
if(d._selected){var c=this.selModel.getSelection();
a=[];
for(var b=0;
b<c.length;
b++){a.push(c[b].data.id)
}}formPostSafe("php/model/utilities.php","POST",{task:"livepacketDownloadPcap",params:Ext.encode({selectedId:a})})
},panelActivate:function(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"livepacketIsEnable"},success:function(a){if(a.enable){if(a.sensor*1>0){this.filterSensor.setValue(a.sensor*1);
if(this.filterSensor.getValue()==a.sensor){if(a.parameters){this.setFilterParameters(a.parameters)
}this.startLiveLoad(true)
}else{this.filterSensor.store.on("load",function(){Ext.defer(function(){if(a.parameters){this.setFilterParameters(a.parameters)
}this.startLiveLoad(true)
},200,this)
},this,{single:true})
}}else{this.filterSensor.setValue(window.vpmanagerhost?window.localSensorId:null);
this.startLiveLoad(true)
}}else{this.stopLiveLoad();
this.filterSensor.setValue(a.local_sensor*1>0?a.local_sensor*1:(window.vpmanagerhost?window.localSensorId:null))
}},scope:this})
},panelDeactivate:function(){this.doSuspendLiveLoad()
}});
Ext.override(Livepacket.Grid,{LcreatedAtText:"time",LsipcalerIP_portText:"source IP",LsipcaledIP_portText:"destination IP",LisTcpText:"prot.",LdescriptionText:"description",LcallidText:"callid",LmsgClearHeader:"delete all record",LmsgClearText:"Really ?",LsensorText:"sensor",LsipTypeText:"sip type",LheaderTypeText:"header type",LipText:"IP",LnumberText:"number",LheaderText:"header",LfilterVlanText:"VLANs",LfilterPortText:"Port",Lstart:"start",Lstop:"stop",Lpause:"pause",Lunpause:"unpause",Lclear:"clear",LdownloadPCAP:"PCAP",LselectRecords:"download selected",LallRecords:"download all"});
Ext.define("Livepacket.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.tabPanel=new Ext.TabPanel({activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:a.grid.module+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false,listeners:{scope:this,afterrender:this.onAfterRender}});
this.callParent([a])
},onAfterRender:function(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getLivePcapData",params:Ext.encode({id:this.record.data.id})},success:function(a){this.addParsePcapPanel(a.data)
},errorFailure2:function(a){},scope:this,maskEl:this,deferMask:true})
},addParsePcapPanel:function(a){this.parsePcapPanel=new Tools.ParseXmlPdmlPanel({data:a,pdml:true,onlyKeyColumn:true,proportionalFont:true,title:this.LtitlePacketTree,hideHeaders:true,enableTbarButtonExpandAll:true,enableTbarButtonExpandSipBranch:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel.add(this.parsePcapPanel);
this.tabPanel.setActiveItem(this.parsePcapPanel)
},nextPanel:function(){this.nextPanel=new Ext.Panel({xtype:"panel",loader:{url:"php/model/utilities.php",params:{task:"livepacketNextInfo",params:Ext.encode({id:this.record.data.id})}},border:false,style:{padding:5,"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.LtitleNextPanel,listeners:{scope:this,afterrender:function(){this.nextPanel.ajaxSafeLoad()
}}});
this.tabPanel.add(this.nextPanel);
this.tabPanel.setActiveTab(0)
}});
Ext.override(Livepacket.GridExpPanel,{LtitlePacketTree:"packet tree",LtitleNextPanel:"next data"});
Ext.define("Livepacket.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.LivepacketPanelX",constructor:function(a){this.livepacket=new Livepacket.Grid({layout:"fit",border:false,livepacketPanel:this});
a=Ext.applyIf(a||{},{id:"Livepacket-panel",iconCls:"icon_wireshark",items:this.livepacket,listeners:{scope:this,activate:this.activate,deactivate:this.deactivate},wikiId:"Live_sniffer"});
this.callParent([a])
},reactivate:function(){},activate:function(){this.livepacket.panelActivate()
},deactivate:function(){this.livepacket.panelDeactivate()
},evChangeAppPanel:function(c,h,g,b,f,d){var a=arguments;
if(this.livepacket.liveLoadData){Ext.Msg.confirm(lang.questionText,"stop live sniffer?",function(k){if(k=="yes"){this.livepacket.doStopLiveLoad()
}newArgs=[];
for(var l=0;
l<a.length;
l++){newArgs[l]=a[l]
}newArgs[5]=true;
showPanel.apply(this,newArgs)
},this);
return(false)
}return(true)
}});
Ext.override(Livepacket.Panel,{titleText:"Live sniffer"});
Ext.ns("Dashboard_d");
Ext.define("Dashboard_d.ItemPanel",{extend:"Ext.Panel",subsystem:"dashboard_d",constructor:function(a){a=Ext.applyIf(a,{_title:a.title,id:"dynamic_dashboard_panel_"+a.panelId,dockState:"undock",layout:"fit",listeners:{scope:this,afterrender:this.onAfterRender,close:this.onClose,destroy:this.onDestroy}});
a.title=this.createTitle(a._title,a.id);
this.callParent([a]);
this._counterDisable_onResizeUndockWindow=0;
this._counterDisable_onMoveUndockWindow=0;
this.dockContainer.addItemPanel(this);
if(this.dockState=="undock"){this.createUndockWindow(true)
}this.contentPanel=Ext.create("Dashboard_d.SubPanel_"+a.panelType,{dashboardPanel:this,setupValues:this.setupValues,listeners:{scope:this,afterrender:this.onAfterRenderContentPanel}});
this.add(this.contentPanel);
this.dockContainer.enableSaveDeleteTemplate();
this.refreshInfoTask=Ext.TaskManager.start({run:function(){this.refreshInfo()
},interval:500,scope:this})
},onClickTools:function(c){var a=[];
if(this.contentPanel&&this.contentPanel.isReady()){if(this.contentPanel.isPaused()){a.push({text:this.findLangS("menu","resume"),handler:function(){this.contentPanel.resume()
}})
}else{a.push({text:this.findLangS("menu","pause"),handler:function(){this.contentPanel.pause()
}})
}a.push({text:this.findLangS("menu","refresh")+(!this.contentPanel.isPaused()?" ("+this.contentPanel.getTimeToRefresh(true)+")":""),handler:function(){this.contentPanel.refresh()
}});
a.push({xtype:"menuseparator"})
}a.push({text:this.findLangS("menu","panelSetup"),handler:this.panelSetup});
if(this.dockState=="undock"){a.push({text:this.findLangS("menu","dock"),handler:this.dock})
}else{a.push({text:this.findLangS("menu","undock"),handler:this.undock})
}a.push({text:this.findLangS("menu","close"),handler:this.closePanel,scope:this});
var b=new Ext.menu.Menu({defaults:{scope:this},items:a});
b.showAt(c)
},onClickRefresh:function(){if(this.contentPanel&&this.contentPanel.isReady()){this.contentPanel.refresh()
}},onClickPause:function(){if(this.contentPanel&&this.contentPanel.isReady()){if(this.contentPanel.isPaused()){this.contentPanel.resume()
}else{this.contentPanel.pause()
}}},onClickSetInterval:function(d){if(this.contentPanel.setupValues.typeTimeInterval=="custom"){this.onClickSetCustomInterval();
return
}var a=[];
for(var b=0;
b<this.contentPanel.getTimeIntervalsData().length;
b++){if(this.contentPanel.getTimeIntervalsData()[b][0]=="-"){a.push({xtype:"menuseparator"})
}else{a.push({text:this.contentPanel.getTimeIntervalsData()[b][1],_interval:this.contentPanel.getTimeIntervalsData()[b][0]})
}}var c=new Ext.menu.Menu({defaults:{scope:this,handler:function(f){this.onSetInterval(f._interval)
}},items:a});
c.showAt(d)
},onSetInterval:function(a){if(!this.contentPanel||!this.contentPanel.setupValues){return
}this.contentPanel.setupValues.typeTimeInterval=a;
this.contentPanel.createContentAndStartRefreshTimer();
this.setPanelTitle()
},onClickSetCustomInterval:function(){var c=this.contentPanel.setupValues.last_days||this.contentPanel.setupValues.last_minutes;
var a=new Ext.FormPanel({frame:true,border:false,items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",fieldLabel:this.findLangS("field","lastDaysMinutes"),name:"last_days",value:this.contentPanel.setupValues.last_days,minValue:0,maxValue:365,allowBlank:c,labelWidth:__width_FieldChar(16),width:__width_FieldChar(16)+__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(h){var g=h.getValue();
if(g==1||g===null){Ext.defer(function(){h.setValue(null)
},1)
}b()
},select:b,change:b}},{xtype:"displayfield_h16",value:lang.days,style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",hideLabel:true,name:"last_minutes",value:this.contentPanel.setupValues.last_minutes,minValue:0,maxValue:24*60,allowBlank:c,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(h){var g=h.getValue();
if(g==1||g===null){Ext.defer(function(){h.setValue(null)
},1)
}b()
},select:b,change:b}},{xtype:"displayfield_h16",value:lang.minutes,style:{marginLeft:2}}],style:{marginBottom:__height_FieldSeparator}}],buttons:[{text:this.findLangS("button","save"),iconCls:"icon_save",handler:d,scope:this},{text:this.findLangS("button","cancel"),iconCls:"icon_cancel",handler:function(){a.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",a.el,{enter:d,scope:this})
}}});
var f=new Ext.Window({layout:"fit",items:a,border:false,title:this.findLangS("title","setCustomTimeInterval"),modal:true,closable:true,listeners:{scope:this,activate:function(){a.getForm().findField("last_days").focus(false,200)
}}});
f.show();
function d(){if(a.getForm().isValid()){var g=a.getForm().getFieldValues();
this.onSetCustomInterval(g.last_days,g.last_minutes);
a.destroyWindow()
}}function b(){var l=a.getForm().getFieldValues();
var h=l.last_days||l.last_minutes;
var g=["last_days","last_minutes"];
for(var k=0;
k<g.length;
k++){var m=a.getForm().findField(g[k]);
if(m){m.allowBlank=h;
if(h){m.clearInvalid()
}}}}},onSetCustomInterval:function(b,a){if(!this.contentPanel||!this.contentPanel.setupValues){return
}this.contentPanel.setupValues.typeTimeInterval="custom";
this.contentPanel.setupValues.last_days=b;
this.contentPanel.setupValues.last_minutes=a;
this.contentPanel.createContentAndStartRefreshTimer();
this.setPanelTitle()
},dockUndock:function(){if(this.dockState=="undock"){this.dock()
}else{this.undock()
}},dock:function(){this.dockFromUndockWindow();
this.dockState="dock";
this.dockContainer.enableSaveDeleteTemplate();
this.setPanelTitle()
},undock:function(){this.createUndockWindow();
this.dockState="undock";
this.dockContainer.enableSaveDeleteTemplate();
this.setPanelTitle()
},panelSetup:function(){this.contentPanel.showSetup()
},closePanel:function(){Ext.Msg.confirm(lang.questionText,this.findLangS("text","questionClosePanel")+" '"+this._title+"' ?",function(a){if(a=="yes"){if(this.dockState=="dock"){this.close()
}else{this.closeConfirmed=true;
this.undockWindow.close()
}}},this)
},onAfterSetSetupValues:function(a){this._title=a.title;
this.setTitle(this.createTitle(a.title,this.id))
},createUndockWindow:function(c){if(this.undockWindow){return
}this._createUndockWindow_processing=true;
var a=null;
if(this.getEl()){var a=this.getAbsolutePosition();
this.hideHeader(true);
this.dockContainer.remove(this,false)
}var b={layout:"fit",items:this,border:false,title:this.title,listeners:{scope:this,show:this.onShowUndockWindow,beforeclose:this.onBeforeCloseUndockWindow,resize:this.onResizeUndockWindow,move:this.onMoveUndockWindow,dragstart:this.onDragStartUndockWindow,dragend:this.onDragEndUndockWindow},doCoordsToGrid:c,closable:!user_dashboard_read_only()};
if(a){Ext.apply(b,{x:a[0],y:a[1],doSyncPosition:true})
}this.undockWindow=new Ext.Window(b);
this.setPosition(0,0);
this.undockWindow.show();
this._createUndockWindow_processing=false
},dockFromUndockWindow:function(){if(!this.undockWindow){return
}this.undockWindow.remove(this,false);
this.undockWindow.destroying=true;
var a=this.undockWindow.getPosition();
var b=getAbsolutePosition(this.dockContainer.body.dom);
this.dockContainer._addItemPanel(this);
this.getHeader().show();
this.setPosition(a[0]-b[0]+this._undockWindow_positionContent[0]+1,a[1]-b[1]+this._undockWindow_positionContent[1]-this._headerHeight+1);
this.setHeight(this.getHeight()+this._headerHeight);
this.undockWindow.destroy();
this.undockWindow=null;
this.dockContainer.enableToolbarsItems()
},hideHeader:function(b){this.saveHeaderHeight();
if(this.getHeader().isVisible()&&(!b||this.okHeaderHeight())){var a;
if(b){a=this.getHeight()-this.getHeader().getHeight()
}this.getHeader().hide();
if(b){this.setHeight(a)
}}},saveHeaderHeight:function(){if(this.getHeader().isVisible()&&this.okHeaderHeight()){this._headerHeight=this.getHeader().getHeight()
}},okHeaderHeight:function(){return(this.getHeader().getHeight()>10)
},syncPositionUndockWindow:function(){var a=this.undockWindow.getPosition();
this.undockWindow.setPosition(a[0]-this._undockWindow_positionContent[0]-1,a[1]-this._undockWindow_positionContent[1]+this._headerHeight-1)
},coordsToGridUndockWindow:function(){if(!this.undockWindow||this.undockWindow.destroying||this.coordsToGridUndockWindow_processing){return
}this.coordsToGridUndockWindow_processing=true;
var b=this.getAbsolutePosition();
var c=getAbsolutePosition(this.dockContainer.body.dom);
var d=this.getSize();
var a=cloneObject(b);
a[0]-=this._headerHeight;
var f=cloneObject(d);
d.height+=this._headerHeight;
var g=this.dockContainer.coordsToGrid(b,d,c);
if(g.ok){if(g.resize){this.setSize(g.size.width,g.size.height-this._headerHeight)
}if(g.move){++this._counterDisable_onMoveUndockWindow;
this.undockWindow.setPosition(g.position[0]-this._undockWindow_positionContent[0]-1,g.position[1]-this._undockWindow_positionContent[1]+this._headerHeight-1)
}if(g.resize){++this._counterDisable_onResizeUndockWindow;
this.undockWindow.setSize(g.size.width+this._undockWindow_incSizeContent[0],g.size.height-this._headerHeight+this._undockWindow_incSizeContent[1])
}this.coords_i={left:g.left_i,top:g.top_i,right:g.right_i,bottom:g.bottom_i}
}this.coordsToGridUndockWindow_processing=false;
if(this.contentPanel&&this.contentPanel.redraw){this.contentPanel.redraw(100)
}this.dockContainer.enableSaveDeleteTemplate();
this.dockContainer.enableToolbarsItems()
},coordsAdjust:function(){if(!this.coords_i){return
}this.coordsAdjust_processing=true;
var a=getAbsolutePosition(this.dockContainer.body.dom);
var b=this.dockContainer.coordsToGrid_fromIndexes(this.coords_i,this.dockState=="undock"?a:null);
if(b.ok){if(this.dockState=="undock"){this.setSize(b.size.width,b.size.height-this._headerHeight);
++this._counterDisable_onMoveUndockWindow;
this.undockWindow.setPosition(b.position[0]-this._undockWindow_positionContent[0]-1,b.position[1]-this._undockWindow_positionContent[1]+this._headerHeight-1);
++this._counterDisable_onResizeUndockWindow;
this.undockWindow.setSize(b.size.width+this._undockWindow_incSizeContent[0],b.size.height-this._headerHeight+this._undockWindow_incSizeContent[1])
}else{this.setPosition(b.position[0],b.position[1]);
this.setSize(b.size.width,b.size.height)
}}this.coordsAdjust_processing=false;
if(this.contentPanel&&this.contentPanel.redraw){this.contentPanel.redraw(100)
}},onAfterRender:function(){this.header.getEl().dom.style.padding=2;
if(this.dockState=="undock"){this.hideHeader(true)
}this.dockContainer.onAfterAddPanel()
},onAfterRenderContentPanel:function(){if(this.autoopenSetup){this.contentPanel.showSetup()
}else{if(this.contentPanel&&this.contentPanel.setupValues){this.contentPanel.createContentAndStartRefreshTimer()
}}this.setPanelTitle()
},onClose:function(){this.dockContainer._unregisterItemPanel(this);
this.dockContainer.enableSaveDeleteTemplate();
this.dockContainer.onAfterRemovePanel()
},onDestroy:function(){this.dockContainer._unregisterItemPanel(this);
this.dockContainer.enableSaveDeleteTemplate();
Ext.TaskManager.stop(this.refreshInfoTask);
this.dockContainer.onAfterRemovePanel()
},onShowUndockWindow:function(){var c=this.getAbsolutePosition();
var b=this.undockWindow.getAbsolutePosition();
this._undockWindow_positionContent=[c[0]-b[0],c[1]-b[1]];
var d=this.getSize();
var a=this.undockWindow.getSize();
this._undockWindow_incSizeContent=[a.width-d.width,a.height-d.height];
this.hideHeader(true);
if(this.undockWindow.doSyncPosition){this.syncPositionUndockWindow();
this.undockWindow.doSyncPosition=false
}if(this.undockWindow.doCoordsToGrid){this.coordsToGridUndockWindow();
this.undockWindow.doCoordsToGrid=false
}},onBeforeCloseUndockWindow:function(){if(this.closeConfirmed){return(true)
}else{Ext.Msg.confirm(lang.questionText,this.findLangS("text","questionClosePanel")+" '"+this._title+"' ?",function(a){if(a=="yes"){this.closeConfirmed=true;
this.undockWindow.close()
}},this);
return(false)
}},onDragStartUndockWindow:function(){this.draggingUndockWindow=true
},onDragEndUndockWindow:function(){this.draggingUndockWindow=false;
this.coordsToGridUndockWindow()
},onResizeUndockWindow:function(){if(this._createUndockWindow_processing||this.coordsAdjust_processing){return
}if(this._counterDisable_onResizeUndockWindow>0){--this._counterDisable_onResizeUndockWindow
}else{this.coordsToGridUndockWindow()
}},onMoveUndockWindow:function(){if(this._createUndockWindow_processing||this.coordsAdjust_processing){return
}if(this._counterDisable_onMoveUndockWindow>0){--this._counterDisable_onMoveUndockWindow
}else{if(!this.draggingUndockWindow){this.coordsToGridUndockWindow()
}}},createTitle:function(b,c){var a="";
if(this.contentPanel&&this.contentPanel.isReady()&&!this.contentPanel.isPaused()&&!this.contentPanel.isLoading()&&this.contentPanel.enableRefresh()){timeToRefresh=this.contentPanel.getTimeToRefresh();
if(timeToRefresh>0){a=this.contentPanel.getTimeToRefresh(true)
}}return('<table cellspacing="0" cellpadding="0" style="width: 100%; padding: 0;"><tr><colgroup><col width="100%"/><col width="0%"/></colgroup><td class="x-title x-panel-header-title x-panel-header-title-default" style="white-space: nowrap; text-overflow:ellipsis; overflow: hidden; max-width:1px; padding-right: 5px;">'+b+'</td><td style="white-space: nowrap;"><table cellspacing="0" cellpadding="0"><tr style="height: 17px;">'+(this.contentPanel&&this.contentPanel.isReady()&&this.contentPanel.createTitle?this.contentPanel.createTitle(this,c):"")+(this.contentPanel&&(this.contentPanel.isReady()||this.contentPanel.isContentCreating())&&this.contentPanel&&this.contentPanel.setupValues&&this.contentPanel.setupValues.typeTimeInterval&&(this.contentPanel.setupValues.typeTimeInterval!="custom"||this.contentPanel.setupValues.last_days||this.contentPanel.setupValues.last_minutes)?'<td><span id="'+this.id+'_title_info_2" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).onClickSetInterval([event.clientX,event.clientY]);" style="white-space: nowrap; cursor: pointer; font: '+__font_Grid+'; color: #555; margin-right: 3px;" data-qtip="'+this.findLangS("tooltip","setInterval")+'" >'+(this.contentPanel.setupValues.typeTimeInterval!="custom"?getDataArrayItem(this.contentPanel.getTimeIntervalsData(),this.contentPanel.setupValues.typeTimeInterval,0,1):(this.contentPanel.setupValues.last_days?this.contentPanel.setupValues.last_days+" "+lang.days:"")+(this.contentPanel.setupValues.last_days&&this.contentPanel.setupValues.last_minutes?", ":"")+(this.contentPanel.setupValues.last_minutes?this.contentPanel.setupValues.last_minutes+" "+lang.minutes:""))+'</span></td><td><img src="images/icon/time_grey.png" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).onClickSetInterval([event.clientX,event.clientY]);" width="16" style="cursor: pointer; margin-top: 1px; margin-right: 15px;" data-qtip="'+this.findLangS("tooltip","setInterval")+'" ></td>':"")+(this.contentPanel&&(this.contentPanel.isReady()||this.contentPanel.isContentCreating())?'<td><img src="'+(this.contentPanel.isPaused()?"images/icon/paused.png":"images/icon/pause.png")+'" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).onClickPause([event.clientX,event.clientY]);" width="14" style="white-space: nowrap; cursor: pointer; margin-top: 1px; margin-right: 6px;" data-qtip="'+this.findLangS("tooltip",this.contentPanel.isPaused()?"resume":"pause")+'" ></td>':"")+(this.contentPanel&&(this.contentPanel.isReady()||this.contentPanel.isContentCreating())?'<td><img src="'+(this.contentPanel.isLoading()?"images/icon/refresh_active.gif":__extjs_images_path()+"grid/refresh.gif")+'" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).onClickRefresh([event.clientX,event.clientY]);" width="14" style="cursor: pointer; margin-top: 1px; margin-right: 3px;" data-qtip="'+this.findLangS("tooltip","refresh")+'" ></td><td style="width: 50px;"><span id="'+this.id+'_title_info_1" style="font: '+__font_Grid+'; color: #555; margin-right: 3px;">'+a+"</span></td>":"")+(!user_dashboard_read_only()?'<td><img src="images/icon/pin'+(this.dockState=="dock"?"_stuck":"")+'.png" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).dockUndock();" width="15" style="cursor: pointer; margin-left: 4px; margin-right: 4px;" data-qtip="'+this.findLangS("tooltip",this.dockState=="dock"?"undock":"dock")+'" ></td>':"")+(!user_dashboard_read_only()?'<td><img src="images/icon/wrench_gray.png" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).panelSetup();" width="14" style="cursor: pointer; margin-left: 4px; margin-right: '+(this.dockState=="undock"?4:3)+'px;" data-qtip="'+this.findLangS("tooltip","panelSetup")+'" ></td>':"")+(this.dockState=="dock"&&!user_dashboard_read_only()?'<td><img src="images/icon/close.png" panelid="'+c+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).closePanel();" width="12" style="cursor: pointer; margin-top: 1px; margin-left: 4px;" data-qtip="'+this.findLangS("tooltip","close")+'" ></td>':"")+"</tr></table></td></tr></table>")
},setPanelTitle:function(){var a=this.createTitle(this._title,this.id);
if(this.dockState=="undock"){if(this.undockWindow){this.undockWindow.setTitle(a)
}}else{this.setTitle(a)
}if(this.contentPanel.repairLayout){this.contentPanel.repairLayout()
}},refreshInfo:function(){if(this.contentPanel&&this.contentPanel.isReady()&&!this.contentPanel.isPaused()&&this.contentPanel.checkOkTimer){this.contentPanel.checkOkTimer()
}var b=Ext.get(this.id+"_title_info_1");
if(b&&b.dom){var a="";
if(this.contentPanel&&this.contentPanel.isReady()&&!this.contentPanel.isPaused()&&!this.contentPanel.isLoading()&&this.contentPanel.enableRefresh()){timeToRefresh=this.contentPanel.getTimeToRefresh();
if(timeToRefresh<=0){timeToRefresh="";
if(timeToRefresh<-5){this.contentPanel.startRefreshTimer(1)
}}else{a=this.contentPanel.getTimeToRefresh(true)
}}b.dom.innerHTML=a
}},enableRefresh:function(){return(this.dockContainer.enableRefresh())
},refresh:function(){if(this.contentPanel&&this.contentPanel.isReady()){this.contentPanel.refresh()
}},createContent:function(){if(this.contentPanel&&this.contentPanel.isReady()){this.contentPanel.createContent()
}},reactivate:function(){if(this.contentPanel){this.contentPanel.startRefreshTimer(1)
}},getConfigData:function(b){if(this.coords_i&&this.contentPanel){var a={type:this.panelType,coords:this.coords_i};
if(this.contentPanel.isReady()&&this.contentPanel.setupValues){a.setup=this.contentPanel.getSetupValues?this.contentPanel.getSetupValues(b):this.contentPanel.setupValues
}else{a.title=this._title
}if(this.dockState=="undock"){a.undock=true
}return(a)
}return(null)
}});
Ext.define("Dashboard_d.Panel",{extend:"Ext.Panel",subsystem:"dashboard_d",alias:"widget.Dashboard_dPanelX",gridDensityH:11,gridDensityV:11,gridSplitMargin:[1,0],panelCounter:1,constructor:function(a){var c=[];
if(!user_dashboard_read_only()){c.push({iconCls:"icon_add",text:this.findLangS("button","addPanel"),handler:this.newItemPanel,scope:this,_btnId:"addPanel"},{iconCls:"icon_remove",text:this.findLangS("button","removeAllPanels"),handler:this.removeAllPanels,scope:this,_btnId:"removeAllPanels",disabled:true})
}c.push({iconCls:"icon_refresh_blue",text:this.findLangS("button","reloadAll"),handler:this.reloadAllPanels,scope:this,_btnId:"reloadAllPanels"});
if(!user_dashboard_read_only()){c.push("-",{iconCls:"icon_layout_add",text:this.findLangS("button","newDashboard"),_btnId:"newDashboard",menu:{items:[{text:this.findLangS("button","newLayout"),_menuId:"newDashboard_newLayout",handler:this.newDashboard,scope:this},{text:this.findLangS("button","duplicate"),_menuId:"newDashboard_duplicate",handler:this.duplicate,scope:this}],listeners:{scope:this,beforeshow:function(h){for(var f=0;
f<h.items.length;
f++){var g=h.items.get(f);
if(g._menuId=="newDashboard_duplicate"){g.enableIf(this.regItemsPanel&&this.regItemsPanel.length)
}}}}}})
}var b=this;
this.comboTemplates=new Ext.ux.combobox.ComboBoxAT({name:"templates",_tpl:"{textMenu}",width:__width_ColumnChar(45),aData:{data:[],fields:["id","name","user_id","user_name","textMenu","config","priv","user_ids","group_ids","default"]},listeners:{scope:this,select:function(f){this.setTemplate(f.getValue())
},afterrender:function(){this.comboTemplates.disable()
}},disabled:true,onTriggerClick:function(){this.onTriggerClick_tree({onSelect:function(g,f){b.setTemplate(g,f.folder?f:undefined)
},loadTemplates:function(){ajaxSafeRequest({scope:b,url:"php/model/utilities.php",params:{task:"getDashboardTemplates"},success:function(f){if(this.diffTemplates(f.dashboardTemplates)){this.comboTemplates.store.removeAll();
this.fillStoreTemplates(f.dashboardTemplates,f.dashboardSetupValues)
}}})
}})
},onFocusLeave:function(f){this.onFocusLeave_tree(f)
},dataType:"dashboards",triggers:user_is_admin()||user_can_edit_all_templates()?{table:{cls:"x-form-table-trigger",handler:this.treeArrangeTemplates,scope:this,weight:-2}}:{}});
this.btnSetDefaultTemplate=new Ext.Button({text:this.findLangS("button","setDefaultTemplate"),handler:function(f){this.setDefaultTemplate()
},scope:this,disabled:true});
this.btnSaveTemplate=new Ext.Button({iconCls:"icon_save",text:this.findLangS("button","saveTemplate"),handler:function(f){this.saveTemplate()
},scope:this,disabled:true});
this.btnDeleteTemplate=new Ext.Button({iconCls:"icon_delete",text:this.findLangS("button","deleteTemplate"),handler:function(f){this.deleteTemplate()
},scope:this,disabled:true});
this.btnUrlDashboard=new Ext.Button({iconCls:"icon_link",text:this.findLangS("button","urlDashboard"),tooltip:this.findLangS("button_help","urlDashboard"),handler:function(f){this.urlDashboard()
},scope:this,disabled:true});
c.push({xtype:"displayfield",value:this.findLangS("button","selectTemplate")+":",fieldCls:"x-form-item-label",fieldStyle:{paddingTop:0,marginTop:-1,marginLeft:4,color:"#333"}},this.comboTemplates,this.btnSetDefaultTemplate);
if(!user_dashboard_read_only()){c.push(this.btnSaveTemplate,this.btnDeleteTemplate)
}c.push(this.btnUrlDashboard);
c.push("-");
var d=[{text:this.findLangS("menu","hideMenu"),xtype:"menucheckitem",_menuId:"hideMenu"},{text:this.findLangS("menu","passiveCharts"),xtype:"menucheckitem",_menuId:"passiveCharts"}];
if(user_is_admin()){d.push({text:this.findLangS("menu","chartCacheSettings"),_menuId:"chartCacheSettings"})
}if(user_is_admin()||user_can_edit_all_templates()){d.push({text:this.findLangS("menu","arrangeDashboardsInTree"),_menuId:"arrangeDashboardsInTree"})
}c.push({text:this.findLangS("button","settings"),tooltip:this.findLangS("button_help","settings"),iconCls:"icon_wrench",_btnId:"settings",menu:{defaults:{scope:this,handler:this.settingsHandler},items:d,listeners:{beforeshow:function(h){for(var g=0;
g<h.items.length;
g++){var f=h.items.get(g);
switch(f._menuId){case"hideMenu":f.setChecked(Ext.getCmp("main-left-panel").collapsed);
break;
case"passiveCharts":f.setChecked(this.passiveCharts);
break
}}},scope:this}}});
if(__wikiUrl){c.push("->",{xtype:"image",src:"images/wiki.png",style:{cursor:"pointer"},listeners:{click:{element:"el",fn:function(){window.open(__wikiUrl+"Dashboardv2")
}}}})
}a=Ext.applyIf(a||{},{id:"Dashboard_d-panel",layout:"absolute",bodyBorder:false,border:false,tbar:{items:c,style:{background:__color_DashboardBackground}},listeners:{scope:this,resize:this.onResize,afterrender:this.onAfterRender,destroy:this.onDestroy},bodyStyle:{background:__color_DashboardBackground}});
if(window.passivecharts){this.passiveCharts=true;
delete window.passivecharts
}this.callParent([a]);
this.serviceTask=Ext.TaskManager.start({run:this.serviceTaskFce,interval:1000,scope:this})
},newItemPanel:function(){var f=this.getFreeRegion();
if(!f){Ext.Msg.alert("",this.findLangS("text","noFreeRegionForNewPanel"));
return
}var b={dockContainer:this,panelId:this.panelCounter++,dockState:f?"dock":"undock"};
var c={left_i:f.cic,right_i:f.cic+f.cols,top_i:f.cir,bottom_i:f.cir+f.rows};
this._coordsToGrid(c);
Ext.apply(b,{x:c.position[0],y:c.position[1],width:c.size.width,height:c.size.height,coords_i:{left:f.cic,right:f.cic+f.cols,top:f.cir,bottom:f.cir+f.rows}});
var a=new Dashboard_d.SelectNewPanelType({dashboardPanel:this,newItemPanelConfig:b});
var d=new Ext.Window({title:this.findLangS("title","selectNewPanelType"),layout:"fit",items:a,border:false,modal:true,closable:true,resizable:false});
d.show()
},removeAllPanels:function(){Ext.Msg.confirm(lang.questionText,this.findLangS("text","msgRemoveAllPanels"),function(a){if(a=="yes"){this.lastTemplateData=null;
this.comboTemplates.setValue(null);
while(this.regItemsPanel.length){if(this.regItemsPanel[0].dockState=="undock"){this.regItemsPanel[0].undockWindow.destroy()
}else{this.removeItemPanel(this.regItemsPanel[0])
}}}},this)
},reloadAllPanels:function(){if(this.regItemsPanel){for(var a=0;
a<this.regItemsPanel.length;
a++){this.regItemsPanel[a].refresh()
}}},createContentAllPanels:function(){if(this.regItemsPanel){for(var a=0;
a<this.regItemsPanel.length;
a++){this.regItemsPanel[a].createContent()
}}},setDeafultUseOnlyCacheAllPanels:function(){if(this.regItemsPanel){for(var a=0;
a<this.regItemsPanel.length;
a++){if(this.regItemsPanel[a].contentPanel.setDefaultUseOnlyCache){this.regItemsPanel[a].contentPanel.setDefaultUseOnlyCache()
}}}},newDashboard:function(){var a=new Dashboard_d.NewDashboardForm({dashboardPanel:this});
var b=new Ext.Window({title:this.findLangS("title","newDashboard"),layout:"fit",items:a,border:false,modal:true,closable:true,resizable:false});
b.show()
},duplicate:function(){this.saveTemplate(null,true)
},createNewDashboard:function(a){this.comboTemplates.setValue(null);
while(this.regItemsPanel.length){if(this.regItemsPanel[0].dockState=="undock"){this.regItemsPanel[0].undockWindow.destroy()
}else{this.removeItemPanel(this.regItemsPanel[0])
}}var g=a.layout=="3x2"?3:a.layout=="2x2"?2:a.layout=="2x1"?2:0;
var n=a.layout=="3x2"?2:a.layout=="2x2"?2:a.layout=="2x1"?1:0;
for(var c=0;
c<6;
c++){var b=parseInt(c%3)+1;
var m=parseInt(c/3)+1;
if(m<=n&&b<=g){var k=a["panel_"+(c+1)+"_title"];
var d=a["panel_"+(c+1)+"_type"];
var l={title:k,panelType:d,dockState:"dock",dockContainer:this,autoopenSetup:false,panelId:this.panelCounter++};
var f={cic:((this.gridDensityH+1)/g)*(b-1),cir:((this.gridDensityV+1)/n)*(m-1),cols:(this.gridDensityH+1)/g,rows:(this.gridDensityV+1)/n};
var h={left_i:f.cic,right_i:f.cic+f.cols,top_i:f.cir,bottom_i:f.cir+f.rows};
this._coordsToGrid(h);
Ext.apply(l,{x:h.position[0],y:h.position[1],width:h.size.width,height:h.size.height,coords_i:{left:f.cic,right:f.cic+f.cols,top:f.cir,bottom:f.cir+f.rows}});
new Dashboard_d.ItemPanel(l)
}}this.saveTemplateAjax({name:a.name,priv:a["private"]},true,0,null,this.getConfigData())
},addItemPanel:function(a){this._registerItemPanel(a);
this._addItemPanel(a)
},_registerItemPanel:function(a){if(!Ext.isDefined(this.regItemsPanel)){this.regItemsPanel=[]
}this.regItemsPanel.push(a)
},_addItemPanel:function(a){this.add(a)
},removeItemPanel:function(a){a._removing=true;
if(a.contentPanel){a.contentPanel._removing=true
}this._unregisterItemPanel(a);
this._removeItemPanel(a)
},_unregisterItemPanel:function(a){for(var b=0;
b<this.regItemsPanel.length;
b++){if(this.regItemsPanel[b].id==a.id){this.regItemsPanel.splice(b,1);
break
}}},_removeItemPanel:function(a){this.remove(a)
},getRegisterPanelIndex:function(a){if(this.regItemsPanel){for(var b=0;
b<this.regItemsPanel.length;
b++){if(this.regItemsPanel[b].id==a.id){return(b)
}}}return(false)
},coordsToGrid:function(a,d,c){a=cloneObject(a);
if(c){a[0]-=c[0];
a[1]-=c[1]
}var b={left_i:this.coordToGrid_index(a[0]),top_i:this.coordToGrid_index(a[1],true),right_i:this.coordToGrid_index(a[0]+d.width),bottom_i:this.coordToGrid_index(a[1]+d.height,true)};
b.ok=b.left_i!==null&&b.top_i!==null&&b.right_i!==null&&b.bottom_i!==null&&b.left_i!=b.right_i&&b.top_i!=b.bottom_i;
if(b.ok){this._coordsToGrid(b,a,d,c)
}return(b)
},coordsToGrid_fromIndexes:function(c,b){var a={left_i:c.left,top_i:c.top,right_i:c.right,bottom_i:c.bottom};
a.ok=true;
return(this._coordsToGrid(a,null,null,b))
},_coordsToGrid:function(b,d,c,a){Ext.apply(b,{left:this.coordToGrid_fromIndex(b.left_i),top:this.coordToGrid_fromIndex(b.top_i,true),right:this.coordToGrid_fromIndex(b.right_i),bottom:this.coordToGrid_fromIndex(b.bottom_i,true)});
if(b.left_i>0){b.left+=this.gridSplitMargin[0]
}if(b.top_i>0){b.top+=this.gridSplitMargin[0]
}if(b.right_i<this.grid[0].length-1){b.right-=this.gridSplitMargin[1]
}if(b.bottom_i<this.grid[1].length-1){b.bottom-=this.gridSplitMargin[1]
}b.move=!d||b.left!=d[0]||b.top!=d[1];
if(a){b.left+=a[0];
b.right+=a[0];
b.top+=a[1];
b.bottom+=a[1]
}b.position=[b.left,b.top];
b.size={width:b.right-b.left,height:b.bottom-b.top};
b.resize=!c||b.size.width!=c.width||b.size.height!=c.height;
return(b)
},coordToGrid:function(c,b){var a=this.coordToGrid_index(c,b);
if(a===null){return(null)
}else{return(this.coordToGrid_fromIndex(a,b))
}},coordToGrid_fromIndex:function(a,b){if(a===null){return(null)
}else{return(this.grid[b?1:0][a])
}},coordToGrid_index:function(d,c){var b=this.grid[c?1:0];
if(d<b[0]){return(0)
}if(d>b[b.length-1]){return(b.length-1)
}for(var a=0;
a<b.length-1;
a++){if(d>=b[a]&&d<=b[a+1]){if(d-b[a]<b[a+1]-d){return(a)
}else{return(a+1)
}}}return(null)
},setGrid:function(){var b=this.body.getSize();
this.grid=[];
for(var d=0;
d<2;
d++){var c=d?b.height:b.width;
var f=d?this.gridDensityV:this.gridDensityH;
this.grid[d]=[];
this.grid[d].push(0);
for(var a=0;
a<f;
a++){this.grid[d].push(Math.round(c/(f+1)*(a+1)))
}this.grid[d].push(c)
}},getFreeRegion:function(){var c=[];
for(var f=0;
f<this.gridDensityV+1;
f++){c[f]=[];
for(var b=0;
b<this.gridDensityH+1;
b++){c[f][b]={}
}}if(this.regItemsPanel){for(var g=0;
g<this.regItemsPanel.length;
g++){if(this.regItemsPanel[g].coords_i){var h=this.regItemsPanel[g].coords_i;
for(var f=h.top;
f<h.bottom;
f++){for(var b=h.left;
b<h.right;
b++){if(!c[f][b].panel){c[f][b].panel=this.regItemsPanel[g].id
}}}}}}var a=null;
for(var f=0;
f<this.gridDensityV+1;
f++){for(var b=0;
b<this.gridDensityH+1;
b++){if(!c[f][b].panel){var d=this.getMaxFreeRegionAt(f,b,c);
if(d&&(!a||d.rows*d.cols>a.rows*a.cols)){a=d
}}}}return(a)
},getMaxFreeRegionAt:function(a,g,k){if(a>this.gridDensityV-1||g>this.gridDensityH-1){return(null)
}var b=null;
for(var l=2;
l+a<=this.gridDensityV+1&&l<=(this.gridDensityV+1)/2;
l++){for(var h=2;
h+g<=this.gridDensityH+1&&h<=(this.gridDensityH+1)/2;
h++){var f=true;
for(var d=0;
d<l&&f;
d++){for(var c=0;
c<h&&f;
c++){if(k[d+a][c+g].panel){f=false
}}}if(f&&(!b||l*h>b.rows*b.cols)){b={cir:a,cic:g,rows:l,cols:h}
}}}return(b)
},onAfterRender:function(){this.loadTemplates()
},onDestroy:function(){Ext.TaskManager.stop(this.serviceTask)
},onResize:function(){this.setGrid();
if(this.regItemsPanel){for(var a=0;
a<this.regItemsPanel.length;
a++){this.regItemsPanel[a].coordsAdjust()
}}},enableRefresh:function(){return(this.isVisible())
},reactivate:function(){if(this.regItemsPanel){for(var a=0;
a<this.regItemsPanel.length;
a++){if(this.regItemsPanel[a].dockState=="undock"&&this.regItemsPanel[a].undockWindow){this.regItemsPanel[a].undockWindow.show()
}this.regItemsPanel[a].reactivate()
}}},changeTimezone:function(){this.reloadAllPanels()
},deactivate:function(){if(this.regItemsPanel){for(var a=0;
a<this.regItemsPanel.length;
a++){if(this.regItemsPanel[a].dockState=="undock"&&this.regItemsPanel[a].undockWindow){this.regItemsPanel[a].undockWindow.hide()
}}}},getConfigData:function(c){config=null;
if(this.regItemsPanel){for(var b=0;
b<this.regItemsPanel.length;
b++){var a=this.regItemsPanel[b].getConfigData(c);
if(a){if(!config){config=[]
}config.push(a)
}}}return(config)
},setFromConfig:function(a){if(!user_can_3d_rtp_charts()){for(var b=0;
b<a.length;
b++){if(a[b].type=="chart_3d_rtp_stat"){a.splice(b,1);
--b
}}}this.enableSaveDeleteTemplate_disable=true;
if(this.regItemsPanel){while(this.regItemsPanel.length){if(this.regItemsPanel[0].dockState=="undock"){this.regItemsPanel[0].undockWindow.destroy()
}else{this.removeItemPanel(this.regItemsPanel[0])
}}}if(!a||!a.length){this.enableSaveDeleteTemplate_disable=false;
return
}this.panelCounter=1;
for(var b=0;
b<a.length;
b++){var d={left_i:a[b].coords.left,right_i:a[b].coords.right,top_i:a[b].coords.top,bottom_i:a[b].coords.bottom};
this._coordsToGrid(d);
var c={panelType:a[b].type,title:a[b].setup?a[b].setup.title:a[b].title,dockContainer:this,panelId:this.panelCounter++,dockState:a[b].undock?"undock":"dock",x:d.position[0],y:d.position[1],width:d.size.width,height:d.size.height,coords_i:a[b].coords,setupValues:a[b].setup};
new Dashboard_d.ItemPanel(c)
}this.enableSaveDeleteTemplate_disable=false;
this.enableSaveDeleteTemplate()
},setTemplate:function(a,b){var c=this.comboTemplates.findRecordByValue(a*1);
if(c){this.lastTemplateData=null;
this.setFromConfig(Ext.decode(c.data.config));
this._lastSelectTemplateData=c.data;
this._lastSelectTemplateFolderData=b
}else{this._lastSelectTemplateData=c.data;
this._lastSelectTemplateFolderData=b
}},loadTemplates:function(a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getDashboardTemplates"},success:function(c){this.fillStoreTemplates(c.dashboardTemplates,c.dashboardSetupValues);
if(c.defaultTemplate&&this.comboTemplates.findRecordByValue(c.defaultTemplate*1)){this.defaultTemplate=c.defaultTemplate
}if(b){this.comboTemplates.setValue(b*1);
this.setTemplate(b)
}else{if(window.dashboard||window.dashboard_id){for(var d=0;
d<this.comboTemplates.store.getCount();
d++){var f=this.comboTemplates.store.getAt(d).data;
if(window.dashboard_id?f.id==window.dashboard_id:f.name==window.dashboard){this.comboTemplates.setValue(f.id);
this.setTemplate(f.id);
break
}}delete window.dashboard;
delete window.dashboard_id
}else{if(this.defaultTemplate){this.comboTemplates.setValue(this.defaultTemplate*1);
this.setTemplate(this.defaultTemplate)
}else{this.comboTemplates.setValue(100001);
this.setTemplate(100001)
}}}this.comboTemplates.enable();
this.enableSaveDeleteTemplate()
}})
},fillStoreTemplates:function(d,g){if(g){for(var c=0;
c<g.length;
c++){g[c].params=Ext.decode(g[c].name);
g[c].config=Ext.JSON.decode(g[c].config)
}}if(window.default_dashboard_configuration){var f=Ext.decode(window.default_dashboard_configuration);
if(f){for(var c=0;
c<f.length;
c++){if(!f[c].rrd||window.vpmanagerhost){var b=f[c].config;
if(f[c].rrd){b=Ext.decode(b);
for(var a=0;
a<b.length;
a++){b[a].setup.sensor_id=window.localSensorId
}b=Ext.encode(b)
}this.addTemplate({id:100000+f[c].id,name:f[c].name,user_id:null,user_name:null,textMenu:f[c].name,config:b,"default":true},false,false,g)
}}}}if(d){for(var c=0;
c<d.length;
c++){this.addTemplate(d[c],false,false,g)
}}},addTemplate:function(h,f,c,k){var g=0;
for(var d=0;
d<this.comboTemplates.store.getCount();
d++){if(this.comboTemplates.store.getAt(d).data.id>100000){++g
}else{if(this.comboTemplates.store.getAt(d).data.name<=h.name){++g
}else{break
}}}if(k){var b=Ext.decode(h.config);
for(var d=0;
d<b.length;
d++){if(b[d].setup){if(Ext.isDefined(b[d].setup.useOnlyCache)){delete b[d].setup.useOnlyCache
}for(var a=0;
a<k.length;
a++){if(k[a].params.id==h.id&&k[a].params.panelIndex==(d+1)){b[d].setup[k[a].params.setupValueName]=k[a].config
}}}}h.config=Ext.encode(b)
}this.comboTemplates.addMenuItem({id:h.id*1,name:h.name,user_id:h.user_id*1,user_name:h.user_name,textMenu:(h.id*1>100000?'<span style="color: blue;">':f?'<span style="color: green;">':"")+h.name+(h.user_name?'<span style="font-size: 70%;"> / '+h.user_name+"</span>":"")+(h.id*1>100000||f?"</span>":""),config:h.config,priv:h.priv*1,user_ids:h.user_ids,group_ids:h.group_ids,"default":h["default"]},c,false,g)
},setDefaultTemplate:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"dashboard",name:"default",config:this.comboTemplates.getValue(),user_id:user_id(),enableUpdate:true})},success:function(){this.defaultTemplate=this.comboTemplates.getValue();
this.enableSaveDeleteTemplate()
}})
},saveTemplate:function(n,d,a,b){var k=this.comboTemplates.getValue();
var c=this.comboTemplates.findRecordByValue(k);
var m=this.getTemplateBaseFieldsData(k,c);
if(b){m.folder_id=b.id;
m.folder_name=b.name
}if(!user_is_admin()&&!Ext.isDefined(n)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCountOtherUsersInGroup"},success:function(o){this.saveTemplate(o.count,d,a,b)
}});
return
}if(!Ext.isDefined(a)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"treeArrange",params:Ext.encode({subTask:"existsFolder",dataType:"dashboards",dataId:m.id})},success:function(o){this.saveTemplate(n,d,o.rslt*1,o.folder)
}});
return
}var h=[{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","templateName"),value:d?"":m.name,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),disabled:!d&&k&&c,allowBlank:false}];
if(a&&!(!d&&k&&c)){h.push({xtype:"CBX_treeArrange",name:"tree_arrange_folder",fieldLabel:this.findLangS("field","templateFolder"),width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),dataType:"dashboards",editable:false,_clearButton:true,emptyText:"root"})
}h.push({xtype:"checkbox",name:"priv",fieldLabel:this.findLangS("field","privateTemplate"),checked:m.priv,labelWidth:__width_FieldChar(15),listeners:{change:function(q){var o=q.getValue();
var r=l.getForm().findField("user_ids");
if(r){r.enableIf(!o)
}var p=l.getForm().findField("group_ids");
if(p){p.enableIf(!o)
}}}});
if(user_is_admin()||n){h.push({xtype:"ComboBoxX",name:"user_ids",fieldLabel:this.findLangS("field","showForUsers"),value:m.user_ids,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,disabled:m.priv,_autoDisableIfEmpty:true})
}if(user_is_admin()){h.push({xtype:"ComboBoxX",name:"group_ids",fieldLabel:this.findLangS("field","showForGroups"),value:m.group_ids,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"group_list",recordStruct:rsGroupList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,disabled:m.priv,_autoDisableIfEmpty:true})
}var l=new Ext.FormPanel({frame:true,border:false,items:h,buttons:[{text:this.findLangS("button","save"),iconCls:"icon_save",handler:g,scope:this},{text:this.findLangS("button","cancel"),iconCls:"icon_cancel",handler:function(){l.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){if(a&&m&&m.folder_id&&m.folder_name){var o=l.getForm().findField("tree_arrange_folder");
if(o){o.setValue(m.folder_id,m.folder_name)
}}Ext.create("Ext.util.KeyNav",l.el,{enter:g,scope:this})
}}});
var f=new Ext.Window({layout:"fit",items:l,border:false,title:this.findLangS("title",d?"duplicateTemplate":(k&&c?"editTemplate":"saveTemplate")),modal:true,closable:true,listeners:{scope:this,activate:function(){l.getForm().findField("name").focus(false,200)
}}});
f.show();
function g(){if(l.getForm().isValid()){var q=["name","priv","user_ids","group_ids"];
if(a){q.push("tree_arrange_folder")
}var p={};
for(var o=0;
o<q.length;
o++){var r=l.getForm().findField(q[o]);
if(r){p[q[o]]=r.getValue()
}}if(a&&!p.tree_arrange_folder){p.tree_arrange_folder=0
}this.saveTemplateAjax(p,k>0&&!d,k,l,this.getConfigData())
}}},forceSaveTemplate:function(){var b=this.comboTemplates.getValue();
var a=this.comboTemplates.findRecordByValue(b);
var c=this.getTemplateBaseFieldsData(b,a);
this.saveTemplateAjax(c,b>0,b,null,this.getConfigData())
},getTemplateBaseFieldsData:function(b,a){var c={};
if(b&&a){c={id:a.data.id,name:a.data.name,priv:a.data.priv,user_ids:a.data.user_ids,group_ids:a.data.group_ids}
}else{if(this.lastTemplateData){c={id:this.lastTemplateData.id,name:this.lastTemplateData.name,priv:this.lastTemplateData.priv,user_ids:this.lastTemplateData.user_ids,group_ids:this.lastTemplateData.group_ids}
}}if(c.name&&this._lastSelectTemplateFolderData&&this._lastSelectTemplateFolderData.id&&this._lastSelectTemplateFolderData.name&&this._lastSelectTemplateData&&this._lastSelectTemplateData.id==c.id&&this._lastSelectTemplateData.name==c.name){Ext.apply(c,{folder_id:this._lastSelectTemplateFolderData.id,folder_name:this._lastSelectTemplateFolderData.name})
}return(c)
},saveTemplateAjax:function(a,c,g,f,d){var b=arguments;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({id:g,subsystem:"dashboards",name:a.name,tree_arrange_folder:a.tree_arrange_folder,user_id:user_id(),priv:a.priv,user_ids:a.user_ids,group_ids:a.group_ids,config:Ext.encode(d),enableUpdate:c})},success:function(h){var k=h.id;
this.addTemplate(h.row,true,true);
this.comboTemplates.enable();
this.comboTemplates.setValue(k);
this.enableSaveDeleteTemplate();
if(f){f.destroyWindow()
}this.saveSetupValuesAjax(k,d,"useOnlyCache");
this.createContentAllPanels()
},error:function(k,h){if(k.error=="name_duplication"){Ext.Msg.confirm(this.findLangS("title","msgDuplicationName"),this.findLangS("text","msgDuplicationName"),function(l){if(l=="yes"){var m=b;
m[1]=true;
this.saveTemplateAjax.apply(this,m)
}else{if(f){f.destroyWindow()
}}},this)
}else{alertAjaxError(h)
}},failure:function(){if(f){f.getEl().unmask()
}else{this.getEl().unmask()
}},maskEl:f||this})
},saveSetupValues:function(d,a){var c=this.comboTemplates.getValue();
var b=this.comboTemplates.findRecordByValue(c);
if(c&&b){this.saveSetupValuesAjax(c,this.getConfigData(),d,a)
}},saveSetupValuesAjax:function(g,d,f,a){if(a){var c=this.getRegisterPanelIndex(a);
if(c!==false){if(d[c].setup&&Ext.isDefined(d[c].setup[f])){this.saveSetupValueAjax(g,c,d[c].setup[f],f)
}}}else{for(var b=0;
b<d.length;
b++){if(d[b].setup&&Ext.isDefined(d[b].setup[f])){this.saveSetupValueAjax(g,b,d[b].setup[f],f)
}}}},saveSetupValueAjax:function(d,b,a,c){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"dashboards_setup_value",name:Ext.encode({id:d*1,panelIndex:b+1,setupValueName:c}),config:Ext.encode(a),enableUpdate:true})}})
},deleteTemplate:function(){var a=this.comboTemplates.findRecordByValue(this.comboTemplates.getValue());
Ext.Msg.confirm(this.findLangS("title","msgDeleteTemplate"),this.findLangS("text","msgDeleteTemplate"),function(b){if(b=="yes"){this.lastTemplateData=null;
this.deleteTemplateAjax(a.data.id)
}},this)
},deleteTemplateAjax:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"deleteTemplate",params:Ext.encode({id:a})},success:function(b){this.comboTemplates.deleteMenuItem(a);
this.comboTemplates.setValue(null);
if(!this.comboTemplates.store.getCount()){this.comboTemplates.disable()
}this.enableSaveDeleteTemplate()
}})
},diffTemplates:function(c){if(!c){return(true)
}var d=0;
if(window.default_dashboard_configuration){var h=Ext.decode(window.default_dashboard_configuration);
d=h.length
}if(this.comboTemplates.store.getCount()-d!=c.length){return(true)
}c.sort(function(l,k){if(l.name<k.name){return -1
}if(l.name>k.name){return 1
}return 0
});
for(var b=0;
b<c.length;
b++){var g=Ext.decode(c[b].config);
for(var a=0;
a<g.length;
a++){if(g[a].setup){if(Ext.isDefined(g[a].setup.useOnlyCache)){delete g[a].setup.useOnlyCache
}}}var f=Ext.decode(this.comboTemplates.store.getAt(b+d).data.config);
for(var a=0;
a<f.length;
a++){if(f[a].setup){if(Ext.isDefined(f[a].setup.useOnlyCache)){delete f[a].setup.useOnlyCache
}}}if(Ext.encode(g)!=Ext.encode(f)){return(true)
}}return(false)
},urlDashboard:function(){var b=this.comboTemplates.findRecordByValue(this.comboTemplates.getValue());
if(!b){return
}var a=window.location.origin+window.location.pathname+"?dashboard="+encodeURIComponent(b.data.name)+"&dashboard_id="+encodeURIComponent(b.data.id)+"&hidemenu=1";
if(this.passiveCharts){a+="&passivecharts=1"
}var c='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+a+'" target="_blank">'+a+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.show({title:findLangS(this.subsystem,"title","viewUrl"),msg:c,buttons:Ext.Msg.OK,minWidth:540,width:540,fn:function(){var d=Ext.getCmp("copy_button");
if(d){d.destroy()
}}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(d){return(d.clipboardText)
},getClipTextParams:{clipboardText:a},id:"copy_button",renderTo:"copy_button_div"})
},enableSaveDeleteTemplate:function(){if(this.enableSaveDeleteTemplate_disable){return
}var d=this.comboTemplates.getValue();
var c=this.comboTemplates.findRecordByValue(d);
if(c===false){d=null
}var b=this.getConfigData(true);
var f=b?Ext.encode(b):null;
if(d&&c&&c.data){var a=Ext.decode(c.data.config);
this.prepareConfigurationForCompare(a);
this.prepareConfigurationForCompare(b);
if(!compareObjects(a,b)){if(!c.data["default"]){this.lastTemplateData=c.data
}this.comboTemplates.setValue(null);
if(this.lastTemplateData&&this.lastTemplateData.name){this.comboTemplates.setRawValue(this.lastTemplateData.name+" *")
}d=null;
c=null
}}this.btnSetDefaultTemplate.enableIf(d&&(this.defaultTemplate?this.defaultTemplate!=d:d!=100001));
this.btnSaveTemplate.enableIf(f&&d<100000&&(!c||!c.data||!c.data["default"]&&(!c.data.user_id||user_is_admin()||user_can_edit_all_templates()||c.data.user_id==user_id())));
this.btnSaveTemplate.setText(this.findLangS("button",c?"editTemplate":"saveTemplate"));
this.btnSaveTemplate.setIconCls(c?"icon_edit":"icon_save");
this.btnDeleteTemplate.enableIf(d&&d<100000&&c&&c.data&&!c.data["default"]&&(user_is_admin()||user_can_delete_all_templates()||user_id==c.data.user_id));
this.btnUrlDashboard.enableIf(d&&c&&c.data)
},enableToolbarsItems:function(){var a=this.getTopToolbar();
if(!a){return
}var b=this.getTopToolbar().findC("_btnId","removeAllPanels");
if(b){b.enableIf(this.regItemsPanel&&this.regItemsPanel.length)
}},settingsHandler:function(a){switch(a._menuId){case"hideMenu":Ext.defer(function(){Ext.getCmp("main-left-panel")[a.checked?"collapse":"expand"]()
},100,this);
a.ownerCt.hide();
break;
case"passiveCharts":if(a.checked){this.passiveCharts=true
}else{if(this.passiveCharts){delete this.passiveCharts
}}Ext.defer(function(){this.createContentAllPanels()
},100,this);
a.ownerCt.hide();
break;
case"chartCacheSettings":var b=new Ext.Window({layout:"fit",items:new Dashboard.ChartCacheSettings({dashboard:this}),title:this.findLangS("title","chartCacheSettings"),modal:true,closable:true,maximizable:false});
b.show();
break;
case"arrangeDashboardsInTree":this.treeArrangeTemplates();
break
}},treeArrangeTemplates:function(){new Tools.Tree.Arrange.Template({dataType:"dashboards",suppressCondUsersForAdmin:true,animate:false,width:Math.min(Ext.dom.Element.getViewportWidth()*2/3,800),height:Math.min(Ext.dom.Element.getViewportHeight()*2/3,700),autoCreateWindow:{title:this.findLangS("title","arrangeDashboardsInTree"),modal:true,maximizable:true}})
},onAfterAddPanel:function(){this.enableToolbarsItems()
},onAfterRemovePanel:function(){this.enableToolbarsItems()
},serviceTaskFce:function(a){if(!(a%60)&&this.isVisible()){this.loadChartCacheConfiguration()
}},loadChartCacheConfiguration:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getConfigData",params:Ext.encode({type:"dashboardChartCacheConfiguration"})},success:function(a){if(a.data){this.applyChartCacheConfiguration(a.data)
}},error:function(){},failure:function(){}})
},applyChartCacheConfiguration:function(a){var c={dashboard_charts_cache_temporarily_suspended:Ext.isDefined(a.temporarily_suspended)?a.temporarily_suspended*1:false,dashboard_charts_cache_temporarily_autosuspended:Ext.isDefined(a.temporarily_autosuspended)?a.temporarily_autosuspended*1:false,dashboard_charts_cache_temporarily_autosuspended_reason:a.temporarily_autosuspended_reason};
var d=false;
for(var b in c){if(window[b]!=c[b]){d=true;
break
}}if(d){for(var b in c){window[b]=c[b]
}this.createContentAllPanels()
}},prepareConfigurationForCompare:function(b){if(!b){return
}for(var a=0;
a<b.length;
a++){if(window.dashboard_interval&&b[a].setup&&Ext.isDefined(b[a].setup.typeTimeInterval)){delete b[a].setup.typeTimeInterval
}if(b[a].setup&&Ext.isDefined(b[a].setup.useOnlyCache)){delete b[a].setup.useOnlyCache
}if(b[a].setup&&b[a].setup.chartConfig&&Ext.isDefined(b[a].setup.chartConfig.theme)){delete b[a].setup.chartConfig.theme
}}}});
Ext.define("Dashboard_d.SubPanel",{extend:"Ext.Panel",subsystem:"dashboard_d",constructor:function(a){a=Ext.apply(a||{},{border:false,layout:"fit",items:{xtype:"container",layout:{type:"vbox",pack:"center",align:"center"},items:{xtype:"button",text:this.findLangS("title","panelSetup"),iconCls:"icon_wrench_gray",handler:this.showSetup,scope:this}}});
this.callParent([a]);
this.on("destroy",this.onDestroy,this);
this.on("resize",this.onResize,this);
this.baseSetupFields=["title","typeTimeInterval","last_days","last_minutes","prevInterval","refreshPeriod","intervalOffset","useOnlyCache"]
},showSetup:function(){var b=this.getSetupFormConfigConfig();
this.formConfig=this.getSetupFormConfig(b);
if(this.autoScrollSetupForm){this.formConfig.items={xtype:"container",layout:{type:"vbox",align:"stretch"},items:this.formConfig.items};
Ext.applyIf(this.formConfig,{width:CDR.Filter.getWidthForm()+__width_Scroller+4+8,buttons:this.getSetupFormButtons()})
}else{Ext.applyIf(this.formConfig,{layout:{type:"vbox",align:"stretch"},width:CDR.Filter.getWidthForm()+__width_Scroller+4+8,buttons:this.getSetupFormButtons()})
}this.formPanel=new Ext.FormPanel(this.formConfig);
this.formPanel.on("destroy",function(){if(this.formPanel){this.formPanel=null;
this.cancelSetupForm()
}},this);
var a=this.findLangS("combomenu","typePanel_"+this.dashboardPanel.panelType);
this.formWindow=new Ext.Window({title:this.dashboardPanel._title+" - "+this.findLangS("title","panelSetup")+(a&&Ext.isString(a)?" ("+a+")":""),items:this.formPanel,closable:true,resizable:false,height:this.autoScrollSetupForm?undefined:Math.min(900,Ext.dom.Element.getViewportHeight()-40),border:false,plain:true,layout:"fit",modal:true,listeners:{scope:this,show:this.onShowSetupWindow,activate:function(){this.dashboardPanel.dockContainer.unmask();
if(this.autoScrollSetupForm){Ext.defer(function(){adjustHeightWindow(this.formWindow,this.formPanel,0,true)
},100,this)
}}}});
this.dashboardPanel.dockContainer.maskLoad();
Ext.defer(function(){this.formWindow.show()
},100,this)
},okSetupForm:function(){if(this.formPanel.getForm().isValid()){this.setupValues=this.getSetupValuesFromForm();
if(this.chartConfigForm&&this.setupValues.chartConfig){var a=this.chartConfigForm.checkErrorInChartConfig(this.setupValues.chartConfig);
if(a){Ext.Msg.alert(lang.error,a);
return
}}if(this.dashboardPanel){this.dashboardPanel.onAfterSetSetupValues(this.setupValues)
}this.formPanel=null;
this.formWindow.close();
this.createContentAndStartRefreshTimer();
this.dashboardPanel.dockContainer.enableSaveDeleteTemplate()
}else{Ext.Msg.alert(lang.error,this.findLangS("text","formIsNotCompleted_checkAllTabs"))
}},cancelSetupForm:function(){this.startRefreshTimer(1)
},createContentAndStartRefreshTimer:function(){this.contentCreating=true;
this.abortStoreLoad();
if(this.onBeforeRemoveAll){this.onBeforeRemoveAll()
}this.removeAll();
if(this.emptyPanel){this.emptyPanel=null
}this.createContent();
this.contentCreating=false;
this.contentCreated=true;
this.startRefreshTimer()
},getSetupFormConfig:function(a){var d=this;
var b=[{xtype:"textfield",fieldLabel:this.findLangS("field","title"),name:"title",labelWidth:a.labelWidth,width:a.labelWidth+__width_FieldChar(50),allowBlank:false}];
if(!this.disableSetupInterval){var h=[];
if(this.disablePrevInterval){h.push({xtype:"numberfield",fieldLabel:this.findLangS("field","refreshPeriod"),name:"refreshPeriod",minValue:5,maxValue:4*60*60,labelWidth:a.labelWidth,width:a.labelWidth+__width_FieldNum(6),allowBlank:false})
}else{h.push({xtype:"checkbox",fieldLabel:this.findLangS("field","prevInterval"),name:"prevInterval",labelWidth:a.labelWidth,width:a.labelWidth+__width_FieldChar(5),style:{marginTop:1}},{xtype:"displayfield",value:this.findLangS("field","refreshPeriod")+":",fieldClass:"x-form-field",style:{marginLeft:24,marginRight:20},disableAutoWidth:true},{xtype:"numberfield",name:"refreshPeriod",minValue:5,maxValue:4*60*60,width:__width_FieldNum(6),allowBlank:false})
}h.push({xtype:"displayfield",value:"["+this.findLangS("field","seconds")+"]",fieldClass:"x-form-field",style:{marginLeft:3},disableAutoWidth:true});
if(!this.disableIntervalOffset){h.push({xtype:"displayfield",value:this.findLangS("field","intervalOffset")+":",fieldClass:"x-form-field",style:{marginLeft:24,marginRight:20},disableAutoWidth:true},{xtype:"numberfield",name:"intervalOffset",minValue:0,maxValue:30*60,width:__width_FieldNum(6)},{xtype:"displayfield",value:"["+this.findLangS("field","seconds")+"]",fieldClass:"x-form-field",style:{marginLeft:3},disableAutoWidth:true})
}if(this.enableUseOnlyCache){h.push({xtype:"checkbox",name:"useOnlyCache",style:{marginTop:1,marginLeft:24}},{xtype:"displayfield",value:this.findLangS("field","useOnlyCache"),fieldClass:"x-form-field",style:{marginTop:-8,marginLeft:5}})
}b.push({xtype:"ComboBoxA",fieldLabel:this.findLangS("field","interval"),name:"typeTimeInterval",aData:this.getTimeIntervalsData(this.enableCustomTimeInterval),labelWidth:a.labelWidth,width:a.labelWidth+__width_FieldChar(50),allowBlank:false,listeners:{scope:this,select:l},_tpl:"{descr}"});
if(this.enableCustomTimeInterval){b.push({xtype:"container",layout:"hbox",items:[{xtype:"numberfield",fieldLabel:this.findLangS("field","lastDaysMinutes"),name:"last_days",minValue:0,maxValue:365,labelWidth:a.labelWidth,width:a.labelWidth+__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{scope:this,spindown:function(n){var m=n.getValue();
if(m==1||m===null){Ext.defer(function(){n.setValue(null)
},1)
}f.call(this)
},select:k,change:f}},{xtype:"displayfield_h16",value:lang.days,style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",hideLabel:true,name:"last_minutes",minValue:0,maxValue:24*60,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{scope:this,spindown:function(n){var m=n.getValue();
if(m==1||m===null){Ext.defer(function(){n.setValue(null)
},1)
}g.call(this)
},select:c,change:g}},{xtype:"displayfield_h16",value:lang.minutes,style:{marginLeft:2}}],style:{marginBottom:__height_FieldSeparator}})
}b.push({xtype:"container",layout:"hbox",items:h,style:{marginBottom:__height_FieldSeparator}})
}else{if(!this.disableSetupRefreshPeriod){b.push({xtype:"container",layout:"hbox",items:[{xtype:"numberfield",fieldLabel:this.findLangS("field","refreshPeriod"),name:"refreshPeriod",minValue:5,maxValue:4*60*60,labelWidth:a.labelWidth,width:a.labelWidth+__width_FieldNum(6),allowBlank:false},{xtype:"displayfield",value:"["+this.findLangS("field","seconds")+"]",fieldClass:"x-form-field",style:{marginLeft:3},disableAutoWidth:true}],style:{marginBottom:__height_FieldSeparator}})
}}return({frame:true,border:false,items:b});
function l(){var m=this.formPanel.getForm().findField("typeTimeInterval").getValue();
var n=this.formPanel.getForm().findField("refreshPeriod");
if(n){n.setValue(this.getDefaultRefreshPeriod(m))
}d.setContextSetupValues("typeTimeInterval")
}function k(){d.setContextSetupValues("last_days")
}function f(){k.call(this)
}function c(){d.setContextSetupValues("last_minutes")
}function g(){c.call(this)
}},getSetupFormConfigConfig:function(){return({labelWidth:__width_FieldChar(15)+2,labelWidthInTab:__width_FieldChar(15)-2,autoHeight:true})
},getSetupFormButtons:function(){return({defaults:{scope:this},items:[{text:lang.okButtonText,iconCls:"icon_ok",handler:this.okSetupForm},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){this.formWindow.close();
if(this.formPanel){this.formPanel=null;
this.cancelSetupForm()
}}}]})
},getSetupValuesFromForm:function(){var b=this.formPanel.getForm().getFieldValues();
var c=this.getDefaultSetupValues();
for(var a=0;
a<this.baseSetupFields.length;
a++){if(Ext.isDefined(b[this.baseSetupFields[a]])){c[this.baseSetupFields[a]]=b[this.baseSetupFields[a]]
}}return(c)
},setSetupValuesToForm:function(a){for(var b=0;
b<this.baseSetupFields.length;
b++){var c=this.formPanel.getForm().findField(this.baseSetupFields[b]);
if(c){c.setValue(a[this.baseSetupFields[b]])
}}},getDefaultSetupValues:function(){return({})
},setContextSetupValues:function(a){var c=this.formPanel.getForm().getFieldValues();
switch(a){case"typeTimeInterval":if(c.typeTimeInterval!="custom"){this.setSetupValue("last_days",null);
this.setSetupValue("last_minutes",null)
}break;
case"last_days":if(c.last_days){this.setSetupValue("typeTimeInterval","custom")
}break;
case"last_minutes":if(c.last_minutes){this.setSetupValue("typeTimeInterval","custom")
}break
}var b=this.getSetupValue("typeTimeInterval")!="custom"||this.getSetupValue("last_days")||this.getSetupValue("last_minutes");
this.setSetupAllowBlank("last_days",b);
this.setSetupAllowBlank("last_minutes",b);
if(b){this.clearInvalid("last_days");
this.clearInvalid("last_minutes")
}},setSetupValue:function(c,a){var b=this.formPanel.getForm().findField(c);
if(b){b.setValue(a)
}},getSetupValue:function(b){var a=this.formPanel.getForm().findField(b);
if(a){return(a.getValue())
}return(null)
},setSetupEnable:function(c,a){var b=this.formPanel.getForm().findField(c);
if(b){b.enableIf(a)
}},setSetupAllowBlank:function(c,a){var b=this.formPanel.getForm().findField(c);
if(b){b.allowBlank=a
}},clearInvalid:function(b){var a=this.formPanel.getForm().findField(b);
if(a){a.clearInvalid()
}},onShowSetupWindow:function(){if(!this.setupValues){this.setupValues=this.getDefaultSetupValues();
if(this.dashboardPanel&&this.dashboardPanel._title){this.setupValues.title=this.dashboardPanel._title
}if(this.setupValues.typeTimeInterval!="custom"){this.setupValues.typeTimeInterval="last_60minutes";
this.setupValues.refreshPeriod=this.getDefaultRefreshPeriod(this.setupValues.typeTimeInterval)
}}else{if(this.prepareSetupValues){this.setupValues=this.prepareSetupValues(this.setupValues)
}}if(this.setupValues){this.setSetupValuesToForm(this.setupValues);
this.setContextSetupValues()
}},getTimeInterval:function(a){return(getDashboardTimeInterval(this.setupValues,this.getTimeIntervalsData(),a))
},getDefaultRefreshPeriod:function(a){if(!Ext.isDefined(a)){a=this.setupValues.typeTimeInterval
}return(getDataArrayItem(this.getTimeIntervalsData(),a,0,6))
},createContent:function(){},refreshContent:function(){},resizeContent:function(){},enableRefresh:function(){return(!this.formPanel&&this.dashboardPanel.enableRefresh())
},startRefreshTimer:function(a){if(!this.contentCreated){return
}this._refreshKillTimeout();
this.refreshTaskCounter=a||0;
this.refreshTaskLastTime=(new Date).getTime()/1000;
this._refreshTaskStart()
},_refreshTaskStart:function(){this._timeoutId=null;
this.refreshTaskLastTime=(new Date).getTime()/1000;
if(this.enableRefresh()&&!this.isPaused()&&this.refreshTaskCounter>0&&!this.loading){this.abortStoreLoad();
if(!this.disableForceCreateContent&&!(this.refreshTaskCounter%50)){this.createContent()
}else{this.refreshContent()
}}else{this._refreshTaskStop()
}++this.refreshTaskCounter
},_refreshTaskStop:function(){this.refreshTaskLastTime=(new Date).getTime()/1000;
if(!this.isPaused()){this._refreshSetTimeout()
}},_refreshSetTimeout:function(a){this._refreshKillTimeout();
this._timeoutId=setTimeout(Ext.bind(this._refreshTaskStart,this),a?60*1000:this.setupValues.refreshPeriod*1000);
this._errorSetTimeout=a?60:false
},_refreshKillTimeout:function(){if(this._timeoutId){clearInterval(this._timeoutId);
this._timeoutId=null
}},pause:function(){this._refreshKillTimeout();
this.abortStoreLoad();
this.paused=true;
this.dashboardPanel.setPanelTitle()
},resume:function(){this.paused=false;
this.startRefreshTimer(1);
this.dashboardPanel.setPanelTitle()
},refresh:function(){this.abortStoreLoad();
this.refreshContent();
if(!this.paused){this.startRefreshTimer()
}},isReady:function(){return(this.contentCreated)
},isContentCreating:function(){return(this.contentCreating)
},isPaused:function(){return(this.paused)
},isLoading:function(){return(this.loading)
},getTimeToRefresh:function(a){if(this.paused){return(null)
}else{var b=Math.round(this.refreshTaskLastTime+(this._errorSetTimeout||this.setupValues.refreshPeriod)-(new Date).getTime()/1000);
if(a){b=formatTimeHMSfromS(b)
}return(b)
}},onStartLoad:function(){this.loading=true;
this.dashboardPanel.setPanelTitle()
},onStopLoad:function(a){if(this.errorPanel&&!a){this.errorPanel.setHeight(0)
}this.loading=false;
this._refreshTaskStop();
this.dashboardPanel.setPanelTitle();
if(window.dashboard_pause_after_load){this.pause()
}},onError:function(b){if(this._removing){return
}if(b==getStringAjaxFailure_errorIsNotSpecified()){b=findLangSd("grid","connectionToServerLost")
}b+=" - "+findLangSd("grid","tryingAgaing");
this.onStopLoad(b);
if(this.errorPanel){this.errorPanel.setHeight(20);
var a=this.errorPanel.items.get(0);
if(a){a.setValue(b)
}else{this.errorPanel=null
}}else{this.errorPanel=new Ext.Panel({border:false,height:20,bodyStyle:{"background-color":"red"},items:{xtype:"displayfield",value:b,fieldStyle:{font:"bold 11px tahoma,arial,verdana,sans-serif",color:"white"},style:{marginLeft:5}},dock:"top"})
}if(this.errorPanel){this.addDocked(this.errorPanel);
this._refreshSetTimeout(true)
}},onDestroy:function(){this._refreshKillTimeout();
this.abortStoreLoad()
},onResize:function(){this.resizeContent()
},createQuestionPanel:function(b){this.destroyQuestionPanel();
var a=[{xtype:"displayfield",value:b.question,fieldStyle:{font:"bold 11px tahoma,arial,verdana,sans-serif",color:"#444"}},{xtype:"container",flex:1}];
for(var c=0;
c<b.buttons.length;
c++){a.push({xtype:"button",height:22,text:b.buttons[c].text,handler:b.buttons[c].handler,scope:this,style:{marginLeft:6,marginTop:2,marginBottom:2}})
}this.questionPanel=new Ext.Panel({border:false,height:30,bodyStyle:{"background-color":__color_FormBackground},items:{xtype:"container",layout:{type:"hbox",align:"middle"},items:a,style:{paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3}},dock:"top"});
this.addDocked(this.questionPanel)
},destroyQuestionPanel:function(){if(this.questionPanel){this.questionPanel.destroy();
delete this.questionPanel
}},abortStoreLoad:function(){},getTimeIntervalsData:function(a){if(a){var b=this._getTimeIntervalsData();
b.push(["custom",arLang.LtimeInterval_custom]);
return(b)
}else{if(this.filterDashboardTimeIntervals){var d=this._getTimeIntervalsData();
var b=[];
for(var c=0;
c<d.length;
c++){if(this.filterDashboardTimeIntervals.isIn(d[c][0])){b.push(d[c])
}}return(b)
}else{return(this._getTimeIntervalsData())
}}},_getTimeIntervalsData:function(){return(cloneArray(arDashboardTimeIntervals))
},checkOkTimer:function(){if(this.refreshTaskLastTime&&this.setupValues&&this.setupValues.refreshPeriod&&((new Date).getTime()/1000-this.refreshTaskLastTime)>this.setupValues.refreshPeriod*20){if(this.loading){this.loading=false;
this.dashboardPanel.setPanelTitle()
}this.abortStoreLoad();
this.createContent();
this.refreshTaskLastTime=(new Date).getTime()/1000;
return(true)
}return(false)
}});
Ext.define("Dashboard_d.SubPanel_chart_base",{extend:"Dashboard_d.SubPanel",subsystem:"dashboard_d",constructor:function(a){if(window.dashboard_interval&&a&&a.setupValues&&a.setupValues.typeTimeInterval){a.setupValues.typeTimeInterval=window.dashboard_interval
}a=Ext.apply(a||{},{enableCustomTimeInterval:true,enableUseOnlyCache:true});
this.callParent([a]);
this.prevInterval=0;
this.useOnlyCache=this.setupValues&&Ext.isDefined(this.setupValues.useOnlyCache)?this.setupValues.useOnlyCache:window.dashboard_charts_cache_enable_all
},getSetupFormConfig:function(b){var a=this.callParent([b]);
this.chartConfigForm=new CDR.Chart.ConfigForm({chartConfig:{},disableCreateWindow:true,disableShowWindow:true,disableSaveCancelFormButtons:true,disableSaveDeleteChartButtons:true,disableChartTitle:true,dashboardConfig:true,frame:false,_typeChart:this._message?"MESSAGES":this._sip_msg?"SIP_MSG":"CDR",flex:1});
a.items.push(this.chartConfigForm);
return(a)
},getSetupValuesFromForm:function(){var a=this.callParent();
a.chartConfig=this.chartConfigForm.getChartConfig();
if(a.useOnlyCache!=this.useOnlyCache){this.switchUseOnlyCache(false,true)
}return(a)
},setSetupValuesToForm:function(a){if(a&&a.chartConfig){this.chartConfigForm.setChartConfigFields(a.chartConfig)
}a.useOnlyCache=this.useOnlyCache;
this.callParent([a])
},getTimeAxis:function(a){if(this.setupValues&&this.setupValues.chartConfig&&(window.dashboard_time_axis||this.setupValues.chartConfig.timeAxis)){var b=window.dashboard_time_axis||this.setupValues.chartConfig.timeAxis;
var d=this.getTimeAxisesFromSetupValues(this.setupValues);
for(var c=0;
c<d.length;
c++){if(d[c][0]==b){return(b)
}}}if(this.setupValues.typeTimeInterval!="custom"){return(getChartTimeAxisForStdDashboardInterval(this.setupValues.typeTimeInterval,this.getTimeIntervalsData()))
}else{return(getChartTimeAxisForCustomInterval(this.setupValues.last_days,this.setupValues.last_minutes))
}},createContent:function(){var a=this.dashboardPanel.dockContainer.passiveCharts;
if(a&&this.getHeight()<10){Ext.defer(function(){this.createContent()
},100,this);
return
}if(this.chartPanel){this.chartPanel.destroy()
}var c=this.completeChartConfig();
if(this.useOnlyCache){this.setChartConfigForUseOnlyCache(c)
}this.setNextChartConfig(c);
if(a){this.chartPanel=new Ext.Panel({layout:"fit",border:false,passive:true,items:{xtype:"image",mode:"",styleHtmlContent:true,src:null,width:"100%"}});
this._createContentChart_passive(c)
}else{var b=this;
this.chartPanel=new CDR.Chart.ChartPanel({chartConfig:c,_enableTimeLineIndication:!this.setupValues.intervalOffset,_disableAlertInvalidQuery:true,_disableMaskOnLoad:true,_disableMaskOnReload:true,_enableBtnNextPrev:false,_enableBtnEdit:false,_enableBtnRemove:false,onReloadChart:function(){if(b.chartPanel&&!b.chartPanel.chart.store.validData){b.onChartEmpty(b.chartPanel.chart.store)
}else{b.onChartOk()
}},onError:function(d){b.onError(d)
},onFailure:function(d){b.onError(d)
}});
this.onStartLoad();
this.chartPanel.loadChart(c,true,{fceOkQuery:function(d){d.onChartOk()
},fceOkQueryParam:this,fceInvalidQuery:function(d,f){d.onChartEmpty(f)
},fceInvalidQueryParam:this,fceError:function(d,f){d.onError(f)
},fceErrorParam:this,fceFailure:function(d,f){d.onError(f)
},fceFailureParam:this})
}},createContentDefer:function(a){this._createContentDefer_counter=(this._createContentDefer_counter||0)+1;
Ext.defer(function(){if(this._createContentDefer_counter>0){--this._createContentDefer_counter;
if(!this._createContentDefer_counter){this.createContent();
delete this._createContentDefer_counter
}}},a,this)
},_createContentChart_passive:function(a){Ext.apply(a,{chart_width:roundNumber(this.getWidth()),chart_height:roundNumber(this.getHeight()),_enableTimeLineIndication:!this.setupValues.intervalOffset});
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getChartPng",params:Ext.encode({chart_config:a,scale_perc:100,is_gecko:Ext.isGecko})},success:function(b){this.onChartOk();
this.chartPanel.items.get(0).setSrc("data:image/png;base64,"+b.png_base64)
},error:function(b){this.onError(getStringAjaxError(b))
},failure:function(b){this.onError(getStringAjaxFailure(b))
},scope:this})
},refreshContent:function(){if(this.chartPanel&&(this.chartPanel.passive||this.chartPanel.chart)){var a=this.completeChartConfig();
if(this.useOnlyCache){this.setChartConfigForUseOnlyCache(a)
}this.setNextChartConfig(a);
if(this.chartPanel.passive){this._createContentChart_passive(a)
}else{this.chartPanel.reloadChartWithNewChartConfig(a,true,true);
this.onStartLoad()
}}else{this.createContent()
}},setChartConfigForUseOnlyCache:function(a){a.useOnlyCache=true;
a.useTA_ROT_CACHE=true;
a.subsystemCache="dashboard"
},setNextChartConfig:function(a){if(window.dashboard_suppress_charts_cache){a.suppress_charts_cache=true
}},setDefaultUseOnlyCache:function(){this.useOnlyCache=this.setupValues&&Ext.isDefined(this.setupValues.useOnlyCache)?this.setupValues.useOnlyCache:window.dashboard_charts_cache_enable_all
},onStartLoad:function(){this.timeStartLoad=new Date();
this.callParent();
if(this.chartPanel&&this.chartPanel.chart){this.chartPanel.chart.isInitializing=true
}},onStopLoad:function(a){this.timeStopLoad=new Date();
this.callParent([a]);
if(this.chartPanel&&this.chartPanel.chart){this.chartPanel.chart.isInitializing=false;
this.chartPanel.chart.processData()
}},onChartOk:function(){this.onStopLoad();
if(this.emptyPanel){if(this.getComponent(this.emptyPanel)){this.remove(this.emptyPanel)
}else{this.emptyPanel.destroy()
}this.emptyPanel=null
}if(this.chartPanel&&!this.getComponent(this.chartPanel)){this.add(this.chartPanel)
}if(!this.chartPanel.passive){this.redraw(100)
}if(!this.useOnlyCache&&!this.suppressQuestionForUseOnlyCache&&(this.timeStopLoad.getTime()-this.timeStartLoad.getTime())>(window.dashboardLoadChartQuestionTime||60000)){var b=this.dashboardPanel.dockContainer.comboTemplates.getValue();
var a=this.dashboardPanel.dockContainer.comboTemplates.findRecordByValue(b);
if(a&&(user_is_admin()||user_can_edit_all_templates()||a.data.user_id==user_id())){this.createQuestionPanel({question:this.findLangS("text","questionForUseOnlyCache"),buttons:[{text:lang.yes,handler:function(){this.destroyQuestionPanel();
if(!this.useOnlyCache){this.switchUseOnlyCache(true)
}}},{text:lang.no,handler:function(){this.destroyQuestionPanel();
delete this.questionPanel;
this.suppressQuestionForUseOnlyCache=true
}}]})
}}},onChartEmpty:function(b){this.onStopLoad();
if(this.chartPanel){if(this.getComponent(this.chartPanel)){this.remove(this.chartPanel)
}else{this.chartPanel.destroy()
}this.chartPanel=null
}var a=this.dashboardPanel.dockContainer.comboTemplates.getRawValue();
var c=this.useOnlyCache&&!b.existsCache?"calculating data on background, please wait"+(!a||a.match("\\*")?"<br>please save dashboard for activate cache":""):"empty data";
if(!this.emptyPanel){this.emptyPanel=new Ext.Panel({layout:{type:"vbox",align:"center",pack:"center"},border:false,items:{xtype:"displayfield",value:c,fieldStyle:{"text-align":"center","font-weight":"bold","font-size":"120%"}}});
this.add(this.emptyPanel)
}else{this.emptyPanel.items.get(0).setValue(c)
}},completeChartConfig:function(){var a=this.getTimeInterval(this.prevInterval);
var c=cloneObject(this.setupValues.chartConfig);
if(c.filtersFromParent){delete c.filtersFromParent
}var b=!time_sec(a[0])&&!time_sec(a[1])&&a[0].getDate()!=a[1].getDate();
Ext.apply(c,{dateFrom:a[0],dateTo:a[1],timeAxis:this.getTimeAxis(),title:"blank",_title:this.setupValues.title,_disableLegendTimeAxis:false,_timeIntervalClientOs:!b,_titleTimeAxis_autoOffset:!b,_timeLineIndication_autoOffset:true});
if(this.dashboardPanel&&this.dashboardPanel.dockContainer&&this.dashboardPanel.dockContainer.comboTemplates&&this.dashboardPanel.setupValues){c._chart_origin="dashboard ["+this.dashboardPanel.dockContainer.comboTemplates.getRawValue()+"] / ["+this.dashboardPanel.setupValues.title+"]"
}var d=this.dashboardPanel.dockContainer.comboTemplates.getValue();
if(d){Ext.apply(c,{_enableCache:true,_nameCache:"id: "+d+", "+this.setupValues.title,_validTimeCache:this.setupValues.refreshPeriod})
}return(c)
},redraw:function(a){if(this.chartPanel){if(this.chartPanel.chart){if(a){Ext.defer(function(){this.chartPanel.chart.needTimeLineIndicationUpdateLayout();
this.chartPanel.chart.redraw()
},a,this)
}else{this.chartPanel.chart.needTimeLineIndicationUpdateLayout();
this.chartPanel.chart.redraw()
}}else{if(this.chartPanel.passive){this.refreshContent()
}}}},getSetupValues:function(a){var b=cloneObject(this.setupValues);
delete b.chartConfig.dateFrom;
delete b.chartConfig.dateTo;
if(a){delete b.useOnlyCache
}return(b)
},setContextSetupValues:function(a){this.callParent([a]);
if(!Ext.isDefined(a)||["typeTimeInterval","last_days","last_minutes","prevInterval"].inArray(a)){this.fillStoreTypeTimeAxises()
}},getTimeIntervalFromSetupValues:function(a){if(!Ext.isDefined(a)){a={typeTimeInterval:this.formPanel.getForm().findField("typeTimeInterval").getValue(),last_days:this.formPanel.getForm().findField("last_days").getValue(),last_minutes:this.formPanel.getForm().findField("last_minutes").getValue(),prevInterval:this.formPanel.getForm().findField("prevInterval").getValue()}
}return(getDashboardTimeInterval(a,this.getTimeIntervalsData(),a.prevInterval))
},getTimeAxisesFromSetupValues:function(g){var a=this.getTimeIntervalFromSetupValues(g);
var f=(a[1].getTime()-a[0].getTime())/1000;
var c=getChartTimeAxisesForTimeS(f);
var d=[];
for(var b=0;
b<c.length;
b++){if(!c[b][0].match("FROM_ACT")){d.push(c[b])
}}return(d)
},fillStoreTypeTimeAxises:function(){var a=this.getTimeAxisesFromSetupValues();
this.chartConfigForm.fillStoreTypeTimeAxises(a,null,true)
},checkOkTimer:function(){if(this.callParent()){return(true)
}else{if(this.chartPanel&&this.chartPanel.chart&&this.chartPanel.store&&this.chartPanel.loadRequest&&!this.chartPanel.loadRequest.xhr&&this.refreshTaskLastTime&&this.setupValues&&this.setupValues.refreshPeriod&&((new Date).getTime()/1000-this.refreshTaskLastTime)>this.setupValues.refreshPeriod*5){if(this.loading){this.loading=false;
this.dashboardPanel.setPanelTitle()
}this.abortStoreLoad();
this.createContent();
this.refreshTaskLastTime=(new Date).getTime()/1000;
return(true)
}}return(false)
},abortStoreLoad:function(){if(this.chartPanel&&this.chartPanel.loadRequest&&this.chartPanel.loadRequest.xhr){abortRequest(this.chartPanel.loadRequest)
}},createTitle:function(b,d){var a=this.dashboardPanel.dockContainer.comboTemplates.getRawValue();
var c=a&&!a.match("\\*")&&this.useOnlyCache&&!this.chartCacheIsSuspended();
return((user_id()&&user_is_admin()&&a&&!a.match("\\*")?'<td><img src="images/icon/link_grey.png" panelid="'+d+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.linkToPngCsvViaApi([event.clientX,event.clientY]);" width="14" style="cursor: pointer; margin-top: 1px; margin-right: '+(c?2:15)+'px;" data-qtip="'+this.findLangS("tooltip","linkToPngCsvViaApi")+'" ></td>':"")+(c?'<td><img src="images/icon/table_grey.png" panelid="'+d+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.exportToCsv([event.clientX,event.clientY]);" width="15" style="cursor: pointer; margin-top: 2px; margin-right: 15px;" data-qtip="'+this.findLangS("tooltip","exportToCsv")+'" ></td>':"")+('<td><img src="images/icon/cache_'+(this.useOnlyCache?(this.chartCacheIsSuspended()?"blue_disabled":"blue"):"grey")+'.png" panelid="'+d+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.switchUseOnlyCache(true);" width="14" style="cursor: pointer; margin-top: 1px; margin-right: 15px;" data-qtip="'+(this.useOnlyCache&&this.chartCacheIsSuspended()?this.chartCacheSuspendedReason():this.findLangS("tooltip","switchUseOnlyCache"))+'" ></td>')+('<td><span class="x-btn-icon-el x-tbar-page-prev" panelid="'+d+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.doPrevInterval([event.clientX,event.clientY]);" style="cursor: pointer; width: 10px; height: 14px; display: block; margin-top: 2px;"data-qtip="'+this.findLangS("tooltip","prevInterval")+'" ></td><td><span panelid="'+d+'" style="white-space: nowrap; cursor: pointer; font: '+__font_Grid+"; color: #555; margin-left: "+(this.prevInterval>0?3:1)+"px; margin-right: "+(this.prevInterval>0?2:1)+'px;" >'+(this.prevInterval>0?"prev: "+this.prevInterval:"")+'</span></td><td class="'+(this.prevInterval<=0?"x-item-disabled":"")+'"style="'+(this.prevInterval<=0?"opacity: 0.5;":"")+'"><span class="x-btn-icon-el x-tbar-page-next" panelid="'+d+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.doNextInterval([event.clientX,event.clientY]);" style="cursor: pointer; width: 10px; height: 14px; display: block; margin-top: 2px; margin-right: 10px;"data-qtip="'+this.findLangS("tooltip","nextInterval")+'" ></td>'))
},doPrevInterval:function(){++this.prevInterval;
this.dashboardPanel.setPanelTitle();
this.createContentDefer(1000)
},doNextInterval:function(){if(this.prevInterval>0){--this.prevInterval
}this.dashboardPanel.setPanelTitle();
this.createContentDefer(1000)
},switchUseOnlyCache:function(g,f){var d=this.useOnlyCache;
if(g){if(!window.dashboard_charts_cache_enable_all&&!this.useOnlyCache){Ext.Msg.confirm("",this.findLangS("text","termsConfirm")+(user_id()>0?'<br/><br/><table><tr><td><input type="checkbox" id="dashboard_terms_use_cache_skip"/> <td><span style="display: block; margin-top: -3px; font-size: 12;">'+this.findLangS("text","neverShowAgain")+"</span></table>":""),function(h){if(h=="yes"){this.switchUseOnlyCache(false,f);
if(user_id()>0&&Ext.get("dashboard_terms_use_cache_skip")&&Ext.get("dashboard_terms_use_cache_skip").dom.checked){window.dashboard_terms_use_cache_skip=true;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"dashboard_terms_use_cache",name:"skip",config:1,user_id:user_id(),enableUpdate:true})}})
}}},this)
}else{Ext.Msg.confirm("",this.findLangS("text",this.useOnlyCache?"disableChartCacheForPanelQuestion":"enableChartCacheForPanelQuestion"),function(h){if(h=="yes"){this.switchUseOnlyCache(false,f)
}},this)
}return
}this.useOnlyCache=!this.useOnlyCache;
this.setupValues.useOnlyCache=this.useOnlyCache;
var a=this.dashboardPanel.dockContainer.comboTemplates.getRawValue();
if(a&&!a.match("\\*")){var c=this.dashboardPanel.dockContainer.comboTemplates.getValue();
var b=this.dashboardPanel.dockContainer.comboTemplates.findRecordByValue(c);
if(b&&(user_is_admin()||user_can_edit_all_templates()||b.data.user_id==user_id())){this.dashboardPanel.dockContainer.saveSetupValues("useOnlyCache",this.dashboardPanel);
b.data.config=Ext.encode(this.dashboardPanel.dockContainer.getConfigData());
this.destroyQuestionPanel()
}else{this.useOnlyCache=d;
this.setupValues.useOnlyCache=this.useOnlyCache;
Ext.Msg.alert("",this.findLangS("text","youAreNotAuthorizedToOperation"))
}}this.dashboardPanel.setPanelTitle();
if(!f){this.createContent()
}},linkToPngCsvViaApi:function(c,a){if(!a){var b=new Ext.menu.Menu({defaults:{scope:this,handler:function(d){this.linkToPngCsvViaApi(null,d._format)
}},items:[{text:this.findLangS("menu","linkToPngViaApi"),_format:"png"},{text:this.findLangS("menu","linkToCsvViaApi"),_format:"csv"}]});
b.showAt(c);
return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"httpReferer",params:Ext.encode({hashAPI:true})},success:function(p){var o=this.dashboardPanel.dockContainer.comboTemplates.getRawValue();
var l=this.dashboardPanel.dockContainer.comboTemplates.getSelectedRecord();
var g=l&&l.data;
var f='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100">';
var n=[];
var m=[];
for(var k=0;
k<2;
k++){if(!(k||p.hashAPI)){continue
}f+="<tr><td colspan=2 "+(k&&p.hashAPI?'style="padding-top: 6px;"':"")+">"+(k==0?'<span style="font-size: 120%; font-weight: bold;">'+findLangS(this.subsystem,"text","useUserHash")+":</span>":'<span style="font-size: 120%; font-weight: bold;">'+findLangS(this.subsystem,"text","useUserAndPassword")+':</span><br><span style="font-size: 120%; color: red">'+findLangS(this.subsystem,"text","doNotForgetAddPasswordToLink")+"</span>")+"</td><tr>";
var h=Ext.encode({dashboard:o,dashboardId:g&&g.id?g.id:undefined,dashboardUserId:g&&g.user_id?g&&g.user_id:undefined,panel:this.setupValues.title,panelIndex:this.dashboardPanel.dockContainer.getRegisterPanelIndex(this.dashboardPanel)!==false?this.dashboardPanel.dockContainer.getRegisterPanelIndex(this.dashboardPanel)+1:undefined,timeInterval:{type:this.setupValues.typeTimeInterval,last_days:this.setupValues.last_days||this.setupValues.last_minutes?this.setupValues.last_days:undefined,last_minutes:this.setupValues.last_days||this.setupValues.last_minutes?this.setupValues.last_minutes:undefined},inline:1,width:800,height:300,timezone:getClientTimezone(),csv:a=="csv"?1:undefined});
n[k]=p.httpReferer+"/php/api.php?task=getDashboardPanel&"+(k==0?"user_hash="+p.hashAPI:"user="+user.username.replaceall("&","%26")+"&password=PASSWORD")+"&amp;params="+h;
m[k]=p.httpReferer+"/php/api.php?task=getDashboardPanel&"+(k==0?"user_hash="+p.hashAPI:"user="+encodeURIComponent(user.username)+"&password=PASSWORD")+"&amp;params="+encodeURIComponent(h);
f+='<tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+m[k]+'" target="_blank">'+n[k]+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div_'+(k+1)+'" style="height: 18;"/>';
"</div></td><tr>"
}f+="</table>";
var d=400+6+100+6+30;
Ext.Msg.show({title:findLangS(this.subsystem,"title",a=="png"?"linkToPngViaApi":"linkToCsvViaApi"),msg:f,buttons:Ext.Msg.OK,minWidth:d,width:d,fn:function(){for(var r=0;
r<2;
r++){var q=Ext.getCmp("copy_button_"+(r+1));
if(q){q.destroy()
}}}});
for(var k=0;
k<2;
k++){new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(q){return(q.clipboardText)
},getClipTextParams:{clipboardText:m[k]},id:"copy_button_"+(k+1),renderTo:"copy_button_div_"+(k+1)})
}}})
},exportToCsv:function(d){var a=this.dashboardPanel.dockContainer.comboTemplates.getRawValue();
var c=this.dashboardPanel.dockContainer.comboTemplates.getSelectedRecord();
var b=c&&c.data;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"prepareDownloadDashboardPanelCsv",params:Ext.encode({dashboard:a,dashboardUserId:b&&b.user_id?b&&b.user_id:undefined,panel:this.setupValues.title,panelIndex:this.dashboardPanel.dockContainer.getRegisterPanelIndex(this.dashboardPanel)!==false?this.dashboardPanel.dockContainer.getRegisterPanelIndex(this.dashboardPanel)+1:undefined,timezone:getClientTimezone(),timeInterval:{type:this.setupValues.typeTimeInterval,last_days:this.setupValues.last_days||this.setupValues.last_minutes?this.setupValues.last_days:undefined,last_minutes:this.setupValues.last_days||this.setupValues.last_minutes?this.setupValues.last_minutes:undefined}})},success:function(f){downloadPrepareFileHash(f)
},maskEl:this,timeout:30*60*1000})
},_getTimeIntervalsData:function(){var a=cloneArray(arDashboardTimeIntervals);
if(this.useOnlyCache){return(a.concat(cloneArray(arDashboardTimeIntervals_charts_long)))
}else{return(a)
}},chartCacheIsSuspended:function(){return(window.dashboard_charts_cache_temporarily_suspended||window.dashboard_charts_cache_temporarily_autosuspended)
},chartCacheSuspendedReason:function(){return(this.chartCacheIsSuspended()?(window.dashboard_charts_cache_temporarily_autosuspended?(window.dashboard_charts_cache_temporarily_autosuspended_reason||this.findLangS("text","agregationIsTemporarilyAutoDisabled")):this.findLangS("text","agregationIsTemporarilyDisabledInSetting")):null)
}});
Ext.define("Dashboard_d.SubPanel_chart",{extend:"Dashboard_d.SubPanel_chart_base",subPanel_type:"chart",constructor:function(a){this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_chart_message",{extend:"Dashboard_d.SubPanel_chart_base",subPanel_type:"chart",constructor:function(a){a._message=true;
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_chart_sip_msg",{extend:"Dashboard_d.SubPanel_chart_base",subPanel_type:"chart",constructor:function(a){a._sip_msg=true;
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel__use_CDR_Message_stats",{extend:"Dashboard_d.SubPanel",constructor:function(a){this.callParent([a])
},getSetupValuesFromForm:function(){var a=this.callParent();
a.filterConfig=this.filterConfigForm.getFilterConfig();
return(a)
},setSetupValuesToForm:function(a){if(a&&a.filterConfig){this.filterConfigForm.setFilterConfigFields(a.filterConfig)
}this.callParent([a])
},createStore:function(b){this.destroyStore();
var a=this.message?"dashboard_d__use_Message_stats":"dashboard_d__use_CDR_stats";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:this.message?rsMessage_stats:rsCDR_stats,idProperty:"id"})
}this.store=new Ext.data.Store(Ext.applyIf(b||{},{model:a,proxy:{type:"ajax",url:"php/model/sql.php",actionMethods:"POST",extraParams:this.getStoreExtraParams(),reader:{rootProperty:"results",totalProperty:"total",idProperty:"id"},listeners:{scope:this,exception:function(f,d,c){this.onError(getStringStoreException(f,d,c))
}},timeout:Ext.Ajax.timeout*2},listeners:{scope:this,beforeload:this.onBeforeLoad}}))
},destroyStore:function(){if(this.store){delete this.store
}},refreshContent:function(){this.store.proxy.extraParams=this.getStoreExtraParams();
this.store.load();
this.onStartLoad()
},getStoreExtraParams:function(){var c={task:"LISTING",module:this.message?"message_stats":"CDR_stats"};
if(this.storeExtraParams){Ext.applyIf(c,this.storeExtraParams)
}var a=this.getTimeInterval();
if(this.message){var b={calldate_from:a[0],calldata_to:a[1]};
if(this.setupValues.filterConfig){Ext.applyIf(b,this.setupValues.filterConfig)
}c.form_filters=Ext.encode(b)
}else{Ext.applyIf(c,{fdatefrom:a[0],fdateto:a[1]});
if(this.setupValues.filterConfig){Ext.applyIf(c,this.setupValues.filterConfig)
}}return(c)
},onBeforeLoad:function(){this.abortStoreLoad();
if(!this.isLoading()){this.onStartLoad()
}var a=this.getNeedColumns&&this.getNeedColumns();
var c=this.getNeedPercentile&&this.getNeedPercentile();
var b=this.getNeedCps&&this.getNeedCps();
this.store.proxy.extraParams.needColumns=Ext.encode(a);
if(c){this.store.proxy.extraParams.needPercentile=1
}else{delete this.store.proxy.extraParams.needPercentile
}if(b){this.store.proxy.extraParams.needCps=1
}else{delete this.store.proxy.extraParams.needCps
}},createTitle:function(a,b){return(this.enableSwitch_by_source_or_destination||this.enableSwitch_by_caller_or_called?'<td><span id="'+a.id+'_title_info_spec_1" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.onClickSpec1([event.clientX,event.clientY]);" style="white-space: nowrap; cursor: pointer; font: '+__font_Grid+'; color: #555; margin-right: 3px;" data-qtip="'+this.findLangS("tooltip",this.enableSwitch_by_source_or_destination?"setBySourceOrDestinationIP":"setByCallerOrCalledSide")+'" >'+this.findLangS("text",this.enableSwitch_by_source_or_destination?(this.setupValues.by_source_or_destination=="source"?"bySourceIP_short":"byDestinationIP_short"):(this.setupValues.by_caller_or_called=="caller"?"byCaller":"byCalled"))+'</span></td><td><img src="images/icon/arrow-switch-lr_grey.png" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.onClickSpec1([event.clientX,event.clientY]);" width="16" style="cursor: pointer; margin-top: 1px; margin-right: 15px;" data-qtip="'+this.findLangS("tooltip",this.enableSwitch_by_source_or_destination?"setBySourceOrDestinationIP":"setByCallerOrCalledSide")+'" ></td>':"")
},onClickSpec1:function(c){var a=[];
if(this.enableSwitch_by_source_or_destination){a.push({text:this.findLangS("combomenu","bySourceIP"),_value:"source"},{text:this.findLangS("combomenu","byDestinationIP"),_value:"destination"})
}else{a.push({text:this.findLangS("combomenu","byCaller"),_value:"caller"},{text:this.findLangS("combomenu","byCalled"),_value:"called"})
}var b=new Ext.menu.Menu({defaults:{scope:this,handler:function(d){if(this.enableSwitch_by_source_or_destination){this.setBySourceOrDestination(d._value)
}else{this.setByCallerOrCalled(d._value)
}}},items:a});
b.showAt(c)
},setBySourceOrDestination:function(a){this.setupValues.by_source_or_destination=a;
this.createContentAndStartRefreshTimer()
},setByCallerOrCalled:function(a){this.setupValues.by_caller_or_called=a;
this.createContentAndStartRefreshTimer()
},abortStoreLoad:function(){if(this.store){abortLoadStore(this.store)
}}});
Ext.define("Dashboard_d.SubPanel_sip_response_pie_chart",{extend:"Dashboard_d.SubPanel__use_CDR_Message_stats",subPanel_type:"sip_response_pie_chart",constructor:function(a){a=Ext.applyIf(a||{},{storeExtraParams:{group_by:4,limit:20}});
this.callParent([a]);
this.baseSetupFields.push("without_sip_response_200")
},getSetupFormConfig:function(b){var a=this.callParent([b]);
this.filterConfigForm=new Dashboard_d.PanelSetupFormWithFilter({frame:false,baseItems:[{xtype:"checkbox",name:"without_sip_response_200",fieldLabel:this.findLangS("field","withoutSipResponse200"),labelWidth:b.labelWidthInTab}],baseItemsTitle:this.findLangS("title","tabBaseSetting"),message:this.message});
a.items.push(this.filterConfigForm);
return(a)
},createContent:function(){if(this.chart){this.chart.destroy()
}this.createStore();
var a=this;
this.store.on("load",function(d,c,f){if(f){this.onStopLoad();
if(d.getCount()){if(this.setupValues.without_sip_response_200){var b=d.getAt(0);
if(b.data.lastSIPresponse.match("200")){d.remove(b)
}}d.each(function(g){g.data._chart_descr=g.data.lastSIPresponse;
if(g.data._chart_descr.length>20){g.data._chart_descr=g.data._chart_descr.substr(0,20)+"..."
}})
}this.chart.processData()
}},this);
this.chart=new Ext.chart.PolarChart({xtype:"cartesian",layout:"fit",store:this.store,shadow:false,legend:{docked:"right",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:3},series:[{type:"pie",angleField:"cnt_all",showInLegend:true,label:{field:"_chart_descr",display:"rotate",contrast:true,font:"11px Tahoma, Arial, Helvetica, Sans-serif"},tips:{trackMouse:true,width:150,height:32,renderer:function(d,c,b){var f=0;
a.store.each(function(g){f+=g.get("cnt_all")
});
d.setTitle(c.data.lastSIPresponse+": "+Math.round(c.data.cnt_all/f*100)+"%")
},scope:this},listeners:{scope:this,itemclick:function(b,d,c){var g=this.getStoreExtraParams();
g.flastSIPresponse=d.record.data.lastSIPresponse;
var f=new Ext.Window({layout:"fit",items:new GridReports.CallDetail.Grid({withoutToolbar:true,extraParams:g}),title:d.record.data.lastSIPresponse,width:Ext.dom.Element.getViewportWidth()*3/4,height:Ext.dom.Element.getViewportHeight()*3/4,modal:true,closable:true,maximizable:true});
f.show()
}}}],plugins:{ptype:"chartitemevents",moveEvents:true},insetPadding:8,border:false});
this.add(this.chart);
this.store.load();
this.onStartLoad()
}});
Ext.define("Dashboard_d.SubPanel_sip_response_pie_chart_message",{extend:"Dashboard_d.SubPanel_sip_response_pie_chart",subPanel_type:"sip_response_pie_chart_message",constructor:function(a){a=Ext.applyIf(a||{},{message:true,storeExtraParams:{group_by:1,limit:20}});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_top_ip_address_chart",{extend:"Dashboard_d.SubPanel__use_CDR_Message_stats",subPanel_type:"top_ip_address_chart",constructor:function(a){a=Ext.applyIf(a||{},{storeExtraParams:{limit:10},enableSwitch_by_source_or_destination:true});
this.callParent([a]);
this.baseSetupFields.push("by_source_or_destination")
},getSetupFormConfig:function(b){var a=this.callParent([b]);
this.filterConfigForm=new Dashboard_d.PanelSetupFormWithFilter({frame:false,baseItems:[{xtype:"ComboBoxA",name:"by_source_or_destination",fieldLabel:this.findLangS("field","bySourceOrDestination"),aData:[["source",this.findLangS("combomenu","bySourceIP")],["destination",this.findLangS("combomenu","byDestinationIP")]],labelWidth:b.labelWidthInTab,width:b.labelWidthInTab+__width_FieldChar(25),allowBlank:false}],baseItemsTitle:this.findLangS("title","tabBaseSetting"),message:this.message});
a.items.push(this.filterConfigForm);
return(a)
},createContent:function(){if(this.chart){this.chart.destroy()
}this.createStore();
var a=this;
this.store.on("load",function(c,b,d){if(d){this.onStopLoad();
if(c.getCount()){c.each(function(f){f.data._chart_descr=f.data.sip_hostname||f.data.sip_ip;
if(f.data._chart_descr.length>20){f.data._chart_descr=f.data._chart_descr.substr(0,20)+"..."
}});
c.sort("cnt_all","ASC")
}}},this);
this.chart=new Ext.chart.CartesianChart({xtype:"cartesian",flipXY:true,store:this.store,shadow:false,animation:false,border:false,axes:[{type:"numeric",position:"bottom",fields:["cnt_all"],label:{renderer:Ext.util.Format.numberRenderer("0,0")},grid:true,minimum:0,_decPrecision:0,_maxTickSteps:20,renderer:function(d,c,b,f){return(roundNumber(c,0))
}},{type:"category",position:"left",fields:["_chart_descr"]}],theme:"DashBar",series:[{type:"bar",xField:"_chart_descr",yField:["cnt_all"],highlight:false,tips:{trackMouse:true,width:150,height:32,renderer:function(f,d,c){var b=0;
a.store.each(function(g){b+=g.get("cnt_all")
});
f.setTitle(d.data.sip_ip+": "+Math.round(d.data.cnt_all/b*100)+"%"+(d.data.sip_hostname?"<br><i>"+d.data.sip_hostname+"</i>":""))
}},label:{display:"insideEnd",field:"total",orientation:"horizontal",color:"#333","text-anchor":"middle",renderer:function(b){return(roundNumber(b,0))
}}}]});
this.add(this.chart);
this.store.load();
this.onStartLoad()
},getDefaultSetupValues:function(){return({by_source_or_destination:"source"})
},getStoreExtraParams:function(){var a=this.callParent();
a.group_by=this.setupValues.by_source_or_destination=="source"?"2s":"2d";
return(a)
}});
Ext.define("Dashboard_d.SubPanel_top_ip_address_chart_message",{extend:"Dashboard_d.SubPanel_top_ip_address_chart",subPanel_type:"top_ip_address_chart_message",constructor:function(a){a=Ext.applyIf(a||{},{message:true});
this.callParent([a])
},getStoreExtraParams:function(){var a=this.callParent();
a.group_by=this.setupValues.by_source_or_destination=="source"?"2s":"2d";
return(a)
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_grid",{extend:"Dashboard_d.SubPanel__use_CDR_Message_stats",constructor:function(a){a=Ext.apply(a||{},{storeExtraParams:{limit:10},enableSwitch_by_source_or_destination:["sip_ip","rtp_ip","country_by_sip_ip"].inArray(a._by),enableSwitch_by_caller_or_called:["callerd","ua_ab","country_by_number"].inArray(a._by)});
this.callParent([a]);
if(a.enableSwitch_by_source_or_destination){this.baseSetupFields.push("by_source_or_destination")
}else{if(a.enableSwitch_by_caller_or_called){this.baseSetupFields.push("by_caller_or_called")
}}if(a.message){this.baseSetupFields.push("total_perc")
}else{this.baseSetupFields.push("columns","sort_by","sort_dir")
}this.baseSetupFields.push("max_rows")
},getSetupFormConfig:function(c){var b=this.callParent([c]);
var a=this.message?null:cloneArray(arColumnsCDRstat);
this._sortTableItems=["cnt_all"];
if(a){this._sortTableItems=this._sortTableItems.concat(a);
for(var d=0;
d<a.length;
d++){a[d]=[a[d],this.findLangS("menu",a[d])]
}}var g=[];
if(this.enableSwitch_by_source_or_destination){var f=null;
switch(this._by){case"country_by_sip_ip":f="byCountry_sourceOrDestination";
break;
case"sip_ip":case"rtp_ip":default:f="bySourceOrDestination";
break
}g.push({xtype:"ComboBoxA",name:"by_source_or_destination",fieldLabel:this.findLangS("field",f),aData:[["source",this.findLangS("combomenu","bySourceIP")],["destination",this.findLangS("combomenu","byDestinationIP")]],labelWidth:c.labelWidthInTab,width:c.labelWidthInTab+__width_FieldChar(25),allowBlank:false})
}else{if(this.enableSwitch_by_caller_or_called){var f=null;
switch(this._by){case"ua_ab":f="byUA_callerOrCalled";
break;
case"country_by_number":f="byCountry_callerOrCalled";
break;
case"callerd":default:f="byCallerOrCalled";
break
}g.push({xtype:"ComboBoxA",name:"by_caller_or_called",fieldLabel:this.findLangS("field",f),aData:[["caller",this.findLangS("combomenu","byCaller")],["called",this.findLangS("combomenu","byCalled")]],labelWidth:c.labelWidthInTab,width:c.labelWidthInTab+__width_FieldChar(25),allowBlank:false})
}}if(a){g.push({xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",value:"columns:",width:c.labelWidthInTab,fieldStyle:{"text-align":"left"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"priorityTable",tableItems:a,name:"columns",width:__width_FieldChar(40),height:400,onChange:this.onChangePriorityTable,onChangeScope:this}],style:{marginBottom:__height_FieldSeparator}})
}else{if(this.message){g.push({xtype:"checkbox",name:"total_perc",fieldLabel:this.findLangS("field","total_perc"),labelWidth:c.labelWidthInTab})
}}if(a){g.push({xtype:"ComboBoxA",name:"sort_by",fieldLabel:this.findLangS("field","sort_by"),aData:[],labelWidth:c.labelWidthInTab,width:c.labelWidthInTab+__width_FieldChar(25)},{xtype:"ComboBoxA",name:"sort_dir",fieldLabel:this.findLangS("field","sort_dir"),aData:[["ASC",this.findLangS("combomenu","ascending")],["DESC",this.findLangS("combomenu","descending")]],labelWidth:c.labelWidthInTab,width:c.labelWidthInTab+__width_FieldChar(25)})
}g.push({xtype:"numberfield",name:"max_rows",fieldLabel:this.findLangS("field","max_rows"),minValue:10,maxValue:50,labelWidth:c.labelWidthInTab,width:c.labelWidthInTab+__width_FieldNum(6),allowBlank:false});
this.filterConfigForm=new Dashboard_d.PanelSetupFormWithFilter({frame:false,baseItems:g,baseItemsTitle:this.findLangS("title","tabBaseSetting"),message:this.message});
b.items.push(this.filterConfigForm);
return(b)
},createContent:function(){if(this.grid){this.grid.destroy()
}this.createStore({sorters:{property:this.setupValues.sort_by,direction:this.setupValues.sort_dir},remoteSort:true});
this.store.on("load",function(E,D,F){if(F){this.onStopLoad()
}},this);
var a=[];
switch(this._by){case"sip_ip":a.push({dataIndex:"sipip",width:__width_ColumnChar(this.message?45:30),renderer:m});
break;
case"rtp_ip":a.push({dataIndex:"rtpip",width:__width_ColumnChar(30),renderer:o});
break;
case"callerd":a.push({dataIndex:"phone_numb",width:__width_ColumnChar(30)});
break;
case"ua_ab":a.push({dataIndex:"ua",width:__width_ColumnChar(30)});
break;
case"country_by_sip_ip":case"country_by_number":a.push({dataIndex:"country",width:__width_ColumnChar(this.message?45:30),renderer:A});
break;
case"sip_response":a.push({dataIndex:"lastSIPresponse",width:__width_ColumnChar(this.message?45:30)});
break
}a.push({dataIndex:"cnt_all",headerLang:this.message?"cnt_all_messages":"cnt_all_cdr",sortable:true,width:__width_ColumnNum(this.message?10:6),align:"right",renderer:q});
var f={total_perc:{dataIndex:"cnt_all",headerLang:"total_perc",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:p},duration_all:{dataIndex:"duration_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:r},asr_all:{dataIndex:"asr_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:k},ner_all:{dataIndex:"ner_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:y},acd_all:{dataIndex:"acd_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:c},mos_all:{dataIndex:"mos_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:s},mos_perc95_all:{dataIndex:"mos_perc95_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:s},mos_perc99_all:{dataIndex:"mos_perc99_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:s},mos_xr_avg_all:{dataIndex:"mos_xr_avg_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_xr_avg_perc95_all:{dataIndex:"mos_xr_avg_perc95_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_avg_perc99_all:{dataIndex:"mos_xr_avg_perc99_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_avg_caller_all:{dataIndex:"mos_xr_avg_caller_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_avg_caller_perc95_all:{dataIndex:"mos_xr_avg_caller_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_avg_caller_perc99_all:{dataIndex:"mos_xr_avg_caller_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_avg_called_all:{dataIndex:"mos_xr_avg_called_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_avg_called_perc95_all:{dataIndex:"mos_xr_avg_called_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_avg_called_perc99_all:{dataIndex:"mos_xr_avg_called_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_min_all:{dataIndex:"mos_xr_min_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_xr_min_perc95_all:{dataIndex:"mos_xr_min_perc95_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_min_perc99_all:{dataIndex:"mos_xr_min_perc99_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_min_caller_all:{dataIndex:"mos_xr_min_caller_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_min_caller_perc95_all:{dataIndex:"mos_xr_min_caller_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_min_caller_perc99_all:{dataIndex:"mos_xr_min_caller_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_min_called_all:{dataIndex:"mos_xr_min_called_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_xr_min_called_perc95_all:{dataIndex:"mos_xr_min_called_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_xr_min_called_perc99_all:{dataIndex:"mos_xr_min_called_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_avg_all:{dataIndex:"mos_silence_avg_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_silence_avg_perc95_all:{dataIndex:"mos_silence_avg_perc95_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_avg_perc99_all:{dataIndex:"mos_silence_avg_perc99_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_avg_caller_all:{dataIndex:"mos_silence_avg_caller_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_avg_caller_perc95_all:{dataIndex:"mos_silence_avg_caller_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_avg_caller_perc99_all:{dataIndex:"mos_silence_avg_caller_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_avg_called_all:{dataIndex:"mos_silence_avg_called_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_avg_called_perc95_all:{dataIndex:"mos_silence_avg_called_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_avg_called_perc99_all:{dataIndex:"mos_silence_avg_called_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_min_all:{dataIndex:"mos_silence_min_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_silence_min_perc95_all:{dataIndex:"mos_silence_min_perc95_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_min_perc99_all:{dataIndex:"mos_silence_min_perc99_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_min_caller_all:{dataIndex:"mos_silence_min_caller_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_min_caller_perc95_all:{dataIndex:"mos_silence_min_caller_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_min_caller_perc99_all:{dataIndex:"mos_silence_min_caller_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_min_called_all:{dataIndex:"mos_silence_min_called_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:s},mos_silence_min_called_perc95_all:{dataIndex:"mos_silence_min_called_perc95_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_silence_min_called_perc99_all:{dataIndex:"mos_silence_min_called_perc99_all",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:s},mos_lqo_caller_all:{dataIndex:"mos_lqo_caller_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:s},mos_lqo_caller_perc95_all:{dataIndex:"mos_lqo_caller_perc95_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_lqo_caller_perc99_all:{dataIndex:"mos_lqo_caller_perc99_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_lqo_called_all:{dataIndex:"mos_lqo_called_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:s},mos_lqo_called_perc95_all:{dataIndex:"mos_lqo_called_perc95_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},mos_lqo_called_perc99_all:{dataIndex:"mos_lqo_called_perc99_all",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:s},packets_lost_all:{dataIndex:"packets_lost_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:u},packets_lost_perc95_all:{dataIndex:"packets_lost_perc95_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:u},packets_lost_perc99_all:{dataIndex:"packets_lost_perc99_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:u},jitter_all:{dataIndex:"jitter_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:g},jitter_perc95_all:{dataIndex:"jitter_perc95_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:g},jitter_perc99_all:{dataIndex:"jitter_perc99_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:g},delay_all:{dataIndex:"delay_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:t},delay_perc95_all:{dataIndex:"delay_perc95_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:t},delay_perc99_all:{dataIndex:"delay_perc99_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:t},pdd_all:{dataIndex:"pdd_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:z},pdd_perc95_all:{dataIndex:"pdd_perc95_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:z},pdd_perc99_all:{dataIndex:"pdd_perc99_all",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:z},cps_max:{dataIndex:"cps_max",sortable:true,width:__width_ColumnNum(8),align:"right"},cps_avg:{dataIndex:"cps_avg",sortable:true,width:__width_ColumnNum(8),align:"right",renderer:h},rtcp_maxfr:{dataIndex:"rtcp_maxfr",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:l},rtcp_maxfr_perc95_all:{dataIndex:"rtcp_maxfr_perc95_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:l},rtcp_maxfr_perc99_all:{dataIndex:"rtcp_maxfr_perc99_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:l},rtcp_avgfr:{dataIndex:"rtcp_avgfr",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:d},rtcp_avgfr_perc95_all:{dataIndex:"rtcp_avgfr_perc95_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:d},rtcp_avgfr_perc99_all:{dataIndex:"rtcp_avgfr_perc99_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:d},rtcp_maxrtd:{dataIndex:"rtcp_maxrtd",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:l},rtcp_maxrtd_perc95_all:{dataIndex:"rtcp_maxrtd_perc95_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:l},rtcp_maxrtd_perc99_all:{dataIndex:"rtcp_maxrtd_perc99_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:l},rtcp_avgrtd:{dataIndex:"rtcp_avgrtd",sortable:true,width:__width_ColumnNum(9),align:"right",renderer:d},rtcp_avgrtd_perc95_all:{dataIndex:"rtcp_avgrtd_perc95_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:d},rtcp_avgrtd_perc99_all:{dataIndex:"rtcp_avgrtd_perc99_all",sortable:true,width:__width_ColumnNum(12),align:"right",renderer:d},rtcp_maxjitter:{dataIndex:"rtcp_maxjitter",sortable:true,width:__width_ColumnNum(10),align:"right",renderer:l},rtcp_maxjitter_perc95_all:{dataIndex:"rtcp_maxjitter_perc95_all",sortable:true,width:__width_ColumnNum(13),align:"right",renderer:l},rtcp_maxjitter_perc99_all:{dataIndex:"rtcp_maxjitter_perc99_all",sortable:true,width:__width_ColumnNum(13),align:"right",renderer:l},rtcp_avgjitter:{dataIndex:"rtcp_avgjitter",sortable:true,width:__width_ColumnNum(10),align:"right",renderer:d},rtcp_avgjitter_perc95_all:{dataIndex:"rtcp_avgjitter_perc95_all",sortable:true,width:__width_ColumnNum(13),align:"right",renderer:d},rtcp_avgjitter_perc99_all:{dataIndex:"rtcp_avgjitter_perc99_all",sortable:true,width:__width_ColumnNum(13),align:"right",renderer:d},silence_all:{dataIndex:"silence_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:b},silence_perc95_all:{dataIndex:"silence_perc95_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:b},silence_perc99_all:{dataIndex:"silence_perc99_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:b},silence_end_all:{dataIndex:"silence_end_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:b},silence_end_perc95_all:{dataIndex:"silence_end_perc95_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:b},silence_end_perc99_all:{dataIndex:"silence_end_perc99_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:b},clipping_all:{dataIndex:"clipping_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:B},clipping_perc95_all:{dataIndex:"clipping_perc95_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:B},clipping_perc99_all:{dataIndex:"clipping_perc99_all",sortable:true,width:__width_ColumnNum(6),align:"right",renderer:B},price_customer:{dataIndex:"price_customer",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:n},price_operator:{dataIndex:"price_operator",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:n},price_difference:{dataIndex:"price_difference",sortable:true,width:__width_ColumnNum(7),align:"right",renderer:n}};
if(this.setupValues.columns){var w=this.setupValues.columns.split(",");
for(var v=0;
v<w.length;
v++){a.push(f[w[v]])
}}else{if(this.setupValues.total_perc){a.push(f.total_perc)
}}for(var v=0;
v<a.length;
v++){a[v].header=this.findLangS("column",a[v].headerLang||a[v].dataIndex)
}this.grid=new Ext.grid.GridPanel({store:this.store,columns:{items:a,defaults:{sortable:false}},viewConfig:{enableTextSelection:true,loadMask:false},border:false});
this.add(this.grid);
this.store.load();
this.onStartLoad();
function m(H,D,E,I,G,F){return(E.data.sip_ip+(E.data.sip_hostname?("<br><i>"+E.data.sip_hostname+"</i>"):""))
}function o(H,D,E,I,G,F){return(E.data.rtp_ip+(E.data.rtp_hostname?("<br><i>"+E.data.rtp_hostname+"</i>"):""))
}function q(H,D,E,I,G,F){return(H)
}function A(H,D,E,I,G,F){return((existsFlag(E.data.country_code)?'<img src="images/blank.png" class="flag flag-'+E.data.country_code+'" style="margin-bottom: -1px;" /> ':"")+H+" "+E.data.country_code)
}function p(I,D,E,J,H,F){var G=0;
F.each(function(K){G+=K.data.cnt_all
});
if(G){return(formatNumber(I/G*100,1)+"%")
}else{return("")
}}function r(D){return(D===null?"":formatNumber(D/60,1)+"m")
}function k(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0)+"%")
}function y(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0)+"%")
}function c(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0)+"s")
}function s(H,D,E,I,G,F){return(H===null?"":formatNumber(H,2))
}function u(H,D,E,I,G,F){return(H===null?"":formatNumber(H,3)+"%")
}function g(H,D,E,I,G,F){return(H===null?"":formatNumber(H,2))
}function t(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0)+"ms")
}function z(H,D,E,I,G,F){return(H===null?"":formatNumber(H,1)+"s")
}function h(H,D,E,I,G,F){return(H===null?"":formatNumber(H,2))
}function l(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0))
}function d(H,D,E,I,G,F){return(H===null?"":formatNumber(H,1))
}function b(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0)+"%")
}function C(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0)+"s")
}function B(H,D,E,I,G,F){return(H===null?"":formatNumber(H,0))
}function n(H,D,E,I,G,F){return(H===null?"":formatNumber(H,2))
}},getDefaultSetupValues:function(){var a={columns:this.message?null:["sip_ip","rtp_ip","callerd","ua_ab","country_by_sip_ip","country_by_number"].inArray(this._by)?"asr_all,ner_all,acd_all,mos_all":"acd_all,mos_all",sort_by:"cnt_all",sort_dir:"DESC",max_rows:10};
if(this.enableSwitch_by_source_or_destination){a.by_source_or_destination="destination"
}else{if(this.enableSwitch_by_caller_or_called){a.by_caller_or_called="caller"
}}return(a)
},getStoreExtraParams:function(){var a=this.callParent();
a.group_by=this._by=="sip_ip"?this.setupValues.by_source_or_destination=="source"?"2s":"2d":this._by=="rtp_ip"?this.setupValues.by_source_or_destination=="source"?"a_saddr":"b_saddr":this._by=="callerd"?this.setupValues.by_caller_or_called=="caller"?"caller":"called":this._by=="ua_ab"?this.setupValues.by_caller_or_called=="caller"?"a_ua":"b_ua":this._by=="country_by_sip_ip"?this.setupValues.by_source_or_destination=="source"?"country_by_sipcallerip":"country_by_sipcalledip":this._by=="country_by_number"?this.setupValues.by_caller_or_called=="caller"?"country_by_caller":"country_by_called":this.message?1:4;
a.limit=this.setupValues.max_rows;
return(a)
},getNeedColumns:function(){var a=[];
for(var b=0;
b<this.grid.headerCt.items.getCount();
b++){var c=this.grid.headerCt.items.get(b);
if(!c.hidden){a.push(c.dataIndex)
}}return(a)
},getNeedPercentile:function(){for(var a=0;
a<this.grid.headerCt.items.getCount();
a++){var b=this.grid.headerCt.items.get(a);
if(!b.hidden&&(b.dataIndex.match("_perc95")||b.dataIndex.match("_perc99"))){return(true)
}}return(false)
},getNeedCps:function(){for(var a=0;
a<this.grid.headerCt.items.getCount();
a++){var b=this.grid.headerCt.items.get(a);
if(!b.hidden&&(b.dataIndex.match("cps_"))){return(true)
}}return(false)
},onChangePriorityTable:function(){var d=this.formPanel.getForm().findField("columns");
var a=this.formPanel.getForm().findField("sort_by");
if(!d||!a){return
}var c=d.getValue();
if(c){c=c.split(",")
}var g=a.getValue();
var f=false;
a.setValue(null);
a.store.removeAll();
for(var b=0;
b<this._sortTableItems.length;
b++){if(this._sortTableItems[b]=="cnt_all"||c&&c.isIn(this._sortTableItems[b])&&(this._sortTableItems[b]!="cps_max"&&this._sortTableItems[b]!="cps_avg")){a.addMenuItem({id:this._sortTableItems[b],descr:this.findLangS("menu",this._sortTableItems[b])});
if(this._sortTableItems[b]==g){f=true
}}}a.setValue(f?g:"cnt_all")
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_sip_ip_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_sip_ip_grid",constructor:function(a){a=Ext.applyIf(a||{},{_by:"sip_ip"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_count_by_sip_ip_grid_message",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"count_by_sip_ip_grid_message",constructor:function(a){a=Ext.applyIf(a||{},{_by:"sip_ip",message:true});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_rtp_ip_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_rtp_ip_grid",constructor:function(a){a=Ext.applyIf(a||{},{_by:"rtp_ip"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_callerd_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_callerd_grid",constructor:function(a){a=Ext.apply(a||{},{_by:"callerd"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_count_by_callerd_grid_message",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"count_by_callerd_grid_message",constructor:function(a){a=Ext.apply(a||{},{_by:"callerd",message:true});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_ua_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_ua_grid",constructor:function(a){a=Ext.apply(a||{},{_by:"ua_ab"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_country_by_sip_ip_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_country_by_sip_ip_grid",constructor:function(a){a=Ext.apply(a||{},{_by:"country_by_sip_ip"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_count_by_country_by_sip_ip_grid_message",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"count_by_country_by_sip_ip_grid_message",constructor:function(a){a=Ext.apply(a||{},{_by:"country_by_sip_ip",message:true});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_country_by_number_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_country_by_number_grid",constructor:function(a){a=Ext.apply(a||{},{_by:"country_by_number"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_count_by_country_by_number_grid_message",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"count_by_country_by_number_grid_message",constructor:function(a){a=Ext.apply(a||{},{_by:"country_by_number",message:true});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_asr_acd_mos_by_sip_response_grid",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"asr_acd_mos_by_sip_response_grid",constructor:function(a){a=Ext.apply(a||{},{_by:"sip_response"});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_count_by_sip_response_grid_message",{extend:"Dashboard_d.SubPanel_asr_acd_mos_grid",subPanel_type:"count_by_sip_response_grid_message",constructor:function(a){a=Ext.apply(a||{},{_by:"sip_response",message:true});
this.callParent([a])
}});
Ext.define("Dashboard_d.SubPanel_sniffer_stat",{extend:"Dashboard_d.SubPanel",subPanel_type:"sniffer_stat",constructor:function(a){a=Ext.apply(a||{},{disableSetupInterval:true});
this.callParent([a])
},createContent:function(){if(this.grid){this.grid.destroy()
}this.createStore();
this.store.on("load",function(f,d,g){if(g){this.onStopLoad()
}},this);
var c=[{dataIndex:"id_sensor",widthChar:5},{xtype:"actioncolumn",dataIndex:"name",widthChar:14,rendererBase:renderString,sortable:false,items:[{getClass:function(d,g,h){var f="icon_blank";
if(h.data.get_stat=="OK"){f="icon_ok"
}else{if(h.data.get_stat){f="icon_state_error"
}}return(f)
}}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"}];
if(user_can_sensors_operations()){c.push({xtype:"actioncolumn",dataIndex:"version",widthChar:20,rendererBase:renderString,items:[{getClass:function(d,f,g){return(this.enableRestart(g)?"icon_reload":"icon_blank_w16")
},handler:function(f,l,d,g,h){var k=f.store.getAt(l);
if(this.enableRestart(k)){this.restartSensor(k.data)
}},enableHandler:function(h,k,l,m,d,g,f){return(this.enableRestart(l))
},tooltip:this.findLangS("tooltip","restart"),scope:this},{getClass:function(d,f,g){return(this.enableUpgrade(g)?"icon_upgrade_blue":"icon_blank_w16")
},handler:function(f,l,d,g,h){var k=f.store.getAt(l);
if(this.enableUpgrade(k)){this.upgradeSensor(k.data,null,null,h.browserEvent.xy||[h.browserEvent.x,h.browserEvent.y])
}},enableHandler:function(h,k,l,m,d,g,f){return(this.enableUpgrade(l))
},tooltip:this.findLangS("tooltip","upgrade"),width:53,scope:this}],baseContentDivStyle:"margin-bottom: 2",baseContentFirst:true})
}else{c.push({dataIndex:"version",widthChar:15})
}c.push({dataIndex:"pbStatString",renderer:a,widthChar:60},{dataIndex:"storingCdrLastSavedAt",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"storingCdrLastWriteAt",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"pbCountPacketDrop",widthNum:4},{dataIndex:"uptime",renderer:renderTime,widthNum:10,align:"right"},{dataIndex:"host",widthNum:13},{dataIndex:"port",widthNum:5});
for(var b=0;
b<c.length;
b++){c[b].header=this.findLangS("column",c[b].headerLang||c[b].dataIndex)||c[b].headerLang||c[b].dataIndex;
if(c[b].widthChar){c[b].width=__width_ColumnChar(c[b].widthChar)
}else{if(c[b].widthNum){c[b].width=__width_ColumnNum(c[b].widthNum)
}}}this.grid=new Ext.grid.GridPanel({store:this.store,columns:{items:c,defaults:{sortable:false}},viewConfig:{enableTextSelection:true,loadMask:false},border:false});
this.add(this.grid);
this.load();
this.onStartLoad();
function a(k,d,f,l,h,g){return(renderStringStyle(f.data.get_stat=="OK"?(k||findLangS("dashboard_d","text","waitForFirstState")):f.data.get_stat,{multiLine:true}))
}},refreshContent:function(){this.load();
this.onStartLoad()
},createStore:function(){this.destroyStore();
var a="sensors_stat";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:rsSensorsStat,idProperty:"id"})
}this.store=new Ext.data.Store({model:a,proxy:{type:"ajax",url:"php/model/utilities.php",actionMethods:"POST",extraParams:{task:"getSensors",params:Ext.encode({stat:true})},reader:{rootProperty:"results",totalProperty:"total",idProperty:"id"},listeners:{scope:this,exception:function(d,c,b){this.onError(getStringStoreException(d,c,b))
}},timeout:Ext.Ajax.timeout*2}})
},destroyStore:function(){if(this.store){delete this.store
}},restartSensor:function(c,b){if(!b){Ext.Msg.confirm(lang.questionText,this.findLangS("text","restartSensor").template([c.name]),function(d){if(d=="yes"){this.restartSensor(c,true)
}},this);
return
}var a=lang.restartingSensor+" "+c.name;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartSensor",params:Ext.encode({host:c.host,port:c.port,id_sensor:c.id_sensor,read_timeout:c.read_timeout})},success:function(){this.waitForSensorStat(c,a,20,function(){this.store.load()
},this)
},maskEl:this,maskMsg:a})
},upgradeSensor:function(f,h,b,l){if(!h){if(!this.upgradeVersions||!this.upgradeVersions.length){return
}var k=[];
var a=[];
for(var g=0;
g<this.upgradeVersions.length;
g++){if(!this.upgradeVersions[g].version.devel&&!this.upgradeVersions[g].version.rc&&!this.upgradeVersions[g].version.beta){k.push({text:this.upgradeVersions[g].version.version,_version:this.upgradeVersions[g]})
}else{a.push({text:this.upgradeVersions[g].version.version,_version:this.upgradeVersions[g]})
}}if(a.length){k.push({text:this.findLangS("text","betaVersions"),menu:{defaults:{scope:this,handler:function(m){this.upgradeSensor(f,m._version)
}},items:a}})
}var c=new Ext.menu.Menu({defaults:{scope:this,handler:function(m){this.upgradeSensor(f,m._version)
}},items:k});
c.showAt(l);
return
}if(!b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getChangelogForSnifferVersion",params:Ext.encode({version:h.version.version,url_changelog:h.url_changelog})},success:function(m){var n=findLangS("dashboard_d","text","upgradeSensor").template([f.name,h.version.version]);
if(m.changelog){n+="<br><br><i><u>"+findLangS("dashboard_d","text","changelog")+":</u></i><br><br>"+m.changelog.replaceall("\n","<br>")
}Ext.Msg.longalert(lang.questionText,n,function(o){if(o=="yes"){this.upgradeSensor(f,h,true)
}},this,true,{buttons:Ext.Msg.YESNO})
},maskEl:this});
return
}var d=lang.upgradingSensor+" "+f.name+" "+lang.toVersion+" "+h.version.version;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartSensor",params:Ext.encode({host:f.host,port:f.port,id_sensor:f.id_sensor,read_timeout:f.read_timeout,upgrade:true,version:Ext.encode({version:h.version.version,url:h.url,md5_32:h.md5_32,md5_64:h.md5_64,md5_arm:h.md5_arm,md5_64_ws:h.md5_64_ws})})},success:function(){this.waitForSensorStat(f,d,20,function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"runCheckAndSaveNewVersionSniffer",params:Ext.encode({force:true})},success:function(){this.store.load()
},maskEl:this,maskMsg:lang.checkSensorsVersions})
},this)
},maskEl:this,maskMsg:d})
},waitForSensorStat:function(f,d,c,b,a){this.mask(d);
Ext.defer(function(){this.unmask();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"waitForSensorStat",params:Ext.encode({id_sensor:f.id_sensor,timeout:90})},success:function(){b.call(a)
},maskEl:this,maskMsg:d})
},c*1000,this)
},enableRestart:function(a){return(a.data.get_stat=="OK"&&a.data.version&&user_can_sensors_operations())
},enableUpgrade:function(a){return(a.data.get_stat=="OK"&&a.data.version&&!a.data.upgrade_by_git&&user_can_sensors_operations()&&this.upgradeVersions)
},load:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getVersionsSnifferForUpgrade"},success:function(a){this.upgradeVersions=a.results&&a.results.length?a.results:null;
this.store.load()
},error:function(){this.store.load()
},failure:function(){this.store.load()
}})
}});
Ext.define("Dashboard_d.SubPanel_rrd",{extend:"Dashboard_d.SubPanel",constructor:function(a){this.callParent([a])
},createContent:function(){if(this.rrd&&this.rrd!=="error"){this.rrd.destroy()
}this.onStartLoad();
this.removeAll();
var a=this;
this.rrd=new Ext.Img({listeners:{afterrender:function(b){b.getEl().on("load",function(){if(a.rrd.src){a.onStopLoad();
a.unmask()
}});
b.getEl().on("error",function(){var c={checkError:true};
Ext.apply(c,a.getSrcRddParams());
ajaxSafeRequest({scope:a,url:"php/model/utilities.php",params:{task:a.getSrcRddTask(),params:Ext.encode(c)},success:function(d){if(this.rrd.src){this.onStopLoad();
this.unmask()
}this.removeAll();
this.add({xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},items:{xtype:"displayfield",value:d.error}});
this.rrd="error"
}})
})
},scope:this}});
this.add(this.rrd);
Ext.defer(function(){this.maskLoad();
this.rrd.setSrc(this.getSrcRdd());
Ext.defer(function(){if(this.loading){this.onStopLoad();
this.unmask()
}},Math.min(20,this.setupValues.refreshPeriod/2)*1000,this)
},100,this)
},refreshContent:function(){this._refreshContent()
},resizeContent:function(){this._refreshContent()
},_refreshContent:function(){if(this.rrd==="error"){this.createContent();
return
}if(!this.rrd||this.loading){return
}this.onStartLoad();
if(this._refreshContent_timeoutId){clearInterval(this._refreshContent_timeoutId)
}this._refreshContent_timeoutId=setTimeout(Ext.bind(this.__refreshContent,this),250)
},__refreshContent:function(){clearInterval(this._refreshContent_timeoutId);
this._refreshContent_timeoutId=null;
var a=this.getSrcRdd();
if(a!=this.rrd.src){this.rrd.setSrc(this.getSrcRdd());
Ext.defer(function(){if(this.loading){this.onStopLoad()
}},Math.min(20,this.setupValues.refreshPeriod/2)*1000,this)
}else{this.onStopLoad()
}}});
Ext.define("Dashboard_d.SubPanel_sniffer_rrd",{extend:"Dashboard_d.SubPanel_rrd",constructor:function(a){this.callParent([a]);
this.baseSetupFields.push("sensor_id","type_rrd")
},getSetupFormConfig:function(b){var a=this.callParent([b]);
a.items.push({xtype:"CBX_sensor",_addEmptySensorId:true,_hideEmptyIfNotNeed:true,labelWidth:b.labelWidth,width:b.labelWidth+__width_FieldChar(30),allowBlank:false},{xtype:"ComboBoxA",name:"type_rrd",fieldLabel:this.findLangS("field","typeSensorRRD"),aData:arSensorGraphsRRD,labelWidth:b.labelWidth,width:b.labelWidth+__width_FieldChar(30),allowBlank:false});
return(a)
},getSrcRdd:function(){var a=this.getSrcRddTask();
var b=this.getSrcRddParams();
return("php/model/utilities.php?task="+a+"&params="+encodeURIComponent(Ext.encode(b)))
},getSrcRddTask:function(){return("sensorGraph")
},getSrcRddParams:function(){var a=this.getTimeInterval();
return({sensorId:this.setupValues.sensor_id,graph:this.setupValues.type_rrd,begin:convSecTimeToNow(a[0].getTime()/1000),end:convSecTimeToNow(a[1].getTime()/1000),width:this.getWidth(),height:this.getHeight(),background:"ffffff",noframe:true,panelId:this.id})
},createTitle:function(a,b){return('<td><span id="'+a.id+'_title_info_spec_1" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.onClickSpec1([event.clientX,event.clientY]);" style="white-space: nowrap; cursor: pointer; font: '+__font_Grid+'; color: #555; margin-right: 3px;" data-qtip="'+this.findLangS("tooltip","setTypeSensorRdd")+'" >'+getDataArrayItem(arSensorGraphsRRD,this.setupValues.type_rrd)+'</span></td><td><img src="images/icon/chart_curve_grey.png" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.onClickSpec1([event.clientX,event.clientY]);" width="14" style="cursor: pointer; margin-top: 1px; margin-right: 15px;" data-qtip="'+this.findLangS("tooltip","setTypeSensorRdd")+'" ></td>')
},onClickSpec1:function(d){var a=[];
for(var b=0;
b<arSensorGraphsRRD.length;
b++){a.push({text:arSensorGraphsRRD[b][1],_type_rrd:arSensorGraphsRRD[b][0]})
}var c=new Ext.menu.Menu({defaults:{scope:this,handler:function(f){this.setTypeRdd(f._type_rrd)
}},items:a});
c.showAt(d)
},setTypeRdd:function(a){this.setupValues.type_rrd=a;
this.refreshContent()
},getTimeIntervalsData:function(){return(arDashboardTimeIntervals_sensors_rrd)
}});
Ext.define("Dashboard_d.SubPanel_collectd_rrd",{extend:"Dashboard_d.SubPanel_rrd",constructor:function(a){this.callParent([a]);
this.baseSetupFields.push("module","graph")
},createContent:function(){if(this.graphs){this.callParent()
}else{this.fillGraphs(this.setupValues.module,this.createContent)
}},getSetupFormConfig:function(b){var a=this.callParent([b]);
a.items.push({xtype:"ComboBoxA",name:"module",fieldLabel:this.findLangS("field","module"),labelWidth:b.labelWidth,width:b.labelWidth+__width_FieldChar(30),editable:false,aData:[],listeners:{scope:this,afterrender:this.fillPlugins,select:function(d){var c=this.formPanel.getForm().findField("graph");
this.fillGraphs(d.getValue())
}},allowBlank:false},{xtype:"ComboBoxA",name:"graph",fieldLabel:this.findLangS("field","graph"),labelWidth:b.labelWidth,width:b.labelWidth+__width_FieldChar(30),editable:false,aData:[],allowBlank:false,_stringValue:true});
return(a)
},getSrcRdd:function(){var a=this.getSrcRddTask();
var b=this.getSrcRddParams();
return("php/model/utilities.php?task="+a+"&params="+encodeURIComponent(Ext.encode(b)))
},getSrcRddTask:function(){return("collectd")
},getSrcRddParams:function(){var a=this.getTimeInterval();
return({subtask:"getgraph",params1:this.graphs[this.setupValues.graph],params2:{begin:parseInt(a[0].getTime()/1000),end:parseInt(a[1].getTime()/1000),width:this.getWidth(),heigth:this.getHeight(),background:"ffffff",noframe:true}})
},fillPlugins:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"collectd",params:Ext.encode({subtask:"getplugins"})},success:function(a){if(!a.plugins.length){return
}var c=this.formPanel.getForm().findField("module");
for(var b=0;
b<a.plugins.length;
b++){c.addMenuItem({id:a.plugins[b],descr:a.plugins[b]})
}if(this.setupValues.module){c.setValue(this.setupValues.module);
this.fillGraphs(this.setupValues.module)
}}})
},fillGraphs:function(a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"collectd",params:Ext.encode({subtask:"getgraphs",plugin:a})},success:function(c){if(!c.graphs.length){return
}var d=null;
if(this.formPanel){d=this.formPanel.getForm().findField("graph");
if(d){d.deleteAllMenuItems()
}}this._graphs=[];
var k=null;
var g=false;
for(var h=0;
h<c.graphs.length;
h++){var f="";
if(c.graphs[h].pinstance!=null&&c.graphs[h].pinstance!=""){if(f){f+=" "
}f+=c.graphs[h].pinstance
}if(c.graphs[h].tinstance!=null&&c.graphs[h].tinstance!=""){if(f){f+=" "
}f+=c.graphs[h].tinstance
}if(c.graphs[h].category!=null&&c.graphs[h].category!=""){if(f){f+=" "
}f+=c.graphs[h].category
}if(c.graphs[h].type!=null&&c.graphs[h].type!=""&&(c.graphs[h].type!=c.graphs[h].plugin||!f)){if(f){f+=" "
}f+=c.graphs[h].type
}if(d){d.addMenuItem({id:f,descr:f})
}this._graphs[f]=c.graphs[h];
if(k===null){k=f
}if(this.setupValues.graph==f){g=true
}}if(d){d.setValue(g?this.setupValues.graph:k)
}if(b){this.graphs=this._graphs;
b.call(this)
}}})
},createTitle:function(a,b){return('<td><span id="'+a.id+'_title_info_spec_1" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.onClickSpec1([event.clientX,event.clientY]);" style="white-space: nowrap; cursor: pointer; font: '+__font_Grid+'; color: #555; margin-right: 3px;" data-qtip="'+this.findLangS("tooltip","setTypeCollectdGraphRdd")+'" >'+this.setupValues.module+" "+this.setupValues.graph+'</span></td><td><img src="images/icon/chart_curve_grey.png" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.onClickSpec1([event.clientX,event.clientY]);" width="14" style="cursor: pointer; margin-top: 1px; margin-right: 15px;" data-qtip="'+this.findLangS("tooltip","setTypeCollectdGraphRdd")+'" ></td>')
},onClickSpec1:function(d){var a=[];
for(var b in this.graphs){if(!Ext.isFunction(this.graphs[b])){a.push({text:this.setupValues.module+" "+b,_graph:b})
}}var c=new Ext.menu.Menu({defaults:{scope:this,handler:function(f){this.setGraphRdd(f._graph)
}},items:a});
c.showAt(d)
},setGraphRdd:function(a){this.setupValues.graph=a;
this.refreshContent()
},okSetupForm:function(){this.graphs=this._graphs;
this.callParent()
}});
Ext.define("Dashboard_d.SubPanel_grid_rtp_stat",{extend:"Dashboard_d.SubPanel",constructor:function(a){a=Ext.apply(a||{},{disablePrevInterval:true,disableIntervalOffset:true,storeExtraParams:{limit:0},chartColumnWidthDefault:110,autoScrollSetupForm:true});
this.callParent([a]);
this.baseSetupFields.push("columns","sort_by","sort_dir","max_rows","enable_dns_ip_lookup","sensor_id","ip","ip_group_id");
this.filterDashboardTimeIntervals=["last_5minutes","last_15minutes","last_30minutes","last_60minutes","last_120minutes","last_180minutes","last_2hours","last_3hours","last_6hours","last_12hours","last_24hours"]
},getSetupValuesFromForm:function(){var a=this.callParent();
return(a)
},setSetupValuesToForm:function(a){this.callParent([a])
},getSetupFormConfig:function(f){var c=this.callParent([f]);
this._sortTableItems=[];
var b=[];
for(var g in arColumnsRtpStat){this._sortTableItems.push(g);
b.push([g,this.findLangS("menu",g)])
}var h=this;
var a=f.labelWidthInTab+4;
var d=a-7;
c.items.push({xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",value:"columns:",width:a,fieldStyle:{"text-align":"left"}},{xtype:"container",width:__width_FieldSeparator},{xtype:"priorityTable",tableItems:b,name:"columns",width:__width_FieldChar(60),height:400,onChange:this.onChangePriorityTable,onChangeScope:this,dataColumn:true,rendererDataColumn:function(r,u,l,q,n,s){var m=arColumnsRtpStat[l.data.code];
if(m){var t=[];
var p=[];
if(m.agreg){if(Ext.isDefined(l.data.data)&&l.data.data.agreg&&Ext.isArray(l.data.data.agreg)){for(var k=0;
k<l.data.data.agreg.length;
k++){t.push(h.findLangS("menu",l.data.data.agreg[k]))
}}}if(m.chart){if(Ext.isDefined(l.data.data)&&l.data.data.chart&&Ext.isArray(l.data.data.chart)){for(var k=0;
k<l.data.data.chart.length;
k++){p.push(h.findLangS("menu",l.data.data.chart[k]))
}}}var o="";
if(t.length){o=h.findLangS("menu","numericColumn")+": "+t.join(", ")
}if(p.length){if(o){o+="<br>"
}o+=h.findLangS("menu","chartWidget")+": "+p.join(", ")
}return(o)
}return("")
},handlerDataColumn:function(s,k,u,v,o,l){var t=arColumnsRtpStat[s.data.code];
if(!t){return
}var m=[];
if(t.agreg){var r=[];
for(var q=0;
q<t.agreg.length;
q++){r.push({checked:Ext.isDefined(s.data.data)&&Ext.isDefined(s.data.data.agreg)&&s.data.data.agreg.isIn?s.data.data.agreg.isIn(t.agreg[q]):false,_id:t.agreg[q]})
}for(var q=0;
q<r.length;
q++){r[q].text=this.findLangS("menu",r[q]._id)
}m.push({text:this.findLangS("menu","numericColumn"),menu:{defaults:{checkHandler:function(y,z){s.beginEdit();
if(!Ext.isDefined(s.data.data)){s.data.data={}
}if(!Ext.isDefined(s.data.data.agreg)){s.data.data.agreg=[]
}if(z){if(!s.data.data.agreg.isIn(y._id)){s.data.data.agreg.push(y._id)
}}else{if(s.data.data.agreg.isIn(y._id)){var w=s.data.data.agreg.indexOf(y._id);
s.data.data.agreg.splice(w,1)
}}s.commit();
s.endEdit()
},scope:this},items:r}})
}if(t.chart){var p=[];
for(var q=0;
q<t.agreg.length;
q++){p.push({checked:Ext.isDefined(s.data.data)&&Ext.isDefined(s.data.data.chart)&&s.data.data.chart.isIn?s.data.data.chart.isIn(t.agreg[q]):false,_id:t.agreg[q]})
}for(var q=0;
q<p.length;
q++){p[q].text=this.findLangS("menu",p[q]._id)
}m.push({text:this.findLangS("menu","chartWidget"),menu:{defaults:{checkHandler:function(y,z){s.beginEdit();
if(!Ext.isDefined(s.data.data)){s.data.data={}
}if(!Ext.isDefined(s.data.data.chart)){s.data.data.chart=[]
}if(z){if(!s.data.data.chart.isIn(y._id)){s.data.data.chart.push(y._id)
}}else{if(s.data.data.chart.isIn(y._id)){var w=s.data.data.chart.indexOf(y._id);
s.data.data.chart.splice(w,1)
}}s.commit();
s.endEdit()
},scope:this},items:p}})
}var n=new Ext.menu.Menu({items:m});
n.showAtMouse(l)
},enableHandlerDataColumn:function(o,p,q,r,l,n,m){var k=arColumnsRtpStat[q.data.code];
return(k)
},tooltipDataColumn:this.findLangS("tooltip","selectAgregationMethodAndChartWidget"),handlerDataColumnScope:this,flexDataColumn:2}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",items:{xtype:"ComboBoxA",name:"sort_by",fieldLabel:this.findLangS("field","sort_by"),aData:[],labelWidth:a,width:a+__width_FieldChar(25)}},{xtype:"container",items:{xtype:"ComboBoxA",name:"sort_dir",fieldLabel:this.findLangS("field","sort_dir"),aData:[["ASC",this.findLangS("combomenu","ascending")],["DESC",this.findLangS("combomenu","descending")]],labelWidth:a,width:a+__width_FieldChar(25)}},{xtype:"container",items:{xtype:"numberfield",name:"max_rows",fieldLabel:this.findLangS("field","max_rows"),minValue:10,maxValue:50,labelWidth:a,width:a+__width_FieldNum(6),allowBlank:false}},{xtype:"checkbox",name:"enable_dns_ip_lookup",fieldLabel:this.findLangS("field","enable_dns_ip_lookup"),labelWidth:a},{xtype:"fieldset",title:this.findLangS("title","filters"),style:__style_RedukFieldSet(),items:[{xtype:"CBX_sensor",_addEmptySensorId:true,_hideEmptyIfNotNeed:true,_initSetLocalSensor:false,labelWidth:d,width:d+__width_FieldChar(50),_clearButton:true,allowBlank:true},{xtype:"textarea",name:"ip",fieldLabel:this.findLangS("field","IP"),labelWidth:d,width:d+__width_FieldChar(50),height:__height_FieldLines(6)},{xtype:"CBX_cbIpGroups",name:"ip_group_id",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,width:__width_FieldChar(50)-__width_LabelFieldSeparator,style:{marginLeft:d+__width_LabelFieldSeparator},listConfig:{minWidth:__width_FieldChar(60)}}]});
return(c)
},createStore:function(b){this.destroyStore();
var a="dashboard_d__grid_rtp_stat";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:rsRtp_stats,idProperty:"id"})
}this.store=new Ext.data.Store(Ext.applyIf(b||{},{model:a,proxy:{type:"ajax",url:"php/model/sql.php",actionMethods:"POST",extraParams:this.getStoreExtraParams(),reader:{rootProperty:"results",totalProperty:"total",idProperty:"id"},listeners:{scope:this,exception:function(f,d,c){this.onError(getStringStoreException(f,d,c))
}},timeout:Ext.Ajax.timeout*2},listeners:{scope:this,beforeload:this.onBeforeLoad}}))
},createContent:function(){this.destroyStore();
this.destroyGrid();
this.createAndSetStore();
this.createGrid();
this.add(this.grid);
this.store.load();
this.onStartLoad()
},createAndSetStore:function(){this.createStore({remoteSort:true});
this.store.on("load",function(b,a,c){if(c){this.onStopLoad()
}},this)
},destroyStore:function(){if(this.store){delete this.store
}},createGrid:function(){var k=this;
var d=[];
d.push({dataIndex:"saddr",header:"saddr",renderer:h,width:__width_ColumnChar(this.message?45:30)});
var g=this.getFields();
for(var l in g){var c={dataIndex:l,_type:g[l].field,header:g[l].field,_agreg:g[l].agreg,_chart:g[l].chart};
if(c._chart){c.xtype="widgetcolumn";
c.widget={xtype:"sparklinebar",bind:"{record."+l+"}",barWidth:3,barSpacing:0,chartRangeMin:0,tooltipFormatter:function(p,n,o){if(o&&o.length){var q=p.$widgetRecord.data[p.$widgetColumn.dataIndex+"_data"][o[0].offset];
return(Ext.Date.format(dateTimeStringToDate(q[0]),__format_Time)+"<br>"+k.renderValue(p.$widgetColumn.dataIndex,q[1]))
}}};
if(c._type.match("mos")){c.widget.chartRangeMax=5;
c.widget.colorMap={"0:":"#0D8A00","0.7:":"#7B8A00","1.0:":"#AD8A00","1.4:":"#CA5400","1.9:":"#AD1616"}
}else{if(c._type.match("jitter")){c.widget.chartRangeMax=200;
c.widget.colorMap={"0:":"#00C000","20:":"#AAC000","45:":"#E9B300","90:":"#E98400","170:":"#E90000"}
}else{if(c._type.match("loss")){c.widget.chartRangeMax=30;
c.widget.colorMap={"0:":"#00C000","0.1:":"#7DC000","0.5:":"#AAC000","1:":"#E9E600","2:":"#E9B300","5:":"#E98400","10:":"#E95601","20:":"#E90000"}
}}}c.width=120;
c.align="right"
}else{if(c._type.match("counter")){c.width=__width_ColumnNum(7)
}else{if(c._type.match("mos")){c.renderer=a;
c.width=__width_ColumnNum(10)
}else{if(c._type.match("jitter")){c.renderer=b;
c.width=__width_ColumnNum(10)
}else{if(c._type.match("loss")){c.renderer=m;
c.width=__width_ColumnNum(10)
}}}}c.align="right"
}d.push(c)
}for(var f=0;
f<d.length;
f++){d[f].header=this.findLangS("column",d[f].header);
if(d[f]._chart){d[f].header+=this.findLangS("column","chartSuffix")
}if(d[f]._agreg){d[f].header+="<br>"+this.findLangS("text","agregationShort")+": "+this.findLangS("menu",d[f]._agreg)
}}this.grid=new Ext.grid.GridPanel({store:this.store,columns:{items:d,defaults:{sortable:false}},viewConfig:{enableTextSelection:true,loadMask:false},border:false,bufferedRenderer:false});
function h(r,n,o,s,q,p){return(o.data.saddr+(o.data.saddr_hostname?("<br><i>"+o.data.saddr_hostname+"</i>"):""))
}function a(r,n,o,s,q,p){return(k.renderMos(r))
}function b(r,n,o,s,q,p){return(k.renderJitter(r))
}function m(r,n,o,s,q,p){return(k.renderPacketsLost(r))
}},destroyGrid:function(){if(this.grid){this.grid.destroy();
delete this.grid
}},refreshContent:function(){this.store.proxy.extraParams=this.getStoreExtraParams();
this.store.load();
this.onStartLoad()
},getStoreExtraParams:function(){var g={task:"LISTING",module:"rtp_stats"};
if(this.storeExtraParams){Ext.applyIf(g,this.storeExtraParams)
}var f=this.getTimeInterval();
Ext.applyIf(g,{time_from:f[0],time_to:f[1]});
var a=this.getFields();
var d=[];
for(var k in a){d.push(k)
}Ext.applyIf(g,{fields:Ext.encode(d)});
Ext.applyIf(g,{filters:Ext.encode({sensor_id:this.setupValues.sensor_id,ip:this.setupValues.ip,ip_group_id:this.setupValues.ip_group_id})});
if(this.setupValues.sort_by){var h=[];
if(this.setupValues.sort_by!="counter"){h.push(["counter","desc"])
}var d=this.getFields();
for(var k in d){if(d[k].field==this.setupValues.sort_by){h.push([k,this.setupValues.sort_dir])
}}g.sortDir=Ext.encode(h)
}g.maxRows=this.setupValues.max_rows;
var l={};
if(this.grid&&this.grid.columnManager){var b=this.grid.columnManager.getColumns();
for(var c=0;
c<b.length;
c++){if(b[c].dataIndex.match("chart")){l[b[c].dataIndex]=b[c].getWidth()
}}}g.enable_dns_ip_lookup=this.setupValues.enable_dns_ip_lookup;
g.chartColumnsWidth=Ext.encode(l);
g.chartColumnWidthDefault=this.chartColumnWidthDefault;
return(g)
},repairLayout:function(){Ext.defer(function(){this.repairChartsInGrid()
},1,this)
},repairChartsInGrid:function(){if(!this.grid){return
}var c=this.grid.columnManager.getColumns();
for(var b=0;
b<this.grid.store.getCount();
b++){for(var a=0;
a<c.length;
a++){if(Ext.fly(this.grid.getView().getNode(b))){var d=Ext.fly(this.grid.getView().getNode(b)).down(".x-grid-cell:nth-child("+(a+1)+")").down(".x-sparkline");
if(d){d.dom.style.width=d.dom.width+"px"
}}}}},getFields:function(){var b={};
for(var d in this.setupValues.columns){if(this.setupValues.columns[d]&&this.setupValues.columns[d].agreg&&this.setupValues.columns[d].agreg.length){for(var c=0;
c<this.setupValues.columns[d].agreg.length;
c++){f=this.setupValues.columns[d].agreg[c];
b[d+"_a_"+f]={field:d,agreg:f}
}}else{var f=undefined;
var a=arColumnsRtpStat[d];
if(a&&a.agreg){f=a.agreg[0]
}b[d+(f?"_a_"+f:"")]={field:d,agreg:f}
}if(this.setupValues.columns[d]&&this.setupValues.columns[d].chart&&this.setupValues.columns[d].chart.length){for(var c=0;
c<this.setupValues.columns[d].chart.length;
c++){f=this.setupValues.columns[d].chart[c];
b[d+"_a_"+f+"_chart"]={field:d,agreg:f,chart:true}
}}}return(b)
},onBeforeLoad:function(){this.abortStoreLoad();
if(!this.isLoading()){this.onStartLoad()
}},abortStoreLoad:function(){if(this.store){abortLoadStore(this.store)
}},getDefaultSetupValues:function(){var a={columns:{counter:{},mos_f1_min:{agreg:["min"],chart:["min"]}},sort_by:"counter",sort_dir:"DESC",max_rows:20,enable_dns_ip_lookup:true};
return(a)
},onChangePriorityTable:function(){var f=this.formPanel.getForm().findField("columns");
var b=this.formPanel.getForm().findField("sort_by");
if(!f||!b){return
}var a=f.getValue();
var d=[];
for(var c in a){if(c){d.push(c)
}}var h=b.getValue();
var g=false;
b.setValue(null);
b.store.removeAll();
for(var c=0;
c<this._sortTableItems.length;
c++){if(d.isIn(this._sortTableItems[c])){b.addMenuItem({id:this._sortTableItems[c],descr:this.findLangS("menu",this._sortTableItems[c])});
if(this._sortTableItems[c]==h){g=true
}}}b.setValue(g?h:"cnt_all")
},renderValue:function(a,b){if(a.match("mos")){return(this.renderMos(b))
}else{if(a.match("jitter")){return(this.renderJitter(b))
}else{if(a.match("loss")){return(this.renderPacketsLost(b))
}}}return(null)
},renderMos:function(a){return(a===null?"":formatNumber(a,2))
},renderJitter:function(a){return(a===null?"":formatNumber(a,2))
},renderPacketsLost:function(a){return(a===null?"":formatNumber(a,3)+"%")
}});
Ext.define("Dashboard_d.SubPanel_chart_3d_rtp_stat",{extend:"Dashboard_d.SubPanel",constructor:function(a){a=Ext.apply(a||{},{disableSetupInterval:true,disableSetupRefreshPeriod:true,autoScrollSetupForm:true});
this.callParent([a]);
this.baseSetupFields.push("type_chart","sensor_id","enable_dns_ip_lookup","ip","ip_group_id","chart_interval","chart_agregation_type","chart_column_count","chart_column_scale_perc","chart_column_fontsize_perc","chart_column_fontcolor","chart_row_count","chart_row_scale_perc","chart_row_fontsize_perc","chart_row_fontcolor","chart_height_scale_perc","chart_height_fontsize_perc","chart_height_fontcolor","chart_height_max","chart_curve_fontsize_perc","chart_camera_position_x","chart_camera_position_y","chart_camera_position_z","chart_camera_lookat_x","chart_camera_lookat_y","chart_camera_lookat_z","chart_camera_perspective")
},getSetupFormConfig:function(c){var a=this.callParent([c]);
var b=c.labelWidth-6;
var g=__width_FieldChar(8);
var f=["max","avg"];
for(var d=0;
d<f.length;
d++){f[d]=[f[d],f[d]]
}a.items.push({xtype:"ComboBoxA",name:"type_chart",fieldLabel:this.findLangS("field","typeChart"),aData:arChart3D_rtp_stat,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(30),allowBlank:false,listeners:{scope:this,select:this.onSelectTypeChart}},{xtype:"checkbox",name:"enable_dns_ip_lookup",fieldLabel:this.findLangS("field","enable_dns_ip_lookup"),labelWidth:c.labelWidth},{xtype:"fieldset",title:this.findLangS("title","filters"),style:__style_RedukFieldSet(),items:[{xtype:"CBX_sensor",_addEmptySensorId:true,_hideEmptyIfNotNeed:true,_initSetLocalSensor:false,labelWidth:b,width:b+__width_FieldChar(50),_clearButton:true,allowBlank:true},{xtype:"textarea",name:"ip",fieldLabel:this.findLangS("field","IP"),labelWidth:b,width:b+__width_FieldChar(50),height:__height_FieldLines(6)},{xtype:"CBX_cbIpGroups",name:"ip_group_id",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,width:__width_FieldChar(50)-__width_LabelFieldSeparator,style:{marginLeft:b+__width_LabelFieldSeparator},listConfig:{minWidth:__width_FieldChar(60)}}]},{xtype:"fieldset",title:this.findLangS("title","chartParameters"),style:__style_RedukFieldSet(),items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"chart_interval",fieldLabel:this.findLangS("field_rtp3d","interval"),minValue:10,maxValue:3600,step:10,labelWidth:b,width:b+__width_FieldNum(5)+__width_Trigger,helpText:this.findLangS("help_rtp3d","interval")},{xtype:"ComboBoxA",name:"chart_agregation_type",fieldLabel:this.findLangS("field_rtp3d","agregation_type"),aData:f,labelWidth:__width_FieldChar(10),width:__width_FieldChar(10)+__width_FieldChar(5)+__width_Trigger,style:{marginLeft:10},helpText:this.findLangS("help_rtp3d","agregation_type")}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:{type:"table",columns:7,tableAttrs:{border:0}},defaults:{style:{marginRight:15}},items:[{xtype:"container",width:b-10},{xtype:"displayfield",value:this.findLangS("field_rtp3d","number"),helpText:this.findLangS("help_rtp3d","number")},{xtype:"displayfield",value:this.findLangS("field_rtp3d","scale")+" [%]",helpText:this.findLangS("help_rtp3d","scale")},{xtype:"displayfield",value:this.findLangS("field_rtp3d","font_size")+" [%]",helpText:this.findLangS("help_rtp3d","font_size")},{xtype:"displayfield",value:this.findLangS("field_rtp3d","font_color"),helpText:this.findLangS("help_rtp3d","font_color")},{xtype:"displayfield",value:this.findLangS("field_rtp3d","max_value"),helpText:this.findLangS("help_rtp3d","max_value")},{xtype:"displayfield",value:this.findLangS("field_rtp3d","curve_font_size")+" [%]",helpText:this.findLangS("help_rtp3d","curve_font_size")},{xtype:"displayfield",value:this.findLangS("field_rtp3d","times")+":",helpText:this.findLangS("help_rtp3d","times")},{xtype:"numberfield",name:"chart_column_count",minValue:3,maxValue:50,width:__width_FieldNum(3)+__width_Trigger},{xtype:"numberfield",name:"chart_column_scale_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger},{xtype:"numberfield",name:"chart_column_fontsize_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger},{xtype:"colorpickerfield",name:"chart_column_fontcolor",width:__width_FieldChar(8)+__width_Trigger},{xtype:"container",colspan:2},{xtype:"displayfield",value:this.findLangS("field_rtp3d","addresses")+":",helpText:this.findLangS("help_rtp3d","addresses")},{xtype:"numberfield",name:"chart_row_count",minValue:1,maxValue:50,width:__width_FieldNum(3)+__width_Trigger},{xtype:"numberfield",name:"chart_row_scale_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger},{xtype:"numberfield",name:"chart_row_fontsize_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger},{xtype:"colorpickerfield",name:"chart_row_fontcolor",width:__width_FieldChar(8)+__width_Trigger},{xtype:"container",colspan:2},{xtype:"displayfield",value:this.findLangS("field_rtp3d","values")+":",helpText:this.findLangS("help_rtp3d","values")},{xtype:"container"},{xtype:"numberfield",name:"chart_height_scale_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger},{xtype:"numberfield",name:"chart_height_fontsize_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger},{xtype:"colorpickerfield",name:"chart_height_fontcolor",width:__width_FieldChar(8)+__width_Trigger},{xtype:"numberfield",name:"chart_height_max",minValue:1,maxValue:10000,width:__width_FieldNum(6)+__width_Trigger},{xtype:"numberfield",name:"chart_curve_fontsize_perc",minValue:20,maxValue:500,step:1,width:__width_FieldNum(4)+__width_Trigger}],style:{marginBottom:__height_FieldSeparator+10}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"chart_camera_position_x",fieldLabel:this.findLangS("field_rtp3d","camera_position"),minValue:-100,maxValue:+100,step:0.1,labelWidth:b,width:b+__width_FieldNum(5)+__width_Trigger,helpText:this.findLangS("help_rtp3d","camera_position")},{xtype:"container",width:10},{xtype:"numberfield",name:"chart_camera_position_y",minValue:-100,maxValue:+100,step:0.1,hideLabel:true,width:__width_FieldNum(5)+__width_Trigger},{xtype:"container",width:10},{xtype:"numberfield",name:"chart_camera_position_z",minValue:-100,maxValue:+100,step:0.1,hideLabel:true,width:__width_FieldNum(5)+__width_Trigger},{xtype:"container",width:10},{xtype:"button",iconCls:"icon_reload",tooltip:this.findLangS("tooltip","loadCameraParametersFromChart"),disabled:!(this.chart&&this.chart.chart),scope:this,handler:function(){var k=this.chart.chart.getCameraConfig2();
for(var h in k){var m="chart_camera_"+h;
var l=this.formPanel.getForm().findField(m);
if(l){l.setValue(formatNumber(k[h],1))
}}}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"chart_camera_lookat_x",fieldLabel:this.findLangS("field_rtp3d","camera_lookat"),minValue:-100,maxValue:+100,step:0.1,labelWidth:b,width:b+__width_FieldNum(5)+__width_Trigger,helpText:this.findLangS("help_rtp3d","camera_lookat")},{xtype:"container",width:10},{xtype:"numberfield",name:"chart_camera_lookat_y",minValue:-100,maxValue:+100,step:0.1,hideLabel:true,width:__width_FieldNum(5)+__width_Trigger},{xtype:"container",width:10},{xtype:"numberfield",name:"chart_camera_lookat_z",minValue:-100,maxValue:+100,step:0.1,hideLabel:true,width:__width_FieldNum(5)+__width_Trigger}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"chart_camera_perspective",fieldLabel:this.findLangS("field_rtp3d","camera_perspective"),minValue:-100,maxValue:+100,step:0.1,labelWidth:b,width:b+__width_FieldNum(5)+__width_Trigger,helpText:this.findLangS("help_rtp3d","camera_perspective")}],style:{marginBottom:__height_FieldSeparator}}]});
return(a)
},getSetupValuesFromForm:function(){var a=this.callParent();
a.refreshPeriod=10;
return(a)
},getDefaultSetupValues:function(){var a={type_chart:"mosf1_min",enable_dns_ip_lookup:true,refreshPeriod:10};
Ext.applyIf(a,this.getDefaultSetupValuesForChart());
Ext.applyIf(a,this.getDefaultSetupValuesForTypeChart(a.type_chart));
return(a)
},prepareSetupValues:function(b){for(var a in b){if(a.match&&a.match(/^chart_/)&&!b[a]){delete b[a]
}}Ext.applyIf(b,this.getDefaultSetupValuesForChart());
if(b.type_chart){Ext.applyIf(b,this.getDefaultSetupValuesForTypeChart(b.type_chart))
}return(b)
},onSelectTypeChart:function(d){var b=d.getValue();
var f=this.getDefaultSetupValuesForTypeChart(b);
for(var a in f){var c=this.formPanel.getForm().findField(a);
if(c){c.setValue(f[a])
}}},getDefaultSetupValuesForChart:function(){return({chart_interval:Ext.Chart3D.rtp_stat.prototype.defaultConfig.interval,chart_agregation_type:Ext.Chart3D.rtp_stat.prototype.defaultConfig.agregation_type,chart_column_count:Ext.Chart3D.rtp_stat.prototype.defaultConfig.column_count,chart_row_count:Ext.Chart3D.rtp_stat.prototype.defaultConfig.row_count,chart_column_scale_perc:100,chart_row_scale_perc:100,chart_height_scale_perc:100,chart_column_fontsize_perc:100,chart_row_fontsize_perc:100,chart_height_fontsize_perc:100,chart_curve_fontsize_perc:100,chart_column_fontcolor:Ext.Chart3D.rtp_stat.prototype.defaultConfig.column_fontcolor,chart_row_fontcolor:Ext.Chart3D.rtp_stat.prototype.defaultConfig.row_fontcolor,chart_height_fontcolor:Ext.Chart3D.rtp_stat.prototype.defaultConfig.height_fontcolor})
},getDefaultSetupValuesForTypeChart:function(a){var b=Ext.Chart3D.rtp_stat.prototype.chartConfig[a];
var c={chart_height_max:b.chartConfig.chartMaxValue};
return(c)
},createContent:function(){if(this.chart){this.chart.chart.deleteChart3D();
this.chart.destroy()
}this.removeAll();
var a={};
for(var b in this.setupValues){if(b.match&&b.match(/^chart_/)&&this.setupValues[b]){a[b.substr(6)]=this.setupValues[b]
}}this.chart=new Ext.Chart3D.rtp_stat({typeChart:this.setupValues.type_chart,enable_dns_ip_lookup:this.setupValues.enable_dns_ip_lookup,enable_context_mos_jitter_loss:true,enable_context_cdr:true,chartConfig2:a,filters:{sensor_id:this.setupValues.sensor_id,ip:this.setupValues.ip,ip_group_id:this.setupValues.ip_group_id}});
var c=this;
this.chart.createChart(function(d){if(!d||d.task!="re_create"){c.onStartLoad();
c._refreshContent(true)
}});
this.add(this.chart.chart)
},refreshContent:function(){if(this.chart){this.onStartLoad();
this._refreshContent()
}else{this.createContent()
}},_refreshContent:function(a){this.chart.loadData(function(){if(this.chart.chart.data.empty){this.chart.chart.deleteChart3D();
this.chart.destroy();
this.removeAll();
delete this.chart
}this.onStopLoad()
},this,a)
},onBeforeRemoveAll:function(){if(this.chart){this.chart.chart.deleteChart3D();
this.chart.destroy();
delete this.chart
}},createTitle:function(a,b){return('<td><img src="images/icon/camera_grey.png" panelid="'+b+'" onclick="Ext.getCmp(this.attributes.panelid.nodeValue).contentPanel.setCameraParametersToPanelSetup([event.clientX,event.clientY]);" width="16" style="cursor: pointer; margin-top: 1px; margin-right: 15px;" data-qtip="'+this.findLangS("tooltip","setCameraParametersToPanelSetup")+'" ></td>')
},setCameraParametersToPanelSetup:function(){var b=this.chart.chart.getCameraConfig2();
for(var a in b){this.setupValues["chart_camera_"+a]=formatNumber(b[a],1)
}this.dashboardPanel.dockContainer.enableSaveDeleteTemplate()
},enableRefresh:function(){return((!this.chart||!this.chart.suppressRefresh())&&this.dashboardPanel.enableRefresh())
}});
Ext.define("Dashboard_d.SubPanel_active_calls_map",{extend:"Dashboard_d.SubPanel",constructor:function(a){a=Ext.apply(a||{},{disableSetupInterval:true,disablePrevInterval:true,disableIntervalOffset:true});
this.callParent([a]);
this.baseSetupFields.push("sensor_id","caller_called_by","items_scale","autocenter","center_latitude","center_longitude","zoom","line_colors")
},getSetupFormConfig:function(c){var a=this.callParent([c]);
this.lineColorsPanel=new GMap.Tools.LineColors({frame:false});
var b=[{xtype:"CBX_sensor",_addEmptySensorId:true,_addAll:true,_hideEmptyIfNotNeed:true,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(30),allowBlank:false},{xtype:"ComboBoxA",name:"caller_called_by",fieldLabel:this.findLangS("field","caller_called_by"),aData:GMap.Utils.getCallerCalledByData(),_stringValue:true,allowBlank:false,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(37)},{xtype:"numberfield",name:"items_scale",fieldLabel:this.findLangS("field","items_scale"),minValue:25,maxValue:400,step:5,allowBlank:false,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldNum(3)+__width_Trigger},{xtype:"checkbox",name:"autocenter",fieldLabel:this.findLangS("field","autocenter"),labelWidth:c.labelWidth,listeners:{change:function(){this.setContextSetupValues("autocenter")
},scope:this}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"center_latitude",fieldLabel:this.findLangS("field","latitude_longitude"),labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldNum(8),allowDecimals:true},{xtype:"textfield",name:"center_longitude",width:__width_FieldNum(8),allowDecimals:true,hideLabel:true,style:{marginLeft:__width_FieldSeparator}},{xtype:"button",iconCls:"icon_google_maps",width:22,_btnId:"lat_lng",scope:this,handler:this.setLatLngFromMap,style:{marginLeft:__width_FieldSeparator}},{xtype:"numberfield",name:"zoom",fieldLabel:this.findLangS("field","zoom"),labelWidth:__width_FieldChar(6),minValue:1,maxValue:20,width:__width_Form(__width_FieldChar(6),__width_FieldNum(6)),style:{marginLeft:__width_FieldSeparator+10}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",value:this.findLangS("field","lineColors")+":",width:c.labelWidth,fieldStyle:{"text-align":"left"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",items:this.lineColorsPanel}],style:{marginBottom:__height_FieldSeparator}}];
delete a.items[a.items.length-1].style.marginBottom;
a.items.push({xtype:"container",layout:"vbox",items:b});
return(a)
},getSetupValuesFromForm:function(){var a=this.callParent();
a.line_colors=Ext.encode(this.lineColorsPanel.getConfigData());
return(a)
},setSetupValuesToForm:function(a){this.callParent([a]);
this.lineColorsPanel.setConfigData(Ext.decode(a.line_colors))
},getDefaultSetupValues:function(){var a={refreshPeriod:60,sensor_id:_sensorId_all,caller_called_by:"number/number",items_scale:100,autocenter:true,center_latitude:null,center_longitude:null,zoom:5,line_colors:Ext.encode(GMap.Utils.getDefaultLineColors())};
return(a)
},setContextSetupValues:function(b){this.callParent([b]);
switch(b){case"autocenter":var a=this.getSetupValue("autocenter");
this.setSetupEnable("center_latitude",!a);
this.setSetupEnable("center_longitude",!a);
this.setSetupEnable("zoom",!a);
var c=this.formPanel.findC("_btnId","lat_lng");
if(c){c.enableIf(!a)
}break
}},setLatLngFromMap:function(){var b=this.getSetupValue("center_latitude");
var a=this.getSetupValue("center_longitude");
new GMap.SelectPosPanel({pos:!Ext.isEmpty(b)&&!Ext.isEmpty(a)?{lat:parseFloat(b),lng:parseFloat(a)}:undefined,onOk:function(c){if(c){this.setSetupValue("center_latitude",c.lat);
this.setSetupValue("center_longitude",c.lng);
return(true)
}return(false)
},onOkScope:this,backgroundColor:__color_WindowFrame,windowConfig:{autoShow:true,width:800,height:600}})
},isSetLatLngZoom:function(){return(!this.setupValues.autocenter&&Ext.isDefined(this.setupValues.center_latitude)&&Ext.isDefined(this.setupValues.center_longitude)&&Ext.isDefined(this.setupValues.zoom))
},createContent:function(){var a=this;
this.removeAll();
this.onStartLoad();
this.mapPanel=new GMap.PanelExt({selectSensors:this.setupValues.sensor_id,caller_called_by:this.setupValues.caller_called_by,items_scale:this.setupValues.items_scale,line_colors:Ext.decode(this.setupValues.line_colors),mainPos:this.isSetLatLngZoom()?[this.setupValues.center_latitude,this.setupValues.center_longitude]:[0,0],disableLoadGeoipData:true,disableTitle:true,disableIcon:true,disableTbar:true,border:false,zoom:this.isSetLatLngZoom()?this.setupValues.zoom:2,onCreateMap:function(){this.onStopLoad()
},onCreateMapScope:this,disableInitAutoCenter:this.isSetLatLngZoom(),autoCenter:function(){return(!a.isSetLatLngZoom()&&!a.mapPanel._mouseIn)
}});
this.add(this.mapPanel)
},refreshContent:function(){if(this.mapPanel){this.onStartLoad();
this.mapPanel.reload()
}else{this.createContent()
}},onBeforeRemoveAll:function(){}});
Ext.define("Dashboard_d.SubPanel_active_calls_chart",{extend:"Dashboard_d.SubPanel",disableForceCreateContent:true,constructor:function(a){a=Ext.apply(a||{},{disableSetupInterval:true,disablePrevInterval:true,disableIntervalOffset:true});
this.callParent([a]);
this.baseSetupFields.push("sensor_id","chart_type","chart_length_minutes","only_connected","international_or_local","filter_number","filter_number_group","filter_ip","filter_ip_group")
},getSetupFormConfig:function(c){var a=this.callParent([c]);
var f=["sensors","src_ip","dst_ip"];
for(var d=0;
d<f.length;
d++){f[d]=[f[d],this.findLangS("combomenu","active_calls_chart_by_"+f[d])]
}var b=[{xtype:"CBX_sensor",_multiSelect2:true,_addEmptySensorId:true,_addAll:true,_hideEmptyIfNotNeed:true,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(30),_listWidth:30,allowBlank:false},{xtype:"ComboBoxA",name:"chart_type",fieldLabel:this.findLangS("field","chartType"),aData:f,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(30),allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"chart_length_minutes",fieldLabel:this.findLangS("field","chartLengthMinutes"),minValue:10,maxValue:180,step:1,allowBlank:false,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldNum(4)+__width_Trigger},{xtype:"displayfield",value:"["+this.findLangS("field","minutes")+"]",fieldClass:"x-form-field",style:{marginLeft:3},disableAutoWidth:true}]},{xtype:"fieldset",title:this.findLangS("field","filters"),style:__style_RedukFieldSet(),items:[{xtype:"checkbox",name:"only_connected",fieldLabel:this.findLangS("field","onlyConnected"),labelWidth:c.labelWidth},{xtype:"ComboBoxA",name:"international_or_local",fieldLabel:this.findLangS("field","internationalOrLocal"),aData:arNationalOrInternational,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(30),allowBlank:false},{xtype:"textarea",name:"filter_number",fieldLabel:this.findLangS("field","numbers"),labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(50),height:__height_FieldLines(3)},{xtype:"CBX_cbNumberGroups",name:"filter_number_group",fieldLabel:this.findLangS("field","numbers_group"),_clearButton:true,_multiSelect2:true,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(50)},{xtype:"textarea",name:"filter_ip",fieldLabel:this.findLangS("field","addresses"),labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(50),height:__height_FieldLines(3)},{xtype:"CBX_cbIpGroups",name:"filter_ip_group",fieldLabel:this.findLangS("field","ip_group"),_clearButton:true,_multiSelect2:true,labelWidth:c.labelWidth,width:c.labelWidth+__width_FieldChar(50)}]}];
a.items[a.items.length-1].style.marginBottom=1;
a.items.push({xtype:"container",layout:"vbox",items:b});
return(a)
},getDefaultSetupValues:function(){var a={refreshPeriod:5,sensor_id:_sensorId_all,typeTimeInterval:"custom",chart_type:"sensors",chart_length_minutes:30,international_or_local:0};
return(a)
},setContextSetupValues:function(a){this.callParent([a])
},createContent:function(){debug_log(this.setupValues);
var a=this;
this.removeAll();
this.onStartLoad();
this.chart=new SPY.Charts.realtime({enableScheduler:false,_type:this.setupValues.chart_type,chartLengthMinutes:this.setupValues.chart_length_minutes,onLoad:function(){this.onStopLoad()
},onError:function(){this.onStopLoad()
},onFailure:function(){this.onStopLoad()
},onLoadScope:this});
this.add(this.chart.panelChart);
this.refreshContent()
},refreshContent:function(){this.chart.load({select_sensors:this.setupValues.sensor_id,filters:{connected:this.setupValues.only_connected,international:this.setupValues.international_or_local==0?undefined:this.setupValues.international_or_local==1?0:1,number:this.setupValues.filter_number,number_group:this.setupValues.filter_number_group,ip:this.setupValues.filter_ip,ip_group:this.setupValues.filter_ip_group}})
},enableRefresh:function(){return(true)
}});
Ext.define("Dashboard_d.PanelSetupFormWithFilter",{extend:"Ext.form.Panel",subsystem:"dashboard_d",constructor:function(b){var h={xtype:"tabpanel",items:[],border:false};
var d=[];
var l=CDR.Filter.getWidthForm();
if(b&&b.baseItems){d.push({xtype:"container",items:b.baseItems,title:b.baseItemsTitle})
}if(b.message){var m=Message.Filter.getFieldset({values:{},disableTimeInterval:true});
d.push({xtype:"container",items:m,title:this.findLangS("title","tabFilter")})
}else{var g=CDR.Filter.getFieldset("common",{values:{},disableTimeInterval:true,disableSelections:true});
d.push({xtype:"container",items:g,title:this.findLangS("title","tabFilterCommon")});
var f=CDR.Filter.getFieldset("rtp",{values:{}});
d.push({xtype:"container",items:f,title:this.findLangS("title","tabFilterRtp")});
if(window.existsDscpCdr){var k=CDR.Filter.getFieldset("dscp",{values:{}});
d.push({xtype:"container",items:k,title:this.findLangS("title","tabFilterDscp")})
}var a=CDR.Filter.getFieldset("filters_comb",{values:{}});
d.push({xtype:"container",items:a,title:this.findLangS("title","tabFilterFiltersComb")})
}for(var c=0;
c<d.length;
c++){h.items.push({xtype:"container",items:{xtype:"container",items:d[c],style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:l},border:false,width:l+__width_Scroller+4,autoScroll:true,title:d[c].title,style:{"background-color":__color_FormBackground}})
}Ext.applyIf(b,{layout:"fit",frame:true,border:false,items:h,flex:1,listeners:{scope:this,afterrender:function(){if(this.message){Message.Filter.setContextFields(this)
}else{CDR.Filter.setContextFields(this)
}}}});
this.callParent([b])
},getFilterConfig:function(){filterConfig={};
if(this.message){Ext.apply(filterConfig,Message.Filter.fetchValuesFromFieldset(this))
}else{Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"common"));
Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"rtp"));
if(window.existsDscpCdr){Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"dscp"))
}Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"filters_comb"))
}return(filterConfig)
},setFilterConfigFields:function(a){if(this.message){Message.Filter.setValueFieldsFieldset(a,this)
}else{CDR.Filter.setValueFieldsFieldset(a,this,"common");
CDR.Filter.setValueFieldsFieldset(a,this,"rtp");
if(window.existsDscpCdr){CDR.Filter.setValueFieldsFieldset(a,this,"dscp")
}CDR.Filter.setValueFieldsFieldset(a,this,"filters_comb")
}}});
Ext.define("Dashboard_d.SelectNewPanelType",{extend:Ext.form.FormPanel,subsystem:"dashboard_d",constructor:function(b){var a=__width_FieldChar(15);
var d=cloneObject(arDashboardTypePanels);
for(var c=0;
c<d.length;
c++){d[c]=[d[c],this.findLangS("combomenu","typePanel_"+d[c])]
}b=Ext.applyIf(b||{},{items:[{xtype:"ComboBoxA",fieldLabel:this.findLangS("field","panelType"),name:"panelType",value:"chart",aData:d,labelWidth:a,width:a+__width_FieldChar(45),allowBlank:false},{xtype:"textfield",fieldLabel:this.findLangS("field","title"),name:"title",value:"New panel",labelWidth:a,width:a+__width_FieldChar(45),allowBlank:false},{xtype:"checkbox",fieldLabel:this.findLangS("field","autoopenSetup"),name:"autoopenSetup",checked:true,labelWidth:a,hidden:true}],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:this.onOk},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}],frame:true,border:false,height:Ext.isIE?150:undefined});
this.callParent([b])
},onOk:function(){if(!this.getForm().isValid()){return
}values=this.getForm().getFieldValues();
Ext.apply(this.newItemPanelConfig,values);
new Dashboard_d.ItemPanel(this.newItemPanelConfig);
this.ownerCt.close()
}});
Ext.define("Dashboard_d.NewDashboardForm",{extend:Ext.form.FormPanel,subsystem:"dashboard_d",constructor:function(b){var a=__width_FieldChar(15);
var d=cloneObject(arDashboardTypePanels);
for(var c=0;
c<d.length;
c++){d[c]=[d[c],this.findLangS("combomenu","typePanel_"+d[c])]
}var f=[];
for(var c=0;
c<6;
c++){f.push({xtype:"container",items:[{xtype:"textfield",name:"panel_"+(c+1)+"_title",labelAlign:"top",fieldLabel:this.findLangS("field","title"),value:this.findLangS("text","newPanel")+" "+(c+1),width:__width_FieldChar(30),allowBlank:false},{xtype:"ComboBoxA",name:"panel_"+(c+1)+"_type",labelAlign:"top",fieldLabel:this.findLangS("field","panelType"),value:"chart",aData:d,width:__width_FieldChar(30),allowBlank:false}],style:{marginLeft:4,marginRight:4,marginTop:4}})
}b=Ext.applyIf(b||{},{items:[{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","templateNameName"),labelWidth:a,width:a+__width_FieldChar(40),allowBlank:false},{xtype:"checkbox",name:"private",fieldLabel:this.findLangS("field","privateTemplate"),checked:false,labelWidth:a},{xtype:"ComboBoxA",fieldLabel:this.findLangS("field","layout"),name:"layout",value:"3x2",aData:[["none","None"],["3x2","3 x 2"],["2x2","2 x 2"],["2x1","2 x 1"]],labelWidth:a,width:a+__width_FieldChar(20),allowBlank:false,listeners:{scope:this,select:this.onSelectLayout}},{xtype:"displayfield",value:this.findLangS("field","layoutConfiguration")+":"},{xtype:"container",layout:{type:"table",columns:3,tableAttrs:{border:1,bordercolor:__color_PanelBorder}},items:f}],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:this.onOk},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}],frame:true,border:false,height:Ext.isIE?150:undefined});
this.callParent([b])
},onOk:function(){if(!this.getForm().isValid()){return
}values=this.getForm().getFieldValues();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getExistsConfigSubsystem",params:Ext.encode({subsystem:"dashboards",name:values.name,user_id:user_id(),priv:values["private"]})},success:function(a){if(a.config){Ext.Msg.confirm(this.findLangS("title","msgDuplicationName"),this.findLangS("text","msgDuplicationName"),function(b){if(b=="yes"){this.dashboardPanel.createNewDashboard(values);
this.ownerCt.close()
}},this)
}else{this.dashboardPanel.createNewDashboard(values);
this.ownerCt.close()
}}})
},onSelectLayout:function(b,c,h){layout=b.getValue();
var l=layout=="3x2"?3:layout=="2x2"?2:layout=="2x1"?2:0;
var p=layout=="3x2"?2:layout=="2x2"?2:layout=="2x1"?1:0;
var k=0;
var n=0;
for(var d=0;
d<6;
d++){var a=parseInt(d%3)+1;
var o=parseInt(d/3)+1;
var g=this.getForm().findField("panel_"+(d+1)+"_title");
var m=this.getForm().findField("panel_"+(d+1)+"_type");
var f=o<=p&&a<=l;
g.enableIf(f);
m.enableIf(f);
if(!f&&m.allowBlank==false){g.clearInvalid();
m.clearInvalid()
}g.allowBlank=f?false:true;
m.allowBlank=f?false:true;
if(f){++k;
title=g.getValue();
if(!title||title.match(this.findLangS("text","newPanel"))){++n;
g.setValue(this.findLangS("text","newPanel")+" "+n)
}type=m.getValue();
if(!type){m.setValue("chart")
}}else{g.setValue(null);
m.setValue(null)
}}}});
Ext.define("Dashboard.ChartCacheSettings",{extend:"Ext.ux.setting.Form",subsystem:"dashboard_d",constructor:function(a){a=Ext.applyIf(a||{},{settingTableName:"dashboard_chart_cache_settings",settingTableStruct:rsDashboardChartCacheSettings,specItems:{enable_for_all:{xtype:"checkbox"},overlap_minutes:{xtype:"numberfield",minValue:1,maxValue:12*60,_width:__width_FieldNum(5)+__width_Trigger,fieldStyle:{"text-align":"right"}},compute_processes:{xtype:"numberfield",minValue:1,maxValue:10,_width:__width_FieldNum(5)+__width_Trigger,fieldStyle:{"text-align":"right"}},temporarily_suspended:{xtype:"checkbox"},temporarily_autosuspended_if_sqlf_cdr_gt:{xtype:"numberfield",minValue:10,maxValue:1000,_width:__width_FieldNum(5)+__width_Trigger,fieldStyle:{"text-align":"right"}}}});
this.callParent([a])
},onSaveSuccess:function(){var a=this.getFieldValues();
window.dashboard_charts_cache_enable_all=a.enable_for_all;
window.dashboard_charts_cache_temporarily_suspended=a.temporarily_suspended;
if(this.ownerCt&&this.ownerCt.xtype=="window"){this.ownerCt.close()
}Ext.defer(function(){this.dashboard.setDeafultUseOnlyCacheAllPanels();
this.dashboard.createContentAllPanels()
},100,this)
},getDefaultValues:function(){return({enable_for_all:false,overlap_minutes:120,compute_processes:2,temporarily_suspended:false})
},setContext:function(){var a=this.getFieldValues();
this.enableIf(["temporarily_suspended","temporarily_autosuspended_if_sqlf_cdr_gt"],a.enable_for_all)
}});
function getDashboardTimeInterval(c,a,b){if(c.typeTimeInterval!="custom"){return(getTimeIntervalForTypeInterval(c.typeTimeInterval,{prevInterval:(c.prevInterval?1:0)+(b||0),intervalOffset:c.intervalOffset,timeIntervalData:a}))
}else{return(getTimeIntervalForCustomInterval(c.last_days,c.last_minutes,{prevInterval:(c.prevInterval?1:0)+(b||0),intervalOffset:c.intervalOffset,timeIntervalData:a}))
}}function getTimeIntervalForTypeInterval(o,d){var h=window.dashboard_time?dateTimeStringToDate(window.dashboard_time):new Date;
var k=getDataArrayItem(d.timeIntervalData,o,0,3);
var c=getDataArrayItem(d.timeIntervalData,o,0,4);
var n=getDataArrayItem(d.timeIntervalData,o,0,5);
var g=getDataArrayItem(d.timeIntervalData,o,0,7);
var a=getDataArrayItem(d.timeIntervalData,o,0,8);
var m=c>=24*60*60?date(new Date(h.getTime()+c*1000)):new Date((parseInt(h.getTime()/(c*1000))+1)*c*1000);
var b=new Date(m.getTime()-k*1000*(d.prevInterval?(d.prevInterval+1):1));
if(c>=24*60*60){b=date(b)
}switch(g){case"monday":case"sunday":b=date(h);
while(b.getDay()!=(g=="monday"?1:0)){b=date(new Date(b.getTime()-12*60*60*1000))
}for(var f=0;
f<d.prevInterval;
f++){do{b=date(new Date(b.getTime()-12*60*60*1000))
}while(b.getDay()!=(g=="monday"?1:0))
}break;
case"1_day":b=date(h);
while(b.getDate()!=1){b=date(new Date(b.getTime()-12*60*60*1000))
}for(var f=0;
f<d.prevInterval;
f++){do{b=date(new Date(b.getTime()-12*60*60*1000))
}while(b.getDate()!=1)
}break
}var p=new Date(b.getTime()+k*1000);
if(!d.prevInterval&&n){p=new Date(parseInt(p.getTime()/(n*1000))*n*1000)
}if(c>=24*60*60){p=p.getHours()>12?date_next(p):date(p)
}switch(a){case"last_day":while(p.getDate()<10){p=date(new Date(p.getTime()-12*60*60*1000))
}p=date(new Date(p.getTime()+36*60*60*1000));
break
}if(!d.prevInterval&&d.intervalOffset){var l=new Date(m.getTime()-d.intervalOffset*1000);
b=new Date(b.getTime()-(p.getTime()-l.getTime()));
p=l
}b.timeDefined=true;
p.timeDefined=true;
return([b,p])
}function getTimeIntervalForCustomInterval(l,d,c){var f=new Date;
var g=l*24*60*60+d*60;
var b=d?60:24*60*60;
var k=b>=24*60*60?date(new Date(f.getTime()+b*1000)):new Date((parseInt(f.getTime()/(b*1000))+1)*b*1000);
var a=new Date(k.getTime()-g*1000*(c.prevInterval?(c.prevInterval+1):1));
if(b>=24*60*60){a=date(a)
}var m=new Date(a.getTime()+g*1000);
if(b>=24*60*60){m=m.getHours()>12?date_next(m):date(m)
}if(c.intervalOffset){var h=new Date(f.getTime()-c.intervalOffset*1000);
a=new Date(a.getTime()-(m.getTime()-h.getTime()));
m=h
}a.timeDefined=true;
m.timeDefined=true;
return([a,m])
}Ext.define("Ext.chart.theme.DashBar",{extend:"Ext.chart.theme.Base",alias:"chart.theme.DashBar",constructor:function(a){a.axis={left:{label:{font:"11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},bottom:{label:{font:"11px Tahoma, Arial, Helvetica, Sans-serif"},title:{font:"bold 12px Tahoma, Arial, Helvetica, Sans-serif",fill:"black"}}};
this.callParent([a])
}});
Ext.ns("Register");
Ext.define("Register.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Register.GridX",subsystem:"register",constructor:function(r){var p={};
var a=[];
var h=[];
if(r.subGrid){switch(r.module){case"register_failed":case"register_state":var n=this.getDefaultDateFrom();
var f=null;
p.form_filters=Ext.encode({created_at_from:n,created_at_to:f});
a.push({xtype:"displayfield",value:this.findLangS("toolbar","from")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDate2TX",value:n,_gridForm:this,_searchField:"filter/created_at_from",_buttonGroup:true,t2menu:{defaults:{scope:this,handler:function(v){var w=date(date().getTime()/1000-v._decDays*24*60*60);
this.getTopToolbar().findC("_searchField","filter/created_at_from").setValue(w);
this.setExtraParam("filter/created_at_from",w,true)
}},items:[{text:"today",_decDays:0},{text:"last week",_decDays:7},{text:"last month",_decDays:30}]}},{xtype:"displayfield",value:this.findLangS("toolbar","to")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateX",value:f,_gridForm:this,_searchField:"filter/created_at_to",_buttonGroup:true});
break
}}else{switch(r.module){case"register_state":case"register_failed":this.filter={created_at_from:this.getDefaultDateFrom()};
p.form_filters=Ext.encode(this.filter)
}a.push({xtype:"splitbutton",scope:this,text:this.findLangS("button","filterForm"),iconCls:"icon_find",handler:this.createFilterWindow,arrowCls:"link_grey",arrowHandler:this.viewUrl,arrowTooltip:this.findLangS("button_help","filterFormViewUrl"),listeners:{scope:this,afterrender:function(v){window.b=v;
v.getEl().down(".x-btn-button").dom.setAttribute("data-qtip",this.findLangS("button_help","filterForm"))
}},_id:"setFilter"},{scope:this,text:this.findLangS("button","resetFilter"),tooltip:this.findLangS("button_help","resetFilter"),iconCls:"icon_find",handler:this.resetFilter,disabled:true,_id:"resetFilter"},{tooltip:this.findLangS("tools"),iconCls:"icon_wrench",_btnId:"settings",menu:{defaults:{scope:this},items:[{text:this.findLangS("menu","exportCSV"),iconCls:"icon_excel",handler:this.exportToCsv}]}},"-",{xtype:"displayfield",value:"&nbsp;"+this.findLangS("toolbar","userName")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",_gridForm:this,width:170,onChangeValue:function(v){this.setFilterItemValue("digestusername",v)
},_id:"qsearch_digestusername"});
var h=[this.findLangS("toolbar","refreshInterval")+":&thinsp;",{xtype:"numberfield",width:__width_ColumnNum(4)+ +__width_Trigger,minValue:1,maxValue:9999,step:1,enableKeyEvents:true,listeners:{scope:this,change:function(v){this.setTimeoutRefreshInterval(v)
},keyup:function(w,v){this.setTimeoutRefreshInterval(w)
}},fieldStyle:{"text-align":"right"}}]
}var b=[{header:'ID<br><span style="font-size: 80%;">'+lang.sensorId+"</span>",dataIndex:"ID",align:"center",width:50,renderer:function(A,v,w,B,z,y){if(r.module=="register_failed"){A=parseInt(A/100000)
}if(w.data.id_sensor<=0){return(A)
}return'<div style = "text-align:center">'+A+'<br><i style="color: grey;">'+w.data.id_sensor+"</i></div>"
}}];
switch(r.module){case"register":b.push({dataIndex:"calldate",align:"center",width:window.time_precision_register_in_ms?__width_ColumnTimeMs:__width_ColumnDate,renderer:renderDate,dateFormat:__format_Date+"<br>"+(window.time_precision_register_in_ms?__format_TimeMs:__format_Time)},{dataIndex:"digestusername",headerLang:"digestusername_realm",widthChar:18,renderer:o},{dataIndex:"sipcallerip",widthNum:14,renderer:l},{dataIndex:"sipcalledip",widthNum:14,renderer:l},{dataIndex:"from_num",headerLang:"from_num_domain",widthChar:25,renderer:l,_comb:true},{dataIndex:"to_num",headerLang:"to_num_domain",widthChar:20,renderer:l,_comb:true},{dataIndex:"contact_num",headerLang:"contact_num_domain",widthChar:20,renderer:l,_comb:true},{dataIndex:"expires_at",headerLang:"expires_at",width:__width_ColumnTime,renderer:k},{dataIndex:"rrd_avg",widthNum:8,renderer:u},{dataIndex:"state",widthChar:12,renderer:s},{dataIndex:"ua_str",widthChar:20});
break;
case"register_failed":case"register_state":b.push({dataIndex:"created_at",align:"center",width:window.time_precision_register_in_ms?__width_ColumnTimeMs:__width_ColumnDate,renderer:renderDate,dateFormat:__format_Date+"<br>"+(window.time_precision_register_in_ms?__format_TimeMs:__format_Time)});
if(r.module=="register_failed"){b.push({dataIndex:"counter",align:"right",widthNum:5})
}if(!r.subGrid){b.push({dataIndex:"digestusername",widthChar:15})
}b.push({dataIndex:"sipcallerip",widthNum:14,renderer:l},{dataIndex:"sipcalledip",widthNum:14,renderer:l},{dataIndex:"from_num",widthChar:15,renderer:l});
if(!r.subGrid){b.push({dataIndex:"to_num",widthChar:15,renderer:l})
}b.push({dataIndex:"contact_num",headerLang:"contact_num_domain",widthChar:20,renderer:l,_comb:true});
if(r.module=="register_state"){b.push({dataIndex:"expires",align:"right",widthNum:5,renderer:m},{dataIndex:"state",widthChar:12,renderer:s})
}b.push({dataIndex:"ua_str",widthChar:20});
break
}b.push({dataIndex:"menu",headerLang:"commands",width:90,align:"right",noCopyToClipboard:true,sortable:false,renderer:function(A,v,w,B,z,y){return A&&A.replaceall("__THIS_ID__",this.id)||"&nbsp;"
}});
r=Ext.applyIf(r||{},{url:"php/model/sql.php",columns:b,columnsDefaults:{tdCls:"vertical-align-middle"},extraParams:p,tbar:a,paginatorBehindButtonsItems:h.length?h:undefined,prefixCls:r.subGrid?undefined:r.module,stripeRows:false,enableAutoLoad:r.subGrid||!isInitRegisterSelectUrlParams()||isInitRegisterSelectUrlParams()!=r._type,listeners:{scope:this,afterrender:function(){if(this.registerPanel&&this.registerPanel.setTitleReg){this.registerPanel.setTitleReg()
}if(this._mainRegisterTable&&isInitRegisterSelectUrlParams()==this._type){this.setFilter(Ext.decode(this._type=="active"?window.register_active_filter:this._type=="failed"?window.register_failed_filter:this._type=="state"?window.register_state_filter:null));
clearInitRegisterSelectUrlParams()
}}}});
if(r.module=="register_state"||r.modul=="register_failed"){Ext.applyIf(r,{loadingText:getLoadMaskWithStopButton_loading_text("registerGrid_loadMask"),proxy_timeout:60*60*1000})
}if((r.module=="register"||r.module=="register_state")&&!r.subGrid){r.plugins=[{ptype:"rowexpander",rowBodyContentCls:"Register.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}]
}this.callParent([r]);
this.store.on("beforeload",g,this);
this.store.on("load",c,this);
function l(D,w,z,B,F,E,C){var y=C&&C.ownerCt&&C.ownerCt.getHeaderContainer?C.ownerCt.getHeaderContainer().getHeaderAtIndex(F):null;
if(!y){return(D)
}switch(y.dataIndex){case"sipcallerip":if(z.data.sipcallerport){D+=" : "+z.data.sipcallerport
}break;
case"sipcalledip":if(z.data.sipcalledport){D+=" : "+z.data.sipcalledport
}break;
case"from_num":if(y._comb){D=d(D,w,z)
}break;
case"to_num":if(y._comb){D=t(D,w,z)
}break;
case"contact_num":if(y._comb){D=q(D,w,z)
}break
}var v=y.dataIndex+"-reg";
var A=z.data[v]?"rec_start_small":"rec_start_inactive_small";
D='<table style="width: 100%; font: '+__font_Grid+';"><tr><td>'+D+'</td><td style="width: 8px; margin-left: 3px;"><a href="#"><img src="images/icon/'+A+'.png" gridid="'+this.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).addRemoveCaptureRule('+B+","+F+');return(false);"></td></tr></table>';
return(D)
}function u(B,y,w,C,A,z,v){B=(w.data.rrd_avg?w.data.rrd_avg.toString()+" ms":"");
return(B)
}function d(B,y,w,C,A,z,v){B=w.data.from_num+(w.data.from_name?" ("+w.data.from_name+")":"")+"<br>"+w.data.from_domain;
return(B)
}function t(B,y,w,C,A,z,v){B=w.data.to_num+"<br>"+w.data.to_domain;
return(B)
}function q(B,y,w,C,A,z,v){B=w.data.contact_num+"<br>"+w.data.contact_domain;
return(B)
}function o(B,y,w,C,A,z,v){B="<b>"+w.data.digestusername+"</b><br>"+w.data.digestrealm;
return(B)
}function m(B,y,w,C,A,z,v){B=(w.data.expires?w.data.expires+" s":"");
return(B)
}function k(B,y,w,C,A,z,v){B=(w.data.expires?w.data.expires+" s":"")+"<br>"+Ext.Date.format(w.data.expires_at,__format_Time);
return(B)
}function s(C,y,z,A,E,D,B){if(C==_RegState_OK&&!z.data.expires){C=_RegState_Unregister
}var w=getDataArrayItem(arRegState,C,0,3);
var v=getDataArrayItem(arRegState,C,0,2);
C=getDataArrayItem(arRegState,C);
if(w){C=renderStringStyle(C,w)
}if(v){y.style="border-left: 3px solid "+v
}return(C)
}function g(){if(this.module=="register_state"||this.module=="register_failed"){beginLoadMaskWithStopButton_store(this.store,"registerGrid_loadMask")
}}function c(){if(this.module=="register_state"||this.module=="register_failed"){endLoadMaskWithStopButton_store(this.store)
}if(this.registerPanel&&this.registerPanel.setTitleReg){this.registerPanel.setTitleReg()
}}},onStoreLoad:function(b,a,d,c){if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(ActiveModule=="Register_"+this._type&&this.isVisible()&&!reloginForm&&!this._windowFilter&&!this.rowExpander.isAnyExpand()){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}},contextMenu:function(b,c){var a=["from_num","to_num","contact_num","sipcallerip","sipcalledip"];
if(a.isIn(c.dataIndex)){return([{text:b.data[c.dataIndex+"-reg"]?this.findLangS("menu","removeFromCaptureRules"):this.findLangS("menu","addToCaptureRules"),iconCls:b.data[c.dataIndex+"-reg"]?"icon_delete":"icon_add",handler:function(){this.addRemoveCaptureRule(b,c)
},scope:this}])
}},addRemoveCaptureRule:function(a,c){if(Ext.isNumber(a)){a=this.store.getAt(a)
}if(Ext.isNumber(c)){var b=this.getColumnManager().getColumns();
c=b[c]
}if(a.data[c.dataIndex+"-reg"]){this.removeCaptureRule(["sipcallerip","sipcalledip"].isIn(c.dataIndex)?"ip":"number",a.data[c.dataIndex+"-reg"],a.data[c.dataIndex],a.data.id_sensor)
}else{this.addCaptureRule(["sipcallerip","sipcalledip"].isIn(c.dataIndex)?"ip":"number",a.data[c.dataIndex],a.data.id_sensor)
}},addCaptureRule:function(b,c,a){var d=[];
switch(b){case"ip":d.push({xtype:"textfield",fieldLabel:this.findLangS("field","ip_address"),name:"ip",allowBlank:false,widthChar:16,value:c},{xtype:"numberfield",fieldLabel:this.findLangS("field","net_mask"),name:"mask",value:null,_width:__width_FieldNum(3)+__width_Trigger,minValue:1,maxValue:ip_is_v6(c)?128:32,allowDecimals:false,step:1});
break;
case"number":d.push({xtype:"textfield",fieldLabel:this.findLangS("field","number_prefix"),name:"prefix",allowBlank:false,value:c,widthChar:15});
break
}d.push({xtype:"datefield",fieldLabel:this.findLangS("field","auto_remove_at"),name:"remove_at",_width:__width_FieldDate,format:__format_Date});
d.push({xtype:"checkbox",fieldLabel:this.findLangS("field","reload_sniffer"),name:"reload_sniffer",checked:true});
this.createEditWindow(1,null,{fpDefaults:{widthNum:15,labelCh:20},fpItems:d,title:this.findLangS("title","newCaptureRule"),saveRecord:function(){var f=this.formPanel.getForm().getFieldValues();
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"setCaptureRules",params:Ext.encode({type:b,oper:"add",value:b=="ip"?f.ip+"/"+f.mask:f.prefix,remove_at:f.remove_at})},success:function(g){this.formPanel.editWindow.destroy();
this.reload(true);
if(f.reload_sniffer){Settings.SensorTable.Utils.reloadVm(a>0?a:"local",{maskEl:this})
}},scope:this,maskEl:this,deferMask:true})
}})
},removeCaptureRule:function(c,a,d,b){Ext.Msg.confirm(this.findLangS("title","removeCaptureRule"),this.findLangS("text","removeCaptureRuleQuestion")+" "+a+' ?<br><br><input id="removeCaptureRule_reload_sniffer" type="checkbox" checked="on"/>&nbsp;'+this.findLangS("field","reload_sniffer"),function(f){if(f=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"setCaptureRules",params:Ext.encode({type:c,oper:"remove",value:a})},success:function(g){this.reload(true);
if(Ext.get("removeCaptureRule_reload_sniffer").dom.checked){Settings.SensorTable.Utils.reloadVm(b>0?b:"local",{maskEl:this})
}},scope:this,maskEl:this,deferMask:true})
}},this)
},createFilterWindow:function(){this._windowFilter=true;
var b={values:this.filter||{}};
Ext.applyIf(b,this.module=="register"?{enableCalldate:true,enableSipCalleRD:true,enableNumFTC:true,enableNameFrom:true,enableDomainFTC:true,enableUsername:true,enableRealm:true,enableExpires:true,enableExpiresAt:true,enableUa:true,enableSensorId:true,enableSIPALG:true,enableRrdAvg:true}:this.module=="register_state"?{enableCreatedAt:true,enableSipCalleRD:true,enableNumFTC:true,enableDomainContact:true,enableUsername:true,enableExpires:true,enableState:true,enableUa:true,enableSIPALG:true,enableSensorId:true}:this.module=="register_failed"?{enableCreatedAt:true,enableCounter:true,enableSipCalleRD:true,enableNumFTC:true,enableDomainContact:true,enableUsername:true,enableUa:true,enableSensorId:true}:{});
var f=Register.Filter.getFieldset(b);
var d=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,layout:"fit",items:{xtype:"container",items:f},buttons:[{scope:this,text:this.findLangS("button","search"),iconCls:"icon_find",handler:a},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){c.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",d.el,{enter:a,scope:this});
var g=d.getForm().getFields();
var h=null;
for(var k=0;
k<g.getCount();
k++){if(!(g.getAt(k) instanceof Ext.form.DisplayField)){h=g.getAt(k);
break
}}if(h){h.focus(false,500)
}Register.Filter.setContextFields(d)
}},style:{padding:5}});
var c=new Ext.Window({scope:this,iconCls:"icon_find",title:this.findLangS("title","filterForm"),closable:true,width:775,border:false,plain:true,layout:"fit",modal:false,items:d,formPanelForAutoAdjustSize:d,listeners:{scope:this,destroy:function(){this._windowFilter=false
}}});
c.show();
function a(){if(window.DEMO){Ext.Msg.alert("","Search by filter is not supported in the demo mode.")
}else{if(d.getForm().isValid()){this.setFilter(Register.Filter.fetchValuesFromFieldset(d));
c.destroy()
}}}},setFilter:function(a){this.filter=a;
this.store.proxy.extraParams.form_filters=Ext.encode(this.filter);
this.reload({page:1});
this.setToolbarFilterItems()
},setFilterItemValue:function(b,c,a){if(c){if(!this.filter){this.filter={}
}this.filter[b]=c;
this.store.proxy.extraParams.form_filters=Ext.encode(this.filter);
if(!a){this.reload({page:1})
}}else{if(this.filter){delete this.filter[b];
if(!isDataEmpty(this.filter)){if(!a){this.resetFilter()
}}else{this.store.proxy.extraParams.form_filters=Ext.encode(this.filter);
if(!a){this.reload({page:1})
}}}}this.setToolbarFilterItems()
},getFilterItemValue:function(a){return(this.filter&&this.filter[a]||null)
},resetFilter:function(){if((this.module=="register_state"||this.module=="register_failed")&&!this.subGrid){this.filter={};
this.filter.created_at_from=this.getDefaultDateFrom()
}else{this.filter=null
}this.store.proxy.extraParams.form_filters=this.filter?Ext.encode(this.filter):null;
this.reload({page:1});
this.enableBtn("resetFilter",false);
this.setToolbarFilterItems()
},setToolbarFilterItems:function(){this.setToolbarFieldValue("qsearch_digestusername",this.filter&&this.filter.digestusername);
var b=false;
if((this.module=="register_state"||this.module=="register_failed")&&!this.subGrid){b=true;
for(var a in this.filter){if(a!="created_at_from"&&this.filter[a]||dateTime(this.filter.created_at_from).getTime()!=this.getDefaultDateFrom().getTime()){b=false;
break
}}}else{b=isDataEmpty(this.filter)
}this.enableBtn("resetFilter",!b)
},getDefaultDateFrom:function(){return defaultCdrTypeInterval=="specified_days"?date((new Date).getTime()/1000-defaultCdrInterval*24*60*60):dateTimeM(getTimeInterval(defaultCdrTypeInterval)[0])
},doDownloadPcap:function(b,a){this.downloadPcap(b)
},downloadPcap:function(b){var c={id:b,prepare:true};
c[this.module]=1;
var a=this.findRecord(b);
if(a){Ext.apply(c,{calldate:a.data.calldate,fname:a.data.fname,id_sensor:a.data.id_sensor,spool_index:a.data.spool_index});
if(a.data.new_register){delete c.id
}}ajaxSafeRequest({scope:this,url:"php/pcap.php",params:c,success:function(d){fceSuccess.call(this)
},success:function(d){downloadPrepareFileHash(d)
},maskEl:this})
},findRecord:function(a){var b=null;
this.store.each(function(c){if(c.data.ID==a){b=c
}});
return(b)
},viewUrl:function(){var d=window.location.origin+window.location.pathname;
var c={};
var b=Register.Filter.getArrayOfFields();
for(var a in this.filter){if(Ext.isString(a)&&b.inArray(a)&&Ext.isDefined(this.filter[a])&&this.filter[a]!==null&&this.filter[a]!==""){c[a]=this.filter[a]
}}d+="?";
d+="register_"+this._type+"_filter=";
if(!isDataEmpty(c)){Register.Filter.optimizeFilterItems(c)
}d+=encodeURIjson(Ext.encode(c));
var f='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+d+'" target="_blank">'+d+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(this.findLangS("title","filterFormViewUrl"),f,function(){var g=Ext.getCmp("copy_button");
if(g){g.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(g){return(g.clipboardText)
},getClipTextParams:{clipboardText:d},id:"copy_button",renderTo:"copy_button_div"})
},exportToCsv:function(){if(this.module=="register"){formPostSafe("php/model/sql.php","POST",Ext.applyIf({module:this.module,task:"LISTING",timeout:60*60,exportToCsv:true},this.getExtraParamsForExportToCsv()))
}else{this.callParent()
}}});
Ext.define("Register.GridExpPanel",{extend:"Ext.Panel",subsystem:"register",constructor:function(d){this.state=new Register.Grid({title:d.grid.module=="register_state"?this.findLangS("title","stateFilteredBy")+" "+d.record.data.to_num+(d.record.data.digestusername&&d.record.data.digestusername!=d.record.data.to_num?" / "+d.record.data.digestusername:""):this.findLangS("title","state"),module:"register_state",storeId:"Register.State_"+d.record.data.ID,recordStruct:rsRegisterState,sortField:"created_at",sortDirection:"desc",remoteSort:true,border:false,registerPanel:this,relFields:{to_num:d.record.data.to_num,to_domain:d.record.data.to_domain,digestusername:d.record.data.digestusername},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},pageSize:10,suppressTotal:true,decWidthColumn:2,subGrid:true,listeners:{scope:this,afterender:h}});
this.state.store.on("load",c,this);
this.failed=new Register.Grid({title:this.findLangS("title","failed"),module:"register_failed",storeId:"Register.Failed_"+ +d.record.data.ID,recordStruct:rsRegisterFailed,sortField:"created_at",sortDirection:"desc",remoteSort:true,border:false,registerPanel:this,relFields:{to_num:d.record.data.to_num,to_domain:d.record.data.to_domain,digestusername:d.record.data.digestusername},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},pageSize:10,suppressTotal:true,decWidthColumn:2,subGrid:true,listeners:{scope:this,afterender:f}});
this.failed.store.on("load",b,this);
if(d.grid.module=="register"||d.grid.module=="register_state"){var g=d.grid.getDefaultDateFrom();
var l=null;
this.cdr=new CDR.Grid({title:this.findLangS("title","relatedCDR"),layout:"fit",disableCharts:true,disableMenu:true,pageSize:15,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},fcaller:d.record.data.to_num,fcallerd_type:0,fdatefrom:g,customMenu:[{xtype:"displayfield",value:this.findLangS("toolbar","filterBy")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",value:1,aData:[[1,this.findLangS("menu","filterByNumber")],[2,this.findLangS("menu","filterByIP")],[3,this.findLangS("menu","filterByNumberAndIP")],[4,this.findLangS("menu","filterByNumberOrIP")]],widthCh:15,listeners:{scope:this,select:a}},"-",{xtype:"displayfield",value:this.findLangS("toolbar","from")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDate2TX",value:g,_searchField:"fdatefrom",_buttonGroup:true,t2menu:{defaults:{scope:this,handler:function(m){var n=date(date().getTime()/1000-m._decDays*24*60*60);
this.cdr.getTopToolbar().findC("_searchField","fdatefrom").setValue(n);
this.cdr.setCustomFilter("fdatefrom",n,true)
}},items:[{text:"today",_decDays:0},{text:"last week",_decDays:7},{text:"last month",_decDays:30}]},onSetDate:function(n,m){this.cdr.setCustomFilter("fdatefrom",m,true)
},onSetDateScope:this},{xtype:"displayfield",value:this.findLangS("toolbar","to")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateX",value:l,_searchField:"fdateto",_buttonGroup:true,onSetDate:function(n,m){this.cdr.setCustomFilter("fdateto",m,true)
},onSetDateScope:this},"-"],noVerticalScroller:true})
}this.waitPanel=new Ext.Panel({layout:"fit",border:false,height:100,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel=new Ext.TabPanel({activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:d.grid.module+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(d,{items:this.tabPanel,border:false});
this.callParent([d]);
Ext.defer(function(){if(!this._loadedAll){this.tabPanel.add(this.waitPanel);
this.waitPanel.maskLoad()
}},10,this);
function h(){if(store.getCount()<this.state.pageSize){var m=this.failed.getTopToolbar();
if(m){m.setHeight(0)
}}}function f(){if(store.getCount()<this.failed.pageSize){var m=this.failed.getTopToolbar();
if(m){m.setHeight(0)
}}}function c(m){m._loaded=true;
if(!m._firstLoaded){k.call(this);
m._firstLoaded=true
}}function b(m){m._loaded=true;
if(!m._firstLoaded){k.call(this);
m._firstLoaded=true
}}function k(){if(this.state&&!this.state.store._loaded||this.failed&&!this.failed.store._loaded){return
}if(this.state&&this.state.store.getCount()){this.tabPanel.add(this.state)
}if(this.failed&&this.failed.store.getCount()){this.tabPanel.add(this.failed)
}if(this.cdr){this.tabPanel.add(this.cdr)
}this._loadedAll=true;
if(this.tabPanel.items.getCount()){this.waitPanel.destroy();
this.tabPanel.setActiveTab(0)
}else{this.grid.collapseRecord(this.record);
Ext.Msg.alert(this.findLangS("title","noData"),this.findLangS("text","noDataInExpandArea"))
}}function a(m){switch(m.getValue()){case 1:this.cdr.setCustomFilter("fcaller",this.record.data.to_num);
this.cdr.setCustomFilter("fcallerd_type",0);
this.cdr.setCustomFilter("fsipcallerip",null);
this.cdr.setCustomFilter("fsipcallerdip_type",null);
this.cdr.setCustomFilter("commonFiltersOperator",null);
break;
case 2:this.cdr.setCustomFilter("fcaller",null);
this.cdr.setCustomFilter("fcallerd_type",null);
this.cdr.setCustomFilter("fsipcallerip",this.record.data.sipcallerip);
this.cdr.setCustomFilter("fsipcallerdip_type",0);
this.cdr.setCustomFilter("commonFiltersOperator",null);
break;
case 3:this.cdr.setCustomFilter("fcaller",this.record.data.to_num);
this.cdr.setCustomFilter("fcallerd_type",0);
this.cdr.setCustomFilter("fsipcallerip",this.record.data.sipcallerip);
this.cdr.setCustomFilter("fsipcallerdip_type",0);
this.cdr.setCustomFilter("commonFiltersOperator","AND");
break;
case 4:this.cdr.setCustomFilter("fcaller",this.record.data.to_num);
this.cdr.setCustomFilter("fcallerd_type",0);
this.cdr.setCustomFilter("fsipcallerip",this.record.data.sipcallerip);
this.cdr.setCustomFilter("fsipcallerdip_type",0);
this.cdr.setCustomFilter("commonFiltersOperator","OR");
break
}this.cdr.reload({page:1})
}}});
Ext.define("Register.Active.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Register_activePanelX",subsystem:"register",constructor:function(a){this.registers=new Register.Grid({module:"register",storeId:"Register.Active",recordStruct:rsRegister,sortField:"calldate",sortDirection:"desc",remoteSort:true,pageSize:30,layout:"fit",border:false,registerPanel:this,_mainRegisterTable:true,_type:"active"});
a=Ext.applyIf(a||{},{titleLang:"registerActive",id:"Register_active-panel",iconCls:"icon_register",items:this.registers,wikiId:"Register"});
this.callParent([a])
}});
Ext.define("Register.Failed.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Register_failedPanelX",subsystem:"register",constructor:function(a){this.registers=new Register.Grid({module:"register_failed",storeId:"Register.Failed",recordStruct:rsRegisterFailed,sortField:"created_at",sortDirection:"desc",remoteSort:true,pageSize:30,layout:"fit",border:false,registerPanel:this,_mainRegisterTable:true,_type:"failed"});
a=Ext.applyIf(a||{},{titleLang:"registerFailed",id:"Register_failed-panel",iconCls:"icon_register",items:this.registers,listeners:{scope:this,afterrender:function(){if(!Ext.isIE){var b=Ext.get("Register_failed-panel_header");
if(b){b.setStyle({"padding-top":1,"padding-bottom":1})
}}}},wikiId:"Register",wikiButtonMarginTop:-1});
this.callParent([a]);
this.titleText=this.title
},setTitleReg:function(){var a=this.registers;
var d=a.store.proxy.extraParams||{};
var b=d.form_filters;
b=b?Ext.decode(b):{};
if(b.created_at_from&&Ext.isString(b.created_at_from)){b.created_at_from=dateTimeStringToDate(b.created_at_from)
}if(b.created_at_to&&Ext.isString(b.created_at_to)){b.created_at_to=dateTimeStringToDate(b.created_at_to)
}if(Ext.isIE){var c=this.titleText;
if(b.created_at_from){c+="&nbsp;&nbsp;&nbsp;from date&nbsp;"+Ext.Date.format(b.created_at_from,__format_Date)
}if(b.created_at_to){c+="&nbsp;&nbsp;&nbsp;to date&nbsp;"+Ext.Date.format(b.created_at_to,__format_Date)
}this.setTitle(c);
return
}if(!this.formTitle){this.setTitle('<div id="register_failed_title" style="position: relative; left: 0; top: 0; width: 500; height: 22"/>');
this.formTitle=new Ext.form.FormPanel({items:{layout:{type:"hbox",align:"middle"},xtype:"container",items:[{xtype:"displayfield",value:this.titleText+" - from date&nbsp;",fieldCls:"x-panel-header-title-default",width:162,height:16},{xtype:"DateField2T",name:"created_at_from",value:clone(b.created_at_from),format:__format_DateTimeM,width:125+__width_Trigger,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){a.setFilterItemValue("created_at_from",g.getValue())
},blur:function(f){var g=f.getValue();
if(g){g.timeDefined=true
}if(!eqDate(g,a.getFilterItemValue("created_at_from"))){a.setFilterItemValue("created_at_from",g)
}},specialkey:function(g,f){if(f.getKey()==f.ENTER){var h=g.rawToValue(g.getRawValue());
if(h){h.timeDefined=true
}if(!eqDate(h,a.getFilterItemValue("created_at_from"))){a.setFilterItemValue("created_at_from",h)
}}}},t2menu:getStdMenuTimeFrom(this,function(f){var h=dateTimeM(getTimeInterval(f._typeTimeFrom)[0]);
var g=getTimeInterval(f._typeTimeFrom)[1];
if(g){g.timeDefined=false
}this.formTitle.getForm().findField("created_at_from").setValue(h);
this.formTitle.getForm().findField("created_at_to").setValue(g);
a.setFilterItemValue("created_at_to",g,true);
a.setFilterItemValue("created_at_from",h)
})},{xtype:"displayfield",value:"&nbsp;&nbsp;to date",fieldCls:"x-panel-header-title-default",width:51,height:16},{xtype:"datefield",name:"created_at_to",value:clone(b.created_at_to),format:__format_Date,width:90,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){f.timeDefined=false;
a.setFilterItemValue("created_at_to",g.getValue())
},blur:function(g){var f=g.getValue();
if(f){f.timeDefined=false
}if(!eqDate(f,a.getFilterItemValue("created_at_to"))){a.setFilterItemValue("created_at_to",f)
}},specialkey:function(h,g){if(g.getKey()==g.ENTER){var f=h.rawToValue(h.getRawValue());
if(f){f.timeDefined=false
}if(!eqDate(f,a.getFilterItemValue("created_at_to"))){a.setFilterItemValue("created_at_to",f)
}}}}}]},border:false,bodyStyle:{background:"transparent"},renderTo:"register_failed_title",width:600})
}else{this.formTitle.getForm().findField("created_at_from").setValue(clone(b.created_at_from));
this.formTitle.getForm().findField("created_at_to").setValue(clone(b.created_at_to))
}}});
Ext.define("Register.State.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Register_statePanelX",subsystem:"register",constructor:function(a){this.registers=new Register.Grid({module:"register_state",storeId:"Register.State",recordStruct:rsRegisterState,sortField:"created_at",sortDirection:"desc",remoteSort:true,pageSize:30,layout:"fit",border:false,registerPanel:this,_mainRegisterTable:true,_type:"state"});
a=Ext.applyIf(a||{},{titleLang:"registerState",id:"Register_state-panel",iconCls:"icon_register",items:this.registers,listeners:{scope:this,afterrender:function(){if(!Ext.isIE){var b=Ext.get("Register_state-panel_header");
if(b){b.setStyle({"padding-top":1,"padding-bottom":1})
}}}},wikiId:"Register",wikiButtonMarginTop:-1});
this.callParent([a]);
this.titleText=this.title
},setTitleReg:function(){var a=this.registers;
var d=a.store.proxy.extraParams||{};
var b=d.form_filters;
b=b?Ext.decode(b):{};
if(b.created_at_from&&Ext.isString(b.created_at_from)){b.created_at_from=dateTimeStringToDate(b.created_at_from)
}if(b.created_at_to&&Ext.isString(b.created_at_to)){b.created_at_to=dateTimeStringToDate(b.created_at_to)
}if(Ext.isIE){var c=this.titleText;
if(b.created_at_from){c+="&nbsp;&nbsp;&nbsp;from date&nbsp;"+Ext.Date.format(b.created_at_from,__format_Date)
}if(b.created_at_to){c+="&nbsp;&nbsp;&nbsp;to date&nbsp;"+Ext.Date.format(b.created_at_to,__format_Date)
}this.setTitle(c);
return
}if(!this.formTitle){this.setTitle('<div id="register_state_title" style="position: relative; left: 0; top: 0; width: 500; height: 22"/>');
this.formTitle=new Ext.form.FormPanel({items:{layout:{type:"hbox",align:"middle"},xtype:"container",items:[{xtype:"displayfield",value:this.titleText+" - from date&nbsp;",fieldCls:"x-panel-header-title-default",width:160,height:16},{xtype:"DateField2T",name:"created_at_from",value:clone(b.created_at_from),format:__format_DateTimeM,width:125+__width_Trigger,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){a.setFilterItemValue("created_at_from",g.getValue())
},blur:function(f){var g=f.getValue();
if(g){g.timeDefined=true
}if(!eqDate(g,a.getFilterItemValue("created_at_from"))){a.setFilterItemValue("created_at_from",g)
}},specialkey:function(g,f){if(f.getKey()==f.ENTER){var h=g.rawToValue(g.getRawValue());
if(h){h.timeDefined=true
}if(!eqDate(h,a.getFilterItemValue("created_at_from"))){a.setFilterItemValue("created_at_from",h)
}}}},t2menu:getStdMenuTimeFrom(this,function(f){var h=dateTimeM(getTimeInterval(f._typeTimeFrom)[0]);
var g=getTimeInterval(f._typeTimeFrom)[1];
if(g){g.timeDefined=false
}this.formTitle.getForm().findField("created_at_from").setValue(h);
this.formTitle.getForm().findField("created_at_to").setValue(g);
a.setFilterItemValue("created_at_to",g,true);
a.setFilterItemValue("created_at_from",h)
})},{xtype:"displayfield",value:"&nbsp;&nbsp;to date",fieldCls:"x-panel-header-title-default",width:51,height:16},{xtype:"datefield",name:"created_at_to",value:clone(b.created_at_to),format:__format_Date,width:90,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){f.timeDefined=false;
a.setFilterItemValue("created_at_to",g.getValue())
},blur:function(g){var f=g.getValue();
if(f){f.timeDefined=false
}if(!eqDate(f,a.getFilterItemValue("created_at_to"))){a.setFilterItemValue("created_at_to",f)
}},specialkey:function(h,g){if(g.getKey()==g.ENTER){var f=h.rawToValue(h.getRawValue());
if(f){f.timeDefined=false
}if(!eqDate(f,a.getFilterItemValue("created_at_to"))){a.setFilterItemValue("created_at_to",f)
}}}}}]},border:false,bodyStyle:{background:"transparent"},renderTo:"register_state_title",width:600})
}else{this.formTitle.getForm().findField("created_at_from").setValue(clone(b.created_at_from));
this.formTitle.getForm().findField("created_at_to").setValue(clone(b.created_at_to))
}}});
Ext.define("Register.Filter",{singleton:true,subsystem:"register",getFieldset:function(c){c=c||{};
c.prop=c.prop||{};
Ext.applyIf(c.prop,{fieldaWidth:__width_FieldChar(16),fieldaaWidth:__width_FieldChar(22),fieldbWidth:__width_FieldChar(16),fieldcWidth:__width_FieldChar(16),fieldwWidth:__width_FieldChar(44)-3,label1Width:__width_FieldChar(12),label2aWidth:__width_FieldChar(22),label2bWidth:__width_FieldChar(6),label2cWidth:__width_FieldChar(6),label2bpWidth:__width_FieldChar(6)+16+8,label2cpWidth:__width_FieldChar(6)+16+8,btnSwitchWidth:16,btnSwitchHeight:16,label1Style:{},label1aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label1alStyle:{"margin-right":__width_LabelFieldSeparator},label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2cStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[];
if(c.enableCalldate){a.push({items:[{xtype:"displayfield_vo3",value:"calldate:",_type:"label1"},{xtype:"displayfield_vo3",value:"from:",_type:"label2ap"},{xtype:"datetimefield",name:"calldate_from",value:c.values.calldate_from,_type:"fielda",timePosition:"below",zeroTimeEmpty:true,widthDate:c.prop.fieldaWidth,timeMarginLeft:c.prop.fieldaWidth-__width_FieldTimeM},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"to:",_type:"label2b"},{xtype:"datetimefield",name:"calldate_to",value:c.values.calldate_to,_type:"fieldb",timePosition:"below",zeroTimeEmpty:true,widthDate:c.prop.fieldaWidth,timeMarginLeft:c.prop.fieldaWidth-__width_FieldTimeM}]})
}if(c.enableCreatedAt){a.push({items:[{xtype:"displayfield_vo3",value:"created_at:",_type:"label1"},{xtype:"displayfield_vo3",value:"from:",_type:"label2ap"},{xtype:"datetimefield",name:"created_at_from",value:c.values.created_at_from,_type:"fielda",timePosition:"below",zeroTimeEmpty:true,allowBlankDate:false,widthDate:c.prop.fieldaWidth,timeMarginLeft:c.prop.fieldaWidth-__width_FieldTimeM},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"to:",_type:"label2b"},{xtype:"datetimefield",name:"created_at_to",value:c.values.created_at_to,_type:"fieldb",timePosition:"below",zeroTimeEmpty:true,widthDate:c.prop.fieldaWidth,timeMarginLeft:c.prop.fieldaWidth-__width_FieldTimeM}]})
}if(c.enableCounter){a.push({items:[{xtype:"displayfield_vo3",value:"counter:",_type:"label1"},{xtype:"displayfield_vo3",value:"cmp_oper_ge",_type:"label2a"},{xtype:"textfield",name:"counter_ge",value:c.values.counter_ge,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"cmp_oper_lt",_type:"label2b"},{xtype:"textfield",name:"counter_lt",value:c.values.counter_lt,_type:"fieldb"}]})
}if(c.enableSipCalleR){a.push({items:[{xtype:"displayfield_vo3",value:"caller_ip:",_type:"label1al"},{xtype:"textfield",name:"sipcallerip",value:c.values.sipcallerip,_type:"fielda"}]})
}if(c.enableSipCalleRD){a.push({items:[{xtype:"displayfield_vo3",value:"ip_address:",_type:"label1"},{xtype:"ComboBoxA",name:"sipcallerdip_type",value:c.values.sipcallerdip_type||0,_type:"combolabel",aData:[[0,"caller_or_called_ip"],[1,"caller_ip"]]},{xtype:"textfield",name:"sipcallerip",value:c.values.sipcallerip,_type:"fielda"},{xtype:"button",name:"sipcallerdip_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"sipcalledip_label",value:"called_ip",_type:"label2b"},{xtype:"textfield",name:"sipcalledip",value:c.values.sipcalledip,_type:"fielda"}]})
}if(c.enableNumFTC){a.push({items:[{xtype:"displayfield_vo3",value:"number:",_type:"label1"},{xtype:"ComboBoxA",name:"numFTC_type",value:c.values.numFTC_type||0,_type:"combolabel",aData:[[0,"from_to_contact"],[1,"from"]]},{xtype:"textfield",name:"from_num",value:c.values.from_num,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",name:"to_num_label",value:"to",_type:"label2b"},{xtype:"textfield",name:"to_num",value:c.values.to_num,_type:"fieldb"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",name:"contact_num_label",value:"contact",_type:"label2c"},{xtype:"textfield",name:"contact_num",value:c.values.contact_num,_type:"fieldc"}]})
}if(c.enableNameFrom){a.push({items:[{xtype:"displayfield_vo3",value:"name_from:",_type:"label1al"},{xtype:"textfield",name:"from_name",value:c.values.from_name,_type:"fielda"}]})
}if(c.enableDomainFTC){a.push({items:[{xtype:"displayfield_vo3",value:"domain:",_type:"label1"},{xtype:"ComboBoxA",name:"domainFTC_type",value:c.values.domainFTC_type||0,_type:"combolabel",aData:[[0,"from_to_contact"],[1,"from"]]},{xtype:"textfield",name:"from_domain",value:c.values.from_domain,_type:"fielda"},{xtype:"displayfield_vo3",name:"to_domain_label",value:"to",_type:"label2b+"},{xtype:"textfield",name:"to_domain",value:c.values.to_domain,_type:"fieldb"},{xtype:"displayfield_vo3",name:"contact_domain_label",value:"contact",_type:"label2c+"},{xtype:"textfield",name:"contact_domain",value:c.values.contact_domain,_type:"fieldc"}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"domainFTC_group_id_type",value:c.values.domain_group_idFTC_type||0,_type:"combolabel",aData:[[0,"from_to_contact"],[1,"from"]]},{xtype:"CBX_cbDomainGroups",name:"from_domain_group_id",value:c.values.from_domain_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true},{xtype:"displayfield_vo3",name:"to_domain_group_id_label",value:"to",_type:"label2b+"},{xtype:"CBX_cbDomainGroups",name:"to_domain_group_id",value:c.values.to_domain,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true},{xtype:"displayfield_vo3",name:"contact_domain_group_id_label",value:"contact",_type:"label2c+"},{xtype:"CBX_cbDomainGroups",name:"contact_domain_group_id",value:c.values.contact_domain,_type:"fieldc",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true}]})
}if(c.enableDomainContact){a.push({items:[{xtype:"displayfield_vo3",value:"domain_contact:",_type:"label1al"},{xtype:"textfield",name:"contact_domain",value:c.values.contact_domain,_type:"fielda"}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"displayfield_vo3",value:"group",_type:"label2ap"},{xtype:"CBX_cbDomainGroups",name:"contact_domain_group_id",value:c.values.contact_domain_group_id,_type:"fieldaa",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true}]})
}if(c.enableUsername){a.push({items:[{xtype:"displayfield_vo3",value:"username:",_type:"label1al"},{xtype:"textfield",name:"digestusername",value:c.values.digestusername,_type:"fielda",width:c.prop.fieldwWidth}]})
}if(c.enableRealm){a.push({items:[{xtype:"displayfield_vo3",value:"realm:",_type:"label1al"},{xtype:"textfield",name:"digestrealm",value:c.values.digestrealm,_type:"fielda",width:c.prop.fieldwWidth}]})
}if(c.enableRrdAvg){a.push({items:[{xtype:"displayfield_vo3",value:"rrd_avg:",_type:"label1"},{xtype:"displayfield_vo3",value:"cmp_oper_ge",_type:"label2a"},{xtype:"textfield",name:"rrd_avg_ge",value:c.values.rrd_avg_ge,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"cmp_oper_lt",_type:"label2b"},{xtype:"textfield",name:"rrd_avg_lt",value:c.values.rrd_avg_lt,_type:"fieldb"}]})
}if(c.enableExpires){a.push({items:[{xtype:"displayfield_vo3",value:"expires:",_type:"label1"},{xtype:"displayfield_vo3",value:"cmp_oper_ge",_type:"label2a"},{xtype:"textfield",name:"expires_ge",value:c.values.expires_ge,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"cmp_oper_lt",_type:"label2b"},{xtype:"textfield",name:"expires_lt",value:c.values.expires_lt,_type:"fieldb"}]})
}if(c.enableExpiresAt){a.push({items:[{xtype:"displayfield_vo3",value:"expires_at:",_type:"label1"},{xtype:"displayfield_vo3",value:"from",_type:"label2ap"},{xtype:"datetimefield",name:"expires_at_from",value:c.values.expires_at_from,_type:"fielda",timePosition:"below",zeroTimeEmpty:true,widthDate:c.prop.fieldaWidth,timeMarginLeft:c.prop.fieldaWidth-__width_FieldTimeM},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"to",_type:"label2b"},{xtype:"datetimefield",name:"expires_at_to",value:c.values.expires_at_to,_type:"fieldb",timePosition:"below",zeroTimeEmpty:true,widthDate:c.prop.fieldaWidth,timeMarginLeft:c.prop.fieldaWidth-__width_FieldTimeM}]})
}if(c.enableState){a.push({items:[{xtype:"displayfield_vo3",value:"state:",_type:"label1al"},{xtype:"CBX_RegState",name:"state",value:c.values.state,_type:"fielda",hideLabel:true,multiSelect:true,_clearButton:true,width:c.prop.fieldwWidth,_arraySeparator:","}]})
}if(c.enableUa){a.push({items:[{xtype:"displayfield_vo3",value:"ua:",_type:"label1al"},{xtype:"textfield",name:"ua",value:c.values.ua,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"displayfield_vo3",value:"group",_type:"label2ap"},{xtype:"CBX_cbUaGroups",name:"ua_group_id",value:c.values.ua_group_id,_type:"fieldaa",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true}]})
}if(c.enableSensorId){a.push({items:[{xtype:"displayfield_vo3",value:"sensor:",_type:"label1al"},{xtype:"CBX_sensor",name:"sensor_id",value:c.values.sensor_id||0,_type:"fieldaa",_noLabel:true,_addEmptySensorId:true,_clearButton:true}]})
}if(c.enableSIPALG){a.push({items:[{xtype:"displayfield_vo3",value:"detectSIPALG:",_type:"label1al"},{xtype:"checkbox",name:"is_sipalg_detected",checked:c.values.is_sipalg_detected,height:__height_Field}]})
}for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){switch(a[d].items[b]._type){case"fielda":case"fieldaa":Ext.applyIf(a[d].items[b],{width:a[d].items[b]._type=="fielda"?c.prop.fieldaWidth:c.prop.fieldaaWidth});
break;
case"fieldb":Ext.applyIf(a[d].items[b],{width:c.prop.fieldbWidth});
break;
case"fieldc":Ext.applyIf(a[d].items[b],{width:c.prop.fieldcWidth});
break;
case"label1":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width,style:c.prop.label1Style,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1a":case"label1ap":case"label1al":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width+c.prop.label2aWidth,style:["label1a","label1ap"].isIn(a[d].items[b]._type)?c.prop.label1aStyle:c.prop.label1alStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label1ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2a":case"label2ap":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:c.prop.label2aStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label2ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2b":case"label2b+":Ext.applyIf(a[d].items[b],{width:a[d].items[b]._type=="label2b+"?c.prop.label2bpWidth:c.prop.label2bWidth,style:c.prop.label2bStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"label2c":case"label2c+":Ext.applyIf(a[d].items[b],{width:a[d].items[b]._type=="label2c+"?c.prop.label2cpWidth:c.prop.label2cWidth,style:c.prop.label2cStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"combolabel":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(g){var f=g.findFormPanel();
if(f){Register.Filter.setContextFields(f)
}}}});
break;
case"btnswitch":Ext.applyIf(a[d].items[b],{width:c.prop.btnSwitchWidth,border:false,style:{background:"transparent",marginTop:2,marginLeft:4,marginRight:4,height:c.prop.btnSwitchHeight},cls:"icon_arrow_switch_lr",handler:function(g){var f=g.findFormPanel();
if(f){Register.Filter.switchContentFields(f,g.name)
}}});
break;
case"btnswitch_filler":Ext.applyIf(a[d].items[b],{xtype:"container",width:c.prop.btnSwitchWidth+8,border:false});
break
}}}Ext.applyIf(a[d],{xtype:"container",layout:"hbox",style:{paddingBottom:__height_FieldSeparator}})
}return(this.completeFields(a))
},completeFields:function(a){if(Ext.isArray(a)){for(var c=0;
c<a.length;
c++){this.completeFields(a[c])
}return(a)
}if(a.items){this.completeFields(a.items);
return(a)
}if(a.xtype&&a.xtype.match(/^displayfield/)&&a.value){var g=a.value;
var d=false;
if(g.match(/:$/)){g=g.substr(0,g.length-1);
d=true
}var f=findLangS(this.subsystem,"field_filter",g);
if(f){a.value=f;
if(d){a.value+=":"
}}var b=findLangS(this.subsystem,"field_filter_help",g);
if(b){a.helpText=b
}}if(a.aData){for(var c=0;
c<a.aData.length;
c++){if(Ext.isArray(a.aData[c])&&a.aData[c].length==2){var f=findLangS(this.subsystem,"field_filter",a.aData[c][1]);
if(f){a.aData[c][1]=f+(a._type=="combolabel_main"?":":"")
}}}}a.__filter="register";
return(a)
},fetchValuesFromFieldset:function(d){var c={};
if(d.getForm){d=d.getForm()
}var b=this.getArrayOfFields();
if(b){for(var a=0;
a<b.length;
a++){var g=this.findFilterField(d,b[a]);
if(g){var f=g.getValue();
if(Ext.isDefined(f)&&f!==""&&f!==null){c[b[a]]=g.getValue()
}}}}return(c)
},setValueFieldsFieldset:function(a,d){if(!d||!a){return
}if(d.getForm){d=d.getForm()
}var c=this.getArrayOfFields();
if(c){for(var b=0;
b<c.length;
b++){var f=this.findFilterField(d,c[b]);
if(f){f.setValue(a[c[b]])
}}}this.setContextFields(d)
},getArrayOfFields:function(a){return(["calldate_from","calldate_to","created_at_from","created_at_to","counter_ge","counter_lt","sipcallerip","sipcalledip","sipcallerdip_type","from_num","to_num","contact_num","numFTC_type","from_name","from_domain","to_domain","contact_domain","domainFTC_type","from_domain_group_id","to_domain_group_id","contact_domain_group_id","domainFTC_group_id_type","digestusername","digestrealm","ua_group_id","expires_ge","expires_lt","expires_at_from","expires_at_to","state","ua","rrd_avg_ge","rrd_avg_lt","sensor_id","is_sipalg_detected"])
},setContextFields:function(d){if(!d){return
}if(d.getForm){d=d.getForm()
}var a=this.abFields_labelContext();
for(var g in a){var f=this.findFilterField(d,g);
if(f){fieldValue=f.getValue();
if(fieldValue==null){f.setValue(0);
fieldValue=0
}for(var b=0;
b<a[g].length;
b++){if(a[g][b]){var c=this.findFilterField(d,a[g][b]);
if(c){c.setVisible(fieldValue==1)
}}}}}},switchContentFields:function(d,h){if(!d){return
}if(d.getForm){d=d.getForm()
}var g=this.abFields_switch();
if(g[h]){var c=[];
for(var b=0;
b<2;
b++){for(var a=0;
a<2;
a++){var f=this.findFilterField(d,g[h][a]);
if(b){f.setValue(c[a?0:1])
}else{c[a]=f.getValue()
}}}}},isDataSet:function(a){if(a.getForm){a=a.getForm()
}var b=this.fetchValuesFromFieldset(a);
delete b.calldate_from;
delete b.calldate_to;
return(isDataSet(b))
},findFilterField:function(c,d){if(!c){return(null)
}if(c.findField){c=c.owner
}var a=c.getItems(d,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(a[b].__filter=="register"){return(a[b])
}}}return(null)
},enableField:function(b,d,a){var c=this.findFilterField(b,d);
if(c){c.enableIf(a)
}},setValueField:function(a,d,b){var c=this.findFilterField(a,d);
if(c){c.setValue(b)
}},optimizeFilterItems:function(f){var h=this.abFields_typeAB();
for(var c in h){if(Ext.isDefined(f[c])){var g=h[c][0];
var d=h[c][1];
var b=h[c][2];
if(!f[g]&&!f[d]&&(!b||!f[b])){delete f[c]
}}}var a=[];
for(var c=0;
c<a.length;
c++){if(Ext.isDefined(f["f"+a[c]])&&!f["f"+a[c]]){delete f["f"+a[c]]
}}},abFields_Types:function(){var a=[];
for(var b in this.abFields){if(this.abFields[b].t){a.push(this.abFields[b].t)
}}return(a)
},abFields_labelContext:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&(this.abFields[b].sw||this.abFields[b].l&&this.abFields[b].b)){a[this.abFields[b].t]=[this.abFields[b].sw,this.abFields[b].l,this.abFields[b].b,this.abFields[b].l2,this.abFields[b].c]
}}return(a)
},abFields_switch:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].sw&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].sw]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields_typeAB:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].a,this.abFields[b].b,this.abFields[b].c]
}}return(a)
},abFields:[{t:"sipcallerdip_type",a:"sipcallerip",b:"sipcalledip",l:"sipcalledip_label",sw:"sipcallerdip_switch"},{t:"numFTC_type",a:"from_num",b:"to_num",c:"contact_num",l:"to_num_label",l2:"contact_num_label"},{t:"domainFTC_type",a:"from_domain",b:"to_domain",c:"contact_domain",l:"to_domain_label",l2:"contact_domain_label"},{t:"domainFTC_group_id_type",a:"from_domain_group_id",b:"to_domain_group_id",c:"contact_domain_group_id",l:"to_domain_group_id_label",l2:"contact_domain_group_id_label"}],findLangS:function(a,b){return(findLangS(this.subsystem,a,b))
}});
function isInitRegisterSelectUrlParams(){return(window.register_active_filter?"active":window.register_failed_filter?"failed":window.register_state_filter?"state":null)
}function clearInitRegisterSelectUrlParams(){window.register_active_filter=null;
window.register_failed_filter=null;
window.register_state_filter=null
}Ext.ns("SipMsg");
Ext.define("SipMsg.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SipMsg.GridX",subsystem:"sip_msg",constructor:function(b){var k={};
var h=[];
var c=[];
if(!b.disableMenu){h.push({xtype:"splitbutton",scope:this,text:this.findLangS("button","filterForm"),iconCls:"icon_find",handler:this.createFilterWindow,arrowCls:"link_grey",arrowHandler:this.viewUrl,arrowTooltip:this.findLangS("button_help","filterFormViewUrl"),listeners:{scope:this,afterrender:function(l){window.b=l;
l.getEl().down(".x-btn-button").dom.setAttribute("data-qtip",this.findLangS("button_help","filterForm"))
}},_id:"setFilter"},{scope:this,text:this.findLangS("button","resetFilter"),tooltip:this.findLangS("button_help","resetFilter"),iconCls:"icon_find",handler:this.resetFilter,disabled:true,_id:"resetFilter"},{tooltip:this.findLangS("tools"),iconCls:"icon_wrench",_btnId:"settings",menu:{defaults:{scope:this},items:[{text:this.findLangS("menu","exportCSV"),iconCls:"icon_excel",handler:this.exportToCsv}]}})
}if(!b.disableMenu){c.push(this.findLangS("toolbar","refreshInterval")+":&thinsp;",{xtype:"numberfield",width:__width_ColumnNum(4)+__width_Trigger,minValue:1,maxValue:9999,step:1,enableKeyEvents:true,listeners:{scope:this,change:function(l){this.setTimeoutRefreshInterval(l)
},keyup:function(m,l){this.setTimeoutRefreshInterval(m)
}},fieldStyle:{"text-align":"right"}})
}if(b.enableComboLastInterval){var d=[["last_60m",lang.last+" 60 "+lang.minutes],["last_2h",lang.last+" 2 "+lang.hours],["last_3h",lang.last+" 3 "+lang.hours],["last_24h",lang.last+" 24 "+lang.hours]];
h.push(this.findLangS("toolbar","interval")+":&thinsp;",{xtype:"ComboBoxA",aData:d,value:b&&b.filterInit&&b.filterInit.last_interval||"last_60m",width:__width_ColumnChar(15)+__width_Trigger,listeners:{select:function(m){var l=getTimeInterval(m.getValue());
this.setFilterItemValue("time_from",dateTimeM(l[0]))
},scope:this}})
}var g=null;
if(!b||!b.disablePagingToolbar){g={listeners:{beforechange:function(l,m){if(m!=l.store.currentPage){l._changePage=true
}}}}
}b=Ext.applyIf(b,b.modelType=="active"?{module:"sip_msg_active",storeId:"SipMsgActive",recordStruct:rsSipMsgActive,sortField:"request_time",sortDirection:"desc",remoteSort:true,remoteFilter:true,prefixCls:"sip_msg_active"}:b.modelType=="stored"?{module:"sip_msg",storeId:"SipMsg",recordStruct:rsSipMsg,sortField:"time",sortDirection:"desc",remoteSort:true,remoteFilter:true,prefixCls:"sip_msg",paginator:g||undefined}:{});
b=Ext.applyIf(b,{url:"php/model/sql.php",pageSize:30,columns:this.getColumns(b,this),columnsDefaults:{tdCls:"vertical-align-middle"},extraParams:k,tbar:h,paginatorBehindButtonsItems:c.length?c:undefined,stripeRows:false,enableAutoLoad:false,plugins:[{ptype:"rowexpander",rowBodyContentCls:"SipMsg.GridExpPanel",expandOnEnter:false,expandOnDblClick:false},"columnSort"],loadingText:getLoadMaskWithStopButton_loading_text("sipMsgGrid_loadMask"),viewConfigListeners:{expandbody:function(){if(this._panel){this._panel.collapseGroup()
}}},listeners:{scope:this,afterrender:function(){if(this.autoLoad){return
}this.initFilter();
if(b.modelType=="active"&&isInitSipMsgSelectUrlParams()=="active"){this.setFilter(Ext.decode(window.sip_msg_active_filter));
clearInitSipMsgSelectUrlParams()
}else{if(b.modelType=="stored"&&isInitSipMsgSelectUrlParams()=="stored"){this.setFilter(Ext.decode(window.sip_msg_filter));
clearInitSipMsgSelectUrlParams()
}}if(this._panel){this._panel.setTitleSipMsg()
}this.reload({page:1})
}},proxy_timeout:60*60*1000});
this.callParent([b]);
this.store.on("beforeload",a,this);
this.store.on("load",f,this);
this.store._params=["dir","limit","module","sort","start","task"];
if(this.autoLoad){this.initFilter();
if(this._panel){this._panel.setTitleSipMsg()
}this.reload({page:1})
}function a(){beginLoadMaskWithStopButton_store(this.store,"sipMsgGrid_loadMask")
}function f(){endLoadMaskWithStopButton_store(this.store);
if(this._paginator){if(!this._paginator._changePage&&!loadStoreIsCancel(this.store)){if(this._panel&&this._panel.groupPanel){this._panel.groupPanel.reloadSipMsgStats(this,this.store)
}}this._paginator._changePage=false
}}},getColumns:function(b,a,m){var l=this;
var c=[{headerLang:window.displaySensorNameCdr?"ID_sensor_name":"ID_sensor",dataIndex:"ID",align:"center",width:50,sortable:true,filter:b.modelType=="stored"?{type:"string"}:undefined,renderer:function(s,o,p,t,r,q){return(renderRecordId(s,p))
}},{dataIndex:"type",align:"left",widthChar:6,renderer:renderArrayData,arrayData:arSipMsg_Type},{dataIndex:b.modelType=="active"?"request_time":b.modelType=="stored"?"time":null,headerLang:"datetime",align:"center",width:window.time_precision_sip_msg_in_ms?__width_ColumnTimeMs:__width_ColumnDate,renderer:renderDate,dateFormat:__format_Date+"<br>"+(window.time_precision_sip_msg_in_ms?__format_TimeMs:__format_Time)},{dataIndex:"ip_src",headerLang:"ip_port_src",widthNum:14,renderer:n,sortBy:{ip_src:this.findLangS("sortBy","ip_src"),port_src:this.findLangS("sortBy","port_src")}},{dataIndex:"ip_dst",headerLang:"ip_port_dst",widthNum:14,renderer:n,sortBy:{ip_dst:this.findLangS("sortBy","ip_dst"),port_dst:this.findLangS("sortBy","port_dst")}},{dataIndex:"number_src",headerLang:"number_domain_src",widthChar:18,renderer:f,sortBy:{number_src:this.findLangS("sortBy","number_src"),domain_src:this.findLangS("sortBy","domain_src")}},{dataIndex:"number_dst",headerLang:"number_domain_dst",widthChar:18,renderer:f,sortBy:{number_dst:this.findLangS("sortBy","number_dst"),domain_dst:this.findLangS("sortBy","domain_dst")}},{dataIndex:"ua_src",widthChar:16},{dataIndex:"ua_dst",widthChar:16},{dataIndex:"response_time",headerLang:"response_time",widthChar:13,align:"right",renderer:k},{dataIndex:"response_number",headerLang:"response_type",widthChar:20,renderer:g}];
if(b.modelType=="stored"){var h=getDataSipMsgCustomHeaders();
if(h){for(var d=0;
d<h.length;
d++){if(h[d].show_as_column*1){c.push({dataIndex:h[d]._column_unique,header:h[d].name,width:h[d].width_column*1||100,renderer:function(o){return(renderStringStyle(o,{forceMultiLine:true}))
},sortable:true})
}}}}c.push({dataIndex:"menu",width:90,align:"right",noCopyToClipboard:true,sortable:false,renderer:function(s,o,p,t,r,q){return(s&&s.replaceall("__THIS_ID__",l.id)||"&nbsp;")
}});
if(m&&this.plugins){for(var d=0;
d<this.plugins.length;
d++){if(this.plugins[d].ptype=="rowexpander"){c.splice(0,0,this.plugins[d].getHeaderConfig());
break
}}}return(c);
function n(u,q,p,v,s,r,o){var t=o&&o.ownerCt&&o.ownerCt.getHeaderContainer?o.ownerCt.getHeaderContainer().getHeaderAtIndex(s):null;
if(!t){return(u)
}return(u+"<br>"+(t.dataIndex=="ip_src"?p.data.port_src:p.data.port_dst))
}function f(u,q,p,v,s,r,o){var t=o&&o.ownerCt&&o.ownerCt.getHeaderContainer?o.ownerCt.getHeaderContainer().getHeaderAtIndex(s):null;
if(!t){return(u)
}return(u+"<br>"+(t.dataIndex=="number_src"?p.data.domain_src:p.data.domain_dst))
}function k(t,q,p,u,s,r,o){q.style="border-left: 3px solid "+(p.data.qualify_ok>0?"green":"red");
return(Ext.Date.format(t,window.time_precision_sip_msg_in_ms?__format_TimeMs:__format_Time)+"<br>"+(!Ext.isEmpty(p.data.response_duration_ms)&&p.data.response_duration_ms>=0?p.data.response_duration_ms+" ms":"&nbsp;"))
}function g(t,q,p,u,s,r,o){return((t||"")+"<br>"+(p.data.response_string||""))
}},reconfigureColumns:function(){var a=this.getColumns(this,this,true);
this.reconfigure(this.store,a);
this.applyConfig()
},onStoreLoad:function(b,a,d,c){if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(ActiveModule==(this.modelType=="active"?"SipMsg_active":this.modelType=="stored"?"SipMsg_stored":undefined)&&this.isVisible()&&!reloginForm&&!this._windowFilter&&!this.rowExpander.isAnyExpand()){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}},createFilterWindow:function(){this._windowFilter=true;
var b={values:this.filter||{},modelType:this.modelType};
var f=SipMsg.Filter.getFieldset(b);
var d=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,layout:"fit",items:{xtype:"container",items:f},buttons:[{scope:this,text:this.findLangS("button","search"),iconCls:"icon_find",handler:a},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){c.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",d.el,{enter:a,scope:this});
var g=d.getForm().getFields();
var h=null;
for(var k=0;
k<g.getCount();
k++){if(!(g.getAt(k) instanceof Ext.form.DisplayField)){h=g.getAt(k);
break
}}if(h){h.focus(false,500)
}SipMsg.Filter.setContextFields(d)
}},style:{padding:5}});
var c=new Ext.Window({scope:this,iconCls:"icon_find",title:this.findLangS("title","filterForm"),closable:true,width:775,border:false,plain:true,layout:"fit",modal:false,items:d,formPanelForAutoAdjustSize:d,listeners:{scope:this,destroy:function(){this._windowFilter=false
}}});
c.show();
function a(){if(d.getForm().isValid()){this.setFilter(SipMsg.Filter.fetchValuesFromFieldset(d));
c.destroy()
}}},initFilter:function(){this.filter={};
if(!this.disableMenu){this.filter.time_from=SipMsg.Filter.getDefaultDateFrom()
}else{if(this.filterInit){this.filter=cloneObject(this.filterInit)
}else{this.filter.last_interval="last_60m"
}}if(this.filter.last_interval){if(!this.filter.time_from){var a=getTimeInterval(this.filter.last_interval);
this.filter.time_from=dateTimeM(a[0])
}delete this.filter.last_interval
}this.store.proxy.extraParams.form_filters=Ext.encode(this.filter)
},setFilter:function(a){this.filter=a;
this.store.proxy.extraParams.form_filters=Ext.encode(this.filter);
this.reload({page:1});
this.setToolbarFilterItems()
},setFilterItemValue:function(b,c,a){if(c){if(!this.filter){this.filter={}
}this.filter[b]=c;
this.store.proxy.extraParams.form_filters=Ext.encode(this.filter);
if(!a){this.reload({page:1})
}}else{if(this.filter){delete this.filter[b];
if(!isDataEmpty(this.filter)){if(!a){this.resetFilter()
}}else{this.store.proxy.extraParams.form_filters=Ext.encode(this.filter);
if(!a){this.reload({page:1})
}}}}this.setToolbarFilterItems()
},getFilterItemValue:function(a){return(this.filter&&this.filter[a]||null)
},resetFilter:function(){this.initFilter();
this.reload({page:1});
this.enableBtn("resetFilter",false);
this.setToolbarFilterItems()
},reload:function(a){if(a&&a.page){this.store.currentPage=a.page;
Ext.apply(a,{start:(a.page-1)*this.store.pageSize})
}this.store.load(a);
if(this._panel){this._panel.setTitleSipMsg()
}},setToolbarFilterItems:function(){var a=isDataEmpty(this.filter);
this.enableBtn("resetFilter",!a)
},viewUrl:function(){var d=window.location.origin+window.location.pathname;
var c={};
var b=SipMsg.Filter.getArrayOfFields();
for(var a in this.filter){if(Ext.isString(a)&&b.inArray(a)&&Ext.isDefined(this.filter[a])&&this.filter[a]!==null&&this.filter[a]!==""){c[a]=this.filter[a]
}}d+="?";
d+=this.modelType=="active"?"sip_msg_active_filter=":this.modelType=="stored"?"sip_msg_filter=":undefined;
if(!isDataEmpty(c)){SipMsg.Filter.optimizeFilterItems(c)
}d+=encodeURIjson(Ext.encode(c));
var f='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+d+'" target="_blank">'+d+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(this.findLangS("title","filterFormViewUrl"),f,function(){var g=Ext.getCmp("copy_button");
if(g){g.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(g){return(g.clipboardText)
},getClipTextParams:{clipboardText:d},id:"copy_button",renderTo:"copy_button_div"})
},exportToCsv:function(){if(this.module=="sip_msg_active"){formPostSafe("php/model/sql.php","POST",Ext.applyIf({module:this.module,task:"LISTING",timeout:60*60,exportToCsv:true},this.getExtraParamsForExportToCsv()))
}else{this.callParent()
}},doDownloadPcap:function(c,b){var d={id:c,sip_msg:1};
if(this.modelType=="active"){var a=this.findRecord(c);
if(a){Ext.apply(d,{type:a.data.type,request_first_time:a.data.request_first_time,request_first_time_us_compl:a.data.request_first_time_us_compl,callid:a.data.callid,cseq:a.data.cseq,id_sensor:a.data.id_sensor});
delete d.id
}else{return
}}SipMsg.Utils.prepareDownloadPcap(this,d,function(f){downloadPrepareFileHash(f)
})
},findRecord:function(b){var a=null;
this.store.each(function(c){if(c.data.ID==b){a=c
}});
return(a)
}});
Ext.define("SipMsg.GridExpPanel",{extend:"Ext.Panel",subsystem:"sip_msg",constructor:function(c){var b=[];
if(c.grid.modelType=="active"){this.history=new SipMsg.Active.History.Grid({title:this.findLangS("title","history"),sipMsgId:c.record.data.ID,sipMsgType:c.record.data.type,sipMsgSensorId:c.record.data.id_sensor,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
b.push(this.history);
var f=["type","ip_src","ip_dst","number_src","number_dst","domain_src","domain_dst"];
var a={};
for(var d=0;
d<f.length;
d++){a[f[d]]=c.record.data[f[d]]
}this.stored=new SipMsg.Grid({title:this.findLangS("title","stored"),modelType:"stored",filterInit:{last_interval:"last_60m",id_sensor:c.record.data.id_sensor},relFields:a,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},pageSize:10,autoLoad:true,decWidthColumn:2,disableMenu:true,enableComboLastInterval:true});
this.stored.store.on("load",function(h,g,l,k){if(g.length){this.tabPanel.add(this.stored)
}},this,{single:true})
}if(c.grid.modelType=="stored"){b.push({xtype:"SipMsg_summaryPanel",border:false,record:c.record,grid:c.grid,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
b.push({xtype:"Message_sipHistoryPanel",sipMsgId:c.record.data.ID})
}if(c.record.data.request_content&&((c.record.data.request_content.match&&c.record.data.request_content.match(/\<\?xml/))||(c.record.data.request_content_type&&c.record.data.request_content_type.match&&c.record.data.request_content_type.match(/xml/)))){b.push(new Tools.ParseXmlPdmlPanel({data:c.record.data.request_content,title:this.findLangS("title","requestTreeTab"),enableShowThumbnail:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}}))
}if(c.record.data.response_content&&((c.record.data.response_content.match&&c.record.data.response_content.match(/\<\?xml/))||(c.record.data.response_content_type&&c.record.data.response_content_type.match&&c.record.data.response_content_type.match(/xml/)))){b.push(new Tools.ParseXmlPdmlPanel({data:c.record.data.response_content,title:this.findLangS("title","responseTreeTab"),enableShowThumbnail:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}}))
}this.tabPanel=new Ext.TabPanel({items:b,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:c.grid.prefixCls+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(c,{items:this.tabPanel,border:false});
this.callParent([c])
}});
Ext.define("SipMsg.SummaryPanel",{extend:"Ext.Panel",alias:"widget.SipMsg_summaryPanel",subsystem:"sip_msg",constructor:function(d){var b=500;
var a="";
var g=getDataSipMsgCustomHeaders();
if(g){for(var f=0;
f<g.length;
f++){if(d.record.data[g[f]._column_unique]){a+='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">'+g[f].name+'</th></tr></thead><tbody><tr><td><div style="width: '+b+'px; word-wrap: break-word;white-space: normal;">'+htmlEncode(d.record.data[g[f]._column_unique])+"</div></td></tr></tbody></table>"
}}}var c=new Ext.Template('<div id="summary_panel_'+(d.grid&&d.grid.level||0)+'_{ID}">','<table border="0">','<tr><td style="vertical-align: top;">','<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-bottom: 4px; width: 350px; table-layout: fixed;">','<colgroup><col width="30%"><col width="35%"><col width="35%"></colgroup>',"<thead><tr><th>&nbsp;<th>Source<th>Destination</tr></thead>","<tbody>","<tr><td>IP","<td>"+d.record.data.ip_src,"<td>"+d.record.data.ip_dst,"<tr><td>Port<td>"+(d.record.data.port_src||"")+"<td>"+(d.record.data.port_dst||""),"<tr><td>Number<td>"+(d.record.data.number_src||"")+"<td>"+(d.record.data.number_dst||""),"<tr><td>Domain<td>"+(d.record.data.domain_src||"")+"<td>"+(d.record.data.domain_dst||""),"<tr><td>UA<td>"+(d.record.data.ua_src||"")+"<td>"+(d.record.data.ua_dst||""),"</table>",'</td><td style="vertical-align: top;">','<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;">','<thead><tr><th style="text-align: left;">RESPONSE</th></tr></thead>',"<tbody><tr><td>",'<div style="width: '+b+'px; word-wrap: break-word; white-space: normal;">',(d.record.data.response_number||"")+(d.record.data.response_number&&d.record.data.response_string?" / ":"")+(d.record.data.response_string||""),"</div>","</td></tr></tbody>","</table>",'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;">','<thead><tr><th style="text-align: left;">CALL ID</th></tr></thead>',"<tbody><tr><td>",'<div style="width: '+b+'px; word-wrap: break-word; white-space: normal;">',"{callid}","</div>","</td></tr></tbody>","</table>",'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;">','<thead><tr><th style="text-align: left;">CALLERNAME</th></tr></thead>',"<tbody><tr><td>",'<div style="width: '+b+'px; word-wrap: break-word; white-space: normal;">',"{callername}","</div>","</td></tr></tbody>","</table>",(d.record.data.request_content?'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+(b+10)+'px;"><col width=50%><col width=50%><thead><tr><th>Request Content-type<th>Request Content-length</tr></thead><tbody><tr><td>{request_content_type}<td>'+(d.record.data.request_content_length||"")+'</tr></tbody></table><table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">REQUEST CONTENT</th></tr></thead><tbody><tr><td><div style="width: '+b+'px; word-wrap: break-word; white-space: normal;">{request_content_html}</div></td></tr></tbody></table>':""),(d.record.data.response_content?'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+(b+10)+'px;"><col width=50%><col width=50%><thead><tr><th>Request Content-type<th>Request Content-length</tr></thead><tbody><tr><td>{response_content_type}<td>'+(d.record.data.response_content_length||"")+'</tr></tbody></table><table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px;"><thead><tr><th style="text-align: left;">RESPONSE CONTENT</th></tr></thead><tbody><tr><td><div style="width: '+b+'px; word-wrap: break-word; white-space: normal;">{response_content_html}</div></td></tr></tbody></table>':""),a,"</table>","</div>");
Ext.applyIf(d,{title:this.findLangS("title","summaryTab"),html:c.applyTemplate(d.record&&d.record.data||{}),iconCls:"icon_table_lightning"});
this.callParent([d])
}});
Ext.define("SipMsg.Active.History.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"sip_msg",constructor:function(c){var f=this;
var d=[{dataIndex:"time",headerLang:"datetime",renderer:renderDate,dateFormat:window.time_precision_sip_msg_in_ms?__format_DateTimeMs:__format_DateTime,width:window.time_precision_sip_msg_in_ms?__width_ColumnDateTimeMs:__width_ColumnDateTime},{dataIndex:"response_duration_ms",align:"right",renderer:b,widthNum:12},{dataIndex:"response_number",headerLang:"response_type",renderer:a,widthChar:40},{dataIndex:"menu",width:90,align:"right",noCopyToClipboard:true,renderer:function(m,g,h,n,l,k){g.style="padding: 0; padding-top: 1px;";
return(m&&m.replaceall("__THIS_ID__",f.id)||"&nbsp;")
}}];
c=Ext.applyIf(c||{},{url:"php/model/sql.php",module:"sip_msg_active_history",storeId:"SipMsgActiveHistory",recordStruct:rsSipMsgActiveHistory,sortField:"time",sortDirection:"desc",remoteSort:true,columns:d,columnsDefaults:{sortable:false},extraParams:{sipMsgId:c.sipMsgId,sipMsgType:c.sipMsgType,sipMsgSensorId:c.sipMsgSensorId},stripeRows:false});
this.callParent([c]);
function b(n,k,h,o,m,l,g){k.style="border-left: 3px solid "+(h.data.qualify_ok>0?"green":"red");
return(!Ext.isEmpty(n)&&n>=0?n+" ms":"")
}function a(n,k,h,o,m,l,g){return(h.data.response_string||n||"")
}},doDownloadPcap:function(c,b){var a=this.findRecord(c);
if(!a){return
}params={sip_msg:1,type:this.sipMsgType,time:a.data.time,time_us_compl:a.data.time_us_compl,callid:a.data.callid,cseq:a.data.cseq,id_sensor:this.sipMsgSensorId};
SipMsg.Utils.prepareDownloadPcap(this,params,function(d){downloadPrepareFileHash(d)
})
},findRecord:function(b){var a=null;
this.store.each(function(c){if(c.data.time_us_compl==b){a=c
}});
return(a)
}});
Ext.define("SipMsg.Active.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.SipMsg_activePanelX",subsystem:"sip_msg",constructor:function(a){this.sipMsgActive=new SipMsg.Grid({modelType:"active",layout:"fit",border:false});
a=Ext.applyIf(a||{},{titleLang:"sip_msg_active",id:"SipMsg_active-panel",iconCls:"icon_tag",items:this.sipMsgActive,wikiId:"SipMsg"});
this.callParent([a])
}});
Ext.define("SipMsg.Stored.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.SipMsg_storedPanelX",subsystem:"sip_msg",constructor:function(a){this.sipMsgStored=new SipMsg.Grid({modelType:"stored",layout:"fit",border:false,_panel:this});
a=Ext.applyIf(a||{},{titleLang:"sip_msg_stored",id:"SipMsg_stored-panel",iconCls:"icon_tag",items:this.sipMsgStored,listeners:{scope:this,afterrender:function(){if(!Ext.isIE){var b=Ext.get("SipMsg_stored-panel_header");
if(b){b.setStyle({"padding-top":1,"padding-bottom":1})
}}}},wikiId:"SipMsg"});
this.callParent([a])
},deselectAllGroupFilters:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupFilters()
}},deselectAllGroupSelects:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupSelects()
}},setTitleSipMsg:function(){if(Ext.isIE){var c=this.findLangS("title","sip_msg_stored");
if(this.sipMsgStored.getFilterItemValue("time_from")){c+="&nbsp;&nbsp;&nbsp;from date&nbsp;"+Ext.Date.format(this.sipMsgStored.getFilterItemValue("time_from"),__format_Date)
}if(this.sipMsgStored.getFilterItemValue("time_to")){c+="&nbsp;&nbsp;&nbsp;to date&nbsp;"+Ext.Date.format(this.sipMsgStored.getFilterItemValue("time_to"),__format_Date)
}this.setTitle(c);
return
}var b=this.getTimeFrom();
var a=this.getTimeTo();
if(!this.formTitle){this.setTitle('<div id="sip_msg_title" style="position: relative; left: 0; top: 0; width: 500; height: 22"/>');
this.formTitle=new Ext.form.FormPanel({items:{layout:{type:"hbox",align:"middle"},xtype:"container",items:[{xtype:"displayfield",value:this.findLangS("title","sip_msg_stored")+" - from date&nbsp;",fieldCls:"x-panel-header-title-default",width:270,height:16},{xtype:"DateField2T",name:"time_from",value:clone(b),format:__format_DateTimeM,width:125+__width_Trigger,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(f,d){this.sipMsgStored.setFilterItemValue("time_from",d)
},blur:function(d){var f=d.getValue();
if(f){f.timeDefined=true
}if(!eqDate(f,this.sipMsgStored.getFilterItemValue("time_from"))){this.sipMsgStored.setFilterItemValue("time_from",f)
}},specialkey:function(f,d){if(d.getKey()==d.ENTER){var g=f.rawToValue(f.getRawValue());
if(g){g.timeDefined=true
}if(!eqDate(g,this.sipMsgStored.getFilterItemValue("time_from"))){this.sipMsgStored.setFilterItemValue("time_from",g)
}}}},t2menu:getStdMenuTimeFrom(this,function(d){var g=dateTimeM(getTimeInterval(d._typeTimeFrom)[0]);
var f=getTimeInterval(d._typeTimeFrom)[1];
if(f){f.timeDefined=false
}this.sipMsgStored.setFilterItemValue("time_to",f,true);
this.sipMsgStored.setFilterItemValue("time_from",g)
})},{xtype:"displayfield",value:"&nbsp;&nbsp;to date",fieldCls:"x-panel-header-title-default",width:51,height:16},{xtype:"datefield",name:"time_to",value:clone(a),format:__format_Date,width:90,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(f,d){d.timeDefined=false;
this.sipMsgStored.setFilterItemValue("time_to",d)
},blur:function(f){var d=f.getValue();
if(d){d.timeDefined=false
}if(!eqDate(d,this.sipMsgStored.getFilterItemValue("time_to"))){this.sipMsgStored.setFilterItemValue("time_to",d)
}},specialkey:function(g,f){if(f.getKey()==f.ENTER){var d=g.rawToValue(g.getRawValue());
if(d){d.timeDefined=false
}if(!eqDate(d,this.sipMsgStored.getFilterItemValue("time_to"))){this.sipMsgStored.setFilterItemValue("time_to",d)
}}}}}]},border:false,bodyStyle:{background:"transparent"},renderTo:"sip_msg_title",width:600})
}else{this.formTitle.getForm().findField("time_from").setValue(clone(b));
this.formTitle.getForm().findField("time_to").setValue(clone(a))
}},collapseGroup:function(){if(this.groupPanel){this.groupPanel.collapse()
}},reactivate:function(){if(window.needSipMsgColumnsReconfigure){this.sipMsgStored.reconfigureColumns();
window.needSipMsgColumnsReconfigure=false
}this.sipMsgStored.reload()
},changeTimezone:function(){this.sipMsgStored.reload()
},getTimeFrom:function(){return(this.sipMsgStored.getFilterItemValue("time_from"))
},getTimeTo:function(){return(this.sipMsgStored.getFilterItemValue("time_to"))
}});
Ext.define("SipMsg.Settings.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"sip_msg",constructor:function(c){var b=15;
var k=35;
var a=__width_FieldChar(b);
var f=__width_FormChar(b,k)+__width_FieldChar(k)+__width_FieldSeparator;
c=Ext.applyIf(c||{},{storeId:"SipMsgQualify",url:"php/model/sql.php",module:"sip_msg_qualify",recordStruct:rsSipMsgQualify,sortField:"name",remoteSort:true,columns:[{dataIndex:"name",widthCh:40},{dataIndex:"type",widthCh:20},{dataIndex:"descr",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:k,labelCh:b,disableAutoAddTriggerWidth:true},ewConfig:{width:f+40},fpItems:function(p,n,o,l){var m=[{name:"name",allowBlank:false},{xtype:"checkboxgroup_set",name:"type",columns:1,items:[{name:"options",autoBoxLabel:true},{boxLabel:"subscribe",name:"subscribe",hideLabel:true},{boxLabel:"notify",name:"notify",hideLabel:true}]},{xtype:"numberfield",name:"ok_qualify_limit",minValue:1,allowBlank:false,_width:__width_FieldNum(5)+__width_Trigger},{xtype:"textarea",name:"ok_responses",height:__height_FieldLines(3)},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field","conditions")+":",width:a,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",items:d.call(this,"src")},{xtype:"container",items:g.call(this,"src")},{xtype:"container",items:h.call(this,"src")}],width:__width_FieldChar(k)},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",items:d.call(this,"dst")},{xtype:"container",items:g.call(this,"dst")},{xtype:"container",items:h.call(this,"dst")}],width:__width_FieldChar(k)}],width:f+2,style:{marginBottom:5}},{name:"descr",xtype:"textarea",heightL:3}];
return(m)
},enableEdit:true,stripeRows:false});
this.callParent([c]);
function d(l){return([{xtype:"displayfield_h16",value:this.findLangS("field","ip_"+l),height:16,style:{marginTop:1,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbIpGroups",name:"ip_"+l+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"ip_"+l,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}}])
}function g(l){return([{xtype:"displayfield_h16",value:this.findLangS("field","number_"+l),height:16,style:{marginTop:1,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbNumberGroups",name:"number_"+l+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"number_"+l,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}}])
}function h(l){return([{xtype:"displayfield_h16",value:this.findLangS("field","domain_"+l),height:16,style:{marginTop:1,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbDomainGroups",name:"domain_"+l+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"domain_"+l,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}}])
}},onChangeRecords:function(a,b){if(b){refreshSipMsgQualify()
}}});
Ext.define("SipMsg.Settings.Form",{extend:"Ext.ux.setting.Form",subsystem:"sip_msg",constructor:function(a){Ext.applyIf(a,{settingTableName:"sip_msg_qualify_settings",settingTableStruct:rsSipMsgQualifySettings,specItems:{ok_qualify_limit:{xtype:"numberfield",minValue:1,_width:__width_FieldNum(5)+__width_Trigger},ok_responses:{xtype:"textarea",height:__height_FieldLines(3)}},promptSave:true});
this.callParent([a])
},getDefaultValues:function(){return({ok_qualify_limit:2000})
},onSaveSuccess:function(){refreshSipMsgQualify()
}});
Ext.define("SipMsg.Settings.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.SipMsg_settingsPanelX",subsystem:"sip_msg",constructor:function(a){this.settingsGrid=new SipMsg.Settings.Grid({title:this.findLangS("title","settingsTable")});
this.settingsForm=new SipMsg.Settings.Form({title:this.findLangS("title","settingsDefaults")});
a=Ext.applyIf(a||{},{titleLang:"settings",id:"SipMsg_settings-panel",items:{xtype:"tabpanel",items:[this.settingsGrid,this.settingsForm],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel},flex:1},wikiId:"SipMsg"});
this.callParent([a])
}});
Ext.define("SipMsg.Filter",{singleton:true,subsystem:"sip_msg",getFieldset:function(c){c=c||{};
c.prop=c.prop||{};
Ext.applyIf(c.prop,{fieldaWidth:__width_FieldChar(22),fieldbWidth:__width_FieldChar(22),fieldwWidth:__width_FieldChar(35),label1Width:__width_FieldChar(14),label2aWidth:__width_FieldChar(22),label2bWidth:__width_FieldChar(13),btnSwitchWidth:16,btnSwitchHeight:16,label1Style:{},label1CheckboxStyle:{"margin-left":10},label1aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label1alStyle:{"margin-right":__width_LabelFieldSeparator},label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[];
if(c.modelType=="stored"&&!c.disableTimeInterval){a.push({items:[{xtype:"displayfield_vo3",value:"time:",_type:"label1"},{xtype:"displayfield_vo3",value:"timeFrom",_type:"label2ap"},{xtype:"datetimefield",name:"time_from",value:c.values.time_from,_type:"fielda",inEditor:true,zeroTimeEmpty:true,allowBlankDate:false},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"timeTo",_type:"label2b"},{xtype:"datetimefield",name:"time_to",value:c.values.time_to,_type:"fieldb",inEditor:true,zeroTimeEmpty:true}]})
}a.push({items:[{xtype:"displayfield_vo3",value:"type:",_type:"label1al"},{xtype:"ComboBoxA",name:"type",value:c.values.type,_type:"fielda",aData:arSipMsg_Type,hideLabel:true,multiSelect:true,_clearButton:true,width:c.prop.fieldwWidth,_arraySeparator:","}]});
a.push({items:[{xtype:"displayfield_vo3",value:"ip_address:",_type:"label1"},{xtype:"ComboBoxA",name:"ip_src_dst_type",value:c.values.ip_src_dst_type||0,_type:"combolabel",aData:[[0,"src_or_dst"],[1,"src"]]},{xtype:"textfield",name:"ip_src",value:c.values.ip_src,_type:"fielda"},{xtype:"button",name:"ip_src_dst_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"ip_dst_label",value:"ip_dst",_type:"label2b"},{xtype:"textfield",name:"ip_dst",value:c.values.ip_dst,_type:"fielda"}]});
if(c.modelType=="stored"){a.push({items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"ip_src_dst_group_id_type",value:c.values.ip_src_dst_group_id_type||0,_type:"combolabel",aData:[[0,"src_or_dst_group"],[1,"src_group"]]},{xtype:"CBX_cbIpGroups",name:"ip_src_group_id",value:c.values.ip_src_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"ip_src_dst_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"ip_dst_group_id_label",value:"ip_dst_group_id",_type:"label2b"},{xtype:"CBX_cbIpGroups",name:"ip_dst_group_id",value:c.values.ip_dst_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]})
}a.push({items:[{xtype:"displayfield_vo3",value:"port:",_type:"label1"},{xtype:"ComboBoxA",name:"port_src_dst_type",value:c.values.port_src_dst_type||0,_type:"combolabel",aData:[[0,"src_or_dst"],[1,"src"]]},{xtype:"textfield",name:"port_src",value:c.values.port_src,_type:"fielda"},{xtype:"button",name:"port_src_dst_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"port_dst_label",value:"port_dst",_type:"label2b"},{xtype:"textfield",name:"port_dst",value:c.values.port_dst,_type:"fielda"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"number:",_type:"label1"},{xtype:"ComboBoxA",name:"number_src_dst_type",value:c.values.number_src_dst_type||0,_type:"combolabel",aData:[[0,"src_or_dst"],[1,"src"]]},{xtype:"textfield",name:"number_src",value:c.values.number_src,_type:"fielda"},{xtype:"button",name:"number_src_dst_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"number_dst_label",value:"number_dst",_type:"label2b"},{xtype:"textfield",name:"number_dst",value:c.values.number_dst,_type:"fielda"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"domain:",_type:"label1"},{xtype:"ComboBoxA",name:"domain_src_dst_type",value:c.values.domain_src_dst_type||0,_type:"combolabel",aData:[[0,"src_or_dst"],[1,"src"]]},{xtype:"textfield",name:"domain_src",value:c.values.domain_src,_type:"fielda"},{xtype:"button",name:"domain_src_dst_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"domain_dst_label",value:"domain_dst",_type:"label2b"},{xtype:"textfield",name:"domain_dst",value:c.values.domain_dst,_type:"fielda"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"ua:",_type:"label1"},{xtype:"ComboBoxA",name:"ua_src_dst_type",value:c.values.ua_src_dst_type||0,_type:"combolabel",aData:[[0,"src_or_dst"],[1,"src"]]},{xtype:"textfield",name:"ua_src",value:c.values.ua_src,_type:"fielda"},{xtype:"button",name:"ua_src_dst_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"ua_dst_label",value:"ua_dst",_type:"label2b"},{xtype:"textfield",name:"ua_dst",value:c.values.ua_dst,_type:"fieldb"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"qualify_state:",_type:"label1al"},{xtype:"ComboBoxA",name:"qualify_state",value:c.values.qualify_state,_type:"fielda",aData:[[1,"qualify_ok"],[2,"qualify_bad"]],_clearButton:true}]});
a.push({items:[{xtype:"displayfield_vo3",value:"response_duration:",_type:"label1"},{xtype:"displayfield_vo3",value:"cmp_oper_ge",_type:"label2a"},{xtype:"textfield",name:"response_duration_ge",value:c.values.response_duration_ge,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"cmp_oper_lt",_type:"label2b"},{xtype:"textfield",name:"response_duration_lt",value:c.values.response_duration_lt,_type:"fieldb"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"response_number:",_type:"label1al"},{xtype:"textfield",name:"response_number",value:c.values.response_number,_type:"fielda"}]});
if(c.modelType=="stored"){a.push({items:[{xtype:"displayfield_vo3",value:"callername:",_type:"label1al"},{xtype:"textfield",name:"callername",value:c.values.callername,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"callID:",_type:"label1al"},{xtype:"textfield",name:"callid",value:c.values.callid,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"cseq:",_type:"label1al"},{xtype:"textfield",name:"cseq",value:c.values.cseq,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"requestContentType:",_type:"label1al"},{xtype:"textfield",name:"requestContentType",value:c.values.requestContentType,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"requestContent:",_type:"label1al"},{xtype:"textfield",name:"requestContent",value:c.values.requestContent,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"responseContentType:",_type:"label1al"},{xtype:"textfield",name:"responseContentType",value:c.values.responseContentType,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"responseContent:",_type:"label1al"},{xtype:"textfield",name:"responseContent",value:c.values.responseContent,_type:"fielda",width:c.prop.fieldwWidth}]});
var f=getDataSipMsgCustomHeaders();
if(f){for(var d=0;
d<f.length;
d++){a.push({items:[{xtype:"displayfield_vo3",value:f[d].name+":",_type:"label1al"},{xtype:"textfield",name:f[d]._column_unique,value:c.values[f[d]._column_unique],_type:"fielda",width:c.prop.fieldwWidth}]})
}}}a.push({items:[{xtype:"displayfield_vo3",value:"sensor:",_type:"label1al"},{xtype:"CBX_sensor",name:"sensor_id",value:c.values.sensor_id||0,_type:"fielda",_noLabel:true,_addEmptySensorId:true,_clearButton:true}]});
for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){switch(a[d].items[b]._type){case"fielda":Ext.applyIf(a[d].items[b],{width:c.prop.fieldaWidth});
break;
case"fieldb":Ext.applyIf(a[d].items[b],{width:c.prop.fieldbWidth});
break;
case"fieldc":Ext.applyIf(a[d].items[b],{width:c.prop.fieldcWidth});
break;
case"label1":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width,style:c.prop.label1Style,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1checkbox":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width-c.prop.label1CheckboxStyle["margin-left"],style:c.prop.label1CheckboxStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1a":case"label1ap":case"label1al":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width+c.prop.label2aWidth,style:["label1a","label1ap"].isIn(a[d].items[b]._type)?c.prop.label1aStyle:c.prop.label1alStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label1ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2a":case"label2ap":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:c.prop.label2aStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label2ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2b":Ext.applyIf(a[d].items[b],{width:c.prop.label2bWidth,style:c.prop.label2bStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"label":Ext.applyIf(a[d].items[b],{fieldStyle:c.prop.labelFieldStyle});
break;
case"combolabel":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(h){var g=h.findFormPanel();
if(g){SipMsg.Filter.setContextFields(g)
}}}});
break;
case"combolabel_main":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width-(a[d].items[b]._decWidth||0),fieldStyle:{"text-align":"left",background:__color_FormBackground,border:"none","padding-left":"0px !important"},listeners:{select:function(h){var g=h.findFormPanel();
if(g){var k=g.getForm().findField("caller");
if(k){k.focus(false,200)
}SipMsg.Filter.setContextFields(g)
}},afterrender:function(g){g.inputWrap.setStyle({border:"none"})
}}});
break;
case"btnswitch":Ext.applyIf(a[d].items[b],{width:c.prop.btnSwitchWidth,border:false,style:{background:"transparent",marginTop:2,marginLeft:4,marginRight:4,height:c.prop.btnSwitchHeight},cls:"icon_arrow_switch_lr",handler:function(h){var g=h.findFormPanel();
if(g){SipMsg.Filter.switchContentFields(g,h.name)
}}});
break;
case"btnswitch_filler":Ext.applyIf(a[d].items[b],{xtype:"container",width:c.prop.btnSwitchWidth+8,border:false});
break
}}}Ext.applyIf(a[d],{xtype:"container",layout:"hbox",style:{paddingBottom:__height_FieldSeparator}})
}return(this.completeFields(a))
},completeFields:function(a){if(Ext.isArray(a)){for(var c=0;
c<a.length;
c++){this.completeFields(a[c])
}return(a)
}if(a.items){this.completeFields(a.items);
return(a)
}if(a.xtype&&a.xtype.match(/^displayfield/)&&a.value){var g=a.value;
var d=false;
if(g.match(/:$/)){g=g.substr(0,g.length-1);
d=true
}var f=findLangS(this.subsystem,"field_filter",g);
if(f){a.value=f;
if(d){a.value+=":"
}}var b=findLangS(this.subsystem,"field_filter_help",g);
if(b){a.helpText=b
}}if(a.aData){for(var c=0;
c<a.aData.length;
c++){if(Ext.isArray(a.aData[c])&&a.aData[c].length==2){var f=findLangS(this.subsystem,"field_filter",a.aData[c][1]);
if(f){a.aData[c][1]=f+(a._type=="combolabel_main"?":":"")
}}}}a.__filter="sip_msg_active";
return(a)
},fetchValuesFromFieldset:function(d){var c={};
if(d.getForm){d=d.getForm()
}var b=this.getArrayOfFields();
if(b){for(var a=0;
a<b.length;
a++){var g=this.findFilterField(d,b[a]);
if(g){var f=g.getValue();
if(Ext.isDefined(f)&&f!==""&&f!==null){c[b[a]]=g.getValue()
}}}}return(c)
},setValueFieldsFieldset:function(a,d){if(!d||!a){return
}if(d.getForm){d=d.getForm()
}var c=this.getArrayOfFields();
if(c){for(var b=0;
b<c.length;
b++){var f=this.findFilterField(d,c[b]);
if(f){f.setValue(a[c[b]])
}}}this.setContextFields(d)
},getArrayOfFields:function(c){var a=["time_from","time_to","type","ip_src","ip_dst","ip_src_dst_type","ip_src_group_id","ip_dst_group_id","ip_src_dst_group_id_type","port_src","port_dst","port_src_dst_type","number_src","number_dst","number_src_dst_type","domain_src","domain_dst","domain_src_dst_type","ua_src","ua_dst","ua_src_dst_type","qualify_state","response_duration_ge","response_duration_lt","response_number","callername","callid","cseq","requestContentType","requestContent","responseContentType","responseContent","sensor_id"];
var d=getDataSipMsgCustomHeaders();
if(d){for(var b=0;
b<d.length;
b++){a.push(d[b]._column_unique)
}}var f=this.abFields_Types();
if(f.length){a=a.concat(f)
}return(a)
},setContextFields:function(d){if(!d){return
}if(d.getForm){d=d.getForm()
}var a=this.abFields_labelContext();
for(var g in a){var f=this.findFilterField(d,g);
if(f){fieldValue=f.getValue();
if(fieldValue==null){f.setValue(0);
fieldValue=0
}for(var b=0;
b<a[g].length;
b++){if(a[g][b]){var c=this.findFilterField(d,a[g][b]);
if(c){c.setVisible(fieldValue==1)
}}}}}},switchContentFields:function(d,h){if(!d){return
}if(d.getForm){d=d.getForm()
}var g=this.abFields_switch();
if(g[h]){var c=[];
for(var b=0;
b<2;
b++){for(var a=0;
a<2;
a++){var f=this.findFilterField(d,g[h][a]);
if(b){f.setValue(c[a?0:1])
}else{c[a]=f.getValue()
}}}}},isDataSet:function(a){if(a.getForm){a=a.getForm()
}var b=this.fetchValuesFromFieldset(a);
delete b.time_from;
delete b.time_to;
return(isDataSet(b))
},findFilterField:function(c,d){if(!c){return(null)
}if(c.findField){c=c.owner
}var a=c.getItems(d,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(a[b].__filter=="sip_msg_active"){return(a[b])
}}}return(null)
},enableField:function(b,d,a){var c=this.findFilterField(b,d);
if(c){c.enableIf(a)
}},setValueField:function(a,d,b){var c=this.findFilterField(a,d);
if(c){c.setValue(b)
}},optimizeFilterItems:function(f){var h=this.abFields_typeAB();
for(var c in h){if(Ext.isDefined(f[c])){var g=h[c][0];
var d=h[c][1];
var b=h[c][2];
if(!f[g]&&!f[d]&&(!b||!f[b])){delete f[c]
}}}var a=[];
for(var c=0;
c<a.length;
c++){if(Ext.isDefined(f["f"+a[c]])&&!f["f"+a[c]]){delete f["f"+a[c]]
}}},abFields_Types:function(){var a=[];
for(var b in this.abFields){if(this.abFields[b].t){a.push(this.abFields[b].t)
}}return(a)
},abFields_labelContext:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&(this.abFields[b].sw||this.abFields[b].l&&this.abFields[b].b)){a[this.abFields[b].t]=[this.abFields[b].sw,this.abFields[b].l,this.abFields[b].b]
}}return(a)
},abFields_switch:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].sw&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].sw]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields_typeAB:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].a,this.abFields[b].b,this.abFields[b].c]
}}return(a)
},abFields:[{t:"ip_src_dst_type",a:"ip_src",b:"ip_dst",l:"ip_dst_label",sw:"ip_src_dst_switch"},{t:"ip_src_dst_group_id_type",a:"ip_src_group_id",b:"ip_dst_group_id",l:"ip_dst_group_id_label",sw:"ip_src_dst_group_id_switch"},{t:"port_src_dst_type",a:"port_src",b:"port_dst",l:"port_dst_label",sw:"port_src_dst_switch"},{t:"number_src_dst_type",a:"number_src",b:"number_dst",l:"number_dst_label",sw:"number_src_dst_switch"},{t:"domain_src_dst_type",a:"domain_src",b:"domain_dst",l:"domain_dst_label",sw:"domain_src_dst_switch"},{t:"ua_src_dst_type",a:"ua_src",b:"ua_dst",l:"ua_dst_label",sw:"ua_src_dst_switch"}],findLangS:function(a,b){return(findLangS(this.subsystem,a,b))
},getDefaultDateFrom:function(){return defaultCdrTypeInterval=="specified_days"?date((new Date).getTime()/1000-defaultCdrInterval*24*60*60):dateTimeM(getTimeInterval(defaultCdrTypeInterval)[0])
}});
Ext.define("SipMsg.Utils",{singleton:true,prepareDownloadPcap:function(a,c,b){c.prepare=true;
ajaxSafeRequest({scope:a,url:"php/pcap.php",params:c,success:function(d){if(b){b.call(a,d)
}else{downloadPrepareFileHash(d)
}},maskEl:a,timeout:30*60*1000})
}});
function isInitSipMsgSelectUrlParams(){return(window.sip_msg_active_filter?"active":window.sip_msg_filter?"stored":null)
}function clearInitSipMsgSelectUrlParams(){window.sip_msg_active_filter=null;
window.sip_msg_filter=null
}function refreshSipMsgQualify(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"refreshSipMsgQualify"},success:function(){},error:function(){}})
}Ext.ns("Message");
Ext.define("Message.GridPanel",{extend:"Ext.Panel",alias:"widget.MessageX",subsystem:"messages",constructor:function(d){var g={};
Ext.applyIf(g,{layout:"fit",border:false,region:"center",messagePanel:d.messagePanel,_panel:d._panel,suspendStdBar:true,foreignBarOwner:this,gridPanel:this});
this.grid=new Message.Grid(g);
this.idChartContainer="MESSAGES-charts-container"+(d.id?"_"+d.id:"");
if(!d.disableCharts&&user_can_graphs()){this.chartsContainer=new Ext.Panel({id:this.idChartContainer,region:"east",layout:"fit",width:"45%",border:false,collapsible:true,collapsed:true,title:this.findLangS("title","charts"),iconCls:"icon_menu_diag_system",listeners:{scope:this,expand:f,beforecollapse:a,collapse:b},floatCollapsedPanel:function(){}})
}var c=[this.grid];
if(this.chartsContainer){c.push(this.chartsContainer)
}Ext.applyIf(d,{tbar:this.grid.suspendedStdBar,layout:"border",defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:c});
this.callParent([d]);
function f(){this.dockChartsPanel();
this.createChartsPanel(this.grid.store);
if(!this.chartsContainer.items.getCount()){this.chartsContainer.add(this.chartsPanel)
}var k=this.chartsContainer.header.getTitle();
if(k.getText){k=k.getText()
}if(!k.match(/table/)){this.chartsContainer.header.setStyle({height:24,"padding-top":3,"padding-bottom":0});
this.chartsContainer.header.setTitle('<table cellspacing=0 cellpadding=0 style="position: relative; top: 0; height: 20;"><td><span class="x-panel-header-title-default">'+this.findLangS("title","charts")+'</span><td style="padding-left: 5;"><span id="messages_charts_dock_title"></span></table>');
var h=new Ext.Panel({border:false,height:19,width:500,layout:"hbox",items:[{xtype:"button",text:this.findLangS("button","undock"),height:19,border:false,style:{marginRight:2},handler:function(){this.undockChartsPanel()
},scope:this},{xtype:"button",text:this.findLangS("button","closeChart"),height:19,border:false,style:{marginRight:2},handler:function(){this.chartsPanel.maskLoad();
Ext.defer(function(){this.chartsPanel.removeAllCharts();
this.unmask();
this.chartsContainer.removeAll(true);
this.chartsPanel=null;
this.chartsContainer.collapse()
},100,this)
},scope:this},{xtype:"button",text:this.findLangS("button","addChart"),iconCls:"icon_add",height:19,border:false,handler:function(){this.chartsPanel.addChart("MESSAGES")
},scope:this}],renderTo:"messages_charts_dock_title",bodyStyle:{background:"transparent"}})
}this.setStateChartsButton()
}function b(){this.chartsContainer.setTitle(this.findLangS("title","charts"));
this.setStateChartsButton()
}function a(){this.chartsContainer.setTitle(this.findLangS("title","charts"))
}},reloadCharts:function(){if(this.chartsPanel&&this.chartsPanel.getEl&&this.chartsPanel.getEl()&&this.chartsPanel.isVisible()){this.chartsPanel.reloadCharts(true)
}},createChartsPanel:function(a){if(!this.chartsPanel){this.chartsPanel=new CDR.Chart({filtersFromParent:a.proxy.extraParams,border:false,childPanel:true,disableCreateBtnAdd:true});
this.setStateChartsButton()
}return(this.chartsPanel)
},createChartsWindow:function(){this.createChartsPanel;
this.chartsWindow=new Ext.Window({id:"MESSAGES-charts-window",title:'<table cellspacing=0 cellpadding=0 style="position: relative; top: 1; height: 19;"><td><span class="x-panel-header-title-default">'+this.findLangS("title","charts")+'</span><td style="padding-left: 5;"><span id="messages_charts_undock_title"></span></table>',layout:"fit",width:Ext.dom.Element.getViewportWidth()*9/10,height:Ext.dom.Element.getViewportHeight()*9/10,maximizable:true,modal:false,listeners:{scope:this,close:function(){this.chartsWindow.removeAll(false);
this.chartsWindow=null;
this.setStateChartsButton()
},afterrender:function(){var a=new Ext.Panel({border:false,height:19,width:500,layout:"hbox",items:[{xtype:"button",text:this.findLangS("button","dock"),height:19,border:false,style:{marginRight:2},handler:function(){this.dockChartsPanel()
},scope:this},{xtype:"button",text:this.findLangS("button","addChart"),iconCls:"icon_add",height:19,border:false,handler:function(){this.chartsPanel.addChart()
},scope:this}],renderTo:"messages_charts_undock_title",bodyStyle:{background:"transparent"}})
}}});
this.chartsWindow.show();
this.chartsWindow.add(this.chartsPanel);
this.setStateChartsButton()
},undockChartsPanel:function(){this.chartsContainer.removeAll(false);
this.chartsContainer.collapse();
this.createChartsWindow();
this.setStateChartsButton()
},dockChartsPanel:function(){if(this.chartsWindow){this.chartsWindow.removeAll(false);
this.chartsWindow.destroy();
this.chartsWindow=null;
this.chartsContainer.expand();
this.setStateChartsButton()
}},openCharts:function(){if(!this.chartsWindow&&this.chartsContainer.getState().collapsed){this.chartsContainer.expand();
this.setStateChartsButton()
}},setStateChartsButton:function(){}});
Ext.define("Message.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Message.GridX",subsystem:"messages",constructor:function(b){var d=[];
var h=[];
if(b&&b.customMenu){d=b.customMenu
}if(!b||!b.disableMenu){var g=[];
if(typeDb=="mysql"){g.push({text:this.findLangS("menu","exportCSV"),iconCls:"icon_excel",handler:this.exportToCsv,scope:this},{xtype:"menuseparator"})
}g.push({text:this.findLangS("menu","enableDns"),xtype:"menucheckitem",checked:user.sqlrow&&user.sqlrow.uc_enable_dns_message,_menuId:"enableDns"});
g.push({text:this.findLangS("menu","enableFlags"),menu:[{text:this.findLangS("menu","number"),menu:{defaults:{xtype:"menucheckitem",scope:this,handler:l},items:[{text:this.findLangS("menu","left"),_menuId:"flags_number",_value:"left"},{text:this.findLangS("menu","right"),_menuId:"flags_number",_value:"right"},{text:this.findLangS("menu","disable"),_menuId:"flags_number",_value:"disable"}],listeners:{beforeshow:function(p){for(var o=0;
o<p.items.length;
o++){var n=p.items.get(o);
n.setChecked(n._value==user.sqlrow.uc_enable_flags_message_number)
}}}}},{text:this.findLangS("menu","ip"),menu:{defaults:{xtype:"menucheckitem",scope:this,handler:l},items:[{text:this.findLangS("menu","left"),_menuId:"flags_ip",_value:"left"},{text:this.findLangS("menu","right"),_menuId:"flags_ip",_value:"right"},{text:this.findLangS("menu","disable"),_menuId:"flags_ip",_value:"disable"}],listeners:{beforeshow:function(p){for(var o=0;
o<p.items.length;
o++){var n=p.items.get(o);
n.setChecked(n._value==user.sqlrow.uc_enable_flags_message_ip)
}}}}}]});
if(existsHttpJj){g.push({text:findLangS("http","menu","showHttpJjViaExternalTransactionId"),scope:this,handler:this.showHttpJjViaExternalTransactionId})
}if(d.length){d.push("-")
}d.push({xtype:"splitbutton",scope:this,text:this.findLangS("button","filterForm"),tooltip:this.findLangS("button_help","filterForm"),iconCls:"icon_find",handler:function(){this.createFilterWindow()
},arrowCls:"link_grey",arrowHandler:this.viewUrl,listeners:{scope:this,afterrender:function(n){n.getEl().down(".x-btn-link_grey").dom.setAttribute("data-qtip",this.findLangS("button_help","viewUrl"))
}},_id:"setFilter"},{scope:this,text:this.findLangS("button","resetFilter"),tooltip:this.findLangS("button_help","resetFilter"),iconCls:"icon_find",handler:this.resetFilter,disabled:true,_id:"resetFilter"},{scope:this,text:this.findLangS("button","settings"),tooltip:this.findLangS("button_help","settings"),iconCls:"icon_wrench",_btnId:"settings",menu:{scope:this,defaults:{scope:this,handler:l},items:g,listeners:{scope:this,beforeshow:function(n){n.items.get(n.items.findIndex("_menuId","enableDns")).setChecked(user.sqlrow&&user.sqlrow.uc_enable_dns_message)
}}}},"-",{xtype:"displayfield",value:"&nbsp;"+this.findLangS("field","searchCallerCalled")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",_gridForm:this,width:110,onChangeValue:function(n){this.setFilterItemValue("callerd_type",0,n,true);
this.setFilterItemValue("callerd_search_type",3,false,true);
this.setFilterItemValue("caller",n)
},_id:"qsearch_callerd"});
var h=[this.findLangS("button","refreshInterval")+":&thinsp;",{xtype:"numberfield",width:__width_ColumnNum(4)+ +__width_Trigger,minValue:1,maxValue:9999,step:1,enableKeyEvents:true,listeners:{scope:this,change:function(n){this.setTimeoutRefreshInterval(n)
},keyup:function(o,n){this.setTimeoutRefreshInterval(o)
}},fieldStyle:{"text-align":"right"}}]
}if(b.enableTbarRibbonDateFromTo){d.push({xtype:"buttongroup",title:this.findLangS("tbar","dateTimeRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("tbar","dateTimeFrom")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:b.form_filters&&b.form_filters.calldate_from?clone(b.form_filters.calldate_from):null,_buttonGroup:true,onSetDate:function(o,n){this.setFilterItemValue("calldate_from",n)
},onSetDateScope:this},{value:this.findLangS("tbar","dateTimeTo")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:b.form_filters&&b.form_filters.calldate_to?clone(b.form_filters.calldate_to):null,_buttonGroup:true,onSetDate:function(o,n){this.setFilterItemValue("calldate_to",n)
},onSetDateScope:this}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(b.enableTbarRibbonFilterButton){d.push({xtype:"buttongroup",title:this.findLangS("tbar","menu"),columns:1,defaults:{xtype:"displayfield"},items:[{xtype:"button",text:this.findLangS("tbar","filter"),iconCls:"icon_find",handler:function(){this.createFilterWindow({disableTimeInterval:true,modal:true})
},scope:this,style:{marginTop:9,marginBottom:12}}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(b&&b.form_filters&&!b.extraParams){b.extraParams={form_filters:Ext.encode(b.form_filters)}
}var m=null;
if(!b||!b.disablePagingToolbar){m={listeners:{beforechange:function(n,o){if(o!=n.store.currentPage){n._changePage=true
}}}}
}else{if(b.enableTbarRibbonPaginator){m={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud}};
d.push({xtype:"buttongroup",title:this.findLangS("tbar","paginator"),items:m,style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}b=Ext.applyIf(b||{},{url:"php/model/sql.php",module:"message",storeId:"Message",recordStruct:rsMessage,sortField:"calldate2",sortDirection:"desc",remoteSort:true,remoteFilter:true,pageSize:b.disablePagingToolbar&&!b.enableTbarRibbonPaginator?-1:(b.pageSize||30),enableAutoLoad:false,level:1,columns:this.getColumns(b,this),columnsDefaults:{tdCls:"vertical-align-middle",sortable:false},tbar:d.length?d:undefined,paginatorBehindButtonsItems:h.length?h:undefined,prefixCls:b.module||"message"+(b&&b.level>1?"_"+(b.level-1):""),stripeRows:false,paginator:m||undefined,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Message.GridExpPanel",expandOnEnter:false,expandOnDblClick:false},"gridfilters","columnSort"],loadingText:getLoadMaskWithStopButton_loading_text("messageGrid_loadMask"),viewConfigListeners:{expandbody:function(){if(this._panel){this._panel.collapseGroup()
}},render:function(n){n.tip=Ext.create("Ext.tip.ToolTip",{target:n.el,delegate:n.cellSelector,trackMouse:true,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,listeners:{beforeshow:function o(s){var q=n.getHeaderByCell(s.triggerElement);
var t=Ext.fly(s.triggerElement).up(".x-grid-row");
if(t){var p=n.getRecord(t);
if(q&&q.dataIndex=="proxy"){var r=Ext.decode(p.data.proxy);
if(r&&r.length>4){htmlProxy=n.store._grid.renderProxy(p.data.proxy);
if(htmlProxy){htmlProxy='<div style="padding-left: 5; padding-right: 5;">'+htmlProxy+"</div>";
s.update(htmlProxy);
return
}}}}s.update(null)
}}})
}},listeners:{scope:this,afterrender:function(){if(this.gridPanel&&this.gridPanel._mainMessageTable&&isInitMessageSelectUrlParams()){if(window.messageId){this.initFilter();
if(this._panel){this._panel.setTitleMessages()
}if(messageId[0]=="["&&messageId[messageId.length-1]=="]"&&Ext.JSON.decode(messageId)){this.filters.addFilter({dataIndex:"ID",type:"string",value:Ext.JSON.decode(messageId).join(",")})
}else{this.filters.addFilter({dataIndex:"ID",type:"string",value:messageId})
}}else{this.initFilter();
c.call(this);
if(this._panel){this._panel.setTitleMessages()
}if(window.message_group_data&&this._panel&&this._panel.groupPanel){Ext.defer(function(){this._panel.groupPanel.applyGroupData();
this.reload({page:1})
},250,this)
}else{this.reload({page:1})
}this.setToolbarFilterItems()
}}else{this.initFilter();
if(this._panel){this._panel.setTitleMessages()
}this.reload({page:1})
}}},proxy_timeout:60*60*1000});
this.callParent([b]);
this.applyConfig("Message.Grid");
this.store.on("beforeload",f,this);
this.store.on("load",a,this);
this.store._params=["dir","limit","module","sort","start","task"];
this.menuTypeMessageLink=[];
if(user_can_cdr_share_local_public()){this.menuTypeMessageLink.push({text:this.findLangS("menu","localPublic"),handler:k,_menuSubId:"self_protected_link"})
}if(user_can_cdr_share_local_private()){this.menuTypeMessageLink.push({text:this.findLangS("menu","localPrivate"),handler:k,_menuSubId:"self_login_link"})
}function k(n,o,p){Message.Utils.shareMessage(n._menuId,n._menuId2,n._menuSubId,this)
}function f(){beginLoadMaskWithStopButton_store(this.store,"messageGrid_loadMask")
}function a(){endLoadMaskWithStopButton_store(this.store);
if(this._paginator){if(!this._paginator._changePage&&!loadStoreIsCancel(this.store)){if(this._panel&&this._panel.groupPanel){this._panel.groupPanel.reloadMessageStats(this,this.store)
}if(this.gridPanel&&this.gridPanel.chartsPanel){this.gridPanel.reloadCharts()
}}this._paginator._changePage=false
}}function c(){if(window.message_filter){this.form_filters=Ext.decode(window.message_filter);
for(var n in this.form_filters){switch(n){case"calldate_from":case"calldate_to":this.form_filters[n]=dateTimeStringToDate(this.form_filters[n]);
break
}}this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters)
}if(window.message_group_data&&this._panel&&this._panel.groupPanel){var o=Ext.decode(window.message_group_data);
this._panel.groupPanel.setGroupData(o)
}}function l(o){if(o._menuId=="enableDns"||o._menuId=="flags_number"||o._menuId=="flags_ip"){if(!user.sqlrow){user.sqlrow={}
}var n;
var p;
switch(o._menuId){case"enableDns":n="uc_enable_dns_message";
p=o.checked?1:0;
o.ownerCt.hide();
break;
case"flags_number":n="uc_enable_flags_message_number";
p=o._value;
o.ownerCt.ownerCmp.ownerCt.ownerCmp.ownerCt.hide();
break;
case"flags_ip":n="uc_enable_flags_message_ip";
p=o._value;
o.ownerCt.ownerCmp.ownerCt.ownerCmp.ownerCt.hide();
break
}user.sqlrow[n]=p;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setItemUserConfigSqlrow",params:Ext.encode({item:n,value:p})},success:function(q){this.reload()
},maskEl:this,deferMask:true})
}}},onStoreLoad:function(b,a,d,c){if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(ActiveModule=="MESSAGES"&&this.isVisible()&&!reloginForm&&!this._windowFilter&&!this.rowExpander.isAnyExpand()){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}},getColumns:function(d,a,m){var l=this;
var c=window.displaySensorNameCdr?"ID_sensor_name":"ID_sensor";
var f=[{headerLang:c,dataIndex:"ID",align:"center",width:50,sortable:true,filter:{type:"string"},renderer:function(s,n,o,t,r,p){if(!o.data.id_sensor&&!o.data._id_sensor){return(s)
}var q=window.displaySensorNameCdr&&o.data.sensorname?'&thinsp;<span style="font-size: 80%">'+o.data.sensorname+"</span>":"";
return'<div style = "text-align:center">'+s+"<br>"+(o.data.id_sensor?o.data.id_sensor+q:'<i style="color: grey;">'+o.data._id_sensor+"</i>")+"</div>"
}},{dataIndex:"calldate2",width:window.time_precision_message_in_ms?80:70,sortable:true,align:"center"},{dataIndex:"caller2",width:160,sortable:true,align:"center",sortBy:{caller:this.findLangS("sortBy","callerNumber"),sipcallerip:this.findLangS("sortBy","sipSourceIP")}}];
if(window.existsMessageProxy){f.push({dataIndex:"proxy",width:100,align:"center",renderer:h})
}f.push({dataIndex:"called2",width:160,sortable:true,align:"center",sortBy:{called:this.findLangS("sortBy","calledNumber"),sipcalledip:this.findLangS("sortBy","sipDestinationIP")}},{dataIndex:"lastresponse",width:80,sortable:"true",align:"center",renderer:function(s,n,p,t,r,q,o){return s+'<br><img src="images/icon/arrows_sip_history.png" style="cursor: pointer;" data-qtip="'+l.findLangS("tooltip","showSipHistory")+'" onClick="Ext.getCmp(\''+l.id+"').showSipHistory('"+p.data.ID+"');\">"
}},{dataIndex:"message_html",headerLang:"message",width:250-(d.decWidthTable||0),renderer:b},{dataIndex:"menu",width:90,align:"right",noCopyToClipboard:true,renderer:function(r,n,o,s,q,p){return r&&r.replaceall("__THIS_ID__",a.id)||"&nbsp;"
}});
var k=getDataMessageCustomHeaders();
if(k){for(var g=0;
g<k.length;
g++){if(k[g].show_as_column*1){f.push({dataIndex:k[g]._column_unique,header:k[g].name,width:k[g].width_column*1||100,renderer:function(n){return(renderStringStyle(n,{forceMultiLine:true}))
},sortable:true})
}}}for(var g=0;
g<f.length;
g++){f[g].header=this.findLangS("column",f[g].headerLang||f[g].dataIndex)||f[g].header
}if(m&&this.plugins){for(var g=0;
g<this.plugins.length;
g++){if(this.plugins[g].ptype=="rowexpander"){f.splice(0,0,this.plugins[g].getHeaderConfig());
break
}}}return(f);
function b(t,o,p,r,w,u,s){if(t&&t.search&&t.replaceall){var q=t.search("_INF:URL");
if(q>0){url=t.substr(0,q);
url='<a href="'+url+'" target="_blank">'+url+"</a>";
return(url)
}var n=false;
if(t.length>500){t=t.substr(0,500);
n=true
}t=t.replaceall("&amp;","&");
valueA=t.split("\n");
var v=null;
if(valueA[valueA.length-1].match(/^_INF\:/)){v=valueA.splice(valueA.length-1,1)
}while(valueA.length>5){valueA.splice(valueA.length-1,1);
n=true
}t=valueA.join("<br>");
if(n){t=t+"..."
}t='<div style="word-wrap: break-word; white-space: normal;">'+t;
if(v){if(valueA.length){t+="<br>"
}t+="<i>"+v[0].replace("_INF:","").replaceall("|","<br>")+"</i>"
}t+="</div>"
}return(t)
}function h(s,p,o,t,r,q,n){return(q._grid.renderProxy(s,4))
}},reconfigureColumns:function(){var a=this.getColumns(this,this,true);
this.reconfigure(this.store,a);
this.applyConfig()
},createFilterWindow:function(f){this._windowFilter=true;
var b=Ext.applyIf(f||{},{values:this.form_filters||{}});
var g=Message.Filter.getFieldset(b);
var d=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,layout:"fit",items:{xtype:"container",items:g},buttons:[{scope:this,text:this.findLangS("button","search"),iconCls:"icon_find",handler:a},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){c.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",d.el,{enter:a,scope:this});
Message.Filter.setContextFields(d)
}},width:710+__width_Scroller+4,style:{padding:5}});
var c=new Ext.Window({scope:this,iconCls:"icon_find",title:this.findLangS("title","searchForm"),closable:true,border:false,plain:true,layout:"fit",modal:f&&f.modal,items:d,formPanelForAutoAdjustSize:d,listeners:{scope:this,activate:function(){if(!c.activated){var h=d.getForm().getFields();
var k=null;
for(var l=0;
l<h.getCount();
l++){var m=h.getAt(l);
if(!(m instanceof Ext.form.DisplayField)&&m.name!="callerd_search_type"&&m._type!="combolabel"){k=m;
break
}}if(k){k.focus(false,500)
}c.activated=true
}},destroy:function(){this._windowFilter=false
}}});
c.show();
function a(){if(d.getForm().isValid()){var h={};
if(f&&f.disableTimeInterval&&this.enableTbarRibbonDateFromTo){Ext.applyIf(h,{calldate_from:this.getFilterItemValue("calldate_from"),calldate_to:this.getFilterItemValue("calldate_to")})
}Ext.applyIf(h,Message.Filter.fetchValuesFromFieldset(d));
this.setFilter(h);
c.destroy()
}}},initFilter:function(){if(!this.disableMenu){this.form_filters={};
this.form_filters.calldate_from=Message.Filter.getDefaultDateFrom();
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters)
}},setFilter:function(a){this.form_filters=a;
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
this.reload({page:1});
this.setToolbarFilterItems()
},getFilterItemValue:function(a){return(this.form_filters&&this.form_filters[a]||null)
},setFilterItemValue:function(b,d,c,a){if(d||d===0&&c){if(!this.form_filters){this.form_filters={}
}this.form_filters[b]=d;
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
if(!a){this.reload({page:1})
}}else{if(this.form_filters){delete this.form_filters[b];
if(!isDataEmpty(this.form_filters)){if(!a){this.resetFilter()
}}else{this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
if(!a){this.reload({page:1})
}}}}if(!a){this.setToolbarFilterItems()
}},resetFilter:function(){this.initFilter();
this.reload({page:1});
this.enableBtn("resetFilter",false);
this.setToolbarFilterItems()
},isFilterEmpty:function(){if(!this.form_filters||!this.form_filters.calldate_from){return(false)
}var b=cloneObject(this.form_filters);
Message.Filter.optimizeFilterItems(b);
for(var a in b){if(a!="calldate_from"||!b.calldate_from.getTime||b.calldate_from.getTime()!=Message.Filter.getDefaultDateFrom().getTime()){return(false)
}}return(true)
},reload:function(a){if(a&&a.page){this.store.currentPage=a.page;
Ext.apply(a,{start:(a.page-1)*this.store.pageSize})
}this.store.load(a);
if(this._panel){this._panel.setTitleMessages()
}},setToolbarFilterItems:function(){this.setToolbarFieldValue("qsearch_callerd",this.form_filters&&!this.form_filters.callerd_type?this.form_filters.caller:"");
this.enableBtn("resetFilter",!this.isFilterEmpty())
},getSelectParams:function(){var b={};
for(var a in this.store.proxy.extraParams){if(this.store._params.indexOf(a)<0){b[a]=this.store.proxy.extraParams[a]
}}return b
},setGroupSelect:function(d,c,a,b){this.clearGroupSelect();
this.store.proxy.extraParams["group_"+d+(c?"_"+c:"")]=a;
if(b){this.reload({page:1})
}},setGroupSelectByDataRecord:function(d,c,a,b){this.setGroupSelect(d,c,a[d],b)
},clearGroupSelect:function(c,a){var d=false;
for(var b in this.store.proxy.extraParams){if(b.match&&b.match(/^group_.*/)&&!Ext.isEmpty(this.store.proxy.extraParams[b])){this.store.proxy.extraParams[b]=null;
d=true
}}if(d){if(c){this.reload()
}if(a&&this._panel){this._panel.deselectAllGroupSelects()
}return true
}return false
},setGroupFilter:function(b,d,a,c){if(b.match(/^groupfilter_/)){b=b.substr(12)
}if(c&&b.match(new RegExp("^groupfilterL"+c+"_"))){b=b.substr(14)
}this.store.proxy.extraParams["groupfilter"+(c?"L"+c:"")+"_"+b]=d;
if(!a){this.reload({page:1})
}},isSetGroupFilter:function(b){for(var a in this.store.proxy.extraParams){if(Ext.isString(a)&&Ext.isDefined(this.store.proxy.extraParams[a])&&this.store.proxy.extraParams[a]!==""&&this.store.proxy.extraParams[a]!==null&&a.match(b?new RegExp("^groupfilterL"+b+"_.*"):/^groupfilter_.*/)){return true
}}return false
},clearGroupFilter:function(b){for(var a in this.store.proxy.extraParams){if(a.match&&a.match(b?new RegExp("^groupfilterL"+b+"_.*"):/^groupfilter_.*/)){this.store.proxy.extraParams[a]=null
}}if(!b){this.clearGroupFilter(2);
if(this._panel){this._panel.deselectAllGroupFilters()
}}},doDownloadPcap:function(b,a){Message.Utils.prepareDownloadPcap(this,b,function(c){if(a){var d=new Tools.AuditForm({messageId:b,activity:_AuditActivity_download_pcap,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(c,300)
},fceCancel:function(){unlinkPrepareFileHash(c)
},fceContinueScope:this});
d.audit()
}else{downloadPrepareFileHash(c)
}})
},doShareMessage:function(b,a,c){if(this.menuTypeMessageLink.length){var d=new Ext.menu.Menu({items:[{text:this.findLangS("menu","showLink"),iconCls:"icon_magnifier",handler:this.menuTypeMessageLink.length==1?this.menuTypeMessageLink[0].handler:undefined,_menuSubId:this.menuTypeMessageLink.length==1?this.menuTypeMessageLink[0]._menuSubId:undefined,_menuId:"share_message_show",scope:this,menu:this.menuTypeMessageLink.length>1?{defaults:{_menuId:"share_message_show",scope:this},items:cloneArray(this.menuTypeMessageLink)}:undefined},{text:this.findLangS("menu","sendLinkViaEmail"),iconCls:"icon_email_send",handler:this.menuTypeMessageLink.length==1?this.menuTypeMessageLink[0].handler:undefined,_menuSubId:this.menuTypeMessageLink.length==1?this.menuTypeMessageLink[0]._menuSubId:undefined,_menuId:"share_message_send",scope:this,menu:this.menuTypeMessageLink.length>1?{defaults:{_menuId:"share_message_send",scope:this},items:cloneArray(this.menuTypeMessageLink)}:undefined}]});
d.showAtMouse(c)
}else{Ext.Msg.alert("",this.findLangS("text","sharingIsNotPermitted"))
}},onMergePcapSipHistory:function(h,k,g,b,c){var a=0;
var d=null;
if(g=="select"){var l=this.selModel.getSelection();
if(l){a=l.length
}if(!a){Ext.Msg.alert(this.findLangS("title","msgZeroMessagesForTicket"),this.findLangS("text","msgZeroMessagesForTicket"));
return
}if(!b&&a>10){Ext.Msg.confirm(this.findLangS("title","msgTooMuchMessagesForTicket"),this.findLangS("text","msgTooMuchMessagesForTicket1")+" "+a+" "+this.findLangS("text","msgTooMuchMessagesForTicket2"),function(m){if(m=="yes"){this.onMergePcapSipHistory(h,k,g,true,c)
}},this);
return
}d=[];
for(var f=0;
f<l.length;
f++){d.push(l[f].data.ID)
}}else{if(g=="array"){d=k;
k=null
}}Tools.Pcaps.mergePcap({message:true,masterMessageId:k,selectedId:d,filter:g=="filter"?this.store.proxy.extraParams:null,rtp:h=="pcaprtp",with_http:true,downloadPcap:h=="pcap"||h=="pcaprtp",onSuccess:function(){if(h=="pcap"||h=="pcaprtp"){var m=arguments[0];
downloadPrepareFileHash(m)
}else{var o=arguments[0];
var n=Ext.Date.format(new Date,__format_DateTimeDb);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"mergeSipHistory",params:Ext.encode({mergeUniqueKey:o,uniquekey:n})},success:function(p){new Message.SipHistoryWithDiagramPanel({messageId:"multi",autoOpenWindow:true,windowTitle:this.findLangS("title","sipHistory_merge"),sipHistoryConfig:{initStoreData:p.results,uniquekey:n},diagramConfig:{uniquekey:n},_mergeParams:{message:true,masterMessageId:k,selectedId:d,filter:g=="filter"?this.store.proxy.extraParams:null,rtp:h=="pcaprtp",with_http:true,uniquekey:n},disableSvgPaint:c&&c.disableSvgPaint})
},maskEl:this})
}},onSuccessScope:this,maskElId:this.id})
},exportToCsv:function(a){formPostSafe("php/model/sql.php","POST",{module:"message",task:"CSV",dummy:new Date()})
},viewUrl:function(){var f=window.location.origin+window.location.pathname;
var d={};
var c=Message.Filter.getArrayOfFields();
for(var b in this.form_filters){if(Ext.isString(b)&&c.inArray(b)&&Ext.isDefined(this.form_filters[b])&&this.form_filters[b]!==null&&this.form_filters[b]!==""){d[b]=this.form_filters[b]
}}var a={};
if(this._panel&&this._panel.groupPanel){a=this._panel.groupPanel.getGroupData()
}if(!isDataEmpty(d)||!isDataEmpty(a)){f+="?"
}if(!isDataEmpty(d)){Message.Filter.optimizeFilterItems(d);
f+="message_filter="+encodeURIjson(Ext.encode(d))
}if(!isDataEmpty(a)){if(!isDataEmpty(d)){f+="&"
}f+="message_group_data="+encodeURIjson(Ext.encode(a))
}var g='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+f+'" target="_blank">'+f+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(findLangS(this.subsystem,"title","viewUrl"),g,function(){var h=Ext.getCmp("copy_button");
if(h){h.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(h){return(h.clipboardText)
},getClipTextParams:{clipboardText:f},id:"copy_button",renderTo:"copy_button_div"})
},showHttpJjViaExternalTransactionId:function(){new HTTP.ViewHttp({_window:true})
},renderProxy:function(d,a){rsltValue=null;
if(d){var c=Ext.decode(d);
if(c&&c.length){rsltValue="";
for(var b=0;
b<(a?Math.min(a,c.length):c.length);
b++){if(rsltValue){rsltValue+="<br>"
}rsltValue+=c[b][0];
if(c[b].length>1&&c[b][1]){rsltValue+="<br><i>"+c[b][1]+"</i>"
}}if(a&&c.length>a){rsltValue+="<br><b>...</b>"
}}}return(rsltValue)
},showSipHistory:function(a){new Message.SipHistoryWithDiagramPanel({messageId:a,autoOpenWindow:true,windowTitle:this.findLangS("title","sipHistory")})
}});
Ext.define("Message.SummaryPanel",{extend:"Ext.Panel",alias:"widget.Message_summaryPanel",subsystem:"messages",constructor:function(b){var g=847;
if(b.record&&b.record.data.menu_pcap){b.record.data.menu_pcap=b.record.data.menu_pcap.replaceall("__THIS_ID__",b.grid?b.grid.ownerCt.id:b.id)
}var c="";
var h=getDataMessageCustomHeaders();
if(h){for(var d=0;
d<h.length;
d++){if(b.record.data[h[d]._column_unique]){c+='<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+g+'px;"><thead><tr><th style="text-align: left;">'+h[d].name+'</th></tr></thead><tbody><tr><td><div style="width: '+(g-10)+'px; word-wrap: break-word;white-space: normal;">'+htmlEncode(b.record.data[h[d]._column_unique])+"</div></td></tr></tbody></table>"
}}}var f="";
if(b.record.data.proxy){var k=Ext.decode(b.record.data.proxy);
if(k&&k.length){f="<table>";
for(var d=0;
d<k.length;
d++){f+='<tr><td style="padding: 0;">'+k[d][0];
if(k[d].length>1&&k[d][1]){f+='<td style="padding: 0; padding-left: 5;"><i>'+k[d][1]+"</i>"
}}f+="</table>"
}}var l=new Ext.Template('<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-right: 4px;">',"<thead><tr>","<th>Start","<th>Last SIP response","<th>Caller","<th>Called","<th>SIP IP Caller","<th>SIP IP Called",(b.enableDownloadPcap&&b.record.data.menu_pcap?"<th>PCAP":""),"</tr></thead>","<tbody><tr>","<td>{calldate}","<td>{sipresponse}","<td>{caller_with_domain}","<td>{called_with_domain}","<td>{sipcallerip}","<td>{sipcalledip}",(b.enableDownloadPcap&&b.record.data.menu_pcap?"<td>"+b.record.data.menu_pcap:""),"</tr></tbody>","</table>",window.existsMessageProxy&&b.record.data.proxy?'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+g+'px; table-layout: fix;"><thead><tr><th>Proxy IP</tr></thead><tbody><tr><td>'+f+"</tr></tbody></table>":"",'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+g+'px; table-layout: fix;">',"<col width=50%>","<col width=50%>","<thead><tr>","<th>User Agent Caller","<th>User Agent Called","</tr></thead>","<tbody><tr>","<td>{a_ua}","<td>{b_ua}","</tr></tbody>","</table>",'<table border="0">',"<tr><td>",'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+g+'px;">','<thead><tr><th style="text-align: left;">CALL ID</th></tr></thead>',"<tbody><tr><td>","{fbasename_orig}","</td></tr></tbody>","</table>","<tr><td>",'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+g+'px;">',"<col width=50%>","<col width=50%>","<thead><tr>","<th>Content-type","<th>Content-length","</tr></thead>","<tbody><tr>","<td>{contenttype}","<td>",b.record.data.content_length||"","</tr></tbody>","</table>",c,'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; width: '+g+'px;">','<thead><tr><th style="text-align: left;">MESSAGE</th></tr></thead>',"<tbody><tr><td>",'<div id="msg_content_'+b.record.data.ID+'" style="font-size: 120%; word-wrap: break-word; width: '+(g-10)+';">',a(b.record.data.message_html),"</div>","</td></tr></tbody>","</table>","</td></tr>",'<tr style="height: 4px;"></tr>',"</table>");
Ext.applyIf(b,{title:this.findLangS("title","summaryTab"),html:l.applyTemplate(b.record&&b.record.data||{}),iconCls:"icon_table_lightning"});
this.callParent([b]);
if(b.record.data.message_html&&b.record.data.message_html.search&&b.record.data.message_html.search("_INF:concatenated message")>0){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"findAllPartsMessage",params:Ext.encode({id:b.record.data.ID})},success:function(m){if(m.ok){var p="";
for(var o in m.parts){if(o>1){p+="<br>"
}p+=a(m.parts[o][0],m.parts[o][1]==b.record.data.ID)
}var n=Ext.get("msg_content_"+b.record.data.ID);
if(n){n.dom.innerHTML=p
}}debug_log(m)
}})
}function a(q,p){if(q&&q.search&&q.replaceall){q=q.replaceall("&amp;","&");
var r=q.search("_INF:URL");
if(r>0){url=q.substr(0,r);
url='<a href="'+url+'" target="_blank">'+url+'<br><img src="'+url+'" style="height:200px;"></a>';
return(url)
}else{q=q.replaceall("\n","<br>").replaceall("|","<br>");
for(var o=0;
o<2;
o++){var m="_INF:"+(o==0?"concatenated message:":"");
var n='<i style="font-size: 8pt;">'+(o==0?"part:":"");
var s=q.search(m);
if(s>=0){q=(p?"<b>":"")+q.replace(m,(s>0&&q.substr(s-4,4)!="<br>"?"<br>":"")+(p?"</b>":"")+n)+"</i>"
}}}}return(q)
}},doDownloadPcap:function(b,a){Message.Utils.prepareDownloadPcap(this,b,function(c){if(a){var d=new Tools.AuditForm({messageId:b,activity:_AuditActivity_download_pcap,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(c,300)
},fceCancel:function(){unlinkPrepareFileHash(c)
},fceContinueScope:this});
d.audit()
}else{downloadPrepareFileHash(c)
}})
}});
Ext.define("Message.SipHistoryPanel",{extend:"Ext.ux.grid.GridForm",alias:"widget.Message_sipHistoryPanel",subsystem:"messages",constructor:function(d){var k=[];
a();
var f=0;
var c={};
var b={action:"brief_data"};
this.packetDetailBaseParams={};
if(d){if(d.messageId){b.msg=1;
b.id=d.messageId;
this.packetDetailBaseParams.message=true;
this.packetDetailBaseParams.id=d.messageId
}else{if(d.sipMsgId){b.sip_msg=1;
b.id=d.sipMsgId;
this.packetDetailBaseParams.sip_msg=true;
this.packetDetailBaseParams.id=d.sipMsgId
}}if(d.uniquekey){b.uniquekey=d.uniquekey;
this.packetDetailBaseParams.uniquekey=d.uniquekey
}}this.widthIpColumn=31;
this.heightIpColumn=95;
this.verticalTextViaSvg=Ext.ieVersion>=11;
d=Ext.applyIf(d||{},{storeId:d.messageId?"Message_tshark_"+d.messageId:d.sipMsgId?"SipMsg_tshark_"+d.sipMsgId:undefined,url:"php/pcap2text.php?"+Ext.urlEncode(b),recordStruct:rsMessage_tshark,sortField:"time",columns:this.getColumns(null,d),columnsDefaults:{sortable:false},stripeRows:false,disableInsertButton:true,disableEditButton:true,disableDeleteButton:true,fullColumnSize:"msg",fullColumnSizeDecrement:2,getRowClass:h,viewConfigListeners:{scope:this,itemmouseenter:this.onMouseEnter,itemmouseleave:this.onMouseLeave},titleLang:"sipHistoryTab",enableColumnMove:false});
this.callParent([d]);
this.on("columnhide",this.onColumnHide,this);
this.on("columnshow",this.onColumnShow,this);
this.on("afterlayout",this.onAfterLayout,this);
this.store.on("load",this.onLoad,this);
function h(l,o,n,m){return(addBackgroundColorRuleToStyleSheet(rgbToHex(hsvToRgb(g(l.data.srcip,l.data.dstip),24,100)),"x-grid-cell"))
}function a(){var n=360;
var l=8;
var m=n/l;
while(k.length<1000){var p=parseInt(Math.random()*n);
for(var o=0;
o<l;
o++){hue=p+o*m;
if(hue>=n){hue-=n
}k.push(hue)
}}}function g(m,l){if(!Ext.isDefined(c[m+l])&&!Ext.isDefined(c[l+m])){c[m+l]=k[f];
if(f<k.length-1){++f
}else{f=0
}}return(Ext.isDefined(c[m+l])?c[m+l]:c[l+m])
}},getColumns:function(b,h){if(!h){h=this
}var d=[{headerLang:"time_s",dataIndex:"time",widthNum:10,align:"right",sortable:true,renderer:g,menuDisabled:true,height:this.heightIpColumn}];
if(this.ip&&this.ip.length){for(var c=0;
c<this.ip.length;
c++){d.push({header:this.ip[c],width:this.widthIpColumn,align:"left",sortable:false,ip:this.ip[c],ipIndex:c,renderer:f,menuText:this.ip[c]+(this.hostnames[this.ip[c]]?" - "+this.hostnames[this.ip[c]]:""),menuDisabled:!h._enableIpColumnsHide})
}}else{d.push({dataIndex:"srcip",widthCh:14,menuDisabled:true},{dataIndex:"direction",widthCh:8,align:"center",menuDisabled:true},{dataIndex:"dstip",widthCh:14,menuDisabled:true})
}d.push({xtype:"actioncolumn",headerLang:"sipMsg",dataIndex:"msg",widthCh:80,rendererBase:a,items:[{getClass:function(k,l,m){return("icon_magnifier")
},handler:function(l,q,k,m,n){var o=l.store.getAt(q);
var p=cloneObject(this.packetDetailBaseParams);
Ext.apply(p,{num:o.data.num,find_pass:o.data.find_pass,search:l.store.proxy.extraParams.search,type_packets:l.store.proxy.extraParams.type_packets,spec_type:o.data.spec_type});
if(o.data.type=="http_jj"){showHttp_jjDetail(p,"HTTP detail")
}else{if(o.data.type=="webrtc"){showWebrtcDetail(p,"WEBRTC detail")
}else{if(o.data.type=="enum_jj"){showPacketDetailEnum(p,this.findLangS("title","packetDetail"))
}else{showPacketDetail(p,this.findLangS("title","packetDetail"),false,o.data.protocol&&o.data.protocol.match(/SKINNY/))
}}}},enableHandler:function(k,l,m){return(true)
},scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20",menuDisabled:true});
for(var c=0;
c<d.length;
c++){d[c].header=(d[c].headerLang||d[c].dataIndex)&&this.findLangS("column",d[c].headerLang||d[c].dataIndex)||d[c].header;
if(d[c].ip){d[c].header=this.getHeaderIpText(d[c].ipIndex)
}}return(d);
function g(p,m,l,q,o,n,k){return(formatNumber(p,6))
}function a(p,m,l,q,o,n,k){m.style="padding-left: 2";
return(p)
}function f(w,l,p,u,z,y,v){columnWidth=31;
l.style="padding: 0";
var s=this.ip.indexOf(p.data.srcip);
var r=this.ip.indexOf(p.data.dstip);
var k=s>r;
var t=k?r:s;
var q=k?s:r;
var o=p.data.type=="rtp"?"red":p.data.type=="request"?"blue":"black";
var n=null;
var m=null;
if(z-1>t&&z-1<q){n="images/arrow2_"+columnWidth+"x21-SH-L-"+o+".png"
}else{if(z-1==t){n=k?"images/arrow2_"+columnWidth+"x21-SH-LT-"+o+".png":"images/arrow2_"+columnWidth+"x21-SH-RF-"+o+".png";
m=k?p.data.dstport:p.data.srcport
}else{if(z-1==q){n=k?"images/arrow2_"+columnWidth+"x21-SH-LF-"+o+".png":"images/arrow2_"+columnWidth+"x21-SH-RT-"+o+".png";
m=k?p.data.srcport:p.data.dstport
}else{n="images/arrow2_"+columnWidth+"x21-SH-B.png"
}}}w='<div style="background-image: url('+n+'); height: 20;">'+(m?'<table style="margin-left: auto; margin-right: auto;"><tr><td style="font-size: 50%; color: #707070;">'+m+"</td></tr></table>":"")+"</div>";
return(w)
}},onLoad:function(b,a,h,f){if(this._enableIpColumnsHide){var g=this.getWiresharkFilterCmp();
if(g){var d=g.getValue();
if(!d||d!=this.getColumnsWiresharkFilter(true)){delete this.hideIp
}}}this.ip=[];
this.hostnames=[];
if(a&&a.length){for(var c=0;
c<a.length;
c++){if(!this.ip.isIn(a[c].data.srcip)){this.ip.push(a[c].data.srcip)
}if(!this.ip.isIn(a[c].data.dstip)){this.ip.push(a[c].data.dstip)
}}if(this.ip.length){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getHostnames",params:Ext.encode({ip:this.ip,msg:true,dns_lookup:(!user.sqlrow||user.sqlrow.uc_enable_dns_message)})},success:function(k){this.hostnames=k.hostnames;
this.setGrid(b,a)
},maskEl:this,deferMask:true});
return
}}this.setGrid(b,a)
},setGrid:function(b,a){if(a&&a.length>30){this.setHeight(600);
this.fullColumnSizeDecrementScroller=true;
this.fullColumnSizeDecrement=0
}var c=this.getColumns(a);
this.setColumns(c);
this.adjustFullColumnSize()
},onAfterLayout:function(){this.headerCt.items.each(function(a){if(a.ip){var c=a.el.down("div");
if(c){c.setStyle({padding:0,margin:0,width:this.widthIpColumn,height:this.heightIpColumn})
}var b=a.el.down("span");
if(b){b.setStyle({display:"block",padding:0,margin:0,width:this.widthIpColumn,height:this.heightIpColumn})
}}})
},getHeaderIpText:function(b,a){var c=this.ip[b];
if(!a){a="black"
}return(this.verticalTextViaSvg?'<table style="width:'+(this.widthIpColumn)+"; height: "+(this.heightIpColumn)+';"><tr><td style="width:'+(this.widthIpColumn)+"; height: "+(this.heightIpColumn)+';"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+this.widthIpColumn+" "+(this.heightIpColumn)+'"><text font-family="tahoma,arial,verdana,sans-serif" font-weight="normal" font-size="11px" style="fill:'+a+'" transform="translate('+(this.widthIpColumn-8)+","+(this.heightIpColumn-6)+')rotate(-90)">'+c+"</text></td></tr></table>":(this.hostnames&&this.hostnames[c]?this._getHeaderIpText_ip_hostname(c,this.hostnames[c],a):this._getHeaderIpText_ip(c,a)))
},_getHeaderIpText_ip:function(d,b){var c=2;
var a=8;
return('<div style="-webkit-transform: rotate(-90deg);-moz-transform: rotate(-90deg); -o-transform: rotate(-90deg); margin-top: '+(this.heightIpColumn-this.widthIpColumn+a-c)+'px; white-space: nowrap;"><p style="padding: 0; margin: 0; text-align: center; width: '+(this.heightIpColumn)+"px; padding-left: "+(c)+"px; color: "+b+';">'+d+"</p></div>")
},_getHeaderIpText_ip_hostname:function(f,b,c){var d=2;
var a=-2;
return('<div style="-webkit-transform: rotate(-90deg);-moz-transform: rotate(-90deg); -o-transform: rotate(-90deg); margin-top: '+(this.heightIpColumn-this.widthIpColumn+a-d)+'px; white-space: nowrap;"><p style="padding: 0; margin: 0; text-align: center; width: '+(this.heightIpColumn)+"px; padding-left: "+(d)+"px; padding-right: "+(d)+"px; color: "+c+';">'+f+'</p><p style="padding: 0; margin: 0; text-align: center; width: '+(this.heightIpColumn)+"px; margin-top: -4px; padding-bottom: 1px; padding-left: "+(d)+"px; font-weight: bold; font-size: 90%; color: "+c+';">'+b+"</p></div>")
},setHeaderIpText:function(d,b){if(Ext.isString(d)&&this.ip){d=this.ip.indexOf(d);
if(d<0){return
}}var a=this.headerCt.items.get(d+1);
if(a){var c=a.el.down("span");
if(c){c.dom.innerHTML=this.getHeaderIpText(d,b)
}}},setHeaderSipMsg:function(a){var b=null;
for(var c=0;
c<this.headerCt.items.getCount();
c++){if(this.headerCt.items.get(c).dataIndex=="msg"){b=this.headerCt.items.get(c);
break
}}if(!b){return
}var d=b.el.down("span");
var d=b.el.down("span");
if(d){var f=this.findLangS("column","sipMsg");
if(a){f+='<table style="font: '+__font_Grid+'; margin-left: 5px;"><tr><td style="font-style: italic;">'+this.findLangS("column","srcip")+':</td><td style="padding-left: 10px;">'+a.data.srcip+(a.data.srcport?" : "+a.data.srcport:"")+'</td><td style="padding-left: 10px;">'+(this.hostnames&&this.hostnames[a.data.srcip]||"")+'</td></tr><tr><td style="font-style: italic;">'+this.findLangS("column","dstip")+':</td><td style="padding-left: 10px;">'+a.data.dstip+(a.data.dstport?" : "+a.data.dstport:"")+'</td><td style="padding-left: 10px;">'+(this.hostnames&&this.hostnames[a.data.dstip]||"")+"</td></tr></table>"
}d.dom.innerHTML=f
}},onMouseEnter:function(b,a){this.setHeaderIpText(a.data.srcip,"red");
this.setHeaderIpText(a.data.dstip,"red");
this.setHeaderSipMsg(a)
},onMouseLeave:function(b,a){this.setHeaderIpText(a.data.srcip,"black");
this.setHeaderIpText(a.data.dstip,"black");
this.setHeaderSipMsg()
},onColumnHide:function(b,a){if(this._enableIpColumnsHide&&a.ip){if(!this.hideIp){this.hideIp={}
}this.hideIp[a.ip]=true;
this.setWiresharkFilter()
}},onColumnShow:function(b,a){if(this._enableIpColumnsHide&&this.hideIp&&a.ip){this.hideIp[a.ip]=false;
delete this.hideIp[a.ip];
this.setWiresharkFilter()
}},setWiresharkFilter:function(){var a=this.getWiresharkFilterCmp();
if(a){if(this.getColumnsWiresharkFilter()){if(!Ext.isDefined(this.wiresharkFilterBase)){this.wiresharkFilterBase=a.getValue()||""
}a.setValue(this.getColumnsWiresharkFilter(true));
a.onSearch()
}else{if(this.wiresharkFilterBase){a.setValue(this.wiresharkFilterBase);
a.onSearch()
}else{a.onClear()
}}}},getColumnsWiresharkFilter:function(a){var b=[];
for(var c in this.hideIp){b.push("not(ip.addr=="+c+")")
}ips=b.join(" and ");
if(b.lengt>1){ips="( "+ips+" )"
}if(a&&this.wiresharkFilterBase){ips=this.wiresharkFilterBase+" and "+ips
}return(ips)
},getWiresharkFilterCmp:function(){if(this.ownerCt&&this.ownerCt.ownerCt){var a=this.ownerCt.ownerCt;
var b=a.getTopToolbar&&a.getTopToolbar();
if(b){return(b.findC("name","filter"))
}}return(null)
}});
Ext.define("Message.SipHistoryWithDiagramPanel",{extend:"Ext.Panel",subsystem:"messages",constructor:function(d){this.origConfig=cloneObject(d||{});
this.sipHistory=new Message.SipHistoryPanel(Ext.applyIf(d&&d.sipHistoryConfig||{},{messageId:d.messageId,border:false,title:this.findLangS("title","messagesTab"),extraParams:{search:d._search,type_packets:d._type_packets},listeners:{scope:this,afterrender:function(){if(!d.enableAutoLoadSipHistory){if(!d.autoOpenWindow){gridEmptyInfo(this.sipHistory)
}this.sipHistory.store.load()
}}},fullColumnSizeDecrement:0,fullColumnSizeDecrementScroller:d&&d.autoOpenWindow,enableAutoLoad:!!d.enableAutoLoadSipHistory,_enableIpColumnsHide:true}));
this.sipHistory.store.on("load",function(n){gridEmptyInfo(this.sipHistory)
},this);
this.diagramUrl="php/pcap2text.php?action=getMSC&msg=1&&id="+d.messageId+(d.autoOpenWindow?"&undock=1":"")+(d.diagramConfig&&d.diagramConfig.uniquekey?"&uniquekey="+d.diagramConfig.uniquekey:"")+(!user.sqlrow||user.sqlrow.uc_enable_dns_message?"&dns_lookup=1":"");
this.diagram=new Ext.Panel({loader:{url:this.diagramUrl+(d._search?"&search="+encodeURIComponent(d._search):"")+(d._type_packets?"&type_packets="+encodeURIComponent(d._type_packets):""),loadMask:true,success:function(){if(this.height){delete this.height;
this.updateLayout()
}}},border:false,overflowY:d&&(d.autoOpenWindow||d.enableScrollers)?"auto":undefined,overflowX:d&&(d.autoOpenWindow||d.enableScrollers)?"auto":undefined,title:this.findLangS("title","diagramTab"),listeners:{scope:this,afterrender:function(){this.diagram.ajaxSafeLoad()
}},height:50});
this.sipHistoryWithDiagramContainer=new Ext.TabPanel({activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,items:[this.sipHistory,this.diagram],cls:"panel-background-color",style:{"background-color":"#EFEFEF"},tabBar:{renderTpl:__tpl_simplyTabPanel}});
var h=[];
h.push({xtype:"button",iconCls:"icon_reload",handler:function(){this.sipHistory.reload();
if(this.diagram){this.diagram.loader.load()
}},scope:this},{xtype:"displayfield",fieldCls:"x-form-item-label",fieldStyle:{paddingTop:0,marginTop:-1,color:"chocolate"},_id:"reload_info"},"-");
if(!d.autoOpenWindow&&!d.disableUndock){h.push({text:this.findLangS("button","undock"),scope:this,handler:a},"-")
}h.push({xtype:"displayfield",value:this.findLangS("button","wiresharkFilter")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",name:"filter",value:d._search,_gridForm:this,_buttonGroup:true,onChangeValue:f,scope:this,width:__width_ColumnChar(35)});
h.push({xtype:"displayfield",value:this.findLangS("button","typePackets")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",name:"type_packets",value:d._type_packets||"ALL",_gridForm:this,_buttonGroup:true,multiSelect:true,aData:[["sip","sip"],["http","http"],["web","web"]],textAliasAll:"ALL",_arraySeparator:",",_stringValue:true,listeners:{select:function(n){k.call(this,n.getValue())
},scope:this},width:__width_ColumnChar(15)});
if(user_can_pcap()){h.push("-",{text:this.findLangS("button","downloadPCAP"),iconCls:"icon_save",scope:this,handler:g})
}if(window.enableSvgPaint&&!d.disableSvgPaint){h.push("-",{text:this.findLangS("button","prepareSvgDiagram"),scope:this,handler:c})
}d=Ext.applyIf(d,{border:false,tbar:d.disableTbar?undefined:h,layout:"fit",items:[this.sipHistoryWithDiagramContainer],listeners:{scope:this,destroy:function(){if(this._mergeParams&&this._mergeParams.uniquekey){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"deleteMergeData",params:Ext.encode({uniquekey:this._mergeParams.uniquekey})}})
}}}});
this.callParent([d]);
if(this.autoOpenWindow){this.openWindow()
}function a(){var n=cloneObject(this.origConfig);
n.autoOpenWindow=true;
n.windowTitle=n.title;
n.style=null;
n.title=null;
n._search=l.call(this);
n._type_packets=m.call(this);
n.enableAutoLoadSipHistory=false;
new Message.SipHistoryWithDiagramPanel(n)
}function f(n){this.sipHistory.setExtraParams({search:n},true);
b.call(this)
}function k(n){this.sipHistory.setExtraParams({type_packets:n},true);
b.call(this)
}function b(){if(this.diagram){this.diagram.loader.url=this.diagramUrl+(this.sipHistory.store.proxy.extraParams.search?"&search="+encodeURIComponent(this.sipHistory.store.proxy.extraParams.search):"")+(this.sipHistory.store.proxy.extraParams.type_packets?"&type_packets="+encodeURIComponent(this.sipHistory.store.proxy.extraParams.type_packets):"");
this.diagram.loader.load()
}}function l(){var n=this.getTopToolbar();
if(n){filterField=n.findC("name","filter");
if(filterField){return(filterField.getValue())
}}}function m(){var n=this.getTopToolbar();
if(n){typePacketsField=n.findC("name","type_packets");
if(typePacketsField){return(typePacketsField.getValue())
}}}function g(){if(this._mergeParams){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"mergePcap",params:Ext.encode(Ext.apply(cloneObject(this._mergeParams),{search:l.call(this),type_packets:m.call(this),with_http:true,prepare:true}))},success:function(n){downloadPrepareFileHash(n)
},maskEl:this,timeout:30*60*1000})
}else{Message.Utils.prepareDownloadPcap(this,this.messageId,null,l.call(this),m.call(this))
}}function c(){var r=[];
this.sipHistory.store.each(function(s){r.push({srcip:s.data.srcip,srcport:s.data.srcport,dstip:s.data.dstip,dstport:s.data.dstport,protocol:s.data.protocol,type:s.data.type})
});
var q=new SvgPaint.Panel({id_autosuffix:true,titleLang:null,border:false});
var o=Math.min(1280,Ext.dom.Element.getViewportWidth()-20);
var n=Ext.dom.Element.getViewportHeight()-30;
var p=new Ext.Window({title:findLangS("svg_paint","title","panel"),closable:true,maximizable:true,resizable:true,layout:"fit",items:q,width:o,height:n});
p.show();
q.createNewPaintFromData({typeData:"sip_history",data:{data:r,ip:this.sipHistory.ip,hostnames:this.sipHistory.hostnames}})
}},openWindow:function(){var b=Math.min(1280,Ext.dom.Element.getViewportWidth()-20);
var a=Ext.dom.Element.getViewportHeight()-30;
var c=new Ext.Window({title:this.windowTitle,closable:true,maximizable:true,resizable:true,layout:"fit",items:this,width:b,height:a});
c.show()
},setReloadInfo:function(a){var b=this.getTopToolbar().findC("_id","reload_info");
if(b){b.setValue(a)
}}});
Ext.define("Message.GridExpPanel",{extend:"Ext.Panel",subsystem:"messages",constructor:function(c){this.tabPanel=new Ext.TabPanel({items:{xtype:"Message_summaryPanel",border:false,record:c.record,grid:c.grid,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}},activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:c.grid.prefixCls+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
if((c.record.data.message&&c.record.data.message.match&&c.record.data.message.match(/\<\?xml/))||(c.record.data.contenttype&&c.record.data.contenttype.match&&c.record.data.contenttype.match(/xml/))){this.parseMessage=new Tools.ParseXmlPdmlPanel({data:c.record.data.message,title:this.findLangS("title","messageTreeTab"),enableShowThumbnail:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel.add(this.parseMessage)
}this.sipHistoryWithChart=new Message.SipHistoryWithDiagramPanel({messageId:c.record.data.ID,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","sipHistoryTab"),enableAutoLoadSipHistory:true,disableSvgPaint:c.grid.disableSvgPaint});
this.sipHistoryWithChart.sipHistory.store.on("load",function(u){if(u.proxy.reader.rawData.errors&&u.proxy.reader.rawData.errors.missingPcapInTar){this.sipHistoryWithChart.setIconCls("icon_light_switch");
this.sipHistoryWithChart.setReloadInfo(u.proxy.reader.rawData.errors.snifferError||(u.proxy.reader.rawData.errors.missingPcapInTar?this.findLangS("text","dataAreNotYetWrittenToDisk"):lang.alertAjaxErrorMsgUnknown))
}else{if(u.getCount()>0){this.sipHistoryWithChart.setIconCls("icon_light_on");
this.sipHistoryWithChart.setReloadInfo("")
}else{this.sipHistoryWithChart.setIconCls("icon_light_off");
this.sipHistoryWithChart.setReloadInfo("")
}}},this);
this.tabPanel.add(this.sipHistoryWithChart);
if((!c.grid.level||c.grid.level<2)&&!c.grid.disableLegs){var b=[];
var h=[];
var m=getDataMessageCustomHeaders();
if(m){for(var g=0;
g<m.length;
g++){if(m[g].default_for_legs_by_header*1){var q=m[g]._column_unique;
b.push(q);
h.push(c.record.data[q])
}}}if(b.length){var o=[];
if(user_can_pcap()){o.push({text:this.findLangS("menu","mergeSipPcap"),scope:this,handler:function(){this.relatedMessages.onMergePcapSipHistory("pcap",c.record.data.ID,"filter")
}})
}o.push({text:this.findLangS("menu","mergeSipHistory"),scope:this,handler:function(){this.relatedMessages.onMergePcapSipHistory("sip_history",c.record.data.ID,"filter")
}});
var l=[{xtype:"displayfield",value:this.findLangS("field","relatedInterval_s"),fieldCls:"x-toolbar-text"},{xtype:"numberfield",value:defaultLegsByHeaderInterval,width:55,minValue:10,maxValue:3600*4,step:100,enableKeyEvents:true,editable:false,listeners:{scope:this,change:function(v){var u=v.getValue();
debug_log(u);
defaultLegsByHeaderInterval=u;
this.relatedMessages.setFilterItemValue("calldate_from",dateTime(dateTime(this.record.data.calldate).getTime()/1000-u));
this.relatedMessages.setFilterItemValue("calldate_to",dateTime(dateTime(this.record.data.calldate).getTime()/1000+u))
}},fieldStyle:{"text-align":"right"}},"-",{text:this.findLangS("menu","merge"),menu:o}];
if(user_can_cdr_share_local_public()||user_can_cdr_share_local_private()){function n(v){var u=[];
var w=[];
this.relatedMessages.store.each(function(y){u.push(y.data.ID);
w.push(y.data)
});
Message.Utils.shareMessage(v._menuId,v._menuId2,v._menuSubId,{ids:u,data:w,merge:true})
}var t=[];
if(user_can_cdr_share_local_public()){t.push({text:this.findLangS("menu","localPublic"),handler:n,_menuSubId:"self_protected_link"})
}if(user_can_cdr_share_local_private()){t.push({text:this.findLangS("menu","localPrivate"),handler:n,_menuSubId:"self_login_link"})
}var d=[];
for(var g=0;
g<2;
g++){d.push('<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 2;">'+(g==0?this.findLangS("menu","shareMessages"):this.findLangS("menu","shareSipHistory"))+"</div>");
var s=g==0?null:"sip_history";
for(var f=0;
f<2;
f++){d.push({text:this.findLangS("menu",f?"sendLinkViaEmail":"showLink"),iconCls:f?"icon_email_send":"icon_magnifier",handler:t.length==1?t[0].handler:undefined,_menuSubId:t.length==1?t[0]._menuSubId:undefined,_menuId:f?"share_message_send":"share_message_show",_menuId2:s,scope:this,menu:t.length>1?{defaults:{_menuId:f?"share_message_send":"share_message_show",_menuId2:s,scope:this},items:cloneArray(t)}:undefined})
}}l.push({iconCls:"icon_link",text:this.findLangS("button","shareShowCdr"),menu:d})
}var p={calldate_from:dateTime(dateTime(c.record.data.calldate).getTime()/1000-defaultLegsByHeaderInterval),calldate_to:dateTime(dateTime(c.record.data.calldate).getTime()/1000+defaultLegsByHeaderInterval),findRelatedViaCustomHeaderField:Ext.encode(b),findRelatedViaCustomHeaderFieldContent:Ext.encode(h),findRelatedViaCustomHeaderCallId:c.record.data.fbasename_orig};
this.relatedMessages=new Message.Grid({title:this.findLangS("title","legsByHeaderTab"),keyField:"ID_comb",layout:"fit",disableMenu:true,pageSize:15,enableAutoLoad:true,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},form_filters:p,level:2,listeners:{scope:this,afterrender:function(){gridEmptyInfo(this.relatedMessages)
}},customMenu:l,decWidthTable:29});
this.relatedMessages.store.on("load",function(u){if(u.getCount()>1){if(!u._firstLoaded){u._firstLoaded=true
}this.relatedMessages.setIconCls("icon_light_on")
}else{this.relatedMessages.setIconCls("icon_light_off")
}gridEmptyInfo(this.relatedMessages)
},this);
this.tabPanel.add(this.relatedMessages)
}}Ext.apply(c,{items:this.tabPanel,border:false,listeners:{scope:this,afterrender:function(){if(!c.grid.disableMap){a.call(this)
}}}});
this.callParent([c]);
function a(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getGeoPosProviders"},success:function(u){k.call(this,u.prov)
}})
}function k(u){var v=[];
if(c.record.data.geopos_lat&&c.record.data.geopos_lng){v.push({posType:"geop",pos:{lat:c.record.data.geopos_lat,lng:c.record.data.geopos_lng}})
}this.map=new GMap.Panel({typeData:"message",data:c.record.data,pos:v,prov_sip:u,sip:{src:c.record.data.sipcallerip,dst:c.record.data.sipcalledip},initMarkers:["sip","geop"],switchMarkers:["sip","geop"],selectProvMarkers:["sip"],initDisabledMarkers:["sip"],controlMarkersIfPos:["geop"],height:500,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel.add(this.map);
this.map.on("activate",r,this,{single:true})
}function r(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getGeoPos",params:Ext.encode({ip:{sip_src:c.record.data.sipcallerip,sip_dst:c.record.data.sipcalledip}})},success:function(u){if(u.pos&&u.pos.length){this.map.initPos(u.pos,"sip")
}if(u.errors&&user_is_admin()){this.map.evGetPosError(u.errors,{onCloseSetCustomerGeoIP:function(v){if(v){r.call(this)
}},onCloseSetCustomerGeoIP_scope:this})
}},error:function(u,v,w){if(u.errors){this.map.evGetPosError(u.errors,{onCloseSetCustomerGeoIP:function(y){if(y){r.call(this)
}},onCloseSetCustomerGeoIP_scope:this})
}else{alertAjaxError(v)
}},maskEl:this.map})
}}});
Ext.define("Message.GroupPanel",{extend:"Ext.Panel",subsystem:"messages",constructor:function(b){this.group_by=_MessageGroupBy_sipResponse;
var h="Message_stats_model";
if(!Ext.ClassManager.isCreated(h)){Ext.define(h,{extend:"Ext.data.Model",fields:rsMessage_stats,idProperty:"id"})
}this.Message_stats_Store=new Ext.data.Store({storeId:"Message_stats_Store",model:h,proxy:{type:"ajax",url:"php/model/sql.php",timeout:60*60*1000,actionMethods:"POST",extraParams:{task:"LISTING",module:"message_stats"},reader:{rootProperty:"results",totalProperty:"total",idProperty:"id"}},pageSize:-1,_grid:this,_params:["dir","limit","module","sort","start","task","simple"]});
this.Message_stats_Store.proxy.on("exception",onGridStoreException,this.Message_stats_Store);
this.Message_stats_Grid=new Ext.grid.GridPanel({store:this.Message_stats_Store,columns:{items:this.getMessageStatsColumns(false),defaults:{sortable:true}},selModel:{mode:"SINGLE",allowDeselect:true},viewConfig:{enableTextSelection:true,loadingText:getLoadMaskWithStopButton_loading_text("messageStat_loadMask")},border:true,region:"center",showCheckBoxes:false,listeners:{scope:this,resize:function(p,q,n,o,s,r){if(!p._ignoreSaveWidth&&q<10000&&q!=o){if(this._width_old&&this.getWidth()==this._width_old){setConfigParameter("Message.GroupPanel_stats_width",q)
}this._width_old=this.getWidth()
}}}});
this.Message_stats_Grid.applyConfig("Message.GroupPanel_stats");
this.Message_pieStats_Store=new Ext.data.ArrayStore({fields:["id","descr","total"],data:[]});
var d=this.Message_pieStats_Store;
this.Message_pieStats_Chart=new Ext.chart.PolarChart({store:this.Message_pieStats_Store,shadow:false,series:[{type:"pie",angleField:"total",label:{field:"descr",display:"rotate",contrast:true,font:"9px Arial",renderer:function(s,p,o,r,n){var q=0;
r.store.each(function(u){q+=u.get("total")
});
var t=r.store.getAt(n);
if(t&&t.data.total<q*1/100){return({hidden:true})
}}},tips:{trackMouse:true,width:150,height:46,renderer:function(p,o,n){var q=0;
d.each(function(r){q+=r.get("total")
});
p.setTitle(o.get("descr")+"<br>"+Math.round(o.get("total")/q*100*10)/10+"%")
},scope:this},listeners:{scope:this,itemclick:function(n,p,o){l.call(this,p.record.data)
}}}],legend:{docked:"right",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:3,_disableUpdateSurface:true},border:false,padding:5,plugins:{ptype:"chartitemevents",moveEvents:true}});
var k=[];
this.comboGroupBy=new Ext.ux.combobox.ComboBoxA({name:"group_by",value:this.group_by,fieldLabel:this.findLangS("title","groupBy"),labelWidth:__width_FieldChar(8),aData:arMessageGroupBy,width:120,listConfig:{maxHeight:Ext.dom.Element.getViewportHeight()/3-50},listeners:{scope:this,select:function(p,o,n){this.group_by=p.getValue();
this.reloadMessageStats(this._messages,this._messages.store,true);
if(this._messages.clearGroupSelect(true)){this._ignoreReloadMessageStats=true
}Ext.defer(function(){this.Message_stats_Grid.focus()
},100,this)
}}});
this.groupStat=new GroupStat.Panel({type:"message",messageGrid:b._messages,messageStore:b._messages.store,tabDock:"top",startTab:"topCalls",disableFirstChangeTabMask:true,disableFirstChangeTabLoad:true,flex:3,style:{marginTop:-2},initItemsMainTabBar:[{text:this.findLangS("title","pieChart"),content:this.Message_pieStats_Chart,_id:"pie"}],evChangeTab:function(n){this.Message_stats_Grid.showCheckBoxes=n._id=="pie";
this.Message_stats_Grid.reconfigure(this.Message_stats_Store,this.getMessageStatsColumns());
this.Message_stats_Grid.applyConfig()
},evChangeTabScope:this,tabBackgroundColor:__color_FormBackground,region:"center",wikiIdInTabBar:"Message_Detail_Record_-_MESSAGES#MESSAGES_group_panel",collapsiblePanel:this,disableFilteredCdr:true,groupPanel:this});
this.Message_stats_Grid.flex=1;
this.comboGroupBy.flex=1;
k.push({layout:"border",items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",layout:"hbox",items:[this.comboGroupBy,{xtype:"button",iconCls:"icon_columns",menu:[],listeners:{scope:this,click:function(o){o.menu.removeAll();
var p=this.Message_stats_Grid.headerCt.getMenuItems(0)[3].menu;
for(var n=1;
n<p.length;
n++){o.menu.add(p[n])
}o.showMenu(true)
}},style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},this.Message_stats_Grid,{xtype:"container",height:1}],region:"west",border:false,split:true,flex:1},this.groupStat],border:false,flex:1});
b=Ext.applyIf(b||{},{layout:"fit",border:false,height:Ext.dom.Element.getViewportHeight()/3,items:{xtype:"form",layout:{type:"hbox",align:"stretch"},bodyStyle:__style_FormBackground({padding:5}),border:false,defaults:{bodyStyle:__style_FormBackground()},items:k},listeners:{resize:a,collapse:function(){this.Message_stats_Grid.getView().getEl().setStyle({"overflow-y":"hidden"})
},beforeExpand:function(){this.Message_stats_Grid.getView().getEl().setStyle({"overflow-y":"auto"})
},scope:this},style:{"border-top":"1px solid "+__color_PanelBorder}});
Message.GroupPanel.superclass.constructor.call(this,b);
var g=getConfigParameter("Message.GroupPanel_stats_width");
if(g){this.Message_stats_Grid.on("afterrender",function(){this.Message_stats_Grid._ignoreSaveWidth=true;
this.Message_stats_Grid.ownerCt.flex=undefined;
this.Message_stats_Grid.ownerCt.setWidth(g*1);
delete this.Message_stats_Grid._ignoreSaveWidth
},this)
}this.Message_stats_Grid.store.on("beforeload",f,this);
this.Message_stats_Grid.store.on("load",c,this);
this.Message_stats_Grid.on("cellclick",function(){Ext.defer(m,250,this)
},this);
function a(){if(this.layout.layout){this._panel.updateLayout()
}}function m(){if(this._suppressOnMouseDown){this._suppressOnMouseDown=false;
return
}this.clearSelectGroupStat();
var n=this.Message_stats_Grid.selModel.getSelection();
if(n&&n.length){this._messages.setGroupSelectByDataRecord(this.getGroupFieldId(),this.getGroupNameSuffix(),n[0].data,true);
this._ignoreReloadMessageStats=true;
this._ignoreSetComboFilters=true
}else{this._messages.clearGroupSelect(true);
this._ignoreReloadMessageStats=true;
this._ignoreSetComboFilters=true
}this.reloadGroupStat()
}function f(){beginLoadMaskWithStopButton_store(this.Message_stats_Store,"messageStat_loadMask")
}function c(){endLoadMaskWithStopButton_store(this.Message_stats_Store);
this.Message_stats_Store.each(function(o){o.data.checked=true;
o.commit()
});
if(this._selectedRecordId){var n=this.Message_stats_Grid.store.getById(this._selectedRecordId);
if(n){this.Message_stats_Grid.selModel.select([n],true)
}if(!this.Message_stats_Grid.selModel.getCount()){this._messages.clearGroupSelect(true)
}this._selectedRecordId=null
}if(!loadStoreIsCancel(this.Message_stats_Grid.store)){this.refreshStorePieChart();
this.reloadGroupStat()
}}function l(q){var p=null;
for(var o=0;
o<this.Message_stats_Store.getCount();
o++){var n=this.Message_stats_Store.getAt(o);
if(n.data[this.getGroupFieldId()]==q.id){p=n;
break
}}if(p){this.Message_stats_Grid.getSelectionModel().select([p])
}this._messages.setGroupSelectByDataRecord(this.getGroupFieldId(),this.getGroupNameSuffix(),p.data,true);
this._ignoreReloadMessageStats=true;
this._ignoreSetComboFilters=true;
this.reloadGroupStat()
}},getMessageStatsColumns:function(a){var d=[];
if(a){d.push({xtype:"checkcolumn",header:"<img src=images/pie.png>",dataIndex:"checked",width:28,listeners:{scope:this,checkchange:function(m,l,n){var k=this.Message_stats_Store.getAt(l);
if(k){k.data.checked=n;
k.commit();
this.refreshStorePieChart()
}}}})
}switch(this.group_by){case _MessageGroupBy_sipResponse:d.push({xtype:"actioncolumn",headerLang:"groupLastSIPresponse",dataIndex:"lastSIPresponse",width:__width_ColumnChar(25),rendererBase:renderString,items:[{getClass:function(k,l,m){return("icon_menu_diag_system")
},handler:function(m,q,l,n,o){this._suppressOnMouseDown=true;
var p=m.store.getAt(q);
var k=new GroupStat.Panel({messageGroupRecord:p,messageGrid:this._messages,messageStore:this._messages.store,tabBackgroundColor:__color_WindowFrame});
k.createWindow({title:this.findLangS("title","advancedStatistics")+" - "+p.data.lastSIPresponse},true)
},tooltip:function(k,l,m){return(this.findLangS("button_help","advancedStatistics"))
},scope:this}],iconTdStyle:"width: 16;",baseContentFirst:true,flex:1});
break;
case _MessageGroupBy_sipIP:d.push({headerLang:"groupSipIP_hostName",dataIndex:"sipip",flex:1,renderer:b});
break;
case _MessageGroupBy_ipGroup:d.push({headerLang:"groupIP_group",dataIndex:"cb_ip_groups_descr",flex:1});
break;
case _CdrGroupBy_country_number:case _CdrGroupBy_country_caller:case _CdrGroupBy_country_called:case _CdrGroupBy_country_sipip:case _CdrGroupBy_country_sipcallerip:case _CdrGroupBy_country_sipcalledip:d.push({headerLang:"groupCountry",dataIndex:"country",width:__width_ColumnChar(25),renderer:h,_show:true});
break
}d.push({dataIndex:"cnt_all",width:__width_ColumnNum(10),align:"right",renderer:f},{dataIndex:"cnt_all",headerLang:"cnt_perc",width:__width_ColumnNum(7),align:"right",renderer:g});
for(var c=0;
c<d.length;
c++){d[c].header=this.findLangS("column",d[c].headerLang||d[c].dataIndex);
if(d[c].xtype=="actioncolumn"){d[c].menuText=d[c].header
}}function b(o,k,l,p,n,m){return(l.data.sip_ip+(l.data.sip_hostname?("<br><i>"+l.data.sip_hostname+"</i>"):""))
}function h(o,k,l,p,n,m){return((existsFlag(l.data.country_code)?'<img src="images/blank.png" class="flag flag-'+l.data.country_code+'" style="margin-bottom: -1px;" /> ':"")+o+" "+l.data.country_code)
}function f(o,k,l,p,n,m){return(l.data.cnt_all)
}function g(q,k,n,r,p,o){var m=0;
o.each(function(s){m+=s.data.cnt_all
});
var l=formatNumber(n.data.cnt_all/m*100,2)+"%";
return(l)
}return d
},getForm:function(){return(this.items.get(0).getForm())
},reloadMessageStats:function(a,c,d){if(this._ignoreReloadMessageStats){this._ignoreReloadMessageStats=false;
return
}if(d){this.Message_stats_Grid.reconfigure(this.Message_stats_Store,this.getMessageStatsColumns());
this.Message_stats_Grid.applyConfig()
}else{var b=this.Message_stats_Grid.selModel.getSelection();
if(b&&b.length){this._selectedRecordId=b[0].internalId
}}this.setBaseParamsMessageStats(a);
this.Message_stats_Store.removeAll();
this.Message_stats_Store.load()
},setBaseParamsMessageStats:function(a){this.resetBaseParamsMessageStats();
Ext.apply(this.Message_stats_Store.proxy.extraParams,a.getSelectParams());
this.Message_stats_Store.proxy.extraParams.group_by=this.group_by
},resetBaseParamsMessageStats:function(){for(var a in this.Message_stats_Store.proxy.extraParams){if(this.Message_stats_Store._params.indexOf(a)<0){this.Message_stats_Store.proxy.extraParams[a]=""
}}},getGroupFieldId:function(){return(getDataArrayItem(arMessageGroupBy,this.group_by,0,2))
},getGroupFieldDescr:function(){return(getDataArrayItem(arMessageGroupBy,this.group_by,0,3)||this.getGroupFieldId())
},getGroupNameSuffix:function(){return(getDataArrayItem(arMessageGroupBy,this.group_by,0,4))
},deselectAllGroupSelects:function(){this.Message_stats_Grid.getSelectionModel().deselectAll(true)
},deselectAllGroupFilters:function(){if(this.groupStat){this.groupStat.deselectAll(true);
this._ignoreReloadMessageStats=true
}},refreshStorePieChart:function(){var h=this.getGroupFieldId();
var a=this.getGroupFieldDescr();
var k=false;
var d=Math.min(this.Message_stats_Store.getCount(),20);
if(this.Message_pieStats_Store.getCount()!=d){k=true
}else{if(d){var l=d;
for(var f=0;
f<l;
f++){var c=this.Message_stats_Store.getAt(f);
var b=this.Message_pieStats_Store.getAt(f);
if(b.data.id!=c.data[h]||b.data.descr!=c.data[a]||b.data.total!=c.data.cnt_all||b.data.checked!=c.data.checked){k=true;
break
}}}}if(k){this.Message_pieStats_Chart.isInitializing=true;
this.Message_pieStats_Store.removeAll();
var l=d;
for(var f=0;
f<l;
f++){var g=this.Message_stats_Store.getAt(f);
if(g.data.checked){this.Message_pieStats_Store.add({id:g.data[h],descr:g.data[a],total:g.data.cnt_all})
}}this.Message_pieStats_Chart.isInitializing=false;
this.Message_pieStats_Chart.processData()
}},setGroupData:function(a){if(a&&a.group_by){this.group_by=a.group_by
}},applyGroupData:function(){this.comboGroupBy.setValue(this.group_by);
this.Message_stats_Grid.reconfigure(this.Message_stats_Store,this.getMessageStatsColumns());
this.Message_stats_Grid.applyConfig()
},getGroupData:function(){var d=["group_by"];
var b={};
for(var a=0;
a<d.length;
a++){var c=this.findC("name",d[a]);
if(c){value=c.getValue();
if(value){b[d[a]]=value
}}}return(b)
},reloadGroupStat:function(){Ext.defer(function(){this.groupStat.reload(true,true)
},100,this)
},clearSelectGroupStat:function(){this.groupStat.clearSelect()
}});
Ext.define("Message.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.MESSAGESPanelX",subsystem:"messages",constructor:function(a){this.messagesPanel=new Message.GridPanel({border:false,messagePanel:this,region:"center",_panel:this,_mainMessageTable:true});
var b=[this.messagesPanel];
this.messages=this.messagesPanel.grid;
if(user_show_cdr_group()){this.groupPanel=new Message.GroupPanel({id:"Message-group-panel",collapsible:true,collapsedCls:"no-border",region:"south",floatable:true,span:true,border:false,title:this.findLangS("title","groups"),_panel:this,_messages:this.messages,collapsible:true,header:false});
this.messages._groupPanel=this.groupPanel;
this.groupPanel._messages=this.messages;
b.push(this.groupPanel)
}a=Ext.applyIf(a||{},{id:"MESSAGES-panel",title:this.findLangS("title","SipMessages"),iconCls:"icon_menu_cdr",layout:"border",bodyBorder:false,defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:b,listeners:{scope:this,afterrender:function(){if(!Ext.isIE){var c=Ext.get("MESSAGES-panel_header");
if(c){c.setStyle({"padding-top":1,"padding-bottom":1})
}}}},wikiId:"MESSAGES",wikiButtonMarginTop:-1});
this.callParent([a])
},deselectAllGroupFilters:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupFilters()
}},deselectAllGroupSelects:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupSelects()
}},setTitleMessages:function(){if(Ext.isIE){var d=this.findLangS("title","SipMessages");
if(this.messages.getFilterItemValue("calldate_from")){d+="&nbsp;&nbsp;&nbsp;from date&nbsp;"+Ext.Date.format(this.messages.getFilterItemValue("calldate_from"),__format_Date)
}if(this.messages.getFilterItemValue("calldate_to")){d+="&nbsp;&nbsp;&nbsp;to date&nbsp;"+Ext.Date.format(this.messages.getFilterItemValue("calldate_to"),__format_Date)
}this.setTitle(d);
return
}var c=this.getDateFrom();
var b=this.getDateTo();
if(!this.formTitle){this.setTitle('<div id="messages_title" style="position: relative; left: 0; top: 0; width: 500; height: 22"/>');
var a=getStdMenuTimeFrom(this,function(f){var h=dateTimeM(getTimeInterval(f._typeTimeFrom)[0]);
var g=getTimeInterval(f._typeTimeFrom)[1];
if(g){g.timeDefined=false
}this.messages.setFilterItemValue("last_days",null,true,true);
this.messages.setFilterItemValue("last_minutes",null,true,true);
this.messages.setFilterItemValue("calldate_to",g,false,true);
this.messages.setFilterItemValue("calldate_from",h)
});
a.items.push({xtype:"menuseparator"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:"Last ",fieldCls:"x-menu-item-text"},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",width:50,_id:"last_days",minValue:0,maxValue:365,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}},select:function(f){if(!f._disableChangeEvent){this.setLastDays(f.getValue(),Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_minutes").getValue())
}},change:function(f){if(!f._disableChangeEvent){this.setLastDays(f.getValue(),Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_minutes").getValue())
}},scope:this},tooltip:lang.days},{xtype:"displayfield",value:lang.days,fieldCls:"x-menu-item-text"}],style:{marginBottom:1}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",width:50,_id:"last_minutes",minValue:0,maxValue:24*60,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}},select:function(f){if(!f._disableChangeEvent){this.setLastDays(Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_days").getValue(),f.getValue())
}},change:function(f){if(!f._disableChangeEvent){this.setLastDays(Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_days").getValue(),f.getValue())
}},scope:this},tooltip:lang.minutes},{xtype:"displayfield",value:lang.minutes,fieldCls:"x-menu-item-text"}]}]}],style:{marginLeft:27}});
a.listeners={beforeshow:function(h){var g=h.findC("_id","last_days");
if(g){g._disableChangeEvent=true;
g.setValue(this.messages.getFilterItemValue("last_days")||"");
delete g._disableChangeEvent
}var f=h.findC("_id","last_minutes");
if(f){f._disableChangeEvent=true;
f.setValue(this.messages.getFilterItemValue("last_minutes")||"");
delete f._disableChangeEvent
}},scope:this};
this.formTitle=new Ext.form.FormPanel({items:{layout:{type:"hbox",align:"middle"},xtype:"container",items:[{xtype:"displayfield",value:this.findLangS("title","SipMessages")+" - from date&nbsp;",fieldCls:"x-panel-header-title-default",width:155,height:16},{xtype:"DateField2T",name:"fdatefrom",value:clone(c),format:__format_DateTimeM,width:125+__width_Trigger,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){this.messages.setFilterItemValue("calldate_from",f)
},blur:function(f){var g=f.getValue();
if(g){g.timeDefined=true
}if(!eqDate(g,this.messages.getFilterItemValue("calldate_from"))){this.messages.setFilterItemValue("calldate_from",g)
}},specialkey:function(g,f){if(f.getKey()==f.ENTER){var h=g.rawToValue(g.getRawValue());
if(h){h.timeDefined=true
}if(!eqDate(h,this.messages.getFilterItemValue("calldate_from"))){this.messages.setFilterItemValue("calldate_from",h)
}}}},t2menu:a},{xtype:"displayfield",value:"&nbsp;&nbsp;to date",fieldCls:"x-panel-header-title-default",width:51,height:16},{xtype:"datefield",name:"fdateto",value:clone(b),format:__format_Date,width:90,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){f.timeDefined=false;
this.messages.setFilterItemValue("calldate_to",f)
},blur:function(g){var f=g.getValue();
if(f){f.timeDefined=false
}if(!eqDate(f,this.messages.getFilterItemValue("calldate_to"))){this.messages.setFilterItemValue("calldate_to",f)
}},specialkey:function(h,g){if(g.getKey()==g.ENTER){var f=h.rawToValue(h.getRawValue());
if(f){f.timeDefined=false
}if(!eqDate(f,this.messages.getFilterItemValue("calldate_to"))){this.messages.setFilterItemValue("calldate_to",f)
}}}}}]},border:false,bodyStyle:{background:"transparent"},renderTo:"messages_title",width:600})
}else{this.formTitle.getForm().findField("fdatefrom").setValue(clone(c));
this.formTitle.getForm().findField("fdateto").setValue(clone(b))
}},collapseGroup:function(){if(this.groupPanel){this.groupPanel.collapse()
}},reactivate:function(){if(window.needMessageColumnsReconfigure){this.messages.reconfigureColumns();
window.needMessageColumnsReconfigure=false
}this.messages.reload()
},changeTimezone:function(){this.messages.reload()
},setLastDays:function(c,b){this.messages.setFilterItemValue("last_days",c,null,true);
this.messages.setFilterItemValue("last_minutes",b,null,true);
if(this.setLastDaysTimer){clearTimeout(this.setLastDaysTimer);
delete this.setLastDaysTimer
}var a=this;
this.setLastDaysTimer=setTimeout(function(){a.messages.reload({page:1});
delete a.setLastDaysTimer
},500)
},getDateFrom:function(){var c=this.messages.getFilterItemValue("calldate_from");
if(this.messages.getFilterItemValue("last_minutes")>0){var a=new Date(dateTime().getTime()-this.messages.getFilterItemValue("last_minutes")*60*1000);
if(this.messages.getFilterItemValue("last_days")>0){c=date(a);
for(var b=0;
b<this.messages.getFilterItemValue("last_days");
b++){c=date_prev(c)
}c=completeDateTime(c,a)
}else{c=a
}}else{if(this.messages.getFilterItemValue("last_days")>0){c=date();
for(var b=0;
b<this.messages.getFilterItemValue("last_days");
b++){c=date_prev(c)
}}}return(c)
},getDateTo:function(){return(this.messages.getFilterItemValue("last_days")>0||this.messages.getFilterItemValue("last_minutes")>0?null:this.messages.getFilterItemValue("calldate_to"))
}});
Ext.define("Message.Filter",{singleton:true,subsystem:"messages",getFieldset:function(c){c=c||{};
c.prop=c.prop||{};
Ext.applyIf(c.prop,{fieldaWidth:__width_FieldChar(22),fieldbWidth:__width_FieldChar(22),fieldwWidth:__width_FieldChar(35),label1Width:__width_FieldChar(14),label2aWidth:__width_FieldChar(22),label2bWidth:__width_FieldChar(13),btnSwitchWidth:16,btnSwitchHeight:16,label1Style:{},label1CheckboxStyle:{"margin-left":10},label1aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label1alStyle:{"margin-right":__width_LabelFieldSeparator},label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[];
if(!c.disableTimeInterval){a.push({items:[{xtype:"displayfield_vo3",value:"dateRange:",_type:"label1"},{xtype:"displayfield_vo3",value:"dateFrom",_type:"label2ap"},{xtype:"datetimefield",name:"calldate_from",value:c.values.calldate_from,_type:"fielda",inEditor:true,zeroTimeEmpty:true,allowBlankDate:false},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"dateTo",_type:"label2b"},{xtype:"datetimefield",name:"calldate_to",value:c.values.calldate_to,_type:"fieldb",inEditor:true,zeroTimeEmpty:true}]},{items:[{xtype:"displayfield_vo3",value:"lastDaysMinutes:",helpText:"lastDaysMinutesHelp",_type:"label1al"},{xtype:"numberfield",name:"last_days",value:c.values.last_days,_type:"fielda",minValue:0,maxValue:365,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(h){var g=h.getValue();
if(g==1||g===null){Ext.defer(function(){h.setValue(null)
},1)
}}}},{xtype:"displayfield_vo3",value:lang.days,_type:"label",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"last_minutes",value:c.values.last_minutes,_type:"fielda",minValue:0,maxValue:24*60,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(h){var g=h.getValue();
if(g==1||g===null){Ext.defer(function(){h.setValue(null)
},1)
}}}},{xtype:"displayfield_vo3",value:lang.minutes,_type:"label",style:{marginLeft:2}}]})
}a.push({items:[{xtype:"image",src:"images/icon/page_wrench.png",width:14,height:14,helpText:findLangS(this.subsystem,"field_filter","numTriggerHelp"),style:{marginTop:4,marginRight:2,cursor:"pointer"},listeners:{click:{element:"el",fn:function(h,l){var g=Ext.getCmp(l.id).findFormPanel();
if(g){var k=g.getForm().findField("callerd_search_type");
if(k){k.expand()
}}}},scope:this}},{xtype:"ComboBoxA",name:"callerd_search_type",value:c.values.callerd_search_type||0,_type:"combolabel_main",aData:[[0,"num"],[1,"num_start"],[2,"num_end"],[3,"num_contain"],[4,"num_regexp"]],hideTrigger:true,_decWidth:16},{xtype:"ComboBoxA",name:"callerd_type",value:c.values.callerd_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"caller",value:c.values.caller,_type:"fielda"},{xtype:"button",name:"callerd_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"called",value:c.values.called,_type:"fieldb"}]});
if(window.existsMessageCountryCode){a.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByNumber:",helpText:"countryCodeByNumberHelp",_type:"label1"},{xtype:"ComboBoxA",name:"country_code_callerd_type",value:c.values.country_code_callerd_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"country_tree_field",name:"country_code_caller",value:c.values.country_code_caller,_type:"fielda",helpFieldId:"country_code_caller"},{xtype:"button",name:"country_code_callerd_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"country_code_called_label",value:"called",_type:"label2b"},{xtype:"country_tree_field",name:"country_code_called",value:c.values.country_code_called,_type:"fieldb",helpFieldId:"country_code_called"}]})
}a.push({items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_group_id_type",value:c.values.callerd_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbNumberGroups",name:"caller_group_id",value:c.values.caller_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"callerd_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbNumberGroups",name:"called_group_id",value:c.values.called_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]},{items:[{xtype:"displayfield_vo3",value:"callerName:",_type:"label1al"},{xtype:"textfield",name:"caller_name",value:c.values.caller_name,_type:"fielda"}]},{items:[{xtype:"displayfield_vo3",value:"domain:",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_domain_type",value:c.values.callerd_domain_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"caller_domain",value:c.values.caller_domain,_type:"fielda"},{xtype:"button",name:"domain_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_domain_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"called_domain",value:c.values.called_domain,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_domain_group_id_type",value:c.values.callerd_domain_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbDomainGroups",name:"caller_domain_group_id",value:c.values.caller_domain_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,extraParams:{side:c.values.callerd_domain_group_id_type?_side_CallerNum:null}},{xtype:"button",name:"domain_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_domain_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbDomainGroups",name:"called_domain_group_id",value:c.values.called_domain_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true,extraParams:{side:_side_CalledNum}}]},{items:[{xtype:"displayfield_vo3",value:"IP:",_type:"label1"},{xtype:"ComboBoxA",name:"sipcallerdip_type",value:c.values.sipcallerdip_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"sipcallerip",value:c.values.sipcallerip,_type:"fielda"},{xtype:"button",name:"sipcallerdip_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"sipcalledip_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"sipcalledip",value:c.values.sipcalledip,_type:"fielda"}]});
if(window.existsMessageCountryCode){a.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByIP:",helpText:"countryCodeByIPHelp",_type:"label1"},{xtype:"ComboBoxA",name:"country_code_sipcallerdip_type",value:c.values.country_code_sipcallerdip_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"country_tree_field",name:"country_code_sipcallerip",value:c.values.country_code_sipcallerip,_type:"fielda",helpFieldId:"country_code_sipcallerip"},{xtype:"button",name:"country_code_sipcallerdip_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"country_code_sipcalledip_label",value:"called",_type:"label2b"},{xtype:"country_tree_field",name:"country_code_sipcalledip",value:c.values.country_code_sipcalledip,_type:"fieldb",helpFieldId:"country_code_sipcalledip"}]})
}a.push({items:[window.existsMessageProxy?{xtype:"checkbox",name:"sipcallerdip_with_proxy",checked:Ext.isDefined(c.values.sipcallerdip_with_proxy)?c.values.sipcallerdip_with_proxy:true,boxLabel:"sipcallerdip_with_proxy",_type:"label1checkbox"}:{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"sipcallerdip_group_id_type",value:c.values.sipcallerdip_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbIpGroups",name:"sipcallerip_group_id",value:c.values.sipcallerip_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"sipcallerdip_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"sipcalledip_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbIpGroups",name:"sipcalledip_group_id",value:c.values.sipcalledip_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]});
if(window.existsMessageProxy){a.push({items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"displayfield_vo3",name:"proxyip_label",value:"proxyIp:",_type:"label2a"},{xtype:"textfield",name:"proxyip",value:c.values.proxyip,_type:"fielda"}]})
}a.push({items:[{xtype:"displayfield_vo3",value:"sipAgent:",_type:"label1"},{xtype:"ComboBoxA",name:"ab_ua_type",value:c.values.ab_ua_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"a_ua",value:c.values.a_ua,_type:"fielda"},{xtype:"button",name:"ab_ua_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"b_ua_label",value:"uaCalled",_type:"label2b"},{xtype:"textfield",name:"b_ua",value:c.values.b_ua,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"ab_ua_group_id_type",value:c.values.ab_ua_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbUaGroups",name:"a_ua_group_id",value:c.values.a_ua_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"ab_ua_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"b_ua_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbUaGroups",name:"b_ua_group_id",value:c.values.b_ua_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]},{items:[{xtype:"displayfield_vo3",value:"message:",_type:"label1al"},{xtype:"textfield",name:"message",value:c.values.message,_type:"fielda",width:c.prop.fieldwWidth}]},{items:[{xtype:"displayfield_vo3",value:"callID:",_type:"label1al"},{xtype:"textfield",name:"callid",value:c.values.callid,_type:"fielda",width:c.prop.fieldwWidth}]});
var f=getDataMessageCustomHeaders();
if(f){for(var d=0;
d<f.length;
d++){if(f[d].special_type=="max_length_sip_data"||f[d].special_type=="max_length_sip_packet"){a.push({items:[{xtype:"displayfield_vo3",value:f[d].name+":",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:f[d]._column_unique+"_ge",value:c.values[f[d]._column_unique+"_ge"],_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:f[d]._column_unique+"_lt",value:c.values[f[d]._column_unique+"_lt"],_type:"fieldb"}]})
}else{a.push({items:[{xtype:"displayfield_vo3",value:f[d].name+":",_type:"label1al"},{xtype:"textfield",name:f[d]._column_unique,value:c.values[f[d]._column_unique],_type:"fielda",width:c.prop.fieldwWidth}]})
}}a.push({items:[{xtype:"displayfield_vo3",value:"custhead_group:",helpText:"custhead_groupHelp",_type:"label1al"},{xtype:"ComboBoxX",name:"custhead_group_id",value:c.values.custhead_group_id||0,_type:"fielda",width:c.prop.fieldwWidth,valueField:"id",displayField:"descr",url:"php/model/sql.php",module:"cb_custhead_msg_groups",recordStruct:rsCbCustheadMsgGroups,sortField:"descr",columns:[{fields:"descr",widthCh:25},{fields:"custom_header",widthCh:25}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true}]})
}a.push({items:[{xtype:"displayfield_vo3",value:"messageType:",_type:"label1al"},{xtype:"CBX_messageTypes",name:"messageType",value:c.values.messageType,_type:"fielda",_noLabel:true,_clearButton:true}]},{items:[{xtype:"displayfield_vo3",value:"sensor:",_type:"label1al"},{xtype:"CBX_sensor",name:"sensor_id",value:c.values.sensor_id||0,_type:"fielda",_noLabel:true,_addEmptySensorId:true,_clearButton:true}]});
for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){if(a[d].items[b].xtype&&a[d].items[b].xtype.match("CBX_")){a[d].items[b].storeAutoLoad=false
}switch(a[d].items[b]._type){case"fielda":Ext.applyIf(a[d].items[b],{width:c.prop.fieldaWidth});
break;
case"fieldb":Ext.applyIf(a[d].items[b],{width:c.prop.fieldbWidth});
break;
case"fieldc":Ext.applyIf(a[d].items[b],{width:c.prop.fieldcWidth});
break;
case"label1":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width,style:c.prop.label1Style,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1checkbox":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width-c.prop.label1CheckboxStyle["margin-left"],style:c.prop.label1CheckboxStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1a":case"label1ap":case"label1al":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width+c.prop.label2aWidth,style:["label1a","label1ap"].isIn(a[d].items[b]._type)?c.prop.label1aStyle:c.prop.label1alStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label1ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2a":case"label2ap":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:c.prop.label2aStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label2ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2b":Ext.applyIf(a[d].items[b],{width:c.prop.label2bWidth,style:c.prop.label2bStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"label":Ext.applyIf(a[d].items[b],{fieldStyle:c.prop.labelFieldStyle});
break;
case"combolabel":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(h){var g=h.findFormPanel();
if(g){Message.Filter.setContextFields(g)
}}}});
break;
case"combolabel_main":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width-(a[d].items[b]._decWidth||0),fieldStyle:{"text-align":"left",background:__color_FormBackground,border:"none","padding-left":"0px !important"},listeners:{select:function(h){var g=h.findFormPanel();
if(g){var k=g.getForm().findField("caller");
if(k){k.focus(false,200)
}Message.Filter.setContextFields(g)
}},afterrender:function(g){g.inputWrap.setStyle({border:"none"})
}}});
break;
case"btnswitch":Ext.applyIf(a[d].items[b],{width:c.prop.btnSwitchWidth,border:false,style:{background:"transparent",marginTop:2,marginLeft:4,marginRight:4,height:c.prop.btnSwitchHeight},cls:"icon_arrow_switch_lr",handler:function(h){var g=h.findFormPanel();
if(g){Message.Filter.switchContentFields(g,h.name)
}}});
break;
case"btnswitch_filler":Ext.applyIf(a[d].items[b],{xtype:"container",width:c.prop.btnSwitchWidth+8,border:false});
break
}}}Ext.applyIf(a[d],{xtype:"container",layout:"hbox",style:{paddingBottom:__height_FieldSeparator}})
}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(h){var g=h.findFormPanel();
if(g){Message.Filter.setContextFields(g,true,h)
}},select:function(h){var g=h.findFormPanel();
if(g){Message.Filter.setContextFields(g,true,h)
}}},function(g){return(g.xtype=="numberfield")
});
return(this.completeFields(a))
},completeFields:function(a){if(Ext.isArray(a)){for(var c=0;
c<a.length;
c++){this.completeFields(a[c])
}return(a)
}if(a.items){this.completeFields(a.items);
return(a)
}if(a.xtype&&a.xtype.match(/^displayfield/)&&a.value){var g=a.value;
var d=false;
if(g.match(/:$/)){g=g.substr(0,g.length-1);
d=true
}var f=findLangS(this.subsystem,"field_filter",g);
if(f){a.value=f;
if(d){a.value+=":"
}}if(a.helpText){a.helpText=findLangS(this.subsystem,"field_filter",a.helpText)||findLangS(this.subsystem,"field_filter",a.helpText+"Help")
}}if(a.xtype=="checkbox"&&a.boxLabel){var b=findLangS(this.subsystem,"field_filter",a.boxLabel);
if(b){a.boxLabel=b
}}if(a.aData){for(var c=0;
c<a.aData.length;
c++){if(Ext.isArray(a.aData[c])&&a.aData[c].length==2){var f=findLangS(this.subsystem,"field_filter",a.aData[c][1]);
if(f){a.aData[c][1]=f+(a._type=="combolabel_main"?":":"")
}}}}a.__filter="message";
return(a)
},fetchValuesFromFieldset:function(d){var c={};
if(d.getForm){d=d.getForm()
}var b=this.getArrayOfFields();
if(b){for(var a=0;
a<b.length;
a++){var g=this.findFilterField(d,b[a]);
if(g){var f=g.getValue();
if(Ext.isDefined(f)&&f!==""&&f!==null){c[b[a]]=g.getValue()
}}}}return(c)
},setValueFieldsFieldset:function(a,d){if(!d||!a){return
}if(d.getForm){d=d.getForm()
}var c=this.getArrayOfFields();
if(c){for(var b=0;
b<c.length;
b++){var f=this.findFilterField(d,c[b]);
if(f){f.setValue(a[c[b]])
}}}this.setContextFields(d)
},getArrayOfFields:function(c){var a=["calldate_from","calldate_to","last_days","last_minutes","callerd_search_type","caller","called","country_code_caller","country_code_called","caller_group_id","called_group_id","caller_name","caller_domain","called_domain","caller_domain_group_id","called_domain_group_id","sipcallerip","sipcalledip","country_code_sipcallerip","country_code_sipcalledip","sipcallerip_group_id","sipcalledip_group_id","sipcallerdip_with_proxy","proxyip","a_ua","b_ua","ab_ua_type","a_ua_group_id","b_ua_group_id","message","callid","messageType","custhead_group_id","sensor_id"];
var f=getDataMessageCustomHeaders();
if(f){for(var b=0;
b<f.length;
b++){if(f[b].special_type=="max_length_sip_data"||f[b].special_type=="max_length_sip_packet"){a.push(f[b]._column_unique+"_ge");
a.push(f[b]._column_unique+"_lt")
}else{a.push(f[b]._column_unique)
}}}var d=this.abFields_Types();
if(d.length){a=a.concat(d)
}return(a)
},setContextFields:function(b){if(!b){return
}if(b.getForm){b=b.getForm()
}var c=this.fetchValuesFromFieldset(b);
this.enableField(b,"calldate_from",Ext.isEmpty(c.last_days)&&Ext.isEmpty(c.last_minutes));
this.enableField(b,"calldate_to",Ext.isEmpty(c.last_days)&&Ext.isEmpty(c.last_minutes));
var l=this.abFields_labelContext();
for(var o in l){var k=this.findFilterField(b,o);
if(k){fieldValue=k.getValue();
if(fieldValue==null){k.setValue(0);
fieldValue=0
}for(var f=0;
f<l[o].length;
f++){if(l[o][f]){var m=this.findFilterField(b,l[o][f]);
if(m){m.setVisible(fieldValue==1)
}}}}}var n=this.findFilterField(b,"callerd_search_type");
if(n){var d=n.getValue()==0;
var a=this.findFilterField(b,"caller_group_id");
if(a){a.enableIf(d);
if(!d){a.setValue(null)
}}var g=this.findFilterField(b,"called_group_id");
if(g){g.enableIf(d);
if(!d){g.setValue(null)
}}}var h=this.findFilterField(b,"caller_domain_group_id");
if(h){h.setSide(c.callerd_domain_group_id_type?_side_CallerNum:null)
}},switchContentFields:function(d,h){if(!d){return
}if(d.getForm){d=d.getForm()
}var g=this.abFields_switch();
if(g[h]){var c=[];
for(var b=0;
b<2;
b++){for(var a=0;
a<2;
a++){var f=this.findFilterField(d,g[h][a]);
if(b){f.setValue(c[a?0:1])
}else{c[a]=f.getValue()
}}}}},isDataSet:function(a){if(a.getForm){a=a.getForm()
}var b=this.fetchValuesFromFieldset(a);
delete b.calldate_from;
delete b.calldate_to;
return(isDataSet(b))
},getDefaultDateFrom:function(){return defaultCdrTypeInterval=="specified_days"?date((new Date).getTime()/1000-defaultCdrInterval*24*60*60):dateTimeM(getTimeInterval(defaultCdrTypeInterval)[0])
},findFilterField:function(c,d){if(!c){return(null)
}if(c.findField){c=c.owner
}var a=c.getItems(d,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(a[b].__filter=="message"){return(a[b])
}}}return(null)
},enableField:function(b,d,a){var c=this.findFilterField(b,d);
if(c){c.enableIf(a)
}},setValueField:function(a,d,b){var c=this.findFilterField(a,d);
if(c){c.setValue(b)
}},optimizeFilterItems:function(f){var k=this.abFields_typeAB();
for(var c in k){if(Ext.isDefined(f[c])){var g=k[c][0];
var d=k[c][1];
if(!f[g]&&!f[d]){delete f[c]
}}}var b=["callerd_search_type"];
for(var c=0;
c<b.length;
c++){if(Ext.isDefined(f[b[c]])&&!f[b[c]]){delete f[b[c]]
}}if(Ext.isDefined(f.sipcallerdip_with_proxy)){var h=false;
for(var a in f){if(a.match&&a.match(/sipcalle[rd]ip/)&&f[a]){h=true;
break
}}if(!h){delete f.sipcallerdip_with_proxy
}}},abFields_Types:function(){var a=[];
for(var b in this.abFields){if(this.abFields[b].t){a.push(this.abFields[b].t)
}}return(a)
},abFields_labelContext:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].sw&&this.abFields[b].l&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].sw,this.abFields[b].l,this.abFields[b].b]
}}return(a)
},abFields_switch:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].sw&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].sw]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields_typeAB:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields:[{t:"callerd_type",a:"caller",b:"called",l:"called_label",sw:"callerd_switch"},{t:"country_code_callerd_type",a:"country_code_caller",b:"country_code_called",l:"country_code_called_label",sw:"country_code_callerd_switch"},{t:"callerd_group_id_type",a:"caller_group_id",b:"called_group_id",l:"called_group_id_label",sw:"callerd_group_id_switch"},{t:"callerd_domain_type",a:"caller_domain",b:"called_domain",l:"called_domain_label",sw:"domain_switch"},{t:"callerd_domain_group_id_type",a:"caller_domain_group_id",b:"called_domain_group_id",l:"called_domain_group_id_label",sw:"domain_group_id_switch"},{t:"sipcallerdip_type",a:"sipcallerip",b:"sipcalledip",l:"sipcalledip_label",sw:"sipcallerdip_switch"},{t:"country_code_sipcallerdip_type",a:"country_code_sipcallerip",b:"country_code_sipcalledip",l:"country_code_sipcalledip_label",sw:"country_code_sipcallerdip_switch"},{t:"sipcallerdip_group_id_type",a:"sipcallerip_group_id",b:"sipcalledip_group_id",l:"sipcalledip_group_id_label",sw:"sipcallerdip_group_id_switch"},{t:"ab_ua_type",a:"a_ua",b:"b_ua",l:"b_ua_label",sw:"ab_ua_switch"},{t:"ab_ua_group_id_type",a:"a_ua_group_id",b:"b_ua_group_id",l:"b_ua_group_id_label",sw:"ab_ua_group_id_switch"}]});
Ext.define("Message.Utils",{singleton:true,subsystem:"messages",downloadPcap:function(a,b){formPostSafe("php/pcap.php","POST",{id:a,msg:1,with_http:true})
},testDownloadPcap:function(a,b,c){ajaxSafeRequest({scope:a,url:"php/pcap.php",params:{id:b,msg:1,with_http:true,test:true},success:function(d){c.call(a)
},maskEl:a})
},prepareDownloadPcap:function(a,b,d,c,f){ajaxSafeRequest({scope:a,url:"php/pcap.php",params:{id:b,msg:1,search:c?c:undefined,type_packets:f?f:undefined,with_http:true,prepare:true},success:function(g){if(d){d.call(a,g)
}else{downloadPrepareFileHash(g)
}},maskEl:a,timeout:30*60*1000})
},shareMessage:function(g,d,l,a,b){if(g=="share_message_send"&&isDataEmpty(b)){var m=new Tools.EmailForm({windowsTitle:findLangS(this.subsystem,"title","shareMessageSendLinkViaEmail"),from:user.sqlrow.email,subject:findLangS(this.subsystem,"field","shareMessage_mailSubject"),message:findLangS(this.subsystem,"field","shareMessage_mailMessage"),signature:findLangS(this.subsystem,"field","shareMessage_mailSignature")+(user.sqlrow.name||""),fceSubmit:function(n){this.shareMessage(g,d,l,a,{emailFields:n})
},fceSubmitScope:this});
m.createWindow();
return
}var c=[];
var h=false;
if(a.ids){if(a.ids.length){c=a.ids;
h=true
}}else{var k=a.selModel.getSelection();
if(!k){return
}for(var f=0;
f<k.length;
f++){c.push(k[f].data.ID)
}}if(!c.length){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"shareMessage",params:Ext.encode({type:g,type2:d,subType:l,id:c,merge:h,emailFields:b&&b.emailFields})},success:function(n){switch(g){case"share_message_show":if(n.linkA&&n.linkA.length==(h?1:(a.ids?a.data.length:k.length))){var q='<table style="font: '+__font_Grid+'; table-layout: fixed;">'+(n.linkA.length>1?'<col width="90"><col width="120">':"")+'<col width="400"><col width="100">';
for(var o=0;
o<n.linkA.length;
o++){q+="<tr>"+(n.linkA.length>1?'<td style="padding: 3;">'+(a.ids?a.data[o].calldate_userformat:k[o].data.calldate_userformat)+'</td><td style="padding: 3;">'+(a.ids?a.data[o].calldate_userformat:k[o].data.calldate_userformat)+"</td>":"")+'<td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+n.linkA[o]+'" target="_blank">'+n.linkA[o]+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div_'+(o+1)+'" style="height: 18;"/>';
"</div></td><tr>"
}q+="</table>";
var p=400+6+100+6+(n.linkA.length>1?120+6+90+6:0)+30;
Ext.Msg.show({title:findLangS(this.subsystem,"title","shareMessage"),msg:q,buttons:Ext.Msg.OK,minWidth:p,width:p,fn:function(){for(var s=0;
s<n.linkA.length;
s++){var r=Ext.getCmp("copy_button_"+(s+1));
if(r){r.destroy()
}}}});
for(var o=0;
o<n.linkA.length;
o++){new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(r){return(r.clipboardText)
},getClipTextParams:{clipboardText:n.linkA[o]},id:"copy_button_"+(o+1),renderTo:"copy_button_div_"+(o+1)})
}}break;
case"share_message_send":alertAjaxSuccess(lang.emailSent);
break
}},maskEl:a.ids?null:a})
}});
function isInitMessageSelectUrlParams(){return(window.messageId||window.message_filter||window.message_group_data)
}function clearInitMessageSelectUrlParams(){window.messageId=null;
window.message_filter=null;
window.message_group_data=null
}Ext.ns("SS7");
Ext.define("SS7.GridPanel",{extend:"Ext.Panel",alias:"widget.SS7X",subsystem:"ss7",constructor:function(a){var b={};
Ext.applyIf(b,{layout:"fit",border:false,region:"center",ss7Panel:a.ss7Panel,_panel:a._panel,suspendStdBar:true,foreignBarOwner:this,gridPanel:this});
this.grid=new SS7.Grid(b);
Ext.applyIf(a,{tbar:this.grid.suspendedStdBar,layout:"border",defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:this.grid});
this.callParent([a])
}});
Ext.define("SS7.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SS7.GridX",subsystem:"ss7",constructor:function(b){var d=[];
var g=[];
if(b&&b.customMenu){d=b.customMenu
}if(!b||!b.disableMenu){var f=[];
if(typeDb=="mysql"){f.push({text:this.findLangS("menu","exportCSV"),iconCls:"icon_excel",handler:this.exportToCsv,scope:this},{xtype:"menuseparator"})
}f.push({text:this.findLangS("menu","enableDns"),xtype:"menucheckitem",checked:user.sqlrow&&user.sqlrow.uc_enable_dns_ss7,_menuId:"enableDns"});
f.push({text:this.findLangS("menu","enableFlags"),menu:[{text:this.findLangS("menu","number"),menu:{defaults:{xtype:"menucheckitem",scope:this,handler:k},items:[{text:this.findLangS("menu","left"),_menuId:"flags_number",_value:"left"},{text:this.findLangS("menu","right"),_menuId:"flags_number",_value:"right"},{text:this.findLangS("menu","disable"),_menuId:"flags_number",_value:"disable"}],listeners:{beforeshow:function(o){for(var n=0;
n<o.items.length;
n++){var m=o.items.get(n);
m.setChecked(m._value==user.sqlrow.uc_enable_flags_ss7_number)
}}}}},{text:this.findLangS("menu","ip"),menu:{defaults:{xtype:"menucheckitem",scope:this,handler:k},items:[{text:this.findLangS("menu","left"),_menuId:"flags_ip",_value:"left"},{text:this.findLangS("menu","right"),_menuId:"flags_ip",_value:"right"},{text:this.findLangS("menu","disable"),_menuId:"flags_ip",_value:"disable"}],listeners:{beforeshow:function(o){for(var n=0;
n<o.items.length;
n++){var m=o.items.get(n);
m.setChecked(m._value==user.sqlrow.uc_enable_flags_ss7_ip)
}}}}}]});
if(existsHttpJj){f.push({text:findLangS("http","menu","showHttpJjViaExternalTransactionId"),scope:this,handler:this.showHttpJjViaExternalTransactionId})
}if(d.length){d.push("-")
}d.push({xtype:"splitbutton",scope:this,text:this.findLangS("button","filterForm"),tooltip:this.findLangS("button_help","filterForm"),iconCls:"icon_find",handler:function(){this.createFilterWindow()
},arrowCls:"link_grey",arrowHandler:this.viewUrl,listeners:{scope:this,afterrender:function(m){m.getEl().down(".x-btn-link_grey").dom.setAttribute("data-qtip",this.findLangS("button_help","viewUrl"))
}},_id:"setFilter"},{scope:this,text:this.findLangS("button","resetFilter"),tooltip:this.findLangS("button_help","resetFilter"),iconCls:"icon_find",handler:this.resetFilter,disabled:true,_id:"resetFilter"},{scope:this,text:this.findLangS("button","settings"),tooltip:this.findLangS("button_help","settings"),iconCls:"icon_wrench",_btnId:"settings",menu:{scope:this,defaults:{scope:this,handler:k},items:f,listeners:{scope:this,beforeshow:function(m){m.items.get(m.items.findIndex("_menuId","enableDns")).setChecked(user.sqlrow&&user.sqlrow.uc_enable_dns_ss7)
}}}},"-",{xtype:"displayfield",value:"&nbsp;"+this.findLangS("field","searchCallerCalled")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",_gridForm:this,width:110,onChangeValue:function(m){this.setFilterItemValue("callerd_type",0,m,true);
this.setFilterItemValue("callerd_search_type",3,false,true);
this.setFilterItemValue("caller",m)
},_id:"qsearch_callerd"});
var g=[this.findLangS("button","refreshInterval")+":&thinsp;",{xtype:"numberfield",width:__width_ColumnNum(4)+ +__width_Trigger,minValue:1,maxValue:9999,step:1,enableKeyEvents:true,listeners:{scope:this,change:function(m){this.setTimeoutRefreshInterval(m)
},keyup:function(n,m){this.setTimeoutRefreshInterval(n)
}},fieldStyle:{"text-align":"right"}}]
}if(b.enableTbarRibbonDateFromTo){d.push({xtype:"buttongroup",title:this.findLangS("tbar","dateTimeRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("tbar","dateTimeFrom")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:b.form_filters&&b.form_filters.time_from?clone(b.form_filters.time_from):null,_buttonGroup:true,onSetDate:function(n,m){this.setFilterItemValue("time_from",m)
},onSetDateScope:this},{value:this.findLangS("tbar","dateTimeTo")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:b.form_filters&&b.form_filters.time_to?clone(b.form_filters.time_to):null,_buttonGroup:true,onSetDate:function(n,m){this.setFilterItemValue("time_to",m)
},onSetDateScope:this}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(b.enableTbarRibbonFilterButton){d.push({xtype:"buttongroup",title:this.findLangS("tbar","menu"),columns:1,defaults:{xtype:"displayfield"},items:[{xtype:"button",text:this.findLangS("tbar","filter"),iconCls:"icon_find",handler:function(){this.createFilterWindow({disableTimeInterval:true,modal:true})
},scope:this,style:{marginTop:9,marginBottom:12}}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(b&&b.form_filters&&!b.extraParams){b.extraParams={form_filters:Ext.encode(b.form_filters)}
}var l=null;
if(!b||!b.disablePagingToolbar){l={listeners:{beforechange:function(m,n){if(n!=m.store.currentPage){m._changePage=true
}}}}
}else{if(b.enableTbarRibbonPaginator){l={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud}};
d.push({xtype:"buttongroup",title:this.findLangS("tbar","paginator"),items:l,style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}b=Ext.applyIf(b||{},{url:"php/model/sql.php",module:"ss7",storeId:"SS7",recordStruct:rsSs7,sortField:"time_iam",sortDirection:"desc",remoteSort:true,pageSize:b.disablePagingToolbar&&!b.enableTbarRibbonPaginator?-1:(b.pageSize||30),enableAutoLoad:false,level:1,columns:this.getColumns(b,this),columnsDefaults:{tdCls:"vertical-align-middle",sortable:false},tbar:d.length?d:undefined,paginatorBehindButtonsItems:g.length?g:undefined,prefixCls:b.module||"ss7"+(b&&b.level>1?"_"+(b.level-1):""),stripeRows:false,paginator:l||undefined,plugins:[{ptype:"rowexpander",rowBodyContentCls:"SS7.GridExpPanel",expandOnEnter:false,expandOnDblClick:false},"gridfilters","columnSort"],loadingText:getLoadMaskWithStopButton_loading_text("ss7Grid_loadMask"),viewConfigListeners:{expandbody:function(){if(this._panel){this._panel.collapseGroup()
}},render:function(m){m.tip=Ext.create("Ext.tip.ToolTip",{target:m.el,delegate:m.cellSelector,trackMouse:true,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,listeners:{beforeshow:function n(r){var p=m.getHeaderByCell(r.triggerElement);
var s=Ext.fly(r.triggerElement).up(".x-grid-row");
if(s){var o=m.getRecord(s);
if(p&&p.dataIndex=="proxy"){var q=Ext.decode(o.data.proxy);
if(q&&q.length>4){htmlProxy=m.store._grid.renderProxy(o.data.proxy);
if(htmlProxy){htmlProxy='<div style="padding-left: 5; padding-right: 5;">'+htmlProxy+"</div>";
r.update(htmlProxy);
return
}}}}r.update(null)
}}})
}},listeners:{scope:this,afterrender:function(){if(this.gridPanel&&this.gridPanel._mainSs7Table&&isInitSs7SelectUrlParams()){if(window.ss7Id){this.initFilter();
if(this._panel){this._panel.setTitleSs7()
}if(ss7Id[0]=="["&&ss7Id[ss7Id.length-1]=="]"&&Ext.JSON.decode(ss7Id)){this.filters.addFilter({dataIndex:"ID",type:"string",value:Ext.JSON.decode(ss7Id).join(",")})
}else{this.filters.addFilter({dataIndex:"ID",type:"string",value:ss7Id})
}}else{this.initFilter();
c.call(this);
if(this._panel){this._panel.setTitleSs7()
}if(window.ss7_group_data&&this._panel&&this._panel.groupPanel){Ext.defer(function(){this._panel.groupPanel.applyGroupData();
this.reload({page:1})
},250,this)
}else{this.reload({page:1})
}this.setToolbarFilterItems()
}}else{this.initFilter();
if(this._panel){this._panel.setTitleSs7()
}this.reload({page:1})
}}},proxy_timeout:60*60*1000});
this.callParent([b]);
this.store.on("beforeload",h,this);
this.store.on("load",a,this);
this.store._params=["dir","limit","module","sort","start","task"];
function h(){beginLoadMaskWithStopButton_store(this.store,"ss7Grid_loadMask")
}function a(){endLoadMaskWithStopButton_store(this.store);
if(this._paginator){if(!this._paginator._changePage&&!loadStoreIsCancel(this.store)){if(this._panel&&this._panel.groupPanel){this._panel.groupPanel.reloadSs7Stats(this,this.store)
}if(this.gridPanel&&this.gridPanel.chartsPanel){this.gridPanel.reloadCharts()
}}this._paginator._changePage=false
}}function c(){if(window.ss7_filter){this.form_filters=Ext.decode(window.ss7_filter);
for(var m in this.form_filters){switch(m){case"time_from":case"time_to":this.form_filters[m]=dateTimeStringToDate(this.form_filters[m]);
break
}}this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters)
}if(window.ss7_group_data&&this._panel&&this._panel.groupPanel){var n=Ext.decode(window.ss7_group_data);
this._panel.groupPanel.setGroupData(n)
}}function k(n){if(n._menuId=="enableDns"||n._menuId=="flags_number"||n._menuId=="flags_ip"){if(!user.sqlrow){user.sqlrow={}
}var m;
var o;
switch(n._menuId){case"enableDns":m="uc_enable_dns_cdr";
o=n.checked?1:0;
n.ownerCt.hide();
break;
case"flags_number":m="uc_enable_flags_ss7_number";
o=n._value;
n.ownerCt.ownerCmp.ownerCt.ownerCmp.ownerCt.hide();
break;
case"flags_ip":m="uc_enable_flags_ss7_ip";
o=n._value;
n.ownerCt.ownerCmp.ownerCt.ownerCmp.ownerCt.hide();
break
}user.sqlrow[m]=o;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setItemUserConfigSqlrow",params:Ext.encode({item:m,value:o})},success:function(p){this.reload()
},maskEl:this,deferMask:true})
}}},onStoreLoad:function(b,a,d,c){if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(ActiveModule=="SS7"&&this.isVisible()&&!reloginForm&&!this._windowFilter&&!this.rowExpander.isAnyExpand()){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}},getColumns:function(c,a,b){var g=this;
var f=window.displaySensorNameCdr?"ID_sensor_name":"ID_sensor";
var d=[{headerLang:f,dataIndex:"ID",align:"center",width:50,sortable:true,filter:{type:"string"},renderer:function(o,h,k,p,n,l){if(!k.data.id_sensor&&!k.data._id_sensor){return(o)
}var m=window.displaySensorNameCdr&&k.data.sensorname?'&thinsp;<span style="font-size: 80%">'+k.data.sensorname+"</span>":"";
return'<div style = "text-align:center">'+o+"<br>"+(k.data.id_sensor?k.data.id_sensor+m:'<i style="color: grey;">'+k.data._id_sensor+"</i>")+"</div>"
}},{dataIndex:"time_iam",align:"center",width:__width_ColumnDate,sortable:true,renderer:function(o,h,l,p,n,m){var k=Ext.Date.format(o,__format_DateDb)+"<br>"+Ext.Date.format(o,window.time_precision_ss7_in_ms?__format_TimeMsDb:__format_TimeDb)+(l.data.time_rlc?'<br><span style="color: grey;">'+Ext.Date.format(l.data.time_rlc,window.time_precision_ss7_in_ms?__format_TimeMsDb:__format_TimeDb)+"</span>":"");
return(k)
}},{dataIndex:"duration",align:"center",width:__width_ColumnNum(11),sortable:true,renderer:function(o,h,l,p,n,m){var k=(!Ext.isEmpty(o)?formatNumber(o,window.time_precision_ss7_in_ms?3:0):0)+(l.data.progress_time?'<span style="font-size: 9; color: '+(l.data.progress_time<=3?"green":l.data.progress_time<=6?"chocolate":"red")+';">&nbsp;('+formatNumber(l.data.progress_time,window.time_precision_ss7_in_ms?3:0)+")</span>":"")+(l.data.connect_duration?'<br><span style="color: green;">'+formatNumber(l.data.connect_duration,window.time_precision_ss7_in_ms?3:0)+"</span>":"");
return(k)
},sortBy:{duration:this.findLangS("sortBy","duration"),progress_time:this.findLangS("sortBy","progress_time"),connect_duration:this.findLangS("sortBy","connect_duration")}},{dataIndex:"cic",align:"center",width:__width_ColumnNum(5),sortable:true},{dataIndex:"caller_number",align:"center",width:__width_ColumnNum(18),sortable:true,renderer:function(o,h,l,p,n,m){var k=l.data.caller_number_with_flag+(Ext.isDefined(l.data.opc)?"<br>opc: "+l.data.opc:"")+(l.data.src_ip_with_flag?"<br>"+l.data.src_ip_with_flag:"")+(l.data.src_ip_host?"<br><i>"+l.data.src_ip_host+"</i>":"");
return(k)
},sortBy:{caller_number:this.findLangS("sortBy","caller_number"),caller_number:this.findLangS("sortBy","opc")}},{dataIndex:"called_number",align:"center",width:__width_ColumnNum(18),sortable:true,renderer:function(o,h,l,p,n,m){var k=l.data.called_number_with_flag+(Ext.isDefined(l.data.dpc)?"<br>dpc: "+l.data.dpc:"")+(l.data.dst_ip_with_flag?"<br>"+l.data.dst_ip_with_flag:"")+(l.data.dst_ip_host?"<br><i>"+l.data.dst_ip_host+"</i>":"");
return(k)
},sortBy:{duration:this.findLangS("sortBy","called_number"),caller_number:this.findLangS("sortBy","dpc")}},{dataIndex:"state",align:"center",width:__width_ColumnChar(10),sortable:true,renderer:function(o,h,l,p,n,m){var k=getDataArrayItem(arSs7State,o);
return(k)
}},{dataIndex:"menu",width:90,align:"right",noCopyToClipboard:true,renderer:function(n,h,k,o,m,l){return n&&n.replaceall("__THIS_ID__",a.id)||"&nbsp;"
}}];
return(d)
},reconfigureColumns:function(){var a=this.getColumns(this,this,true);
this.reconfigure(this.store,a)
},createFilterWindow:function(f){this._windowFilter=true;
var b=Ext.applyIf(f||{},{values:this.form_filters||{}});
var g=SS7.Filter.getFieldset(b);
var d=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,layout:"fit",items:{xtype:"container",items:g},buttons:[{scope:this,text:this.findLangS("button","search"),iconCls:"icon_find",handler:a},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){c.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",d.el,{enter:a,scope:this});
SS7.Filter.setContextFields(d)
}},width:710+__width_Scroller+4,style:{padding:5}});
var c=new Ext.Window({scope:this,iconCls:"icon_find",title:this.findLangS("title","searchForm"),closable:true,border:false,plain:true,layout:"fit",modal:f&&f.modal,items:d,formPanelForAutoAdjustSize:d,listeners:{scope:this,activate:function(){if(!c.activated){var h=d.getForm().getFields();
var k=null;
for(var l=0;
l<h.getCount();
l++){var m=h.getAt(l);
if(!(m instanceof Ext.form.DisplayField)&&m.name!="callerd_search_type"&&m._type!="combolabel"){k=m;
break
}}if(k){k.focus(false,500)
}c.activated=true
}},destroy:function(){this._windowFilter=false
}}});
c.show();
function a(){if(d.getForm().isValid()){var h={};
if(f&&f.disableTimeInterval&&this.enableTbarRibbonDateFromTo){Ext.applyIf(h,{time_from:this.getFilterItemValue("time_from"),time_to:this.getFilterItemValue("time_to")})
}Ext.applyIf(h,SS7.Filter.fetchValuesFromFieldset(d));
this.setFilter(h);
c.destroy()
}}},initFilter:function(){if(!this.disableMenu){this.form_filters={};
this.form_filters.time_from=SS7.Filter.getDefaultDateFrom();
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters)
}},setFilter:function(a){this.form_filters=a;
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
this.reload({page:1});
this.setToolbarFilterItems()
},setFilterItemValue:function(b,d,c,a){if(d||d===0&&c){if(!this.form_filters){this.form_filters={}
}this.form_filters[b]=d;
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
if(!a){this.reload({page:1})
}}else{if(this.form_filters){delete this.form_filters[b];
if(!isDataEmpty(this.form_filters)){if(!a){this.resetFilter()
}}else{this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
if(!a){this.reload({page:1})
}}}}if(!a){this.setToolbarFilterItems()
}},getFilterItemValue:function(a){return(this.form_filters&&this.form_filters[a]||null)
},resetFilter:function(){this.initFilter();
this.reload({page:1});
this.enableBtn("resetFilter",false);
this.setToolbarFilterItems()
},isFilterEmpty:function(){if(!this.form_filters||!this.form_filters.time_from){return(false)
}var b=cloneObject(this.form_filters);
SS7.Filter.optimizeFilterItems(b);
for(var a in b){if(a!="time_from"||!b.time_from.getTime||b.time_from.getTime()!=SS7.Filter.getDefaultDateFrom().getTime()){return(false)
}}return(true)
},reload:function(a){if(a&&a.page){this.store.currentPage=a.page;
Ext.apply(a,{start:(a.page-1)*this.store.pageSize})
}this.store.load(a);
if(this._panel){this._panel.setTitleSs7()
}},setToolbarFilterItems:function(){this.setToolbarFieldValue("qsearch_callerd",this.form_filters&&!this.form_filters.callerd_type?this.form_filters.caller:"");
this.enableBtn("resetFilter",!this.isFilterEmpty())
},getSelectParams:function(){var b={};
for(var a in this.store.proxy.extraParams){if(this.store._params.indexOf(a)<0){b[a]=this.store.proxy.extraParams[a]
}}return b
},setGroupSelect:function(d,c,a,b){this.clearGroupSelect();
this.store.proxy.extraParams["group_"+d+(c?"_"+c:"")]=a;
if(b){this.reload({page:1})
}},setGroupSelectByDataRecord:function(d,c,a,b){this.setGroupSelect(d,c,a[d],b)
},clearGroupSelect:function(c,a){var d=false;
for(var b in this.store.proxy.extraParams){if(b.match&&b.match(/^group_.*/)&&!Ext.isEmpty(this.store.proxy.extraParams[b])){this.store.proxy.extraParams[b]=null;
d=true
}}if(d){if(c){this.reload()
}if(a&&this._panel){this._panel.deselectAllGroupSelects()
}return true
}return false
},setGroupFilter:function(b,c,a){if(b.match(/^groupfilter_/)){b=b.substr(12)
}this.store.proxy.extraParams["groupfilter_"+b]=c;
if(!a){this.reload({page:1})
}},clearGroupFilter:function(){for(var a in this.store.proxy.extraParams){if(a.match&&a.match(/^groupfilter_.*/)){this.store.proxy.extraParams[a]=null
}}if(this._panel){this._panel.deselectAllGroupFilters()
}},doDownloadPcap:function(b,a){SS7.Utils.prepareDownloadPcap(this,b,function(c){if(a){var d=new Tools.AuditForm({ss7Id:b,activity:_AuditActivity_download_pcap,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(c,300)
},fceCancel:function(){unlinkPrepareFileHash(c)
},fceContinueScope:this});
d.audit()
}else{downloadPrepareFileHash(c)
}})
},exportToCsv:function(a){formPostSafe("php/model/sql.php","POST",{module:"ss7",task:"CSV",dummy:new Date()})
},viewUrl:function(){var f=window.location.origin+window.location.pathname;
var d={};
var c=SS7.Filter.getArrayOfFields();
for(var b in this.form_filters){if(Ext.isString(b)&&c.inArray(b)&&Ext.isDefined(this.form_filters[b])&&this.form_filters[b]!==null&&this.form_filters[b]!==""){d[b]=this.form_filters[b]
}}var a={};
if(this._panel&&this._panel.groupPanel){a=this._panel.groupPanel.getGroupData()
}if(!isDataEmpty(d)||!isDataEmpty(a)){f+="?"
}if(!isDataEmpty(d)){SS7.Filter.optimizeFilterItems(d);
f+="ss7_filter="+encodeURIjson(Ext.encode(d))
}if(!isDataEmpty(a)){if(!isDataEmpty(d)){f+="&"
}f+="ss7_group_data="+encodeURIjson(Ext.encode(a))
}var g='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+f+'" target="_blank">'+f+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(findLangS(this.subsystem,"title","viewUrl"),g,function(){var h=Ext.getCmp("copy_button");
if(h){h.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(h){return(h.clipboardText)
},getClipTextParams:{clipboardText:f},id:"copy_button",renderTo:"copy_button_div"})
},showHttpJjViaExternalTransactionId:function(){new HTTP.ViewHttp({_window:true})
},renderProxy:function(d,a){rsltValue=null;
if(d){var c=Ext.decode(d);
if(c&&c.length){rsltValue="";
for(var b=0;
b<(a?Math.min(a,c.length):c.length);
b++){if(rsltValue){rsltValue+="<br>"
}rsltValue+=c[b][0];
if(c[b].length>1&&c[b][1]){rsltValue+="<br><i>"+c[b][1]+"</i>"
}}if(a&&c.length>a){rsltValue+="<br><b>...</b>"
}}}return(rsltValue)
},showHistory:function(a){new SS7.HistoryPanel({ss7Id:a,autoOpenWindow:true,windowTitle:this.findLangS("title","history")})
}});
Ext.define("SS7.SummaryPanel",{extend:"Ext.Panel",alias:"widget.SS7_summaryPanel",subsystem:"ss7",constructor:function(b){var c=847;
if(b.record&&b.record.data.menu_pcap){b.record.data.menu_pcap=b.record.data.menu_pcap.replaceall("__THIS_ID__",b.grid?b.grid.ownerCt.id:b.id)
}var a=new Ext.Template('<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-right: 4px;">',"<thead><tr>","<th>Start","<th>Duration","<th>Progress time","<th>Connected","<th>Caller","<th>Called",(b.enableDownloadPcap&&b.record.data.menu_pcap?"<th>PCAP":""),"</tr></thead>","<tbody><tr>","<td>"+Ext.Date.format(b.record.data.time_iam,__format_DateTimeDb),"<td>{duration}","<td>{progress_time}","<td>{connect_duration}","<td>{caller_number}","<td>{called_number}",(b.enableDownloadPcap&&b.record.data.menu_pcap?"<td>"+b.record.data.menu_pcap:""),"</tr></tbody>","</table>",'<table border="0">',"<tr>",'<td style="vertical-align: top;">','<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-bottom: 4px; width: 312px; table-layout: fixed;">',"<tr><td>CIC<td>{cic}","<tr><td>OPC<td>{opc}","<tr><td>DPC<td>{dpc}",b.record.data.src_ip?"<tr><td>Source IP<td>"+b.record.data.src_ip+(b.record.data.src_ip_host?"<br>"+b.record.data.src_ip_host:""):"",b.record.data.dst_ip?"<tr><td>Destination IP<td>"+b.record.data.dst_ip+(b.record.data.dst_ip_host?"<br>"+b.record.data.dst_ip_host:""):"","</table>",'<td style="vertical-align: top;">','<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-bottom: 4px; width: 312px; table-layout: fixed;">',"<tr><td>STATE<td>"+getDataArrayItem(arSs7State,b.record.data.state),"</table>",'<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="margin-top: 4px; margin-left: 4px; margin-bottom: 4px; width: 312px; table-layout: fixed;">',"<tr><td>IAM<td>"+Ext.Date.format(b.record.data.time_iam,__format_TimeDb)+"<td>",b.record.data.time_acm?"<tr><td>ACM<td>"+Ext.Date.format(b.record.data.time_acm,__format_TimeDb)+'<td style="text-align: right">'+(b.record.data.time_acm.getTime()-b.record.data.time_iam.getTime())/1000+"s":"",b.record.data.time_cpg?"<tr><td>CPG<td>"+Ext.Date.format(b.record.data.time_cpg,__format_TimeDb)+'<td style="text-align: right">'+(b.record.data.time_cpg.getTime()-b.record.data.time_iam.getTime())/1000+"s":"",b.record.data.time_anm?"<tr><td>ANM<td>"+Ext.Date.format(b.record.data.time_anm,__format_TimeDb)+'<td style="text-align: right">'+(b.record.data.time_anm.getTime()-b.record.data.time_iam.getTime())/1000+"s":"",b.record.data.time_rel?"<tr><td>REL<td>"+Ext.Date.format(b.record.data.time_rel,__format_TimeDb)+'<td style="text-align: right">'+(b.record.data.time_rel.getTime()-b.record.data.time_iam.getTime())/1000+"s":"",b.record.data.time_rlc?"<tr><td>RLC<td>"+Ext.Date.format(b.record.data.time_rlc,__format_TimeDb)+'<td style="text-align: right">'+(b.record.data.time_rlc.getTime()-b.record.data.time_iam.getTime())/1000+"s":"","</table>","</table>");
Ext.applyIf(b,{title:this.findLangS("title","summaryTab"),html:a.applyTemplate(b.record&&b.record.data||{}),iconCls:"icon_table_lightning"});
this.callParent([b])
},doDownloadPcap:function(b,a){SS7.Utils.prepareDownloadPcap(this,b,function(c){if(a){var d=new Tools.AuditForm({ss7Id:b,activity:_AuditActivity_download_pcap,autoAudit:a==2,fceContinue:function(){downloadPrepareFileHash(c,300)
},fceCancel:function(){unlinkPrepareFileHash(c)
},fceContinueScope:this});
d.audit()
}else{downloadPrepareFileHash(c)
}})
}});
Ext.define("SS7.HistoryPanel",{extend:"Ext.ux.grid.GridForm",alias:"widget.SS7_historyPanel",subsystem:"ss7",constructor:function(a){this.verticalTextViaSvg=false;
a=Ext.applyIf(a||{},{storeId:"SS7_tshark_"+a.ss7Id,url:"php/pcap2text.php?action=brief_data&ss7=1&id="+a.ss7Id,recordStruct:rsSs7_tshark,sortField:"time",columns:this.getColumns(null,a),columnsDefaults:{sortable:false},stripeRows:false,disableInsertButton:true,disableEditButton:true,disableDeleteButton:true,fullColumnSize:"msg",fullColumnSizeDecrement:2,titleLang:"historyTab",enableColumnMove:false});
this.callParent([a]);
if(this.autoOpenWindow){this.openWindow()
}},getColumns:function(a,g){if(!g){g=this
}var d=this;
var c=[{headerLang:"time_s",dataIndex:"time",widthNum:10,align:"right",sortable:true,renderer:f,menuDisabled:true},{dataIndex:"direction",widthCh:8,align:"center",menuDisabled:true,renderer:function(n,h,k,p,m,l){h.style="padding: 0";
var o=d.ss7Data.opc==k.data.ss7_opc?"images/arrow_31x21-SH-RR-black.png":d.ss7Data.dpc==k.data.ss7_opc?"images/arrow_31x21-SH-LL-black.png":null;
if(!o){return
}rslt='<div style="background-image: url('+o+'); background-repeat: no-repeat; background-position: center; height: 20;"></div>';
return(rslt)
}},{xtype:"actioncolumn",headerLang:"ss7Msg",dataIndex:"msg",widthCh:80,rendererBase:renderString,items:[{getClass:function(h,k,l){return("icon_magnifier")
},handler:function(k,p,h,l,m){var n=k.store.getAt(p);
var o={id:this.ss7Id,num:n.data.num,find_pass:n.data.find_pass,ss7:true,spec_type:n.data.spec_type};
showPacketDetail(o,this.findLangS("title","packetDetail"),false,true)
},enableHandler:function(h,k,l){return(true)
},scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20",menuDisabled:true}];
for(var b=0;
b<c.length;
b++){c[b].header=(c[b].headerLang||c[b].dataIndex)&&this.findLangS("column",c[b].headerLang||c[b].dataIndex)||c[b].header
}return(c);
function f(o,l,k,p,n,m,h){return(formatNumber(o,6))
}},openWindow:function(){var b=Math.min(1280,Ext.dom.Element.getViewportWidth()-20);
var a=Ext.dom.Element.getViewportHeight()-30;
var c=new Ext.Window({title:this.windowTitle,closable:true,maximizable:true,resizable:true,layout:"fit",items:this,width:b,height:a});
c.show()
}});
Ext.define("SS7.GridExpPanel",{extend:"Ext.Panel",subsystem:"ss7",constructor:function(a){this.tabPanel=new Ext.TabPanel({items:{xtype:"SS7_summaryPanel",border:false,record:a.record,grid:a.grid,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}},activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:a.grid.prefixCls+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
this.history=new SS7.HistoryPanel({ss7Id:a.record.data.ID,ss7Data:a.record.data,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","historyTab")});
this.history.store.on("load",function(b){if(b.proxy.reader.rawData.errors&&b.proxy.reader.rawData.errors.missingPcapInTar){this.history.setIconCls("icon_light_switch");
this.history.setReloadInfo(b.proxy.reader.rawData.errors.snifferError||(b.proxy.reader.rawData.errors.missingPcapInTar?this.findLangS("text","dataAreNotYetWrittenToDisk"):lang.alertAjaxErrorMsgUnknown))
}else{if(b.getCount()>0){this.history.setIconCls("icon_light_on")
}else{this.history.setIconCls("icon_light_off")
}}},this);
this.tabPanel.add(this.history);
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("SS7.GroupPanel",{extend:"Ext.Panel",subsystem:"ss7",constructor:function(a){SS7.GroupPanel.superclass.constructor.call(this,a)
}});
Ext.define("SS7.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.SS7PanelX",subsystem:"ss7",constructor:function(a){this.ss7Panel=new SS7.GridPanel({border:false,ss7Panel:this,region:"center",_panel:this,_mainSs7Table:true});
var b=[this.ss7Panel];
this.ss7=this.ss7Panel.grid;
if(false){this.groupPanel=new SS7.GroupPanel({id:"SS7-group-panel",collapsible:true,collapsedCls:"no-border",region:"south",floatable:true,span:true,border:false,title:this.findLangS("title","groups"),_panel:this,_ss7:this.ss7,collapsible:true,header:false});
this.ss7._groupPanel=this.groupPanel;
this.groupPanel._ss7=this.ss7;
b.push(this.groupPanel)
}a=Ext.applyIf(a||{},{id:"SS7-panel",title:this.findLangS("title","SS7"),iconCls:"icon_menu_cdr",layout:"border",bodyBorder:false,defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:b,listeners:{scope:this,afterrender:function(){if(!Ext.isIE){var c=Ext.get("SS7-panel_header");
if(c){c.setStyle({"padding-top":1,"padding-bottom":1})
}}}},wikiId:"SS7",wikiButtonMarginTop:-1});
this.callParent([a])
},deselectAllGroupFilters:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupFilters()
}},deselectAllGroupSelects:function(){if(this.groupPanel){this.groupPanel.deselectAllGroupSelects()
}},setTitleSs7:function(){if(Ext.isIE){var d=this.findLangS("title","SS7");
if(this.ss7.getFilterItemValue("time_from")){d+="&nbsp;&nbsp;&nbsp;from date&nbsp;"+Ext.Date.format(this.ss7.getFilterItemValue("time_from"),__format_Date)
}if(this.ss7.getFilterItemValue("time_to")){d+="&nbsp;&nbsp;&nbsp;to date&nbsp;"+Ext.Date.format(this.ss7.getFilterItemValue("time_to"),__format_Date)
}this.setTitle(d);
return
}var c=this.getDateFrom();
var b=this.getDateTo();
if(!this.formTitle){this.setTitle('<div id="ss7_title" style="position: relative; left: 0; top: 0; width: 500; height: 22"/>');
var a=getStdMenuTimeFrom(this,function(f){var h=dateTimeM(getTimeInterval(f._typeTimeFrom)[0]);
var g=getTimeInterval(f._typeTimeFrom)[1];
if(g){g.timeDefined=false
}this.ss7.setFilterItemValue("last_days",null,true,true);
this.ss7.setFilterItemValue("last_minutes",null,true,true);
this.ss7.setFilterItemValue("time_to",g,false,true);
this.ss7.setFilterItemValue("time_from",h)
});
a.items.push({xtype:"menuseparator"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:"Last ",fieldCls:"x-menu-item-text"},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",width:50,_id:"last_days",minValue:0,maxValue:365,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}},select:function(f){if(!f._disableChangeEvent){this.setLastDays(f.getValue(),Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_minutes").getValue())
}},change:function(f){if(!f._disableChangeEvent){this.setLastDays(f.getValue(),Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_minutes").getValue())
}},scope:this},tooltip:lang.days},{xtype:"displayfield",value:lang.days,fieldCls:"x-menu-item-text"}],style:{marginBottom:1}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",width:50,_id:"last_minutes",minValue:0,maxValue:24*60,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}},select:function(f){if(!f._disableChangeEvent){this.setLastDays(Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_days").getValue(),f.getValue())
}},change:function(f){if(!f._disableChangeEvent){this.setLastDays(Ext.getCmp(f.getEl().up(".x-menu-item-cmp").id).findC("_id","last_days").getValue(),f.getValue())
}},scope:this},tooltip:lang.minutes},{xtype:"displayfield",value:lang.minutes,fieldCls:"x-menu-item-text"}]}]}],style:{marginLeft:27}});
a.listeners={beforeshow:function(h){var g=h.findC("_id","last_days");
if(g){g._disableChangeEvent=true;
+g.setValue(this.ss7.getFilterItemValue("last_days")||"");
+delete g._disableChangeEvent
}var f=h.findC("_id","last_minutes");
if(f){f._disableChangeEvent=true;
+f.setValue(this.ss7.getFilterItemValue("last_minutes")||"");
+delete f._disableChangeEvent
}},scope:this};
this.formTitle=new Ext.form.FormPanel({items:{layout:{type:"hbox",align:"middle"},xtype:"container",items:[{xtype:"displayfield",value:this.findLangS("title","SS7")+" - from date&nbsp;",fieldCls:"x-panel-header-title-default",width:95,height:16},{xtype:"DateField2T",name:"fdatefrom",value:clone(c),format:__format_DateTimeM,width:125+__width_Trigger,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){this.ss7.setFilterItemValue("time_from",f)
},blur:function(f){var g=f.getValue();
if(g){g.timeDefined=true
}if(!eqDate(g,this.ss7.getFilterItemValue("time_from"))){this.ss7.setFilterItemValue("time_from",g)
}},specialkey:function(g,f){if(f.getKey()==f.ENTER){var h=g.rawToValue(g.getRawValue());
if(h){h.timeDefined=true
}if(!eqDate(h,this.ss7.getFilterItemValue("time_from"))){this.ss7.setFilterItemValue("time_from",h)
}}}},t2menu:a},{xtype:"displayfield",value:"&nbsp;&nbsp;to date",fieldCls:"x-panel-header-title-default",width:51,height:16},{xtype:"datefield",name:"fdateto",value:clone(b),format:__format_Date,width:90,style:{paddingTop:2},fieldStyle:{background:__color_FormBackground,height:"17 !important","min-height":"17 !important"},listeners:{scope:this,select:function(g,f){f.timeDefined=false;
this.ss7.setFilterItemValue("time_to",f)
},blur:function(g){var f=g.getValue();
if(f){f.timeDefined=false
}if(!eqDate(f,this.ss7.getFilterItemValue("time_to"))){this.ss7.setFilterItemValue("time_to",f)
}},specialkey:function(h,g){if(g.getKey()==g.ENTER){var f=h.rawToValue(h.getRawValue());
if(f){f.timeDefined=false
}if(!eqDate(f,this.ss7.getFilterItemValue("time_to"))){this.ss7.setFilterItemValue("time_to",f)
}}}}}]},border:false,bodyStyle:{background:"transparent"},renderTo:"ss7_title",width:600})
}else{this.formTitle.getForm().findField("fdatefrom").setValue(clone(c));
this.formTitle.getForm().findField("fdateto").setValue(clone(b))
}},collapseGroup:function(){if(this.groupPanel){this.groupPanel.collapse()
}},reactivate:function(){if(window.needSs7ColumnsReconfigure){this.ss7.reconfigureColumns();
window.needSs7ColumnsReconfigure=false
}this.ss7.reload()
},changeTimezone:function(){this.ss7.reload()
},setLastDays:function(c,b){this.ss7.setFilterItemValue("last_days",c,null,true);
this.ss7.setFilterItemValue("last_minutes",b,null,true);
if(this.setLastDaysTimer){clearTimeout(this.setLastDaysTimer);
delete this.setLastDaysTimer
}var a=this;
this.setLastDaysTimer=setTimeout(function(){a.ss7.reload({page:1});
delete a.setLastDaysTimer
},500)
},getDateFrom:function(){var c=this.ss7.getFilterItemValue("time_from");
if(this.ss7.getFilterItemValue("last_minutes")>0){var a=new Date(dateTime().getTime()-this.ss7.getFilterItemValue("last_minutes")*60*1000);
if(this.ss7.getFilterItemValue("last_days")>0){c=date(a);
for(var b=0;
b<this.ss7.getFilterItemValue("last_days");
b++){c=date_prev(c)
}c=completeDateTime(c,a)
}else{c=a
}}else{if(this.ss7.getFilterItemValue("last_days")>0){c=date();
for(var b=0;
b<this.ss7.getFilterItemValue("last_days");
b++){c=date_prev(c)
}}}return(c)
},getDateTo:function(){return(this.ss7.getFilterItemValue("last_days")>0||this.ss7.getFilterItemValue("last_minutes")>0?null:this.ss7.getFilterItemValue("time_to"))
}});
Ext.define("SS7.Filter",{singleton:true,subsystem:"ss7",getFieldset:function(c){c=c||{};
c.prop=c.prop||{};
Ext.applyIf(c.prop,{fieldaWidth:__width_FieldChar(22),fieldbWidth:__width_FieldChar(22),fieldwWidth:__width_FieldChar(35),label1Width:__width_FieldChar(14),label2aWidth:__width_FieldChar(22),label2bWidth:__width_FieldChar(13),btnSwitchWidth:16,btnSwitchHeight:16,label1Style:{},label1CheckboxStyle:{"margin-left":10},label1aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label1alStyle:{"margin-right":__width_LabelFieldSeparator},label2aStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},label2bStyle:{"text-align":"right","margin-right":__width_LabelFieldSeparator},labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"}});
var a=[];
if(!c.disableTimeInterval){a.push({items:[{xtype:"displayfield_vo3",value:"timeRange:",_type:"label1"},{xtype:"displayfield_vo3",value:"timeFrom",_type:"label2ap"},{xtype:"datetimefield",name:"time_from",value:c.values.time_from,_type:"fielda",inEditor:true,zeroTimeEmpty:true,allowBlankDate:false},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"timeTo",_type:"label2b"},{xtype:"datetimefield",name:"time_to",value:c.values.time_to,_type:"fieldb",inEditor:true,zeroTimeEmpty:true}]},{items:[{xtype:"displayfield_vo3",value:"lastDaysMinutes:",helpText:"lastDaysMinutesHelp",_type:"label1al"},{xtype:"numberfield",name:"last_days",value:c.values.last_days,_type:"fielda",minValue:0,maxValue:365,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}}}},{xtype:"displayfield_vo3",value:lang.days,style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"last_minutes",value:c.values.last_minutes,_type:"fielda",minValue:0,maxValue:24*60,width:__width_FieldNum(4)+__width_Trigger,fieldStyle:{"text-align":"right"},listeners:{spindown:function(g){var f=g.getValue();
if(f==1||f===null){Ext.defer(function(){g.setValue(null)
},1)
}}}},{xtype:"displayfield_vo3",value:lang.minutes,style:{marginLeft:2}}]})
}a.push({items:[{xtype:"image",src:"images/icon/page_wrench.png",width:14,height:14,style:{marginTop:4,marginRight:2,cursor:"pointer"},listeners:{click:{element:"el",fn:function(g,k){var f=Ext.getCmp(k.id).findFormPanel();
if(f){var h=f.getForm().findField("callerd_search_type");
if(h){h.expand()
}}}},scope:this}},{xtype:"ComboBoxA",name:"callerd_search_type",value:c.values.callerd_search_type||0,_type:"combolabel_main",aData:[[0,"num"],[1,"num_start"],[2,"num_end"],[3,"num_contain"],[4,"num_regexp"]],hideTrigger:true,_decWidth:16},{xtype:"ComboBoxA",name:"callerd_type",value:c.values.callerd_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"textfield",name:"caller",value:c.values.caller,_type:"fielda"},{xtype:"button",name:"callerd_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_label",value:"called",_type:"label2b"},{xtype:"textfield",name:"called",value:c.values.called,_type:"fieldb"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"countryCodeByNumber:",helpText:"countryCodeByNumberHelp",_type:"label1"},{xtype:"ComboBoxA",name:"country_code_callerd_type",value:c.values.country_code_callerd_type||0,_type:"combolabel",aData:[[0,"callerOrCalled"],[1,"caller"]]},{xtype:"country_tree_field",name:"country_code_caller",value:c.values.country_code_caller,_type:"fielda",helpFieldId:"country_code_caller"},{xtype:"button",name:"country_code_callerd_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"country_code_called_label",value:"called",_type:"label2b"},{xtype:"country_tree_field",name:"country_code_called",value:c.values.country_code_called,_type:"fieldb",helpFieldId:"country_code_called"}]});
a.push({items:[{xtype:"displayfield_vo3",_type:"label1"},{xtype:"ComboBoxA",name:"callerd_group_id_type",value:c.values.callerd_group_id_type||0,_type:"combolabel",aData:[[0,"callerOrCalledGroup"],[1,"callerGroup"]]},{xtype:"CBX_cbNumberGroups",name:"caller_group_id",value:c.values.caller_group_id,_type:"fielda",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true},{xtype:"button",name:"callerd_group_id_switch",_type:"btnswitch"},{xtype:"displayfield_vo3",name:"called_group_id_label",value:"calledGroup",_type:"label2b"},{xtype:"CBX_cbNumberGroups",name:"called_group_id",value:c.values.called_group_id,_type:"fieldb",hideLabel:true,_editTableButton:user_can_edit_codebooks(),_clearButton:true,_multiSelect2:true}]});
a.push({items:[{xtype:"displayfield_vo3",value:"cic:",helpText:"cicHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:"cicgt",value:c.values.cicgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"ciclt",value:c.values.ciclt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"opc:",helpText:"opcHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:"opcgt",value:c.values.opcgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"opclt",value:c.values.opclt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"dpc:",helpText:"dpcHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:"dpcgt",value:c.values.dpcgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"dpclt",value:c.values.dpclt,_type:"fieldb"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"duration:",helpText:"durationHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:"durationgt",value:c.values.durationgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"durationlt",value:c.values.durationlt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"connectDuration:",helpText:"connectDurationHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:"connect_durationgt",value:c.values.connect_durationgt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"connect_durationlt",value:c.values.connect_durationlt,_type:"fieldb"}]},{items:[{xtype:"displayfield_vo3",value:"progressTime:",helpText:"progressTimeHelp",_type:"label1"},{xtype:"displayfield_vo3",value:"operGt",_type:"label2a"},{xtype:"textfield",name:"progress_timegt",value:c.values.progress_timegt,_type:"fielda"},{_type:"btnswitch_filler"},{xtype:"displayfield_vo3",value:"operLt",_type:"label2b"},{xtype:"textfield",name:"progress_timelt",value:c.values.progress_timelt,_type:"fieldb"}]});
a.push({items:[{xtype:"displayfield_vo3",value:"sensor:",_type:"label1al"},{xtype:"CBX_sensor",name:"sensor_id",value:c.values.sensor_id||0,_type:"fielda",_noLabel:true,_addEmptySensorId:true,_clearButton:true}]});
for(var d=0;
d<a.length;
d++){if(a[d].items){for(var b=0;
b<a[d].items.length;
b++){if(a[d].items[b].xtype&&a[d].items[b].xtype.match("CBX_")){a[d].items[b].storeAutoLoad=false
}switch(a[d].items[b]._type){case"fielda":Ext.applyIf(a[d].items[b],{width:c.prop.fieldaWidth});
break;
case"fieldb":Ext.applyIf(a[d].items[b],{width:c.prop.fieldbWidth});
break;
case"fieldc":Ext.applyIf(a[d].items[b],{width:c.prop.fieldcWidth});
break;
case"label1":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width,style:c.prop.label1Style,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1checkbox":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width-c.prop.label1CheckboxStyle["margin-left"],style:c.prop.label1CheckboxStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"label1a":case"label1ap":case"label1al":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width+c.prop.label2aWidth,style:["label1a","label1ap"].isIn(a[d].items[b]._type)?c.prop.label1aStyle:c.prop.label1alStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label1ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2a":case"label2ap":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:c.prop.label2aStyle,fieldStyle:clone(c.prop.labelFieldStyle)});
if(a[d].items[b]._type=="label2ap"){Ext.applyIf(a[d].items[b].fieldStyle,{paddingRight:20})
}break;
case"label2b":Ext.applyIf(a[d].items[b],{width:c.prop.label2bWidth,style:c.prop.label2bStyle,fieldStyle:c.prop.labelFieldStyle});
break;
case"combolabel":Ext.applyIf(a[d].items[b],{width:c.prop.label2aWidth,style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:__color_FormBackground},listeners:{select:function(g){var f=g.findFormPanel();
if(f){SS7.Filter.setContextFields(f)
}}}});
break;
case"combolabel_main":Ext.applyIf(a[d].items[b],{width:c.prop.label1Width-(a[d].items[b]._decWidth||0),fieldStyle:{"text-align":"left",background:__color_FormBackground,border:"none","padding-left":"0px !important"},listeners:{select:function(g){var f=g.findFormPanel();
if(f){var h=f.getForm().findField("caller");
if(h){h.focus(false,200)
}SS7.Filter.setContextFields(f)
}},afterrender:function(f){f.inputWrap.setStyle({border:"none"})
}}});
break;
case"btnswitch":Ext.applyIf(a[d].items[b],{width:c.prop.btnSwitchWidth,border:false,style:{background:"transparent",marginTop:2,marginLeft:4,marginRight:4,height:c.prop.btnSwitchHeight},cls:"icon_arrow_switch_lr",handler:function(g){var f=g.findFormPanel();
if(f){SS7.Filter.switchContentFields(f,g.name)
}}});
break;
case"btnswitch_filler":Ext.applyIf(a[d].items[b],{xtype:"container",width:c.prop.btnSwitchWidth+8,border:false});
break
}}}Ext.applyIf(a[d],{xtype:"container",layout:"hbox",style:{paddingBottom:__height_FieldSeparator}})
}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(g){var f=g.findFormPanel();
if(f){SS7.Filter.setContextFields(f,true,g)
}},select:function(g){var f=g.findFormPanel();
if(f){SS7.Filter.setContextFields(f,true,g)
}}},function(f){return(f.xtype=="numberfield")
});
return(this.completeFields(a))
},completeFields:function(a){if(Ext.isArray(a)){for(var c=0;
c<a.length;
c++){this.completeFields(a[c])
}return(a)
}if(a.items){this.completeFields(a.items);
return(a)
}if(a.xtype&&a.xtype.match(/^displayfield/)&&a.value){var g=a.value;
var d=false;
if(g.match(/:$/)){g=g.substr(0,g.length-1);
d=true
}var f=findLangS(this.subsystem,"field_filter",g);
if(f){a.value=f;
if(d){a.value+=":"
}}if(a.helpText){a.helpText=findLangS(this.subsystem,"field_filter",a.helpText)||findLangS(this.subsystem,"field_filter",a.helpText+"Help")
}}if(a.xtype=="checkbox"&&a.boxLabel){var b=findLangS(this.subsystem,"field_filter",a.boxLabel);
if(b){a.boxLabel=b
}}if(a.aData){for(var c=0;
c<a.aData.length;
c++){if(Ext.isArray(a.aData[c])&&a.aData[c].length==2){var f=findLangS(this.subsystem,"field_filter",a.aData[c][1]);
if(f){a.aData[c][1]=f+(a._type=="combolabel_main"?":":"")
}}}}a.__filter="ss7";
return(a)
},fetchValuesFromFieldset:function(d){var c={};
if(d.getForm){d=d.getForm()
}var b=this.getArrayOfFields();
if(b){for(var a=0;
a<b.length;
a++){var g=this.findFilterField(d,b[a]);
if(g){var f=g.getValue();
if(Ext.isDefined(f)&&f!==""&&f!==null){c[b[a]]=g.getValue()
}}}}return(c)
},setValueFieldsFieldset:function(a,d){if(!d||!a){return
}if(d.getForm){d=d.getForm()
}var c=this.getArrayOfFields();
if(c){for(var b=0;
b<c.length;
b++){var f=this.findFilterField(d,c[b]);
if(f){f.setValue(a[c[b]])
}}}this.setContextFields(d)
},getArrayOfFields:function(b){var a=["time_from","time_to","last_days","last_minutes","callerd_search_type","caller","called","country_code_caller","country_code_called","caller_group_id","called_group_id","cicgt","ciclt","opcgt","opclt","dpcgt","dpclt","durationgt","durationlt","connect_durationgt","connect_durationlt","progress_timegt","progress_timelt","sensor_id"];
var c=this.abFields_Types();
if(c.length){a=a.concat(c)
}return(a)
},setContextFields:function(b){if(!b){return
}if(b.getForm){b=b.getForm()
}var c=this.fetchValuesFromFieldset(b);
this.enableField(b,"time_from",Ext.isEmpty(c.last_days)&&Ext.isEmpty(c.last_minutes));
this.enableField(b,"time_to",Ext.isEmpty(c.last_days)&&Ext.isEmpty(c.last_minutes));
var l=this.abFields_labelContext();
for(var o in l){var k=this.findFilterField(b,o);
if(k){fieldValue=k.getValue();
if(fieldValue==null){k.setValue(0);
fieldValue=0
}for(var f=0;
f<l[o].length;
f++){if(l[o][f]){var m=this.findFilterField(b,l[o][f]);
if(m){m.setVisible(fieldValue==1)
}}}}}var n=this.findFilterField(b,"callerd_search_type");
if(n){var d=n.getValue()==0;
var a=this.findFilterField(b,"caller_group_id");
if(a){a.enableIf(d);
if(!d){a.setValue(null)
}}var g=this.findFilterField(b,"called_group_id");
if(g){g.enableIf(d);
if(!d){g.setValue(null)
}}}var h=this.findFilterField(b,"caller_domain_group_id");
if(h){h.setSide(c.callerd_domain_group_id_type?_side_CallerNum:null)
}},switchContentFields:function(d,h){if(!d){return
}if(d.getForm){d=d.getForm()
}var g=this.abFields_switch();
if(g[h]){var c=[];
for(var b=0;
b<2;
b++){for(var a=0;
a<2;
a++){var f=this.findFilterField(d,g[h][a]);
if(b){f.setValue(c[a?0:1])
}else{c[a]=f.getValue()
}}}}},isDataSet:function(a){if(a.getForm){a=a.getForm()
}var b=this.fetchValuesFromFieldset(a);
delete b.calldate_from;
delete b.calldate_to;
return(isDataSet(b))
},getDefaultDateFrom:function(){return defaultCdrTypeInterval=="specified_days"?date((new Date).getTime()/1000-defaultCdrInterval*24*60*60):dateTimeM(getTimeInterval(defaultCdrTypeInterval)[0])
},findFilterField:function(c,d){if(!c){return(null)
}if(c.findField){c=c.owner
}var a=c.getItems(d,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(a[b].__filter=="ss7"){return(a[b])
}}}return(null)
},enableField:function(b,d,a){var c=this.findFilterField(b,d);
if(c){c.enableIf(a)
}},setValueField:function(a,d,b){var c=this.findFilterField(a,d);
if(c){c.setValue(b)
}},optimizeFilterItems:function(d){var g=this.abFields_typeAB();
for(var b in g){if(Ext.isDefined(d[b])){var f=g[b][0];
var c=g[b][1];
if(!d[f]&&!d[c]){delete d[b]
}}}var a=["callerd_search_type"];
for(var b=0;
b<a.length;
b++){if(Ext.isDefined(d[a[b]])&&!d[a[b]]){delete d[a[b]]
}}},abFields_Types:function(){var a=[];
for(var b in this.abFields){if(this.abFields[b].t){a.push(this.abFields[b].t)
}}return(a)
},abFields_labelContext:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].sw&&this.abFields[b].l&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].sw,this.abFields[b].l,this.abFields[b].b]
}}return(a)
},abFields_switch:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].sw&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].sw]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields_typeAB:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields:[{t:"callerd_type",a:"caller",b:"called",l:"called_label",sw:"callerd_switch"},{t:"country_code_callerd_type",a:"country_code_caller",b:"country_code_called",l:"country_code_called_label",sw:"country_code_callerd_switch"},{t:"callerd_group_id_type",a:"caller_group_id",b:"called_group_id",l:"called_group_id_label",sw:"callerd_group_id_switch"}]});
Ext.define("SS7.Utils",{singleton:true,subsystem:"ss7",prepareDownloadPcap:function(a,b,c){ajaxSafeRequest({scope:a,url:"php/pcap.php",params:{id:b,ss7:1,prepare:true},success:function(d){if(c){c.call(a,d)
}else{downloadPrepareFileHash(d)
}},maskEl:a,timeout:30*60*1000})
}});
function isInitSs7SelectUrlParams(){return(window.ss7Id||window.ss7_filter||window.ss7_group_data)
}function clearInitSs4SelectUrlParams(){window.ss7Id=null;
window.ss7_filter=null;
window.ss7_group_data=null
}Ext.ns("HTTP");
Ext.define("HTTP.ViewHttp",{extend:"Ext.Panel",subsystem:"http",constructor:function(c){if(!c){c={}
}var b=c._window?__color_WindowFrame:__color_FormBackground;
this.paramsForm=new Ext.form.FormPanel({items:HTTP.Filter.getFieldset({values:{},enableExternalTransactionId:true,prop:{colorBackground:b},_window:c._window,enableOkButton:true,okButtonHandler:this.onOk,okButtonScope:this}),border:false,style:{"background-color":b,padding:c._window?undefined:5},bodyStyle:{"background-color":b},listeners:{scope:this,afterrender:function(){HTTP.Filter.setContextFields(this)
}}});
this.sipHistory=new CDR.SipHistoryWithDiagramPanel({disableTbar:true,disableTabPanel:true,disableTitle:true,forWindowWithoutBorder:c._window,forPanel:!c._window,withoutDiagram:true,disableEmptyInfo:true,disableSipHistoryIfEmpty:true,sipHistoryConfig:{storeId:null,url:"php/model/sql.php",module:"sip_history_via_external_transaction_id",recordStruct:rsCDR_tshark,flexMsg:1,disabled:true}});
Ext.applyIf(c,{xtype:"container",layout:{type:"vbox",align:"stretch"},border:false,items:[this.paramsForm,{xtype:"container",height:c._window?10:4,style:{"background-color":b}},{xtype:"container",layout:"fit",items:this.sipHistory,flex:1}]});
this.callParent([c]);
if(c._window){var d=Math.min(1280,Ext.dom.Element.getViewportWidth()-20-Ext.dom.Element.getViewportWidth()/10);
var a=Ext.dom.Element.getViewportHeight()-30-Ext.dom.Element.getViewportHeight()/20;
var f=new Ext.Window({title:this.findLangS("title","showHttpJjViaExternalTransactionId"),closable:true,maximizable:true,resizable:true,layout:"fit",items:this,border:false,width:d,height:a});
f.show()
}},onOk:function(){if(this.paramsForm.getForm().isValid()){var b=HTTP.Filter.fetchValuesFromFieldset(this);
var a=b.date_time_from;
var c=b.date_time_to||new Date;
if((c.getTime()-a.getTime())/1000/3600>168){Ext.Msg.alert(lang.error,this.findLangS("text","maximumDateRangeIs168hours"))
}else{this.sipHistory.sipHistory.setExtraParams(b,true)
}}}});
Ext.define("HTTP.ViewHttp.Panel",{extend:"Ext.Panel",alias:"widget.HTTPPanelX",subsystem:"http",constructor:function(a){a=Ext.applyIf(a||{},{id:"HTTP-panel",title:this.findLangS("title","http"),iconCls:"icon_menu_cdr",layout:"fit",items:new HTTP.ViewHttp});
this.callParent([a])
}});
Ext.define("HTTP.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.HTTP.GridX",subsystem:"http",constructor:function(f){var k=[];
var g=[];
if(f&&f.customMenu){k=f.customMenu
}if(!f||!f.disableMenu){var c=[];
if(typeDb=="mysql"){c.push({text:this.findLangS("menu","exportCSV"),iconCls:"icon_excel",handler:this.exportToCsv,scope:this},{xtype:"menuseparator"})
}c.push({text:this.findLangS("menu","enableDns"),xtype:"menucheckitem",checked:user.sqlrow&&user.sqlrow.uc_enable_dns_http,_menuId:"enableDns"});
if(k.length){k.push("-")
}k.push({xtype:"splitbutton",scope:this,text:this.findLangS("button","filterForm"),tooltip:this.findLangS("button_help","filterForm"),iconCls:"icon_find",handler:function(){this.createFilterWindow({extFilters:true})
},arrowCls:"link_grey",arrowHandler:this.viewUrl,listeners:{scope:this,afterrender:function(l){l.getEl().down(".x-btn-link_grey").dom.setAttribute("data-qtip",this.findLangS("button_help","viewUrl"))
}},_id:"setFilter"},{scope:this,text:this.findLangS("button","resetFilter"),tooltip:this.findLangS("button_help","resetFilter"),iconCls:"icon_find",handler:this.resetFilter,disabled:true,_id:"resetFilter"},{scope:this,text:this.findLangS("button","settings"),tooltip:this.findLangS("button_help","settings"),iconCls:"icon_wrench",_btnId:"settings",menu:{scope:this,defaults:{scope:this,handler:function(l){if(l._menuId=="enableDns"){if(!user.sqlrow){user.sqlrow={}
}user.sqlrow.uc_enable_dns_http=!user.sqlrow.uc_enable_dns_http;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setItemUserConfigSqlrow",params:Ext.encode({item:"uc_enable_dns_http",value:user.sqlrow.uc_enable_dns_http?1:0})},success:function(m){this.reload()
},maskEl:this,deferMask:true})
}}},items:c,listeners:{scope:this,beforeshow:function(l){l.items.get(l.items.findIndex("_menuId","enableDns")).setChecked(user.sqlrow&&user.sqlrow.uc_enable_dns_http)
}}}});
var g=[this.findLangS("button","refreshInterval")+":&thinsp;",{xtype:"numberfield",width:__width_ColumnNum(4)+ +__width_Trigger,minValue:1,maxValue:9999,step:1,enableKeyEvents:true,listeners:{scope:this,change:function(l){this.setTimeoutRefreshInterval(l)
},keyup:function(m,l){this.setTimeoutRefreshInterval(m)
}},fieldStyle:{"text-align":"right"}}]
}if(f.enableTbarRibbonDateFromTo){k.push({xtype:"buttongroup",title:this.findLangS("tbar","dateTimeRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("tbar","dateTimeFrom")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:f.form_filters&&f.form_filters.date_time_from?clone(f.form_filters.date_time_from):null,_buttonGroup:true,onSetDate:function(m,l){this.setFilterItemValue("date_time_from",l)
},onSetDateScope:this},{value:this.findLangS("tbar","dateTimeTo")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:f.form_filters&&f.form_filters.date_time_to?clone(f.form_filters.date_time_to):null,_buttonGroup:true,onSetDate:function(m,l){this.setFilterItemValue("date_time_to",l)
},onSetDateScope:this}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(f.enableTbarRibbonFilterButton){k.push({xtype:"buttongroup",title:this.findLangS("tbar","menu"),columns:1,defaults:{xtype:"displayfield"},items:[{xtype:"button",text:this.findLangS("tbar","filter"),iconCls:"icon_find",handler:function(){this.createFilterWindow({disableTimeInterval:true,extFilters:true,modal:true})
},scope:this,style:{marginTop:9,marginBottom:12}}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(f&&f.form_filters&&!f.extraParams){f.extraParams={form_filters:Ext.encode(f.form_filters)}
}var h=null;
if(!f||!f.disablePagingToolbar){h={listeners:{beforechange:function(l,m){if(m!=l.store.currentPage){l._changePage=true
}}}}
}else{if(f.enableTbarRibbonPaginator){h={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud}};
k.push({xtype:"buttongroup",title:this.findLangS("tbar","paginator"),items:h,style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}f=Ext.applyIf(f||{},{url:"php/model/sql.php",module:"HTTP",storeId:"HTTP",recordStruct:rsHttp,sortField:"timestamp",sortDirection:"desc",remoteSort:true,pageSize:f.disablePagingToolbar&&!f.enableTbarRibbonPaginator?-1:(f.pageSize||30),enableAutoLoad:false,level:1,columns:this.getColumns(f,this),columnsDefaults:{tdCls:"vertical-align-middle",sortable:false},tbar:k.length?k:undefined,paginatorBehindButtonsItems:g.length?g:undefined,prefixCls:f.module||"HTTP"+(f&&f.level>1?"_"+(f.level-1):""),stripeRows:false,paginator:h||undefined,plugins:["gridfilters"],loadingText:getLoadMaskWithStopButton_loading_text("httpGrid_loadMask"),listeners:{scope:this,afterrender:function(){if(this.gridPanel&&this.gridPanel._mainHttpTable&&isInitHttpSelectUrlParams()){if(window.httpId){this.initFilter();
if(this._panel){this._panel.setTitleHtp()
}this.filters.createFilters();
this.filters.filters.getAt(0).menu.fields.eq.setValue(httpId)
}else{this.initFilter();
a.call(this);
if(this._panel){this._panel.setTitleHttp()
}if(window.http_group_data&&this._panel&&this._panel.groupPanel){Ext.defer(function(){var l=Ext.decode(window.http_group_data);
this._panel.groupPanel.setFields(l);
this._panel.groupPanel._ignoreSetComboFilters=true;
this.reload({page:1});
this.setToolbarFilterItems()
},250,this)
}else{this.reload({page:1});
this.setToolbarFilterItems()
}}}else{this.initFilter();
if(this._panel){this._panel.setTitleHttp()
}this.reload({page:1})
}}},proxy_timeout:60*60*1000});
this.callParent([f]);
this.store.on("beforeload",d,this);
this.store.on("load",b,this);
this.store._params=["dir","limit","module","sort","start","task"];
function d(){beginLoadMaskWithStopButton_store(this.store,"httpGrid_loadMask")
}function b(){endLoadMaskWithStopButton_store(this.store);
if(!this._paginator._changePage&&!loadStoreIsCancel(this.store)){if(this._panel&&this._panel.groupPanel){this._panel.groupPanel.reloadHttpStats(this,this.store);
this._panel.groupPanel.setComboFilters(this,this.store);
this._panel.groupPanel.skipToNextGroup(this,this.store)
}if(this.gridPanel&&this.gridPanel.chartsPanel){this.gridPanel.reloadCharts()
}}this._paginator._changePage=false
}function a(){if(window.http_filter){this.form_filters=Ext.decode(window.http_filter);
for(var l in this.form_filters){switch(l){case"date_time_from":case"date_time_to":this.form_filters[l]=dateTimeStringToDate(this.form_filters[l]);
break
}}this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters)
}if(window.http_group_data&&this._panel&&this._panel.groupPanel){var m=Ext.decode(window.http_group_data);
var o=this._panel.groupPanel.getGroupFilterExtraParams(m);
for(var n in o){this.store.proxy.extraParams[n]=o[n]
}}}},onStoreLoad:function(b,a,d,c){if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if(ActiveModule=="HTTP"&&this.isVisible()&&!reloginForm&&!this._windowFilter&&!this.rowExpander.isAnyExpand()){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}},getColumns:function(d,b,c){var g=[{headerLang:"id_sensor",dataIndex:"id",align:"center",width:50,sortable:true,filter:{type:"numeric"},renderer:function(o,k,l,p,n,m){if(!l.data.id_sensor&&!l.data._id_sensor){return(o)
}return'<div style = "text-align:center">'+o+"<br>"+(l.data.id_sensor||'<i style="color: grey;">'+l.data._id_sensor+"</i>")+"</div>"
}},{dataIndex:"timestamp",width:__width_ColumnDateTime,sortable:true,align:"center",renderer:renderDateTime},{dataIndex:"srcip_port",width:__width_ColumnNum(15),sortable:true,align:"center",renderer:h},{dataIndex:"dstip_port",width:__width_ColumnNum(15),sortable:true,align:"center",renderer:h},{dataIndex:"url",width:__width_ColumnChar(30),sortable:true,align:"left",renderer:a},{dataIndex:"http",width:__width_ColumnChar(30),sortable:true,align:"left",renderer:a},{dataIndex:"body",width:__width_ColumnChar(30),sortable:true,align:"left",renderer:a},{dataIndex:"response_http",width:__width_ColumnChar(30),sortable:true,align:"left",renderer:a},{dataIndex:"response_body",width:__width_ColumnChar(30),sortable:true,align:"left",renderer:a},{dataIndex:"callid",width:__width_ColumnChar(20),sortable:true,align:"left",renderer:a},{dataIndex:"sessid",width:__width_ColumnChar(20),sortable:true,align:"left",renderer:a},{dataIndex:"external_transaction_id",width:__width_ColumnChar(20),sortable:true,align:"left",renderer:a}];
for(var f=0;
f<g.length;
f++){g[f].header=this.findLangS("column",g[f].headerLang||g[f].dataIndex)||g[f].header
}if(c&&this.plugins){for(var f=0;
f<this.plugins.length;
f++){if(this.plugins[f].ptype=="rowexpander"){g.splice(0,0,this.plugins[f].getHeaderConfig());
break
}}}return(g);
function h(q,k,m,o,s,r,p){var l=p&&p.ownerCt&&p.ownerCt.getHeaderContainer?p.ownerCt.getHeaderContainer().getHeaderAtIndex(s):null;
if(!l){return(q)
}var n="";
switch(l.dataIndex){case"srcip_port":n=m.data.srcip+"<br>"+m.data.srcport;
break;
case"dstip_port":n=m.data.dstip+"<br>"+m.data.dstport;
break
}return(n)
}function a(q,m,l,r,o,n,k){var p=k&&k.ownerCt&&k.ownerCt.getHeaderContainer?k.ownerCt.getHeaderContainer().getHeaderAtIndex(o):null;
if(!p){return(q)
}q=q.trunc(p.getWidth()*3/(__width_ColumnChar(100)/100));
return(renderStringStyle(q,{forceMultiLine:true}))
}},reconfigureColumns:function(){var a=this.getColumns(this,this,true);
this.reconfigure(this.store,a)
},createFilterWindow:function(f){this._windowFilter=true;
var b=Ext.applyIf(f||{},{values:this.form_filters||{}});
var g=HTTP.Filter.getFieldset(b);
var d=new Ext.FormPanel({frame:true,border:false,waitMsgTarget:true,autoHeight:true,items:g,buttons:[{scope:this,text:this.findLangS("button","search"),iconCls:"icon_find",handler:a},{iconCls:"icon_cancel",text:this.findLangS("button","close"),handler:function(){c.destroy()
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",d.el,{enter:a,scope:this});
HTTP.Filter.setContextFields(d)
}},width:710,style:{padding:5}});
var c=new Ext.Window({scope:this,iconCls:"icon_find",title:this.findLangS("title","searchForm"),closable:true,border:false,plain:true,layout:"fit",modal:f&&f.modal,items:d,formPanelForAutoAdjustSize:d,listeners:{scope:this,activate:function(){if(!c.activated){var h=d.getForm().getFields();
var k=null;
for(var l=0;
l<h.getCount();
l++){var m=h.getAt(l);
if(!(m instanceof Ext.form.DisplayField)&&m._type!="labelA"){k=m;
break
}}if(k){k.focus(false,500)
}c.activated=true
}},destroy:function(){this._windowFilter=false
}}});
c.show();
function a(){if(d.getForm().isValid()){var h={};
if(f&&f.disableTimeInterval&&this.enableTbarRibbonDateFromTo){Ext.applyIf(h,{date_time_from:this.getFilterItemValue("date_time_from"),date_time_to:this.getFilterItemValue("date_time_to")})
}Ext.applyIf(h,HTTP.Filter.fetchValuesFromFieldset(d));
this.setFilter(h);
c.destroy()
}}},initFilter:function(){if(!this.disableMenu){this.form_filters={};
this.form_filters.date_time_from=HTTP.Filter.getDefaultDateFrom();
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters)
}},setFilter:function(a){this.form_filters=a;
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
this.reload({page:1});
this.setToolbarFilterItems()
},getFilterItemValue:function(a){return(this.form_filters&&this.form_filters[a]||null)
},setFilterItemValue:function(b,d,c,a){if(d||d===0&&c){if(!this.form_filters){this.form_filters={}
}this.form_filters[b]=d;
this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
if(!a){this.reload({page:1})
}}else{if(this.form_filters){delete this.form_filters[b];
if(!isDataEmpty(this.form_filters)){if(!a){this.resetFilter()
}}else{this.store.proxy.extraParams.form_filters=Ext.encode(this.form_filters);
if(!a){this.reload({page:1})
}}}}if(!a){this.setToolbarFilterItems()
}},resetFilter:function(){this.initFilter();
this.reload({page:1});
this.enableBtn("resetFilter",false);
this.setToolbarFilterItems()
},isFilterEmpty:function(){if(!this.form_filters||!this.form_filters.date_time_from){return(false)
}var b=cloneObject(this.form_filters);
HTTP.Filter.optimizeFilterItems(b);
for(var a in b){if(a!="date_time_from"||!b.date_time_from.getTime||b.date_time_from.getTime()!=HTTP.Filter.getDefaultDateFrom().getTime()){return(false)
}}return(true)
},reload:function(a){if(a&&a.page){this.store.currentPage=a.page;
Ext.apply(a,{start:(a.page-1)*this.store.pageSize})
}this.store.load(a);
if(this._panel){this._panel.setTitleMessages()
}},setToolbarFilterItems:function(){this.enableBtn("resetFilter",!this.isFilterEmpty())
},getSelectParams:function(){var b={};
for(var a in this.store.proxy.extraParams){if(this.store._params.indexOf(a)<0){b[a]=this.store.proxy.extraParams[a]
}}return b
},exportToCsv:function(a){formPostSafe("php/model/sql.php","POST",{module:"HTTP",task:"CSV",dummy:new Date()})
},viewUrl:function(){var f=window.location.origin+window.location.pathname;
var d={};
var c=HTTP.Filter.getArrayOfFields();
for(var b in this.form_filters){if(Ext.isString(b)&&c.inArray(b)&&Ext.isDefined(this.form_filters[b])&&this.form_filters[b]!==null&&this.form_filters[b]!==""){d[b]=this.form_filters[b]
}}var a={};
if(this._panel&&this._panel.groupPanel){a=this._panel.groupPanel.getFields()
}if(!isDataEmpty(d)||!isDataEmpty(a)){f+="?"
}if(!isDataEmpty(d)){HTTP.Filter.optimizeFilterItems(d);
f+="http_filter="+encodeURIjson(Ext.encode(d))
}if(!isDataEmpty(a)){if(!isDataEmpty(d)){f+="&"
}f+="http_group_data="+encodeURIjson(Ext.encode(a))
}var g='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+f+'" target="_blank">'+f+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(findLangS(this.subsystem,"title","viewUrl"),g,function(){var h=Ext.getCmp("copy_button");
if(h){h.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(h){return(h.clipboardText)
},getClipTextParams:{clipboardText:f},id:"copy_button",renderTo:"copy_button_div"})
}});
Ext.define("HTTP.Filter",{singleton:true,subsystem:"http",getFieldset:function(c){c=c||{};
c.prop=c.prop||{};
Ext.applyIf(c.prop,{labelWidth:__width_FieldChar(20),labelAWidth:__width_FieldChar(15),fieldAWidth:__width_FieldChar(25),labelBWidth:__width_FieldChar(10),fieldBWidth:__width_FieldChar(25),labelFieldStyle:{height:16,"min-height":16,"margin-top":0,"white-space":"nowrap"},btnSwitchWidth:16,btnSwitchHeight:16,colorBackground:c._window?__color_WindowFrame:__color_FormBackground});
var a=[];
if(c.enableExternalTransactionId){a.push({items:[{xtype:"displayfield",value:"externalTransactionId:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"external_ransaction_id",value:c.values.external_ransaction_id,width:__width_FieldChar(45),allowBlank:false}]})
}if(!c.disableTimeInterval){a.push({items:[{xtype:"displayfield",value:"dateRange:",_type:"label"},{xtype:"displayfield",value:"from",_type:"labelA"},{xtype:"datetimefield",name:"date_time_from",allowBlank:false,_type:"fieldA",value:c.values.date_time_from||date()},{xtype:"displayfield",value:"to",_type:"labelB"},{xtype:"datetimefield",name:"date_time_to",_type:"fieldB",value:c.values.date_time_to}]})
}a.push({items:[{xtype:"displayfield",value:"IP:",_type:"label"},{xtype:"ComboBoxA",name:"srcdstip_type",value:0,_type:"labelA",aData:[[0,"srcOrDst"],[1,"src"]],value:c.values.srcdstip_type||0},{xtype:"textfield",name:"srcip",_type:"fieldA",value:c.values.srcip},{xtype:"button",name:"srcdstip_switch",_type:"btnswitch"},{xtype:"displayfield",value:"dst",name:"dstip_label",_type:"labelBsw"},{xtype:"textfield",name:"dstip",_type:"fieldB",value:c.values.dstip}]},{items:[{xtype:"displayfield",_type:"label"},{xtype:"ComboBoxA",name:"srcdstip_group_id_type",value:0,_type:"labelA",aData:[[0,"srcOrDst"],[1,"src"]],value:c.values.srcdstip_group_id_type||0},{xtype:"CBX_cbIpGroups",name:"srcip_group_id",_noLabel:true,_type:"fieldA",_multiSelect2:true,_clearButton:true,value:c.values.srcip_group_id},{xtype:"button",name:"srcdstip_group_id_switch",_type:"btnswitch"},{xtype:"displayfield",value:"dst",name:"dstip_group_id_label",_type:"labelBsw"},{xtype:"CBX_cbIpGroups",name:"dstip_group_id",_noLabel:true,_type:"fieldB",_multiSelect2:true,_clearButton:true,value:c.values.dstip_group_id}]});
if(c.extFilters){a.push({items:[{xtype:"displayfield",value:"port:",_type:"label"},{xtype:"ComboBoxA",name:"srcdstport_type",value:0,_type:"labelA",aData:[[0,"srcOrDst"],[1,"src"]],value:c.values.srcdstport_type||0},{xtype:"textfield",name:"srcport",_type:"fieldA",value:c.values.srcport},{xtype:"button",name:"srcdstport_switch",_type:"btnswitch"},{xtype:"displayfield",value:"dst",name:"dstport_label",_type:"labelBsw"},{xtype:"textfield",name:"dstport",_type:"fieldB",value:c.values.dstport}]},{items:[{xtype:"displayfield",value:"url:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"url",width:c.prop.fieldAWidth,value:c.values.url}]},{items:[{xtype:"displayfield",value:"http:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"http",width:c.prop.fieldAWidth,value:c.values.http}]},{items:[{xtype:"displayfield",value:"body:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"body",width:c.prop.fieldAWidth,value:c.values.body}]})
}a.push({items:[{xtype:"displayfield",value:"httpResponse:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"http_response",width:c.prop.fieldAWidth,value:c.values.http_response}]});
if(c.extFilters){a.push({items:[{xtype:"displayfield",value:"bodyResponse:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"body_response",width:c.prop.fieldAWidth,value:c.values.body_response}]},{items:[{xtype:"displayfield",value:"callid:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"callid",width:c.prop.fieldAWidth,value:c.values.callid}]},{items:[{xtype:"displayfield",value:"sessid:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"sessid",width:c.prop.fieldAWidth,value:c.values.sessid}]},{items:[{xtype:"displayfield",value:"external_transaction_id:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"textfield",name:"external_transaction_id",width:c.prop.fieldAWidth,value:c.values.external_transaction_id}]})
}a.push({items:[{xtype:"displayfield",value:"sensor:",_type:"label"},{xtype:"displayfield",_type:"labelA"},{xtype:"CBX_sensor",name:"sensor_id",_noLabel:true,_addEmptySensorId:true,_clearButton:true,width:c.prop.fieldAWidth,value:c.values.sensor_id||0}]});
if(c.enableOkButton&&c.okButtonHandler&&c.okButtonScope){a.push({xtype:"button",text:lang.okButtonText,handler:c.okButtonHandler,scope:c.okButtonScope,style:{marginLeft:c.prop.labelWidth+c.prop.labelAWidth+__width_LabelFieldSeparator}})
}for(var d=0;
d<a.length;
d++){if(a[d].items&&a[d].items.length&&!a[d].xtype){for(var b=0;
b<a[d].items.length;
b++){var f=a[d].items[b];
if(f.xtype=="ComboBoxA"&&f._type=="labelA"){Ext.applyIf(f,{style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:{"text-align":"right",background:c.prop.colorBackground},listeners:{select:function(h){var g=h.findFormPanel();
if(g){HTTP.Filter.setContextFields(g)
}}}})
}switch(f._type){case"label":Ext.applyIf(f,{width:c.prop.labelWidth,fieldStyle:c.prop.labelFieldStyle});
break;
case"labelA":Ext.applyIf(f,{width:c.prop.labelAWidth,style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:Ext.apply({},c.prop.labelFieldStyle,{"text-align":"right","padding-right":f.xtype=="ComboBoxA"?undefined:__width_Trigger+4})});
break;
case"labelB":case"labelBsw":Ext.applyIf(f,{width:c.prop.labelBWidth-(f._type=="labelBsw"?24:0),style:{"margin-right":__width_LabelFieldSeparator},fieldStyle:Ext.apply({},c.prop.labelFieldStyle,{"text-align":"right"})});
break;
case"fieldA":Ext.applyIf(f,{width:c.prop.fieldAWidth});
break;
case"fieldB":Ext.applyIf(f,{width:c.prop.fieldBWidth});
break;
case"btnswitch":Ext.applyIf(a[d].items[b],{width:c.prop.btnSwitchWidth,border:false,style:{background:"transparent",marginTop:2,marginLeft:4,marginRight:4,height:c.prop.btnSwitchHeight},cls:"icon_arrow_switch_lr",handler:function(h){var g=h.findFormPanel();
if(g){HTTP.Filter.switchContentFields(g,h.name)
}}});
break
}}Ext.applyIf(a[d],{xtype:"container",layout:"hbox",style:{marginBottom:__height_FieldSeparator}})
}}recurseCascadeApplyIf(a,{listeners:{}},"listeners",{change:function(h){var g=h.findFormPanel();
if(g){HTTP.Filter.setContextFields(g,true,h)
}},select:function(h){var g=h.findFormPanel();
if(g){HTTP.Filter.setContextFields(g,true,h)
}}},function(g){return(g.xtype=="numberfield")
});
return(this.completeFields(a))
},completeFields:function(a){if(Ext.isArray(a)){for(var b=0;
b<a.length;
b++){this.completeFields(a[b])
}return(a)
}if(a.items){this.completeFields(a.items);
return(a)
}if(a.xtype&&a.xtype.match(/^displayfield/)&&a.value){var f=a.value;
var c=false;
if(f.match(/:$/)){f=f.substr(0,f.length-1);
c=true
}var d=findLangS(this.subsystem,"field_filter",f);
if(d){a.value=d;
if(c){a.value+=":"
}}if(a.helpText){a.helpText=findLangS(this.subsystem,"field_filter",a.helpText)||findLangS(this.subsystem,"field_filter",a.helpText+"Help")
}}if(a.aData){for(var b=0;
b<a.aData.length;
b++){if(Ext.isArray(a.aData[b])&&a.aData[b].length==2){var d=findLangS(this.subsystem,"field_filter",a.aData[b][1]);
if(d){a.aData[b][1]=d+(a._type=="combolabel_main"?":":"")
}}}}a.__filter="http";
return(a)
},fetchValuesFromFieldset:function(d){var c={};
if(d.getForm){d=d.getForm()
}var b=this.getArrayOfFields();
if(b){for(var a=0;
a<b.length;
a++){var g=this.findFilterField(d,b[a]);
if(g){var f=g.getValue();
if(Ext.isDefined(f)&&f!==""&&f!==null){c[b[a]]=g.getValue()
}}}}return(c)
},setValueFieldsFieldset:function(a,d){if(!d||!a){return
}if(d.getForm){d=d.getForm()
}var c=this.getArrayOfFields();
if(c){for(var b=0;
b<c.length;
b++){var f=this.findFilterField(d,c[b]);
if(f){f.setValue(a[c[b]])
}}}this.setContextFields(d)
},getArrayOfFields:function(b){var a=["external_ransaction_id","date_time_from","date_time_to","srcip","dstip","srcdstip_type","srcip_group_id","dstip_group_id","srcdstip_group_id_type","caller_group_id","called_group_id","callerd_group_id_type","srcport","dstport","srcdstport_type","url","http","body","http_response","body_response","callid","sessid","external_transaction_id","sensor_id"];
return(a)
},setContextFields:function(f){if(!f){return
}if(f.getForm){f=f.getForm()
}var d=this.fetchValuesFromFieldset(f);
var a=this.abFields_labelContext();
for(var h in a){var g=this.findFilterField(f,h);
if(g){fieldValue=g.getValue();
if(fieldValue==null){g.setValue(0);
fieldValue=0
}for(var b=0;
b<a[h].length;
b++){if(a[h][b]){var c=this.findFilterField(f,a[h][b]);
if(c){c.setVisible(fieldValue==1)
}}}}}},switchContentFields:function(d,h){if(!d){return
}if(d.getForm){d=d.getForm()
}var g=this.abFields_switch();
if(g[h]){var c=[];
for(var b=0;
b<2;
b++){for(var a=0;
a<2;
a++){var f=this.findFilterField(d,g[h][a]);
if(b){f.setValue(c[a?0:1])
}else{c[a]=f.getValue()
}}}}},isDataSet:function(a){if(a.getForm){a=a.getForm()
}var b=this.fetchValuesFromFieldset(a);
return(isDataSet(b))
},getDefaultDateFrom:function(){return defaultCdrTypeInterval=="specified_days"?date((new Date).getTime()/1000-defaultCdrInterval*24*60*60):dateTimeM(getTimeInterval(defaultCdrTypeInterval)[0])
},findFilterField:function(c,d){if(!c){return(null)
}if(c.findField){c=c.owner
}var a=c.getItems(d,"name",true);
if(a&&a.length){for(var b=0;
b<a.length;
b++){if(a[b].__filter=="http"){return(a[b])
}}}return(null)
},enableField:function(b,d,a){var c=this.findFilterField(b,d);
if(c){c.enableIf(a)
}},setValueField:function(a,d,b){var c=this.findFilterField(a,d);
if(c){c.setValue(b)
}},optimizeFilterItems:function(a){},abFields_Types:function(){var a=[];
for(var b in this.abFields){if(this.abFields[b].t){a.push(this.abFields[b].t)
}}return(a)
},abFields_labelContext:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].sw&&this.abFields[b].l&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].sw,this.abFields[b].l,this.abFields[b].b]
}}return(a)
},abFields_switch:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].sw&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].sw]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields_typeAB:function(){var a={};
for(var b in this.abFields){if(this.abFields[b].t&&this.abFields[b].a&&this.abFields[b].b){a[this.abFields[b].t]=[this.abFields[b].a,this.abFields[b].b]
}}return(a)
},abFields:[{t:"srcdstip_type",a:"srcip",b:"dstip",l:"dstip_label",sw:"srcdstip_switch"},{t:"srcdstip_group_id_type",a:"srcip_group_id",b:"dstip_group_id",l:"dstip_group_id_label",sw:"srcdstip_group_id_switch"},{t:"srcdstport_type",a:"srcport",b:"dstport",l:"dstport_label",sw:"srcdstport_switch"}]});
function isInitHttpSelectUrlParams(){return(false)
}function clearInitHttpSelectUrlParams(){}Ext.ns("IP_account");
Ext.define("IP_account.IPsum.Grid",{extend:"Ext.Panel",alias:"widget.ipacc_ip_sum.GridX",subsystem:"ipaccount",constructor:function(E){E=E||{};
this.trTypeLimits=["minute","hour","day","week","month"];
var J=__width_ColumnChar(E.useUserInterval?55:64);
var O=__width_ColumnChar(E.useUserInterval?55:64);
var K=__width_ColumnChar(E.useUserInterval?55:64);
var g=__width_ColumnChar(E.useUserInterval?55:64);
var p=[];
if(!E||!E.extraParams||!E.extraParams.group||E.extraParams.group=="IP"||E.extraParams.group=="customer"){if(E.extraParams&&E.extraParams.group=="customer"||E._by=="customer"){p.push({dataIndex:"customer",width:O,sortable:["users","customers"].isIn(window.typeCustomersTables),renderer:s})
}else{p.push({dataIndex:"addr",width:J,sortable:true,renderer:G})
}}else{if(E.extraParams.group=="protocol"){p.push({dataIndex:"protocol",width:K,sortable:true,renderer:n})
}else{if(E.extraParams.group=="port"){p.push({dataIndex:"port",width:g,sortable:true,renderer:d})
}}}var v=[];
if(!E.level){var f={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud}}
}if(E.useUserInterval){if(!E.level&&!E.disableToolbar&&!E.simpleToolbar){var P=E.dateFrom||date();
var A=null;
this.fieldDateFrom=new Ext.ux.form.SearchDateTime({value:P,_type:"from",_gridForm:this,_buttonGroup:true,onSetDate:k,scope:this,zeroTimeEmpty:true,timeCfg:{format:"H",increment:60,width:25+__width_Trigger}});
this.fieldDateTo=new Ext.ux.form.SearchDateTime({value:A,_type:"to",_gridForm:this,_buttonGroup:true,onSetDate:k,scope:this,zeroTimeEmpty:true,timeCfg:{format:"H",increment:60,width:25+__width_Trigger}});
v.push({xtype:"buttongroup",title:this.findLangS("dateRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("from")+":",fieldCls:"x-toolbar-text"},this.fieldDateFrom,{value:this.findLangS("to")+":",fieldCls:"x-toolbar-text"},this.fieldDateTo],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}var z=E.level?7:10;
p.push({header:this.findLangS("column","downloadAll")+'<img src="images/icon/tr_download_simple_small.png">',dataIndex:"traffic_in",widthNum:z,_in:true,sortable:true,align:"right",renderer:r,sortStateOnToggle:"DESC",sortBy:{traffic_in:this.findLangS("sortBy","traffic"),packets_in:this.findLangS("sortBy","packets")}},{header:this.findLangS("column","downloadVoip")+'<img src="images/icon/tr_download_simple_small.png">',dataIndex:"traffic_voip_in",widthNum:z,_in:true,_voip:true,sortable:true,align:"right",renderer:r,sortStateOnToggle:"DESC",sortBy:{traffic_in:this.findLangS("sortBy","traffic"),packets_in:this.findLangS("sortBy","packets")}},{header:this.findLangS("column","uploadAll")+'<img src="images/icon/tr_upload_simple_small.png">',dataIndex:"traffic_out",widthNum:z,_out:true,sortable:true,align:"right",renderer:r,sortStateOnToggle:"DESC",sortBy:{traffic_out:this.findLangS("sortBy","traffic"),packets_out:this.findLangS("sortBy","packets")}},{header:this.findLangS("column","uploadVoip")+'<img src="images/icon/tr_upload_simple_small.png">',dataIndex:"traffic_voip_out",widthNum:z,_out:true,_voip:true,sortable:true,align:"right",renderer:r,sortStateOnToggle:"DESC",sortBy:{traffic_out:this.findLangS("sortBy","traffic"),packets_out:this.findLangS("sortBy","packets")}},{header:this.findLangS("column","total")+'<img src="images/icon/sum_small2.png">',dataIndex:"traffic_sum",widthNum:z,_sum:true,sortable:true,align:"right",renderer:r,sortStateOnToggle:"DESC",sortBy:{traffic_sum:this.findLangS("sortBy","traffic"),packets_sum:this.findLangS("sortBy","packets")}})
}else{p.push({dataIndex:"traffic_sum_hour",widthNum:12,sortable:true,align:"right",renderer:r,_type:"hour",sortBy:{traffic_in_hour:this.findLangS("sortBy","trafficDown"),traffic_out_hour:this.findLangS("sortBy","trafficUp"),traffic_sum_hour:this.findLangS("sortBy","trafficSum"),packets_in_hour:this.findLangS("sortBy","packetsDown"),packets_out_hour:this.findLangS("sortBy","packetsUp"),packets_hour:this.findLangS("sortBy","packetsSum")}},{dataIndex:"traffic_sum_day",widthNum:12,sortable:true,align:"right",renderer:r,_type:"day",sortBy:{traffic_in_day:this.findLangS("sortBy","trafficDown"),traffic_out_day:this.findLangS("sortBy","trafficUp"),traffic_sum_day:this.findLangS("sortBy","trafficSum"),packets_in_day:this.findLangS("sortBy","packetsDown"),packets_out_day:this.findLangS("sortBy","packetsUp"),packets_day:this.findLangS("sortBy","packetsSum")}},{dataIndex:"traffic_sum_week",widthNum:12,sortable:true,align:"right",renderer:r,_type:"week",sortBy:{traffic_in_week:this.findLangS("sortBy","trafficDown"),traffic_out_week:this.findLangS("sortBy","trafficUp"),traffic_sum_week:this.findLangS("sortBy","trafficSum"),packets_in_week:this.findLangS("sortBy","packetsDown"),packets_out_week:this.findLangS("sortBy","packetsUp"),packets_week:this.findLangS("sortBy","packetsSum")}},{dataIndex:"traffic_sum_month",widthNum:12,sortable:true,align:"right",renderer:r,_type:"month",sortBy:{traffic_in_month:this.findLangS("sortBy","trafficDown"),traffic_out_month:this.findLangS("sortBy","trafficUp"),traffic_sum_month:this.findLangS("sortBy","trafficSum"),packets_in_month:this.findLangS("sortBy","packetsDown"),packets_out_month:this.findLangS("sortBy","packetsUp"),packets_month:this.findLangS("sortBy","packetsSum")}});
if(E.enableColumnCheckBoxChangeHideEmpty){for(var L=0;
L<p.length;
L++){if(p[L]._type&&this.trTypeLimits.isIn(p[L]._type)){Ext.applyIf(p[L],{xtype:"gridcolumn_chb",checkBoxLabel:this.findLangS("column","hideEmpty"),checkBoxLabelColor:"grey",checkBoxLabelPercSize:90,onCheckBoxChange:m,_gridPanel:this})
}}}}if(E.level){if(E.extraParams.group=="IP"){v.push({xtype:"displayfield",value:this.findLangS("field","IP")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",name:"IP",_gridForm:this,_buttonGroup:true,onChangeValue:b,scope:this,width:__width_ColumnChar(20)});
if(E.useUserInterval&&E.level==2&&E.enableChartsButton){v.push("-",{text:"charts",iconCls:"icon_menu_diag_system",menu:{items:[{text:"traffic",hideOnClick:false,menu:{defaults:{handler:this.loadChart,scope:this},items:[{text:"line",_typeChart:"traffic"},{text:"area",_typeChart:"traffic_area"}]}},{text:"packets",hideOnClick:false,menu:{defaults:{handler:this.loadChart,scope:this},items:[{text:"line",_typeChart:"packets"},{text:"area",_typeChart:"packets_area"}]}},{text:"traffic top 10",hideOnClick:false,menu:{defaults:{handler:this.loadChart,scope:this},items:[{text:"in",_typeChart:"traffic_top_10_in"},{text:"out",_typeChart:"traffic_top_10_out"}]}}]}})
}}}else{if(!E.disableToolbar&&!E.simpleToolbar){if(E._by=="IP"){if(user.sqlrow.login_type=="user"||user.sqlrow.filter&&user.sqlrow.filter.ip_cust_count>1&&user.sqlrow.customers_count>1){v.push({xtype:"buttongroup",title:this.findLangS("filters"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("field","IP_network")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",name:"IP",_gridForm:this,_buttonGroup:true,onChangeValue:b,scope:this,width:__width_ColumnChar(24),style:{marginBottom:"0px !important"}},{value:this.findLangS("field","customer")+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_custCustomer",name:"customer",width:__width_ColumnChar(30),_clearButton:true,_buttonGroup:true,_disableFilterField:true,listeners:{scope:this,select:C},style:{marginBottom:"0px !important"}}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}if(user.sqlrow.login_type=="user"){v.push({xtype:"buttongroup",title:findLangSd("utilities"),columns:1,items:[{text:this.findLangS("title","chart_realTime"),iconCls:"icon_menu_diag_system",handler:M,scope:this,height:21},{xtype:"container",height:1},{xtype:"container",height:21}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}else{if(E._by=="customer"){if(user.sqlrow.login_type=="user"||user.sqlrow.filter&&user.sqlrow.filter.ip_cust_count>1&&user.sqlrow.customers_count>1){v.push({xtype:"buttongroup",title:this.findLangS("filters"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.findLangS("field","customer")+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_custCustomer",name:"customer",width:__width_ColumnChar(30),_clearButton:true,_buttonGroup:true,_disableFilterField:true,listeners:{scope:this,select:C},style:{marginBottom:"0px !important"}},{value:this.findLangS("field","IP")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",name:"IP",_gridForm:this,_buttonGroup:true,onChangeValue:b,scope:this,width:__width_ColumnChar(21),style:{marginBottom:"0px !important"}}],style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}}v.push({xtype:"buttongroup",title:findLangSd("grid","paginator"),items:f,style:{background:__color_TabGroupBackgroud,"border-width":0}})
}}configGrid={title:null,style:{}};
Ext.applyIf(configGrid,E);
Ext.applyIf(configGrid,{storeId:"IP_account.IPsum.Store",url:"php/model/sql.php",module:"ipacc_ip_sum",recordStruct:rsIPaccIPsum,keyField:"addr",sortField:E.useUserInterval?"traffic_sum":"traffic_sum_month",sortDirection:"DESC",remoteSort:true,deferredLoad:true,pageSize:30,columns:p,prefixCls:E.useUserInterval?"ipacc_ip_sum_ui":"ipacc_ip_sum_ti",stripeRows:false,tbar:v.length?v:undefined,paginator:E.simpleToolbar?undefined:f,plugins:["columnSort"],extraParams:E.useUserInterval?{userInterval:E.disableToolbar||E.simpleToolbar?Ext.encode(E.useUserInterval):Ext.encode({from:P,to:A}),_by:E._by}:undefined,getRowClass:y,suppressTotal:true,subsystem:"ipaccount"});
if(E.enableExpander){configGrid.plugins.push({ptype:"rowexpander",rowBodyContentCls:"IP_account.IPsum.GridExpPanel",rowBodyContentConfig:{level:E.level||1},expandOnEnter:false,expandOnDblClick:false,noVerticalScroller:E.level>1||E.extraParams&&E.extraParams.customer_explore,autoRelayoutExpanders:true,autoRelayoutExpanders_mask:true,enableSelectRowOnClick:false})
}if(E.useUserInterval&&E.level==2){Ext.applyIf(configGrid,{layout:"fit",region:"center",suspendStdBar:true,overflowX:"hidden",overflowY:"hidden",autoScroll:false})
}this.grid=new Ext.ux.grid.GridForm(configGrid);
if(E.useUserInterval&&E.level==2){this.pieChart=new IP_account.IPsum.PiePanel({layout:"fit",gridPanel:this,collapsible:true,collapsed:false,region:"east",width:275,listeners:{scope:this,expand:o,collapse:N,beforeexpand:I,beforecollapse:t,afterrender:function(Q){Ext.defer(function(){Q.setTitle(Q.title)
},100)
}}});
Ext.applyIf(E,{layout:"border",defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:[this.grid,this.pieChart],tbar:this.grid.suspendedStdBar,height:420,border:false})
}else{Ext.applyIf(E,{layout:"fit",items:this.grid,border:false})
}this.callParent([E]);
this.grid.store._grid=this.grid;
this.grid.store._gridPanel=this;
this.grid.on("afterlayout",q,this);
this.grid.store.on("load",a,this);
this.grid.on("itemmouseenter",u,this);
this.grid.on("itemmouseleave",B,this);
var H=this.grid;
var h=this.usedGroups;
var c=this.grid.store;
function G(V,S,R,W,U,T,Q){if(R.data.customer_name){V+=" &nbsp;&nbsp; "+R.data.customer_name;
if(R.data.customer_type){V+='<br><i style="color: grey">'+R.data.customer_type+"</i>"
}}else{if(R.data.addr_hostname){V+="<br>"+R.data.addr_hostname
}}return(V)
}function s(V,S,R,W,U,T,Q){return(V||"id:"+R.data.customer_id)
}function n(V,S,R,W,U,T,Q){return(V+"<br>"+(getDataArrayItem(arIpProto,V)||""))
}function d(V,S,R,W,U,T,Q){return(V&&V!="0"?V:'<span style="color: grey;">other</span>')
}function r(ai,aj,S,aa,ag,Y,ad){var Q=ad.ownerCt;
var T=ad&&ad.ownerCt&&ad.ownerCt.getHeaderContainer?ad.ownerCt.getHeaderContainer().getHeaderAtIndex(ag):null;
if(!T){return(ai)
}var U=(T._type?"_"+T._type:"");
var ae=(Q.invertRenderTraffic?"traffic_out":"traffic_in")+U;
var ac=(Q.invertRenderTraffic?"traffic_voip_out":"traffic_voip_in")+U;
var R=(Q.invertRenderTraffic?"traffic_in":"traffic_out")+U;
var ah=(Q.invertRenderTraffic?"traffic_voip_in":"traffic_voip_out")+U;
var ab=(Q.invertRenderTraffic?"packets_out":"packets_in")+U;
var Z=(Q.invertRenderTraffic?"packets_voip_out":"packets_voip_in")+U;
var af=(Q.invertRenderTraffic?"packets_in":"packets_out")+U;
var X=(Q.invertRenderTraffic?"packets_voip_in":"packets_voip_out")+U;
if(T._in||T._out){var W=T._in?(T._voip?ac:ae):(T._voip?ah:R);
var V=T._in?(T._voip?Z:ab):(T._voip?X:af);
return(formatTraffic(S.data[W])+'<br><span style="color: grey; font-size: 80%;">'+formatPackets(S.data[V])+"</span>")
}if(T._sum){return(formatTraffic(S.data[ae]+S.data[R])+'<br><span style="color: grey; font-size: 80%;">'+formatPackets(S.data[ab]+S.data[af])+"</span>")
}else{return('<table style="font: '+__font_Grid+'; text-align: right; margin-left: auto"><tr><td style="vertical-align: middle; height: 24px;">'+formatTraffic(S.data[ae])+'<br><span style="color: grey; font-size: 80%;">'+formatPackets(S.data[ab])+'</span></td><td style="vertical-align: middle; width: 16px;">'+(S.data[ae]?(Q.enableTrDetail||Q.enableTrDetailDownload?'<a href="#"><img src="images/icon/tr_download.png"gridid="'+Q.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).trDetail('+S.data.addr+",'"+T._type+"','download');return(false);\"></a>":'<img src="images/icon/tr_download_simple.png">'):"")+'</td></tr><tr><td style="height: 2px"></td></tr><tr><td style="vertical-align: middle; height: 24px;">'+formatTraffic(S.data[R])+'<br><span style="color: grey; font-size: 80%;">'+formatPackets(S.data[af])+'</span></td><td style="vertical-align: middle; width: 16px;">'+(S.data[R]?(Q.enableTrDetail||Q.enableTrDetailUpload?'<a href="#"><img src="images/icon/tr_upload.png"gridid="'+Q.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).trDetail('+S.data.addr+",'"+T._type+"','upload');return(false);\"></a>":'<img src="images/icon/tr_upload_simple.png">'):"")+"</td></tr></table>")
}}function m(Q){var R={};
R["hide_empty_"+this._type]=Q?1:0;
this._gridPanel.grid.setExtraParams(R,true)
}function k(Q,R){if(Q._type=="from"){P=R
}else{A=R
}if(date(P).getTime()==date(A).getTime()){this.fieldDateFrom.timeField.enable();
this.fieldDateTo.timeField.enable()
}else{this.fieldDateFrom.trimTime();
this.fieldDateFrom.timeField.disable();
this.fieldDateTo.trimTime();
this.fieldDateTo.timeField.disable()
}P=this.fieldDateFrom.getValue();
A=this.fieldDateTo.getValue();
this.grid.setExtraParams({userInterval:Ext.encode({from:P,to:A})},true)
}function b(Q){if(!Ext.isDefined(this._by)||this._by=="IP"){this.grid.setExtraParams({userFilterIP:Q?Q.trim():Q},true)
}else{if(Q){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getCustomerIdByIp",params:Ext.encode({ip:Q})},success:function(R){var S=this.grid.getTopToolbar().findC("name","customer",true);
if(S){S.setValue(R.customer_id*1);
this.grid.setExtraParams({userFilterCustomer:R.customer_id},true)
}},scope:this,maskEl:this})
}}}function C(Q){this.grid.setExtraParams({userFilterCustomer:Q.getValue()},true)
}function a(S,R){if(!this.level&&["customer","subsidiary"].isIn(user.sqlrow.login_type)&&R.length==1){this.grid.expandRowIndex(0)
}if(F()&&w()){if(E.extraParams.group=="IP"){this.otherSideAddress=[];
this.otherSideHostnames=[];
var Q=false;
if(R){for(var T=0;
T<R.length;
T++){this.otherSideAddress.push(R[T].data.addr);
this.otherSideHostnames.push(R[T].data.addr_hostname);
if(R[T].data.addr_hostname){Q=true
}}}if(!Q){this.otherSideHostnames=null
}if(this.otherSideAddress.length){if(this.chartsPanel&&this.chartsPanel.disabled){this.chartsPanel.otherSideAddress=this.otherSideAddress;
this.chartsPanel.otherSideHostnames=this.otherSideHostnames;
this.chartsPanel.enable()
}if(this.chartsPanelVoip&&this.chartsPanelVoip.disabled){this.chartsPanelVoip.otherSideAddress=this.otherSideAddress;
this.chartsPanelVoip.otherSideHostnames=this.otherSideHostnames;
this.chartsPanelVoip.enable()
}}}if(this.pieChart){this.pieChart.fillStore()
}}else{if(this.pieChart){this.pieChart.disableAndCollapse()
}}}function u(R,Q,U,S,V,T){if(F()&&w()&&this.pieChart){this.pieChart.pieChart.setHighlightItem(this.pieChart.pieChart.series[0].getItemByIndex(S))
}}function B(R,Q,U,S,V,T){if(F()&&w()&&this.pieChart){this.pieChart.pieChart.setHighlightItem(null)
}}function o(){l()
}function N(){l()
}function I(){if(this.pieChart.disabled){Ext.Msg.alert("TOP 10","For enable TOP 10 select order desc by traffic or packets and go to first page.");
return(false)
}}function t(){}function l(){if(H.getView()&&H.getView().getEl()){H.getView().getEl().setStyle({overflow:"hidden"})
}}function q(){this._onAfterLayout_recursCounter=(this._onAfterLayout_recursCounter||0)+1;
if(this._onAfterLayout_recursCounter<2){var R=null;
if(E.useUserInterval&&E.level==2){R=H
}else{if(h&&h.length&&h.length>2){R=h[1].grid
}}if(R&&R.getView().getEl().down(".x-grid-table")){var T=R.getView().getEl().down(".x-grid-table").getHeight();
var U=R.getEl().down(".x-grid-header-ct").getHeight();
var S=26;
var W=3;
var Q=Math.max(T+U+S+W,330);
var V=R.ownerCt;
if(V.getHeight()!=Q){V.setHeight(Q);
l()
}}}--this._onAfterLayout_recursCounter
}function F(){return(c.currentPage==1&&c.sorters.items[0].getDirection()=="DESC"&&(c.sorters.items[0].getProperty().match(/traffic/)||c.sorters.items[0].getProperty().match(/packets/)))
}function w(){return(E.useUserInterval&&E.level==2&&!c.proxy.extraParams.userFilterIP)
}function D(){return(c.sorters.items[0].getProperty())
}function y(Q,T,S,R){if(F()&&w()&&T<__colors_IpaccChartArea.length){return(addBackgroundColorRuleToStyleSheet(lightColor(__colors_IpaccChartArea[T],3,3),R._grid.prefixCls+"-cell"))
}}function M(){IP_acount.Utils.realTimeChart()
}},trDetail:function(d,b,c){var a=this.store.getById(d);
if(!a){return
}this.expandRecord(a);
expander=this.getExpanderBodyContent(a);
if(!expander){return
}expander.gotoTabIntervalDU(d,a,b,c)
},loadChart:function(c){var b=this.grid.store.proxy.extraParams.userInterval;
if(b){b=Ext.decode(b)
}var a={dateTimeFrom:b&&b.from,dateTimeTo:b&&b.to,addr:this.grid.store.proxy.extraParams.addr,customer:this.customer,customerFilter:this.customerFilter,otherSideAddress:this.otherSideAddress,otherSideHostnames:this.otherSideHostnames};
ajaxSafeRequest({url:"php/reports/charts_ipacc.php",params:{task:"getChart",params:Ext.encode(a)},success:function(d){this.addChart(c._typeChart,a,d.axis)
},scope:this,maskEl:this})
},addChart:function(h,d,c,b){var g=new IP_account.Chart({typeChart:h,chartParams:d,dataAxis:c,width:700,height:500});
if(b){var f=Math.min(1000,Ext.dom.Element.getViewportWidth()-20);
var a=Math.min(600,Ext.dom.Element.getViewportHeight()-20);
var k=new Ext.Window({closable:true,maximizable:true,resizable:true,layout:"fit",items:{xtype:"panel",layout:"fit",items:g,border:false},width:f,height:a});
k.show()
}else{this.gridExpPanel.insertChart(g,1)
}},isTop10:function(){return(this.grid.store.currentPage==1&&this.grid.store.sorters.items[0].getDirection()=="DESC"&&(this.grid.store.sorters.items[0].getProperty().match(/traffic/)||this.grid.store.sorters.items[0].getProperty().match(/packets/)))
},getGroupItem:function(){switch(this.grid.store.proxy.extraParams.group){case"IP":return("addr");
case"protocol":return("protocol");
case"port":return("port")
}return("addr")
},getGroupSubitem:function(){switch(this.grid.store.proxy.extraParams.group){case"IP":return("addr_hostname")
}return(null)
},getSortItem:function(){return(this.grid.store.sorters.items[0].getProperty())
}});
Ext.define("IP_account.IPsum.PiePanel",{extend:"Ext.Panel",subsystem:"ipaccount",constructor:function(b){var a=new Ext.data.ArrayStore({fields:["descr","subdescr","total"],data:[]});
this.store=a;
this.pieChart=new Ext.chart.PolarChart({store:this.store,theme:"IpaccChartPie",animate:true,shadow:true,series:[{type:"pie",angleField:"total",label:{field:"descr",display:"rotate",contrast:true,font:"10px Arial"},highlight:{segment:{margin:20}},tips:{trackMouse:true,width:180,height:46,renderer:function(f,d,c){var g=0;
a.each(function(h){g+=h.get("total")
});
value=d.get("total");
formatValue=this.dataType=="traffic"?formatTraffic(value):formatPackets(value);
colorValue=this.dataDirection=="in"?"green":this.dataDirection=="out"?"red":"blue";
f.setTitle(d.get("descr")+"<br>"+(d.get("subdescr")||"").trunc(25)+'<br><span style="color: '+colorValue+';">'+formatValue+'</span><span style="color: grey;"> / '+Math.round(value/g*100)+"%")+"</span>"
},scope:this}}]});
b=Ext.applyIf(b||{},{border:false,items:this.pieChart});
this.callParent([b])
},fillStore:function(c){this.store.removeAll();
if(this.gridPanel.isTop10()&&this.gridPanel.grid.store.getCount()>1){var f=this.gridPanel.grid.store;
var b=this.gridPanel.getGroupItem();
var a=this.gridPanel.getGroupSubitem();
var h=this.gridPanel.getSortItem();
for(var d=0;
d<f.getCount();
d++){var g=f.getAt(d).data;
this.store.add({descr:this.getDescr(g[b]),subdescr:this.getSubdescr(a?g[a]:null,g[b]),total:g[h]})
}this.dataType=h.match("traffic")?"traffic":"packets";
this.dataTypeDescr=h.match("traffic")?"traffic":"packets";
this.dataDirection=h.match("_in")?"in":h.match("_out")?"out":"sum";
this.dataDirectionDescr=h.match("_in")?"download":h.match("_out")?"upload":"sum";
this.enable();
this.unmask();
this.setPieTitle()
}else{this.disableAndCollapse()
}},disableAndCollapse:function(){this.store.removeAll();
this.dataType=null;
this.dataDirection=null;
this.disable();
this.setPieTitle();
this.collapse()
},getDescr:function(a){switch(this.gridPanel.grid.store.proxy.extraParams.group){case"port":return(a>0?a:"other")
}return(a)
},getSubdescr:function(a,b){switch(this.gridPanel.grid.store.proxy.extraParams.group){case"protocol":return(getDataArrayItem(arIpProto,b))
}return(a)
},setPieTitle:function(){var a=this.findLangS("title","top10");
if(this.dataTypeDescr){a+=" - by "+this.dataTypeDescr;
if(this.dataDirectionDescr){a+=" / "+this.dataDirectionDescr
}}this.setTitle(a)
}});
Ext.define("IP_account.IPsumDU.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.ipacc_ip_group_sum.GridX",subsystem:"ipaccount",constructor:function(a){var f=__width_ColumnChar(50);
var c=[{dataIndex:"addr",width:f,sortable:true,renderer:g},{header:this.findLangS("column","download")+'<img src="images/icon/tr_download_simple_small.png">',dataIndex:a.invertRenderTraffic?"traffic_out":"traffic_in",widthNum:12,sortable:true,align:"right",renderer:d,_type:"in",sortBy:{traffic_in:this.findLangS("sortBy","traffic"),packets_in:this.findLangS("sortBy","packets")}},{header:this.findLangS("column","upload")+'<img src="images/icon/tr_upload_simple_small.png">',dataIndex:a.invertRenderTraffic?"traffic_in":"traffic_out",widthNum:12,sortable:true,align:"right",renderer:d,_type:"out",sortBy:{traffic_in:this.findLangS("sortBy","traffic"),packets_in:this.findLangS("sortBy","packets")}},{header:'<img src="images/icon/sum_small2.png">',dataIndex:"traffic_sum",widthNum:12,sortable:true,align:"right",renderer:d,_type:"sum",sortBy:{traffic_in:this.findLangS("sortBy","traffic"),packets_in:this.findLangS("sortBy","packets")}}];
a=Ext.applyIf(a||{},{storeId:"IP_account.IPsumDU.Store",url:"php/model/sql.php",module:"ipacc_group_sum",extraParams:{addr:a.addr,interval:a.interval,group:"IP"},recordStruct:rsIPaccIPsum,keyField:"addr",sortField:"traffic_sum",sortDirection:"DESC",remoteSort:true,pageSize:10,columns:c,prefixCls:"ipacc_ip_group_sum",stripeRows:false,plugins:["columnSort"],title:b()});
this.callParent([a]);
function b(){return(this.findLangS("column","traffic_sum"+a.interval))
}function g(o,l,k,p,n,m,h){return(o+(k.data.addr_hostname?"  ( "+k.data.addr_hostname+" )":""))
}function d(r,l,o,p,t,s,q){var k=q.ownerCt;
var m=q&&q.ownerCt&&q.ownerCt.getHeaderContainer?q.ownerCt.getHeaderContainer().getHeaderAtIndex(t):null;
if(!m){return(r)
}var h=m._type=="in"?(k.invertRenderTraffic?"traffic_out":"traffic_in"):m._type=="out"?(k.invertRenderTraffic?"traffic_in":"traffic_out"):"traffic_sum";
var n=m._type=="in"?(k.invertRenderTraffic?"packets_out":"packets_in"):m._type=="out"?(k.invertRenderTraffic?"packets_in":"packets_out"):"traffic_sum";
return(formatTraffic(o.data[h])+'<br><span style="color: grey; font-size: 80%;">'+formatPackets(o.data[n])+"</span>")
}}});
Ext.define("IP_account.CustCustomerExplore.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"ipaccount",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"CustomerExplore",url:"php/model/sql.php",module:"cust_customer_explore",recordStruct:rsCustCustomer_explore,sortField:"city_address_ctype",remoteSort:true,columns:[{dataIndex:"city",flex:1},{dataIndex:"address",flex:1},{dataIndex:"connection_type",flex:1}],titleLang:"customerServices",plugins:[{ptype:"rowexpander",rowBodyContentCls:"IP_account.CustCustomerExplore.GridExpPanel",rowBodyContentConfig:{customer:a.extraParams.customer,userInterval:a.useUserInterval},expandOnEnter:false,expandOnDblClick:false,noVerticalScroller:true,autoRelayoutExpanders:true,autoRelayoutExpanders_mask:true,enableSelectRowOnClick:false}],prefixCls:"ipacc_cust_expl",stripeRows:false});
this.callParent([a])
}});
Ext.define("IP_account.CustCustomerExplore.GridExpPanel",{extend:"Ext.Panel",subsystem:"ipaccount",constructor:function(a){this.custExplIp=new IP_account.IPsum.Grid({extraParams:{customerFilter:a.customer,customer_explore:Ext.encode({customer:a.customer,city:a.record.data.city,address:a.record.data.address,connection_type:a.record.data.connection_type}),userInterval:Ext.encode(a.userInterval),disableFindNameType:true},useUserInterval:a.userInterval,fullColumnSize:"addr",enableExpander:true,useUserInterval:true,simpleToolbar:true,prefixCls:"ipacc_cust_ip_sum_ui",_by:"IP",pageSize:20,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","IP")});
this.map=new GMap.Panel({postalAddress:a.record.data.city+", "+a.record.data.address,height:500,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel=new Ext.TabPanel({items:[this.custExplIp,this.map],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:a.grid.prefixCls+"-cell",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("IP_account.IPsum.GridExpPanel",{extend:"Ext.Panel",subsystem:"ipaccount",constructor:function(b){var a=b.grid.usedGroups||[{group:"root"}];
if(a.length){a[a.length-1].grid=b.grid;
a[a.length-1].record=b.record
}var d=l("customer");
var g=(ipaccPorts?2:1)+(IP_acount.Utils.enableIpDetail(d)?1:0);
var k=[];
if(c("user_interval")&&b.level==1&&b.grid._by=="customer"&&window.custom_configuration_existFce_custom_getIpByCustomerExplore){this.custCustomerExplore=new IP_account.CustCustomerExplore.Grid({extraParams:{customer:c("customer"),userInterval:Ext.encode(c("user_interval")),group:"cust_explore"},level:b.level+1,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},useUserInterval:c("user_interval")});
k.push(this.custCustomerExplore)
}if(!h("IP")){if(IP_acount.Utils.enableIpDetail(d)){this.ipSumViaAddr=new IP_account.IPsum.Grid({extraParams:{addr:c("addr"),customer:c("customer"),protocol:c("protocol"),port:c("port"),group:"IP",act_time:c("act_time"),userInterval:Ext.encode(c("user_interval")),customerFilter:c("customer_filter"),controlCustomerId:d.customer_id},module:"ipacc_group_sum",level:b.level+1,prefixCls:b.grid.prefixCls+"_"+b.level+"_"+ip_to_id(b.record.data.addr),fullColumnSize:"addr",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","oppositeDirection"),enableColumnCheckBoxChangeHideEmpty:true,pageSize:10,deferredLoad:!this.custCustomerExplore,listeners:{scope:this,afterrender:function(){if(this.ipSumViaAddr._stored){gridEmptyInfo(this.ipSumViaAddr.grid)
}}},usedGroups:a.concat({group:"IP"}),enableExpander:a.length<g,useUserInterval:c("user_interval"),useCustomerFilter:c("customer_filter"),gridExpPanel:this,enableChartsButton:false});
this.ipSumViaAddr.grid.store.on("load",function(m){this.ipSumViaAddr._stored=true;
gridEmptyInfo(this.ipSumViaAddr.grid)
},this);
k.push(this.ipSumViaAddr)
}if(b.level==1&&c("user_interval")){this.chartsPanel=new IP_account.ChartsPanel({userInterval:c("user_interval"),addr:c("addr"),customer:c("customer"),customerFilter:c("customer_filter"),addrPanel:this.ipSumViaAddr,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},rootData:d,disabled:!!this.ipSumViaAddr});
k.push(this.chartsPanel);
if(this.ipSumViaAddr){this.ipSumViaAddr.chartsPanel=this.chartsPanel
}this.chartsPanelVoip=new IP_account.ChartsPanel({voip:true,userInterval:c("user_interval"),addr:c("addr"),customer:c("customer"),customerFilter:c("customer_filter"),addrPanel:this.ipSumViaAddr,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},rootData:d,disabled:!!this.ipSumViaAddr});
k.push(this.chartsPanelVoip);
if(this.ipSumViaAddr){this.ipSumViaAddr.chartsPanelVoip=this.chartsPanelVoip
}}}if(!h("protocol")){this.ipSumViaProtocol=new IP_account.IPsum.Grid({extraParams:{addr:c("addr"),customer:c("customer"),other_side_addr:c("other_side_addr"),port:c("port"),group:"protocol",act_time:c("act_time"),userInterval:Ext.encode(c("user_interval")),customerFilter:c("customer_filter")},module:"ipacc_group_sum",keyField:"protocol",level:b.level+1,prefixCls:b.grid.prefixCls+"_"+b.level+"_"+ip_to_id(b.record.data.addr),fullColumnSize:"protocol",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","protocol"),enableColumnCheckBoxChangeHideEmpty:true,pageSize:10,listeners:{scope:this,afterrender:function(){if(this.ipSumViaProtocol._stored){gridEmptyInfo(this.ipSumViaProtocol.grid)
}}},usedGroups:a.concat({group:"protocol"}),enableExpander:a.length<g,useUserInterval:c("user_interval"),useCustomerFilter:c("customer_filter")});
this.ipSumViaProtocol.grid.store.on("load",function(m){this.ipSumViaProtocol._stored=true;
gridEmptyInfo(this.ipSumViaProtocol.grid)
},this);
k.push(this.ipSumViaProtocol)
}if(ipaccPorts&&!h("port")){this.ipSumViaPort=new IP_account.IPsum.Grid({extraParams:{addr:c("addr"),customer:c("customer"),other_side_addr:c("other_side_addr"),protocol:c("protocol"),group:"port",act_time:c("act_time"),userInterval:Ext.encode(c("user_interval")),customerFilter:c("customer_filter")},module:"ipacc_group_sum",keyField:"port",level:b.level+1,prefixCls:b.grid.prefixCls+"_"+b.level+"_"+ip_to_id(b.record.data.addr),fullColumnSize:"port",style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:this.findLangS("title","port"),enableColumnCheckBoxChangeHideEmpty:true,pageSize:10,listeners:{scope:this,afterrender:function(){if(this.ipSumViaPort._stored){gridEmptyInfo(this.ipSumViaPort.grid)
}}},usedGroups:a.concat({group:"port"}),enableExpander:a.length<g,useUserInterval:c("user_interval"),useCustomerFilter:c("customer_filter")});
this.ipSumViaPort.grid.store.on("load",function(m){this.ipSumViaPort._stored=true;
gridEmptyInfo(this.ipSumViaPort.grid)
},this);
k.push(this.ipSumViaPort)
}this.tabPanel=new Ext.TabPanel({items:k,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:b.grid.prefixCls+"-cell",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(b,{items:this.tabPanel,border:false});
this.callParent([b]);
this.intervalDU=[];
function h(n){for(var m=0;
m<a.length;
m++){if(a[m].group==n){return(m+1)
}}return(null)
}function f(m){var n=h(m);
return(n?a[n-1]:null)
}function c(o){var n=null;
switch(o){case"addr":n=f("root");
if(n&&n.grid._by!="customer"){return(n.record.data.addr)
}break;
case"customer":n=f("root");
if(n&&n.grid._by=="customer"){return(n.record.data.customer_id)
}else{if(n&&n.grid.store.proxy.extraParams.customer_explore){return(Ext.isString(n.grid.store.proxy.extraParams.customer_explore)?Ext.decode(n.grid.store.proxy.extraParams.customer_explore).customer:n.grid.store.proxy.extraParams.customer_explore.customer)
}}break;
case"other_side_addr":n=f("IP");
if(n){return(n.record.data.addr)
}break;
case"protocol":n=f("protocol");
if(n){return(n.record.data.protocol)
}break;
case"port":n=f("port");
if(n){return(n.record.data.port)
}break;
case"act_time":n=f("root");
if(n){return(n.record.data.act_time)
}break;
case"user_interval":n=f("root");
if(n){if(n.record.data.user_interval_from||n.record.data.user_interval_to){var m={};
if(n.record.data.user_interval_from){m.from=n.record.data.user_interval_from
}if(n.record.data.user_interval_to){m.to=n.record.data.user_interval_to
}return(m)
}}break;
case"customer_filter":n=f("root");
if(n){if(n.grid.store.proxy.extraParams.userFilterCustomer){return(n.grid.store.proxy.extraParams.userFilterCustomer)
}}break
}return(null)
}function l(){group=f("root");
if(group){return(group.record.data)
}}},gotoTabIntervalDU:function(g,b,c,f){var a=g+"_"+c+"_"+f;
var d=this.getIndexItemForTabName(a);
if(d!==null){this.tabPanel.setActiveTab(d)
}else{this.createTabIntervalDU(g,b,c,f,a)
}},createTabIntervalDU:function(f,b,c,d,a){this.intervalDU[c]=new IP_account.IPsumDU.Grid({addr:f,recordIpacc:b,interval:c,_idTab:a,closable:true,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},pageSize:20});
this.intervalDU[c].store.on("load",function(g){gridEmptyInfo(this.intervalDU[c])
},this);
this.tabPanel.add(this.intervalDU[c]);
this.tabPanel.setActiveTab(this.getIndexItemForTabName(a))
},getIndexItemForTabName:function(a){for(var b=0;
b<this.tabPanel.items.length;
b++){if(this.tabPanel.items.get(b)._idTab==a){return(b)
}}return(null)
},insertChart:function(b,a){this.tabPanel.insert(a,{xtype:"panel",title:"chart",layout:"fit",items:b,border:false,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},closable:true});
this.tabPanel.setActiveTab(a)
}});
Ext.define("IP_account.ChartsPanel",{extend:"Ext.Panel",subsystem:"ipaccount",constructor:function(c){this.fieldDateFrom=new Ext.ux.form.SearchDateTime({value:c.userInterval.from,_type:"from",_gridForm:this,_buttonGroup:true,onSetDate:b,scope:this,zeroTimeEmpty:true,timeCfg:{format:"H",increment:60,width:25+__width_Trigger}});
this.fieldDateTo=new Ext.ux.form.SearchDateTime({value:c.userInterval.to,_type:"to",_gridForm:this,_buttonGroup:true,onSetDate:b,scope:this,zeroTimeEmpty:true,timeCfg:{format:"H",increment:60,width:25+__width_Trigger}});
var k=[{xtype:"displayfield",value:findLangSd("from")+":",fieldCls:"x-toolbar-text"},this.fieldDateFrom,{xtype:"displayfield",value:findLangSd("to")+":",fieldCls:"x-toolbar-text"},this.fieldDateTo];
this.chartBar=new Ext.tab.Bar({dock:"top",plain:true,border:false,bodyBorder:false,style:{"background-color":__color_PanelBackgroud},listeners:{scope:this,change:a},renderTpl:__tpl_simplyTabPanel});
var g=["traffic","traffic_area","packets","packets_area"];
if(IP_acount.Utils.enableIpDetail(c.rootData)){g.push("traffic_top_10_in","traffic_top_10_out")
}for(var d=0;
d<g.length;
d++){this.chartBar.add({text:this.findLangS("title","chart_"+g[d]),closable:false,_typeChart:g[d]})
}if(c.addr||c.customer){this.chartBar.add({text:this.findLangS("button","realTimeChart"),closable:false,_typeChart:"realTimeChart"})
}this.chartContainer=new Ext.Panel({layout:"fit",border:false,tbar:k,disabled:true,height:550});
c=Ext.applyIf(c||{},{title:this.findLangS("title",c.voip?"chartsVoip":"chartsAll"),iconCls:"icon_menu_diag_system",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",items:this.chartBar,height:24,style:{"background-color":c.tabBackgroundColor||__color_PanelBackgroud}},this.chartContainer],border:false,listeners:{scope:this,activate:h,destroy:f}});
this.callParent([c]);
function h(){if(!this.firstActivate){Ext.defer(function(){this.chartBar.setActiveTab(this.chartBar.items.get(0))
},50,this);
this.firstActivate=true
}}function f(){if(this.realTimeChart){this.realTimeChart.destroy()
}}function a(l,m){this.selectChartTab=m;
if(this.dataAxis){if(this.selectChartTab._typeChart.match(/top_10/)&&!this.top10_loaded){this.loadChartsData(null,null,true)
}else{this.doCreateChart(this.selectChartTab._typeChart)
}}else{this.loadChartsData()
}}function b(l,m){if(this._disable_onSetFilterDateTime){return
}if(l._type=="from"){this.userInterval.from=m
}else{this.userInterval.to=m
}if(date(this.userInterval.from).getTime()==date(this.userInterval.to).getTime()){this.fieldDateFrom.timeField.enable();
this.fieldDateTo.timeField.enable()
}else{this.fieldDateFrom.trimTime();
this.fieldDateFrom.timeField.disable();
this.fieldDateTo.trimTime();
this.fieldDateTo.timeField.disable()
}this.userInterval.from=this.fieldDateFrom.getValue();
this.userInterval.to=this.fieldDateTo.getValue();
this.loadChartsData()
}},loadChartsData:function(a,c,b){this.removeAllCharts();
this.chartContainer.disable();
this.chartParams={dateTimeFrom:a||this.userInterval.from,dateTimeTo:c||this.userInterval.to||date(),addr:this.addr,customer:this.customer,customerFilter:this.customerFilter,otherSideAddress:this.otherSideAddress,otherSideHostnames:this.otherSideHostnames,voip:this.voip,top10:b};
ajaxSafeRequest({url:"php/reports/charts_ipacc.php",params:{task:"getChart",params:Ext.encode(this.chartParams)},success:function(d){this.createStore(d.axis);
this.createChart(this.selectChartTab._typeChart,true);
if(b){this.top10_loaded=true
}},scope:this,maskEl:this,deferMask:true})
},createStore:function(a){if(this.store){this.store.removeAll()
}this.dataAxis=a;
this.store=new Ext.data.JsonStore({fields:IP_acount.Utils.getChartStoreFields(null,true,this.chartParams),data:a.axis.axis})
},doCreateChart:function(a){this.removeAllCharts();
this.maskLoad();
Ext.defer(this.createChart,250,this,[a,true])
},createChart:function(b,c){this.removeAllCharts();
this.chartContainer.enable();
this.chartContainer.unmask();
var a;
if(b=="realTimeChart"){if(this.realTimeChart){a=this.realTimeChart;
if(c){this.unmask()
}}else{this.createRealChart(c);
return
}}else{a=new IP_account.ChartPanel({chartConfig:{typeChart:b,chartParams:this.chartParams,dataAxis:this.dataAxis,unmaskComp:c?this:null,store:this.store},chartsPanel:this})
}this.chartContainer.add(a)
},createRealChart:function(f,h){if(!h){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getSensors",params:Ext.encode({withLocal:true})},success:function(k){this.createRealChart(f,k.sensors||-1)
},scope:this});
return
}var d=new IP_account.RealChart({addr:this.addr,customer:this.customer,unmaskComp:f?this:null,type:this.voip?"voip":"comb",oneAxes:!this.voip,sensors:h===-1?null:h,title:h===-1?"local":h[0].name,id_sensor:h===-1?undefined:h[0].id_sensor});
var g=[{xtype:"panel",layout:"fit",items:d,border:false,flex:1}];
if(h&&h!==-1){for(var c=1;
c<h.length;
c++){var b=new IP_account.RealChart({addr:this.addr,customer:this.customer,unmaskComp:f?this:null,type:this.voip?"voip":"comb",oneAxes:!this.voip,store:d.store,slave:true,title:h[c].name,id_sensor:h[c].id_sensor});
d.addSlave(b);
g.push({xtype:"panel",layout:"fit",items:b,border:false,flex:1})
}}var a=new Ext.Panel({layout:{type:"vbox",align:"stretch"},items:g,border:false,_realTimeChartMainPanel:true});
this.realTimeChart=a;
this.chartContainer.add(a)
},timeShift:function(c){var a=IP_acount.Utils.getHoursInInterval(this.chartParams.dateTimeFrom,this.chartParams.dateTimeTo);
var d=new Date(this.chartParams.dateTimeFrom.getTime()+a*60*60*1000*(c?1:-1));
var b=new Date(this.chartParams.dateTimeTo.getTime()+a*60*60*1000*(c?1:-1));
if(!time_sec(this.chartParams.dateTimeFrom)){d=date(d)
}if(!time_sec(this.chartParams.dateTimeTo)){b=date(b)
}this.userInterval.from=d;
this.userInterval.to=b;
this._disable_onSetFilterDateTime=true;
this.fieldDateFrom.setValue(d);
this.fieldDateTo.setValue(b);
this._disable_onSetFilterDateTime=false;
this.loadChartsData()
},removeAllCharts:function(){while(this.chartContainer.items.length){var a=this.chartContainer.items.get(0);
this.chartContainer.remove(a,!(a._realTimeChartMainPanel||a instanceof IP_account.RealChart))
}}});
Ext.define("IP_account.ChartPanel",{extend:"Ext.Panel",subsystem:"ipaccount",constructor:function(a){a=Ext.applyIf(a||{},{layout:"absolute",border:false,listeners:{afterrender:function(){this.doCreateChart()
},resize:function(c,d,b){if(this.chart){this.chart.setSize(d,b)
}this.setToolsPanelPosition()
},scope:this}});
this.callParent([a])
},doCreateChart:function(){var a=this.getSize();
if(a.width>50&&a.height>50){this.createChart(a.width,a.height)
}else{Ext.defer(this.doCreateChart,20,this)
}},createChart:function(b,a){this.chart=new IP_account.Chart(Ext.apply({width:b,height:a,exportToSvg:false},this.chartConfig));
var c=[{flex:1}];
if(this.chartsPanel){c.push({xtype:"button",iconCls:"x-tbar-page-prev",handler:function(d){this.chartsPanel.timeShift(false)
},tooltip:this.findLangS("button_help","prev")},{xtype:"button",iconCls:"x-tbar-page-next",handler:function(d){this.chartsPanel.timeShift(true)
},tooltip:this.findLangS("button_help","next")})
}if(this.chart.exportToSvg){c.push({xtype:"button",iconCls:"icon_save2_blue",handler:function(d){this.saveChart("svg")
},tooltip:this.findLangS("button_help","saveAsSVG")})
}this.add([this.chart,new Ext.panel.Panel({layout:"hbox",x:5,y:5,width:20*c.length,border:false,_id:"tools",defaults:{border:false,style:{background:"transparent"},scope:this},items:c})]);
this.setToolsPanelPosition()
},setToolsPanelPosition:function(){if(!this.getEl()){return
}if(this.items.getCount()<2||this.items.items[1]._id!="tools"||!this.items.items[1].getEl()){return
}var b=this.getWidth();
var c=this.getPosition();
var a=this.items.items[1].getWidth()||this.items.items[1].width;
this.items.items[1].show();
this.items.items[1].setStyle({"z-index":10});
this.items.items[1].setXY([c[0]+b-a,c[1]])
},saveChart:function(a){this.chart.saveChart(a)
}});
Ext.define("IP_account.Chart",{extend:"Ext.chart.CartesianChart",constructor:function(b){var m=b.store||h();
Ext.apply(b,{xtype:"cartesian",store:m,axes:c(),series:l(),shadow:false,theme:"IpaccChart",legend:{docked:"bottom",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:2},background:{fill:"white"},border:false,listeners:{boxready:function(){if(b.unmaskComp){b.unmaskComp.unmask()
}}}});
if(b.exportToSvg){Ext.apply(b,{engine:Ext.draw.engine.Svg})
}this.callParent([b]);
function h(){return(new Ext.data.JsonStore({fields:IP_acount.Utils.getChartStoreFields(null,true,b.chartParams),data:b.dataAxis.axis.axis}))
}function l(){var o="#129B00";
var v="#0006C2";
var w="#FF0000";
var D={"in":o,out:v,sum:w};
var C;
var s=false;
var B=[];
var E=[];
var r=[];
var q=[];
var p="area";
switch(b.typeChart){case"traffic":B=[["data_traffic_in","in",o],["data_traffic_out","out",v]];
dataType="traffic";
s=true;
break;
case"traffic_area":E=["data_traffic_in","data_traffic_out"];
r=["in","out"];
dataType="traffic";
C=__colors_IpaccChartAreaInOut;
break;
case"packets":B=[["data_packets_in","in",o],["data_packets_out","out",v]];
dataType="packets";
s=true;
break;
case"packets_area":E=["data_packets_in","data_packets_out"];
r=["in","out"];
dataType="packets";
C=__colors_IpaccChartAreaInOut;
break;
case"traffic_top_10_sum":case"traffic_top_10_in":case"traffic_top_10_out":var A;
var z;
switch(b.typeChart){case"traffic_top_10_sum":A="sum";
z="data_traffic_sum";
break;
case"traffic_top_10_in":A="in";
z="data_traffic_in";
break;
case"traffic_top_10_out":A="out";
z="data_traffic_out";
break
}E=IP_acount.Utils.getChartStoreFields({time:false,main:false,otherSideAddress:true,dataType:"traffic",direction:A},false,b.chartParams);
r=b.chartParams.otherSideAddress,q=b.chartParams.otherSideHostnames,B=[[z,A,"grey"]];
dataType="traffic";
if(m.getCount()<50){p="bar"
}C=__colors_IpaccChartArea;
break
}var t=[];
if(B.length){for(var y=0;
y<B.length;
y++){var u=B[y][2];
t.push({title:B[y][1],type:"line",axis:"left",xField:"timeFromStr",yField:B[y][0],smooth:true,highlight:true,fill:s,style:{_seriesColor:u,stroke:u,fill:s?lightColor(u):"white",lineWidth:1},highlightCfg:{stroke:u},tips:{trackMouse:true,width:150,height:34,renderer:function(H,G,F){yField=F.field;
title=F.series._title;
tipTitle="";
if(title){tipTitle="<b><i>"+title+"</i></b><br>"
}tipTitle+=k(G.get(yField),F.series.tips._dataType);
H.setTitle(tipTitle)
},_dataType:dataType}})
}}if(E.length){t.push({title:r,subtitle:q,type:p,stacked:true,axis:"left",xField:"timeFromStr",yField:E,smooth:true,colors:C,highlightCfg:{"stroke-width":0},tips:{trackMouse:true,width:150,height:q&&q.length?46:34,renderer:function(K,J,I){var H=null;
var L=null;
var G=null;
var F=I.series._yField.indexOf(I.field);
if(F>=0){H=I.series._yField[F];
if(F<I.series._title.length){L=I.series._title[F];
if(I.series.subtitle&&I.series.subtitle.length){G=I.series.subtitle[F]
}}}if(H&&L){tipTitle="";
if(L){tipTitle="<b><i>"+L+"</i></b><br>"
}if(G){tipTitle+="<i>"+G.trunc(20)+"</i><br>"
}tipTitle+=k(J.get(H),I.series.tips._dataType);
K.setTitle(tipTitle)
}},_dataType:dataType}})
}return(t)
}function c(){var o=[];
var p;
switch(b.typeChart){case"traffic":case"traffic_area":case"traffic_top_10_sum":case"traffic_top_10_in":case"traffic_top_10_out":var s;
var q;
switch(b.typeChart){case"traffic_top_10_in":s="in";
q=true;
break;
case"traffic_top_10_out":s="out";
q=true;
break;
case"traffic_top_10_sum":q=true;
break
}o=IP_acount.Utils.getChartStoreFields({otherSideAddress:q,dataType:"traffic",direction:s},false,b.chartParams);
p="traffic";
break;
case"packets":case"packets_area":o=IP_acount.Utils.getChartStoreFields({otherSideAddress:false,dataType:"packets"},false,b.chartParams);
p="packets";
break
}var r=[];
r.push({type:"numeric",position:"left",fields:o,grid:true,gridColor:"#F0F0F0",renderer:function(w,v,u,y){var t=w.config.label;
return(k(v,t._dataType))
},label:{_dataType:p}});
r.push(f());
return(r)
}function f(){return({type:"category",position:"bottom",fields:"timeFromStr",grid:true,gridColor:"#F0F0F0",renderer:function(r,q,o,u){var s=q;
var t=g();
if(t=="Y-m"){var p=s.getDate();
if(p>25){s=new Date(s.getTime()+(32-p)*24*60*60*1000)
}}return Ext.Date.format(s,t)
},label:{rotate:{degrees:-60}},title:n()})
}function k(p,o){var q=o=="traffic"?formatTraffic(p,null,"/s",true,true,true):formatPackets(p,null,"/s",true);
if(!q&&Ext.isOpera){q="Â "
}return(q)
}function a(){return(IP_acount.Utils.getHoursInInterval(b.chartParams.dateTimeFrom,b.chartParams.dateTimeTo))
}function d(){var q;
var o=false;
var p=a();
if(p<=24){q=p
}else{if(p<365*24/2){q=p/24
}else{q=p/24/30.5;
o=true
}}if(q&&!o){if(q<15){while(q<15){q*=2
}}else{if(q>31){while(q>31){q/=2
}}}}return(Math.round(q)||20)
}function g(){var p;
var o=a();
if(o<=24){p=__format_TimeM
}else{if(o/24<15){p="d / "+__format_TimeM
}else{if(o/24<28){p="d / H"
}else{if(o/24<=31){p="d"
}else{if(o/24<365/2){p="m-d"
}else{p="Y-m"
}}}}}return(p)
}function n(){return((b.chartParams.dateTimeFrom&&b.chartParams.dateTimeTo&&b.chartParams.dateTimeFrom.getTime()==b.chartParams.dateTimeTo.getTime()?Ext.Date.format(b.chartParams.dateTimeFrom,time_sec(b.chartParams.dateTimeFrom)?"Y-m-d H:i":"Y-m-d"):((b.chartParams.dateTimeFrom?"from "+Ext.Date.format(b.chartParams.dateTimeFrom,time_sec(b.chartParams.dateTimeFrom)?"Y-m-d H:i":"Y-m-d"):"")+" "+(b.chartParams.dateTimeTo?"to "+Ext.Date.format(b.chartParams.dateTimeTo,time_sec(b.chartParams.dateTimeTo)?"Y-m-d H:i":"Y-m-d"):"")))+" / "+arLang["LtimeAxis_"+b.dataAxis.type])
}},saveChart:function(b){var a=this.getSvg();
ajaxSafeRequest({url:"php/reports/charts_ipacc.php",params:{task:"testSaveChart",params:Ext.encode({svg:a,saveType:b})},success:function(c){this.doSaveChart(b)
},scope:this})
},doSaveChart:function(b){var a=this.getSvg();
formPostSafe("php/reports/charts_ipacc.php","POST",{task:"saveChart",params:Ext.encode({svg:a,saveType:b})})
},getSvg:function(){var a=this.getImage();
if(a&&a.data){return(decodeURIComponent(a.data).substr(24))
}}});
Ext.define("IP_account.RealChart",{extend:"Ext.chart.CartesianChart",subsystem:"ipaccount",optimizeSpeed:true,constructor:function(b){this._id=""+(user_id()||"")+time_sec(new Date)+Math.ceil(Math.random()*100);
this.timeAxisConfig=this.optimizeSpeed?{valueStep:2*1000,length:2*60*1000,typeStep:Ext.Date.SECOND,mainStepLength:4*1000,subStepLength:2*1000}:{valueStep:1*1000,length:2*60*1000,typeStep:Ext.Date.SECOND,mainStepLength:2*1000,subStepLength:1*1000};
this.timeAxisConfig.typeStepLength=this.timeAxisConfig.typeStep==Ext.Date.MINUTE?60*1000:1000;
this.timeAxisConfig.fromTime=this.timeAxisConfig.typeStep==Ext.Date.MINUTE?timeMinuteFloor(new Date()):new Date(Math.floor(timeSecondFloor(new Date()).getTime()/this.timeAxisConfig.mainStepLength)*this.timeAxisConfig.mainStepLength);
this.timeAxisConfig.toTime=new Date(this.timeAxisConfig.fromTime.getTime()+this.timeAxisConfig.length);
this.fieldsConfig={};
this.axesTitle={};
switch(b&&b.type||""){case"all_s":Ext.apply(this.fieldsConfig,{traffic_sum:{type:"sum",direction:"sum",color:"#129B00",name:findLangS(this.subsystem,"title_chart","speed"),side:"left"}});
Ext.apply(this.axesTitle,{left:findLangS(this.subsystem,"title_chart","speed")});
break;
case"all":Ext.apply(this.fieldsConfig,{traffic_in:{type:"sum",direction:"in",color:"#129B00",name:findLangS(this.subsystem,"title_chart","speedIn"),side:"left"},traffic_out:{type:"sum",direction:"out",color:"#0006C2",name:findLangS(this.subsystem,"title_chart","speedOut"),side:"left"}});
Ext.apply(this.axesTitle,{left:findLangS(this.subsystem,"title_chart","speed")});
break;
case"voip_s":Ext.apply(this.fieldsConfig,{traffic_voip_sum:{type:"voip",direction:"sum",color:"#FF0000",name:findLangS(this.subsystem,"title_chart","speedVoip"),side:"left"}});
Ext.apply(this.axesTitle,{left:findLangS(this.subsystem,"title_chart","speedVoip")});
break;
case"voip":Ext.apply(this.fieldsConfig,{traffic_voip_in:{type:"voip",direction:"in",color:"#129B00",name:findLangS(this.subsystem,"title_chart","speedVoipIn"),side:"left"},traffic_voip_out:{type:"voip",direction:"out",color:"#0006C2",name:findLangS(this.subsystem,"title_chart","speedVoipOut"),side:"left"}});
Ext.apply(this.axesTitle,{left:findLangS(this.subsystem,"title_chart","speedVoip")});
break;
case"comb_s":Ext.apply(this.fieldsConfig,{traffic_sum:{type:"sum",direction:"sum",color:"#129B00",name:findLangS(this.subsystem,"title_chart","speed"),side:"left"},traffic_voip_sum:{type:"voip",direction:"sum",color:"#FF0000",name:findLangS(this.subsystem,"title_chart","speedVoip"),side:"right"}});
Ext.apply(this.axesTitle,{left:findLangS(this.subsystem,"title_chart","speed"),right:findLangS(this.subsystem,"title_chart","speedVoip")});
break;
case"comb":default:Ext.apply(this.fieldsConfig,{traffic_in:{type:"sum",direction:"in",color:"#129B00",name:findLangS(this.subsystem,"title_chart","speedIn"),side:"left"},traffic_out:{type:"sum",direction:"out",color:"#0006C2",name:findLangS(this.subsystem,"title_chart","speedOut"),side:"left"},traffic_voip_in:{type:"voip",direction:"in",color:"#FF0000",name:findLangS(this.subsystem,"title_chart","speedVoipIn"),side:b.oneAxes?"left":"right"},traffic_voip_out:{type:"voip",direction:"out",color:"#FFC400",name:findLangS(this.subsystem,"title_chart","speedVoipOut"),side:b.oneAxes?"left":"right"}});
Ext.apply(this.axesTitle,{left:findLangS(this.subsystem,"title_chart","speed"),right:findLangS(this.subsystem,"title_chart","speedVoip")});
break
}if(b.store){this.store=b.store
}else{this.storeFields=this.getStoreFields(this.getFields(),b.sensors);
this.store=new Ext.data.JsonStore({fields:this.storeFields,data:[]})
}var d;
if(b.title){d=b.title;
delete b.title
}b=Ext.applyIf(b||{},{xtype:"cartesian",store:this.store,axes:this.createAxes(b.id_sensor),series:this.createSeries(b.id_sensor),animation:false,theme:"IpaccChart",legend:{docked:"bottom",type:"sprite",border:{strokeStyle:"#FFFFFF"},label:{fontSize:11},padding:3},background:{fill:"white"},border:false,listeners:{scope:this,afterrender:a,destroy:c,boxready:function(){if(b.unmaskComp){b.unmaskComp.unmask()
}}}});
if(d){if(!b.insetPadding){b.insetPadding={}
}b.insetPadding.top=27;
Ext.applyIf(b,{sprites:[{type:"text",text:d,font:"bold 13px tahoma,arial,verdana,sans-serif",width:200,height:20,x:10,y:16}]})
}this.callParent([b]);
function a(){this.doStartLoad()
}function c(){this.destroyed=true;
this.stopLoad()
}},doStartLoad:function(){if(this.slave||this.doStartLoad_processed){return
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"realtimeIpaccStart",params:Ext.encode({id:this._id,ip:this.addr?this.addr:undefined,customer:this.customer||0})},success:function(a){this.startLoad()
},scope:this});
this.doStartLoad_processed=true
},startLoad:function(){if(this.slave){return
}this.scheduler=Ext.TaskManager.start({run:this.doLoad,interval:this.timeAxisConfig.valueStep,scope:this});
debug_log("realtime chart start")
},stopLoad:function(){if(this.slave||this.stopLoad_processed||!this.scheduler){return
}Ext.TaskManager.stop(this.scheduler);
this.scheduler=null;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"realtimeIpaccStop",params:Ext.encode({id:this._id})}});
this.stopLoad_processed=true;
debug_log("realtime chart stop")
},doLoad:function(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"realtimeIpaccLoadData",params:Ext.encode({id:this._id,ip:this.addr?this.addr:undefined,customer:this.customer||0})},success:function(a){this.load(a.data)
},scope:this})
},load:function(g){if(!g||this.destroyed){return
}if(this._lastData){var k=["traffic_in","traffic_out","traffic_sum","traffic_voip_in","traffic_voip_out","traffic_voip_sum"];
var a={};
var n=true;
var l=0;
var d=null;
var b=null;
if(g.time){g.time=dateTimeStringToDate(g.time);
if(Ext.isString(this._lastData.time)){this._lastData.time=dateTimeStringToDate(this._lastData.time)
}d=g.time;
b=(d.getTime()-this._lastData.time.getTime())/1000;
for(var h=0;
h<k.length;
h++){var c=(g[k[h]]-this._lastData[k[h]])/b;
if(c>=0){a[k[h]]=c;
++l
}else{n=false
}}}if(this.sensors){for(var h=0;
h<this.sensors.length;
h++){var m="s_"+this.sensors[h].id_sensor;
if(g[m]){dataSensor=g[m];
lastDataSensor=this._lastData[m];
dataSensor.time=dateTimeStringToDate(dataSensor.time);
if(Ext.isString(lastDataSensor.time)){lastDataSensor.time=dateTimeStringToDate(lastDataSensor.time)
}if(!d){d=dataSensor.time
}if(!b){b=(d.getTime()-lastDataSensor.time.getTime())/1000
}for(var f=0;
f<k.length;
f++){var c=(dataSensor[k[f]]-lastDataSensor[k[f]])/b;
if(c>=0){a[k[f]+"_"+m]=c;
++l
}else{n=false
}}}}}if(n&&l){a.time=d;
a.time_int=d.getTime()/1000;
this.store.add(a)
}if(d.getTime()>this.timeAxisConfig.toTime.getTime()){this.timeShift(d)
}this.processData();
this.redraw();
if(this.slaves){for(var h=0;
h<this.slaves.length;
h++){this.slaves[h].processData();
this.slaves[h].redraw()
}}}this._lastData=g
},timeShift:function(c){c=this.timeAxisConfig.typeStep==Ext.Date.MINUTE?timeMinuteCeil(c):new Date(Math.ceil(timeSecondCeil(c).getTime()/this.timeAxisConfig.mainStepLength)*this.timeAxisConfig.mainStepLength);
var a=c.getTime()-this.timeAxisConfig.toTime.getTime();
this.timeAxisConfig.fromTime=new Date(this.timeAxisConfig.fromTime.getTime()+a);
this.timeAxisConfig.toTime=c;
while(this.store.getCount()&&this.store.getAt(0).data.time.getTime()<this.timeAxisConfig.fromTime.getTime()){this.store.removeAt(0)
}this.setTimeForTimeAxis(this.timeAxisConfig.fromTime,this.timeAxisConfig.toTime);
if(this.slaves){for(var b=0;
b<this.slaves.length;
b++){this.slaves[b].setTimeForTimeAxis(this.timeAxisConfig.fromTime,this.timeAxisConfig.toTime)
}}},setTimeForTimeAxis:function(c,b){for(var a=0;
a<this.axes.length;
a++){if(this.axes[a]._type=="time"){this.axes[a].setFromDate(c);
this.axes[a].setToDate(b);
break
}}},createSeries:function(b){var a=[];
for(var d in this.fieldsConfig){var c=this.fieldsConfig[d].color;
a.push({type:"line",axis:this.fieldsConfig[d].side,xField:"time",yField:d+(b?"_s_"+b:""),fill:false,style:{stroke:c,fill:c,lineWidth:2},tips:{trackMouse:true,width:150,height:34,renderer:function(f,h,g){yField=g.field;
title=g.series._title;
tipTitle="";
if(title){tipTitle="<b><i>"+title+"</i></b><br>"
}tipTitle+=g.series.tips._scope.renderValue(h.get(yField),g.series.tips._dataType);
f.setTitle(tipTitle)
},_scope:this,_dataType:"traffic"},title:this.fieldsConfig[d].name})
}return(a)
},createAxes:function(a){var b=this.createValueAxes(a);
b.push(this.createTimeAxis());
return(b)
},createValueAxes:function(d){var c={left:{gridColor:"#F0F0F0"},right:{gridColor:"#F4F4FF"}};
var f=[];
for(var b in c){var a=this.getFields({side:b,idSensor:d});
if(a&&a.length&&this.axesTitle[b]){f.push({type:"numeric",minimum:0,position:b,fields:a,grid:true,gridColor:c[b].gridColor,title:this.axesTitle[b],renderer:function(l,k,h,m){var g=l.config.label;
return(g._scope.renderValue(k,g._dataType))
},label:{_scope:this,_dataType:"traffic"}})
}}return(f)
},createTimeAxis:function(){return({type:"time",position:"bottom",fields:"time",dateFormat:this.timeAxisConfig.typeStep==Ext.Date.MINUTE?"H:i":"i:s",minorTickSteps:this.timeAxisConfig.mainStepLength/this.timeAxisConfig.subStepLength-1,step:[this.timeAxisConfig.typeStep,this.timeAxisConfig.mainStepLength/this.timeAxisConfig.typeStepLength],constrain:true,fromDate:this.timeAxisConfig.fromTime,toDate:this.timeAxisConfig.toTime,grid:true,gridColor:"#F0F0F0",label:{rotate:{degrees:-90}},_type:"time"})
},getFields:function(c){var a=[];
for(var b in this.fieldsConfig){if(!c||c.type&&this.fieldsConfig[b].type==c.type||c.side&&this.fieldsConfig[b].side==c.side){if(c&&c.idSensor){b+="_s_"+c.idSensor
}a.push(b)
}}return(a)
},getStoreFields:function(d,f){var b=[];
b.push({name:"time_int",type:"integer"},{name:"time",type:"date",dateFormat:__format_DateTimeDb});
for(var c=0;
c<d.length;
c++){b.push({name:d[c],type:"integer"})
}if(f){for(var c=0;
c<f.length;
c++){for(var a=0;
a<d.length;
a++){b.push({name:d[a]+"_s_"+f[c].id_sensor,type:"integer"})
}}}return(b)
},renderValue:function(b,a){var c=a=="traffic"?formatTraffic(b,null,"/s",true,true,true):formatPackets(b,null,"/s",true);
if(!c&&Ext.isOpera){c="Â "
}return(c)
},addSlave:function(a){if(!Ext.isDefined(this.slaves)){this.slaves=[]
}this.slaves.push(a)
}});
Ext.define("Ext.chart.theme.IpaccChart",{extend:"Ext.chart.theme.Base",alias:"chart.theme.IpaccChart",constructor:function(a){a.axis={left:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"blask"}},right:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"blask"}},bottom:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"blask"}}};
this.callParent([a])
}});
var __colors_IpaccChartAreaInOut=["#19D900","#005DF4"];
Ext.define("Ext.chart.theme.IpaccChartAreaInOut",{extend:"Ext.chart.theme.IpaccChart",alias:"chart.theme.IpaccChartAreaInOut",constructor:function(a){a.colors=__colors_IpaccChartAreaInOut;
this.callParent([a])
}});
var __colors_IpaccChartArea=["#94ae0a","#115fa6","#a61120","#ff8809","#ffd13e","#a61187","#24ad9a","#7c7474","#a66111","#4e0898"];
Ext.define("Ext.chart.theme.IpaccChartArea",{extend:"Ext.chart.theme.IpaccChart",alias:"chart.theme.IpaccChartArea",constructor:function(a){a.colors=__colors_IpaccChartArea;
this.callParent([a])
}});
Ext.define("Ext.chart.theme.IpaccChartPie",{extend:"Ext.chart.theme.IpaccChart",alias:"chart.theme.IpaccChartPie",constructor:function(a){var c=[];
for(var b=0;
b<__colors_IpaccChartArea.length;
b++){c.push(lightColor(__colors_IpaccChartArea[b]))
}a.colors=c;
this.callParent([a])
}});
Ext.define("IP_account.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.ipaccountPanelX",subsystem:"ipaccount",constructor:function(a){this.ipacc=new IP_account.IPsum.Grid({enableExpander:true,enableTrDetail:true,enableColumnCheckBoxChangeHideEmpty:true,useUserInterval:a&&a.useUserInterval,_by:a._by});
a=Ext.applyIf(a||{},{id:"ipaccount-panel",iconCls:"icon_menu_cdr",items:this.ipacc,titleLang:"IP_account"});
this.callParent([a])
}});
Ext.define("IP_account_ui.Panel",{extend:"IP_account.Panel",alias:"widget.ipaccount_uiPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"ipaccount_ui-panel",useUserInterval:true,_by:"IP"});
this.callParent([a])
}});
Ext.define("IP_account_ui_cust.Panel",{extend:"IP_account.Panel",alias:"widget.ipaccount_ui_custPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"ipaccount_ui_cust-panel",useUserInterval:true,_by:"customer"});
this.callParent([a])
}});
Ext.define("IP_account_ti.Panel",{extend:"IP_account.Panel",alias:"widget.ipaccount_tiPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"ipaccount_ti-panel",useUserInterval:false});
this.callParent([a])
}});
Ext.define("IP_acount.Utils",{singleton:true,getChartStoreFields:function(d,c,h){d=d||{};
var g=[];
if(!Ext.isDefined(d.time)||d.time){if(c){g.push({name:"timeFrom",type:"integer"},{name:"timeFromStr",type:"date",dateFormat:__format_DateTimeDb},{name:"timeTo",type:"integer"},{name:"timeToStr",type:"date",dateFormat:__format_DateTimeDb})
}else{g.push("timeFrom","timeFromStr","timeTo","timeToStr")
}}var k=["traffic","packets"];
var f=["in","out","sum"];
for(var l=0;
l<1+(h&&h.otherSideAddress?h.otherSideAddress.length:0);
l++){if(l==0?!Ext.isDefined(d.main)||d.main:!Ext.isDefined(d.otherSideAddress)||d.otherSideAddress){field="data_";
if(l>0){field+=h.otherSideAddress[l-1]+"_"
}for(var a=0;
a<k.length;
a++){if(!Ext.isDefined(d.dataType)||Ext.isString(d.dataType)&&k[a]==d.dataType||Ext.isArray(d.dataType)&&d.dataType.isIn(k[a])){for(var b=0;
b<f.length;
b++){if(!Ext.isDefined(d.direction)||Ext.isString(d.direction)&&f[b]==d.direction||Ext.isArray(d.direction)&&d.direction.isIn(f[b])){_field=field+k[a]+"_"+f[b];
_field=_field.replaceall(".","x");
if(c){g.push({name:_field,type:"integer"})
}else{g.push(_field)
}}}}}}}return(g)
},getHoursInInterval:function(b,c){var a;
if(c.getTime()==b.getTime()){a=24
}else{if(time_sec(b)||time_sec(c)){a=Math.round((c.getTime()-b.getTime())/(60*60*1000))+(time_sec(c)?0:24)
}else{a=Math.round((c.getTime()-b.getTime())/(24*60*60*1000))*24+24
}}return(a)
},enableIpDetail:function(a){if(user.sqlrow.login_type=="user"){return(true)
}if(user.sqlrow.customers&&a.customer_id&&user.sqlrow.customers[a.customer_id]){return(user.sqlrow.customers[a.customer_id].enable_ip_detail*1)
}return(false)
},getCountCustomers:function(){if(!user.sqlrow.customers){return(null)
}var b=0;
for(var a in user.sqlrow.customers){++b
}return(b)
},realTimeChart:function(b){if(!b){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getSensors",params:Ext.encode({withLocal:true})},success:function(p){this.realTimeChart(p.sensors||-1)
},scope:this});
return
}var l={};
l.comb=new IP_account.RealChart({type:"comb_s",sensors:b===-1?null:b,title:b===-1?"local":b[0].name,id_sensor:b===-1?undefined:b[0].id_sensor});
l.all=new IP_account.RealChart({type:"all_s",store:l.comb.store,slave:true,title:b===-1?"local":b[0].name,id_sensor:b===-1?undefined:b[0].id_sensor});
l.voip=new IP_account.RealChart({type:"voip_s",store:l.comb.store,slave:true,title:b===-1?"local":b[0].name,id_sensor:b===-1?undefined:b[0].id_sensor});
l.comb.doStartLoad();
l.comb.addSlave(l.all);
l.comb.addSlave(l.voip);
var g=[{xtype:"panel",layout:"fit",items:l.comb,border:false,flex:1}];
var h=[{xtype:"panel",layout:"fit",items:l.all,border:false,flex:1}];
var c=[{xtype:"panel",layout:"fit",items:l.voip,border:false,flex:1}];
if(b&&b!==-1){for(var k=1;
k<b.length;
k++){var n=new IP_account.RealChart({type:"comb_s",store:l.comb.store,slave:true,title:b[k].name,id_sensor:b[k].id_sensor});
l.comb.addSlave(n);
g.push({xtype:"panel",layout:"fit",items:n,border:false,flex:1});
var d=new IP_account.RealChart({type:"all_s",store:l.comb.store,slave:true,title:b[k].name,id_sensor:b[k].id_sensor});
l.comb.addSlave(d);
h.push({xtype:"panel",layout:"fit",items:d,border:false,flex:1});
var f=new IP_account.RealChart({type:"voip_s",store:l.comb.store,slave:true,title:b[k].name,id_sensor:b[k].id_sensor});
l.comb.addSlave(f);
c.push({xtype:"panel",layout:"fit",items:f,border:false,flex:1})
}}var a=Math.min(1000,Ext.dom.Element.getViewportWidth()-20);
var o=Math.min(b&&b!==-1&&b.length?900:600,Ext.dom.Element.getViewportHeight()-20);
var m=new Ext.Window({title:findLangS("ipaccount","title","chart_realTime"),iconCls:"icon_menu_diag_system",closable:true,maximizable:true,resizable:true,layout:"fit",items:{xtype:"tabpanel",items:[{xtype:"panel",layout:"fit",border:false,items:{layout:{type:"vbox",align:"stretch"},border:false,items:h},title:findLangS("ipaccount","title","chart_realTime_all"),style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}},{xtype:"panel",layout:"fit",border:false,items:{layout:{type:"vbox",align:"stretch"},border:false,items:c},title:findLangS("ipaccount","title","chart_realTime_voip"),style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}},{xtype:"panel",layout:"fit",border:false,items:{layout:{type:"vbox",align:"stretch"},border:false,items:g},title:findLangS("ipaccount","title","chart_realTime_all_voip"),style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}}],border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},border:false,width:a,height:o,listeners:{destroy:function(){l.comb.stopLoad()
}}});
m.show()
}});
Ext.ns("Tracker");
Ext.define("Tracker.Ticket.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Tracker.Ticket.GridX",constructor:function(c){var m={assigned_uid:null,open_only:!window.trackerId};
var b={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:25,style:{background:__color_TabGroupBackgroud,"border-width":0},colspan:3};
var g=[{xtype:"buttongroup",title:this.LrecordOperations,columns:3,border:false,items:[{xtype:"container",height:1,colspan:3},{scope:this,text:findLangSd("grid","newRec")+" "+(c.subjectName||this.LsubjectName),iconCls:"icon_add",handler:function(){this.createEditWindow(1)
}},{disabled:true,scope:this,text:findLangSd("grid","editRec"),iconCls:"icon_edit",handler:function(){this.createEditWindow(0)
},_id:"edit"},{disabled:true,scope:this,text:findLangSd("grid","deleteRec"),handler:this.confirmDeleteRule,iconCls:"icon_remove",_id:"remove"},{xtype:"container",height:9,colspan:3},b,{xtype:"container",height:9,colspan:3}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lfilters,columns:6,border:false,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:2,colspan:6},{value:this.LcreatedNameText+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_Users",value:m.created_uid,width:125,_clearButton:true,_searchField:"created_uid",_gridForm:this,_buttonGroup:true},{value:"&nbsp;"+this.LstatusText+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_trackerStatus",width:125,_clearButton:true,_searchField:"status_id",_gridForm:this,_buttonGroup:true},{value:"&nbsp;"+this.LdateFrom+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateX",_searchField:"created_at_from",_gridForm:this,_buttonGroup:true},{value:this.LassignedText+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_Users",value:m.assigned_uid,width:125,_clearButton:true,_searchField:"assigned_uid",_gridForm:this,_buttonGroup:true},{value:"&nbsp;"+this.LpriorityText+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",aData:arTrackerPriority,width:125,multiSelect:true,_clearButton:true,_arraySeparator:",",_searchField:"priority",_gridForm:this,_buttonGroup:true},{value:"&nbsp;"+this.LdateTo+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateX",_searchField:"created_at_to",_gridForm:this,_buttonGroup:true},{value:this.LopenOnly+":",fieldCls:"x-toolbar-text"},{xtype:"checkbox",checked:m.open_only,listeners:{scope:this,change:function(p,o){this.store.proxy.extraParams.open_only=o;
this.store.loadPage(1)
}},style:{marginTop:0,marginBottom:0}},{value:"&nbsp;"+this.LcategoryText+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_trackerCategory",width:125,_clearButton:true,_searchField:"category_id",_gridForm:this,_buttonGroup:true},{value:"&nbsp;"+this.LquickSearch+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",_gridForm:this,width:125,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}}];
c=Ext.applyIf(c||{},{storeId:"TrackerTicketStore",url:"php/model/sql.php",module:"tracker_ticket",extraParams:m,recordStruct:rsTrackerTicket,sortField:"title",remoteSort:true,columns:[{header:this.LpriorityText,dataIndex:"priority",widthCh:12,renderer:renderArrayData,arrayData:arTrackerPriority,renderer2:d,widthCh:8},{header:this.LcreatedAtText,dataIndex:"created_at",renderer:renderDate,dateFormat:__format_Date,widthNum:8},{header:"ID",dataIndex:"id",widthNum:4,align:"right",renderer:n,filter:{type:"numeric"}},{xtype:"actioncolumn",header:this.LtitleText,dataIndex:"title",widthCh:54,rendererBase:renderString,items:[{getClass:function(o,p,q){return(q.data.alert_descr?"icon_note_alert":"")
},handler:function(p,t,o,q,r){var s=p.store.getAt(t);
this.setAlertOff(s)
},enableHandler:function(o,p,q){return(q.data.alert_descr)
},tooltip:function(o,p,q){return(q.data.alert_descr?q.data.alert_descr.replaceall("\n","<br>"):"")
},scope:this}],enableHandler:function(o,p,q){return(q.data.alert_descr)
},iconDivStyle:"float:right; height:15; width: 15;",baseContentDivStyle:"float: left; padding-right: 16",baseContentFirst:true},{header:this.LstatusText,dataIndex:"status_name",widthCh:12,renderer:d},{header:this.LcategoryText,dataIndex:"category_name",widthCh:12,renderer:d},{header:this.LassignedText,dataIndex:"assigned_name",widthCh:15},{header:this.LcreatedNameText,dataIndex:"created_name",widthCh:15}],fpDefaults:{xtype:"textfield",widthCh:50,labelCh:15},fpItems:function(o){return(Tracker.Utils.getFieldset_ticket(o))
},propRecordText:function(o){return(o.title)
},enableEdit:true,listeners:{scope:this,afterrender:function(){h.call(this,this.selModel);
if(window.trackerId){this.filters.addFilter({dataIndex:"id",type:"numeric",value:{eq:trackerId*1}});
this.expandFindLoadRecord=true;
trackerId=null
}else{this.store.load()
}}},enableAutoLoad:false,subjectName:this.LsubjectName,ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"checkFillCbTracker",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Tracker.Ticket.GridExpPanel",expandOnEnter:false,expandOnDblClick:false},"gridfilters"],prefixCls:"ticket",stripeRows:false,pageSize:30,paginator:b,tbar:g,disableInsertButton:true,disableEditButon:true,disableDeleteButton:true,viewConfigListeners:{bodyscroll:k},contextMenu:function(o,p){if(o.data.ticket_url){return([{text:this.LopenTicketInNewWindow,handler:a,scope:this}])
}}});
this.callParent([c]);
this.selModel.on("selectionchange",h,this);
this.store.on("load",l,this);
function h(o){var p=o.getSelection();
this.ticketsPanel.onSelectionTicket(p&&p.length?p[0].data:null)
}function n(t,q,p,u,s,r,o){return(p.data.ticket_url?"<a href='#' onclick=\"window.open('"+p.data.ticket_url+"');\">"+t+"</a>":t)
}function d(v,p,r,s,y,w,t){var q=t&&t.ownerCt&&t.ownerCt.getHeaderContainer?t.ownerCt.getHeaderContainer().getHeaderAtIndex(y):null;
if(!q){return(v)
}var u=q.dataIndex;
var o=null;
switch(u){case"priority":o="priority_color_";
break;
case"status_name":o="status_color_";
break;
case"category_name":o="category_color_";
break
}if(o){if(r.data[o+"text"]){v=renderStringStyle(v,{color:r.data[o+"text"]})
}if(r.data[o+"background"]){p.style="background-color: "+r.data[o+"background"]
}}return(v)
}function k(){var q=this.store.getCount();
for(var p=0;
p<q;
p++){if(this.isExpandRowIndex(p)){var o=this.store.getAt(p);
if(o&&o.expanderBodyContent&&o.expanderBodyContent.onScroll){o.expanderBodyContent.onScroll(this,o)
}}}}function f(p){var o=this.getSeachFieldX();
if(o){o.setValue("_id:"+p);
o.onSearch();
this.expandFindLoadRecord=true
}}function l(p,o){if(this.expandFindLoadRecord){if(p.getCount()==1){this.expandRowIndex(0)
}this.expandFindLoadRecord=false
}}function a(o){window.open(o._record.data.ticket_url)
}},getDefaultValues:function(a){return({status_id:a&&a.rslt&&a.rslt.default_status*1,category_id:a&&a.rslt&&a.rslt.default_category*1,priority:a&&a.rslt&&a.rslt.default_priority*1||3,assigned_uid:user_id()})
},isEnableEditRecord:function(a){return(user_is_admin()||user_id()===a.data.created_uid||user_id()===a.data.assigned_uid)
},isEnableDeleteRecord:function(a){return(user_is_admin()||user_id()===a.data.created_uid)
},setAlertOff:function(a,b){if(!b){if(user_is_admin()||user_id()===a.data.assigned_uid){Ext.Msg.confirm(this.LsetAlertOffConfirmHeader,this.LsetAlertOffConfirmText,function(c){if(c=="yes"){this.setAlertOff(a,true)
}},this)
}return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setTicketAlertOff",params:Ext.encode({id:a.data.id})},success:function(c){this.updateRecord(a,false,["title"]);
this.reloadExpanderBodyContent(a)
}})
}});
Ext.override(Tracker.Ticket.Grid,{LcreatedNameText:"created by",LcreatedAtText:"created at",LchangedNameText:"changed by",LchangedAtText:"changed at",LtitleText:"title",LdescriptionText:"description",LstatusText:"status",LcategoryText:"category",LpriorityText:"priority",LassignedText:"assigned to",LdeadlineText:"deadline",LsubjectName:"ticket",LrecordOperations:null,Lfilters:null,LquickSearch:"quick search",LdateFrom:"from",LdateTo:"to",LopenOnly:"open only",LsetAlertOffConfirmHeader:"set alert off",LsetAlertOffConfirmText:"Really?",LopenTicketInNewWindow:"open ticket in new window"});
Ext.define("Tracker.Ticket.GridExpPanel",{extend:"Ext.Panel",constructor:function(b){this.comments=new Tracker.Ticket.Comment.Grid({title:this.Lcomments,relFields:{ticket_id:b.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},decWidthColumn:2,onChangeRecords:function(){this.parentGrid.updateRecord(this.parentRecord,false,["title"])
},parentGrid:b.grid,parentRecord:b.record,expPanel:this});
this.attachedCDR=new CDR.Grid({title:this.LrelatedCDR,layout:"fit",disableCharts:true,disableMenu:true,disablePagingToolbar:true,loadAtInit:true,border:false,ticket_id:b.record.data.id,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},noVerticalScroller:true});
this.attachedCDR.grid.store.on("load",a,this);
this.tabPanel=new Ext.TabPanel({items:this.comments,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"ticket-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
this.headPanel=new Ext.Panel({border:false,html:this.getHeadHtml(b.record),style:{padding:"2 4 2 4"}});
this.headPanelContainer=new Ext.Panel({title:b.record.data.title,items:[this.headPanel],style:{paddingTop:3,paddingBottom:3},cls:"ticket-cell expander-area-panel"});
Ext.apply(b,{items:[this.headPanelContainer,this.tabPanel],border:false});
this.callParent([b]);
function a(c){if(c.getCount()){if(!this.tabPanel.getComponent(this.attachedCDR)){this.tabPanel.add(this.attachedCDR)
}}else{this.tabPanel.remove(this.attachedCDR)
}}},getHeadHtml:function(b){var g='<td style="vertical-align: top; text-align: left; padding: 2px; font-style:italic;">';
var a='<td style="vertical-align: top; padding: 2px;">';
var f=[];
f.push([this.Ldescription,b.dataHtml.description.replaceall("\n","<br>")],[this.Lassigned,b.dataHtml.assigned_name],[this.Lpriority,getDataArrayItem(arTrackerPriority,b.dataHtml.priority)],[this.Lcategory,b.dataHtml.category_name],[this.Lstatus,b.dataHtml.status_name],[this.LcreatedAt,Ext.Date.format(b.dataHtml.created_at,__format_DateTime)]);
var d='<table border="0" style="font: '+__font_Grid+'; color: black; table-layout: fix; width: 100%;"><col width="125px">';
for(var c=0;
c<f.length;
c++){if(f[c][1]){d+="<tr>"+g+f[c][0]+":</td>"+a+f[c][1]+"</td></tr>"
}}d+="</table>";
return(d)
},update:function(a){this.headPanel.body.setHtml(this.getHeadHtml(a));
this.updateLayout();
this.comments.reload()
},reload:function(){this.comments.reload();
this.attachedCDR.reload()
},onScroll:function(b,a){this.comments.onScroll(b,a,this)
}});
Ext.override(Tracker.Ticket.GridExpPanel,{Lcomments:"comments",LrelatedCDR:"related CDR",Ltitle:"title",Ldescription:"description",Lpriority:"priority",Lcategory:"category",Lstatus:"status",Lassigned:"assigned to",LcreatedAt:"created at"});
Ext.define("Tracker.Ticket.Comment.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Tracker.Ticket.Comment.GridX",constructor:function(f){var b=[{scope:this,text:this.LnewButtonText,iconCls:"icon_add",handler:function(){this.createEditWindow(1)
}}];
f=Ext.applyIf(f||{},{storeId:"TrackerTicketCommentStore",url:"php/model/sql.php",module:"tracker_ticket_comment",recordStruct:rsTrackerTicketComment,sortField:"created_at",remoteSort:true,columns:[{header:this.LcommentsText,dataIndex:"description",widthCh:100,renderer:h}],fpDefaults:{xtype:"textfield",widthCh:50,labelCh:15},fpItems:function(o,n){var m=[{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp,allowBlank:false,blankText:lang.requirefield,heightL:10},{xtype:"textarea",fieldLabel:this.LalertDescrText,name:"alert_descr",helpText:this.LalertDescrHelp},{xtype:"checkbox",fieldLabel:this.LalertOffText,name:"alert_off",helpText:this.LalertOffHelp}];
if(n){m.push({xtype:"filefield",name:"file",fieldLabel:this.LfileText,buttonText:this.LfileButtonText})
}return(m)
},propRecordText:function(m){return(m.title||m.description.substr(0,20))
},enableEdit:true,enableSearchX:true,listeners:{scope:this,resize:c,afterrender:k},subjectName:this.LsubjectName,hideHeaders:true,stripeRows:false,fileField:"attachment",bbar:b});
this.callParent([f]);
this.store.on("load_before_renders",d,this);
function c(){var m=this.getWidth();
if(m){this.columns[0].setWidth(m-(this.border?2:0)-(this.decWidthColumn||0))
}}function k(){this.setVisibleToolbars()
}function d(n,m){for(var p=0;
p<m.length;
p++){if(m[p].data.type!="change_log"){continue
}var q=[];
q.push({change_field:m[p].data.change_field,new_value:m[p].data.new_value,old_value:m[p].data.old_value});
if(m.length>=p){for(var o=p+1;
o<m.length;
o++){if(m[o].data.type==m[p].data.type&&m[o].data.created_uid==m[p].data.created_uid&&m[o].data.created_at.getTime()==m[p].data.created_at.getTime()){q.push({change_field:m[o].data.change_field,new_value:m[o].data.new_value,old_value:m[o].data.old_value});
delete m[o];
m.splice(o,1);
--o
}else{break
}}}m[p].data.changes=q
}}function h(r,o,n,t,q,p,m){var s="";
if(n.data.created_name){s+="<div>from: <b>"+n.data.created_name+"</b></div>"
}if(n.data.created_at){s+='<div style="font-size: 80%;"><i><b>'+Ext.Date.format(n.data.created_at,__format_DateTime)+"</b></i></div>"
}comment=n.data.type=="change_log"?g.call(this,r,o,n,t,q,p,m):l.call(this,r,o,n,t,q,p,m);
return('<div style="float:left; width: 120; padding-right: 10;">'+s+'</div><div style="padding-left: 125;">'+comment+"</div>")
}function l(u,n,q,s,w,v,t){var r="";
if(q.data.attachment_name&&q.data.attachment_th_size&&t){var m=t.ownerCt;
r+='<a href="#" gridid="'+m.id+'" recordid="'+q.data.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).openAttachment(this.attributes.recordid.nodeValue);"><img src="'+getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"tracker_ticket_comment",id:q.data.id,thumbnail:true})+'" align="right" hspace="5" vspace="5" gridid="'+m.id+'" onload="Ext.getCmp(this.attributes.gridid.nodeValue).updateLayout();"></a>'
}if(q.data.title){r+='<div style="white-space: normal; font-weight: bold;">'+q.data.title+"</div>"
}if(q.data.description){r+='<div style="white-space: normal;">'+q.data.description.replaceall("\n","<br>")+"</div>"
}if(q.data.alert_descr){var o=q.data.alert_off?"grey":"red";
r+='<div style="white-space: normal; color: '+o+';">'+q.data.alert_descr+"</div>"
}if(q.data.attachment_name){r+="<div>"+this.LfileText+":&nbsp;<b>"+getLinkUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"tracker_ticket_comment",id:q.data.id},false)+q.data.attachment_name+"</a></b></div>"
}if(q.data.changed_name||q.data.chenged_at){var p=(q.data.changed_name||"")+(q.data.changed_at?(q.data.changed_name?" - ":"")+Ext.Date.format(q.data.changed_at,__format_DateTime):"");
if(p){r+='<div style="font-size: 80%; text-align: right;"><i>'+this.LlastModifiedBy+": <b>"+p+"</b></i></div>"
}}return(r)
}function g(s,m,o,q,u,t,r){var p="<div>"+this.LchangeLog+'<div><table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style="font: '+__font_Grid+'; table-layout: fix; width: 100%; margin-top: 3px;"><col width="10%"><col width="45%"><col width="45%"><tr><th>'+this.LchangeLogField+"</th><th>"+this.LchangeLogNewValue+"</th><th>"+this.LchangeLogOldValue+"</th></tr>";
for(var n=0;
n<o.data.changes.length;
n++){p+='<tr><td style="vertical-align: top;">'+o.data.changes[n].change_field+'</td><td style="vertical-align: top;">'+htmlEncode(o.data.changes[n].new_value)+'</td><td style="vertical-align: top;">'+htmlEncode(o.data.changes[n].old_value)+"</td></tr>"
}p+="</table>";
return(p)
}function a(r,o,n,s,q,p,m){return(renderStringStyle(r,{color:n.data.alert_off?"grey":undefined}))
}},isEnableEditRecord:function(a){return(a.data.type=="comment"&&(user_is_admin()||user_id()===a.data.created_uid))
},isEnableDeleteRecord:function(a){return(a.data.type=="comment"&&(user_is_admin()||user_id()===a.data.created_uid))
},openAttachment:function(b){var a=this.store.getById(b*1);
if(!a){return
}openAttachment(a,"tracker_ticket_comment")
},onScroll:function(c,b,a){this.setVisibleToolbars(c,b,a)
},setVisibleToolbars:function(a,c,g){a=a||this.parentGrid;
c=c||this.parentRecord;
g=g||this.expPanel;
var l=a.getView().getEl().dom.scrollTop;
var h=a.getView().getEl().dom.clientHeight;
var d=this.getTopToolbar();
var k=this.getBottomToolbar();
var b=getAbsolutePosition(d.getEl().dom,a.getView().id);
var f=getAbsolutePosition(k.getEl().dom,a.getView().id);
visibleTopToolbar=b[1]+10>l&&b[1]+10<l+h;
visibleBottomToolbar=f[1]+10>l&&f[1]+10<l+h;
showBottomToolbar=!!(!visibleTopToolbar&&this.store.getCount());
if(k.isVisible()!=showBottomToolbar){k.setVisible(showBottomToolbar);
k.getEl().setStyle({"border-right-style":"none","border-bottom-style":"none","border-left-style":"none"});
k.getEl().dom.style.setProperty("border-top","1px solid "+__color_PanelBorder,"!important");
this.updateLayout()
}}});
Ext.override(Tracker.Ticket.Comment.Grid,{LtitleText:"title",LtitleHelp:"",LcommentsText:"commments",LdescriptionText:"comment",LdescriptionHelp:"",LalertDescrText:"highlight comment",LalertDescrHelp:"",LalertOffText:"suppress highlight comment",LalertOffHelp:"",LfileText:"attached file",LfileButtonText:"Select File...",LsubjectName:"comment",LlastModifiedBy:"last modified by",LchangeLog:"change log",LchangeLogField:"field",LchangeLogNewValue:"new value",LchangeLogOldValue:"old value",LnewButtonText:"New comment"});
Ext.define("Tracker.Ticket.Panel",{extend:"Ext.Panel",alias:"widget.Tracker_ticketsPanelX",constructor:function(a){this.tickets=new Tracker.Ticket.Grid({layout:"fit",border:false,ticketsPanel:this});
a=Ext.applyIf(a||{},{id:"Tracker_tickets-panel",iconCls:"icon_tracker",title:this.titleText,layout:"fit",items:this.tickets,wikiId:"Issue_tracker"});
this.callParent([a])
},onSelectionTicket:function(a){if(a){this.setTitle(this.titleTextTicket+a.title)
}else{this.setTitle(this.titleText)
}},reactivate:function(){this.tickets.store.load()
}});
Ext.override(Tracker.Ticket.Panel,{titleText:"Tracker - Tickets",titleTextTicket:"Tracker - Ticket : "});
Ext.define("Tracker.Status.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Tracker.Status.GridX",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"TrackerStatusStore",url:"php/model/sql.php",module:"tracker_status",recordStruct:rsTrackerStatus,sortField:"status",remoteSort:true,columns:[{header:this.LstatusText,dataIndex:"status",widthCh:30},{header:this.LstatusTypeText,dataIndex:"status_type",widthCh:15,renderer:renderArrayData,arrayData:arTrackerStatusType,renderer2:a},{header:this.LdefaultText,dataIndex:"default_select",widthCh:8,renderer:renderCheckBox},{header:this.LdescriptionText,dataIndex:"description",widthCh:60}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:15},fpItems:[{fieldLabel:this.LstatusText,name:"status",helpText:this.LstatusHelp,allowBlank:false,blankText:lang.requirefield},{xtype:"ComboBoxA",fieldLabel:this.LstatusTypeText,helpText:this.LstatusTypeHelp,name:"status_type",aData:arTrackerStatusType,widthCh:15,allowBlank:false},{xtype:"colorpickerfield",fieldLabel:this.LtextColorText,name:"color_text",helpText:this.LtextColorHelp,widthCh:11,selectTextBtn:this.LselectColorText},{xtype:"colorpickerfield",fieldLabel:this.LbackgroundColorText,name:"color_background",helpText:this.LbackgroundColorHelp,widthCh:11,selectTextBtn:this.LselectBackgroundText,_background:true},{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp},{xtype:"checkbox",fieldLabel:this.LdefaultText,name:"default_select",helpText:this.LdefaultHelp}],propRecordText:function(d){return(d.status)
},enableEdit:true,enableSearchX:true,getRowClass:c,_title:Tracker.Status.Panel.prototype.titleText,subjectName:this.LsubjectName,stripeRows:false});
this.callParent([b]);
function a(l,g,f,m,k,h,d){l=renderStringStyle(l,{color:f.data.color_text||"black"});
return(l)
}function c(d,h,g,f){if(d.data.color_background){return(addBackgroundColorRuleToStyleSheet(d.data.color_background,"x-grid-cell"))
}}},setContextItems:function(a,d,f,h,g,c,b){if(f=="loadrecord"||f=="select"&&["color_text","color_background"].isIn(h.name)){this.setColors()
}},setColors:function(){var c=this.getField("color_text");
var b=this.getField("color_background");
if(c&&b){var d=c.getValue()||"#000000";
var a=b.getValue()||"#FFFFFF";
if(c.inputEl){c.inputEl.setStyle({background:a})
}if(b.inputEl){b.inputEl.setStyle({color:d})
}}}});
Ext.override(Tracker.Status.Grid,{LstatusText:"status",LstatusHelp:"",LstatusTypeText:"type",LstatusTypeHelp:"",LdescriptionText:"description",LdescriptionHelp:"",LtextColorText:"text color",LtextColorHelp:"",LbackgroundColorText:"background color",LbackgroundColorHelp:"",LselectColorText:"select color",LselectBackgroundText:"select background",LsubjectName:"status",LdefaultText:"default",LdefaultHelp:""});
Ext.define("Tracker.Category.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Tracker.Category.GridX",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"TrackerCategoryStore",url:"php/model/sql.php",module:"tracker_category",recordStruct:rsTrackerCategory,sortField:"category",remoteSort:true,columnsDefaults:{renderer:a},columns:[{header:this.LcategoryText,dataIndex:"category",widthCh:30},{header:this.LdefaultText,dataIndex:"default_select",widthCh:8,renderer:renderCheckBox},{header:this.LdescriptionText,dataIndex:"description",widthCh:60}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:15},fpItems:[{fieldLabel:this.LcategoryText,name:"category",helpText:this.LcategoryHelp,allowBlank:false,blankText:lang.requirefield},{xtype:"colorpickerfield",fieldLabel:this.LtextColorText,name:"color_text",helpText:this.LtextColorHelp,widthCh:11,selectTextBtn:this.LselectColorText},{xtype:"colorpickerfield",fieldLabel:this.LbackgroundColorText,name:"color_background",helpText:this.LbackgroundColorHelp,widthCh:11,selectTextBtn:this.LselectBackgroundText,_background:true},{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp},{xtype:"checkbox",fieldLabel:this.LdefaultText,name:"default_select",helpText:this.LdefaultHelp}],propRecordText:function(f){return(f.category)
},enableEdit:true,enableSearchX:true,getRowClass:d,_title:Tracker.Category.Panel.prototype.titleText,listeners:{scope:this,afterrender:function(){c.call(this,this.selModel)
}},subjectName:this.LsubjectName,stripeRows:false});
this.callParent([b]);
this.selModel.on("selectionchange",c,this);
function c(f){var g=f.getSelection();
if(this.categoryPanel){this.categoryPanel.onSelectionCategory(g&&g.length?g[0].data:null)
}}function a(m,h,g,n,l,k,f){m=renderStringStyle(m,{color:g.data.color_text||"black"});
return(m)
}function d(f,k,h,g){if(f.data.color_background){return(addBackgroundColorRuleToStyleSheet(f.data.color_background,"x-grid-cell"))
}}},setContextItems:function(a,d,f,h,g,c,b){if(f=="loadrecord"||f=="select"&&["color_text","color_background"].isIn(h.name)){this.setColors()
}},setColors:function(){var c=this.getField("color_text");
var b=this.getField("color_background");
if(c&&b){var d=c.getValue()||"#000000";
var a=b.getValue()||"#FFFFFF";
if(c.inputEl){c.inputEl.setStyle({background:a})
}if(b.inputEl){b.inputEl.setStyle({color:d})
}}}});
Ext.override(Tracker.Category.Grid,{LcategoryText:"category",LcategoryHelp:"",LdescriptionText:"description",LdescriptionHelp:"",LtextColorText:"text color",LtextColorHelp:"",LbackgroundColorText:"background color",LbackgroundColorHelp:"",LselectColorText:"select color",LselectBackgroundText:"select background",LsubjectName:"category",LdefaultText:"default",LdefaultHelp:""});
Ext.define("Tracker.Category.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.users=new Tracker.Category.User.Grid({title:this.Lusers,relFields:{category_id:a.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel=new Ext.TabPanel({items:this.users,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"category-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.override(Tracker.Category.GridExpPanel,{Lusers:"users"});
Ext.define("Tracker.Category.User.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Tracker.category.Users.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"TrackerCategoryUserStore",url:"php/model/sql.php",module:"tracker_category_user",recordStruct:rsTrackerCategoryUser,sortField:"user_name",remoteSort:true,columns:[{header:this.LuserText,dataIndex:"user_name",widthCh:30},{header:this.L_auth_write_ticket_col,dataIndex:"auth_write_ticket",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_delete_ticket_col,dataIndex:"auth_delete_ticket",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_new_comment_col,dataIndex:"auth_new_comment",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_write_comment_col,dataIndex:"auth_write_comment",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_delete_comment_col,dataIndex:"auth_delete_comment",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_new_attachment_col,dataIndex:"auth_new_attachment",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_write_attachment_col,dataIndex:"auth_write_attachment",widthCh:6,renderer:renderCheckBox},{header:this.L_auth_delete_attachment_col,dataIndex:"auth_delete_attachment",widthCh:6,renderer:renderCheckBox}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:25},fpItems:[{xtype:"CBX_Users",fieldLabel:this.LuserText,name:"user_uid",helpText:this.LuserHelp,widthCh:25},{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp},{xtype:"checkbox",fieldLabel:this.L_auth_write_ticket_text,name:"auth_write_ticket",helpText:this.L_auth_write_ticket_help},{xtype:"checkbox",fieldLabel:this.L_auth_delete_ticket_text,name:"auth_delete_ticket",helpText:this.L_auth_delete_ticket_help},{xtype:"checkbox",fieldLabel:this.L_auth_new_comment_text,name:"auth_new_comment",helpText:this.L_auth_new_comment_help},{xtype:"checkbox",fieldLabel:this.L_auth_write_comment_text,name:"auth_write_comment",helpText:this.L_auth_write_comment_help},{xtype:"checkbox",fieldLabel:this.L_auth_delete_comment_text,name:"auth_delete_comment",helpText:this.L_auth_delete_comment_help},{xtype:"checkbox",fieldLabel:this.L_auth_new_attachment_text,name:"auth_new_attachment",helpText:this.L_auth_new_attachment_help},{xtype:"checkbox",fieldLabel:this.L_auth_write_attachment_text,name:"auth_write_attachment",helpText:this.L_auth_write_attachment_help},{xtype:"checkbox",fieldLabel:this.L_auth_delete_attachment_text,name:"auth_delete_attachment",helpText:this.L_auth_delete_attachment_help}],propRecordText:function(b){return(b.user_name)
},enableEdit:true,enableSearchX:true,subjectName:this.LsubjectName,tbar:[{xtype:"displayfield",value:this.Lusers,fieldCls:"x-panel-header-text x-panel-header-text-default",style:{marginLeft:3,marginRight:20,top:"2px !important"}}],stripeRows:false});
this.callParent([a])
}});
Ext.override(Tracker.Category.User.Grid,{Lusers:"users",LuserText:"user",LuserHelp:"",LdescriptionText:"description",LdescriptionHelp:"",L_auth_write_ticket_text:"enable update ticket",L_auth_delete_ticket_text:"enable delete ticket",L_auth_new_comment_text:"enable new comment",L_auth_write_comment_text:"enable update comment",L_auth_delete_comment_text:"enable delete comment",L_auth_new_attachment_text:"enable new attachment",L_auth_write_attachment_text:"enable update attachment",L_auth_delete_attachment_text:"enable delete attachment",L_auth_write_ticket_help:"",L_auth_delete_ticket_help:"",L_auth_new_comment_help:"",L_auth_write_comment_help:"",L_auth_delete_comment_help:"",L_auth_new_attachment_help:"",L_auth_write_attachment_help:"",L_auth_delete_attachment_help:"",L_auth_write_ticket_col:"T upd.",L_auth_delete_ticket_col:"T del.",L_auth_new_comment_col:"C new",L_auth_write_comment_col:"C upd.",L_auth_delete_comment_col:"C del.",L_auth_new_attachment_col:"A new",L_auth_write_attachment_col:"A upd.",L_auth_delete_attachment_col:"A del.",LsubjectName:"user"});
Ext.define("Tracker.Priority.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Tracker.Priority.GridX",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"TrackerPriorityStore",url:"php/model/sql.php",module:"tracker_priority",recordStruct:rsTrackerPriority,sortField:"priority",remoteSort:true,columnsDefaults:{renderer:a},columns:[{header:this.LpriorityText,dataIndex:"priority",widthCh:12,renderer:renderArrayData,arrayData:arTrackerPriority,renderer2:a},{header:this.LdefaultText,dataIndex:"default_select",widthCh:8,renderer:renderCheckBox},{header:this.LdescriptionText,dataIndex:"description",widthCh:60}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:15},fpItems:[{xtype:"ComboBoxA",fieldLabel:this.LpriorityText,helpText:this.LpriorityHelp,name:"priority",aData:arTrackerPriority,widthCh:15,allowBlank:false},{xtype:"colorpickerfield",fieldLabel:this.LtextColorText,name:"color_text",helpText:this.LtextColorHelp,widthCh:11,selectTextBtn:this.LselectColorText},{xtype:"colorpickerfield",fieldLabel:this.LbackgroundColorText,name:"color_background",helpText:this.LbackgroundColorHelp,widthCh:11,selectTextBtn:this.LselectBackgroundText,_background:true},{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp},{xtype:"checkbox",fieldLabel:this.LdefaultText,name:"default_select",helpText:this.LdefaultHelp}],propRecordText:function(d){return(getDataArrayItem(arTrackerPriority,d.priority))
},enableEdit:true,enableSearchX:true,getRowClass:c,subjectName:this.LsubjectName,stripeRows:false,disableInsertButton:true,disableDeleteButton:true,disableDeleteMenuItem:true});
this.callParent([b]);
function a(l,g,f,m,k,h,d){l=renderStringStyle(l,{color:f.data.color_text||"black"});
return(l)
}function c(d,h,g,f){if(d.data.color_background){return(addBackgroundColorRuleToStyleSheet(d.data.color_background,"x-grid-cell"))
}}},setContextItems:function(a,d,f,h,g,c,b){if(f=="loadrecord"||f=="select"&&["color_text","color_background"].isIn(h.name)){this.setColors()
}},setColors:function(){var c=this.getField("color_text");
var b=this.getField("color_background");
if(c&&b){var d=c.getValue()||"#000000";
var a=b.getValue()||"#FFFFFF";
if(c.inputEl){c.inputEl.setStyle({background:a})
}if(b.inputEl){b.inputEl.setStyle({color:d})
}}}});
Ext.override(Tracker.Priority.Grid,{LpriorityText:"priority",LpriorityHelp:"",LdescriptionText:"description",LdescriptionHelp:"",LtextColorText:"text color",LtextColorHelp:"",LbackgroundColorText:"background color",LbackgroundColorHelp:"",LselectColorText:"select color",LselectBackgroundText:"select background",LsubjectName:"priority",LdefaultText:"default",LdefaultHelp:""});
Ext.define("Tracker.Status.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Tracker_statusPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"Tracker_status-panel",gridXType:"Tracker.Status.GridX",wikiId:"Issue_tracker#Statuses"});
this.callParent([a])
}});
Ext.override(Tracker.Status.Panel,{titleText:"Tracker - Statuses"});
Ext.define("Tracker.Category.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Tracker_categoryPanelX",constructor:function(a){this.category=new Tracker.Category.Grid({layout:"fit",header:false,categoryPanel:this});
a=Ext.applyIf(a||{},{id:"Tracker_category-panel",title:this.titleText,layout:"fit",items:this.category,wikiId:"Issue_tracker#Categories"});
this.callParent([a])
},onSelectionCategory:function(a){if(a){this.setTitle(this.titleTextCategory+a.category)
}else{this.setTitle(this.titleText)
}}});
Ext.override(Tracker.Category.Panel,{titleText:"Tracker - Categories",titleTextCategory:"Tracker - Category : ",LtitleUsers:"users"});
Ext.define("Tracker.Priority.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Tracker_priorityPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"Tracker_priority-panel",gridXType:"Tracker.Priority.GridX",wikiId:"Issue_tracker#Priority_colors"});
this.callParent([a])
}});
Ext.override(Tracker.Priority.Panel,{titleText:"Tracker - Priority Colors"});
Ext.define("Tracker.Setting.Panel",{extend:"Ext.Panel",alias:"widget.Tracker_settingPanelX",constructor:function(d){var b={xtype:"textfield",widthCh:50,labelCh:15};
var f={"background-color":"lightgrey",paddingLeft:5,paddingBottom:3,border:"1px solid grey"};
var g={width:__width_FieldChar(80+b.labelCh+2),paddingLeft:__width_FieldChar(b.labelCh+1),paddingTop:0,paddingBottom:2,"background-color":"#E0E0E0"};
var a=[{xtype:"displayfield",value:this.LmailerCfg,width:"100%",fieldStyle:f},{xtype:"textfield",name:"mailing_email_from",fieldLabel:this.LemailFromText,helpText:this.LemailFromHelp},{xtype:"checkbox",name:"mailing_send_ticket_url",fieldLabel:this.LsendTicketUrlText,helpText:this.LsendTicketUrlText},{xtype:"displayfield",value:this.LtemplateInsertTicket,_widthCh:150,fieldStyle:g},{xtype:"textarea",name:"mailing_templ_insert_ticket_subject",fieldLabel:this.LtemplateSubject,widthCh:80,heightL:2,style:{marginBottom:2}},{xtype:"textarea",name:"mailing_templ_insert_ticket",fieldLabel:this.LtemplateContent,widthCh:80,heightL:12},{xtype:"displayfield",value:this.LtemplateUpdateTicket,fieldStyle:g},{xtype:"textarea",name:"mailing_templ_update_ticket_subject",fieldLabel:this.LtemplateSubject,widthCh:80,heightL:2,style:{marginBottom:2}},{xtype:"textarea",name:"mailing_templ_update_ticket",fieldLabel:this.LtemplateContent,widthCh:80,heightL:12},{xtype:"displayfield",value:this.LtemplateInsertComment,_widthCh:150,fieldStyle:g},{xtype:"textarea",name:"mailing_templ_insert_comment_subject",fieldLabel:this.LtemplateSubject,widthCh:80,heightL:2,style:{marginBottom:2}},{xtype:"textarea",name:"mailing_templ_insert_comment",fieldLabel:this.LtemplateContent,widthCh:80,heightL:12}];
completeDefaultsFormFields(b);
completeFormFields(a,true,b);
this.formPanel=new Ext.form.Panel({border:false,defaults:b,items:a,buttons:{items:[{text:this.LapplyButton,iconCls:"icon_save",handler:this.saveData,scope:this},{text:lang.restoreDefault,iconCls:"icon_restore_default",handler:function(){Ext.Msg.confirm(lang.restoreDefaultConfirmHeader,lang.restoreDefaultConfirmText,function(h){if(h=="yes"){this.loadData(true)
}},this)
},scope:this}],style:{"background-color":__color_PanelBorder,padding:10,marginTop:1}},buttonAlign:"center",bodyStyle:__style_FormBackground({padding:5}),autoScroll:true});
d=Ext.applyIf(d||{},{title:this.LtitleText,id:"Tracker_setting-panel",layout:"fit",items:this.formPanel,listeners:{scope:this,afterrender:c}});
this.callParent([d]);
function c(){this.loadData()
}},loadData:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"loadSetting",params:Ext.encode({type:"tracker",restoreDefault:a||null})},success:function(b){for(var c in b.data){var d=this.formPanel.getForm().findField(c);
if(d){d.setValue(b.data[c])
}}}})
},saveData:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveSetting",params:Ext.encode({type:"tracker",data:this.formPanel.getForm().getFieldValues(),fieldPrefix:"mailing"})}})
}});
Ext.override(Tracker.Setting.Panel,{LtitleText:"Tracker - Setting - Email templates",LmailerCfg:"MAILER CONFIGURATION",LemailFromText:"email from",LemailFromHelp:"",LsendTicketUrlText:"send ticket url",LsendTicketUrlHelp:"",LtemplateInsertTicket:"template - new ticket",LtemplateUpdateTicket:"template - update ticket",LtemplateInsertComment:"template - new comment",LtemplateSubject:"subject",LtemplateContent:"content",LapplyButton:"apply"});
Ext.define("Tracker.Utils",{singleton:true,getFieldset_ticket:function(b){var a=[{fieldLabel:this.LtitleText,name:"title",helpText:this.LtitleHelp,allowBlank:false,blankText:lang.requirefield},{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp,allowBlank:false,blankText:lang.requirefield,heightL:10}];
if(user_is_admin()||b&&b.rslt&&b.rslt.fill_status){a.push({xtype:"CBX_trackerStatus",fieldLabel:this.LstatusText,name:"status_id",helpText:this.LstatusHelp,widthCh:25,_editTableButton:user_is_admin(),_clearButton:true})
}if(user_is_admin()||b&&b.rslt&&b.rslt.fill_category){a.push({xtype:"CBX_trackerCategory",fieldLabel:this.LcategoryText,name:"category_id",helpText:this.LcategoryHelp,widthCh:25,_editTableButton:user_is_admin(),_clearButton:true})
}a.push({xtype:"ComboBoxA",fieldLabel:this.LpriorityText,helpText:this.LpriorityHelp,name:"priority",aData:arTrackerPriority,widthCh:15,allowBlank:false},{xtype:"CBX_Users",fieldLabel:this.LassignedText,name:"assigned_uid",helpText:this.LassignedHelp,widthCh:25});
return(a)
},createNewTicketFormWindow:function(h,g,b){var a=Tracker.Utils.getFieldset_ticket(h);
var f={xtype:"textfield",widthCh:50,labelCh:15};
completeDefaultsFormFields(f);
completeFormFields(a,true,f);
var c=new Ext.FormPanel({frame:true,border:false,autoHeight:true,labelAlign:"right",waitMsgTarget:true,defaults:f,items:a,buttons:[{text:lang.saveButtonText,iconCls:"icon_save",handler:function(){if(c.getForm().isValid()){Tracker.Utils.createNewTicket(c,getFormFieldValues(c,rsTrackerTicket),g,b)
}},scope:b},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){c.destroyWindow()
}}],listeners:{afterrender:function(k){var l=k.getForm();
l.findField("status_id").setValue(h&&h.rslt&&h.rslt.default_status*1);
l.findField("category_id").setValue(h&&h.rslt&&h.rslt.default_category*1);
l.findField("priority").setValue(h&&h.rslt&&h.rslt.default_priority*1||3);
l.findField("assigned_uid").setValue(user_id())
}}});
var d=new Ext.Window({iconCls:"icon_add",title:this.LnewTrackerTicket,autoHeight:true,border:false,layout:"fit",modal:true,items:c});
d.show()
},createNewTicket:function(g,a,h,f){var d=[];
if(h&&h.attachedCDR&&h.attachedCDR.type=="new_ticket_selected"){var c=h.attachedCDR.grid.selModel.getSelection();
for(var b=0;
b<c.length;
b++){d.push(c[b].data.ID)
}}ajaxSafeRequest({scope:f,url:"php/model/sql.php",params:{task:"CREATE",module:"tracker_ticket",taskParams:Ext.encode({data:a,selectCdr:h.attachedCDR?{type:h.attachedCDR.type,selected:d,filter:h.attachedCDR.grid.store.proxy.extraParams}:undefined,chart:h.chart?{svg:h.chart.svg}:undefined})},success:function(k){g.destroyWindow()
},maskEl:g.ownerCt})
}});
Ext.override(Tracker.Utils,{LtitleText:"title",LtitleHelp:"",LdescriptionText:"description",LdescriptionHelp:"",LstatusText:"status",LstatusHelp:"",LcategoryText:"category",LcategoryHelp:"",LpriorityText:"priority",LpriorityHelp:"",LassignedText:"assigned to",LassignedHelp:"",LdeadlineText:"deadline",LdeadlineHelp:"",LnewTrackerTicket:"create new ticket"});
Ext.ns("GridReports");
Ext.define("GridReports.CallSummary.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.GridReports.CallSummary.GridX",constructor:function(f){var l=date();
var h="11s";
var b={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud,"border-width":0}};
var k=[{xtype:"buttongroup",title:this.LbySourceDestIp,columns:1,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{xtype:"ComboBoxA",name:"group_by",aData:[["11s",this.LbySourceSipIp],["11d",this.LbyDestinationSipIp],["a_saddr",this.LbySourceRtpIp],["b_saddr",this.LbyDestinationRtpIp]],editable:false,value:h,_buttonGroup:true,listeners:{scope:this,select:m},style:{marginBottom:"0px !important"}},{xtype:"container",height:23}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.LdateRange,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LdateFrom+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:l,_searchField:"fdatefrom",_gridForm:this,_buttonGroup:true},{value:this.LdateTo+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",_searchField:"fdateto",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lnumbers,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LnumberSrc+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fcaller",_gridForm:this,_buttonGroup:true},{value:this.LnumberDst+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fcalled",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lpaginator,items:b,style:{background:__color_TabGroupBackgroud,"border-width":0}}];
f=Ext.applyIf(f||{},{storeId:"GridReports.CallSummary",url:"php/model/sql.php",module:"CDR_stats",recordStruct:rsCDR_stats,sortField:"cnt_all",sortDirection:"desc",remoteSort:true,extraParams:{group_by:"11s",fdatefrom:l,fcallerd_type:1,grid_report:true},columns:o.call(this,h),pageSize:50,tbar:k,paginator:b,enableExportCsv:true,withoutSeparatorCsv:true});
this.callParent([f]);
function q(v,r,s,w,u,t){return(s.data.sip_ip+(s.data.sip_hostname?("<br><i>"+s.data.sip_hostname+"</i>"):""))
}function d(v,r,s,w,u,t){return(s.data.rtp_ip+(s.data.rtp_hostname?("<br><i>"+s.data.rtp_hostname+"</i>"):""))
}function a(v,r,s,w,u,t){return(formatNumber(s.data.asr_all,0)+"%")
}function n(v,r,s,w,u,t){return(formatNumber(s.data.ner_all,0)+"%")
}function g(v,r,s,w,u,t){return(formatNumber(s.data.acd_all,0)+"s")
}function c(v,r,s,w,u,t){return(formatNumber(s.data.pdd_all,0)+"s")
}function p(v,r,s,w,u,t){return(v?String(parseInt(v/3600)).lpad(2,"0")+":"+String(parseInt(v%3600/60)).lpad(2,"0")+":"+String(parseInt(v%60)).lpad(2,"0"):"")
}function m(s){var r=s.getValue();
this.reconfigure(this.store,o.call(this,r));
this.setExtraParams({group_by:r},true)
}function o(r){var s=[];
if(r=="a_saddr"||r=="b_saddr"){s.push({header:this.LcolRtpIP_hostName,dataIndex:"rtpip",width:__width_ColumnChar(25),renderer:d})
}else{s.push({header:this.LcolSipIP_hostName,dataIndex:"sipip",width:__width_ColumnChar(25),renderer:q})
}s.push({header:this.LcolProtocol,dataIndex:"protocol",width:__width_ColumnChar(10)},{header:this.LcolCount,dataIndex:"cnt_all",width:__width_ColumnChar(15),align:"right"},{header:this.LcolDuration,dataIndex:"duration_all",width:__width_ColumnChar(15),align:"right",renderer:p},{header:this.LcolAsr,dataIndex:"asr_all",width:__width_ColumnNum(6),align:"right",renderer:a},{header:this.LcolNer,dataIndex:"ner_all",width:__width_ColumnNum(6),align:"right",renderer:n},{header:this.LcolAcd,dataIndex:"acd_all",width:__width_ColumnNum(6),align:"right",renderer:g},{header:this.LcolPdd,dataIndex:"pdd_all",width:__width_ColumnNum(6),align:"right",renderer:c});
return(s)
}}});
Ext.override(GridReports.CallSummary.Grid,{LcolSipIP_hostName:"sip IP / host name",LcolRtpIP_hostName:"rtp IP / host name",LcolProtocol:"protocol",LcolCount:"number of calls",LcolDuration:"total duration",LcolAsr:"ASR",LcolNer:"NER",LcolAcd:"ACD",LcolPdd:"PDD",LdateRange:"date range",LdateFrom:"from",LdateTo:"to",Lnumbers:"numbers",LnumberSrc:"src",LnumberDst:"dst",LbySourceDestIp:"by source / dest. IP",LbySourceSipIp:"by source SIP IP",LbyDestinationSipIp:"by destination SIP IP",LbySourceRtpIp:"by source RTP IP",LbyDestinationRtpIp:"by destination RTP IP",Lpaginator:"navigation"});
Ext.define("GridReports.QOS.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.GridReports.QOS.GridX",constructor:function(f){var l=date();
var g="2s";
var b={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud,"border-width":0}};
var k=[{xtype:"buttongroup",title:this.LbySourceDestIp,columns:1,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{xtype:"ComboBoxA",name:"group_by",aData:[["2s",this.LbySourceSipIp],["2d",this.LbyDestinationSipIp],["a_saddr",this.LbySourceRtpIp],["b_saddr",this.LbyDestinationRtpIp]],editable:false,value:g,_buttonGroup:true,listeners:{scope:this,select:m},style:{marginBottom:"0px !important"}},{xtype:"container",height:23}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.LdateRange,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LdateFrom+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:l,_searchField:"fdatefrom",_gridForm:this,_buttonGroup:true},{value:this.LdateTo+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",_searchField:"fdateto",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lip,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LipSrc+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fsipcallerip",_gridForm:this,_buttonGroup:true},{value:this.LipDst+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fsipcalledip",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lpaginator,items:b,style:{background:__color_TabGroupBackgroud,"border-width":0}}];
f=Ext.applyIf(f||{},{storeId:"GridReports.QOS",url:"php/model/sql.php",module:"CDR_stats",recordStruct:rsCDR_stats,sortField:"cnt_all",sortDirection:"desc",remoteSort:true,extraParams:{group_by:"2s",fdatefrom:l,fsipcallerdip_type:1,report_type:"QOS",grid_report:true},columns:o.call(this,g),pageSize:50,tbar:k,paginator:b,enableExportCsv:true,withoutSeparatorCsv:true});
this.callParent([f]);
function q(v,r,s,w,u,t){return(s.data.sip_ip+(s.data.sip_hostname?("<br><i>"+s.data.sip_hostname+"</i>"):""))
}function d(v,r,s,w,u,t){return(s.data.rtp_ip+(s.data.rtp_hostname?("<br><i>"+s.data.rtp_hostname+"</i>"):""))
}function p(v,r,s,w,u,t){return(v?String(parseInt(v/3600)).lpad(2,"0")+":"+String(parseInt(v%3600/60)).lpad(2,"0")+":"+String(parseInt(v%60)).lpad(2,"0"):"")
}function a(v,r,s,w,u,t){return(formatNumber(s.data.mos_all,2))
}function c(v,r,s,w,u,t){return(formatNumber(s.data.jitter_all,2))
}function h(v,r,s,w,u,t){return(formatNumber(s.data.delay_all,1)+__unit_xPDV)
}function n(v,r,s,w,u,t){return(formatNumber(s.data.packets_lost_all,3)+"%")
}function m(s){var r=s.getValue();
this.reconfigure(this.store,o.call(this,r));
this.setExtraParams({group_by:r},true)
}function o(r){var s=[];
if(r=="a_saddr"||r=="b_saddr"){s.push({header:this.LcolRtpIP_hostName,dataIndex:"rtpip",width:__width_ColumnChar(25),renderer:d})
}else{s.push({header:this.LcolSipIP_hostName,dataIndex:"sipip",width:__width_ColumnChar(25),renderer:q})
}s.push({header:this.LcolCount,dataIndex:"cnt_all",width:__width_ColumnChar(15),align:"right"},{header:this.LcolMos,dataIndex:"mos_all",width:__width_ColumnNum(6),align:"right",renderer:a},{header:this.LcolJitter,dataIndex:"jitter_all",width:__width_ColumnNum(6),align:"right",renderer:c},{header:this.LcolDelay,dataIndex:"delay_all",width:__width_ColumnNum(7),align:"right",renderer:h},{header:this.LcolPacketsLost,dataIndex:"packets_lost_all",width:__width_ColumnNum(10),align:"right",renderer:n});
return(s)
}}});
Ext.override(GridReports.QOS.Grid,{LcolSipIP_hostName:"sip IP / host name",LcolCount:"number of calls",LcolDuration:"total duration",LcolMos:"MOS",LcolJitter:"Jitter",LcolDelay:"x&#772; PDV",LcolPacketsLost:"Packet Loss",LdateRange:"date range",LdateFrom:"from",LdateTo:"to",Lip:"IP",LipSrc:"src",LipDst:"dst",LbySourceDestIp:"by source / dest. IP",LbySourceSipIp:"by source SIP IP",LbyDestinationSipIp:"by destination SIP IP",LbySourceRtpIp:"by source RTP IP",LbyDestinationRtpIp:"by destination RTP IP",Lpaginator:"navigation"});
Ext.define("GridReports.CallDetail.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.GridReports.CallDetail.GridX",constructor:function(b){var g=null;
var f=null;
var d=null;
if(!b||!b.withoutToolbar){f=b&&b.dateFrom||date();
d=b&&b.dateTo||null;
var a={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud,"border-width":0}};
var g=[{xtype:"buttongroup",title:this.LdateRange,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LdateFrom+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:f,_searchField:"fdatefrom",_gridForm:this,_buttonGroup:true},{value:this.LdateTo+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",value:d,_searchField:"fdateto",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lnumbers,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LnumberSrc+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fcaller",_gridForm:this,_buttonGroup:true},{value:this.LnumberDst+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fcalled",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lip,columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:this.LipSrc+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fsipcallerip",_gridForm:this,_buttonGroup:true},{value:this.LipDst+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",width:150,_searchField:"fsipcalledip",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.Lpaginator,items:a,style:{background:__color_TabGroupBackgroud,"border-width":0}}]
}var c=[{header:this.LdateText,dataIndex:"calldate2",width:70,sortable:true,align:"center"},{header:this.LsrcTextSimple,dataIndex:"caller",width:100,sortable:true,align:"center"},{header:this.LdstTextSimple,dataIndex:"called",width:100,align:"center"},{header:this.LdurationSimple,dataIndex:"duration",width:60,align:"center"},{header:this.LsrcTextIP,dataIndex:"sipcallerip2",width:100,align:"center"},{header:this.LdstTextIP,dataIndex:"sipcalledip2",width:100,align:"center"}];
if(!b.extraParams||!b.extraParams.lastSIPresponse){c.push({header:this.LlastresponseText,dataIndex:"lastresponse",width:100,align:"center"})
}c.push({header:this.LmonitorText,dataIndex:"menu",width:90,align:"right",noCopyToClipboard:true,renderer:function(n,h,k,o,m,l){return n&&n.replaceall("__THIS_ID__",this.id)||"&nbsp;"
}});
if(b&&b.extraParams&&f){b.extraParams.fdatefrom=f
}b=Ext.applyIf(b||{},{storeId:"GridReports.CallDetail",url:"php/model/sql.php",module:"CDR",recordStruct:rsCDR,sortField:"calldate2",sortDirection:"desc",extraParams:{fdatefrom:f,fcallerd_type:1,fsipcallerdip_type:1},remoteSort:true,columnsDefaults:{sortable:false},columns:c,pageSize:30,tbar:g,paginator:a});
this.callParent([b])
},doDownloadPcap:function(b,a){CDR.Utils.testDownloadPcapWav(this,b,function(){CDR.Utils.downloadPcapWav(b)
})
},doDownloadWav:function(b,a){CDR.Utils.testDownloadPcapWav(this,b,function(){CDR.Utils.downloadPcapWav(b,true)
},true)
},doPlayFlashWavPlayer:function(b,c,a,d){CDR.Utils.doPlayFlashWavPlayer(b,{panel:this,expand:c,audit:a,event:d})
},showFax:function(a,b){CDR.Utils.showFax(this,a,b)
},doShareCdrSipRtp:function(b,a,c){CDR.Utils.shareCdr("share_cdr_show","rtp",window.isCloud?"share_link":"self_protected_link",this)
},doShareCdrSip:function(b,a,c){CDR.Utils.shareCdr("share_cdr_show",null,window.isCloud?"share_link":"self_protected_link",this)
}});
Ext.override(GridReports.CallDetail.Grid,{LdateText:"Datetime",LsrcTextSimple:"Call from",LdstTextSimple:"Call to",LdurationSimple:"Duration",LsrcTextIP:"Source IP",LdstTextIP:"Destination IP",LlastresponseText:"Last response",LmonitorText:"Commands",LdateRange:"date range",LdateFrom:"from",LdateTo:"to",Lnumbers:"numbers",LnumberSrc:"src",LnumberDst:"dst",Lip:"IP",LipSrc:"src",LipDst:"dst",Lpaginator:"navigation"});
Ext.define("GridReports.CallSummary.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.report_call_summaryPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"report_call_summary-panel",iconCls:"icon_menu_diag_system",gridXType:"GridReports.CallSummary.GridX",wikiId:"Reports#Call_summary"});
this.callParent([a])
},changeTimezone:function(){this.reloadGrid()
}});
Ext.override(GridReports.CallSummary.Panel,{titleText:"Call Summary"});
Ext.define("GridReports.QOS.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.report_qosPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"report_qos-panel",iconCls:"icon_menu_diag_system",gridXType:"GridReports.QOS.GridX",wikiId:"Reports#QoS_report"});
this.callParent([a])
},changeTimezone:function(){this.reloadGrid()
}});
Ext.override(GridReports.QOS.Panel,{titleText:"QOS"});
Ext.define("GridReports.CallDetail.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.report_call_detailPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"report_call_detail-panel",iconCls:"icon_menu_diag_system",gridXType:"GridReports.CallDetail.GridX",wikiId:"Reports#Call_detail_Records"});
this.callParent([a])
},changeTimezone:function(){this.reloadGrid()
}});
Ext.override(GridReports.CallDetail.Panel,{titleText:"Call Detail"});
Ext.ns("User.admin");
Ext.define("User.admin.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.User.admin.GridX",subsystem:"user_admin",constructor:function(c){var l=this;
var g=[];
g.push({xtype:"actioncolumn",dataIndex:c.groups?"name":"username",widthCh:25,rendererBase:f,items:[{getClass:function(o,p,q){return(this.groups?q.data.blocked?"icon_group_blocked":"icon_group_green":(q.data.group_blocked?"icon_group_blocked":q.data.blocked?"icon_user_blocked":"icon_user_green"))
},handler:function(p,t,o,q,r){var s=p.store.getAt(t);
if(this.groups||!s.data.group_blocked){if(s.data.blocked){this.unblock(s)
}else{this.block(s)
}}},enableHandler:function(r,s,t,u,o,q,p){return(this.groups||!t.data.group_blocked)
},tooltip:function(o,p,q){return(this.findLangS("tooltip",this.groups?q.data.blocked?"unblockGroup":"blockGroup":(q.data.group_blocked?"groupIsBlocked":q.data.blocked?"unblockUser":"blockUser")))
},scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"});
if(!c.groups){g.push({dataIndex:"name",widthCh:25,renderer:f},{dataIndex:"group_name",widthCh:25,renderer:f},{dataIndex:"email",widthCh:35,renderer:f})
}g.push({dataIndex:"note",widthCh:60});
this._widthForm=__width_FieldChar(86);
this._labelCh=c.userConfig?10:23;
this._widthCh=40;
c=Ext.applyIf(c||{},{storeId:"UserSadminStore",url:"php/model/sql.php",module:c.groups?"group_admin":"user_admin",recordStruct:rsUserAdmin,sortField:c.groups?"name":"username",remoteSort:true,columns:g,fpDefaults:{xtype:"textfield",widthCh:this._widthCh,labelCh:this._labelCh,width:c.userConfig?undefined:this._widthForm,disableAutoAddTriggerWidth:true},fpConfig:c.userConfig?undefined:{layout:"fit",autoHeight:false},ewConfig:c.userConfig?undefined:function(){return({layout:"fit",width:this._widthForm+50,height:Math.min(Ext.dom.Element.getViewportHeight()-60,c.groups?775:910)})
},fpItems:function(B,y,o,q){var z=[];
if(c.userConfig){var u=["left","right","disable"];
for(var C=0;
C<u.length;
C++){u[C]=[u[C],this.findLangS("enumdata",u[C])]
}var r=[{xtype:"container",title:this.findLangS("title","commonTab"),items:[{xtype:"checkbox",name:"uc_enable_confirm_before_unload",labelWidth:__width_FieldChar(30),labelAlign:"left"},{xtype:"checkbox",name:"uc_enable_dns_cdr",labelWidth:__width_FieldChar(30),labelAlign:"left"},{xtype:"checkbox",name:"uc_enable_dns_message",labelWidth:__width_FieldChar(30),labelAlign:"left"},{xtype:"checkbox",name:"uc_enable_dns_ss7",labelWidth:__width_FieldChar(30),labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_enable_flags_cdr_number",aData:u,labelWidth:__width_FieldChar(30),width:__width_FormChar(30,8)+__width_Trigger,labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_enable_flags_cdr_ip",aData:u,labelWidth:__width_FieldChar(30),width:__width_FormChar(30,8)+__width_Trigger,labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_enable_flags_message_number",aData:u,labelWidth:__width_FieldChar(30),width:__width_FormChar(30,8)+__width_Trigger,labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_enable_flags_message_ip",aData:u,labelWidth:__width_FieldChar(30),width:__width_FormChar(30,8)+__width_Trigger,labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_enable_flags_ss7_number",aData:u,labelWidth:__width_FieldChar(30),width:__width_FormChar(30,8)+__width_Trigger,labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_enable_flags_ss7_ip",aData:u,labelWidth:__width_FieldChar(30),width:__width_FormChar(30,8)+__width_Trigger,labelAlign:"left"},{xtype:"ComboBoxA",name:"uc_csv_field_separator",aData:[["comma",","],["semicolon",";"]],labelWidth:__width_FieldChar(30),width:__width_FormChar(30,2)+__width_Trigger,labelAlign:"left"}],style:{"background-color":__color_FormBackground}},{xtype:"container",title:this.findLangS("title","colorFontTab"),items:[{xtype:"fieldset",titleLang:"colorThemeShift",items:[{xtype:"colorpickerfield",name:"uc_color_theme_shift",_width:__width_FieldChar(7)+__width_Trigger*2},{xtype:"numberfield",name:"uc_color_theme_shift_h",widthNum:6,minValue:0,maxValue:359,step:10,enableKeyEvents:true},{xtype:"numberfield",name:"uc_color_theme_shift_s",widthNum:6,minValue:0,maxValue:30,step:5,enableKeyEvents:true},{xtype:"numberfield",name:"uc_color_theme_shift_v",widthNum:6,minValue:0,maxValue:30,step:5,enableKeyEvents:true}]},{xtype:"fieldset",titleLang:"fonts",items:[{xtype:"textfield",name:"uc_font_main_menu",widthCh:30,enableKeyEvents:true}]}],style:{"background-color":__color_FormBackground}}];
if(user_id()){r.push({xtype:"container",title:this.findLangS("title","resetConfiguration"),items:[{xtype:"checkbox",name:"config_grid",labelWidth:__width_FieldChar(30),labelAlign:"left"},{xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},items:{xtype:"button",text:this.findLangS("button","reset"),width:__width_FieldChar(20),disabled:true,_btn_id:"reset",handler:this.resetUserConfiguration,scope:this},style:{marginTop:10}}],style:{"background-color":__color_FormBackground}})
}z={xtype:"tabpanel",items:r,activeTab:0,plain:true,bodyBorder:false,border:false,height:__height_Form(12),tabBar:{renderTpl:__tpl_simplyTabPanel}}
}else{var v={admin:[{name:"is_admin"}],cdr:[{name:"can_cdr"},{name:"can_write_cdr"},{name:"simple_cdr",enable:!window.callRecorderMod},{name:"hide_cdr_groups"},{name:"show_only_connected_calls"}],messages:[{name:"can_messages",enable:!window.callRecorderMod},{name:"can_view_content_message",enable:!window.callRecorderMod},{name:"can_view_message_url",enable:!window.callRecorderMod}],registers__sip_msg:[{name:"can_register",enable:!window.callRecorderMod},{name:"can_sip_msg",enable:!window.callRecorderMod}],pcap:[{name:"can_pcap"},{name:"no_rtp"},{name:"can_upload_pcap"}],audio_fax:[{name:"can_play_audio"},{name:"can_download_audio"},{name:"can_show_fax"}],active_calls:[{name:"can_activecalls"},{name:"can_activecalls_map"},{name:"can_listen_active_call"}],dashboard_charts:[{name:"can_dashboard",enable:!window.callRecorderMod},{name:"dashboard_read_only",enable:!window.callRecorderMod},{name:"can_graphs"}],alerts_reports:[{name:"can_alerts_edit",enable:!window.callRecorderMod},{name:"create_only_private_alerts",enable:!window.callRecorderMod},{name:"can_alerts_show_sent",enable:!window.callRecorderMod},{name:"can_reports_edit",enable:!window.callRecorderMod},{name:"create_only_private_reports",enable:!window.callRecorderMod},{name:"can_reports_show_sent",enable:!window.callRecorderMod},{name:"can_report_functions",enable:!window.callRecorderMod}],share:[{name:"can_cdr_share_local_public",enable:!window.disableCdrShare},{name:"can_cdr_share_local_private",enable:!window.disableCdrShare},{name:"can_cdr_share_voipmonitor_org",enable:!window.disableCdrShare&&!window.disable_cdrvmshare}],others:[{name:"can_livesniffer",enable:!window.callRecorderMod},{name:"can_svg_paint",enable:!window.callRecorderMod},{name:"can_3d_rtp_charts",enable:!window.callRecorderMod},{name:"can_network"},{name:"can_tracker",enable:!window.callRecorderMod},{name:"can_mtr"},{name:"can_ipacc",enable:ipaccEnable},{name:"can_capture_rules"},{name:"can_edit_codebooks"},{name:"can_sensors_operations"},{name:"can_edit_all_templates"},{name:"can_delete_all_templates"},{name:"hide_license_information"},{name:"can_show_sql_query"},{name:"hide_change_password"},{name:"hide_user_configuration"}]};
var D=[];
for(var s in v){var H=v[s];
var F=false;
var p=0;
for(var C=0;
C<H.length;
C++){if(!Ext.isDefined(H[C].enable)||H[C].enable){if(!F){var w=this.findLangS("checkboxes_group",s);
if(w){D.push({xtype:"displayfield",value:w,colspan:3,fieldStyle:{color:"darkslategray","font-size":"90%","font-weight":"bold","font-style":"italic",height:"12 !important","min-height":"12 !important","text-align":"center"},style:{marginTop:-2,marginBottom:3,paddingTop:0,paddingBottom:0},width:__width_FormChar(23,63)})
}F=true
}D.push({xtype:"checkbox",name:H[C].name,widthCh:5,style:{margin:0,padding:0}});
++p
}}if(p%3){var A=3-(p%3);
for(var C=0;
C<A;
C++){D.push({xtype:"container",widthCh:5});
++p
}}}this.checkBoxes=D;
var J=c.groups?[{xtype:"textfield",name:"name",allowBlank:false,blankText:lang.requirefield}]:[{xtype:"textfield",name:"username",allowBlank:false,blankText:lang.requirefield,vtype:window.isCloud?"email":undefined,fieldLabelLang:window.isCloud?"username_email":undefined},{xtype:"textfield",name:"name",allowBlank:false,blankText:lang.requirefield},{xtype:"textfield",inputType:"password",name:"password"},{xtype:"ComboBoxA",name:"delete2fa_sec",editable:false,value:0,hidden:true,aData:[[0,this.findLangS("field","keep2fa_sec")],[1,this.findLangS("field","remove2fa_sec")]]},{xtype:"displayfield_h16",name:"missing_sec",fieldLabel:this.findLangS("field","missing_sec"),value:"not defined",hidden:true},{xtype:"checkbox",name:"req_2fa",boxLabel:this.findLangS("field","req_2fa"),hideLabel:true,style:{marginLeft:__width_FieldChar(this._labelCh)+__width_FieldSeparator}},{xtype:"CBX_Groups",name:"id_group",_clearButton:true,_autoDisableIfEmpty:true},{xtype:"textfield",fieldLabel:this.emailText,name:"email"}];
J.push({xtype:"panel",layout:{type:"table",columns:3},items:D,width:this._widthForm,border:false,style:{paddingBottom:6},bodyStyle:__style_FormBackground()},{xtype:"timefield_dhms",name:"crules_remove_expire_time"},{xtype:"ComboBoxA",name:"can_audit",widthCh:7,aData:[[0,"off"],[1,"on"],[2,"auto"]]},{xtype:"textarea",name:"note"});
var I=[{xtype:"checkbox",name:"blocked"},{xtype:"textarea",name:"blocked_reason"},{xtype:"numberfield",name:"max_bad_login_attempt",minValue:1,maxValue:100,widthNum:5},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"password_expiration_days",minValue:1,maxValue:365,widthNum:5},{xtype:"displayfield",value:"["+lang.days+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"textarea",name:"enable_login_ip"},c.groups?undefined:{xtype:"checkbox",name:"password_expired"}];
var G=[{xtype:"textarea",name:"ip",withoutHelp:true},{xtype:"displayfield",value:this.findLangS("field_help","ip"),style:{marginLeft:130,paddingBottom:0,marginTop:-5},fieldStyle:{"font-style":"italic","font-size":"90%"},hidden:false},{xtype:"textarea",name:"number",withoutHelp:true},{xtype:"displayfield",value:this.findLangS("field_help","number"),style:{marginLeft:130,paddingBottom:0,marginTop:-5},fieldStyle:{"font-style":"italic","font-size":"90%"},hidden:false},{xtype:"textarea",name:"domain",withoutHelp:true},{xtype:"displayfield",value:this.findLangS("field_help","domain"),style:{marginLeft:130,paddingBottom:0,marginTop:-5},fieldStyle:{"font-style":"italic","font-size":"90%"},hidden:false},{xtype:"textarea",name:"vlan",withoutHelp:true},{xtype:"displayfield",value:this.findLangS("field_help","vlan"),style:{marginLeft:130,paddingBottom:0,marginTop:-5},fieldStyle:{"font-style":"italic","font-size":"90%"},hidden:false}];
for(var C=0;
C<2;
C++){if(C==0?getDataCdrCustomHeaders():getDataMessageCustomHeaders()){var E=C==0?"cdr":"message";
G.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field",E+"_custom_headers"),width:__width_FieldChar(this._labelCh)+1,fieldStyle:{"text-align":"right"},style:{marginRight:__width_FieldSeparator}},{xtype:"andOrCombinationTable",modelName:"customHeadersRestrict_"+E,name:"custom_headers_"+E,fieldsNext:[{name:"custom_header",type:"string"}],columnsNext:[{xtype:"actioncolumn",dataIndex:"custom_header",header:this.findLangS("column","custom_header"),rendererBase:function(R,T,M,P,N,S,Q){var O=d(R);
if(O){var K=Q.ownerCt.name.match("cdr")?getDataCdrCustomHeaders():getDataMessageCustomHeaders();
if(K){for(var L=0;
L<K.length;
L++){if(O.header==K[L]._column_unique){return(K[L].name+" : "+O.content)
}}}return("??? : "+O.content)
}},items:[{getClass:function(K,L,M){return("icon_edit")
},handler:function(L,P,K,M,N){var O=L.store.getAt(P);
k(h(L).name,O)
},tooltip:lang.tooltip.edit}],iconDivStyle:"float:left; height:15; width: 16;",baseContentDivStyle:"padding-left: 18",flex:1,sortable:false}],logic_level_width:120,tbar:[{text:"add",iconCls:"icon_add",handler:function(){n(h(this).name)
}},{text:"edit",iconCls:"icon_edit",handler:function(){k(h(this).name)
},autoEnableIfSelectedRecord:true}],dblClickToEdit:true,editFce:b,formulaTagName:"_id",formulaTagValue:"custom_headers_"+E+"_formula",setLogicRslt:function(){var L=this.getLogicRslt();
var M=this.getFormPanel().findC(this.formulaTagName,this.formulaTagValue);
if(M&&L){var K='<span style="word-wrap: break-word; white-space: normal;">'+L+"</span>";
M.setHtml(K)
}else{M.setHtml("")
}},logicRsltItemRenderer:function(K){var M=d(K.data.custom_header);
if(M){var L=getNameCustomHeader(this.name.match("cdr")?getDataCdrCustomHeaders():getDataMessageCustomHeaders(),M.header);
return("["+L+" like "+M.content+"]")
}},flex:1,height:150}],width:"100%",style:{marginBottom:2}},{xtype:"container",layout:"hbox",items:[{xtype:"container",width:__width_FieldChar(this._labelCh)+__width_FieldSeparator+1},{xtype:"panel",_id:"custom_headers_"+E+"_formula",flex:1,height:35,bodyStyle:{padding:5,"background-color":__color_FormBackground}}],width:"100%",style:{marginBottom:__height_FieldSeparator}},{xtype:"displayfield",value:this.findLangS("field_help",E+"_custom_headers"),style:{marginLeft:130,paddingBottom:0,marginTop:-5},fieldStyle:{"font-style":"italic","font-size":"90%"},hidden:false})
}}G.push({xtype:"checkbox",name:"ip_number_domain_or"});
var r=[{title:this.findLangS("title","basic_data"),items:J},{title:this.findLangS("title","secure_users"),items:I},{title:this.findLangS("title","users_restriction"),items:G}];
if(!c.groups){this.enabledSensors=new User.admin.Sensors.Grid({memoryStore:true,relFields:this._duplicationFromUserId||!y?{user_id:this._duplicationFromUserId||q.data.id}:undefined,removeRecordsIdAfterLoad:this._duplicationFromUserId,style:{border:"1px solid "+__color_PanelBorder},width:"100%",height:300,enableSearchX:false});
var t=[this.enabledSensors];
r.push({title:this.findLangS("title","enabled_sensors"),items:t});
if(this._duplicationFromUserId){delete this._duplicationFromUserId
}}z={xtype:"tabpanel",items:[],activeTab:0,plain:true,bodyBorder:false,border:false,tabBar:{renderTpl:__tpl_simplyTabPanel}};
for(var C=0;
C<r.length;
C++){z.items.push({xtype:"container",layout:"fit",items:{xtype:"container",items:r[C].items,style:{paddingTop:4,paddingLeft:4,paddingRight:4,marginRight:__width_Scroller,"background-color":__color_FormBackground}},border:false,autoScroll:true,title:r[C].title,style:{"background-color":__color_FormBackground}})
}}return(z)
},propRecordText:function(o){return(this.groups?o.name:o.username)
},enableEdit:true,enableSearchX:true,plugins:c.groups?undefined:[{ptype:"rowexpander",rowBodyContentCls:"User.admin.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],prefixCls:"user_admin",subsystem:"user_admin",stripeRows:false,nextStdBar:c.groups?undefined:[{text:findLangS("user_admin","text","duplicationUser"),handler:this.duplicationUser,_id:"btn_duplicate",scope:this,disabled:true},{text:findLangS("user_admin","menu","tools"),iconCls:"icon_wrench",_id:"btn_tools",menu:{defaults:{scope:this,handler:this.toolsHandler},items:[{text:findLangS("user_admin","menu","exportUserRestrictions"),_id:"exportUserRestrictions"},{text:findLangS("user_admin","menu","importUserRestrictions"),_id:"importUserRestrictions"}]}}],contextMenu:c.groups?undefined:function(o,p){if(!(o.data.is_admin*1)){return([{text:this.findLangS("text","duplicationUser"),handler:this.duplicationUser,scope:this}])
}},subjectLang:c.groups?"group":"user"});
this.callParent([c]);
function f(t,q,p,u,s,r,o){if(p.data.blocked||p.data.group_blocked){t=renderStringStyle(t,{color:"darkgrey",strike:true})
}return(t)
}function n(q){var p=l.getField(q);
var o=q.match("cdr")?"cdr":"message";
m(o,null,function(r){var s=a(r.header,r.content);
p.addRecord({custom_header:s});
return(true)
},true,"add header")
}function k(q,o){var p=l.getField(q);
if(!o){o=p.getSelectedRecord();
if(!o){return
}}b(p,o)
}function b(r,o){var q=r.name.match("cdr")?"cdr":"message";
var p=d(o.data.custom_header);
m(q,p,function(s){var t=a(s.header,s.content);
r.updateRecord({custom_header:t},o);
return(true)
},true,"modify header")
}function a(p,o){return(p+":"+o)
}function d(o){var p=o.indexOf(":");
if(p>0){return({header:o.substr(0,p),content:o.substr(p+1)})
}return(null)
}function h(o){return(Ext.get(o.getEl().up(".x-grid").id).component)
}function m(t,s,p,r,v){var q=12;
var u=40;
var o=new Ext.form.Panel({xtype:"form",frame:true,border:false,autoWidth:true,autoHeight:true,items:[{xtype:"ComboBoxA",name:"header",value:s&&s.header,aData:getComboboxDataCustomHeaders(t=="cdr"?getDataCdrCustomHeaders():getDataMessageCustomHeaders()),fieldLabel:"header",labelAlign:"right",width:__width_FormChar(q,u),allowBlank:false},{xtype:"textfield",name:"content",value:s&&s.content,fieldLabel:"content",labelAlign:"right",width:__width_FormChar(q,u),allowBlank:false}],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:function(){if(o.getForm().isValid()){var w=o.getForm().getFieldValues();
if(p(w)){o.ownerCt.close()
}}}},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){o.ownerCt.close()
}}]});
if(r){o._win=new Ext.Window({title:v,layout:"fit",items:o,border:false,modal:true,closable:true,resizable:false});
o._win.show()
}return(o)
}},duplicationUser:function(d){var b=null;
if(d._record&&d._record.data){b=d._record.data
}else{var a=this.selModel.getSelection();
if(a.length){b=a[0].data
}}var c=cloneObject(b);
delete c.name;
delete c.username;
delete c.password;
delete c.email;
delete c.secret;
this._duplicationFromUserId=b.id;
this.createEditWindow(true,null,{defaultValues:c})
},toolsHandler:function(c){switch(c._id){case"exportUserRestrictions":formPostSafe("php/model/utilities.php","POST",{task:"exportUserRestrictions"});
break;
case"importUserRestrictions":var b=new Ext.form.FormPanel({url:"php/model/utilities.php",frame:true,border:false,autoWidth:true,autoHeight:true,items:[{xtype:"filefield",name:"file",allowBlank:false,fieldLabel:this.findLangS("field","file"),buttonText:this.findLangS("button","selectFile"),width:350,labelWidth:60},{xtype:"checkbox",name:"delete_old",checked:true,fieldLabel:this.findLangS("field","deleteOld"),width:350,labelWidth:60}],buttons:[{text:lang.okButtonText,iconCls:"icon_upload",scope:this,handler:d},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:a}]});
var f=new Ext.Window({title:this.findLangS("title","importUserRestrictions"),layout:"fit",items:b,border:false,modal:true,closable:true,resizable:false});
f.show();
function d(){if(!b.getForm().isValid()){return
}b.getForm().submit({scope:this,params:{task:"importUserRestrictions",params:Ext.encode({formData:b.getForm().getFieldValues()})},success:function(g,h){f.close();
this.reload()
},error:function(g,h){alertSubmitError(h)
},failure:function(g,h){alertSubmitFailure(h)
},scope:this})
}function a(){f.close()
}break
}},setContextItems:function(g,p,s,b,m,n,r){if(this._disableSetContextItems){return
}if(this.formPanel._recordLoaded&&b&&b.name=="simple_cdr"&&s=="change"&&m){Ext.Msg.confirm("",this.findLangS("text","simpleCdrWarning"),function(w){if(w=="no"){this.setValueField("simple_cdr",false)
}},this)
}if(this.userConfig){if(this.formPanel._recordLoaded){if(s=="change"||s=="keyup"||s=="select"){if(b.name.match(/uc_color_theme_shift/)){if(s=="change"&&b.name=="uc_color_theme_shift"){this.colorThemeShiftDisable=true;
var f=this.colorThemeShit_rgbHexToHsv(m);
colorThemeShift(f[0],f[1],f[2]);
this.getField("uc_color_theme_shift_h").setValue(f[0]);
this.getField("uc_color_theme_shift_s").setValue(f[1]);
this.getField("uc_color_theme_shift_v").setValue(f[2]);
this.colorThemeShiftDisable=false
}else{if(!this.colorThemeShiftDisable){this.getField("uc_color_theme_shift").setValue(this.colorThemeShit_hsvToRgbHex(p.uc_color_theme_shift_h,p.uc_color_theme_shift_s,p.uc_color_theme_shift_v));
colorThemeShift(p.uc_color_theme_shift_h,p.uc_color_theme_shift_s,p.uc_color_theme_shift_v)
}}}if(b.name=="uc_font_main_menu"){setMainMenuFont(p.uc_font_main_menu)
}}var v=["config_grid"];
var o=false;
for(var t=0;
t<v.length;
t++){if(this.getValueField(v[t])){o=true;
break
}}var l=this.getItemBy("_btn_id","reset");
if(l){l.enableIf(o)
}}}else{var u=[];
u.blocked_reason=p.blocked;
var q=this.formPanel.getForm().getFields();
var k=["name","username","password","req_2fa","delete2fa_sec","email","secret","id_group","password_expired","note","blocked","blocked_reason"];
this.showField("missing_sec",p.username&&this.dataForEdit.exist_secret==0);
this.showField("delete2fa_sec",p.username&&this.dataForEdit.exist_secret==1);
var d=[];
for(var t=0;
t<this.checkBoxes.length;
t++){if(this.checkBoxes[t].xtype=="checkbox"&&this.checkBoxes[t].name!="is_admin"&&this.checkBoxes[t].name!="simple_cdr"){d.push(this.checkBoxes[t].name)
}}var a=null;
if(!this.groups&&p.id_group){var h=this.getField("id_group");
if(h){a=h.getSelectRecord()
}}for(var t=0;
t<q.length;
t++){var b=q.get(t);
if(!(b.xtype&&b.xtype.match&&b.xtype.match("displayfield"))){var c=b.name;
if(k.isIn(c)){continue
}b.enableIf(!(d.isIn(c)&&p.is_admin||!this.groups&&p.id_group)&&(!Ext.isDefined(u[c])||u[c])&&!(c=="can_pcap"&&this.getValueField("simple_cdr"))&&!(c=="create_only_private_alerts"&&!this.getValueField("can_alerts_edit"))&&!(c=="create_only_private_reports"&&!this.getValueField("can_reports_edit")));
if(!this.groups&&p.id_group&&a){this._disableSetContextItems=true;
b.setValue(a.data[c]);
delete this._disableSetContextItems
}}}if(p.simple_cdr){this.setValueField("can_pcap",false)
}}this.enableField("crules_remove_expire_time",p.can_capture_rules||p.is_admin)
},prepareDataForEdit:function(a){if(this.userConfig){a.uc_enable_confirm_before_unload=!a.uc_disable_confirm_before_unload;
if(!a.uc_csv_field_separator){a.uc_csv_field_separator=window.default_csv_field_separator==";"?"semicolon":"comma"
}if(a.uc_color_theme_shift_h||a.uc_color_theme_shift_s||a.uc_color_theme_shift_v){a.uc_color_theme_shift=this.colorThemeShit_hsvToRgbHex(a.uc_color_theme_shift_h,a.uc_color_theme_shift_s,a.uc_color_theme_shift_v)
}}},prepareDataForSave:function(d){if(this.userConfig){for(var b in d){if(b.match&&!b.match(/^uc_/)){delete d[b]
}}d.uc_disable_confirm_before_unload=!d.uc_enable_confirm_before_unload;
var c=User.admin.Utils.getUserSettingFields();
for(var b=0;
b<c.length;
b++){user.sqlrow[c[b]]=d[c[b]]
}uc_fontMainMenu=d.uc_font_main_menu;
uc_colorThemeShift_h=d.uc_color_theme_shift_h;
uc_colorThemeShift_s=d.uc_color_theme_shift_s;
uc_colorThemeShift_v=d.uc_color_theme_shift_v;
applyColorThemeShift();
setMainMenuFont(uc_fontMainMenu)
}else{if(this.enabledSensors){d.enabled_sensors=this.enabledSensors.getAllGridData(true);
d.enabled_sensors_updateRecords=this.enabledSensors._updateRecords;
d.enabled_sensors_deleteRecords=this.enabledSensors._deleteRecords
}for(var b=0;
b<this.checkBoxes.length;
b++){if(this.checkBoxes[b].xtype=="checkbox"){var a=this.checkBoxes[b].name;
if(a&&!Ext.isDefined(d[a])){d[a]=null
}}}}},getDefaultValues:function(){var a={can_audit:0};
if(!this.userConfig&&!this.groups&&this.store&&!this.store.getCount()&&this.store.proxy&&this.store.proxy.extraParams&&!this.store.proxy.extraParams.query){a.is_admin=true
}return(a)
},onChangeRecords:function(a,b,c){if(this.userConfig){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"reloadUserConfigSqlrow"}})
}else{this.repaintRecord(c);
if(!this.groups){refreshCustomers("users")
}}},onWindowClose:function(a){if(this.userConfig){colorThemeShift();
setMainMenuFont(uc_fontMainMenu)
}},confirmDeleteRuleText:function(b,f){var a=0;
if(b.length>1){for(var c=0;
c<b.length;
c++){a+=b[c].data.count_audit_log
}}else{a=b[0].data.count_audit_log
}var d=f;
if(a>0){d+='<br><br><i style="color: red;">'+this.findLangS("text","infoDeleteAuditLog").replace("_COUNT_",a)+"</i>"
}return d
},onSelectionChange:function(a){var b=a.getSelection();
this.enableBtn("btn_duplicate",b.length&&!(b[0].data.is_admin*1))
},isEnableEditRecord:function(a){return(!window.isCloud||a.data.username!="admin")
},isEnableDeleteRecord:function(a){return(!window.isCloud||a.data.username!="admin")
},block:function(b){var a=new Ext.form.Panel({xtype:"form",frame:true,border:false,autoWidth:true,autoHeight:true,items:[{xtype:"textarea",name:"reason",fieldLabel:this.findLangS("field","reason"),width:__width_FormChar(20,40),height:__height_FieldLines(3)}],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:function(){var d=a.getForm().getFieldValues();
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"blockUser",params:Ext.encode({id:b.data.id,group:this.groups,reason:d.reason})},success:function(f){a.ownerCt.close();
b.data.blocked=true;
this.onAfterChangeBlocked(b)
},maskEl:this,scope:this})
}},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){a.ownerCt.close()
}}],listeners:{scope:this,afterrender:function(){focusField=a.getForm().findField("reason");
if(focusField){focusField.focus(false,200)
}Ext.create("Ext.util.KeyNav",this.el,{enter:function(){submit.call(this)
},scope:this})
}}});
var c=new Ext.Window({title:this.findLangS("title",this.groups?"blockGroup":"blockUser"),layout:"fit",items:a,border:false,modal:true,closable:true,resizable:false});
c.show()
},unblock:function(a){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"unblockUser",params:Ext.encode({id:a.data.id,group:this.groups})},success:function(b){a.data.blocked=true;
this.onAfterChangeBlocked(a)
},maskEl:this,scope:this})
},onAfterChangeBlocked:function(a){a.commit();
this.refresh();
var b=this.getExpanderBodyContent(a);
if(b){b.history.reload()
}},resetUserConfiguration:function(){var a=[["config_grid","grid"]];
var b={};
for(var c=0;
c<a.length;
c++){if(this.getValueField(a[c][0])){b[a[c][1]]=true
}}if(isDataSet(b)){Ext.Msg.confirm("",this.findLangS("text","queryBeforeReset"),function(d){if(d=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"resetUserConfiguration",params:Ext.encode(b)},success:function(f){window.onbeforeunload_disable=true;
window.location="./"
},maskEl:this})
}},this)
}},colorThemeShit_rgbHexToHsv:function(b){var a=rgbToHsv(hexToRgb(b));
a[1]=Math.round(a[1]*30/100);
a[2]=Math.round(a[2]*30/100);
return(a)
},colorThemeShit_hsvToRgbHex:function(c,b,a){return(c||b||a?"#"+rgbToHex(hsvToRgb(c,Math.round(b*100/30),Math.round(a*100/30))):null)
}});
Ext.define("User.admin.GridExpPanel",{extend:"Ext.Panel",constructor:function(b){var a=[];
if(!(b.record.data.is_admin*1)){this.enabledSensors=new User.admin.Sensors.Grid({titleLang:"enabledSensorsTab",relFields:{user_id:b.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
a.push(this.enabledSensors)
}this.history=new User.admin.History.Grid({titleLang:"historyTab",relFields:{user_id:b.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
a.push(this.history);
this.tabPanel=new Ext.TabPanel({items:a,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"user_admin-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(b,{items:this.tabPanel,border:false});
this.callParent([b])
}});
Ext.define("User.admin.Sensors.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"UserAdminSensorsStore",url:"php/model/sql.php",module:"users_sensors",recordStruct:rsUsersSensors,sortField:"sensor_name",remoteSort:true,columns:[{dataIndex:"sensor_name",widthCh:40},{dataIndex:"description",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:12},fpItems:function(k,f,g,c){var b=this.getAllGridItems("sensor_id");
if(!f&&b&&b.isIn(c.data.sensor_id)){var h=b.indexOf(c.data.sensor_id);
if(h>=0){b.splice(h,1)
}}var d=[{xtype:"CBX_sensor",name:"sensor_id",widthCh:25,excludeIds:b,allowBlank:false},{name:"description"}];
return(d)
},propRecordText:function(b){return(b.sensor_name)
},enableEdit:true,enableSearchX:true,stripeRows:false,subsystem:"user_admin",subjectLang:"sensor"});
this.callParent([a])
},prepareDataForSave:function(a){if(this.memoryStore){a.sensor_name=this.getField("sensor_id").getRawValue()
}}});
Ext.define("User.admin.History.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(c){var b=["login","relogin","bad_login","bad_relogin","password_change","secret2fa_change","block","unblock"];
for(var d=0;
d<b.length;
d++){b[d]=[b[d],findLangS("user_admin","enumdata",b[d])]
}var a=["none","bad_password","blocked_address","blocked_account"];
for(var d=0;
d<a.length;
d++){a[d]=[a[d],findLangS("user_admin","enumdata",a[d])]
}c=Ext.applyIf(c||{},{storeId:"UserAdminHistoryStore",url:"php/model/sql.php",module:"users_history",recordStruct:rsUsersHistory,sortField:"time",sortDirection:"desc",pageSize:20,remoteSort:true,columns:[{dataIndex:"time",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"type",widthCh:15,renderer:renderArrayData,arrayData:b},{dataIndex:"bad_login_reason",widthCh:15,renderer:renderArrayData,arrayData:a},{dataIndex:"addr",widthCh:15,align:"right"},{dataIndex:"user_agent",widthCh:50},{dataIndex:"reason",widthCh:50},{dataIndex:"reapeat_counter",widthNum:10}],enableEdit:false,enableSearchX:true,stripeRows:false,paginatorPrependButtons:true,paginatorDisplayInfo:false,subsystem:"user_admin",subjectLang:"history"});
this.callParent([c])
}});
Ext.define("User.Admin.Settings",{extend:"Ext.ux.setting.Form",subsystem:"user_admin",constructor:function(a){Ext.applyIf(a,{settingTableName:"users_settings",settingTableStruct:rsUsersSettings,specItems:{max_bad_login_attempt:{xtype:"numberfield",minValue:1,maxValue:100,_width:__width_FieldNum(5)+__width_Trigger},password_expiration_days:{xtype:"numberfield",minValue:1,maxValue:365,_width:__width_FieldNum(5)+__width_Trigger,nextItem:{xtype:"displayfield",value:findLangS("user_admin","field","password_rules"),style:{marginLeft:120},fieldStyle:{"font-size":"10pt","font-style":"italic","font-weight":"bold",color:"blue"},isFormField:false}},password_min_length:{xtype:"numberfield",minValue:4,maxValue:20,_width:__width_FieldNum(5)+__width_Trigger},password_min_small_letters:{xtype:"numberfield",minValue:1,maxValue:10,_width:__width_FieldNum(5)+__width_Trigger},password_min_large_letters:{xtype:"numberfield",minValue:1,maxValue:10,_width:__width_FieldNum(5)+__width_Trigger},password_min_numbers:{xtype:"numberfield",minValue:1,maxValue:10,_width:__width_FieldNum(5)+__width_Trigger},password_min_other_chars:{xtype:"numberfield",minValue:1,maxValue:10,_width:__width_FieldNum(5)+__width_Trigger}},promptSave:true});
this.callParent([a])
}});
Ext.define("User.admin.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.user_adminPanelX",subsystem:"user_admin",constructor:function(a){this.usersGrid=new User.admin.Grid({title:this.findLangS("title","users")});
this.settings=new User.Admin.Settings({title:this.findLangS("title","settings")});
a=Ext.applyIf(a||{},{id:"user_admin-panel",iconCls:"icon_menu_user_admin",items:{xtype:"tabpanel",items:[this.usersGrid,this.settings],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"users",subsystem:"user_admin",wikiId:"User_Management"});
this.callParent([a])
},reactivate:function(){this.usersGrid.reload()
}});
Ext.define("User.admin.group.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.group_adminPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"group_admin-panel",iconCls:"icon_menu_user",gridXType:"User.admin.GridX",gridConfig:{groups:true},titleLang:"groups",subsystem:"user_admin",wikiId:"UserGroup_Management"});
this.callParent([a])
}});
Ext.define("User.admin.AuditLog.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.AuditLog.GridX",constructor:function(b){var a={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud,"border-width":0}};
var c=[{xtype:"buttongroup",title:findLangSd("dateRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:findLangSd("from")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",_searchField:"at_from",_gridForm:this,_buttonGroup:true},{value:findLangSd("to")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",_searchField:"at_to",_gridForm:this,_buttonGroup:true}],style:{"background-color":__color_TabGroupBackgroud}},{xtype:"buttongroup",title:findLangSd("search"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:findLangSd("grid","quickSearch")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",_gridForm:this,width:125,_buttonGroup:true},{xtype:"container",height:21}],style:{"background-color":__color_TabGroupBackgroud}},{xtype:"buttongroup",title:findLangSd("grid","paginator"),items:a,style:{"background-color":__color_TabGroupBackgroud}}];
b=Ext.applyIf(b||{},{storeId:"AuditLogStore",url:"php/model/sql.php",module:"audit_log",keyField:"id",recordStruct:rsAuditLog,sortField:"at",sortDirection:"DESC",pageSize:30,tbar:c,paginator:a,remoteSort:true,columns:[{dataIndex:"at",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"user_name_2",widthCh:20,headerLang:"user_name"},{dataIndex:"activity",widthCh:20,renderer:renderArrayData,arrayData:arAuditActivity},{dataIndex:"reason",renderer:renderString,widthCh:65,multiLine:true}],plugins:[{ptype:"rowexpander",rowBodyContentCls:"User.admin.AuditLog.GridExpPanel",expandOnEnter:false,expandOnDblClick:false,enableExpand:function(d){return(d.data.cdr_id||d.data.count_relation_cdr||d.data.filter_data)
}}],prefixCls:"audit_log",fullColumnSize:"reason",fullColumnSizeDecrementScroller:true,subsystem:"user_admin"});
this.callParent([b])
}});
Ext.define("User.admin.AuditLog.GridExpPanel",{extend:"Ext.Panel",constructor:function(b){if(b.record.data.filter_data){b.record.data._filter_data=Ext.decode(b.record.data.filter_data)
}this.relatedCDR=new CDR.Grid({title:findLangS("user_admin","title","relatedCdrTab"),layout:"fit",disableCharts:true,disableMenu:true,disablePagingToolbar:b.record.data.cdr_id,loadAtInit:true,border:false,onlyCdrId:b.record.data.cdr_id,onlyCdrByAuditLogId:b.record.data.count_relation_cdr?b.record.data.id:null,extraParams:!b.record.data.cdr_id&&b.record.data._filter_data?Ext.apply(cloneObject(b.record.data._filter_data),{user_id:b.record.data.uid}):null,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},noVerticalScroller:true});
this.tabPanel=new Ext.TabPanel({items:this.relatedCDR,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"audit_log-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
var a=[];
if(!b.record.data.cdr_id&&b.record.data._filter_data){this.headPanel=new Ext.Panel({layout:"fit",border:false,html:"---",style:{padding:"2 4 2 4"},listeners:{scope:this,afterRender:c}});
this.headPanelContainer=new Ext.Panel({title:findLangS("user_admin","title","filterQueryTab"),layout:"fit",items:[this.headPanel],style:{paddingTop:3,paddingBottom:3},cls:"audit_log-cell"});
a.push(this.headPanelContainer)
}a.push(this.tabPanel);
Ext.apply(b,{items:a,border:false});
this.callParent([b]);
function c(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getTableFilterHtml",params:Ext.encode({queryData:b.record.data._filter_data})},success:function(d){d.tableFilterHtml=d.tableFilterHtml.replaceall("__font__",__font_Grid).replaceall("__col1_width","200px");
this.headPanel.body.setHtml(d.tableFilterHtml)
}})
}}});
Ext.define("User.admin.AuditLog.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.audit_logPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"audit_log-panel",iconCls:"icon_script_edit",gridXType:"AuditLog.GridX",titleLang:"auditLog",subsystem:"user_admin"});
this.callParent([a])
}});
Ext.define("User.admin.Utils",{singleton:true,getUserSettingFields:function(d){var f=Ext.JSON.decode(window.userSettingFields);
if(!d){return(f)
}var b=[];
for(var c=0;
c<f.length;
c++){var a=f[c].match(/^uc_color/)?"color":f[c].match(/^uc_font/)?"font":"common";
if(a==d){b.push(f[c])
}}return(b)
},getUserSettingData:function(d,a){var c={};
if(!d){d=user.sqlrow
}if(!a){a=User.admin.Utils.getUserSettingFields()
}for(var b=0;
b<a.length;
b++){c[a[b]]=d[a[b]]
}return(c)
}});
function userConfig(){if(login_table()=="users"){editIndirectRecord("User.admin.Grid",user.sqlrow.id*1,{userConfig:true,editRecordText:findLangSd("title","userConfiguration")})
}else{var f={userConfig:true,editRecordText:findLangSd("title","userConfiguration")};
var d=Ext.create("User.admin.Grid",Ext.apply({enableAutoLoad:false,withoutGrid:true,skipStoreInSaveRecord:true},f));
var b=d.store.proxy.reader.readRecords({results:[{}],total:1});
if(b.records.length){var a=b.records[0];
for(var c in user.sqlrow){a.data[c]=user.sqlrow[c]
}d.prepareDataForEdit(a.data);
d.createEditWindow(0,null,{record:a,onSubmitSuccess:function(g){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveUserConfigurationForCustomLogin",params:Ext.encode({data:User.admin.Utils.getUserSettingData()})}})
}})
}}}Ext.define("User.admin.ScreenPopupUsers.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"ScreenPopupUsersStore",url:"php/model/sql.php",module:"screen_popup_users",recordStruct:rsScreenPopupUsers,sortField:"name",remoteSort:true,columns:[{dataIndex:"username",widthCh:20},{dataIndex:"name",widthCh:30},{dataIndex:"dest_number",widthCh:20},{dataIndex:"allow_change_settings",widthCh:18,renderer:renderTick},{dataIndex:"profile_name",widthCh:30}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true,msgTarget:"side"},fpItems:[{name:"username",allowBlank:false},{name:"name",allowBlank:false},{inputType:"password",name:"password"},{name:"dest_number",vtype:"testRegExp"},{xtype:"checkbox",name:"allow_change_settings"},{xtype:"CBX_ScreenPopupProfile",name:"profile_id",_clearButton:true,_autoDisableIfEmpty:true},{xtype:"textarea",name:"description",heightL:3}],propRecordText:function(b){return(b.name)
},enableEdit:true,enableSearchX:true,titleLang:"screenPopupUsersTab",subsystem:"user_admin",subjectLang:"user",stripeRows:false});
this.callParent([a])
},getDefaultValues:function(a){return({})
}});
Ext.define("User.admin.ScreenPopupProfile.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"ScreenPopupProfileStore",url:"php/model/sql.php",module:"screen_popup_profile",recordStruct:rsScreenPopupProfile,sortField:"name",remoteSort:true,columns:[{dataIndex:"name",widthCh:20},{dataIndex:"auto_popup",widthCh:10,renderer:renderTick},{dataIndex:"popup_on",widthCh:14,renderer:renderArrayData,arrayData:arScreenPopupOn},{dataIndex:"non_numeric_caller_id",widthCh:18,renderer:renderTick},{dataIndex:"app_launch",widthCh:40,renderer:b,sortable:false}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:26,disableAutoAddTriggerWidth:true,msgTarget:"side"},fpItems:[{name:"name",allowBlank:false},{xtype:"checkbox",name:"auto_popup"},{xtype:"checkbox",name:"show_ip"},{xtype:"ComboBoxA",name:"popup_on",aData:arScreenPopupOn,_stringValue:true,widthCh:20},{xtype:"checkbox",name:"non_numeric_caller_id"},{xtype:"textarea",name:"regex_calling_number",vtype:"testScreenPopupProfile_regex_calling_number"},{xtype:"textarea",name:"src_ip_whitelist"},{xtype:"textarea",name:"src_ip_blacklist"},{name:"app_launch"},{xtype:"textarea",name:"app_launch_args_or_url",heightL:3},{xtype:"textarea",name:"status_line",heightL:3},{name:"popup_title"},{xtype:"textarea",name:"description",fieldLabelLang:"Description",heightL:3}],propRecordText:function(c){return(c.name)
},enableEdit:true,enableSearchX:true,titleLang:"screenPopupProfileTab",subjectLang:"profile",subsystem:"user_admin",stripeRows:false});
this.callParent([a]);
function b(k,f,d,l,h,g,c){return((d.data.app_launch+" "+d.data.app_launch_args_or_url).trim())
}},getDefaultValues:function(a){return({auto_popup:true,popup_on:"200",non_numeric_caller_id:false})
},onChangeRecords:function(a,b){if(a=="update"){this._panel.usersGrid.reload()
}},setContextItems:function(a,d,f,h,g,c,b){this.enableField("show_ip",!d.auto_popup)
}});
Ext.define("User.admin.ScreenPopupUsers.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.screen_popup_usersPanelX",constructor:function(a){this.usersGrid=new User.admin.ScreenPopupUsers.Grid({_panel:this});
this.profileGrid=new User.admin.ScreenPopupProfile.Grid({_panel:this});
a=Ext.applyIf(a||{},{id:"screen_popup_users-panel",iconCls:"icon_menu_user",layout:"fit",items:{xtype:"tabpanel",items:[this.usersGrid,this.profileGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"screen_popup_users",subsystem:"user_admin"});
this.callParent([a])
}});
Ext.ns("Cust");
Ext.define("Cust.Customers.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Cust.Customers.GridX",constructor:function(d){var f=[{dataIndex:"name",widthCh:45},{dataIndex:"username",widthCh:20,renderer:l}];
var a=[{name:"name",allowBlank:false},{name:"username",widthCh:20},{name:"password",widthCh:20,inputType:"password"}];
switch(d.evidType){case"resellers":f.push({dataIndex:"vat",widthCh:20});
a.push({name:"vat"});
break;
case"customers":f.push({dataIndex:"vat",headerLang:"vat_or_id",widthCh:20,renderer:b});
a.push({name:"vat"},{name:"cust_id"});
if(!d.level){f.push({dataIndex:"reseller_name",widthCh:20});
a.push({name:"reseller_id",xtype:"CBX_custReseller",_clearButton:true,_autoDisableIfEmpty:true})
}break
}f.push({dataIndex:"address",widthCh:35});
a.push({name:"address",xtype:"textarea"});
switch(d.evidType){case"customers":case"subsidiaries":a.push({name:"ip",xtype:"textarea"},{name:"number",xtype:"textarea"},{name:"enable_ip_detail",xtype:"checkbox"},{name:"enable_ip_detail_for_reseller",xtype:"checkbox"});
break
}switch(d.evidType){case"resellers":Ext.applyIf(d,{storeId:"CustResellerStore",module:"cust_resellers",recordStruct:rsCustResellers,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Cust.Customers.GridExpPanel",rowBodyContentConfig:{level:d.level||1},expandOnEnter:false,expandOnDblClick:false}],pageSize:30,paginatorPrependButtons:true,paginatorDisplayInfo:false,enableSearchX:true,subjectLang:"reseller"});
break;
case"customers":Ext.applyIf(d,{storeId:"CustCustomerStore",module:"cust_customers",recordStruct:rsCustCustomers,extraParams:{without_subsidiaries:true},plugins:[{ptype:"rowexpander",rowBodyContentCls:"Cust.Customers.GridExpPanel",rowBodyContentConfig:{level:d.level||1},expandOnEnter:false,expandOnDblClick:false,noVerticalScroller:d.level}],pageSize:d.level?15:30,paginatorPrependButtons:true,paginatorDisplayInfo:false,enableSearchX:true,subjectLang:"customer"});
if(d.relFields&&d.relFields.reseller_id){d.insertMenu=[{text:langS.cust.createNewCustomer,handler:g,scope:this},{text:langS.cust.linkExistCustomer,handler:c,scope:this}];
d.deleteMenu=[{text:langS.cust.deleteCustomer,handler:k,scope:this},{text:langS.cust.unlinkCustomerFromReseller,handler:h,scope:this}]
}if(!d.level){d.multiSelect=true
}break;
case"subsidiaries":Ext.applyIf(d,{storeId:"CustSubsidiariesStore",module:"cust_customers",recordStruct:rsCustCustomers,subjectLang:"subsidiary"});
break
}if(window.typeCustomersTables=="users"){if(!d.relFields){d.relFields={}
}switch(d.evidType){case"resellers":d.relFields.type_rec="reseller";
break;
case"customers":case"subsidiaries":d.relFields.type_rec="customer";
break
}}if(d.level>1){Ext.applyIf(d,{fullColumnSize:"address",fullColumnSizeDecrement:2})
}Ext.applyIf(d,{url:"php/model/sql.php",sortField:"name",remoteSort:true,columns:f,fpDefaults:{xtype:"textfield",widthCh:35,labelCh:15},fpItems:a,enableEdit:true,prefixCls:"cust_"+d.evidType,subsystem:"cust",stripeRows:false});
this.callParent([d]);
function l(r,o,n,s,q,p,m){return(n.data.exist_password?r:renderStringStyle(r,{color:"grey"}))
}function b(r,o,n,s,q,p,m){return(r||n.data.cust_id)
}function g(){this.createEditWindow(1)
}function c(){this.createEditWindow(1,null,{fpItems:[{name:"customer_id",xtype:"CBX_custCustomer",allowBlank:false,extraParams:{without_subsidiaries:true,without_resellers:true},_autoDisableIfEmpty:true}],saveRecord:function(){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"link_reseller",customer_id:this.getField("customer_id").getValue(),reseller_id:this.relFields.reseller_id,get_row:true},success:function(m){this._addRecord(m.data);
this.formPanel.editWindow.destroy()
},scope:this})
}})
}function k(){this.confirmDeleteRule()
}function h(){if(this.selModel.getCount()){var m=this.selModel.getSelection()[0]
}else{return
}Ext.Msg.confirm(lang.questionText,lang.confirmUnlinkRuleSingleText,function(n){if(n=="yes"){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"unlink_reseller",customer_id:m.data.id},success:function(o){this._removeRecord(m)
},scope:this})
}},this)
}},propRecordText:function(a){return(a.name)
},contextMenu:function(){var d=this.selModel.getSelection();
if(!d||!d.length){return(null)
}var c=[];
for(var b=0;
b<d.length;
b++){c.push(d[b].data.id)
}var a=[];
if(!this.level&&this.evidType=="customers"){if(this.existFreeResellerIdInSelection(d)){a.push({text:langS.cust.linkSelectCustomersToReseller,handler:function(){this.onLinkSelectCustomersToReseller(d,c)
},scope:this})
}if(this.existResellerIdInSelection(d)){a.push({text:langS.cust.unlinkSelectCustomersFromReseller,handler:function(){this.onUnlinkSelectCustomersFromReseller(d,c)
},scope:this})
}}if(this.existPasswordInSelection(d)){a.push({text:langS.cust.removePasswordFromSelect,handler:function(){this.onRemovePasswordFromSelect(d,c)
},scope:this})
}return(a)
},onLinkSelectCustomersToReseller:function(b,a){this.createEditWindow(1,null,{fpItems:[{name:"reseller_id",xtype:"CBX_custReseller",allowBlank:false,extraParams:{without_subsidiaries:true,without_resellers:true},_autoDisableIfEmpty:true}],saveRecord:function(){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"link_reseller",reseller_id:this.getField("reseller_id").getValue(),customer_id:Ext.encode(a)},success:function(c){this.formPanel.editWindow.destroy();
this.reload()
},scope:this})
}})
},onUnlinkSelectCustomersFromReseller:function(b,a){Ext.Msg.confirm(lang.questionText,b.length>1?lang.confirmUnlinkRuleMultipleText:lang.confirmUnlinkRuleSingleText,function(c){if(c=="yes"){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"unlink_reseller",customer_id:Ext.encode(a)},success:function(d){this.reload()
},scope:this})
}},this)
},onRemovePasswordFromSelect:function(b,a){Ext.Msg.confirm(lang.questionText,b.length>1?lang.confirmRemovePasswordRuleMultipleText:lang.confirmRemovePasswordRuleSingleText,function(c){if(c=="yes"){ajaxSafeRequest({url:"php/model/sql.php",params:{module:this.module,task:"remove_password",customer_id:Ext.encode(a)},success:function(d){this.reload()
},scope:this})
}},this)
},existResellerIdInSelection:function(b){for(var a=0;
a<b.length;
a++){if(b[a].data.reseller_id){return(true)
}}return(false)
},existFreeResellerIdInSelection:function(b){for(var a=0;
a<b.length;
a++){if(!b[a].data.reseller_id){return(true)
}}return(false)
},existPasswordInSelection:function(b){for(var a=0;
a<b.length;
a++){if(b[a].data.exist_password){return(true)
}}return(false)
},setContextItems:function(g,f,c,l,d,b,h){if(this.evidType=="customers"){var a=this.getField("vat");
var k=this.getField("cust_id");
if(a){a.enableIf(!f.cust_id||f.vat&&f.cust_id)
}if(k){k.enableIf(!f.vat||f.vat&&f.cust_id)
}}},onChangeRecords:function(a,b,c){if(this.evidType=="customers"){refreshCustomers("customers")
}}});
Ext.define("Cust.Customers.GridExpPanel",{extend:"Ext.Panel",constructor:function(b){var a=[];
switch(b.grid.evidType){case"resellers":this.customers=new Cust.Customers.Grid({evidType:"customers",relFields:{reseller_id:b.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:lang.customers,level:b.level+1});
a.push(this.customers);
break;
case"customers":this.subsidiaries=new Cust.Customers.Grid({evidType:"subsidiaries",relFields:{customer_id:b.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},title:lang.subsidiaries,level:b.level+1});
a.push(this.subsidiaries);
break
}this.tabPanel=new Ext.TabPanel({items:a,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:b.grid.prefixCls+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(b,{items:this.tabPanel,border:false});
this.callParent([b])
}});
Ext.define("Cust.Resellers.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Cust_resellersPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"Cust_resellers-panel",gridXType:"Cust.Customers.GridX",gridConfig:{evidType:"resellers"},titleLang:"resellers",subsystem:"cust"});
this.callParent([a])
}});
Ext.define("Cust.Customers.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.Cust_customersPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"Cust_customers-panel",gridXType:"Cust.Customers.GridX",gridConfig:{evidType:"customers"},titleLang:"resellers",subsystem:"cust"});
this.callParent([a])
}});
function refreshCustomers(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshCustomers",params:Ext.encode({typeTable:a})},success:function(){},error:function(){}})
}Ext.ns("Filter");
Ext.define("Filter.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Filter.GridX",subsystem:"capture_rules",constructor:function(d){var q=this;
this.onOffGlobalItems=["script","skip","rtp","rtcp","sip","graph","wav","register","dtmf","hide_message","spool_2"];
this.onOffItems=[];
var g=[[1,"ON"],[0,"OFF"]];
var r=[[1,"ON"],[0,"OFF"],[-1,"global"]];
var n=[[1,"ON"],[2,"WAV"],[3,"OGG"],[0,"OFF"],[-1,"global"]];
var k=[[1,"ON"],[2,"db only"],[3,"pcap only"],[0,"OFF"],[-1,"global"]];
var p=[[1,"ON"],[2,"header"],[0,"OFF"],[-1,"global"]];
var c=[[0,"OFF"],[1,"Source MOS"],[2,"Destination MOS"],[3,"Both MOS"]];
var o=0;
var a=-1;
var f=0;
var h=[];
var b=[];
switch(d.filterType){case"ip":h.push({dataIndex:"ip",widthCh:40,sortable:true,renderer:l});
b.push({name:"ip",allowBlank:false,enableKeyEvents:true,vtype:"testIP",enableIP_0:true},{xtype:"numberfield",name:"mask",_width:__width_FieldNum(3)+__width_Trigger,minValue:0,maxValue:32,allowDecimals:false,step:1});
d=Ext.applyIf(d||{},{storeId:"Filter.ipStore",url:"php/model/sql.php",module:"filter_ip",recordStruct:rsFilterIp,sortField:"ip"});
break;
case"telnum":h.push({dataIndex:"prefix",widthCh:20,sortable:true});
b.push({name:"prefix",allowBlank:false,blankText:lang.requirefield,widthChar:15});
d=Ext.applyIf(d||{},{storeId:"Filter.telnumStore",url:"php/model/sql.php",module:"filter_telnum",recordStruct:rsFilterTelnum,sortField:"prefix"});
break;
case"domain":h.push({dataIndex:"domain",widthCh:30,sortable:true});
b.push({name:"domain",allowBlank:false,blankText:lang.requirefield,widthChar:30});
d=Ext.applyIf(d||{},{storeId:"Filter.domainStore",url:"php/model/sql.php",module:"filter_domain",recordStruct:rsFilterDomain,sortField:"domain"});
break;
case"sip_header":var m=[["strict","strict"],["prefix","prefix"],["regexp","regular expression"]];
h.push({dataIndex:"header",widthCh:30,sortable:true},{dataIndex:"content",widthCh:30,sortable:true},{dataIndex:"content_type",widthCh:15,sortable:false,renderer:renderArrayData,arrayData:m});
b.push({name:"header",allowBlank:false,blankText:lang.requirefield,widthChar:30},{name:"content",allowBlank:false,blankText:lang.requirefield,widthChar:30,checkAfterKeyEvent:true},{name:"content_type",allowBlank:false,blankText:lang.requirefield,widthChar:15,xtype:"ComboBoxA",aData:m});
d=Ext.applyIf(d||{},{storeId:"Filter.sipHeaderStore",url:"php/model/sql.php",module:"filter_sip_header",recordStruct:rsFilterSipHeader,sortField:"header"});
break
}h.push({dataIndex:"sensors_id",widthCh:20,renderer:function(y,u,t,z,w,v,s){return(q.renderSensors(y))
}});
b.push({xtype:"CBX_sensor",name:"sensors_id",_width:__width_FieldChar(35)-__width_Trigger,_sensorIdWidth:7,_nameWidth:26,_addEmptySensorId:true,_multiSelect2:true,_hideEmptyIfNotNeed:true,_hideAllIfNotNeed:this.defaultSensorId!=_sensorId_all,_evSelectMode2:true,_clearButton:true,selectRenderer:function(s){if(s.getCount()){return(q.renderSensors(s))
}else{return("")
}}});
h.push({dataIndex:"skip",widthCh:13,renderer:renderCheckBoxNull},{dataIndex:"rtp",widthCh:13,renderer:renderCheckBoxNullArrayData,arrayData:p},{dataIndex:"rtcp",widthCh:13,renderer:renderCheckBoxNull},{dataIndex:"sip",widthCh:13,renderer:renderCheckBoxNull},{dataIndex:"graph",widthCh:13,renderer:renderCheckBoxNull},{dataIndex:"wav",widthCh:13,renderer:renderCheckBoxNullArrayData,arrayData:n},{dataIndex:"register",widthCh:15,renderer:renderCheckBoxNull},{dataIndex:"dtmf",widthCh:15,renderer:renderCheckBoxNullArrayData,arrayData:k},{dataIndex:"script",widthCh:13,renderer:renderCheckBoxNull});
if(existsMosLqoCdr){h.push({headerLang:"mos_lqo_short",dataIndex:"mos_lqo",widthCh:13,renderer:renderArrayData,arrayData:c})
}h.push({dataIndex:"hide_message",widthCh:13,renderer:renderCheckBoxNull},{dataIndex:"spool_2",widthCh:23,renderer:renderCheckBoxNull},{dataIndex:"remove_at",renderer:renderDateTime,width:__width_ColumnChar(13)},{dataIndex:"no_permanent",renderer:renderCheckBox,showInvState:true},{headerLang:"deletetime",dataIndex:"changed_at",renderer:calcRemoveTime},{dataIndex:"note",widthCh:40});
if(d.filterType!="sip_header"){b.push({xtype:"ComboBoxA",name:"direction",aData:[[0,"Both"],[1,"Source"],[2,"Destination"]],editable:false,value:0,widthChar:15})
}b.push({xtype:"ComboBoxA",name:"skip",aData:r,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"rtp",aData:p,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"rtcp",aData:r,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"sip",aData:r,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"graph",aData:r,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"wav",aData:n,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"register",aData:r,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"dtmf",aData:k,editable:false,value:a,widthChar:10},{xtype:"ComboBoxA",name:"script",aData:r,editable:false,value:a,widthChar:7});
if(existsMosLqoCdr){b.push({xtype:"ComboBoxA",name:"mos_lqo",aData:c,editable:false,value:f,widthChar:14})
}b.push({xtype:"ComboBoxA",name:"hide_message",aData:r,editable:false,value:a,widthChar:7},{xtype:"ComboBoxA",name:"spool_2",disabled:(existsCdrNextSpoolIndex?"":"disabled"),aData:r,editable:false,value:a,widthChar:7},{xtype:"datetimefield",name:"remove_at"},{xtype:"checkbox",name:"no_permanent"},{xtype:"displayfield",name:"deletetime"},{xtype:"textarea",name:"note"});
Ext.applyIf(d,{remoteSort:true,groupField:"sensors",features:[{ftype:"grouping",groupHeaderTpl:"{name}",disabled:true}],columns:h,fpDefaults:{xtype:"textfield",widthCh:35,labelCh:20,msgTarget:"side"},fpItems:b,propRecordText:function(s){switch(this.filterType){case"ip":return(ip_mask_text(s.ip,s.mask));
case"telnum":return(s.prefix);
case"domain":return(s.domain);
case"sip_header":return(s.header)
}return(null)
},getDefaultValues:function(){var s={};
switch(this.filterType){case"ip":break;
case"sip_header":Ext.apply(s,{content_type:"strict"})
}if(!user_is_admin()&&crules_remove_expire_time()){s.no_permanent=1
}return(s)
},prepareDataForEdit:function(t){for(var s=0;
s<this.onOffGlobalItems.length;
s++){if(t[this.onOffGlobalItems[s]]===null){t[this.onOffGlobalItems[s]]=-1
}}for(var s=0;
s<this.onOffItems.length;
s++){if(t[this.onOffItems[s]]===null){t[this.onOffItems[s]]=0
}}t.no_permanent=!t.no_permanent;
var u=new Date(t.changed_at);
if(isNaN(u.getTime)||u.getTime()==0){u=new Date()
}u.setTime(u.getTime()+(crulesRemoveExpireTimeGlobal*3600*1000));
t.deletetime=Ext.Date.format(u,__format_DateTimeDb)
},prepareDataForSave:function(t){for(var s=0;
s<this.onOffGlobalItems.length;
s++){if(t[this.onOffGlobalItems[s]]===-1){t[this.onOffGlobalItems[s]]=null
}}for(var s=0;
s<this.onOffItems.length;
s++){if(!t[this.onOffItems[s]]){t[this.onOffItems[s]]=null
}}switch(this.filterType){case"ip":break;
case"telnum":if(t.prefix&&t.prefix.trim){t.prefix=t.prefix.trim()
}break;
case"domain":if(t.domain&&t.domain.trim){t.domain=t.domain.trim()
}break;
case"sip_header":if(t.header&&t.header.trim){t.header=t.header.trim()
}if(t.content&&t.content.trim){t.content=t.content.trim()
}break
}t.no_permanent=!t.no_permanent
},onCancel:function(){if(this.formPanel.editRecord){if(!this.formPanel.rollbackEditData){this.prepareDataForSave(this.formPanel.editRecord.data);
this.formPanel.rollbackEditData=true
}}},onWindowClose:function(s){if(!s){if(this.formPanel.editRecord){if(!this.formPanel.rollbackEditData){this.prepareDataForSave(this.formPanel.editRecord.data);
this.formPanel.rollbackEditData=true
}}}},enableEdit:true,enableSearchX:true,tbar:[{text:this.findLangS("button","reloadSniffer"),iconCls:"icon_menu_reload",_btnId:"reload_vm",menu:[]},"-"],nextStdBar:[{text:this.findLangS("button","grouping_by_sensors"),pressed:false,enableToggle:true,toggleHandler:this.toggleGrouping,scope:this}],listeners:{scope:this,afterrender:this.loadSensors}});
this.callParent([d]);
function l(y,u,t,z,w,v,s){return(ip_mask_text(y,t.data.mask))
}},loadSensors:function(){var a=this;
Settings.SensorTable.Utils.loadSensors({task:"setBtnMenuReload",btnId:"reload_vm",maskEl:this,panel:this,evBeforeRun:function(){a.hideInfoPanel()
}})
},onChangeRecords:function(a,b,c){this.deferReloadVM()
},onChangeRecordsBeforeRender:function(a,b,c){b.sensors=this.renderSensors(b.sensors_id,true)||(" "+this.findLangS("text","all_sensors"))
},setContextItems:function(f,d,b,k,c,a,g){if(this.filterType=="ip"){if(k&&k.name=="ip"){var h=ip_is_v6(this.getValueField("ip"));
var l=this.getField("mask");
l.maxValue=h?128:32;
l.setFieldLabel(this.findLangS("field",h?"maskV6":"mask"))
}}if(this.filterType=="sip_header"){this.getField("content").vtype=d.content_type=="regexp"?"testRegExp":undefined;
if(k&&k.name=="content_type"&&b=="select"){this.formPanel.getForm().isValid()
}}this.allowBlankField("remove_at",user_is_admin()||!crules_remove_expire_time());
this.showField("no_permanent",user_is_admin()||!crules_remove_expire_time());
this.showField("deletetime",crulesRemoveExpireTimeGlobal&&!d.no_permanent)
},testValidRecord:function(b,h,g,l){if(this.filterType=="telnum"&&b.prefix&&b.prefix.match&&b.prefix.match("%")){Ext.Msg.alert(lang.errorText,this.findLangS("text","alertNoWildcardsInPrefix"));
return(false)
}if(b.rtp==1&&b.wav==1){Ext.Msg.confirm(lang.questionText,this.findLangS("text","questionSaveSetRtpWav"),function(n){if(n=="yes"){l.call(this,true)
}},this);
return(false)
}var d=crules_remove_expire_time();
if(d&&d>0){var f=(new Date(b.remove_at)).getTime()/1000;
if(!f){Ext.Msg.alert("Error","You must set the expiration date.",Ext.emptyFn);
return(false)
}var c=(new Date()).getTime()/1000;
if(((f-c)/60)>d){var m=parseInt(d/60/24);
var k=parseInt((d-(m*60*24))/60);
var a=d-(k*60)-(m*60*24);
Ext.Msg.alert("Error","You can set the expiration date max "+m+" days "+k+" hours "+a+" mins to the future.",Ext.emptyFn);
return(false)
}}return(true)
},deferReloadVM:function(b){this.hideInfoPanel();
var c=this;
var a=this.ownerCt;
var f=a.infoPanel;
var d=60+1;
this.realoadVM_timerTask=Ext.TaskManager.start({run:function(){--d;
var g=f.findC("_id","reload");
if(g){g.setText(lang.reload+" ("+d+"s)")
}if(!d){c.hideInfoPanel();
c.doReloadVM()
}},interval:1000});
f.add({xtype:"panel",layout:{type:"hbox",padding:5,pack:"center",align:"middle"},items:[{xtype:"displayfield",value:this.findLangS("text","realoadSnifersQuestionAfterChange"),style:{paddingTop:2}},{xtype:"container",width:10},{xtype:"button",text:lang.reload,handler:function(){c.hideInfoPanel();
c.doReloadVM()
},_id:"reload"},{xtype:"container",width:4},{xtype:"button",text:lang.skipButtonText,handler:function(){c.hideInfoPanel()
},_id:"skip"}],border:false,bodyStyle:{"background-color":__color_FormBackground}});
f.show()
},doReloadVM:function(){var a=this;
Settings.SensorTable.Utils.reloadVm("all",{evResult:function(b){a.showResultReloadVM(b)
},evBeforeRun:function(){a.hideInfoPanel();
var b=a.ownerCt;
var c=b.infoPanel;
c.add({xtype:"panel",layout:{type:"hbox",padding:5,pack:"center",align:"middle"},items:{xtype:"displayfield",value:lang.reloading+"..."},border:false,bodyStyle:{"background-color":__color_FormBackground}});
c.show()
},evFailed:function(){a.hideInfoPanel()
},btnId:"reload_vm",panel:this})
},showResultReloadVM:function(b){this.hideInfoPanel();
var c=this;
var a=this.ownerCt;
var f=a.infoPanel;
var d=30+1;
this.realoadVM_timerTask=Ext.TaskManager.start({run:function(){--d;
var g=f.findC("_id","ok");
if(g){g.setText(lang.OK+" ("+d+"s)")
}if(!d){c.hideInfoPanel()
}},interval:1000});
f.add({xtype:"panel",layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",items:{layout:"fit",xtype:"panel",html:"<b><i>"+this.findLangS("text","reloadingResult")+" ("+this.findLangS("text","clickHereForKeep")+"):</i></b><br><br>"+b,border:false,bodyStyle:{"background-color":__color_FormBackground}},flex:1,autoScroll:true,padding:5,border:false,bodyStyle:{"background-color":__color_FormBackground}},{xtype:"button",text:lang.OK,handler:function(){c.hideInfoPanel()
},margin:5,_id:"ok"}],border:false,bodyStyle:{"background-color":__color_FormBackground},listeners:{afterrender:function(g){g.body.on("click",function(){if(c.realoadVM_timerTask){c.stopReloadVM_timerTask();
var h=f.findC("_id","ok");
if(h){h.setText(lang.OK)
}}})
},afterlayout:function(g){var h=a.getHeight()/5;
if(g.getHeight()>h){g.setHeight(h);
g.updateLayout()
}}}});
f.show()
},hideInfoPanel:function(){this.stopReloadVM_timerTask();
var a=this.ownerCt;
var b=a.infoPanel;
b.removeAll();
b.hide()
},stopReloadVM_timerTask:function(){if(this.realoadVM_timerTask){Ext.TaskManager.stop(this.realoadVM_timerTask);
delete this.realoadVM_timerTask
}},onStoreLoadBeforeRenders:function(c,b,g,f){if(f&&f._response&&f._response.responseText){var a=Ext.decode(f._response.responseText);
if(a){this.sensors=a.sensors
}}for(var d=0;
d<b.length;
d++){b[d].data.sensors=this.renderSensors(b[d].data.sensors_id,true)||(" "+this.findLangS("text","all_sensors"))
}},renderSensors:function(k,h){var c=[];
if(Ext.isNumber(k)){c.push(k)
}else{if(Ext.isString(k)){var b=k.split(",");
if(b&&b.length){for(var d=0;
d<b.length;
d++){if(b[d]*1!=0){c.push(b[d]*1)
}}}}else{if(k&&k.getCount&&k.getAt){for(var d=0;
d<k.getCount();
d++){var g=k.getAt(d).data;
c.push(g)
}}}}if(c.length){for(var d=0;
d<c.length;
d++){var f=Ext.isNumber(c[d])?this.getSensorData(c[d]):c[d];
if(f){if(f.id==_sensorId_empty||f.id_sensor==_sensorId_empty){f=this.getSensorData(_sensorId_empty)
}}c[d]=f
}c.sort(function(m,l){return(m.id_sensor-l.id_sensor)
});
var a="";
for(var d=0;
d<c.length;
d++){var f=c[d];
if(f){if(a){a+=", "
}if(f.id==_sensorId_empty||f.id_sensor==_sensorId_empty){f=this.getSensorData(_sensorId_empty);
a+=f.name
}else{a+=f.id_sensor;
if(c.length==1||h){a+=" "+f.name
}}}}return(a)
}return("")
},getSensorData:function(a){if(a==_sensorId_empty){return({id:_sensorId_empty,id_sensor:_sensorId_empty,name:"local"})
}else{if(this.sensors){for(var b=0;
b<this.sensors.length;
b++){if(this.sensors[b].id==a){return(this.sensors[b])
}}}}return(null)
},toggleGrouping:function(a,c){var b=this.view.findFeature("grouping");
if(b){this.store.setRemoteSort(!c);
b[c?"enable":"disable"]()
}}});
Ext.define("Filter.ip.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.filter_ipPanelX",subsystem:"capture_rules",constructor:function(a){this.filter=new Filter.Grid({filterType:"ip",flex:1});
this.infoPanel=new Ext.Panel({hidden:true,border:false});
a=Ext.applyIf(a||{},{id:"filter_ip-panel",iconCls:"icon_menu_fw",layout:{type:"vbox",align:"stretch"},items:[this.filter,this.infoPanel],titleLang:"ip",wikiId:"Capture_rules"});
this.callParent([a])
},reactivate:function(){this.filter.reload();
this.filter.loadSensors()
},changeTimezone:function(){this.reactivate()
}});
Ext.define("Filter.telnum.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.filter_telnumPanelX",subsystem:"capture_rules",constructor:function(a){this.filter=new Filter.Grid({filterType:"telnum",flex:1});
this.infoPanel=new Ext.Panel({hidden:true,border:false});
a=Ext.applyIf(a||{},{id:"filter_telnum-panel",iconCls:"icon_menu_fw",layout:{type:"vbox",align:"stretch"},items:[this.filter,this.infoPanel],titleLang:"telnum",wikiId:"Capture_rules"});
this.callParent([a])
},reactivate:function(){this.filter.reload();
this.filter.loadSensors()
},changeTimezone:function(){this.reactivate()
}});
Ext.define("Filter.domain.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.filter_domainPanelX",subsystem:"capture_rules",constructor:function(a){this.filter=new Filter.Grid({filterType:"domain",flex:1});
this.infoPanel=new Ext.Panel({hidden:true,border:false});
a=Ext.applyIf(a||{},{id:"filter_domain-panel",iconCls:"icon_menu_fw",layout:{type:"vbox",align:"stretch"},items:[this.filter,this.infoPanel],titleLang:"domain",wikiId:"Capture_rules"});
this.callParent([a])
},reactivate:function(){this.filter.reload();
this.filter.loadSensors()
},changeTimezone:function(){this.reactivate()
}});
Ext.define("Filter.sip_header.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.filter_sip_headerPanelX",subsystem:"capture_rules",constructor:function(a){this.filter=new Filter.Grid({filterType:"sip_header",flex:1});
this.infoPanel=new Ext.Panel({hidden:true,border:false});
a=Ext.applyIf(a||{},{id:"filter_sip_header-panel",iconCls:"icon_menu_fw",layout:{type:"vbox",align:"stretch"},items:[this.filter,this.infoPanel],titleLang:"sip_header",wikiId:"Capture_rules"});
this.callParent([a])
},reactivate:function(){this.filter.reload();
this.filter.loadSensors()
},changeTimezone:function(){this.reactivate()
}});
Ext.ns("Alerts");
Ext.ns("Alerts.Sended");
Ext.define("Alerts.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Alerts.GridX",subsystem:"alerts_daily_reports",enableRegisterMainFilter:false,constructor:function(c){var d=15;
var k=__width_FieldChar(d);
var f=this;
c=Ext.applyIf(c||{},{storeId:"Alerts",url:"php/model/sql.php",module:"alerts",recordStruct:rsAlerts,sortField:"descr",remoteSort:true,columnsDefaults:{renderer:b},columns:[{dataIndex:"descr",widthCh:20},{dataIndex:"alert_type",widthCh:25,renderer:renderArrayData,renderer2:b,arrayData:arAlertType},{header:this.findLangS("field","every")+" ["+lang.minuteShort2+"]",dataIndex:"every_min",widthCh:10,align:"right",sortable:false},{dataIndex:"note",widthCh:50},{header:this.lastRunAtText,dataIndex:"last_run_at",renderer:renderDateTime,width:__width_ColumnDateTime}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:d,disableAutoAddTriggerWidth:true},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"checkFillCb",ajaxParamsEnable:function(){return(!this.lastAjaxParams||this.lastAjaxParams.time<(new Date).getTime()-10*60*1000)
},fpItems:function(U,L,I,V){if(U.bypassAjaxParams){U=cloneObject(this.lastAjaxParams.ajaxParams)
}else{this.lastAjaxParams={time:(new Date).getTime(),ajaxParams:cloneObject(U)}
}var T=__width_FormChar(d,35)*2+__width_Scroller;
var m=[[0,"min"],[1,"caller"],[2,"called"],[3,"by_rtp_ip"]];
for(var ac=0;
ac<m.length;
ac++){m[ac][1]=this.findLangS("combomenu",m[ac][1])
}var K=[[0,"max"],[1,"caller"],[2,"called"],[3,"by_rtp_ip"]];
for(var ac=0;
ac<K.length;
ac++){K[ac][1]=this.findLangS("combomenu",K[ac][1])
}var J=[{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_side",hideLabel:true,aData:m,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}}];
if(existsMosXrCdr){J.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_xr_avg_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_xr_avg_side",hideLabel:true,aData:m,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_xr_min_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_xr_min_side",hideLabel:true,aData:m,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}})
}if(existsMosSilenceCdr){J.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_silence_avg_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_silence_avg_side",hideLabel:true,aData:m,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_silence_min_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_silence_min_side",hideLabel:true,aData:m,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}})
}if(existsMosLqoCdr){J.push({xtype:"textfield",name:"mos_lqo_caller_lt",widthN:5,align:"right"},{xtype:"textfield",name:"mos_lqo_called_lt",widthN:5,align:"right"})
}J.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"packets_lost_perc_gt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"%",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator},flex:1},{xtype:"ComboBoxA",name:"packets_lost_side",hideLabel:true,aData:K,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"jitter_gt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"jitter_side",hideLabel:true,aData:K,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"container",layout:"vbox",items:[{xtype:"ComboBoxA",name:"delay_limit_ge",aData:arDelay,_clearButton:true,widthCh:15},{xtype:"textfield",name:"delay_count_gt",widthN:5,align:"right"}],height:__height_Form(2)-__height_FieldSeparator,widthCh:15},{flex:1,border:false},{xtype:"ComboBoxA",name:"delay_side",hideLabel:true,aData:K,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}});
J.push({xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"silence_gt",widthN:5,align:"right",enableKeyEvents:!existsCdrSilence,listeners:{keyup:function(ad){if(!existsCdrSilence){ad.setValue(null);
Ext.Msg.alert("",findLangS("cdr","text","missingSilenceColumns"))
}}}},{xtype:"displayfield_h16",value:"%",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"silence_end_gt",widthN:5,align:"right",enableKeyEvents:!existsCdrSilence,listeners:{keyup:function(ad){if(!existsCdrSilence){ad.setValue(null);
Ext.Msg.alert("",findLangS("cdr","text","missingSilenceColumns"))
}}}},{xtype:"displayfield_h16",value:"s",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],height:__height_Form(2)-__height_FieldSeparator,widthCh:15},{flex:1,border:false},{xtype:"ComboBoxA",name:"silence_side",hideLabel:true,aData:K,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}});
J.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"clipping_gt",widthN:5,align:"right",enableKeyEvents:!existsCdrSilence,listeners:{keyup:function(ad){if(!existsCdrClipping){ad.setValue(null);
Ext.Msg.alert("",findLangS("cdr","text","missingClippingColumns"))
}}}},{flex:1,border:false},{xtype:"ComboBoxA",name:"clipping_side",hideLabel:true,aData:K,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}});
J.push({xtype:"CBX_cbIpGroups",name:"cb_rtp_ip_groups_id",_clearButton:true,_editTableButton:user_can_edit_codebooks(),width:__width_FormChar(d,34),labelWidth:__width_FieldChar(d)},{xtype:"textarea",name:"rtp_ip",width:__width_FormChar(d,34),labelWidth:__width_FieldChar(d)},{xtype:"container",layout:{type:"table",columns:2},items:[{xtype:"checkbox",name:"one_way",widthCh:2},{xtype:"checkbox",name:"without_stream",labelWidth:__width_FieldChar(10),widthCh:2}],border:false,bodyStyle:__style_FormBackground()},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"occurences_gt_RTP",fieldLabelLang:"occurences_gt",helpInField:true,widthN:5,align:"right"},{xtype:"ComboBoxA",name:"occurences_gt_perc_cond_RTP",fieldLabelLang:"occurences_gt_perc_cond",helpInField:true,aData:["or","and"],_stringValue:true,_aDataDescrIsId:true,width:__width_FieldChar(3)+2+__width_Trigger,style:{marginLeft:4},fieldStyle:{background:__color_FormBackground}},{xtype:"displayfield_h16",value:">:",fieldClass:"x-form-field",style:{marginLeft:4,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"occurences_perc_gt_RTP",fieldLabelLang:"occurences_perc_gt",helpInField:true,widthN:3,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:"%",fieldLabelLang:"occurences_perc_gt",fieldClass:"x-form-field",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"checkbox",boxLabel:this.findLangS("field","occurences_perc_from_all"),name:"occurences_perc_from_all_RTP",fieldLabelLang:"occurences_perc_from_all",hideLabel:true,helpInField:true,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}});
var H=[[0,"SIP"],[1,"Q850"]];
for(var ac=0;
ac<H.length;
ac++){H[ac][1]=this.findLangS("combomenu",H[ac][1])
}var D=[{xtype:"container",_paramsName:"_paramsRTP1",defaultType:"textfield",deferredItems:{xtype:"fieldset",items:J,title:this.findLangS("title","incidentsRules"),width:__width_FormChar(d,36),style:__style_RedukFieldSet()},hidden:true},{xtype:"container",_paramsName:"_paramsSIP_response",defaultType:"textfield",deferredItems:[{name:"last_sip_response_num",widthN:3,onlyNumberContent:false},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"occurences_gt_SIP_response",fieldLabelLang:"occurences_gt",helpInField:true,widthN:5,align:"right"},{xtype:"ComboBoxA",name:"occurences_gt_perc_cond_SIP_response",fieldLabelLang:"occurences_gt_perc_cond",helpInField:true,aData:["or","and"],_stringValue:true,_aDataDescrIsId:true,width:__width_FieldChar(3)+2+__width_Trigger,style:{marginLeft:4},fieldStyle:{background:__color_FormBackground}},{xtype:"displayfield_h16",value:">:",fieldClass:"x-form-field",style:{marginLeft:4,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"occurences_perc_gt_SIP_response",fieldLabelLang:"occurences_perc_gt",helpInField:true,widthN:3,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:"%",fieldLabelLang:"occurences_perc_gt",fieldClass:"x-form-field",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"checkbox",boxLabel:this.findLangS("field","occurences_perc_from_all"),name:"occurences_perc_from_all_SIP_response",fieldLabelLang:"occurences_perc_from_all",hideLabel:true,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsReasonSipQ850",defaultType:"textfield",deferredItems:[{xtype:"ComboBoxA",name:"reason_type",aData:H,widthCh:10},{name:"reason_filter"},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"occurences_gt_ReasonSipQ850",fieldLabelLang:"occurences_gt",helpInField:true,widthN:5,align:"right"},{xtype:"ComboBoxA",name:"occurences_gt_perc_cond_ReasonSipQ850",fieldLabelLang:"occurences_gt_perc_cond",helpInField:true,aData:["or","and"],_stringValue:true,_aDataDescrIsId:true,width:__width_FieldChar(3)+2+__width_Trigger,style:{marginLeft:4},fieldStyle:{background:__color_FormBackground}},{xtype:"displayfield_h16",value:">:",fieldClass:"x-form-field",style:{marginLeft:4,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"occurences_perc_gt_ReasonSipQ850",fieldLabelLang:"occurences_perc_gt",helpInField:true,widthN:3,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:"%",fieldLabelLang:"occurences_perc_gt",fieldClass:"x-form-field",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"checkbox",boxLabel:this.findLangS("field","occurences_perc_from_all"),name:"occurences_perc_from_all_ReasonSipQ850",fieldLabelLang:"occurences_perc_from_all",hideLabel:true,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsCPS",defaultType:"textfield",deferredItems:[{name:"cps_gt",widthN:6}],hidden:true},{xtype:"container",_paramsName:"_paramsDSCP",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","dscp_caller_sip")+":",fieldClass:"x-form-field",width:__width_FieldChar(d),fieldStyle:{"text-align":"right"}},{xtype:"displayfield_h16",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_sip_eq",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_sip_ge",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_sip_lt",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","dscp_called_sip")+":",fieldClass:"x-form-field",width:__width_FieldChar(d),fieldStyle:{"text-align":"right"}},{xtype:"displayfield_h16",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_sip_eq",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_sip_ge",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_sip_lt",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","dscp_caller_rtp")+":",fieldClass:"x-form-field",width:__width_FieldChar(d),fieldStyle:{"text-align":"right"}},{xtype:"displayfield_h16",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_rtp_eq",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_caller_rtp_ge",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"displayfield_h16",name:"dscp_caller_rtp_lt",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","dscp_called_rtp")+":",fieldClass:"x-form-field",width:__width_FieldChar(d),fieldStyle:{"text-align":"right"}},{xtype:"displayfield_h16",value:"=",fieldClass:"x-form-field",style:{marginLeft:5,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_rtp_eq",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:">=",fieldClass:"x-form-field",style:{marginLeft:15,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_rtp_ge",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"dscp_called_rtp_lt",widthN:5,minValue:0,maxValue:63,align:"right",hideLabel:true,enableKeyEvents:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"checkbox",name:"dscp_cond_or",fieldLabel:this.dscpCondOrText,helpText:this.dscpCondOrHelp},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"occurences_gt_DSCP",fieldLabelLang:"occurences_gt",helpInField:true,widthN:5,align:"right"},{xtype:"ComboBoxA",name:"occurences_gt_perc_cond_DSCP",fieldLabelLang:"occurences_gt_perc_cond",helpInField:true,aData:["or","and"],_stringValue:true,_aDataDescrIsId:true,width:__width_FieldChar(3)+2+__width_Trigger,style:{marginLeft:4},fieldStyle:{background:__color_FormBackground}},{xtype:"displayfield_h16",value:">:",fieldLabelLang:"occurences_gt_perc_cond",fieldClass:"x-form-field",style:{marginLeft:4,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"occurences_perc_gt_DSCP",fieldLabelLang:"occurences_perc_gt",helpInField:true,widthN:3,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:"%",fieldLabelLang:"occurences_perc_gt",fieldClass:"x-form-field",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"checkbox",boxLabel:this.findLangS("field","occurences_perc_from_all"),name:"occurences_perc_from_all_DSCP",fieldLabelLang:"occurences_perc_from_all",hideLabel:true,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsASR",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"asr_lt",minValue:1,maxValue:window.develop?101:100,widthN:5,align:"right"},{xtype:"displayfield_h16",value:"%",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"cdr_gt",minValue:window.develop?0:1,maxValue:1000,widthN:5,align:"right"}],hidden:true},{xtype:"container",_paramsName:"_paramsNER",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"ner_lt",minValue:1,maxValue:window.develop?101:100,widthN:5,align:"right"},{xtype:"displayfield_h16",value:"%",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"cdr_gt",minValue:window.develop?0:1,maxValue:1000,widthN:5,align:"right"}],hidden:true},{xtype:"container",_paramsName:"_paramsACD",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"acd_lt",minValue:1,maxValue:3600,widthN:6,align:"right"},{xtype:"displayfield_h16",value:"s",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"cdr_gt",minValue:window.develop?0:1,maxValue:1000,widthN:5,align:"right"}],hidden:true},{xtype:"container",_paramsName:"_paramsInternalProxyError",defaultType:"textfield",deferredItems:[{xtype:"ComboBoxX",name:"ipe_cdr_custom_headers_id",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"cdr_custom_headers",recordStruct:rsCdrCustomHeaders,sortField:"name",columns:[{fields:"name",widthCh:30}],editable:false,allowBlank:false,_infoEmpty:this.findLangS("combobox_emptyinfo","cdr_custom_headers_id")},{name:"ipe_error",widthN:3,allowBlank:false,onlyNumberContent:false},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"occurences_gt_InternalProxyError",fieldLabelLang:"occurences_gt",helpInField:true,widthN:5,align:"right"},{xtype:"ComboBoxA",name:"occurences_gt_perc_cond_InternalProxyError",fieldLabelLang:"occurences_gt_perc_cond",helpInField:true,aData:["or","and"],_stringValue:true,_aDataDescrIsId:true,width:__width_FieldChar(3)+2+__width_Trigger,style:{marginLeft:4},fieldStyle:{background:__color_FormBackground}},{xtype:"displayfield_h16",value:">:",fieldClass:"x-form-field",style:{marginLeft:4,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"occurences_perc_gt_InternalProxyError",fieldLabelLang:"occurences_perc_gt",helpInField:true,widthN:3,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:"%",fieldLabelLang:"occurences_perc_gt",fieldClass:"x-form-field",style:{marginLeft:2,marginRight:__width_FieldSeparator}},{xtype:"checkbox",boxLabel:this.findLangS("field","occurences_perc_from_all"),name:"occurences_perc_from_all_InternalProxyError",fieldLabelLang:"occurences_perc_from_all",hideLabel:true,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsTimeWithoutCall",defaultType:"textfield",deferredItems:[{xtype:"numberfield",name:"time_without_call_minutes",widthN:5,allowBlank:false,minValue:1,maxValue:60*24},{xtype:"checkbox",name:"time_without_call_only_connected"}],hidden:true},{xtype:"container",_paramsName:"_paramsCALL_TIMEDOUT",deferredItems:[{xtype:"checkbox",name:"call_timedout_absolute",labelWidth:__width_FieldChar(20)},{xtype:"checkbox",name:"call_timedout_bye",labelWidth:__width_FieldChar(20)},{xtype:"checkbox",name:"call_timedout_rtp",labelWidth:__width_FieldChar(20)},{xtype:"checkbox",name:"call_timedout_oneway",labelWidth:__width_FieldChar(20)}],hidden:true},{xtype:"container",_paramsName:"_paramsConcurrentCalls",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"concurrent_calls_limit_gt",fieldLabel:this.findLangS("field","concurrent_calls_limit")+" >",labelWidth:__width_FieldChar(20),width:__width_FormChar(20,8),allowBlank:true,minValue:0},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"concurrent_calls_limit_lt",hideLabel:true,width:__width_FieldChar(8),allowBlank:true,minValue:0}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",_id:"concurrent_calls_minutes",items:[{xtype:"numberfield",name:"concurrent_calls_minutes",labelWidth:__width_FieldChar(20),width:__width_FormChar(20,8),allowBlank:false,minValue:10,maxValue:window.develop?60*24:60*4},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}]}],hidden:true},{xtype:"container",_paramsName:"_paramsSensors",defaultType:"textfield",deferredItems:[{xtype:"numberfield",name:"sens_age_last_cdr_gt",widthN:8,minValue:0,maxValue:86400},{xtype:"numberfield",name:"sens_packet_loss_gt",widthN:8,minValue:0,maxValue:1000},{xtype:"numberfield",name:"sens_sqlqueue_size_gt",widthN:8,minValue:0,maxValue:10000},{xtype:"numberfield",name:"sens_memory_res_mb_gt",widthN:8,minValue:0,maxValue:20000},{xtype:"numberfield",name:"sens_calls_gt",widthN:8,minValue:0,maxValue:10000},{xtype:"checkbox",name:"sens_uptime_decrease",widthN:3},{xtype:"CBX_sensor",name:"sens_select_sensors",_addEmptySensorId:true,_addAll:true,allowBlank:false,_multiSelect2:true,_clearButton:true,_listWidth:36},{xtype:"checkbox",name:"sens_always_send_status",widthN:3}],hidden:true}];
D.push({xtype:"container",_paramsName:"_paramsFraudRCC",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","concurrent_calls_limit")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:{type:"table",columns:3},items:[{xtype:"displayfield_h16",value:this.findLangS("field","local"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"displayfield_h16",value:this.findLangS("field","international"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"displayfield_h16",value:this.findLangS("field","both"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"numberfield",name:"fraud_concurent_calls_limit_local",minValue:1,maxValue:90000,hideLabel:true,width:__width_FieldNum(7),align:"right",style:{marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"fraud_concurent_calls_limit_international",minValue:1,maxValue:90000,hideLabel:true,width:__width_FieldNum(7),align:"right",style:{marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"fraud_concurent_calls_limit",minValue:1,maxValue:90000,hideLabel:true,width:__width_FieldNum(7),align:"right"}]}]},{xtype:"ComboBoxA",name:"fraud_rcc_by",aData:[["summary",this.findLangS("combomenu","summary")],["source_ip",this.findLangS("combomenu","source_ip")],["source_number",this.findLangS("combomenu","source_number")],["rtp_stream_ip",this.findLangS("combomenu","rtp_stream_ip")],["rtp_stream_ip_group",this.findLangS("combomenu","rtp_stream_ip_group")]],_stringValue:true,widthCh:20},{xtype:"ComboBoxA",name:"fraud_by_ip_RCC",fieldLabelLang:"fraud_by_ip",aData:[["src",this.findLangS("combomenu","source")],["dst",this.findLangS("combomenu","destination")],["both",this.findLangS("combomenu","both")]],_stringValue:true,widthCh:12}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudD",defaultType:"textfield",deferredItems:[{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield_h16",value:this.findLangS("field","destination_country")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"country_tree",name:"fraud_dest_location",flex:1,height:200}],width:"100%"}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudSPC1",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"fraud_interval_length_SPC",fieldLabelLang:"fraud_interval_length",minValue:1,maxValue:3600,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"fraud_interval_limit_SPC",fieldLabelLang:"fraud_interval_limit",minValue:1,maxValue:10000,widthN:6,align:"right"}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudRC1",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"fraud_interval_length_RC",fieldLabelLang:"fraud_interval_length",minValue:1,maxValue:3600,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"fraud_interval_limit_RC",fieldLabelLang:"fraud_interval_limit",minValue:1,maxValue:10000,widthN:6,align:"right"},{xtype:"checkbox",name:"fraud_register_only_with_response"},{xtype:"ComboBoxA",name:"fraud_rc_by",aData:[["source_ip",this.findLangS("combomenu","source_ip")],["destination_ip",this.findLangS("combomenu","destination_ip")]],_stringValue:true,widthCh:20},{xtype:"container",_id:"fraud_store_pcaps_to_path",layout:{type:"hbox",align:"middle"},items:[{xtype:"checkbox",name:"fraud_store_pcaps",fieldLabel:this.findLangS("field","fraud_store_pcaps")+" ("+this.findLangS("field","fraud_store_pcaps_to_path")+")",_width:20},{xtype:"textfield",name:"fraud_store_pcaps_to_path",emptyText:"spool",hideLabel:true,flex:1}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudSeq",defaultType:"textfield",deferredItems:[{xtype:"checkbox",name:"fraud_filter_international_Seq",fieldLabelLang:"fraud_filter_international_only"},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"fraud_interval_length_Seq",fieldLabelLang:"fraud_interval_length",minValue:1,maxValue:3600,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"fraud_interval_limit_Seq",fieldLabelLang:"fraud_interval_limit",minValue:1,maxValue:10000,widthN:6,align:"right"},{xtype:"ComboBoxA",name:"fraud_by_ip_Seq",fieldLabelLang:"fraud_by_ip",aData:[["src",this.findLangS("combomenu","source")],["dst",this.findLangS("combomenu","destination")],["both",this.findLangS("combomenu","both")]],_stringValue:true,widthCh:12}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudBillQ",defaultType:"textfield",deferredItems:[{xtype:"fieldset",title:this.findLangS("field","only_by"),style:__style_RedukFieldSet(),items:[{xtype:"checkbox",name:"fraud_bill_by_ip"},{xtype:"checkbox",name:"fraud_bill_by_number"},{xtype:"checkbox",name:"fraud_bill_by_domain"}]},{xtype:"fieldset",title:this.findLangS("field","quotas"),style:__style_RedukFieldSet(),items:[{xtype:"numberfield",name:"fraud_bill_quota_hour",minValue:0,maxValue:9999999,widthN:8,align:"right"},{xtype:"numberfield",name:"fraud_bill_quota_day",minValue:0,maxValue:9999999,widthN:8,align:"right"},{xtype:"numberfield",name:"fraud_bill_quota_week",minValue:0,maxValue:9999999,widthN:8,align:"right"},{xtype:"numberfield",name:"fraud_bill_quota_month",minValue:0,maxValue:9999999,widthN:8,align:"right"},{xtype:"checkbox",name:"fraud_bill_quota_summary"}]}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudBillHR",defaultType:"textfield",deferredItems:[{xtype:"numberfield",name:"fraud_bill_limit",minValue:0,maxValue:9999999,widthN:8,align:"right"}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_check_active",defaultType:"textfield",deferredItems:[{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_ok_register_from",fieldLabelLang:"reg_ok_count_min",minValue:1,maxValue:10000,widthN:6,align:"right",labelWidthForce:__width_FieldChar(30)},{xtype:"displayfield_h16",value:" - "+this.findLangS("field","reg_ok_count_max")+":",style:{marginRight:__width_FieldSeparator,marginLeft:__width_FieldSeparator}},{xtype:"numberfield",name:"reg_ok_register_to",minValue:1,maxValue:10000,widthN:6,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"checkbox",name:"reg_ok_register_from_to_neg",fieldLabelLang:"reg_ok_count_negative_condition",labelWidthForce:__width_FieldChar(30)}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_unreg",defaultType:"textfield",deferredItems:[{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_unregister_time_sec_ge",minValue:1,maxValue:24*3600,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_failed",defaultType:"textfield",deferredItems:[{xtype:"numberfield",name:"reg_failed_occurences_ge",allowBlank:false,minValue:1,maxValue:1000,widthN:6,align:"right"}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_ua",defaultType:"textfield",deferredItems:[{xtype:"textarea",name:"reg_ua",allowBlank:false,heightL:5},{xtype:"checkbox",name:"reg_ua_neg"},{xtype:"numberfield",name:"reg_interval_limit_ua",fieldLabelLang:"reg_interval_limit",allowBlank:false,minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_interval_length_sec_ua",fieldLabelLang:"reg_interval_length_sec",minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_short",defaultType:"textfield",deferredItems:[{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_register_time_sec_le",allowBlank:false,minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"numberfield",name:"reg_interval_limit_short",fieldLabelLang:"reg_interval_limit",allowBlank:false,minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_interval_length_sec_short",fieldLabelLang:"reg_interval_length_sec",minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_mult",defaultType:"textfield",deferredItems:[],hidden:true},{xtype:"container",_paramsName:"_paramsReg_expire",defaultType:"textfield",deferredItems:[{xtype:"numberfield",name:"reg_interval_limit_expire",fieldLabelLang:"reg_interval_limit",allowBlank:false,minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_interval_length_sec_expire",fieldLabelLang:"reg_interval_length_sec",minValue:1,maxValue:1000,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.secondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsReg_rrd",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"reg_rrd_avg_ms_ge",allowBlank:false,minValue:1,maxValue:3*3600*1000,widthN:6,align:"right"},{xtype:"displayfield_h16",value:lang.milisecondShort,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],hidden:true});
D.push({xtype:"container",_paramsName:"_paramsNULL"});
var aa=[{name:"descr",allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"enable",widthCh:2},{xtype:"displayfield_h16",value:this.findLangS("field","every")+":",fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator},_id:"every_min_label"},{xtype:"numberfield",name:"every_min",minValue:1,maxValue:24*60,allowBlank:false,widthN:6,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator},_id:"every_min_right_label"}],style:{marginBottom:__height_FieldSeparator}},{xtype:"CBX_weekday",name:"at_day_of_week",labelWidth:__width_FieldChar(25)-1,width:__width_Form(__width_FieldChar(25)-1,__width_FieldChar(25)+1),multiSelect:true,_arraySeparator:",",_clearButton:true},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"at_hour_of_day_from",labelWidth:__width_FieldChar(25)-1,width:__width_Form(__width_FieldChar(25)-1,__width_FieldNum(2)+__width_Trigger),minValue:0,maxValue:23},{xtype:"displayfield_h16",value:"-",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",hideLabel:true,name:"at_hour_of_day_to",width:__width_FieldNum(2)+__width_Trigger,minValue:0,maxValue:23}],style:{marginBottom:__height_FieldSeparator}},{xtype:"ComboBoxA",name:"alert_type",aData:{data:arAlertType,fields:["id","descr","qtip"]},listConfig:{maxHeight:650},allowBlank:false,aeFilter:user_create_only_private_alerts()?[_EmailAlertType_Sensors]:undefined},{xtype:"ComboBoxA",name:"data_table",aData:[["cdr",this.findLangS("combomenu","cdr")],["message",this.findLangS("combomenu","message")]],allowBlank:false},{xtype:"ComboBoxA",name:"send_if",aData:arSendAlertReportIf,allowBlank:false},{xtype:"container",layout:"hbox",_id:"maximum_oldest_cdr",items:[{xtype:"numberfield",name:"maximum_oldest_cdr_hour",minValue:0,maxValue:168,widthN:5,align:"right"},{xtype:"displayfield_h16",value:"["+lang.hourShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"maximum_oldest_cdr_min",hideLabel:true,minValue:0,maxValue:60,widthN:5,align:"right"},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",_id:"select_sensors",items:[{xtype:"CBX_sensor",name:"select_sensors",_addEmptySensorId:true,_addAll:true,_multiSelect2:true,_clearButton:true,_width:__width_FieldChar(25),_listWidth:36},{xtype:"checkbox",name:"agregation_sensors",hideLabel:true,boxLabel:this.findLangS("field","agregation_sensors"),style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"checkbox",name:"only_connected"},{xtype:"container",items:D,width:"100%"},{name:"duration_gt",widthN:5,align:"right"},{xtype:"container",layout:"hbox",_id:"pdd_group",items:[{xtype:"textfield",name:"pdd_gt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"pdd_lt",widthN:5,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"box",_id:"hr_other",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:10,marginBottom:5}}},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"cdr_report_in_attachment_other",fieldLabelLang:"cdr_report_in_attachment",widthN:5,labelWidth:__width_FieldChar(20)},{xtype:"displayfield_h16",value:this.findLangS("field","cdr_report_max_lines_in_body"),fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator},_id:"cdr_report_max_lines_in_body_label_other"},{xtype:"textfield",name:"cdr_report_max_lines_in_body_other",widthN:5,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"checkbox",name:"cdr_recap_report_in_attachment",widthN:5,labelWidth:__width_FieldChar(20)},{xtype:"checkbox",name:"summary_in_subject",widthN:5,labelWidth:__width_FieldChar(20)},{xtype:"textfield",name:"external_script_other",fieldLabelLang:"external_script",labelWidth:__width_FieldChar(20),enableKeyEvents:true},{xtype:"checkbox",name:"external_script_parameters_via_tmp_file_other",fieldLabelLang:"external_script_parameters_via_tmp_file",labelWidth:__width_FieldChar(20)},{xtype:"container",layout:"hbox",_id:"_suppress_repeating_alerts",items:[{xtype:"checkbox",name:"suppress_repeating_alerts",labelWidth:__width_FieldChar(20),width:__width_FieldChar(20)+20},{xtype:"displayfield_h16",value:this.findLangS("field","alert_once_per_hours")+":",style:{marginLeft:10,marginRight:__width_FieldSeparator},fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"alert_once_per_hours",width:__width_FieldNum(3)+__width_Trigger,minValue:1,maxValue:24,align:"right",hideLabel:true}]}];
var z=[];
if(U.rslt.fill_cb_ip_groups*1){z.push({xtype:"CBX_cbIpGroups",_clearButton:true,_editTableButton:user_can_edit_codebooks()})
}z.push({xtype:"textarea",name:"ip"});
if(U.rslt.fill_cb_number_groups*1){z.push({xtype:"CBX_cbNumberGroups",_clearButton:true,_editTableButton:user_can_edit_codebooks()})
}z.push({xtype:"textarea",name:"number"});
if(U.rslt.fill_cb_email_groups*1){z.push({xtype:"CBX_cbEmailGroups",allowBlank:false,_clearButton:true,_editTableButton:user_can_edit_codebooks()})
}z.push({xtype:"checkbox",name:"enable_hyperlinks"},{xtype:"textarea",name:"email",enableKeyEvents:true,allowBlank:U.rslt.fill_cb_email_groups*1},{xtype:"textarea",name:"note"},{xtype:"checkbox",name:"add_note2email"});
z.push({xtype:"container",_paramsName:"_paramsRTP2",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"custom_columns_enable",width:__width_FieldChar(20)},{xtype:"checkbox",name:"custom_columns_after_std",labelWidth:__width_FieldChar(27)}]},{xtype:"container",layout:"hbox",items:[{xtype:"container",width:k+__width_FieldSeparator},{xtype:"priorityTable",name:"custom_columns_config",height:300,dataArray:true,dataEnable:true,dataRenderer:function(ae){var ad="";
ae=Ext.decode(ae);
if(ae.top||ae.bottom){if(ae.top){ad+=Ext.decode(ae.top).descr
}if(ae.bottom){ad+="<br>"+Ext.decode(ae.bottom).descr
}}return(ad)
},tbarAdd:true,tbarRemove:true,titleAdd:this.findLangS("title","addCustomColumn"),titleEdit:this.findLangS("title","editCustomColumn"),editPanel:function(ai){var af=getDataCdrSelectColumns({alert_rtp_columns:true});
var al=[];
for(var ah=0;
ah<af.length;
ah++){al.push([Ext.encode(af[ah]),af[ah].descr])
}var ag=ai?Ext.decode(ai.data.data):null;
var aj={items:[{xtype:"fieldset",title:f.findLangS("field_custom_columns","top"),style:__style_RedukFieldSet(),items:[{xtype:"ComboBoxA",name:"top",value:ag?ag.top:null,fieldLabel:f.findLangS("field_custom_columns","field"),editable:false,aData:al,_clearButton:true,width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)},{xtype:"textfield",name:"top_header",value:ag?ag.top_header:null,fieldLabel:f.findLangS("field_custom_columns","header"),width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)}]},{xtype:"fieldset",title:f.findLangS("field_custom_columns","bottom"),style:__style_RedukFieldSet(),items:[{xtype:"ComboBoxA",name:"bottom",value:ag?ag.bottom:null,fieldLabel:f.findLangS("field_custom_columns","field"),editable:false,aData:al,_clearButton:true,width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)},{xtype:"textfield",name:"bottom_header",value:ag?ag.bottom_header:null,fieldLabel:f.findLangS("field_custom_columns","header"),width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)}]}]};
var ak=[{text:lang.okButtonText,iconCls:"icon_ok",handler:ad,scope:this}];
Ext.applyIf(aj,{frame:true,border:false,autoHeight:true,labelAlign:"right",waitMsgTarget:true,buttons:ak});
var ae=new Ext.FormPanel(aj);
function ad(){var am=ae.getForm().getFieldValues();
if(ai){this.modifyData(ai,am)
}else{am.enable=true;
this.addData(am)
}ae.findWindow().close()
}return(ae)
},flex:1}]}],style:{marginTop:10},hidden:true});
var A=[];
A.push({xtype:"container",_paramsName:"_paramsFraudRCC1",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","RCC")},{xtype:"displayfield_h16",value:this.findLangS("field","fraud_number_condition_12"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"ComboBoxA",name:"fraud_number_condition_12",aData:{data:[["and",this.findLangS("combomenu","operator_and"),this.findLangS("combomenu_help","operator_and_number")],["or",this.findLangS("combomenu","operator_or"),this.findLangS("combomenu_help","operator_or_number")],["both_directions",this.findLangS("combomenu","operator_both_directions"),this.findLangS("combomenu_help","operator_both_directions_number")]],fields:["id","descr","qtip"]},_stringValue:true,hideLabel:true,width:o-k-__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","RCC",true)}]}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudCHC1",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","CHC")}],style:{marginBottom:__height_FieldSeparator-1}},{xtype:"ComboBoxA",name:"fraud_type_change_location_CHC",fieldLabelLang:"fraud_type_change_location",aData:arCountryOrContinent,_stringValue:true,widthCh:20},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield_h16",value:this.findLangS("field","exclude_country")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"country_tree",name:"fraud_change_location_ok_CHC",flex:1,height:200}],width:"100%"},{xtype:"checkbox",name:"fraud_use_domain_CHC",fieldLabel:this.findLangS("field","fraud_use_domain")},{xtype:"textarea",name:"fraud_whitelist_domain_CHC",fieldLabel:this.findLangS("field","fraud_filter_domain")}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudCHCR1",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","CHCR")}],style:{marginBottom:__height_FieldSeparator-1}},{xtype:"ComboBoxA",name:"fraud_type_change_location_CHCR",fieldLabelLang:"fraud_type_change_location",aData:arCountryOrContinent,_stringValue:true,widthCh:20},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield_h16",value:this.findLangS("field","exclude_country")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"country_tree",name:"fraud_change_location_ok_CHCR",flex:1,height:200}],width:"100%"},{xtype:"checkbox",name:"fraud_use_domain_CHCR",fieldLabel:this.findLangS("field","fraud_use_domain")},{xtype:"textarea",name:"fraud_whitelist_domain_CHCR",fieldLabel:this.findLangS("field","fraud_filter_domain")}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudD1",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","D")}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudSPC2",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","SPC")}],style:{marginBottom:__height_FieldSeparator-1}}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudRC2",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","RC")}],style:{marginBottom:__height_FieldSeparator-1}}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudSeq1",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","Seq")},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","Seq",true)}]}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudBillQ1",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","BilingOverQuota")}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","domain")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:l.call(this,"fraud_","BilingOverQuota")}],style:{marginBottom:__height_FieldSeparator}}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudBillHR1",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","number")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:S.call(this,"fraud_","BilingHighRate")}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsSipMsg_qualify1",deferredItems:[{xtype:"checkboxgroup_set",name:"sip_msg_type",columns:1,items:[{name:"options",autoBoxLabel:true},{boxLabel:"subscribe",name:"subscribe",hideLabel:true},{boxLabel:"notify",name:"notify",hideLabel:true}]},{xtype:"ComboBoxA",name:"sip_msg_group_by_ip",aData:{data:[["src",this.findLangS("combomenu","src_ip"),this.findLangS("combomenu_help","src_ip")],["dst",this.findLangS("combomenu","dst_ip"),this.findLangS("combomenu_help","dst_ip")]],fields:["id","descr","qtip"]},_stringValue:true,width:k+__width_FieldChar(15)},{xtype:"ComboBoxA",name:"sip_msg_group_by_response_number",aData:[[0,this.findLangS("combomenu","no")],[1,this.findLangS("combomenu","yes")],[2,this.findLangS("combomenu","yes_first")]],width:k+__width_FieldChar(15)},{xtype:"checkbox",name:"sip_msg_qualify_default"},{xtype:"numberfield",name:"sip_msg_qualify_limit",minValue:1,allowBlank:false,_width:__width_FieldNum(5)+__width_Trigger},{xtype:"textarea",name:"sip_msg_ok_responses",height:__height_FieldLines(3)}],hidden:true});
var w=[{xtype:"container",defaultType:"textfield",items:A}];
var Q=[];
Q.push({xtype:"container",_paramsName:"_paramsFraudRCC2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","RCC")},{xtype:"displayfield_h16",value:this.findLangS("field","fraud_ip_condition_12"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"ComboBoxA",name:"fraud_ip_condition_12",aData:{data:[["and",this.findLangS("combomenu","operator_and"),this.findLangS("combomenu_help","operator_and_ip")],["or",this.findLangS("combomenu","operator_or"),this.findLangS("combomenu_help","operator_or_ip")],["both_directions",this.findLangS("combomenu","operator_both_directions"),this.findLangS("combomenu_help","operator_both_directions_ip")]],fields:["id","descr","qtip"]},_stringValue:true,hideLabel:true,width:o-k-__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","RCC",true)}]}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudCHC2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","CHC")},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","CHC",true)}]}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudCHCR2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","CHCR")},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","CHCR",true)}]}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudD2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","D")}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudSPC3",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","ua")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:X.call(this,"fraud_","SPC")}],style:{marginBottom:__height_FieldSeparator-1}}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudRC3",defaultType:"textfield",deferredItems:[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","ua")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:X.call(this,"fraud_","RC")}],style:{marginBottom:__height_FieldSeparator-1}}],hidden:true},{xtype:"container",_paramsName:"_paramsFraudSeq2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","Seq")},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","Seq",true)}]}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudBillQ2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","BilingOverQuota")}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsFraudBillHR2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,"fraud_","BilingHighRate")}],style:{marginBottom:__height_FieldSeparator},hidden:true},{xtype:"container",_paramsName:"_paramsSipMsg_qualify2",layout:"hbox",deferredItems:[{xtype:"displayfield_h16",value:this.findLangS("field","ip")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"vbox",items:O.call(this)},{xtype:"displayfield_h16",value:this.findLangS("field","ip_condition_12"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"ComboBoxA",name:"ip_condition_12",aData:{data:[["and",this.findLangS("combomenu","operator_and"),this.findLangS("combomenu_help","operator_and_ip")],["or",this.findLangS("combomenu","operator_or"),this.findLangS("combomenu_help","operator_or_ip")],["both_directions",this.findLangS("combomenu","operator_both_directions"),this.findLangS("combomenu_help","operator_both_directions_ip")]],fields:["id","descr","qtip"]},_stringValue:true,hideLabel:true,width:o-k-__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:O.call(this,null,null,true)}],style:{marginBottom:__height_FieldSeparator}}],hidden:true});
var v=[{xtype:"container",defaultType:"textfield",items:Q}];
var E=[];
E.push({xtype:"container",_paramsName:"_paramsFraudRCC3",deferredItems:{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","prefixes_called_numbers")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"phone_prefixes_tree",name:"fraud_dest_prefixes_RCC",flex:1,height:200}],style:{marginBottom:__height_FieldSeparator-1},width:T-8},hidden:true},{xtype:"container",layout:"hbox",_paramsName:"_paramsFraudRCC4",deferredItemsPrepare:function(){this.gridFraud=new Alerts.Fraud.Grid({memoryStore:true,relFields:L?undefined:{alerts_id:V.data.id},enableSearchX:false,flex:1,height:150,border:true})
},deferredItems:function(){return([{xtype:"displayfield_h16",value:this.findLangS("field","time_period_rules")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},this.gridFraud])
},hidden:true,width:T-8,style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",_paramsName:"_params_register",deferredItemsPrepare:function(){this.gridRegFilters=new Alerts.Reg.Filters.Grid({memoryStore:true,relFields:L?undefined:{alerts_id:V.data.id},enableSearchX:false,flex:1,height:150,border:true,alertsGrid:this})
},deferredItems:function(){return([{xtype:"displayfield_h16",value:this.findLangS("field",this.enableRegisterMainFilter?"next_reg_filters":"reg_filters")+":",width:k,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},this.gridRegFilters])
},hidden:true,width:T-8,style:{marginBottom:__height_FieldSeparator}});
itemsLeft3_typeAlerts=[];
var W=__width_FieldChar(25);
itemsLeft3_typeAlerts.push({xtype:"container",style:{height:4}},{xtype:"textfield",name:"external_script_fraud",fieldLabelLang:"external_script",labelWidth:W,enableKeyEvents:true},{xtype:"checkbox",name:"external_script_parameters_via_tmp_file_fraud",fieldLabelLang:"external_script_parameters_via_tmp_file",labelWidth:W},{xtype:"textfield",name:"external_script_register",fieldLabelLang:"external_script",enableKeyEvents:true},{xtype:"checkbox",name:"external_script_parameters_via_tmp_file_register",fieldLabelLang:"external_script_parameters_via_tmp_file"},{xtype:"ComboBoxA",name:"ext_script_vars",fieldLabelLang:"external_script_vars",hideLabel:false,multiSelect:true,_clearButton:true,_arraySeparator:",",Qtip:"qtip",displayField:"descr",valueField:"id",aData:{data:[],fields:["id","descr","qtip"]},widthCh:64},{xtype:"container",layout:"hbox",_id:"_fraud_suppress_repeating_alerts",items:[{xtype:"checkbox",name:"fraud_suppress_repeating_alerts",fieldLabelLang:"suppress_repeating_alerts",labelWidth:W,width:W+20},{xtype:"displayfield_h16",value:this.findLangS("field","alert_once_per_hours")+":",style:{marginLeft:10,marginRight:__width_FieldSeparator},fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"fraud_alert_once_per_hours",width:__width_FieldNum(3)+__width_Trigger,minValue:1,maxValue:24,align:"right",hideLabel:true}]},{xtype:"displayfield_h16",value:"<i>"+this.findLangS("field","international_prefixes_configuration")+"</i>",_id:"check_international_numbers_label"});
itemsLeft3_typeAlerts=itemsLeft3_typeAlerts.concat(Settings.Utils.getInternationalRulesFormItems({labelWidth:W}));
itemsLeft3_typeAlerts.push({xtype:"box",_id:"hr_fraud",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:10,marginBottom:5}}},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"cdr_report_in_attachment_fraud",fieldLabelLang:"cdr_report_in_attachment",widthN:5,labelWidth:__width_FieldChar(20)},{xtype:"displayfield_h16",value:this.findLangS("field","cdr_report_max_lines_in_body"),fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator},_id:"cdr_report_max_lines_in_body_label_fraud"},{xtype:"textfield",name:"cdr_report_max_lines_in_body_fraud",widthN:5,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}});
var t=[{xtype:"container",defaultType:"textfield",items:itemsLeft3_typeAlerts}];
itemsRight3_typeAlerts=[];
var s=[{xtype:"container",defaultType:"textfield",items:itemsRight3_typeAlerts}];
var G=[{xtype:"container",items:E}];
var N=CDR.Filter.getFieldset("common",{values:{},disableTimeInterval:true,disableSelections:true});
var F=CDR.Filter.getFieldset_template({disableTimeInterval:true,disableSelections:true});
N.splice(0,0,{xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:0,marginBottom:5}}});
N.splice(0,0,F);
var y=CDR.Filter.getFieldset("rtp",{values:{}});
var R=window.existsDscpCdr?CDR.Filter.getFieldset("dscp",{values:{}}):null;
var q=CDR.Filter.getFieldset("filters_comb",{values:{}});
var n=Message.Filter.getFieldset({values:{},disableTimeInterval:true});
var Y=null;
if(this.enableRegisterMainFilter){Y=Register.Filter.getFieldset({values:{},enableSipCalleRD:true,enableNumFTC:true,enableNameFrom:true,enableDomainFTC:true,enableUsername:true,enableRealm:true,enableUa:true,enableSIPALG:true,prop:{label2aWidth:__width_FieldChar(20)}})
}var Z=705;
var o=Math.max(T,Z);
var u={xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,defaultType:"textfield",items:aa},{xtype:"container",flex:1,items:z}],anchor:"100%",width:o},{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,defaultType:"textfield",items:w},{xtype:"container",flex:1,items:v}],anchor:"100%",width:o},{xtype:"container",items:G,anchor:"100%",width:o},{xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,defaultType:"textfield",items:t},{xtype:"container",flex:1,items:s}],anchor:"100%",width:o}],width:o};
var B={xtype:"container",layout:"hbox",items:[],width:o};
var r={xtype:"fieldset",title:this.findLangS("title","userRestrictions"),items:[],style:__style_RedukFieldSet(),width:o};
var M=20;
var C=__width_FieldChar(M);
if(login_table()=="users"){if(user_is_admin()){r.items.push({xtype:"ComboBoxX",name:"owner_uid",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],widthCh:30,editable:false,disabled:!user_is_admin(),labelWidthForceCh:M,_clearButton:true})
}else{if(!L){r.items.push({xtype:"textfield",name:"owner_name",fieldLabelLang:"owner_uid",labelWidthForceCh:M,disabled:true})
}}}if(user_is_admin()||!L){r.items.push({xtype:"checkbox",name:"use_user_restriction",labelCh:25,labelWidthForceCh:M})
}if(!user_create_only_private_alerts()||!L){r.items.push({xtype:"checkbox",name:"private",labelWidthForceCh:M})
}if(login_table()=="users"&&(user_is_admin()||group_id())){for(var P=1;
P<=2;
P++){if(user_is_admin()){r.items.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field",P==1?"read_permission":"write_permission")+":",width:C+__width_LabelFieldSeparator},{xtype:"ComboBoxX",name:"user_ids_"+(P==1?"read":"write"),width:__width_FormChar(5,30),labelWidth:__width_FieldChar(5),fieldLabel:this.findLangS("field","users"),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true},{xtype:"ComboBoxX",name:"group_ids_"+(P==1?"read":"write"),width:__width_FormChar(5,30),labelWidth:__width_FieldChar(5),fieldLabel:this.findLangS("field","groups"),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"group_list",recordStruct:rsGroupList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true,style:{marginLeft:__width_FieldSeparator*2}}],width:"100%",style:{marginBottom:__height_FieldSeparator}})
}else{r.items.push({xtype:"ComboBoxX",name:"user_ids_"+(P==1?"read":"write"),width:__width_FormChar(M,30),labelWidth:__width_FieldChar(M),fieldLabel:this.findLangS("field",P==1?"read_permission":"write_permission"),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true})
}}}if(r.items.length){B.items.push(r)
}var ab={xtype:"tabpanel",items:[{xtype:"container",items:{xtype:"container",items:u,style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o},border:false,width:o+__width_Scroller+4,autoScroll:true,title:this.findLangS("tab","basicData"),style:{"background-color":__color_FormBackground}}],border:false,width:o};
this.containerFilter_common=new Ext.Container({xtype:"container",items:N,title:this.findLangS("tab","filterCommon"),width:o,_stopCompleteField:true});
this.containerFilter_rtp=new Ext.Container({xtype:"container",items:y,title:this.findLangS("tab","filterRtp"),width:o,_stopCompleteField:true});
this.containerFilter_dscp=R?new Ext.Container({xtype:"container",items:R,title:this.findLangS("tab","filterDscp"),width:o,_stopCompleteField:true}):null;
this.containerFilter_filtersComb=new Ext.Container({xtype:"container",items:q,title:this.findLangS("tab","filterFiltersComb"),width:o,_stopCompleteField:true});
this.containerFilterMessage=new Ext.Container({xtype:"container",items:n,title:this.findLangS("tab","filter"),width:o,_stopCompleteField:true});
if(Y){this.containerFilterRegister=new Ext.Container({xtype:"container",items:Y,title:this.findLangS("tab","filter"),width:o,_stopCompleteField:true})
}if(r.items.length){this.containerOtherSettings=new Ext.Container({xtype:"container",items:B,title:this.findLangS("tab","otherSettings"),width:o})
}else{if(this.containerOtherSettings){delete this.containerOtherSettings
}}var p=[];
p.push(this.containerFilter_common,this.containerFilter_rtp);
if(this.containerFilter_dscp){p.push(this.containerFilter_dscp)
}p.push(this.containerFilter_filtersComb);
p.push(this.containerFilterMessage);
if(this.containerFilterRegister){p.push(this.containerFilterRegister)
}if(this.containerOtherSettings){p.push(this.containerOtherSettings)
}for(var ac=0;
ac<p.length;
ac++){ab.items.push({xtype:"container",items:{xtype:"container",items:p[ac],style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:o},border:false,width:o+__width_Scroller+4,autoScroll:true,title:p[ac].title,style:{"background-color":__color_FormBackground}})
}return({xtype:"container",layout:"anchor",items:{xtype:"container",layout:"fit",items:ab,anchor:"-20, 0"}});
function S(ae,ag,ad){if(ag){ag="_"+ag
}else{ag=""
}var af=ad?"_2":"";
return([{xtype:"displayfield_h16",value:this.findLangS("field",ad?"include_called_numbers":"include_caller_numbers"),height:16,style:{marginTop:1,marginBottom:2},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbNumberGroups",name:(ae||"")+"whitelist_number"+af+"_group"+ag,hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ae||"")+"whitelist_number"+af+ag,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}},{xtype:"displayfield_h16",value:this.findLangS("field",ad?"exclude_called_numbers":"exclude_caller_numbers"),height:16,style:{marginTop:1,marginBottom:2},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbNumberGroups",name:(ae||"")+"blacklist_number"+af+"_group"+ag,hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ae||"")+"blacklist_number"+af+ag,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:5}}])
}function O(ae,ag,ad){if(ag){ag="_"+ag
}else{ag=""
}var af=ad?"_2":"";
return([{xtype:"displayfield_h16",value:this.findLangS("field",ad?"include_dst_ip":"include_src_ip"),height:16,style:{marginTop:1,marginBottom:2},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbIpGroups",name:(ae||"")+"whitelist_ip"+af+"_group"+ag||"",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ae||"")+"whitelist_ip"+af+ag,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}},{xtype:"displayfield_h16",value:this.findLangS("field",ad?"exclude_dst_ip":"exclude_src_ip"),height:16,style:{marginTop:1,marginBottom:2},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbIpGroups",name:(ae||"")+"blacklist_ip"+af+"_group"+ag,hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ae||"")+"blacklist_ip"+af+ag,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:5}}])
}function X(ad,ae){if(ae){ae="_"+ae
}else{ae=""
}return([{xtype:"CBX_cbUaGroups",name:(ad||"")+"whitelist_ua_group"+ae,hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ad||"")+"whitelist_ua"+ae,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:5}}])
}function l(ae,ag,ad){if(ag){ag="_"+ag
}else{ag=""
}var af=ad?"_2":"";
return([{xtype:"displayfield_h16",value:this.findLangS("field",ad?"include_called_domains":"include_caller_domains"),height:16,style:{marginTop:1,marginBottom:2},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbDomainGroups",name:(ae||"")+"whitelist_domain"+af+"_group"+ag,hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ae||"")+"whitelist_domain"+af+ag,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}},{xtype:"displayfield_h16",value:this.findLangS("field",ad?"exclude_called_domains":"exclude_caller_domains"),height:16,style:{marginTop:1,marginBottom:2},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbDomainGroups",name:(ae||"")+"blacklist_domain"+af+"_group"+ag,hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:(ae||"")+"blacklist_domain"+af+ag,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:5}}])
}},fpConfig:{layout:"fit",autoHeight:false},ewConfig:{layout:"fit",width:Math.max(__width_FormChar(d,35)*2+__width_Scroller+30,705)+40,height:Math.min(Ext.dom.Element.getViewportHeight()-60,820)},propRecordText:function(l){return(l.descr)
},enableEdit:true,enableSearchX:true,confirmDeleteRuleText:function(l,p){var m=0;
if(l.length>1){for(var n=0;
n<l.length;
n++){m+=l[n].data.count_sent
}}else{m=l[0].data.count_sent
}var o=p;
if(m>0){o+='<br><br><i style="color: red;">'+this.findLangS("text","infoDeleteSentAlerts").template([m])+"</i>"
}return o
},nextStdBar:[{text:findLangSd("grid","reload"),iconCls:"icon_reload",handler:function(){this.reload()
},scope:this},{text:this.findLangS("button","preview_alert"),iconCls:"icon_magnifier",handler:g,scope:this,_id:"previewAlert",disabled:true,cls:"always-show-tooltip",menu:[{text:this.findLangS("menu","normal_preview"),handler:g,_id:"previewAlertNormal",scope:this},{text:this.findLangS("menu","test_preview"),handler:g,_id:"previewAlertTest",scope:this}]},{text:this.findLangS("button","send_alert"),iconCls:"icon_email_send",handler:a,scope:this,_id:"sendAlert",disabled:true,cls:"always-show-tooltip"}],stripeRows:false,_withoutFieldProp:"__filter",contextMenu:function(l,m){if(this.isEnableEditRecord(l)){return([{text:this.findLangS("text","deleteSentAlerts"),iconCls:"icon_cancel",handler:function(){Ext.Msg.confirm("",this.findLangS("text","deleteSentAlertsQuestion"),function(n){if(n=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"deleteSentAlerts",params:Ext.encode({alert_id:l.data.id})},maskEl:this})
}},this)
},scope:this}])
}else{return(null)
}},subjectLang:"alert"});
this.callParent([c]);
function g(n){var m=this.selModel.getSelection();
if(!m.length){return
}if(n._id=="previewAlert"){if(this.isFraudAlert(m[0].data.alert_type)){h.call(this)
}return
}if(n._id=="previewAlertNormal"){h.call(this);
return
}var o=new Ext.FormPanel({frame:true,border:false,items:[{xtype:"container",layout:"hbox",items:[{xtype:"form",items:{xtype:"datetimefield",name:"datefrom",value:new Date((new Date()).getTime()-3600*1000),fieldLabel:findLangS(this.subsystem,"field","dateRange")+" - "+findLangS(this.subsystem,"field","from"),width:__width_FormChar(15,23),labelWidth:__width_FieldChar(15),zeroTimeEmpty:true},border:false,bodyStyle:__style_FormBackground()},{xtype:"displayfield_h16",value:findLangS(this.subsystem,"field","to")+":",style:{marginRight:__width_FieldSeparator}},{xtype:"datetimefield",name:"dateto",value:null,zeroTimeEmpty:true}]}],buttons:[{text:lang.previewButtonText,iconCls:"icon_magnifier",handler:p,scope:this},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){o.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",o.el,{enter:p,scope:this})
}}});
var l=new Ext.Window({layout:"fit",items:o,border:false,title:this.LpreviewAlert,modal:true,closable:true});
l.show();
function p(){var q={datefrom:o.getForm().findField("datefrom").getValue(),dateto:o.getForm().findField("dateto").getValue()};
h.call(this,q);
o.destroyWindow()
}}function h(l){var m=this.selModel.getSelection();
if(m.length){beginLoadMaskWithStopButton_ajax(mviewport,"previewAlert_loadMask");
params={id:m[0].data.id,every_min:m[0].data.every_min};
if(l){if(l.datefrom){params.datefrom=l.datefrom
}if(l.dateto){params.dateto=l.dateto
}}var n=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"previewAlert",params:Ext.encode(params),timestampId:mviewport._loadMask_timestampId},success:function(p){var s=Ext.dom.Element.getViewportWidth()-20;
var r=Math.min(850,Ext.dom.Element.getViewportWidth()-20);
var o=Ext.dom.Element.getViewportHeight()-50;
var q=new Ext.Window({title:m[0].data.descr,iconCls:"icon_magnifier",closable:true,maximizable:true,resizable:true,layout:"fit",items:{layout:"fit",xtype:"panel",html:p.alert,width:r,height:o,border:false,autoScroll:true,bodyStyle:{padding:5}}});
q.show();
endLoadMaskWithStopButton_ajax(mviewport)
},error2:function(){endLoadMaskWithStopButton_ajax(mviewport)
},failure:function(o){if(!n._aborted){alertAjaxFailure(o)
}endLoadMaskWithStopButton_ajax(mviewport)
},timeout:(window.report_timeout||30*60)*1000});
startLoadMaskWithStopButton_ajax(mviewport,n)
}}function a(){var l=this.selModel.getSelection();
if(l.length){beginLoadMaskWithStopButton_ajax(mviewport,"sendAlert_loadMask");
var m=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"sendAlert",params:Ext.encode({id:l[0].data.id}),timestampId:mviewport._loadMask_timestampId},success:function(n){alertAjaxSuccess(this.findLangS("text","alertSent"));
endLoadMaskWithStopButton_ajax(mviewport)
},error2:function(){endLoadMaskWithStopButton_ajax(mviewport)
},failure:function(n){if(!m._aborted){alertAjaxFailure(n)
}endLoadMaskWithStopButton_ajax(mviewport)
},timeout:(window.report_timeout||30*60)*1000});
startLoadMaskWithStopButton_ajax(mviewport,m)
}}function b(q,n,m,r,p,o,l){if(m.data.disable*1||m.data.disable=="on"){q=renderStringStyle(q,{color:"grey",strike:true})
}return(q)
}},setContextItems:function(h,u,C,b,o,r,z){if(C=="loadrecord"||C=="select"&&b&&b.name=="alert_type"){var q=C=="loadrecord"?u.alert_type:o;
var v="_params"+this.getNameAlert(q);
var p="_params_"+this.getTypeNameAlert(q);
var m=["_paramsNULL","_paramsRTP","_paramsSIP_response","_paramsSIP_various","_paramsReasonSipQ850","_paramsCPS","_paramsDSCP","_paramsCALL_TIMEDOUT","_paramsASR","_paramsNER","_paramsACD","_paramsInternalProxyError","_paramsTimeWithoutCall","_paramsConcurrentCalls","_paramsSensors","_paramsFraudRCC","_paramsFraudCHC","_paramsFraudCHCR","_paramsFraudD","_paramsFraudSPC","_paramsFraudRC","_paramsFraudSeq","_paramsFraudBillQ","_paramsFraudBillHR","_paramsReg_check_active","_paramsReg_unreg","_paramsReg_failed","_paramsReg_ua","_paramsReg_short","_paramsReg_mult","_paramsReg_expire","_paramsReg_rrd","_paramsSipMsg_qualify"];
var y=["_params_register"];
for(var D=0;
D<m.length;
D++){for(var B=0;
B<10;
B++){var g=this.getFormItem(m[D]+(B||""),"_paramsName",true);
if(g){if(m[D]==v){g.show();
if(g.deferredItems){u=this.renderParamsContainer(g,u)
}g.updateLayout()
}else{g.hide()
}}}}for(var D=0;
D<y.length;
D++){for(var B=0;
B<10;
B++){var g=this.getFormItem(y[D]+(B||""),"_paramsName",true);
if(g){if(y[D]==p){g.show();
if(g.deferredItems){u=this.renderParamsContainer(g,u)
}g.updateLayout()
}else{g.hide()
}}}}this.refreshExtScriptVars(u.alert_type)
}if(C=="select"&&b&&b.name=="fraud_rcc_by"){if((u.fraud_rcc_by=="rtp_stream_ip"||u.fraud_rcc_by=="rtp_stream_ip_group")&&r!="rtp_stream_ip"&&r!="rtp_stream_ip_group"){if(u.fraud_number_condition_12!="both_directions"){this.setValueField("fraud_number_condition_12","both_directions")
}if(u.fraud_ip_condition_12!="both_directions"){this.setValueField("fraud_ip_condition_12","both_directions")
}}}var G=u.mos_side==3||u.mos_xr_avg_side==3||u.mos_xr_min_side==3||u.mos_silence_avg_side==3||u.mos_silence_min_side==3||u.packets_lost_side==3||u.jitter_side==3||u.delay_side==3||u.silence_side==3||u.clipping_side==3;
this.showField(["cb_rtp_ip_groups_id","rtp_ip"],G);
this.allowBlankField("rtp_ip",!(u.alert_type==_EmailAlertType_RTP&&G&&!u.cb_rtp_ip_groups_id));
this.allowBlankField("time_without_call_minutes",u.alert_type!=_EmailAlertType_TimeWithoutCall);
this.allowBlankField("concurent_calls_limit_gt",u.alert_type!=_EmailAlertType_ConcurrentCalls);
this.allowBlankField("concurrent_calls_minutes",u.alert_type!=_EmailAlertType_ConcurrentCalls);
var n=this.isFraudAlert(u.alert_type);
var c=u.alert_type==_EmailAlertType_Fraud_SPC||u.alert_type==_EmailAlertType_Fraud_RC;
var k=u.alert_type==_EmailAlertType_Fraud_CHC||u.alert_type==_EmailAlertType_Fraud_CHCR;
var d=u.alert_type==_EmailAlertType_Fraud_BilingOverQuota||u.alert_type==_EmailAlertType_Fraud_BilingHighRate;
var F=this.isRegisterAlert(u.alert_type);
var s=this.isSipMsgAlert(u.alert_type);
this.showField("data_table",u.alert_type==_EmailAlertType_SIP_response);
this.showField("every_min",!n||d);
this.showItemBy("_id","every_min_label",!n||d);
this.showItemBy("_id","every_min_right_label",!n||d);
this.showItemBy("_id","select_sensors",n&&!d);
this.showField("select_sensors",n&&!d);
this.enableField("agregation_sensors",n&&!d&&(!u.select_sensors||u.select_sensors==-1||u.select_sensors&&u.select_sensors.match&&u.select_sensors.match(",")));
this.showField("send_if",!n&&!F&&!s&&u.alert_type!=_EmailAlertType_ASR&&u.alert_type!=_EmailAlertType_NER&&u.alert_type!=_EmailAlertType_ACD&&u.alert_type!=_EmailAlertType_TimeWithoutCall&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&u.alert_type!=_EmailAlertType_Sensors);
this.showItemBy("_id","maximum_oldest_cdr",!n&&!F&&!s&&u.alert_type!=_EmailAlertType_ASR&&u.alert_type!=_EmailAlertType_NER&&u.alert_type!=_EmailAlertType_ACD&&u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_TimeWithoutCall&&u.alert_type!=_EmailAlertType_ConcurrentCalls);
this.showField("enable_hyperlinks",u.alert_type!=_EmailAlertType_ASR&&u.alert_type!=_EmailAlertType_NER&&u.alert_type!=_EmailAlertType_ACD&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!F&&!s);
var t=this.getField("email").getValue();
var a=this.getField("cb_email_groups_id");
if(a){a.allowBlank=t;
if(t){a.clearInvalid()
}}this.enableFieldIf("interrupted_call_time_tolerance",u.interrupted_call);
this.showField("duration_gt",u.data_table=="cdr"&&u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_CPS&&u.alert_type!=_EmailAlertType_DSCP&&u.alert_type!=_EmailAlertType_ASR&&u.alert_type!=_EmailAlertType_NER&&u.alert_type!=_EmailAlertType_ACD&&u.alert_type!=_EmailAlertType_InternalProxyError&&u.alert_type!=_EmailAlertType_CALL_TIMEDOUT&&u.alert_type!=_EmailAlertType_TimeWithoutCall&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!n&&!F&&!s);
this.showItemBy("_id","pdd_group",u.data_table=="cdr"&&u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_CPS&&u.alert_type!=_EmailAlertType_DSCP&&u.alert_type!=_EmailAlertType_ASR&&u.alert_type!=_EmailAlertType_NER&&u.alert_type!=_EmailAlertType_ACD&&u.alert_type!=_EmailAlertType_InternalProxyError&&u.alert_type!=_EmailAlertType_CALL_TIMEDOUT&&u.alert_type!=_EmailAlertType_TimeWithoutCall&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!n&&!F&&!s);
if(u.alert_type==_EmailAlertType_DSCP){this.enableField("dscp_caller_sip_eq",Ext.isEmpty(u.dscp_caller_sip_ge)&&Ext.isEmpty(u.dscp_caller_sip_lt));
this.enableField("dscp_caller_sip_ge",Ext.isEmpty(u.dscp_caller_sip_eq));
this.enableField("dscp_caller_sip_lt",Ext.isEmpty(u.dscp_caller_sip_eq));
this.enableField("dscp_called_sip_eq",Ext.isEmpty(u.dscp_called_sip_ge)&&Ext.isEmpty(u.dscp_called_sip_lt));
this.enableField("dscp_called_sip_ge",Ext.isEmpty(u.dscp_called_sip_eq));
this.enableField("dscp_called_sip_lt",Ext.isEmpty(u.dscp_called_sip_eq));
this.enableField("dscp_caller_rtp_eq",Ext.isEmpty(u.dscp_caller_rtp_ge)&&Ext.isEmpty(u.dscp_caller_rtp_lt));
this.enableField("dscp_caller_rtp_ge",Ext.isEmpty(u.dscp_caller_rtp_eq));
this.enableField("dscp_caller_rtp_lt",Ext.isEmpty(u.dscp_caller_rtp_eq));
this.enableField("dscp_called_rtp_eq",Ext.isEmpty(u.dscp_called_rtp_ge)&&Ext.isEmpty(u.dscp_called_rtp_lt));
this.enableField("dscp_called_rtp_ge",Ext.isEmpty(u.dscp_called_rtp_eq));
this.enableField("dscp_called_rtp_lt",Ext.isEmpty(u.dscp_called_rtp_eq))
}this.enableFieldIf(["ipe_cdr_custom_headers_id","ipe_error"],u.alert_type==_EmailAlertType_InternalProxyError);
this.showField("cb_ip_groups_id",u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!n&&!F&&!s);
this.showField("ip",u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!n&&!F&&!s);
this.showField("cb_number_groups_id",u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!n&&!F&&!s);
this.showField("number",u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_ConcurrentCalls&&!n&&!F&&!s);
this.showItemBy("_id","hr_other",!n&&!F&&!s);
this.showItemBy("_id","hr_fraud",u.alert_type==_EmailAlertType_Fraud_BilingHighRate);
this.showField("cdr_report_in_attachment_other",u.alert_type!=_EmailAlertType_ASR&&u.alert_type!=_EmailAlertType_NER&&u.alert_type!=_EmailAlertType_ACD&&u.alert_type!=_EmailAlertType_Sensors&&u.alert_type!=_EmailAlertType_TimeWithoutCall&&!n&&!F&&!s);
this.showField("cdr_report_in_attachment_fraud",u.alert_type==_EmailAlertType_Fraud_BilingHighRate);
this.showField("cdr_report_max_lines_in_body_other",u.alert_type==_EmailAlertType_RTP||u.alert_type==_EmailAlertType_DSCP||u.alert_type==_EmailAlertType_InternalProxyError);
this.showField("cdr_report_max_lines_in_body_fraud",u.alert_type==_EmailAlertType_Fraud_BilingHighRate);
this.showItemBy("_id","cdr_report_max_lines_in_body_label_other",u.alert_type==_EmailAlertType_RTP||u.alert_type==_EmailAlertType_DSCP||u.alert_type==_EmailAlertType_InternalProxyError);
this.showItemBy("_id","cdr_report_max_lines_in_body_label_fraud",u.alert_type==_EmailAlertType_Fraud_BilingHighRate);
this.enableFieldIf("cdr_recap_report_in_attachment",(u.alert_type==_EmailAlertType_SIP_response||u.alert_type==_EmailAlertType_ReasonSipQ850||u.alert_type==_EmailAlertType_CPS||u.alert_type==_EmailAlertType_CALL_TIMEDOUT)&&u.cdr_report_in_attachment_other);
this.showField("cdr_recap_report_in_attachment",u.alert_type==_EmailAlertType_SIP_response||u.alert_type==_EmailAlertType_ReasonSipQ850||u.alert_type==_EmailAlertType_CPS||u.alert_type==_EmailAlertType_CALL_TIMEDOUT);
this.showField("summary_in_subject",u.alert_type==_EmailAlertType_SIP_response||u.alert_type==_EmailAlertType_ReasonSipQ850);
var E=this.getField("cdr_report_in_attachment_other");
if(E&&E.labelEl&&E.labelEl.dom){E.labelEl.dom.innerHTML=this.findLangS("field",u.alert_type==_EmailAlertType_ConcurrentCalls?"report_in_attachment":"cdr_report_in_attachment")+":"
}this.showItemBy("_id","_suppress_repeating_alerts",false);
this.showField(["suppress_repeating_alerts","alert_once_per_hours"],false);
this.showItemBy("_id","_fraud_suppress_repeating_alerts",n&&!k&&!d);
this.showField(["fraud_suppress_repeating_alerts","fraud_alert_once_per_hours"],n&&!k&&!d);
this.showField("only_connected",u.alert_type==_EmailAlertType_Fraud_CHC||u.alert_type==_EmailAlertType_Fraud_D);
this.enableFieldIf("fraud_store_pcaps_to_path",u.fraud_store_pcaps&&u.alert_type==_EmailAlertType_Fraud_RC);
this.showField(["external_script_other","external_script_parameters_via_tmp_file_other"],!window.isCloud&&(u.alert_type==_EmailAlertType_RTP||u.alert_type==_EmailAlertType_SIP_response||u.alert_type==_EmailAlertType_ReasonSipQ850||u.alert_type==_EmailAlertType_CPS||u.alert_type==_EmailAlertType_ASR||u.alert_type==_EmailAlertType_NER||u.alert_type==_EmailAlertType_ACD||u.alert_type==_EmailAlertType_DSCP||u.alert_type==_EmailAlertType_CALL_TIMEDOUT||u.alert_type==_EmailAlertType_InternalProxyError||u.alert_type==_EmailAlertType_Sensors));
this.showField(["external_script_fraud","external_script_parameters_via_tmp_file_fraud"],!window.isCloud&&n);
this.showField(["external_script_register","external_script_parameters_via_tmp_file_register"],!window.isCloud&&F);
var w=["other","fraud","register"];
for(var D=0;
D<w.length;
D++){this.enableFieldIf("external_script_parameters_via_tmp_file_"+w[D],u["external_script_"+w[D]])
}this.showField("ext_script_vars",!window.isCloud&&F);
this.enableFieldIf("ext_script_vars",u.external_script_register);
this.enableFieldIf("alert_once_per_hours",u.suppress_repeating_alerts);
this.enableFieldIf("fraud_alert_once_per_hours",u.fraud_suppress_repeating_alerts);
this.showItemBy("_id","check_international_numbers_label",n&&!c&&!d);
Settings.Utils.showIfItemsInternationalRules(this,n&&!c&&!d);
Settings.Utils.setContextItemsInternationalRules(this,h,u);
this.allowBlankField("country_code_for_local_numbers",!(u.alert_type==_EmailAlertType_Fraud_D&&(u.international_prefixes||u.international_number_min_length)));
this.allowBlankField("reg_unregister_time_sec_ge",u.alert_type!=_EmailAlertType_Register_unreg);
this.allowBlankField("reg_failed_occurences_ge",u.alert_type!=_EmailAlertType_Register_failed);
this.allowBlankField("reg_ua",u.alert_type!=_EmailAlertType_Register_ua);
this.allowBlankField("reg_register_time_sec_le",u.alert_type!=_EmailAlertType_Register_short);
this.allowBlankField("reg_interval_limit_ua",u.alert_type!=_EmailAlertType_Register_ua);
this.allowBlankField("reg_interval_limit_short",u.alert_type!=_EmailAlertType_Register_short);
this.allowBlankField("reg_interval_limit_expire",u.alert_type!=_EmailAlertType_Register_expire);
this.allowBlankField("reg_rrd_avg_ms_ge",u.alert_type!=_EmailAlertType_Register_rrd);
if(u.alert_type==_EmailAlertType_SipMsg_qualify){this.enableFieldIf(["sip_msg_qualify_limit","sip_msg_ok_responses"],!u.sip_msg_qualify_default)
}this.allowBlankField("email",u.external_script_other||u.external_script_fraud||u.external_script_register||u.cb_email_groups_id);
this.allowBlankField("cb_email_groups_id",u.external_script_other||u.external_script_fraud||u.external_script_register||u.email);
this.enableFieldIf(["custom_columns_after_std","custom_columns_config"],u.custom_columns_enable);
if(C=="loadrecord"){CDR.Filter.setContextFields(this.formPanel);
Message.Filter.setContextFields(this.formPanel);
Register.Filter.setContextFields(this.formPanel)
}this.containerFilter_common.ownerCt.ownerCt.tab.showIf(u.data_table!="message"&&u.alert_type!=_EmailAlertType_Sensors&&!n&&!F&&!s);
this.containerFilter_rtp.ownerCt.ownerCt.tab.showIf(u.data_table!="message"&&u.alert_type!=_EmailAlertType_Sensors&&!n&&!F&&!s);
if(this.containerFilter_dscp){this.containerFilter_dscp.ownerCt.ownerCt.tab.showIf(u.data_table!="message"&&u.alert_type!=_EmailAlertType_Sensors&&!n&&!F&&!s)
}this.containerFilter_filtersComb.ownerCt.ownerCt.tab.showIf(u.data_table!="message"&&u.alert_type!=_EmailAlertType_Sensors&&!n&&!F&&!s);
this.containerFilterMessage.ownerCt.ownerCt.tab.showIf(u.data_table=="message"&&u.alert_type!=_EmailAlertType_Sensors&&!n&&!F&&!s);
if(this.containerFilterRegister){this.containerFilterRegister.ownerCt.ownerCt.tab.showIf(F)
}if(this.gridRegFilters){this.gridRegFilters.reconfigureColumns()
}if(this.containerOtherSettings){var A=u.owner_uid||this.dataForEdit.owner_uid;
var l=this.getValueField("private");
this.enableFieldIf("owner_uid",user_is_admin());
this.enableFieldIf("private",user_is_admin()?u.owner_uid:user_id()==A&&!user_create_only_private_alerts());
this.enableFieldIf("use_user_restriction",user_is_admin()&&u.owner_uid);
this.enableFieldIf(["user_ids_read","group_ids_read","user_ids_write","group_ids_write"],l&&(user_is_admin()?u.owner_uid:user_id()==A))
}},onSelectionChange:function(a){var d=a.getSelection();
this.enableBtn("previewAlert",d&&d.length&&d[0].data.send_if!=1);
var c=this.getBtn("previewAlert");
if(c){c.setTooltip(d&&d.length&&d[0].data.send_if==1?this.findLangS("button_tooltip","preview_alert_disabled_for_no_criteria_match"):null)
}this.enableBtn("sendAlert",d&&d.length&&d[0].data.send_if!=1);
c=this.getBtn("sendAlert");
if(c){c.setTooltip(d&&d.length&&d[0].data.send_if==1?this.findLangS("button_tooltip","send_alert_disabled_for_no_criteria_match"):null)
}if(d.length){var b=this.getTopToolbar().findC("_id","previewAlert");
if(b){if(this.isFraudAlert(d[0].data.alert_type)){if(b.menu){b._menu=b.menu;
b.menu=null
}}else{if(b._menu){b.menu=b._menu;
b._menu=null
}}}}},getDefaultValues:function(){return{alert_type:_EmailAlertType_RTP,data_table:"cdr",select_sensors:_sensorId_all,sens_select_sensors:_sensorId_all,interrupted_call_time_tolerance:10,enable:true,enable_hyperlinks:true,add_note2email:false,send_if:0,every_min:5,maximum_oldest_cdr_hour:12,reason_type:0,fraud_by_ip:"src",fraud_rcc_by:"source_ip",fraud_rc_by:"source_ip",fraud_type_change_location:"country",fraud_interval_length:60,fraud_suppress_repeating_alerts:true,fraud_alert_once_per_hours:2,fraud_register_only_with_response:true,fraud_number_condition_12:"and",fraud_ip_condition_12:"and",reg_list_type_unreg:0,sip_msg_type:"options,subscribe,notify",sip_msg_group_by_ip:"dst",sip_msg_qualify_default:true,sip_msg_group_by_response_number:2,sip_msg_data_source:"stored",ip_condition_12:"and",call_timedout_bye:true,call_timedout_absolute:true,call_timedout_rtp:true,call_timedout_oneway:true,time_without_call_minutes:5,time_without_call_only_connected:true,concurrent_calls_minutes:60,international_prefixes:"+, 00",only_connected:true,ipe_error:"5XX",mos_side:0,mos_xr_avg_side:0,mos_xr_min_side:0,mos_silence_avg_side:0,mos_silence_min_side:0,packets_lost_side:0,jitter_side:0,delay_side:0,silence_side:0,clipping_side:0,owner_uid:user_id(),"private":user_create_only_private_alerts(),use_user_restriction:!user_is_admin(),occurences_gt_perc_cond:"or"}
},prepareDataForEdit:function(h){if(!h.data_table){h.data_table="cdr"
}if(!h.occurences_gt_perc_cond){h.occurences_gt_perc_cond="or"
}var a=["RTP","SIP_response","SIP_various","ReasonSipQ850","DSCP","InternalProxyError"];
d("occurences_gt",a);
d("occurences_perc_gt",a);
d("occurences_perc_from_all",a);
d("occurences_gt_perc_cond",a);
var k=["RCC","CHC","CHCR","D","Seq","BilingOverQuota","BilingHighRate"];
var g=["RCC","CHC","CHCR","D","SPC","RC","Seq","BilingOverQuota","BilingHighRate"];
var c=["SPC","RC"];
d("fraud_whitelist_number",k);
d("fraud_whitelist_number_group",k);
d("fraud_blacklist_number",k);
d("fraud_blacklist_number_group",k);
d("fraud_whitelist_number_2",k);
d("fraud_whitelist_number_2_group",k);
d("fraud_blacklist_number_2",k);
d("fraud_blacklist_number_2_group",k);
d("fraud_whitelist_ip",g);
d("fraud_whitelist_ip_group",g);
d("fraud_blacklist_ip",g);
d("fraud_blacklist_ip_group",g);
d("fraud_whitelist_ip_2",g);
d("fraud_whitelist_ip_2_group",g);
d("fraud_blacklist_ip_2",g);
d("fraud_blacklist_ip_2_group",g);
d("fraud_whitelist_ua",c);
d("fraud_whitelist_ua_group",c);
d("fraud_by_ip",["Seq","RCC"]);
d("fraud_type_change_location",["CHC","CHCR"]);
d("fraud_change_location_ok",["CHC","CHCR"]);
d("fraud_use_domain",["CHC","CHCR"]);
d("fraud_whitelist_domain",["CHC","CHCR","BilingOverQuota"]);
d("fraud_blacklist_domain",["BilingOverQuota"]);
d("fraud_whitelist_domain_group",["BilingOverQuota"]);
d("fraud_blacklist_domain_group",["BilingOverQuota"]);
d("fraud_dest_prefixes",["RCC"]);
d("fraud_interval_length",["SPC","RC","Seq"]);
d("fraud_interval_limit",["SPC","RC","Seq"]);
d("fraud_filter_international",["Seq"]);
d("reg_interval_limit",["ua","short","expire"]);
d("reg_interval_length_sec",["ua","short","expire"]);
d("reg_list_type",["unreg"]);
h.enable=!(h.disable*1||h.disable=="on");
h.enable_hyperlinks=!(h.disable_hyperlinks*1||h.disable_hyperlinks=="on");
d("external_script",["other","fraud","register"]);
d("external_script_parameters_via_tmp_file",["other","fraud","register"]);
h.cdr_report_in_attachment_other=h.cdr_report_in_attachment;
h.cdr_report_in_attachment_fraud=h.cdr_report_in_attachment;
h.cdr_report_max_lines_in_body_other=h.cdr_report_max_lines_in_body;
h.cdr_report_max_lines_in_body_fraud=h.cdr_report_max_lines_in_body;
if(!h.fraud_number_condition_12){h.fraud_number_condition_12=h.fraud_rcc_by=="rtp_stream_ip"||h.fraud_rcc_by=="rtp_stream_ip_group"?"both_directions":"and"
}if(!h.fraud_ip_condition_12){h.fraud_ip_condition_12=h.fraud_rcc_by=="rtp_stream_ip"||h.fraud_rcc_by=="rtp_stream_ip_group"?"both_directions":"and"
}var b=this.getField("ext_script_vars");
if(b&&h.ext_script_vars){this.ext_script_vars_re=h.ext_script_vars
}var f=null;
if(h.config_filter_cdr){f=Ext.decode(h.config_filter_cdr);
if(f){CDR.Filter.setValueFieldsFieldset_all(f,this.formPanel)
}}if(h.config_filter_message){configFilterMessage=Ext.decode(h.config_filter_message);
if(configFilterMessage){Message.Filter.setValueFieldsFieldset(configFilterMessage,this.formPanel)
}}if(h.config_filter_register){configFilterRegister=Ext.decode(h.config_filter_register);
if(configFilterRegister){Register.Filter.setValueFieldsFieldset(configFilterRegister,this.formPanel)
}}CDR.Filter.loadTemplates(this.formPanel,f&&f.ffilterTemplate);
function d(m,n){for(var l=0;
l<n.length;
l++){h[m+"_"+n[l]]=h[m]
}}},prepareDataForSave:function(g){var p=["RTP","SIP_response","SIP_various","ReasonSipQ850","DSCP","InternalProxyError"];
b("occurences_gt",p);
b("occurences_perc_gt",p);
b("occurences_perc_from_all",p);
b("occurences_gt_perc_cond",p);
var c=["RCC","CHC","CHCR","D","Seq","BilingOverQuota","BilingHighRate"];
var o=["RCC","CHC","CHCR","D","SPC","RC","Seq","BilingOverQuota","BilingHighRate"];
var n=["SPC","RC"];
d("fraud_whitelist_number",c);
d("fraud_whitelist_number_group",c);
d("fraud_blacklist_number",c);
d("fraud_blacklist_number_group",c);
d("fraud_whitelist_number_2",c);
d("fraud_whitelist_number_2_group",c);
d("fraud_blacklist_number_2",c);
d("fraud_blacklist_number_2_group",c);
d("fraud_whitelist_ip",o);
d("fraud_whitelist_ip_group",o);
d("fraud_blacklist_ip",o);
d("fraud_blacklist_ip_group",o);
d("fraud_whitelist_ip_2",o);
d("fraud_whitelist_ip_2_group",o);
d("fraud_blacklist_ip_2",o);
d("fraud_blacklist_ip_2_group",o);
d("fraud_whitelist_ua",n);
d("fraud_whitelist_ua_group",n);
d("fraud_by_ip",["Seq","RCC"]);
d("fraud_type_change_location",["CHC","CHCR"]);
d("fraud_change_location_ok",["CHC","CHCR"]);
d("fraud_use_domain",["CHC","CHCR"]);
d("fraud_whitelist_domain",["CHC","CHCR","BilingOverQuota"]);
d("fraud_blacklist_domain",["BilingOverQuota"]);
d("fraud_whitelist_domain_group",["BilingOverQuota"]);
d("fraud_blacklist_domain_group",["BilingOverQuota"]);
d("fraud_dest_prefixes",["RCC"]);
d("fraud_interval_length",["SPC","RC","Seq"]);
d("fraud_interval_limit",["SPC","RC","Seq"]);
d("fraud_filter_international",["Seq"]);
k("reg_interval_limit",["ua","short","expire"]);
k("reg_interval_length_sec",["ua","short","expire"]);
k("reg_list_type",["unreg"]);
var l=this.formPanel.getForm().getFields();
for(var h=0;
h<l.getCount();
h++){var m=l.get(h);
if(m.name&&m.name.match&&m.name.match("dscp_calle")&&Ext.isEmpty(g[m.name])){g[m.name]=null
}}g.disable=!g.enable;
g.disable_hyperlinks=!g.enable_hyperlinks;
g.external_script=g["external_script_"+this.getTypeNameAlert(g.alert_type)];
g.external_script_parameters_via_tmp_file=g["external_script_parameters_via_tmp_file_"+this.getTypeNameAlert(g.alert_type)];
g.cdr_report_in_attachment=g["cdr_report_in_attachment_"+this.getTypeNameAlert(g.alert_type)];
g.cdr_report_max_lines_in_body=g["cdr_report_max_lines_in_body_"+this.getTypeNameAlert(g.alert_type)];
if(CDR.Filter.isDataSet(this.formPanel)){var a=CDR.Filter.fetchValuesFromFieldset_all_template(this.formPanel);
if(a){g.config_filter_cdr=Ext.encode(a)
}}else{g.config_filter_cdr=null
}if(Message.Filter.isDataSet(this.formPanel)){var f=Message.Filter.fetchValuesFromFieldset(this.formPanel);
if(f){g.config_filter_message=Ext.encode(f)
}}else{g.config_filter_message=null
}if(Register.Filter.isDataSet(this.formPanel)){var q=Register.Filter.fetchValuesFromFieldset(this.formPanel);
if(q){g.config_filter_register=Ext.encode(q)
}}else{g.config_filter_register=null
}if(this.gridFraud&&g.alert_type==_EmailAlertType_Fraud_RCC){g.fraud=this.gridFraud.getAllGridData(true);
g.fraud_updateRecords=this.gridFraud._updateRecords;
g.fraud_deleteRecords=this.gridFraud._deleteRecords
}if(this.gridRegFilters&&this.isRegisterAlert(g.alert_type)){g.reg_filters=this.gridRegFilters.getAllGridData(true);
g.reg_filters_updateRecords=this.gridRegFilters._updateRecords;
g.reg_filters_deleteRecords=this.gridRegFilters._deleteRecords
}if(g.alert_type==_EmailAlertType_Fraud_RCC||g.alert_type==_EmailAlertType_Fraud_CHC||g.alert_type==_EmailAlertType_Fraud_CHCR||g.alert_type==_EmailAlertType_Fraud_D||g.alert_type==_EmailAlertType_Fraud_SPC||g.alert_type==_EmailAlertType_Fraud_RC){g.every_min=1
}function b(s,t){for(var r=0;
r<t.length;
r++){if(g.alert_type==window["_EmailAlertType_"+t[r]]){g[s]=g[s+"_"+t[r]]
}}}function d(s,t){for(var r=0;
r<t.length;
r++){if(g.alert_type==window["_EmailAlertType_Fraud_"+t[r]]){g[s]=g[s+"_"+t[r]]
}}}function k(s,t){for(var r=0;
r<t.length;
r++){if(g.alert_type==window["_EmailAlertType_Register_"+t[r]]){g[s]=g[s+"_"+t[r]]
}}}if(!existsCdrSilence){g.silence_gt=null;
g.silence_end_gt=null
}if(!existsCdrClipping){g.clipping_gt=null
}},onChangeRecords:function(a,b){if(b&&b.alert_type>=_EmailAlertType_Fraud_RCC){refreshFraud({id:b.id})
}},isEnableEditRecord:function(a){return(this.isEnableEditDeleteRecord(a))
},isEnableDeleteRecord:function(a){return(this.isEnableEditDeleteRecord(a))
},isEnableEditDeleteRecord:function(a){return(!a.data["private"]||user_is_admin()||user_id()&&a.data.owner_uid&&user_id()==a.data.owner_uid||user_id()&&a.data.user_ids_write&&a.data.user_ids_write.isIn(user_id())||group_id()&&a.data.group_ids_write&&a.data.group_ids_write.isIn(group_id()))
},onStoreLoad:function(b,a,d,c){if(window.alertId){this.editRecord(window.alertId);
delete window.alertId
}},isFraudAlert:function(a){return([_EmailAlertType_Fraud_RCC,_EmailAlertType_Fraud_CHC,_EmailAlertType_Fraud_CHCR,_EmailAlertType_Fraud_D,_EmailAlertType_Fraud_SPC,_EmailAlertType_Fraud_RC,_EmailAlertType_Fraud_Seq,_EmailAlertType_Fraud_BilingOverQuota,_EmailAlertType_Fraud_BilingHighRate].isIn(a))
},isRegisterAlert:function(a){return([_EmailAlertType_Register_check_active,_EmailAlertType_Register_unreg,_EmailAlertType_Register_failed,_EmailAlertType_Register_ua,_EmailAlertType_Register_short,_EmailAlertType_Register_mult,_EmailAlertType_Register_expire,_EmailAlertType_Register_rrd].isIn(a))
},isSipMsgAlert:function(a){return([_EmailAlertType_SipMsg_qualify].isIn(a))
},getNameAlert:function(a){return(a==_EmailAlertType_RTP?"RTP":a==_EmailAlertType_SIP_response?"SIP_response":a==_EmailAlertType_SIP_various?"SIP_various":a==_EmailAlertType_ReasonSipQ850?"ReasonSipQ850":a==_EmailAlertType_CPS?"CPS":a==_EmailAlertType_DSCP?"DSCP":a==_EmailAlertType_CALL_TIMEDOUT?"CALL_TIMEDOUT":a==_EmailAlertType_ASR?"ASR":a==_EmailAlertType_NER?"NER":a==_EmailAlertType_ACD?"ACD":a==_EmailAlertType_InternalProxyError?"InternalProxyError":a==_EmailAlertType_TimeWithoutCall?"TimeWithoutCall":a==_EmailAlertType_ConcurrentCalls?"ConcurrentCalls":a==_EmailAlertType_Sensors?"Sensors":a==_EmailAlertType_Fraud_RCC?"FraudRCC":a==_EmailAlertType_Fraud_CHC?"FraudCHC":a==_EmailAlertType_Fraud_CHCR?"FraudCHCR":a==_EmailAlertType_Fraud_D?"FraudD":a==_EmailAlertType_Fraud_SPC?"FraudSPC":a==_EmailAlertType_Fraud_RC?"FraudRC":a==_EmailAlertType_Fraud_Seq?"FraudSeq":a==_EmailAlertType_Fraud_BilingOverQuota?"FraudBillQ":a==_EmailAlertType_Fraud_BilingHighRate?"FraudBillHR":a==_EmailAlertType_Register_check_active?"Reg_check_active":a==_EmailAlertType_Register_unreg?"Reg_unreg":a==_EmailAlertType_Register_failed?"Reg_failed":a==_EmailAlertType_Register_ua?"Reg_ua":a==_EmailAlertType_Register_short?"Reg_short":a==_EmailAlertType_Register_mult?"Reg_mult":a==_EmailAlertType_Register_expire?"Reg_expire":a==_EmailAlertType_Register_rrd?"Reg_rrd":a==_EmailAlertType_SipMsg_qualify?"SipMsg_qualify":"NULL")
},getTypeNameAlert:function(a){return(this.isFraudAlert(a)?"fraud":this.isRegisterAlert(a)?"register":this.isSipMsgAlert(a)?"sip_msg":"other")
},renderParamsContainer:function(a,c){if(a.deferredItems){if(a.deferredItemsPrepare){a.deferredItemsPrepare.call(this)
}var b=Ext.isFunction(a.deferredItems)?a.deferredItems.call(this):a.deferredItems;
completeFormFields(b,true,this.fpDefaults,this);
a.add(b);
a.cascade(function(d){if(d.name&&d.setValue){if(Ext.isDefined(this.dataForEdit[d.name])){d.setValue(this.dataForEdit[d.name]);
c[d.name]=this.dataForEdit[d.name]
}catchAllEventsField(d,this.formPanel);
this._getFieldCache[d.name]=d
}},this);
delete a.deferredItems
}return(c)
},refreshExtScriptVars:function(d){var b=this.getField("ext_script_vars");
b.deleteAllMenuItems();
b.onClearClick();
for(idx in arExtScriptIds[d]){if(typeof(arExtScriptIds[d][idx])!="object"){continue
}var c={};
c[b.valueField]=arExtScriptIds[d][idx][0];
c[b.displayField]=arExtScriptIds[d][idx][1];
c[b.Qtip]=arExtScriptIds[d][idx][2];
b.addMenuItem(c)
}if(this.ext_script_vars_re){var a=this.ext_script_vars_re.split(",");
b.setValue(a);
delete this.ext_script_vars_re
}else{b.select(b.getStore().collect(b.valueField))
}}});
Ext.define("Alerts.Fraud.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Alerts.Fraud.GridX",subsystem:"alerts_daily_reports",constructor:function(a){var b=15;
var c=__width_FieldChar(b);
a=Ext.applyIf(a||{},{storeId:"AlertsFraud",url:"php/model/sql.php",module:"alerts_fraud",recordStruct:rsAlertsFraud,sortField:"descr",remoteSort:true,columns:[{dataIndex:"descr",widthCh:40},{dataIndex:"concurent_calls_limit_local",headerLang:"concurrent_calls_limit_local",widthNum:12},{dataIndex:"concurent_calls_limit_international",headerLang:"concurrent_calls_limit_international",widthNum:12},{dataIndex:"concurent_calls_limit",headerLang:"concurrent_calls_limit",widthNum:12}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:b,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"descr",fieldLabel:this.descrText,allowBlank:false},{xtype:"CBX_cbTimePeriod",name:"timeperiod",_clearButton:true,_multiSelect2:true},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field","concurrent_calls_limit")+":",width:c,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:{type:"table",columns:3},items:[{xtype:"displayfield_h16",value:this.findLangS("field","local"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"displayfield_h16",value:this.findLangS("field","international"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"displayfield_h16",value:this.findLangS("field","both"),height:16,style:{paddingBottom:0,marginBottom:0},fieldStyle:{paddingBottom:0,marginBottom:0,"font-size":"90%"}},{xtype:"numberfield",name:"concurent_calls_limit_local",minValue:1,maxValue:90000,hideLabel:true,width:__width_FieldNum(7),align:"right",style:{marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"concurent_calls_limit_international",minValue:1,maxValue:90000,hideLabel:true,width:__width_FieldNum(7),align:"right",style:{marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"concurent_calls_limit",minValue:1,maxValue:90000,hideLabel:true,width:__width_FieldNum(7),align:"right"}]}]}],enableEdit:true,stripeRows:false});
this.callParent([a])
}});
Ext.define("Alerts.Reg.Filters.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Alerts.Reg.Filters.GridX",subsystem:"alerts_daily_reports",constructor:function(a){var c=15;
var d=__width_FieldChar(c);
var b=[{dataIndex:"descr",widthCh:40}];
if(a.alertsGrid.getValueField("alert_type")==_EmailAlertType_Register_check_active){b.push({dataIndex:"reg_ok_register_from",headerLang:"reg_ok_count_min_column",align:"right",widthN:17},{dataIndex:"reg_ok_register_to",headerLang:"reg_ok_count_max_column",align:"right",widthN:17},{dataIndex:"reg_ok_register_from_to_neg",headerLang:"reg_ok_count_negative_condition_column",align:"center",widthCh:15,renderer:renderTick})
}a=Ext.applyIf(a||{},{storeId:"AlertsRegFilters",url:"php/model/sql.php",module:"alerts_reg_filters",recordStruct:rsAlertsRegFilters,sortField:"descr",remoteSort:true,columns:b,fpDefaults:{xtype:"textfield",widthCh:35,labelCh:c,disableAutoAddTriggerWidth:true},fpItems:function(l,h,k,f){var n=740;
var m=Register.Filter.getFieldset({values:{},enableSipCalleRD:true,enableNumFTC:true,enableNameFrom:true,enableDomainFTC:true,enableUsername:true,enableRealm:true,enableSIPALG:true,enableUa:true});
this.containerFilterRegister=new Ext.Container({xtype:"container",items:m,width:n,_stopCompleteField:true});
var g=[{name:"descr",xtype:"textfield",fieldLabel:this.descrText,allowBlank:false,labelWidth:__width_FieldChar(11)+2,labelAlign:"left"}];
if(this.alertsGrid.getValueField("alert_type")==_EmailAlertType_Register_check_active){g.push({xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"numberfield",name:"reg_ok_register_from",fieldLabelLang:"reg_ok_count_min",minValue:1,maxValue:10000,widthN:6,align:"right",labelAlign:"left",labelWidthForce:__width_FieldChar(30)},{xtype:"displayfield_h16",value:" - "+this.findLangS("field","reg_ok_count_max")+":",style:{marginRight:__width_FieldSeparator,marginLeft:__width_FieldSeparator}},{xtype:"numberfield",name:"reg_ok_register_to",minValue:1,maxValue:10000,widthN:6,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"checkbox",name:"reg_ok_register_from_to_neg",fieldLabelLang:"reg_ok_count_negative_condition",labelAlign:"left",labelWidthForce:__width_FieldChar(30)})
}g.push({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:0,marginBottom:5}}},this.containerFilterRegister);
return(g)
},ewConfig:{autoWidth:true},enableEdit:true,stripeRows:false});
this.callParent([a])
},setContextItems:function(a,d,f,h,g,c,b){if(f=="loadrecord"){Register.Filter.setContextFields(this.formPanel)
}},prepareDataForEdit:function(a){if(a.config_filter_register){configFilterRegister=Ext.decode(a.config_filter_register);
if(configFilterRegister){Register.Filter.setValueFieldsFieldset(configFilterRegister,this.formPanel)
}}},prepareDataForSave:function(b){if(Register.Filter.isDataSet(this.formPanel)){var a=Register.Filter.fetchValuesFromFieldset(this.formPanel);
if(a){b.config_filter_register=Ext.encode(a)
}}else{b.config_filter_register=null
}},reconfigureColumns:function(){if(!this.getEl()||!this.headerCt||!this.headerCt.items){return
}var a=[{dataIndex:"descr",header:this.findLangS("field","descr"),width:__width_ColumnChar(40)}];
if(this.alertsGrid.getValueField("alert_type")==_EmailAlertType_Register_check_active){a.push({dataIndex:"reg_ok_register_from",header:this.findLangS("field","reg_ok_count_min_column"),align:"right",width:__width_ColumnChar(17)},{dataIndex:"reg_ok_register_to",header:this.findLangS("field","reg_ok_count_max_column"),align:"right",width:__width_ColumnChar(17)},{dataIndex:"reg_ok_register_from_to_neg",header:this.findLangS("field","reg_ok_count_negative_condition_column"),align:"center",width:__width_ColumnChar(15),renderer:renderTick})
}this.reconfigure(this.store,a)
}});
Ext.define("Alerts.Sended.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Alerts.Sended.GridX",subsystem:"alerts_daily_reports",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Alerts.Sended",url:"php/model/sql.php",module:"alerts_sended",recordStruct:rsAlertsSended,sortField:"send_time",sortDirection:"desc",remoteSort:true,enableSearchX:true,paginatorPrependButtons:true,paginatorBehindButtonsItems:"-",columns:[{dataIndex:"alert_descr",widthCh:20},{dataIndex:"send_time",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"subject",widthCh:40},{dataIndex:"last_cdr_id",widthN:5,align:"right"},{dataIndex:"send_email",widthCh:20}],enableDelete:true,pageSize:30,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Alerts.Sended.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],fullColumnSize:"subject",fullColumnSizeDecrementScroller:true,tbar:[{text:this.findLangS("button","delete_all"),iconCls:"icon_cancel",handler:this.deleteAll,scope:this}]});
this.callParent([a])
},deleteAll:function(){var b=null;
var a=new Ext.Window({layout:"fit",title:this.findLangS("title","delete_sent_alerts"),items:{xtype:"form",items:[{xtype:"checkbox",name:"all",checked:true,fieldLabel:this.findLangS("field","delete_all"),labelWidth:__width_FieldChar(12),listeners:{scope:this,change:function(c){b.findField("to_date").enableIf(!c.getValue())
}}},{xtype:"datefield",name:"to_date",value:date_prev(),format:__format_Date,fieldLabel:this.findLangS("field","delete_to_date"),labelWidth:__width_FieldChar(12),width:__width_FormChar(12,12)}],buttons:[{text:this.findLangS("button","delete"),iconCls:"icon_delete",scope:this,handler:function(){this.doDeleteAll(a,b.getFieldValues())
}}],border:false,modal:true,listeners:{scope:this,afterrender:function(c){b=c.getForm();
b.findField("to_date").enableIf(!b.findField("all").getValue())
}},style:{padding:5,"background-color":__color_WindowFrame},bodyStyle:{"background-color":__color_WindowFrame}},border:false,modal:true});
a.show()
},doDeleteAll:function(a,b){Ext.Msg.confirm("",b.all||!b.to_date?this.findLangS("text","deleteAllSentAlertsQuestion"):this.findLangS("text","deleteToTimeSentAlertsQuestion").template([Ext.Date.format(b.to_date,__format_Date)]),function(c){if(c=="yes"){a.close();
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"deleteSentAlerts",params:Ext.encode(b)},success:function(){this.reload()
},scope:this,maskEl:this})
}},this)
}});
Ext.define("Alerts.Sended.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){Ext.apply(a,{border:false,html:a.record.data.content,padding:5,autoScroll:true});
this.callParent([a]);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getValueFromDb",params:Ext.encode({table:"alerts_sended",id:a.record.data.id,column:"content",unzip:true})},success:function(b){this.update(b.rslt);
this.updateLayout()
}})
}});
Ext.define("Alerts.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.alerts_editPanelX",subsystem:"alerts_daily_reports",constructor:function(a){a=Ext.applyIf(a||{},{id:"alerts_edit-panel",iconCls:"icon_menu_diag_system",gridXType:"Alerts.GridX",wikiId:"Alerts",titleLang:"alerts"});
this.callParent([a])
},reactivate:function(){var a=this.findC("xtype",this.gridXType);
if(a&&a.lastAjaxParams){delete a.lastAjaxParams
}}});
Ext.define("Alerts.Sended.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.alerts_sendedPanelX",subsystem:"alerts_daily_reports",constructor:function(a){a=Ext.applyIf(a||{},{id:"alerts_sended-panel",iconCls:"icon_menu_diag_system",gridXType:"Alerts.Sended.GridX",wikiId:"Alerts",titleLang:"sent_alerts"});
this.callParent([a])
}});
function refreshFraud(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshFraud",params:a?Ext.encode(a):undefined},success:function(){},error:function(){}})
}Ext.ns("Crontab");
Ext.ns("CsvExports");
Ext.define("Crontab.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Crontab.GridX",subsystem:"crontab",constructor:function(b){b=Ext.applyIf(b||{},{storeId:b.customCleaning?"CustomCleaningStore":(b.onlyCsvExports?"CsvExports":"CrontabStore"),url:"php/model/sql.php",module:b.customCleaning?"custom_cleaning":"crontab",keyField:"id",recordStruct:b.customCleaning?rsCustomCleaning:rsCrontab,sortField:"descr",columnsDefaults:{renderer:a},columns:[{dataIndex:"descr",widthCh:30},{dataIndex:"type",widthCh:22,renderer:renderArrayData,renderer2:a,arrayData:!b.customCleaning?arCrontabType:arCustomCleaningType},{dataIndex:"type_at",widthCh:14,renderer:c,renderer2:a,sortable:false},{dataIndex:"last_run_at",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"note",widthCh:60}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(s,r,d,h){var y=this;
var w=__width_FormChar(20,40);
var o=[{xtype:"textfield",name:"descr",allowBlank:false},{xtype:"checkbox",name:"enable"}];
if(!b.customCleaning){var p=[];
if(this.onlyCsvExports){for(var u=0;
u<arCrontabType.length;
u++){if(arCrontabType[u][0].match("csv")){p.push(arCrontabType[u])
}}}else{p=arCrontabType
}o.push({xtype:"ComboBoxA",name:"type",aData:p,widthCh:22,allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"ComboBoxA",name:"type_at",aData:arCrontabTypeAt,widthCh:10,allowBlank:false},{xtype:"numberfield",name:"at_hour",minValue:0,maxValue:23,allowBlank:false,widthN:5,align:"right",hideLabel:true,style:{marginLeft:10}},{xtype:"displayfield_h16",value:lang.hourShort,fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"displayfield_h16",value:":",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"at_minute",minValue:0,maxValue:59,allowBlank:false,widthN:5,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:lang.minuteShort,fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"CBX_weekday",name:"at_day_of_week",labelWidth:__width_FieldChar(32)+1,width:__width_Form(__width_FieldChar(16),__width_FieldChar(32)+1),multiSelect:true,_arraySeparator:",",_clearButton:true},{xtype:"numberfield",name:"at_day_of_month",minValue:1,maxValue:31,labelWidth:__width_FieldChar(32)+1,width:__width_Form(__width_FieldNum(4),__width_FieldChar(32)+1),widthN:4,align:"right",enableKeyEvents:true},{xtype:"ComboBoxA",name:"time_interval",aData:arExportCsvTimeIntervals,allowBlank:false},{xtype:"textfield",name:"send_to",enableKeyEvents:true,allowBlank:(window.csvExportFolder?true:false)},{xtype:"textfield",name:"send_from"},{xtype:"textfield",name:"csv_store_prefix",allowBlank:!window.csvExportFolder,helpText:window.csvExportFolder?this.findLangS("field_help","csv_store_prefix"):"",withoutHelpText:!window.csvExportFolder},{xtype:"checkbox",name:"csv_send_in_attachment"},{xtype:"numberfield",name:"csv_delete_after_days",widthNum:6,minValue:0,maxValue:365,align:"right"},{xtype:"textarea",name:"note"},{xtype:"fieldset",title:this.findLangS("title","forExperts"),border:true,collapsible:true,collapsed:!(h&&h.data&&h.data.custom_columns_enable),items:[{xtype:"checkbox",name:"every_day_align"},{xtype:"numberfield",name:"start_shift_minutes",widthNum:6,minValue:0,maxValue:120,align:"right"},{xtype:"checkbox",name:"use_last_record_id"},{xtype:"checkbox",name:"custom_columns_enable"},{xtype:"container",layout:"hbox",items:[{xtype:"container",width:__width_FieldChar(20)+__width_FieldSeparator},{xtype:"priorityTable",name:"custom_columns_config",height:300,dataArray:true,dataEnable:true,dataRenderer:function(C){var B="";
C=Ext.decode(C);
if(C.field){B+=Ext.decode(C.field).descr
}return(B)
},tbarAdd:true,tbarRemove:true,titleAdd:this.findLangS("title","addCustomColumn"),titleEdit:this.findLangS("title","editCustomColumn"),catchAllEventsField:true,editPanel:function(G){var D=getDataCdrSelectColumns();
var J=[];
for(var F=0;
F<D.length;
F++){J.push([Ext.encode(D[F]),D[F].descr])
}var E=G?Ext.decode(G.data.data):null;
var H={items:[{xtype:"ComboBoxA",name:"field",value:E?E.field:null,fieldLabel:y.findLangS("field_custom_columns","field"),editable:false,aData:J,_clearButton:true,width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)},{xtype:"textfield",name:"field_header",value:E?E.field_header:null,fieldLabel:y.findLangS("field_custom_columns","header"),width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)}]};
var I=[{text:lang.okButtonText,iconCls:"icon_ok",handler:B,scope:this}];
Ext.applyIf(H,{frame:true,border:false,autoHeight:true,labelAlign:"right",waitMsgTarget:true,buttons:I});
var C=new Ext.FormPanel(H);
function B(){var K=C.getForm().getFieldValues();
if(G){this.modifyData(G,K)
}else{K.enable=true;
this.addData(K)
}C.findWindow().close()
}return(C)
},width:__width_FieldChar(37)}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"ComboBoxA",name:"custom_columns_group_by",editable:false,aData:[],_stringValue:true,_clearButton:true,width:__width_FormChar(28,20),labelWidth:__width_FieldChar(28)},{xtype:"ComboBoxA",name:"custom_columns_group_by_direction",editable:false,aData:[["asc","asc"],["desc","desc"]],_stringValue:true,hideLabel:true,width:__width_FieldChar(5)+__width_Trigger,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"ComboBoxA",name:"custom_columns_order_by",editable:false,aData:[],_stringValue:true,_clearButton:true,width:__width_FormChar(28,20),labelWidth:__width_FieldChar(28)},{xtype:"ComboBoxA",name:"custom_columns_order_by_direction",editable:false,aData:[["asc","asc"],["desc","desc"]],_stringValue:true,hideLabel:true,width:__width_FieldChar(5)+__width_Trigger,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],style:{paddingBottom:8}})
}else{o.push({xtype:"ComboBoxA",name:"type",aData:arCustomCleaningType,widthCh:12,allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"at_hour",minValue:0,maxValue:23,allowBlank:false,widthN:5,align:"right",fieldLabelLang:"schedule_at"},{xtype:"displayfield_h16",value:lang.hourShort,fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"displayfield_h16",value:":",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"at_minute",minValue:0,maxValue:59,allowBlank:false,widthN:5,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:lang.minuteShort,fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:{type:"table",columns:2},items:[{xtype:"displayfield_h16",value:"",fieldClass:"x-form-field"},{xtype:"displayfield_h16",value:this.findLangS("field","older_than_days"),fieldClass:"x-form-field",style:{marginRight:__width_FieldChar(2)}},{xtype:"checkbox",name:"cleaning_db_records_enable",width:__width_FormChar(20,4)},{xtype:"numberfield",name:"cleaning_db_records_older_than_days",minValue:1,allowBlank:false,width:__width_FieldNum(3)+__width_Trigger,hideLabel:true},{xtype:"checkbox",name:"cleaning_sip_pcaps_enable",width:__width_FormChar(20,4)},{xtype:"numberfield",name:"cleaning_sip_pcaps_older_than_days",minValue:1,allowBlank:false,width:__width_FieldNum(3)+__width_Trigger,hideLabel:true},{xtype:"checkbox",name:"cleaning_rtp_pcaps_enable",width:__width_FormChar(20,4)},{xtype:"numberfield",name:"cleaning_rtp_pcaps_older_than_days",minValue:1,allowBlank:false,width:__width_FieldNum(3)+__width_Trigger,hideLabel:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"textfield",name:"send_report_to",enableKeyEvents:true},{xtype:"textfield",name:"send_report_from"},{xtype:"textarea",name:"note"},{xtype:"displayfield",fieldClass:"x-form-field",value:this.findLangS("text","customCleaningMainInfo"),fieldStyle:{"font-style":"italic"},style:{marginTop:10}})
}var A=CDR.Filter.getFieldset("common",{values:{},disableTimeInterval:true,disableSelections:true});
var v=CDR.Filter.getFieldset_template({disableTimeInterval:true,disableSelections:true});
A.splice(0,0,{xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:0,marginBottom:5}}});
A.splice(0,0,v);
var q=CDR.Filter.getFieldset("rtp",{values:{}});
var k=window.existsDscpCdr?CDR.Filter.getFieldset("dscp",{values:{}}):null;
var l=CDR.Filter.getFieldset("filters_comb",{values:{}});
var f=Message.Filter.getFieldset({values:{},disableTimeInterval:true});
var m=!b.customCleaning?Register.Filter.getFieldset({values:{},enableCalldate:true,enableSipCalleRD:true,enableNumFTC:true,enableNameFrom:true,enableDomainFTC:true,enableUsername:true,enableRealm:true,enableExpires:true,enableExpiresAt:true,enableState:true,enableUa:true,enableSensorId:true,prop:{fieldaWidth:__width_FieldChar(14),fieldbWidth:__width_FieldChar(14),fieldcWidth:__width_FieldChar(13),fieldwWidth:__width_FieldChar(40)-2}}):undefined;
var n=705;
var z=Math.max(w,n);
var g={xtype:"tabpanel",items:[{xtype:"container",items:{xtype:"container",items:o,style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:z,_id_container:"main_container"},border:false,width:z+__width_Scroller+4,autoScroll:true,title:this.findLangS("title","tabBasicData"),style:{"background-color":__color_FormBackground}}],border:false,width:z};
this.containerFilter_common=new Ext.Container({xtype:"container",items:A,title:this.findLangS("title","tabFilterCommon"),width:z,_stopCompleteField:true});
this.containerFilter_rtp=new Ext.Container({xtype:"container",items:q,title:this.findLangS("title","tabFilterRtp"),width:z,_stopCompleteField:true});
this.containerFilter_dscp=k?new Ext.Container({xtype:"container",items:k,title:this.findLangS("title","tabFilterDscp"),width:z,_stopCompleteField:true}):null;
this.containerFilter_filtersComb=new Ext.Container({xtype:"container",items:l,title:this.findLangS("title","tabFilterFiltersComb"),width:z,_stopCompleteField:true});
this.containerFilterMessage=new Ext.Container({xtype:"container",items:f,title:this.findLangS("title","tabFilterMessage"),width:z,_stopCompleteField:true});
if(m){this.containerFilterRegister=new Ext.Container({xtype:"container",items:m,title:this.findLangS("title","tabFilterReg"),width:z,_stopCompleteField:true})
}var t=[];
t.push(this.containerFilter_common,this.containerFilter_rtp);
if(this.containerFilter_dscp){t.push(this.containerFilter_dscp)
}t.push(this.containerFilter_filtersComb);
t.push(this.containerFilterMessage);
if(this.containerFilterRegister){t.push(this.containerFilterRegister)
}for(var u=0;
u<t.length;
u++){g.items.push({xtype:"container",items:{xtype:"container",items:t[u],style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:z},border:false,width:z+__width_Scroller+4,autoScroll:true,title:t[u].title,style:{"background-color":__color_FormBackground}})
}return({xtype:"container",layout:"anchor",items:{xtype:"container",layout:"fit",items:g,anchor:"-20, 0"}})
},fpConfig:{layout:"fit",autoHeight:false},ewConfig:{layout:"fit",width:Math.max(__width_FormChar(20,40)+__width_Scroller+30,705+20)+40,height:Math.min(Ext.dom.Element.getViewportHeight()-60,820)},propRecordText:function(d){return(d.descr)
},enableEdit:true,enableSearchX:true,_withoutFieldProp:"__filter",formFieldsElementFilters:[{id:"_id_container",value:"main_container"}]});
if(b.onlyCsvExports){b.extraParams={onlyCsvExports:true}
}if(window.debug){b.nextStdBar=[{text:"test",handler:function(){this.testRun()
},scope:this,_id:"testRun",disabled:true}]
}this.callParent([b]);
function c(l,g,f,m,k,h,d){return((!this.customCleaning?getDataArrayItem(arCrontabTypeAt,l):this.findLangS("text","at"))+" "+String(f.data.at_hour||0).lpad(2,"0")+lang.hourShort+":"+String(f.data.at_minute||0).lpad(2,"0")+lang.minuteShort)
}function a(l,g,f,m,k,h,d){if(!f.data.enable){l=renderStringStyle(l,{color:"grey",strike:true})
}return(l)
}},getDefaultValues:function(){return(!this.customCleaning?{enable:true,type:"create_csv_cdr",type_at:"at",every_day_align:true,use_last_record_id:true,start_shift_minutes:1,csv_send_in_attachment:!window.csvExportFolder}:{enable:true,type:"cleaning_cdr",at_hour:2,at_minute:0,custom_columns_group_by_direction:"asc",custom_columns_order_by_direction:"asc"})
},prepareDataForEdit:function(b){var a=null;
if(b.config_filter_cdr){a=Ext.decode(b.config_filter_cdr);
if(a){CDR.Filter.setValueFieldsFieldset_all(a,this.formPanel)
}}if(b.config_filter_message){configFilterMessage=Ext.decode(b.config_filter_message);
if(configFilterMessage){Message.Filter.setValueFieldsFieldset(configFilterMessage,this.formPanel)
}}if(b.config_filter_reg){configFilterReg=Ext.decode(b.config_filter_reg);
if(configFilterReg){Register.Filter.setValueFieldsFieldset(configFilterReg,this.formPanel)
}}CDR.Filter.loadTemplates(this.formPanel,a&&a.ffilterTemplate)
},prepareDataForSave:function(d){if(CDR.Filter.isDataSet(this.formPanel)){var c=CDR.Filter.fetchValuesFromFieldset_all_template(this.formPanel);
if(c){d.config_filter_cdr=Ext.encode(c)
}}else{d.config_filter_cdr=null
}if(Message.Filter.isDataSet(this.formPanel)){var b=Message.Filter.fetchValuesFromFieldset(this.formPanel);
if(b){d.config_filter_message=Ext.encode(b)
}}else{d.config_filter_message=null
}if(Register.Filter.isDataSet(this.formPanel)){var a=Register.Filter.fetchValuesFromFieldset(this.formPanel);
if(a){d.config_filter_reg=Ext.encode(a)
}}else{d.config_filter_reg=null
}},setContextItems:function(m,s,u,d,p,q,t){var h=this.getValueField("type");
if(!this.customCleaning){var g=this.getValueField("type_at");
var b=["create_csv_cdr","create_csv_message","create_csv_reg"].inArray(h);
var w=["create_csv_cdr","create_csv_message","create_csv_reg"].inArray(h);
var f=["type"];
var c=["type_at","at_hour","at_minute","every_day_align"];
var n=["time_interval","start_shift_minutes","use_last_record_id"];
var r=["send_to","send_from"];
var a=["csv_store_prefix","csv_send_in_attachment","csv_delete_after_days"];
var o=g=="every"&&(s.time_interval=="past_interval_by_schedule_every"||h=="create_csv_reg")&&(s.at_hour*60+s.at_minute)>0&&!((24*60)%(s.at_hour*60+s.at_minute));
this.showField(r,b);
this.showField(a,b&&window.csvExportFolder);
this.showField(n,w);
this.allowBlankField("time_interval",w?false:true);
this.enableField(f.concat(c,n,r,a),s.enable);
this.enableField(["at_hour","at_minute"],s.enable&&g);
this.enableField("every_day_align",s.enable&&o);
this.enableField("start_shift_minutes",s.enable&&(s.every_day_align&&o||g=="at"));
this.enableField("use_last_record_id",s.enable&&g=="every");
this.enableField("send_from",s.enable&&s.send_to);
this.allowBlankField(["at_hour","at_minute"],!s.enable||g=="every");
var l=this.getField("time_interval");
if(l){if(g=="at"){if(s.time_interval=="past_interval_by_schedule_every"){l.setValue(null)
}l.deleteMenuItem("past_interval_by_schedule_every")
}else{l.addMenuItem({id:"past_interval_by_schedule_every",descr:arLang.LtimeInterval_past_interval_by_schedule_every},false,false,0)
}}this.showField(["custom_columns_enable","custom_columns_config","custom_columns_group_by","custom_columns_group_by_direction","custom_columns_order_by","custom_columns_order_by_direction"],h=="create_csv_cdr");
this.fillCustomColumnsGroupAndOrderComboData();
var y=s.custom_columns_enable;
this.enableField("custom_columns_config",y);
var k=["custom_columns_group_by","custom_columns_order_by"];
for(var v=0;
v<k.length;
v++){var z=this.getField(k[v]);
if(z){this.enableField(k[v],y&&z.store.getCount())
}}this.enableField("custom_columns_group_by_direction",y&&this.getField("custom_columns_group_by").store.getCount()&&s.custom_columns_group_by);
this.enableField("custom_columns_order_by_direction",y&&this.getField("custom_columns_order_by").store.getCount()&&s.custom_columns_order_by)
}else{this.setFieldLabel("cleaning_db_records_enable",this.findLangS("field",h=="cleaning_cdr"?"cleaning_db_records_enable_cdr":"cleaning_db_records_enable_message"));
this.setFieldLabel("cleaning_sip_pcaps_enable",this.findLangS("field",h=="cleaning_cdr"?"cleaning_sip_pcaps_enable_cdr":"cleaning_sip_pcaps_enable_message"));
this.enableField("cleaning_db_records_older_than_days",s.cleaning_db_records_enable);
this.enableField("cleaning_sip_pcaps_older_than_days",s.cleaning_sip_pcaps_enable);
this.enableField("cleaning_rtp_pcaps_older_than_days",s.cleaning_rtp_pcaps_enable);
this.showField(["cleaning_rtp_pcaps_enable","cleaning_rtp_pcaps_older_than_days"],h=="cleaning_cdr")
}if(u=="loadrecord"){CDR.Filter.setContextFields(this.formPanel);
Message.Filter.setContextFields(this.formPanel);
Register.Filter.setContextFields(this.formPanel)
}this.containerFilter_common.ownerCt.ownerCt.tab.showIf(h=="create_csv_cdr"||h=="cleaning_cdr");
this.containerFilter_rtp.ownerCt.ownerCt.tab.showIf(h=="create_csv_cdr"||h=="cleaning_cdr");
if(this.containerFilter_dscp){this.containerFilter_dscp.ownerCt.ownerCt.tab.showIf(h=="create_csv_cdr"||h=="cleaning_cdr")
}this.containerFilter_filtersComb.ownerCt.ownerCt.tab.showIf(h=="create_csv_cdr"||h=="cleaning_cdr");
this.containerFilterMessage.ownerCt.ownerCt.tab.showIf(h=="create_csv_message"||h=="cleaning_message");
if(this.containerFilterRegister){this.containerFilterRegister.ownerCt.ownerCt.tab.showIf(h=="create_csv_reg")
}},fillCustomColumnsGroupAndOrderComboData:function(){var f=this.getCustomColumnsFields();
var a=["custom_columns_group_by","custom_columns_order_by"];
for(var d=0;
d<a.length;
d++){var g=this.getField(a[d]);
if(g){g.suspendEvents();
var c=g.getValue();
g.deleteAllMenuItems();
if(f){for(var b=0;
b<f.length;
b++){g.addMenuItem({id:Ext.decode(f[b]).field,descr:Ext.decode(f[b]).descr})
}}g.setValue(g.store.getById(c)?c:null);
g.resumeEvents()
}}},getCustomColumnsFields:function(){var d=this.getField("custom_columns_config");
if(!d){return(null)
}var c=d.getValue();
if(!c){return(null)
}var c=Ext.JSON.decode(c);
if(!c||!c.length){return(null)
}var a=[];
for(var b=0;
b<c.length;
b++){a.push(c[b].field)
}return(a)
},testRun:function(){var a=this.selModel.getSelection();
if(a.length){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"testRunCronTask",params:Ext.encode({id:a[0].data.id})},timeout:30*60*1000,maskEl:this})
}},onSelectionChange:function(a){var b=a.getSelection();
this.enableBtn("testRun",b&&b.length)
}});
Ext.define("CustomCleaning.Settings",{extend:"Ext.ux.setting.Form",subsystem:"crontab",constructor:function(a){Ext.applyIf(a,{settingTableName:"custom_cleaning_settings",settingTableStruct:rsCustomCleaningSettings,specItems:{enable_delete_records:{xtype:"checkbox"},enable_delete_pcaps:{xtype:"checkbox"}},promptSave:true});
this.callParent([a])
}});
Ext.define("Crontab.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.crontab_configurationPanelX",subsystem:"crontab",constructor:function(a){a=Ext.applyIf(a||{},{id:"crontab_configuration-panel",gridXType:"Crontab.GridX",titleLang:"crontabScheduler"});
this.callParent([a])
}});
Ext.define("CsvExports.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.report_csv_exportsPanelX",subsystem:"crontab",constructor:function(a){a=Ext.applyIf(a||{},{id:"report_csv_exports-panel",gridXType:"Crontab.GridX",gridConfig:{onlyCsvExports:true},titleLang:"csvExports"});
this.callParent([a])
}});
Ext.define("CustomCleaning.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.custom_cleaningPanelX",subsystem:"crontab",constructor:function(a){this.customCleaningGrid=new Crontab.Grid({title:this.findLangS("title","customCleaningRules"),customCleaning:true,flex:1});
this.settings=new CustomCleaning.Settings({title:this.findLangS("title","customCleaningSettings")});
a=Ext.applyIf(a||{},{id:"custom_cleaning-panel",items:{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"tabpanel",items:[this.customCleaningGrid,this.settings],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel},flex:1},{xtype:"panel",items:[{xtype:"displayfield",fieldClass:"x-form-field",value:this.findLangS("text","customCleaningMainInfo"),fieldStyle:{"font-style":"italic"},style:{padding:6}}],style:{"background-color":__color_PanelBackgroud,"border-top":"1px solid "+__color_PanelBorder},bodyStyle:{"background-color":__color_PanelBackgroud},autoHeight:true,border:false}]},titleLang:"customCleaning"});
this.callParent([a])
}});
Ext.ns("DailyReports");
Ext.ns("DailyReports.Sended");
Ext.define("DailyReports.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.DailyReports.GridX",subsystem:"alerts_daily_reports",constructor:function(d){var g=this;
var f=15;
d=Ext.applyIf(d||{},{storeId:"DailyReports",url:"php/model/sql.php",module:"daily_reports",recordStruct:rsDailyReports,sortField:"descr",remoteSort:true,columnsDefaults:{renderer:c},columns:[{readOnly:false,dataIndex:"descr",widthCh:20},{dataIndex:"report_type",widthCh:15,renderer:renderArrayData,renderer2:c,arrayData:arDailyReportType},{dataIndex:"report_last_days",widthNum:6,renderer:h,renderer2:c,align:"right",sortable:false},{dataIndex:"at_every",widthCh:10,renderer:k,renderer2:c,align:"right",sortable:false},{dataIndex:"timezone",widthCh:20},{dataIndex:"note",widthCh:50},{dataIndex:"last_run_at",renderer:renderDateTime,width:__width_ColumnDateTime}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:f,disableAutoAddTriggerWidth:true},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"checkFillCb",fpItems:function(C,z){var L=[[0,"min"],[1,"caller"],[2,"called"],[3,"by_rtp_ip"]];
for(var H=0;
H<L.length;
H++){L[H][1]=this.findLangS("combomenu",L[H][1])
}var Q=[[0,"max"],[1,"caller"],[2,"called"],[3,"by_rtp_ip"]];
for(var H=0;
H<Q.length;
H++){Q[H][1]=this.findLangS("combomenu",Q[H][1])
}var u=[{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_side",hideLabel:true,aData:L,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}}];
if(existsMosXrCdr){u.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_xr_avg_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_xr_avg_side",hideLabel:true,aData:L,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_xr_min_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_xr_min_side",hideLabel:true,aData:L,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}})
}if(existsMosSilenceCdr){u.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_silence_avg_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_silence_avg_side",hideLabel:true,aData:L,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"mos_silence_min_lt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"mos_silence_min_side",hideLabel:true,aData:L,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}})
}if(existsMosLqoCdr){u.push({xtype:"textfield",name:"mos_lqo_caller_lt",widthN:5,align:"right"},{xtype:"textfield",name:"mos_lqo_called_lt",widthN:5,align:"right"})
}u.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"packets_lost_perc_gt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"%",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator},flex:1},{xtype:"ComboBoxA",name:"packets_lost_side",hideLabel:true,aData:Q,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"jitter_gt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"jitter_side",hideLabel:true,aData:Q,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"container",layout:"vbox",items:[{xtype:"ComboBoxA",name:"delay_limit_ge",aData:arDelay,_clearButton:true,widthCh:15},{xtype:"textfield",name:"delay_count_gt",widthN:5,align:"right"}],height:__height_Form(2)-__height_FieldSeparator,widthCh:15},{flex:1,border:false},{xtype:"ComboBoxA",name:"delay_side",hideLabel:true,aData:Q,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}});
if(existsCdrSilence){u.push({xtype:"container",layout:{type:"hbox",align:"middle"},items:[{xtype:"container",layout:"vbox",items:[{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"silence_gt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"%",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"silence_end_gt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"s",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}}],height:__height_Form(2)-__height_FieldSeparator,widthCh:15},{flex:1,border:false},{xtype:"ComboBoxA",name:"silence_side",hideLabel:true,aData:Q,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}})
}if(existsCdrClipping){u.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"clipping_gt",widthN:5,align:"right"},{flex:1,border:false},{xtype:"ComboBoxA",name:"clipping_side",hideLabel:true,aData:Q,widthCh:12,style:{marginRight:6},fieldStyle:{background:__color_FormBackground}}],style:{marginBottom:__height_FieldSeparator}})
}u.push({xtype:"CBX_cbIpGroups",name:"cb_rtp_ip_groups_id",_clearButton:true,_editTableButton:user_can_edit_codebooks(),width:__width_FormChar(f,34),labelWidth:__width_FieldChar(f)},{xtype:"textarea",name:"rtp_ip",width:__width_FormChar(f,34),labelWidth:__width_FieldChar(f)},{xtype:"container",layout:{type:"table",columns:2},items:[{xtype:"checkbox",name:"one_way",widthCh:2},{xtype:"checkbox",name:"without_stream",labelWidth:__width_FieldChar(10),widthCh:2}],border:false,bodyStyle:__style_FormBackground()});
var t=[{xtype:"textfield",name:"duration_gt",widthN:5,align:"right"},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"pdd_gt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"<",fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"pdd_lt",widthN:5,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}}];
var E=[{xtype:"CBX_cbIpGroups",name:"cb_pmd_proxy_ip_groups_id",_clearButton:true,_editTableButton:user_can_edit_codebooks()},{xtype:"textarea",name:"pmd_proxy_ip",allowBlank:false},{xtype:"textfield",name:"pmd_mos_border_1",widthN:5,align:"right",allowBlank:false},{xtype:"textfield",name:"pmd_mos_border_2",widthN:5,align:"right",allowBlank:false},{xtype:"ComboBoxX",name:"pmd_cdr_custom_headers_id",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"cdr_custom_headers",recordStruct:rsCdrCustomHeaders,sortField:"name",columns:[{fields:"name",widthCh:30}],editable:false,allowBlank:false,_infoEmpty:this.findLangS("combobox_emptyinfo","cdr_custom_headers_id")},{xtype:"checkbox",name:"pmd_detail"}];
var N=cloneArray(arColumnsCDRstat);
for(var H=0;
H<N.length;
H++){N[H]=[N[H],findLangS("dashboard_d","menu",N[H])]
}var q=[{xtype:"ComboBoxA",name:"cdr_sum_type",aData:[["lastSIPresponse",this.findLangS("combomenu","sip_response")],["sipcallerip",this.findLangS("combomenu","sip_caller_ip")],["sipcalledip",this.findLangS("combomenu","sip_called_ip")],["caller",this.findLangS("combomenu","caller_number")],["called",this.findLangS("combomenu","called_number")],["a_ua",this.findLangS("combomenu","ua_caller")],["b_ua",this.findLangS("combomenu","ua_called")],["country_by_sipcallerip",this.findLangS("combomenu","country_sip_caller_ip")],["country_by_sipcalledip",this.findLangS("combomenu","country_sip_called_ip")],["country_by_caller",this.findLangS("combomenu","country_caller_number")],["country_by_called",this.findLangS("combomenu","country_called_number")],["number_of_calls",this.findLangS("combomenu","number_of_calls")],["by_minutes",this.findLangS("combomenu","by_minutes")],["by_hours",this.findLangS("combomenu","by_hours")],["by_days",this.findLangS("combomenu","by_days")]],widthCh:25},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield_h16",value:this.findLangS("field","columns")+":",width:__width_FieldChar(f),fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"priorityTable",tableItems:N,name:"cdr_sum_columns",width:__width_FieldChar(35),height:300,onChange:this.onChangePriorityTable,onChangeScope:this}],style:{marginBottom:__height_FieldSeparator},_id:"cdr_sum_columns"},{xtype:"ComboBoxA",name:"cdr_sum_sort_by",aData:[],widthCh:30},{xtype:"ComboBoxA",name:"cdr_sum_sort_dir",aData:[["ASC",findLangS("dashboard_d","combomenu","ascending")],["DESC",findLangS("dashboard_d","combomenu","descending")]],widthCh:30},{xtype:"numberfield",name:"cdr_sum_max_rows",minValue:0,maxValue:10000,widthN:7,align:"right"}];
var A=[{xtype:"ComboBoxA",name:"cc_interval_type",aData:[[_cc_interval_minute,this.findLangS("combomenu","cc_interval_minute")],[_cc_interval_hour,this.findLangS("combomenu","cc_interval_hour")],[_cc_interval_day,this.findLangS("combomenu","cc_interval_day")]],widthCh:20},{xtype:"numberfield",name:"cc_interval_count",minValue:1,maxValue:60*24*7,widthN:7,align:"right",allowBlank:false},{xtype:"numberfield",name:"cc_interval_agregation",minValue:0,maxValue:100,widthN:7,align:"right"},{xtype:"CBX_weekday",name:"cc_interval_days_of_week",multiSelect:true,_arraySeparator:",",_clearButton:true}];
var l=[{xtype:"checkbox",name:"chart_enable_shadow"},{xtype:"checkbox",name:"send_pdf"},{xtype:"ComboBoxA",name:"chart_pdf_image_format",aData:arFileFormat_Image_SvgPng,widthCh:8},{xtype:"checkbox",name:"pdf_page_orientation"}];
var o=[{name:"descr",allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"enable",widthCh:2},{xtype:"displayfield_h16",value:this.findLangS("field","at")+":",fieldClass:"x-form-field",style:{marginLeft:27,marginRight:__width_FieldSeparator},_id:"label_at"},{xtype:"ComboBoxA",name:"at_or_every",aData:[["at",this.findLangS("text","at")],["every",this.findLangS("text","every")]],hideLabel:true,width:__width_FieldChar(5)+__width_Trigger,fieldStyle:{"text-align":"right",background:__color_FormBackground}},{xtype:"numberfield",name:"at_hour",minValue:0,maxValue:23,allowBlank:false,widthN:4,align:"right",hideLabel:true,style:{marginLeft:__width_FieldSeparator}},{xtype:"displayfield_h16",value:lang.hourShort+" :",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator},_id:"label_after_at_hour"},{xtype:"numberfield",name:"at_min",minValue:0,maxValue:59,allowBlank:false,widthN:4,align:"right",hideLabel:true},{xtype:"displayfield_h16",value:lang.minuteShort,fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator},_id:"label_after_at_min"},{xtype:"numberfield",name:"every_min",minValue:1,maxValue:24*60,allowBlank:false,widthN:6,align:"right",hideLabel:true,style:{marginLeft:__width_FieldSeparator}},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator},_id:"label_after_every_min"}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"every_interval_offset_min",minValue:0,maxValue:120,labelWidth:__width_FieldChar(25)+2,width:__width_Form(__width_FieldChar(25)+2,__width_FieldNum(3)+__width_Trigger),align:"right"},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator},_id:"label_after_every_interval_offset_min"}],_id:"every_interval_offset_min",style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"at_hour_of_day_from",labelWidth:__width_FieldChar(25)+2,width:__width_Form(__width_FieldChar(25)+2,__width_FieldNum(2)+__width_Trigger),minValue:0,maxValue:23},{xtype:"displayfield_h16",value:"-",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",hideLabel:true,name:"at_hour_of_day_to",width:__width_FieldNum(2)+__width_Trigger,minValue:0,maxValue:23}],style:{marginBottom:__height_FieldSeparator},_id:"at_hour_of_day_from_to"},{xtype:"CBX_weekday",name:"at_day_of_week",labelWidth:__width_FieldChar(25)+2,width:__width_Form(__width_FieldChar(16),__width_FieldChar(25)+2),multiSelect:true,_arraySeparator:",",_clearButton:true},{xtype:"numberfield",name:"at_day_of_month",minValue:1,maxValue:31,labelWidth:__width_FieldChar(25)+2,width:__width_Form(__width_FieldNum(4),__width_FieldChar(25)+2),widthN:4,align:"right",enableKeyEvents:true},{xtype:"ComboBoxA",name:"report_type",aData:arDailyReportType,allowBlank:false,aeFilter:user_create_only_private_reports()?[_EmailDailyReportType_ConcurrentCallStat_license_chart]:undefined},{xtype:"container",layout:"hbox",_id:"last_days_month",items:[{xtype:"numberfield",name:"report_last_days",minValue:1,maxValue:365,widthN:5,align:"right"},{xtype:"ComboBoxA",name:"report_whole_month",aData:{data:["current","previous"],descrSubsystem:this.subsystem,descrTypeItem:"combomenu"},_clearButton:true,labelWidth:__width_FieldChar(12),flex:1}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",_id:"maximum_oldest_cdr",items:[{xtype:"numberfield",name:"maximum_oldest_cdr_hour",minValue:0,maxValue:168,widthN:5,align:"right"},{xtype:"displayfield_h16",value:"["+lang.hourShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"maximum_oldest_cdr_min",hideLabel:true,minValue:0,maxValue:60,widthN:5,align:"right"},{xtype:"displayfield_h16",value:"["+lang.minuteShort2+"]",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{xtype:"ComboBoxA",name:"send_if",fieldLabelLang:"send_if_report",aData:arSendAlertReportIf,allowBlank:false},{xtype:"container",items:[{xtype:"container",_paramsName:"_paramsRTP1",defaultType:"textfield",items:[{xtype:"fieldset",items:u,title:this.findLangS("title","incidentsRules"),width:__width_FormChar(f,36),style:__style_RedukFieldSet()},{xtype:"container",items:t}]},{xtype:"container",_paramsName:"_paramsPMD",defaultType:"textfield",items:E},{xtype:"container",_paramsName:"_paramsCDRsum",defaultType:"textfield",items:q},{xtype:"container",_paramsName:"_paramsCCS",defaultType:"textfield",items:A},{xtype:"container",_paramsName:"_paramsChart",items:l,hidden:true},{xtype:"container",_paramsName:"_paramsNULL"}],width:"100%"},{xtype:"box",_id:"csv_params_hr",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:10,marginBottom:5}}},{xtype:"container",layout:"hbox",_id:"csv_params",items:[{xtype:"checkbox",name:"cdr_report_in_attachment",widthN:5,labelWidth:__width_FieldChar(20)},{xtype:"displayfield_h16",value:this.findLangS("field","cdr_report_max_lines_in_body"),fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator},_id:"cdr_report_max_lines_in_body_label"},{xtype:"textfield",name:"cdr_report_max_lines_in_body",widthN:5,align:"right",hideLabel:true}],style:{marginBottom:__height_FieldSeparator}}];
var D=[];
if(C.rslt.fill_cb_ip_groups*1){D.push({xtype:"CBX_cbIpGroups",_clearButton:true,_editTableButton:user_can_edit_codebooks()})
}D.push({xtype:"textarea",name:"ip"});
if(C.rslt.fill_cb_number_groups*1){D.push({xtype:"CBX_cbNumberGroups",_clearButton:true,_editTableButton:user_can_edit_codebooks()})
}D.push({xtype:"textarea",name:"number"});
var M=[{xtype:"ComboBoxA",name:"timezone",valueField:"name",displayField:"name",aData:{data:window.timezones,fields:["name"]},_clearButton:true},{xtype:"container",items:[{xtype:"container",_paramsName:"_paramsRTP2",defaultType:"textfield",items:D},{xtype:"container",_paramsName:"_paramsNULL"}],width:"100%"}];
if(C.rslt.fill_cb_email_groups*1){M.push({xtype:"CBX_cbEmailGroups",allowBlank:false,_clearButton:true,_editTableButton:user_can_edit_codebooks()})
}M.push({xtype:"checkbox",name:"enable_hyperlinks"},{xtype:"textarea",name:"email",enableKeyEvents:true,allowBlank:C.rslt.fill_cb_email_groups*1},{xtype:"textarea",name:"note"},{xtype:"checkbox",name:"add_note2email"});
M.push({xtype:"container",_paramsName:"_paramsRTP",items:[{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"custom_columns_enable",width:__width_FieldChar(20)},{xtype:"checkbox",name:"custom_columns_after_std",labelWidth:__width_FieldChar(27)}]},{xtype:"container",layout:"hbox",items:[{xtype:"container",width:__width_FieldChar(f)+__width_FieldSeparator},{xtype:"priorityTable",name:"custom_columns_config",height:300,dataArray:true,dataEnable:true,dataRenderer:function(S){var R="";
S=Ext.decode(S);
if(S.top||S.bottom){if(S.top){R+=Ext.decode(S.top).descr
}if(S.bottom){R+="<br>"+Ext.decode(S.bottom).descr
}}return(R)
},tbarAdd:true,tbarRemove:true,titleAdd:this.findLangS("title","addCustomColumn"),titleEdit:this.findLangS("title","editCustomColumn"),editPanel:function(W){var T=getDataCdrSelectColumns({alert_rtp_columns:true});
var Z=[];
for(var V=0;
V<T.length;
V++){Z.push([Ext.encode(T[V]),T[V].descr])
}var U=W?Ext.decode(W.data.data):null;
var X={items:[{xtype:"fieldset",title:g.findLangS("field_custom_columns","top"),style:__style_RedukFieldSet(),items:[{xtype:"ComboBoxA",name:"top",value:U?U.top:null,fieldLabel:g.findLangS("field_custom_columns","field"),editable:false,aData:Z,_clearButton:true,width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)},{xtype:"textfield",name:"top_header",value:U?U.top_header:null,fieldLabel:g.findLangS("field_custom_columns","header"),width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)}]},{xtype:"fieldset",title:g.findLangS("field_custom_columns","bottom"),style:__style_RedukFieldSet(),items:[{xtype:"ComboBoxA",name:"bottom",value:U?U.bottom:null,fieldLabel:g.findLangS("field_custom_columns","field"),editable:false,aData:Z,_clearButton:true,width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)},{xtype:"textfield",name:"bottom_header",value:U?U.bottom_header:null,fieldLabel:g.findLangS("field_custom_columns","header"),width:__width_FormChar(30,10),labelWidth:__width_FieldChar(10)}]}]};
var Y=[{text:lang.okButtonText,iconCls:"icon_ok",handler:R,scope:this}];
Ext.applyIf(X,{frame:true,border:false,autoHeight:true,labelAlign:"right",waitMsgTarget:true,buttons:Y});
var S=new Ext.FormPanel(X);
function R(){var aa=S.getForm().getFieldValues();
if(W){this.modifyData(W,aa)
}else{aa.enable=true;
this.addData(aa)
}S.findWindow().close()
}return(S)
},flex:1}]}],style:{marginTop:10},hidden:true});
var P=CDR.Filter.getFieldset("common",{values:{},disableTimeInterval:true,disableSelections:true});
var K=CDR.Filter.getFieldset_template({disableTimeInterval:true,disableSelections:true});
P.splice(0,0,{xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:0,marginBottom:5}}});
P.splice(0,0,K);
var y=CDR.Filter.getFieldset("rtp",{values:{}});
var n=window.existsDscpCdr?CDR.Filter.getFieldset("dscp",{values:{}}):null;
var r=CDR.Filter.getFieldset("filters_comb",{values:{}});
var J=__width_FormChar(f,35)*2+__width_Scroller;
var s=705;
var O=Math.max(J,s);
var v={xtype:"container",layout:"hbox",items:[{xtype:"container",flex:1,defaultType:"textfield",items:o},{xtype:"container",flex:1,items:M}],width:O};
var I={xtype:"container",layout:"hbox",items:[],width:O};
var B={xtype:"fieldset",title:this.findLangS("title","userRestrictions"),items:[],style:__style_RedukFieldSet(),width:O};
var p=20;
var G=__width_FieldChar(p);
if(login_table()=="users"){if(user_is_admin()){B.items.push({xtype:"ComboBoxX",name:"owner_uid",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],widthCh:30,editable:false,disabled:!user_is_admin(),labelWidthForceCh:p,_clearButton:true})
}else{if(!z){B.items.push({xtype:"textfield",name:"owner_name",fieldLabelLang:"owner_uid",labelWidthForceCh:p,disabled:true})
}}}if(user_is_admin()||!z){B.items.push({xtype:"checkbox",name:"use_user_restriction",labelCh:25,labelWidthForceCh:p})
}if(!user_create_only_private_reports()||!z){B.items.push({xtype:"checkbox",name:"private",labelWidthForceCh:p})
}if(login_table()=="users"&&(user_is_admin()||group_id())){for(var w=1;
w<=2;
w++){if(user_is_admin()){B.items.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.findLangS("field",w==1?"read_permission":"write_permission")+":",width:G+__width_LabelFieldSeparator},{xtype:"ComboBoxX",name:"user_ids_"+(w==1?"read":"write"),width:__width_FormChar(5,30),labelWidth:__width_FieldChar(5),fieldLabel:this.findLangS("field","users"),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true},{xtype:"ComboBoxX",name:"group_ids_"+(w==1?"read":"write"),width:__width_FormChar(5,30),labelWidth:__width_FieldChar(5),fieldLabel:this.findLangS("field","groups"),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"group_list",recordStruct:rsGroupList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true,style:{marginLeft:__width_FieldSeparator*2}}],width:"100%",style:{marginBottom:__height_FieldSeparator}})
}else{B.items.push({xtype:"ComboBoxX",name:"user_ids_"+(w==1?"read":"write"),width:__width_FormChar(p,30),labelWidth:__width_FieldChar(p),fieldLabel:this.findLangS("field",w==1?"read_permission":"write_permission"),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,_autoDisableIfEmpty:true})
}}}if(B.items.length){I.items.push(B)
}var m={xtype:"tabpanel",items:[{xtype:"container",items:{xtype:"container",items:v,style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:O},border:false,width:O+__width_Scroller+4,autoScroll:true,title:this.findLangS("tab","basicData"),style:{"background-color":__color_FormBackground}}],border:false,width:O};
this.containerFilter_common=new Ext.Container({xtype:"container",items:P,title:this.findLangS("tab","filterCommon"),width:O,_stopCompleteField:true});
this.containerFilter_rtp=new Ext.Container({xtype:"container",items:y,title:this.findLangS("tab","filterRtp"),width:O,_stopCompleteField:true});
this.containerFilter_dscp=n?new Ext.Container({xtype:"container",items:n,title:this.findLangS("tab","filterDscp"),width:O,_stopCompleteField:true}):null;
this.containerFilter_filtersComb=new Ext.Container({xtype:"container",items:r,title:this.findLangS("tab","filterFiltersComb"),width:O,_stopCompleteField:true});
if(B.items.length){this.containerOtherSettings=new Ext.Container({xtype:"container",items:I,title:this.findLangS("tab","otherSettings"),width:O})
}else{if(this.containerOtherSettings){delete this.containerOtherSettings
}}var F=[];
F.push(this.containerFilter_common,this.containerFilter_rtp);
if(this.containerFilter_dscp){F.push(this.containerFilter_dscp)
}F.push(this.containerFilter_filtersComb);
if(this.containerOtherSettings){F.push(this.containerOtherSettings)
}for(var H=0;
H<F.length;
H++){m.items.push({xtype:"container",items:{xtype:"container",items:F[H],style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:O},border:false,width:O+__width_Scroller+4,autoScroll:true,title:F[H].title,style:{"background-color":__color_FormBackground}})
}return({xtype:"container",layout:"anchor",items:{xtype:"container",layout:"fit",items:m,anchor:"-20, 0"}})
},fpConfig:{layout:"fit",autoHeight:false},ewConfig:{layout:"fit",width:Math.max(__width_FormChar(f,35)*2+__width_Scroller+30,705)+40,height:Math.min(Ext.dom.Element.getViewportHeight()-60,765)},propRecordText:function(l){return(l.descr)
},enableEdit:true,enableSearchX:true,confirmDeleteRuleText:function(l,p){var o=0;
if(l.length>1){for(var m=0;
m<l.length;
m++){o+=l[m].data.count_sent
}}else{o=l[0].data.count_sent
}var n=p;
if(o>0){n+='<br><br><i style="color: red;">'+this.findLangS("text","infoDeleteSentReports").template([o])+"</i>"
}return n
},plugins:[{ptype:"rowexpander",rowBodyContentCls:"DailyReports.GridExpPanel",expandOnEnter:false,expandOnDblClick:false,enableExpand:function(l){return(l.data.report_type==_EmailDailyReportType_Chart)
}}],nextStdBar:[{text:findLangSd("grid","reload"),iconCls:"icon_reload",handler:function(){this.reload()
},scope:this},{text:this.findLangS("button","preview_report"),iconCls:"icon_magnifier",handler:a,scope:this,_id:"previewReport",disabled:true},{text:this.findLangS("button","send_report"),iconCls:"icon_email_send",handler:b,scope:this,_id:"sendReport",disabled:true}],prefixCls:"daily_reports",stripeRows:false,_withoutFieldProp:"__filter",contextMenu:function(l,m){if(this.isEnableEditRecord(l)){return([{text:this.findLangS("text","deleteSentReports"),iconCls:"icon_cancel",handler:function(){Ext.Msg.confirm("",this.findLangS("text","deleteSentReportsQuestion"),function(n){if(n=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"deleteSentReports",params:Ext.encode({report_id:l.data.id})},maskEl:this})
}},this)
},scope:this}])
}else{return(null)
}},subjectLang:"daily_report"});
this.callParent([d]);
function a(){var l=this.selModel.getSelection();
if(l.length){beginLoadMaskWithStopButton_ajax(mviewport,"previewReport_loadMask");
var m=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"previewAlert",params:Ext.encode({report:true,id:l[0].data.id}),timestampId:mviewport._loadMask_timestampId},success:function(o){var r=Ext.dom.Element.getViewportWidth()-20;
var q=Math.min(850,Ext.dom.Element.getViewportWidth()-20);
var n=Ext.dom.Element.getViewportHeight()-50;
var p=new Ext.Window({title:l[0].data.descr,iconCls:"icon_magnifier",closable:true,maximizable:true,resizable:true,layout:"fit",items:{layout:"fit",xtype:"panel",html:o.report,width:q,height:n,border:false,autoScroll:true,bodyStyle:{padding:5}}});
p.show();
endLoadMaskWithStopButton_ajax(mviewport)
},error2:function(){endLoadMaskWithStopButton_ajax(mviewport)
},failure:function(n){if(!m._aborted){alertAjaxFailure(n)
}endLoadMaskWithStopButton_ajax(mviewport)
},timeout:(window.report_timeout||30*60)*1000});
startLoadMaskWithStopButton_ajax(mviewport,m)
}}function b(){var l=this.selModel.getSelection();
if(l.length){beginLoadMaskWithStopButton_ajax(mviewport,"sendReport_loadMask");
var m=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"sendAlert",params:Ext.encode({report:true,id:l[0].data.id}),timestampId:mviewport._loadMask_timestampId},success:function(n){alertAjaxSuccess(this.findLangS("text","reportSent"));
endLoadMaskWithStopButton_ajax(mviewport)
},error2:function(){endLoadMaskWithStopButton_ajax(mviewport)
},failure:function(n){if(!m._aborted){alertAjaxFailure(n)
}endLoadMaskWithStopButton_ajax(mviewport)
},timeout:(window.report_timeout||30*60)*1000});
startLoadMaskWithStopButton_ajax(mviewport,m)
}}function k(q,n,m,r,p,o,l){if(!m.data.at_or_every||m.data.at_or_every=="at"){return(l.grid.findLangS("text","at")+" "+String(m.data.at_hour||0).lpad(2,"0")+lang.hourShort+":"+String(m.data.at_min||0).lpad(2,"0")+lang.minuteShort)
}else{return(l.grid.findLangS("text","every")+" "+m.data.every_min+lang.minuteShort)
}}function h(r,o,n,s,q,p,m){if(n.data.report_type==_EmailDailyReportType_RTP||n.data.report_type==_EmailDailyReportType_ProxyDegradMOS||n.data.report_type==_EmailDailyReportType_CdrSummary){if(!n.data.at_or_every||n.data.at_or_every=="at"){if(n.data.report_whole_month=="current"||n.data.report_whole_month=="previous"){return('<span style="font-size: 80%; line-height: 80%;">'+(n.data.report_whole_month=="current"?lang.current:lang.previous)+"<br>"+lang.month+"</span>")
}else{return(r||1)
}}else{if(n.data.maximum_oldest_cdr_hour||n.data.maximum_oldest_cdr_min){var l="";
if(n.data.maximum_oldest_cdr_hour){l+=n.data.maximum_oldest_cdr_hour+lang.hourShort
}if(n.data.maximum_oldest_cdr_min){if(l){l+=", "
}l+=n.data.maximum_oldest_cdr_min+lang.minuteShort
}return(l)
}else{return(n.data.every_min+lang.minuteShort)
}}}else{return("")
}}function c(q,n,m,r,p,o,l){if(m.data.disable*1||m.data.disable=="on"){q=renderStringStyle(q,{color:"grey",strike:true})
}return(q)
}},getDefaultValues:function(){return{at_or_every:"at",every_min:60,every_interval_offset_min:15,report_type:_EmailDailyReportType_RTP,report_last_days:1,chart_enable_shadow:true,chart_pdf_image_format:_FileFormat_Image_Svg,send_pdf:true,pdf_page_orientation:false,enable:true,enable_hyperlinks:true,add_note2email:false,send_if:0,at_hour:0,at_min:1,mos_side:0,mos_xr_avg_side:0,mos_xr_min_side:0,mos_silence_avg_side:0,mos_silence_min_side:0,packets_lost_side:0,jitter_side:0,delay_side:0,silence_side:0,clipping_side:0,cdr_sum_type:"sipcallerip",cdr_sum_columns:"acd_all,mos_all",cdr_sum_sort_by:"cnt_all",cdr_sum_sort_dir:"DESC",cc_interval_type:_cc_interval_day,cc_interval_count:30,owner_uid:user_id(),"private":user_create_only_private_reports(),use_user_restriction:!user_is_admin()}
},prepareDataForEdit:function(b){b.enable=!(b.disable*1||b.disable=="on");
b.enable_hyperlinks=!(b.disable_hyperlinks*1||b.disable_hyperlinks=="on");
if(!b.at_or_every){b.at_or_every="at"
}if(!b.every_min){b.every_min=60
}var a=null;
if(b.config_filter_cdr){a=Ext.decode(b.config_filter_cdr);
if(a){CDR.Filter.setValueFieldsFieldset_all(a,this.formPanel)
}}CDR.Filter.loadTemplates(this.formPanel,a&&a.ffilterTemplate)
},prepareDataForSave:function(b){b.disable=!b.enable;
b.disable_hyperlinks=!b.enable_hyperlinks;
if(!b.at_day_of_week){b.at_day_of_week=null
}if(!b.at_day_of_month){b.at_day_of_month=null
}if(CDR.Filter.isDataSet(this.formPanel)){var a=CDR.Filter.fetchValuesFromFieldset_all_template(this.formPanel);
if(a){b.config_filter_cdr=Ext.encode(a)
}}else{b.config_filter_cdr=null
}},setContextItems:function(k,r,w,c,o,p,t){if(w=="loadrecord"||w=="select"&&c&&c.name=="report_type"){var D=w=="loadrecord"?r.report_type:o;
var s="_params"+(D==_EmailDailyReportType_RTP?"RTP":D==_EmailDailyReportType_ProxyDegradMOS?"PMD":D==_EmailDailyReportType_CdrSummary?"CDRsum":D==_EmailDailyReportType_ConcurrentCallStat?"CCS":D==_EmailDailyReportType_Chart?"Chart":D==_EmailDailyReportType_ConcurrentCallStat_license_chart?"CCS_license_chart":"NULL");
var m=["_paramsNULL","_paramsRTP","_paramsPMD","_paramsCDRsum","_paramsCCS","_paramsChart"];
for(var y=0;
y<m.length;
y++){for(var v=0;
v<=2;
v++){var g=this.getFormItem(m[y]+(v?v:""),"_paramsName",true);
if(g){if(m[y]==s){g.show();
g.updateLayout()
}else{g.hide()
}}}}this.updateLayout()
}var b=r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_CdrSummary||r.report_type==_EmailDailyReportType_Chart;
this.showItemBy("_id","label_at",!b);
this.showField("at_or_every",b);
var h=!b||r.at_or_every=="at";
var B=b&&r.at_or_every=="every";
if(b){var d=this.getField("at_or_every");
if(d){d.setWidth(__width_FieldChar(h?3:5)+__width_Trigger+(h?4:0))
}}this.showField("at_hour",h);
this.allowBlankField("at_hour",!h);
this.showItemBy("_id","label_after_at_hour",h);
this.showField("at_min",h);
this.allowBlankField("at_min",!h);
this.showItemBy("_id","label_after_at_min",h);
this.showField("every_min",!h);
this.allowBlankField("every_min",h);
this.showItemBy("_id","label_after_every_min",!h);
this.showItemBy("_id","at_hour_of_day_from_to",!h);
var z=h&&(r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||r.report_type==_EmailDailyReportType_CdrSummary);
this.showField("report_last_days",z);
this.showField("report_whole_month",z);
this.showItemBy("_id","last_days_month",z);
this.enableField("report_last_days",!r.report_whole_month);
this.showItemBy("_id","every_interval_offset_min",B&&(r.report_type==_EmailDailyReportType_Chart||r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||r.report_type==_EmailDailyReportType_CdrSummary));
this.showItemBy("_id","maximum_oldest_cdr",B&&(r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||r.report_type==_EmailDailyReportType_CdrSummary));
var C=r.mos_side==3||r.mos_xr_avg_side==3||r.mos_xr_min_side==3||r.mos_silence_avg_side==3||r.mos_silence_min_side==3||r.packets_lost_side==3||r.jitter_side==3||r.delay_side==3||r.silence_side==3||r.clipping_side==3;
this.showField(["cb_rtp_ip_groups_id","rtp_ip"],C);
this.allowBlankField("rtp_ip",!(r.report_type==_EmailDailyReportType_RTP&&C&&!r.cb_rtp_ip_groups_id));
this.allowBlankField("pmd_proxy_ip",!(r.report_type==_EmailDailyReportType_ProxyDegradMOS&&!r.cb_pmd_proxy_ip_groups_id));
this.allowBlankField(["pmd_mos_border_1","pmd_mos_border_2","pmd_cdr_custom_headers_id"],!(r.report_type==_EmailDailyReportType_ProxyDegradMOS));
this.allowBlankField("cc_interval_type",!(r.report_type==_EmailDailyReportType_ConcurrentCallStat));
this.allowBlankField("cc_interval_count",!(r.report_type==_EmailDailyReportType_ConcurrentCallStat));
if(!(r.report_type==_EmailDailyReportType_ConcurrentCallStat)&&r.cc_interval_count===0){this.setValueField("cc_interval_count",null);
r.cc_interval_count=null
}this.enableFieldIf(["custom_columns_after_std","custom_columns_config"],r.custom_columns_enable);
this.showField("cc_interval_agregation",r.cc_interval_type==_cc_interval_minute||r.cc_interval_type==_cc_interval_hour);
this.showField("cc_interval_days_of_week",r.cc_interval_type==_cc_interval_day);
this.showItemBy("_id","csv_params_hr",r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||(r.report_type==_EmailDailyReportType_CdrSummary&&r.cdr_sum_type!="number_of_calls")||r.report_type==_EmailDailyReportType_ConcurrentCallStat);
this.showItemBy("_id","csv_params",r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||(r.report_type==_EmailDailyReportType_CdrSummary&&r.cdr_sum_type!="number_of_calls")||r.report_type==_EmailDailyReportType_ConcurrentCallStat);
var A=this.getField("cdr_report_in_attachment");
if(A&&A.labelEl&&A.labelEl.dom){A.labelEl.dom.innerHTML=this.findLangS("field",r.report_type==_EmailDailyReportType_ConcurrentCallStat?"report_in_attachment":"cdr_report_in_attachment")+":"
}this.showItemBy("_id","cdr_report_max_lines_in_body_label",r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||(r.report_type==_EmailDailyReportType_CdrSummary&&r.cdr_sum_type!="number_of_calls"&&r.cdr_sum_type!="by_minutes"&&r.cdr_sum_type!="by_hours"&&r.cdr_sum_type!="by_days"));
this.showField("cdr_report_max_lines_in_body",r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||(r.report_type==_EmailDailyReportType_CdrSummary&&r.cdr_sum_type!="number_of_calls"&&r.cdr_sum_type!="by_minutes"&&r.cdr_sum_type!="by_hours"&&r.cdr_sum_type!="by_days"));
if(r.report_type==_EmailDailyReportType_CdrSummary){this.showField(["cdr_sum_sort_by","cdr_sum_sort_dir","cdr_sum_max_rows"],r.cdr_sum_type!="number_of_calls"&&r.cdr_sum_type!="by_minutes"&&r.cdr_sum_type!="by_hours"&&r.cdr_sum_type!="by_days");
this.showItemBy("_id","cdr_sum_columns",r.cdr_sum_type!="number_of_calls")
}var q=this.getField("email").getValue();
var a=this.getField("cb_email_groups_id");
if(a){a.allowBlank=q;
if(q){a.clearInvalid()
}}this.showField("send_if",r.report_type==_EmailDailyReportType_RTP||r.report_type==_EmailDailyReportType_ProxyDegradMOS||r.report_type==_EmailDailyReportType_ConcurrentCallStat||r.report_type==_EmailDailyReportType_CdrSummary);
this.enableField("chart_pdf_image_format",r.send_pdf);
this.enableField("pdf_page_orientation",r.send_pdf);
this.enableField("at_day_of_week",!r.at_day_of_month);
this.enableField("at_day_of_month",!r.at_day_of_week);
this.showField("timezone",r.report_type!=_EmailDailyReportType_ConcurrentCallStat_license_chart);
if(w=="loadrecord"){CDR.Filter.setContextFields(this.formPanel)
}var n=r.report_type!=_EmailDailyReportType_Chart&&r.report_type!=_EmailDailyReportType_ConcurrentCallStat_license_chart;
this.containerFilter_common.ownerCt.ownerCt.tab.showIf(n);
this.containerFilter_rtp.ownerCt.ownerCt.tab.showIf(n);
if(this.containerFilter_dscp){this.containerFilter_dscp.ownerCt.ownerCt.tab.showIf(n)
}this.containerFilter_filtersComb.ownerCt.ownerCt.tab.showIf(n);
if(this.containerOtherSettings){var u=r.owner_uid||this.dataForEdit.owner_uid;
var l=this.getValueField("private");
this.enableFieldIf("owner_uid",user_is_admin());
this.enableFieldIf("private",user_is_admin()?r.owner_uid:user_id()==u&&!user_create_only_private_reports());
this.enableFieldIf("use_user_restriction",user_is_admin()&&r.owner_uid);
this.enableFieldIf(["user_ids_read","group_ids_read","user_ids_write","group_ids_write"],l&&(user_is_admin()?r.owner_uid:user_id()==u))
}},onSelectionChange:function(a){var b=a.getSelection();
this.enableBtn("previewReport",b&&b.length);
this.enableBtn("sendReport",b&&b.length)
},onStoreLoad:function(b,a,d,c){if(window.reportId){this.editRecord(window.reportId);
delete window.reportId
}},onChangePriorityTable:function(){var d=this.formPanel.getForm().findField("cdr_sum_columns");
var a=this.formPanel.getForm().findField("cdr_sum_sort_by");
if(!d||!a){return
}var c=d.getValue();
if(c){c=c.split(",")
}var g=a.getValue();
var f=false;
a.setValue(null);
a.store.removeAll();
sortCDRsum=["cnt_all"];
sortCDRsum=sortCDRsum.concat(arColumnsCDRstat);
for(var b=0;
b<sortCDRsum.length;
b++){if(sortCDRsum[b]=="cnt_all"||c&&c.isIn(sortCDRsum[b])&&(sortCDRsum[b]!="cps_max"&&sortCDRsum[b]!="cps_avg")){a.addMenuItem({id:sortCDRsum[b],descr:findLangS("dashboard_d","menu",sortCDRsum[b])});
if(sortCDRsum[b]==g){f=true
}}}a.setValue(f?g:"cnt_all")
}});
Ext.define("DailyReports.GridExpPanel",{extend:"Ext.Panel",subsystem:"alerts_daily_reports",constructor:function(a){this.charts=new DailyReports.Charts.Grid({title:this.findLangS("tab","charts"),relFields:{daily_reports_id:a.record.data.id},reportRecordData:a.record.data,style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tabPanel=new Ext.TabPanel({items:this.charts,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"daily_reports-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("DailyReports.Charts.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"alerts_daily_reports",constructor:function(b){var a=__width_FieldChar(15)+3;
b=Ext.applyIf(b||{},{storeId:"TrackerCategoryUserStore",url:"php/model/sql.php",module:"daily_reports_charts",recordStruct:rsDailyReportsCharts,sortField:"description",remoteSort:true,columns:[{dataIndex:"description",widthCh:40},{dataIndex:"enabled",widthCh:13,renderer:renderCheckBox},{dataIndex:"use_cache",widthCh:20,renderer:renderCheckBox}],insertMenu:[{text:this.findLangS("menu","cdr"),handler:function(){this.createEditWindow("CDR")
},scope:this},{text:this.findLangS("menu","messages"),handler:function(){this.createEditWindow("MESSAGES")
},scope:this},{text:this.findLangS("menu","sip_msg"),handler:function(){this.createEditWindow("SIP_MSG")
},scope:this}],fpItems:function(h,f,g,c){var d={xtype:"container",items:[{xtype:"textarea",name:"description",labelWidth:a,width:a+__width_FieldChar(50),allowBlank:false},{xtype:"checkbox",name:"previous_period",labelWidth:a},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"chart_width",labelWidth:a,width:a+__width_FieldNum(5)+__width_Trigger,fieldStyle:{"text-align":"right"}},{xtype:"displayfield_h16",value:this.findLangS("field","chart_height")+":",fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator}},{xtype:"numberfield",name:"chart_height",hideLabel:true,labelWidth:a,width:__width_FieldNum(5)+__width_Trigger,fieldStyle:{"text-align":"right"}}]},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"enabled",labelWidth:a},{xtype:"checkbox",name:"use_cache",labelWidth:__width_FieldChar(30)}]}]};
completeFormFields(d,true,{},{subsystem:"alerts_daily_reports"});
g.chartConfig=new CDR.Chart.ConfigForm({_typeChart:f?f:c.data.data_table=="message"?"MESSAGES":c.data.data_table=="sip_msg"?"SIP_MSG":"CDR",chartConfig:{},disableCreateWindow:true,disableShowWindow:true,disableSaveCancelFormButtons:true,disableSaveDeleteChartButtons:true,disableChartTitle:true,dailyReportConfig:true,dailyReportConfigData:b.reportRecordData,frame:false,prevInterval:true,prevIntervalHourTolerance:__default_chartPrevIntervalHourTolerance});
return({xtype:"container",layout:{type:"vbox",align:"stretch"},items:[d,{xtype:"container",layout:"fit",items:g.chartConfig,flex:1}]})
},fpConfig:{layout:"fit",autoHeight:false,width:CDR.Filter.getWidthForm()+__width_Scroller+4+8,prevButtons:[{text:this.findLangS("button","preview_chart"),iconCls:"icon_magnifier",handler:this.previewChart,scope:this}]},ewConfig:{height:function(){return(Math.min(900,Ext.dom.Element.getViewportHeight()-40))
},resizable:false,autoScroll:false,autoHeight:false},propRecordText:function(c){return(c.description)
},enableEdit:true,stripeRows:false,disableCompleteFormFields:true,addWidthForVerticalScroller:true});
this.callParent([b])
},prepareDataForEdit:function(b,a){if(b.config_chart){a.chartConfig.setChartConfigFields(Ext.decode(b.config_chart))
}a.chartConfig.setTimeInterval()
},getDefaultValues:function(a){return({chart_width:__default_chartWidth,chart_height:__default_chartHeight,enabled:true})
},prepareDataForSave:function(b,a){var c=a.chartConfig.getChartConfig(true,true);
c.title="none";
b.config_chart=Ext.encode(c);
b.data_table=a.chartConfig._typeChart=="MESSAGES"?"message":a.chartConfig._typeChart=="SIP_MSG"?"sip_msg":"cdr"
},isEnableEditRecord:function(a){return(this.isEnableEditDeleteRecord(a))
},isEnableDeleteRecord:function(a){return(this.isEnableEditDeleteRecord(a))
},isEnableEditDeleteRecord:function(a){return(!a.data["private"]||user_is_admin()||user_id()&&a.data.owner_uid&&user_id()==a.data.owner_uid||user_id()&&a.data.user_ids_write&&a.data.user_ids_write.isIn(user_id())||group_id()&&a.data.group_ids_write&&a.data.group_ids_write.isIn(group_id()))
},testValidRecord:function(b){var c=this.fpConfig.chartConfig.getChartConfig(true,true);
var a=this.fpConfig.chartConfig.checkErrorInChartConfig(c);
if(a){Ext.Msg.alert(lang.error,a);
return(false)
}return(true)
},previewChart:function(){var a=this.formPanel.chartConfig.getChartConfig(true);
chartPanel=new CDR.Chart.ChartPanel({chartConfig:a,width:this.formPanel.getForm().findField("chart_width").getValue()||this.getDefaultValues().chart_width,height:this.formPanel.getForm().findField("chart_height").getValue()||this.getDefaultValues().chart_height,_enableBtns:false});
var b=new Ext.Window({iconCls:"icon_magnifier",title:this.LpreviewChart,closable:true,resizable:true,maximizable:true,modal:true,layout:"fit",items:chartPanel});
b.show();
chartPanel.maskLoad();
chartPanel.loadChart(a,true,{fceInvalidQuery:function(c){c.close()
},fceInvalidQueryParam:b})
}});
Ext.define("DailyReports.Sended.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.DailyReports.Sended.GridX",subsystem:"alerts_daily_reports",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"DailyReports.Sended",url:"php/model/sql.php",module:"daily_reports_sended",recordStruct:rsDailyReportsSended,sortField:"send_time",sortDirection:"desc",remoteSort:true,enableSearchX:true,paginatorPrependButtons:true,paginatorBehindButtonsItems:"-",columns:[{dataIndex:"report_descr",widthCh:20},{dataIndex:"day",renderer:renderDate,width:__width_ColumnDate},{dataIndex:"send_time",renderer:renderDateTime,width:__width_ColumnDateTime},{dataIndex:"subject",widthCh:40},{dataIndex:"send_email",widthCh:30}],enableDelete:true,pageSize:30,plugins:[{ptype:"rowexpander",rowBodyContentCls:"DailyReports.Sended.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],fullColumnSize:"subject",fullColumnSizeDecrementScroller:true,tbar:[{text:this.findLangS("button","delete_all"),iconCls:"icon_cancel",handler:this.deleteAll,scope:this}]});
this.callParent([a])
},deleteAll:function(){var b=null;
var a=new Ext.Window({layout:"fit",title:this.findLangS("title","delete_sent_reports"),items:{xtype:"form",items:[{xtype:"checkbox",name:"all",checked:true,fieldLabel:this.findLangS("field","delete_all"),labelWidth:__width_FieldChar(12),listeners:{scope:this,change:function(c){b.findField("to_date").enableIf(!c.getValue())
}}},{xtype:"datefield",name:"to_date",value:date_prev(),format:__format_Date,fieldLabel:this.findLangS("field","delete_to_date"),labelWidth:__width_FieldChar(12),width:__width_FormChar(12,12)}],buttons:[{text:this.findLangS("button","delete"),iconCls:"icon_delete",scope:this,handler:function(){this.doDeleteAll(a,b.getFieldValues())
}}],border:false,modal:true,listeners:{scope:this,afterrender:function(c){b=c.getForm();
b.findField("to_date").enableIf(!b.findField("all").getValue())
}},style:{padding:5,"background-color":__color_WindowFrame},bodyStyle:{"background-color":__color_WindowFrame}},border:false,modal:true});
a.show()
},doDeleteAll:function(a,b){Ext.Msg.confirm("",b.all||!b.to_date?this.findLangS("text","deleteAllSentReportsQuestion"):this.findLangS("text","deleteToTimeSentReportsQuestion").template([Ext.Date.format(b.to_date,__format_Date)]),function(c){if(c=="yes"){a.close();
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"deleteSentReports",params:Ext.encode(b)},success:function(){this.reload()
},scope:this,maskEl:this})
}},this)
}});
Ext.define("DailyReports.Sended.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){Ext.apply(a,{border:false,html:a.record.data.content,padding:5,autoScroll:true});
this.callParent([a]);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getValueFromDb",params:Ext.encode({table:"daily_reports_sended",id:a.record.data.id,column:"content",unzip:true})},success:function(b){this.update(b.rslt);
this.updateLayout()
}})
}});
Ext.define("DailyReports.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.daily_reports_editPanelX",subsystem:"alerts_daily_reports",constructor:function(a){a=Ext.applyIf(a||{},{id:"daily_reports_edit-panel",iconCls:"icon_menu_diag_system",gridXType:"DailyReports.GridX",wikiId:"Reports",titleLang:"daily_reports"});
this.callParent([a])
}});
Ext.define("DailyReports.Sended.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.daily_reports_sendedPanelX",subsystem:"alerts_daily_reports",constructor:function(a){a=Ext.applyIf(a||{},{id:"daily_reports_sended-panel",iconCls:"icon_menu_diag_system",gridXType:"DailyReports.Sended.GridX",wikiId:"Reports",titleLang:"sent_daily_reports"});
this.callParent([a])
}});
Ext.ns("Codebook");
Ext.define("Codebook.ipGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.ipGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.ipGroups",url:"php/model/sql.php",module:"cb_ip_groups",recordStruct:rsCbIpGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,dataIndex:"descr",widthCh:20},{header:this.ipText,dataIndex:"ip",widthCh:30},{header:this.trunkText,readOnly:false,dataIndex:"trunk",widthCh:8,renderer:renderCheckBox},{header:this.noteText,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"textarea",fieldLabel:this.ipText,helpText:this.ipHelp,name:"ip",heightL:6,allowBlank:false},{xtype:"checkbox",fieldLabel:this.trunkText,helpText:this.trunkHelp,name:"trunk"},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableSearchX:true,enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),_title:this.LtitleText});
this.callParent([a])
},onChangeRecords:function(a,b){if(b){refreshFraud({ifCbType:"ip",ifCbId:b.id})
}}});
Ext.override(Codebook.ipGroups.Grid,{propertiesText:"Properties",newText:"New IP Group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",ipText:"IP Addresses",ipHelp:"IP Addresses or Networks.",trunkText:"Trunk",trunkHelp:"",noteText:"Note",LtitleText:"IP addresses"});
Ext.define("Codebook.numberGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.numberGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.numberGroups",url:"php/model/sql.php",module:"cb_number_groups",recordStruct:rsCbNumberGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,dataIndex:"descr",widthCh:20},{header:this.numberText,dataIndex:"number",widthCh:30},{header:this.noteText,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"textarea",fieldLabel:this.numberText,helpText:this.numberHelp,name:"number",heightL:6,allowBlank:false},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableSearchX:true,enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),_title:this.LtitleText});
this.callParent([a])
},onChangeRecords:function(a,b){if(b){refreshFraud({ifCbType:"number",ifCbId:b.id})
}}});
Ext.override(Codebook.numberGroups.Grid,{propertiesText:"Properties",newText:"New Number Group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",numberText:"Prefixes of Numbers",numberHelp:"Matching all numbers starting with 1234: 1234, matching exact number 1234: R(1234$), matching the regexp 12[34].*: R(12[34].*).",noteText:"Note",LtitleText:"Tel. numbers"});
Ext.define("Codebook.domainGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.domainGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.domainGroups",url:"php/model/sql.php",module:"cb_domain_groups",recordStruct:rsCbDomainGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,dataIndex:"descr",widthCh:20},{header:this.domainText,dataIndex:"domain",widthCh:30},{header:this.sideText,dataIndex:"side",widthCh:10,renderer:renderArrayData,arrayData:arCallerCalledSide,arrayDataRsltIndex:2},{header:this.noteText,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"textarea",fieldLabel:this.domainText,helpText:this.domainHelp,name:"domain",heightL:6,allowBlank:false},{xtype:"ComboBoxA",fieldLabel:this.sideText,helpText:this.sideHelp,name:"side",widthChar:10,aData:{data:arCallerCalledSide,fields:["id_numb","id_str","descr"]},valueField:"id_numb",displayField:"descr",_clearButton:true},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableSearchX:true,enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),_title:this.LtitleText});
this.callParent([a])
}});
Ext.override(Codebook.domainGroups.Grid,{propertiesText:"Properties",newText:"New Domain Group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",domainText:"Domains",sideText:"Side",noteText:"Note",LtitleText:"Domains"});
Ext.define("Codebook.custheadCdrGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.custheadCdrGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.custheadCdrGroups",url:"php/model/sql.php",module:"cb_custhead_cdr_groups",recordStruct:rsCbCustheadCdrGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,dataIndex:"descr",widthCh:20},{header:this.customHeaderText,dataIndex:"custom_header",widthCh:20},{header:this.contentText,dataIndex:"content",widthCh:30},{header:this.noteText,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35,disableAutoAddTriggerWidth:true},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"ComboBoxX",fieldLabel:this.customHeaderText,helpText:this.customHeaderHelp,name:"cdr_custom_headers_id",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"cdr_custom_headers",recordStruct:rsCdrCustomHeaders,sortField:"name",columns:[{fields:"name",widthCh:30}],editable:false,allowBlank:false,_infoEmpty:this.customHeaderEmptyText},{xtype:"textarea",fieldLabel:this.contentText,helpText:this.contentHelp,name:"content",heightL:6,allowBlank:false},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableSearchX:true,enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),_title:this.LtitleText});
this.callParent([a])
}});
Ext.override(Codebook.custheadCdrGroups.Grid,{propertiesText:"Properties",newText:"New group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",customHeaderText:"Custom header",contentText:"Content",sideText:"Side",noteText:"Note",LtitleText:"CDR Custom Headers",customHeaderEmptyText:"you have no custom header defined"});
Ext.define("Codebook.custheadMsgGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.custheadMsgGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.custheadMsgGroups",url:"php/model/sql.php",module:"cb_custhead_msg_groups",recordStruct:rsCbCustheadMsgGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,dataIndex:"descr",widthCh:20},{header:this.customHeaderText,dataIndex:"custom_header",widthCh:20},{header:this.contentText,dataIndex:"content",widthCh:30},{header:this.noteText,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35,disableAutoAddTriggerWidth:true},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"ComboBoxX",fieldLabel:this.customHeaderText,helpText:this.customHeaderHelp,name:"msg_custom_headers_id",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"message_custom_headers",recordStruct:rsMessageCustomHeaders,sortField:"name",columns:[{fields:"name",widthCh:30}],editable:false,allowBlank:false,_infoEmpty:this.customHeaderEmptyText},{xtype:"textarea",fieldLabel:this.contentText,helpText:this.contentHelp,name:"content",heightL:6,allowBlank:false},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableSearchX:true,enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),_title:this.LtitleText});
this.callParent([a])
}});
Ext.override(Codebook.custheadMsgGroups.Grid,{propertiesText:"Properties",newText:"New group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",customHeaderText:"Custom header",contentText:"Content",sideText:"Side",noteText:"Note",LtitleText:"Message Custom Headers",customHeaderEmptyText:"you have no custom header defined"});
Ext.define("Codebook.emailGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.emailGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.emailGroups",url:"php/model/sql.php",module:"cb_email_groups",recordStruct:rsCbEmailGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,readOnly:false,dataIndex:"descr",widthCh:20},{header:this.emailText,readOnly:false,dataIndex:"email",widthCh:30},{header:this.noteText,readOnly:false,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"textarea",fieldLabel:this.emailText,helpText:this.emailHelp,name:"email",heightL:6,allowBlank:false},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),enableSearchX:true});
this.callParent([a])
}});
Ext.override(Codebook.emailGroups.Grid,{propertiesText:"Properties",newText:"New Email Group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",emailText:"E-mail Addresses",noteText:"Note"});
Ext.define("Codebook.countryGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.countryGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.countryGroups",url:"php/model/sql.php",module:"cb_country_groups",recordStruct:rsCbCountryGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,readOnly:false,dataIndex:"descr",widthCh:20},{header:this.countryText,readOnly:false,dataIndex:"country",widthCh:30},{header:this.noteText,readOnly:false,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35},fpItemsSrc:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"container",layout:{type:"hbox"},items:[{xtype:"displayfield",value:this.countryText+":",width:100,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"country_tree",name:"country",width:__width_FieldChar(35)}],style:{marginBottom:__height_FieldSeparator}},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),enableSearchX:true});
this.callParent([a])
}});
Ext.override(Codebook.countryGroups.Grid,{propertiesText:"Properties",newText:"New Country Group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",countryText:"Country",noteText:"Note"});
Ext.define("Codebook.uaGroups.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.uaGroups.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"Codebook.uaGroups",url:"php/model/sql.php",module:"cb_ua_groups",recordStruct:rsCbUaGroups,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,readOnly:false,dataIndex:"descr",widthCh:20},{header:this.uaText,readOnly:false,dataIndex:"ua",widthCh:30},{header:this.noteText,readOnly:false,dataIndex:"note",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:35},fpItems:[{fieldLabel:this.descrText,helpText:this.descrHelp,name:"descr",allowBlank:false},{xtype:"textarea",fieldLabel:this.uaText,helpText:this.uaHelp,name:"ua",heightL:6,allowBlank:false},{xtype:"textarea",fieldLabel:this.noteText,helpText:this.noteHelp,name:"note"}],propRecordText:function(b){return(b.descr)
},enableEdit:user_can_edit_codebooks(),enableExportCsv:true,enableImportCsv:user_can_edit_codebooks(),enableSearchX:true});
this.callParent([a])
}});
Ext.override(Codebook.uaGroups.Grid,{propertiesText:"Properties",newText:"New User Agents Group",editButtonText:"Edit",deleteButtonText:"Delete",descrText:"Description",uaText:"User Agents",noteText:"Note"});
Ext.define("Codebook.timePeriod.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Codebook.timePeriod.GridX",constructor:function(c){var a=15;
var d=4;
var b=18;
c=Ext.applyIf(c||{},{storeId:"Codebook.timePeriod",url:"php/model/sql.php",module:"cb_timeperiod",recordStruct:rsCbTimePeriod,sortField:"descr",remoteSort:true,columns:[{header:this.descrText,readOnly:false,dataIndex:"descr",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:a,disableAutoAddTriggerWidth:true},fpItems:[{name:"descr",allowBlank:false,fieldLabel:this.descrText},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield_h16",value:this.fromText,hideLabel:true,widthCh:b,fieldStyle:{"text-align":"center"}},{xtype:"displayfield_h16",value:this.toText,hideLabel:true,widthCh:b,fieldStyle:{"text-align":"center"}}],style:{marginLeft:__width_FieldChar(a)+__width_FieldChar(d)+__width_LabelFieldSeparator,paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{name:"is_hourmin",xtype:"checkbox",widthCh:d,fieldLabel:this.isHourMinText},{xtype:"container",layout:"hbox",items:[{name:"from_hour",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:0,maxValue:23},{xtype:"displayfield_h16",value:"&thinsp;:&thinsp;"},{name:"from_minute",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:0,maxValue:59}],width:__width_FieldChar(b)},{xtype:"container",layout:"hbox",items:[{name:"to_hour",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:0,maxValue:23},{xtype:"displayfield_h16",value:"&thinsp;:&thinsp;"},{name:"to_minute",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:0,maxValue:59}],width:__width_FieldChar(b)}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{name:"is_weekday",xtype:"checkbox",widthCh:d,fieldLabel:this.isWeekdayText},{xtype:"container",layout:"hbox",items:[{name:"from_weekday",xtype:"ComboBoxA",widthCh:16,hideLabel:true,aData:arWeekday}],width:__width_FieldChar(b)},{xtype:"container",layout:"hbox",items:[{name:"to_weekday",xtype:"ComboBoxA",widthCh:16,hideLabel:true,aData:arWeekday}],width:__width_FieldChar(b)}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{name:"is_monthday",xtype:"checkbox",widthCh:d,fieldLabel:this.isMonthDayText},{xtype:"container",layout:"hbox",items:[{name:"from_monthday",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:1,maxValue:31}],width:__width_FieldChar(b)},{xtype:"container",layout:"hbox",items:[{name:"to_monthday",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:1,maxValue:31}],width:__width_FieldChar(b)}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{name:"is_month",xtype:"checkbox",widthCh:d,fieldLabel:this.isMonthText},{xtype:"container",layout:"hbox",items:[{name:"from_month",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:1,maxValue:12}],width:__width_FieldChar(b)},{xtype:"container",layout:"hbox",items:[{name:"to_month",xtype:"numberfield",widthNum:5,hideLabel:true,minValue:1,maxValue:12}],width:__width_FieldChar(b)}],style:{paddingBottom:__height_FieldSeparator}},{name:"note",xtype:"textarea",heightL:3,fieldLabel:this.noteText}],propRecordText:function(f){return(f.descr)
},enableEdit:user_can_edit_codebooks(),enableSearchX:true});
this.callParent([c])
},setContextItems:function(a,d,f,h,g,c,b){this.enableFieldIf(["from_hour","from_minute","to_hour","to_minute"],d.is_hourmin);
this.enableFieldIf(["from_weekday","to_weekday"],d.is_weekday);
this.enableFieldIf(["from_monthday","to_monthday"],d.is_monthday);
this.enableFieldIf(["from_month","to_month"],d.is_month)
}});
Ext.override(Codebook.timePeriod.Grid,{propertiesText:"Properties",newText:"New time period",editButtonText:"Edit",deleteButtonText:"Delete",fromText:"from",toText:"to",isHourMinText:"hour/min",isWeekdayText:"week day",isMonthDayText:"month day",isMonthText:"month",descrText:"Description",noteText:"Note"});
Ext.define("Codebook.ipGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_ip_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_ip_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.ipGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.ipGroups.Panel,{titleText:"IP addresses"});
Ext.define("Codebook.numberGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_number_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_number_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.numberGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.numberGroups.Panel,{titleText:"Tel. numbers"});
Ext.define("Codebook.domainGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_domain_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_domain_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.domainGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.domainGroups.Panel,{titleText:"Domains"});
Ext.define("Codebook.custheadCdrGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_custhead_cdr_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_custhead_cdr_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.custheadCdrGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.custheadCdrGroups.Panel,{titleText:"CDR Custom Headers"});
Ext.define("Codebook.custheadMsgGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_custhead_msg_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_custhead_msg_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.custheadMsgGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.custheadMsgGroups.Panel,{titleText:"Message Custom Headers"});
Ext.define("Codebook.emailGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_email_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_email_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.emailGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.emailGroups.Panel,{titleText:"Emails"});
Ext.define("Codebook.countryGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_country_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_country_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.countryGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.countryGroups.Panel,{titleText:"Countries"});
Ext.define("Codebook.uaGroups.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_ua_groupsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_ua_groups-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.uaGroups.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.uaGroups.Panel,{titleText:"User Agents"});
Ext.define("Codebook.timePeriod.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cb_timeperiodPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cb_timeperiod-panel",iconCls:"icon_table_multiple",gridXType:"Codebook.timePeriod.GridX",wikiId:"Groups"});
this.callParent([a])
}});
Ext.override(Codebook.timePeriod.Panel,{titleText:"Time periods"});
Ext.ns("Tcpdump");
Ext.define("Tcpdump.Active.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"PrefixTableStore",url:"php/model/sql.php",module:"tcpdump_active",recordStruct:rsTcpdumpActive,keyField:"customer_id",sortField:"customer_name",columns:[{dataIndex:"customer_name",flex:1,sortable:true},{dataIndex:"start_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true}],tbar:[{scope:this,text:lang.newCapture,iconCls:"icon_add",handler:this.newCapture,_id:"add"},{scope:this,text:lang.stopCapture,iconCls:"icon_remove",handler:this.stopCapture,disabled:true,_id:"remove"},"->",{scope:this,iconCls:"icon_reload",handler:this.reload}],plugins:[{ptype:"rowexpander",rowBodyContentCls:"Tcpdump.Archive.GridExpPanel",rowBodyContentConfig:{level:2},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],subsystem:"cust",titleLang:"active",prefixCls:"tcpdump_a",stripeRows:false});
this.callParent([a])
},newCapture:function(){this.createEditWindow(1,null,{title:lang.newCapture,fpItems:[{name:"customer_id",xtype:"CBX_custCustomer",allowBlank:false,labelWidth:__width_FieldChar(12),_width:__width_FieldChar(30),extraParams:{without_subsidiaries:true},_autoDisableIfEmpty:true},{xtype:"numberfield",name:"length_interval_minutes",allowBlank:false,value:tcpdumpFilePeriodMinutes,labelWidth:__width_FieldChar(12),_width:__width_FieldNum(4)+__width_Trigger,minValue:1,maxValue:60*24,allowDecimals:false,step:10,align:"right"}],saveRecord:function(){var b=this.getField("customer_id").getValue();
var a=this.getField("customer_id").getRawValue();
var c=this.getField("length_interval_minutes").getValue();
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"tcpdump",params:Ext.encode({subtask:"start",customer:b,filePeriod:c})},success:function(d){this.store.add({customer_id:b,customer_name:a,start_time:d.start_time});
Ext.Msg.alert(d.warning?lang.warning:lang.success,d.status);
this.formPanel.editWindow.destroy()
},scope:this,maskEl:this.formPanel.editWindow,longOperation:true})
}})
},stopCapture:function(){var a=this.selModel.getSelection();
if(a.length==1){Ext.Msg.confirm(lang.stopCaptureConfirmHeader,lang.stopCaptureConfirmText,function(b){if(b=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"tcpdump",params:Ext.encode({subtask:"stop",customer:a[0].data.customer_id,start_time:a[0].data.start_time})},success:function(c){this.store.remove(a[0])
},scope:this,maskEl:this})
}},this)
}},onSelectionChange:function(a){var b=a.getSelection();
this.enableBtn("remove",b.length==1)
}});
Ext.define("Tcpdump.Archive.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{level:0,url:"php/model/sql.php",module:"tcpdump_archive",remoteSort:true,pageSize:30,subsystem:"cust",titleLang:"archive",deferredLoad:true});
switch(a.level){case 0:Ext.applyIf(a,{columns:[{dataIndex:"customer_name",flex:1,sortable:true}],recordStruct:rsTcpdumpActive,sortField:"customer_name"});
break;
case 1:var b=[];
if(a.enableDeleteCap){b.push({xtype:"actioncolumn",dataIndex:"start_time",flex:1,rendererBase:c,width:__width_ColumnDateTime+20,items:[{getClass:function(g,h,k){return("icon_file_drive_delete")
},handler:function(h,m,g,k,l){this.deleteCap(h.store.getAt(m))
},scope:this}],iconDivStyle:"float:left; height:15; width: 16;",baseContentDivStyle:"padding-left: 20;"})
}else{b.push({dataIndex:"start_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true})
}b.push({flex:1});
Ext.applyIf(a,{columns:b,recordStruct:rsTcpdumpArchiveL1,sortField:"start_time"});
break;
case 2:var d=[{getClass:function(g,h,k){return("icon_file_drive_save")
},handler:function(h,m,g,k,l){this.downloadCap(h.store.getAt(m))
},scope:this}];
if(a.enableDeleteCap){d.push({width:3},{getClass:function(g,h,k){return("icon_file_drive_delete")
},handler:function(h,m,g,k,l){this.deleteCap(h.store.getAt(m))
},scope:this})
}Ext.applyIf(a,{columns:[{dataIndex:"start_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true},{dataIndex:"server",widthCh:10,sortable:true},{xtype:"actioncolumn",dataIndex:"file_name",flex:1,rendererBase:f,items:d,iconDivStyle:"float:left; height:15; width: "+(a.enableDeleteCap?35:16)+";",baseContentDivStyle:"padding-left: "+(a.enableDeleteCap?39:20)+";"},{dataIndex:"file_size",widthNum:8,renderer:renderFilesize,align:"right"}],recordStruct:rsTcpdumpArchiveL2,sortField:"start_time"});
break
}Ext.applyIf(a,{storeId:"PrefixTableStore_l"+a.level,prefixCls:"tcpdump_l"+a.level,stripeRows:false});
if(a.level<2){a.plugins=[{ptype:"rowexpander",rowBodyContentCls:"Tcpdump.Archive.GridExpPanel",rowBodyContentConfig:{level:a.level+1,enableDeleteCap:true},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true,noVerticalScroller:a.level}]
}this.callParent([a]);
function f(n,k,h,o,m,l,g){k.style="padding-left: 2";
return(n)
}function c(n,k,h,o,m,l,g){k.style="padding-left: 2";
return(renderDateTime(n))
}},downloadCap:function(a){formPostSafe("php/model/utilities.php","POST",{task:"tcpdump",params:Ext.encode({subtask:"download",cap:a.data.file_name})})
},deleteCap:function(a){Ext.Msg.confirm(lang.tcpdumpDeleteConfirmHeader,(this.level==2?(lang.tcpdumpDeletePcapFileConfirmText+" "+a.data.file_name):(lang.tcpdumpDeleteFolderConfirmText+" "+Ext.Date.format(a.data.start_time,__format_DateTime)))+"<br><br>"+lang.tcpdumpDeleteConfirmText,function(b){if(b=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"tcpdump",params:Ext.encode({subtask:"delete",level:this.level,record_data:a.data,customer_id:this.store.proxy.extraParams.customer_id,start_time_folder:this.store.proxy.extraParams.start_time})},success:function(c){this.store.remove(a)
},scope:this,maskEl:this})
}},this)
}});
Ext.define("Tcpdump.Archive.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){var b={};
switch(a.level){case 1:b.customer_id=a.record.data.customer_id;
break;
case 2:b.customer_id=a.record.data.customer_id||a.grid.store.proxy.extraParams.customer_id;
b.start_time=a.record.data.start_time;
break
}this.archiveGrid=new Tcpdump.Archive.Grid({titleLang:null,extraParams:b,level:a.level,border:true,enableDeleteCap:a.enableDeleteCap});
Ext.apply(a,{items:this.archiveGrid,border:false});
this.callParent([a])
}});
Ext.define("Tcpdump.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.tcpdumpPanelX",constructor:function(a){this.activeGrid=new Tcpdump.Active.Grid;
this.archiveGrid=new Tcpdump.Archive.Grid;
a=Ext.applyIf(a||{},{id:"tcpdump-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.activeGrid,this.archiveGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},title:findLangSd("title","tcpDump")});
this.callParent([a])
}});
Ext.define("Tcpdump.Window",{extend:"Ext.Window",constructor:function(a){this.activeGrid=new Tcpdump.Active.Grid({style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.archiveGrid=new Tcpdump.Archive.Grid({style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.tab=new Ext.tab.Panel({items:[this.activeGrid,this.archiveGrid],border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}});
a=Ext.applyIf(a||{},{title:findLangSd("title","tcpDump"),closable:true,resizable:true,maximizable:true,layout:"fit",items:this.tab,border:false,width:Math.min(900,Ext.dom.Element.getViewportWidth()*4/5),height:Math.min(700,Ext.dom.Element.getViewportHeight()*4/5)});
this.callParent([a]);
this.show()
}});
Ext.ns("Nagios");
Ext.define("Nagios.Host.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosHostStore",url:"php/model/sql.php",module:"nagios_host",recordStruct:rsNagios_host,sortField:"host_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"host_name",widthCh:40,sortable:true},{dataIndex:"address",widthNum:12,sortable:true},{xtype:"actioncolumn",dataIndex:"status_current_state_str",rendererBase:b,sortable:false,items:[{getClass:function(c,d,f){return(Nagios.Utils.getIconStateHost(f))
}}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"},{dataIndex:"status_last_update_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true}],fullColumnSize:"status_current_state_str",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:30,disableAutoAddTriggerWidth:true},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getDefaultValuesNagios",fpItemsSrc:[{name:"host_name",allowBlank:false},{name:"alias",allowBlank:false},{name:"display_name"},custom_configuration_existFcecust_getCustomers&&a&&a.contact&&a.contact.customer_id?{xtype:"CBX_custCustomerIpDetail",name:"address",customer:a.contact.customer_id,_textHelper:true,minChars:100,allowBlank:false}:{name:"address",allowBlank:false},{xtype:"CBX_nagios_command",name:"check_command_id"},{name:"check_command_arg1",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg2",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg3",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg4",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg5",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg6",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg7",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg8",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg9",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{xtype:"checkboxgroup",name:"initial_state",columns:3,defaults:{xtype:"checkbox"},items:[{name:"initial_state__b_up",autoBoxLabel:true,width:95},{name:"initial_state__b_down",autoBoxLabel:true,width:95},{name:"initial_state__b_unreachable",autoBoxLabel:true,width:95}]},{xtype:"numberfield",name:"max_check_attempts",minValue:0,widthNum:7,allowBlank:false},{xtype:"numberfield",name:"check_interval",minValue:0,widthNum:7},{xtype:"numberfield",name:"retry_interval",minValue:0,widthNum:7},{xtype:"checkbox",name:"active_checks_enabled"},{xtype:"checkbox",name:"passive_checks_enabled"},{xtype:"CBX_nagios_timeperiod",name:"check_period_id",allowBlank:false},{xtype:"checkbox",name:"obsess_over_host"},{xtype:"checkbox",name:"check_freshness"},{xtype:"numberfield",name:"freshness_threshold",minValue:0,widthNum:7},{xtype:"CBX_nagios_command",name:"event_handler_id"},{name:"event_handler_arg1",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg2",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg3",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg4",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg5",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg6",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg7",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg8",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg9",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{xtype:"checkbox",name:"event_handler_enabled"},{xtype:"numberfield",name:"low_flap_threshold",minValue:0,widthNum:7},{xtype:"numberfield",name:"high_flap_threshold",minValue:0,widthNum:7},{xtype:"checkbox",name:"flap_detection_enabled"},{xtype:"checkboxgroup",name:"flap_detection_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"flap_detection_option__b_up",autoBoxLabel:true,width:95},{name:"flap_detection_option__b_down",autoBoxLabel:true,width:95},{name:"flap_detection_option__b_unreachable",autoBoxLabel:true,width:95}]},{xtype:"checkbox",name:"process_perf_data"},{xtype:"checkbox",name:"retain_status_information"},{xtype:"checkbox",name:"retain_nonstatus_information"},{xtype:"numberfield",name:"notification_interval",minValue:0,widthNum:7,allowBlank:false},{xtype:"numberfield",name:"first_notification_delay",minValue:0,widthNum:7},{xtype:"CBX_nagios_timeperiod",name:"notification_period_id",allowBlank:false},{xtype:"checkboxgroup",name:"notification_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"notification_option__b_down",autoBoxLabel:true,width:95},{name:"notification_option__b_unreachable",autoBoxLabel:true,width:95},{name:"notification_option__b_recoveries",autoBoxLabel:true,width:95},{name:"notification_option__b_flapping",autoBoxLabel:true,width:95},{name:"notification_option__b_scheduled",autoBoxLabel:true,width:95}]},{xtype:"checkbox",name:"notifications_enabled"},{xtype:"checkboxgroup",name:"stalking_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"stalking_option__b_up",autoBoxLabel:true,width:95},{name:"stalking_option__b_down",autoBoxLabel:true,width:95},{name:"stalking_option__b_unreachable",autoBoxLabel:true,width:95}]},{xtype:"textarea",name:"notes"},{name:"notes_url"},{name:"action_url"},{name:"icon_image"},{name:"icon_image_alt"},{name:"vrml_image"},{name:"statusmap_image"},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"2d_coord__x",widthNum:8,fieldLabelLang:"2d_coords"},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"2d_coord__y",hideLabel:true,widthNum:8}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"3d_coord__x",widthNum:8,fieldLabelLang:"3d_coords"},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"3d_coord__y",hideLabel:true,widthNum:8},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"3d_coord__z",hideLabel:true,widthNum:8}],style:{marginBottom:__height_FieldSeparator}}],ewConfig:{heightMax:700},propRecordText:function(c){return(c.host_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"hostTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(c){return(Nagios.Utils.getFieldDescr("host",c))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Host.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"host",stripeRows:false,deferredLoad:true,intervalRefreshScheduler:10});
this.callParent([a]);
function b(k,f,d,l,h,g,c){return(Nagios.Utils.renderStateHost(d))
}},getDefaultValues:function(a){return({notifications_enabled:true,event_handler_enabled:0,flap_detection_enabled:true,process_perf_data:true,retain_status_information:true,retain_nonstatus_information:true,notification_period_id:a.rslt._24x7*1,initial_state__b_up:true,max_check_attempts:5,check_interval:5,retry_interval:3,active_checks_enabled:1,passive_checks_enabled:1,check_command_id:a.rslt._check_host_alive*1,check_period_id:a.rslt._24x7*1,freshness_threshold:93600,low_flap_threshold:25,high_flap_threshold:50,flap_detection_option__b_up:1,flap_detection_option__b_down:1,flap_detection_option__b_unreachable:1,notification_interval:30,notification_option__b_down:1,notification_option__b_unreachable:1,notification_option__b_recoveries:1,notification_option__b_flapping:1,notification_option__b_scheduled:0,first_notification_delay:0})
},setContextItems:function(a,d,f,k,h,c,b){if(f=="select"&&k.name=="check_command_id"){g.call(this,"check_command_id",f)
}else{if(f=="select"&&k.name=="event_handler_id"){g.call(this,"event_handler_id",f)
}else{if(f=="_afterstoreitemsok"){g.call(this,"check_command_id",f);
g.call(this,"event_handler_id",f)
}}}function g(o,l){var n=this.getField(o);
var m=n.getSelectRecord();
Nagios.Utils.setCommandArgFields(n,m?m.data:null,this,l)
}}});
Ext.define("Nagios.Host.GridExpPanel",{extend:"Ext.Panel",constructor:function(b){var a=[];
if(!b.only){this.hostgroup=new Nagios.Hostgroup_Host.Grid({relFields:{host_id:b.record.data.id},style:__style_SubgridBorder(),level:b.level+1,autoRelayoutExpanders:b.level>1});
a.push(this.hostgroup)
}if(!b.only){this.parent=new Nagios.Host_ParentHost.Grid({relFields:{host_id:b.record.data.id},style:__style_SubgridBorder(),level:b.level+1,autoRelayoutExpanders:b.level>1});
a.push(this.parent)
}if(!b.only){this.contact=new Nagios.Host_Contact.Grid({relFields:{host_id:b.record.data.id},style:__style_SubgridBorder(),level:b.level+1,autoRelayoutExpanders:b.level>1});
a.push(this.contact)
}if(!b.only){this.contactgroup=new Nagios.Host_Contactgroup.Grid({relFields:{host_id:b.record.data.id},style:__style_SubgridBorder(),level:b.level+1,autoRelayoutExpanders:b.level>1});
a.push(this.contactgroup)
}if(!b.only||b.only=="service"){this.service=new Nagios.Service_Host.Grid({relFields:{host_id:b.serviceRelFields?b.record.data[b.serviceRelFields]:b.record.data.id},style:__style_SubgridBorder(),level:b.level+1,autoRelayoutExpanders:b.level>1});
a.push(this.service)
}this.tabPanel=new Ext.TabPanel({items:b.only?a:[this.service,this.contact,this.contactgroup,this.hostgroup,this.parent],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:(b.tabPanelCls||"host-cell")+" expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(b,{items:this.tabPanel,border:false});
this.callParent([b])
}});
Ext.define("Nagios.Hostgroup.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosHostgroupStore",url:"php/model/sql.php",module:"nagios_hostgroup",recordStruct:rsNagios_hostgroup,sortField:"hostgroup_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"hostgroup_name",sortable:true}],fullColumnSize:"hostgroup_name",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"hostgroup_name",allowBlank:false},{name:"alias",allowBlank:false},{xtype:"textarea",name:"notes"},{name:"notes_url"},{name:"action_url"}],propRecordText:function(b){return(b.hostgroup_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"hostgroupTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){return(Nagios.Utils.getFieldDescr("hostgroup",b))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Hostgroup.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"hostgroup",stripeRows:false,deferredLoad:true});
this.callParent([a])
}});
Ext.define("Nagios.Hostgroup.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.host=new Nagios.Hostgroup_Host.Grid({relFields:{hostgroup_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.service=new Nagios.Service_Hostgroup.Grid({relFields:{hostgroup_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.tabPanel=new Ext.TabPanel({items:[this.host,this.service],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"hostgroup-cell",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Nagios.Hostgroup_Host.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosHostgroup_HostStore",url:"php/model/sql.php",module:"nagios_hostgroup_host",recordStruct:rsNagios_hostgroup_host,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.host_id){Ext.applyIf(a,{sortField:"hostgroup",columns:[{dataIndex:"hostgroup",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_hostgroup",name:"hostgroup_id",allowBlank:false}],titleLang:"hostgroupSubTab"})
}else{Ext.applyIf(a,{sortField:"host",columns:[{dataIndex:"host",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_host",name:"host_id",allowBlank:false}],titleLang:"hostSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Host_ParentHost.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosHost_ParentHostStore",url:"php/model/sql.php",module:"nagios_host_parent_host",recordStruct:rsNagios_host_parent_host,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.host_id){Ext.applyIf(a,{sortField:"parent_host",columns:[{dataIndex:"parent_host",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_host",name:"parent_host_id",allowBlank:false,withoutHostId:a.relFields.host_id}],titleLang:"hostParentSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Host_Contact.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosHost_ContactStore",url:"php/model/sql.php",module:"nagios_host_contact",recordStruct:rsNagios_host_contact,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.host_id){Ext.applyIf(a,{sortField:"contact",columns:[{dataIndex:"contact",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_contact",name:"contact_id",allowBlank:false}],titleLang:"hostContactSubTab",insertMenu:[{text:findLangS("nagios","linkExistContact"),handler:function(){this.createEditWindow(1)
},scope:this},{text:findLangS("nagios","createNewContact"),handler:function(){this.createNewIndirectRecord("Nagios.Contact.Grid","contact_id")
},scope:this}],editMenu:[{text:findLangS("nagios","editLinkContact"),handler:function(){this.createEditWindow(0)
},scope:this},{text:findLangS("nagios","editContact"),handler:function(){this.editIndirectRecord("Nagios.Contact.Grid","contact_id")
},scope:this}],deleteMenu:[{text:findLangS("nagios","unlinkContact"),handler:function(){this.confirmDeleteRule()
},scope:this},{text:findLangS("nagios","deleteContact"),handler:function(){this.confirmDeleteRule({id2:"contact_id",table2:"nagios_contact"})
},scope:this}]})
}else{Ext.applyIf(a,{sortField:"host",columns:[{dataIndex:"host",widthCh:40,sortable:true},{dataIndex:"address",widthNum:12,sortable:true},{xtype:"actioncolumn",dataIndex:"status_current_state",flex:1,rendererBase:b,sortable:false,items:[{getClass:function(c,d,f){return(Nagios.Utils.getIconStateHost(f))
}}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"},{dataIndex:"status_last_update_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_host",name:"host_id",allowBlank:false}],titleLang:"contactHostSubTab",insertMenu:[{text:findLangS("nagios","linkExistHost"),handler:function(){this.createEditWindow(1)
},scope:this},{text:findLangS("nagios","createNewHost"),handler:function(){this.createNewIndirectRecord("Nagios.Host.Grid","host_id",{contact:a.contact})
},scope:this}],editMenu:[{text:findLangS("nagios","editLinkHost"),handler:function(){this.createEditWindow(0)
},scope:this},{text:findLangS("nagios","editHost"),handler:function(){this.editIndirectRecord("Nagios.Host.Grid","host_id")
},scope:this}],deleteMenu:[{text:findLangS("nagios","unlinkHost"),handler:function(){this.confirmDeleteRule()
},scope:this},{text:findLangS("nagios","deleteHost"),handler:function(){this.confirmDeleteRule({id2:"host_id",table2:"nagios_host"})
},scope:this}],plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Host.GridExpPanel",rowBodyContentConfig:{only:"service",serviceRelFields:"host_id",tabPanelCls:"contact_host-cell",level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,noVerticalScroller:true,autoRelayoutExpanders:true}],prefixCls:"contact_host",intervalRefreshScheduler:10})
}this.callParent([a]);
function b(k,f,d,l,h,g,c){return(Nagios.Utils.renderStateHost(d))
}}});
Ext.define("Nagios.Host_Contactgroup.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosHost_ContactgroupStore",url:"php/model/sql.php",module:"nagios_host_contactgroup",recordStruct:rsNagios_host_contactgroup,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.host_id){Ext.applyIf(a,{sortField:"contactgroup",columns:[{dataIndex:"contactgroup",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_contactgroup",name:"contactgroup_id",allowBlank:false}],titleLang:"hostContactgroupSubTab"})
}else{Ext.applyIf(a,{sortField:"host",columns:[{dataIndex:"host",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_host",name:"host_id",allowBlank:false}],titleLang:"contactgroupHostSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Host.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.nagios_hostPanelX",constructor:function(a){this.hostGrid=new Nagios.Host.Grid;
this.hostgroupGrid=new Nagios.Hostgroup.Grid;
a=Ext.applyIf(a||{},{id:"nagios_host-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.hostGrid,this.hostgroupGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"host",subsystem:"nagios"});
this.callParent([a])
}});
Ext.define("Nagios.Service.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosServiceStore",url:"php/model/sql.php",module:"nagios_service",recordStruct:rsNagios_service,sortField:"service_description",remoteSort:true,pageSize:30,columns:[{dataIndex:"service_description",sortable:true}],fullColumnSize:"service_description",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:30,disableAutoAddTriggerWidth:true},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getDefaultValuesNagios",fpItemsSrc:[{name:"service_description",allowBlank:false},{name:"display_name"},{xtype:"checkbox",name:"is_volatile"},{xtype:"CBX_nagios_command",name:"check_command_id",allowBlank:false},{name:"check_command_arg1",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg2",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg3",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg4",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg5",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg6",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg7",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg8",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"check_command_arg9",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{xtype:"checkboxgroup",name:"initial_state",columns:3,defaults:{xtype:"checkbox"},items:[{name:"initial_state__b_ok",autoBoxLabel:true,width:95},{name:"initial_state__b_warning",autoBoxLabel:true,width:95},{name:"initial_state__b_unknown",autoBoxLabel:true,width:95},{name:"initial_state__b_critical",autoBoxLabel:true,width:95}]},{xtype:"numberfield",name:"max_check_attempts",minValue:0,widthNum:7,allowBlank:false},{xtype:"numberfield",name:"check_interval",minValue:0,widthNum:7,allowBlank:false},{xtype:"numberfield",name:"retry_interval",minValue:0,widthNum:7,allowBlank:false},{xtype:"checkbox",name:"active_checks_enabled"},{xtype:"checkbox",name:"passive_checks_enabled"},{xtype:"CBX_nagios_timeperiod",name:"check_period_id",allowBlank:false},{xtype:"checkbox",name:"obsess_over_service"},{xtype:"checkbox",name:"check_freshness"},{xtype:"numberfield",name:"freshness_threshold",minValue:0,widthNum:7},{xtype:"CBX_nagios_command",name:"event_handler_id"},{name:"event_handler_arg1",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg2",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg3",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg4",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg5",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg6",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg7",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg8",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{name:"event_handler_arg9",hidden:true,width:__width_FieldChar(50+20)+__width_LabelFieldSeparator+4,labelWidth:__width_FieldChar(50)},{xtype:"checkbox",name:"event_handler_enabled"},{xtype:"numberfield",name:"low_flap_threshold",minValue:0,widthNum:7},{xtype:"numberfield",name:"high_flap_threshold",minValue:0,widthNum:7},{xtype:"checkbox",name:"flap_detection_enabled"},{xtype:"checkboxgroup",name:"flap_detection_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"flap_detection_option__b_ok",autoBoxLabel:true,width:95},{name:"flap_detection_option__b_warning",autoBoxLabel:true,width:95},{name:"flap_detection_option__b_critical",autoBoxLabel:true,width:95},{name:"flap_detection_option__b_unknown",autoBoxLabel:true,width:95}]},{xtype:"checkbox",name:"process_perf_data"},{xtype:"checkbox",name:"retain_status_information"},{xtype:"checkbox",name:"retain_nonstatus_information"},{xtype:"numberfield",name:"notification_interval",minValue:0,widthNum:7,allowBlank:false},{xtype:"numberfield",name:"first_notification_delay",minValue:0,widthNum:7},{xtype:"CBX_nagios_timeperiod",name:"notification_period_id",allowBlank:false},{xtype:"checkboxgroup",name:"notification_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"notification_option__b_warning",autoBoxLabel:true,width:95},{name:"notification_option__b_unknown",autoBoxLabel:true,width:95},{name:"notification_option__b_critical",autoBoxLabel:true,width:95},{name:"notification_option__b_recoveries",autoBoxLabel:true,width:95},{name:"notification_option__b_flapping",autoBoxLabel:true,width:95},{name:"notification_option__b_scheduled",autoBoxLabel:true,width:95}]},{xtype:"checkbox",name:"notifications_enabled"},{xtype:"checkboxgroup",name:"stalking_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"stalking_option__b_ok",autoBoxLabel:true,width:95},{name:"stalking_option__b_warning",autoBoxLabel:true,width:95},{name:"stalking_option__b_unknown",autoBoxLabel:true,width:95},{name:"stalking_option__b_critical",autoBoxLabel:true,width:95}]},{xtype:"textarea",name:"notes"},{name:"notes_url"},{name:"action_url"},{name:"icon_image"},{name:"icon_image_alt"}],ewConfig:{heightMax:700},propRecordText:function(b){return(b.service_description)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"serviceTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){return(Nagios.Utils.getFieldDescr("service",b))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Service.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"service",stripeRows:false,deferredLoad:true});
this.callParent([a])
},getDefaultValues:function(a){return({active_checks_enabled:true,passive_checks_enabled:true,obsess_over_service:true,check_freshness:true,notifications_enabled:true,event_handler_enabled:0,flap_detection_enabled:true,notification_option__b_ok:1,notification_option__b_warning:1,notification_option__b_unknown:1,notification_option__b_critical:1,notification_option__b_recoveries:1,notification_option__b_flapping:1,notification_option__b_schedule:0,process_perf_data:true,retain_status_information:true,retain_nonstatus_information:true,is_volatile:false,check_period_id:a.rslt._24x7*1,max_check_attempts:3,check_interval:10,retry_interval:2,notification_option__b_warning:true,notification_option__b_unknown:true,notification_option__b_critical:true,notification_option__b_recoveries:true,notification_interval:60,notification_period_id:a.rslt._24x7*1,active_checks_enabled:true})
},setContextItems:function(a,d,f,k,h,c,b){if(f=="select"&&k.name=="check_command_id"){g.call(this,"check_command_id",f)
}else{if(f=="select"&&k.name=="event_handler_id"){g.call(this,"event_handler_id",f)
}else{if(f=="_afterstoreitemsok"){g.call(this,"check_command_id",f);
g.call(this,"event_handler_id",f)
}}}function g(o,l){var n=this.getField(o);
var m=n.getSelectRecord();
Nagios.Utils.setCommandArgFields(n,m?m.data:null,this,l)
}}});
Ext.define("Nagios.Service.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.servicegroup=new Nagios.Servicegroup_Service.Grid({relFields:{service_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.host=new Nagios.Service_Host.Grid({relFields:{service_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.hostgroup=new Nagios.Service_Hostgroup.Grid({relFields:{service_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.contact=new Nagios.Service_Contact.Grid({relFields:{service_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.contactgroup=new Nagios.Service_Contactgroup.Grid({relFields:{service_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.tabPanel=new Ext.TabPanel({items:[this.host,this.hostgroup,this.contact,this.contactgroup,this.servicegroup],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"service-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Nagios.Servicegroup.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosServicegroupStore",url:"php/model/sql.php",module:"nagios_servicegroup",recordStruct:rsNagios_servicegroup,sortField:"servicegroup_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"servicegroup_name",widthCh:60,sortable:true}],fullColumnSize:"servicegroup_name",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"servicegroup_name",allowBlank:false},{name:"alias",allowBlank:false},{xtype:"textarea",name:"notes"},{name:"notes_url"},{name:"action_url"}],propRecordText:function(b){return(b.servicegroup_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"servicegroupTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){return(Nagios.Utils.getFieldDescr("servicegroup",b))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Servicegroup.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"servicegroup",stripeRows:false,deferredLoad:true});
this.callParent([a])
}});
Ext.define("Nagios.Servicegroup.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.service=new Nagios.Servicegroup_Service.Grid({relFields:{servicegroup_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.tabPanel=new Ext.TabPanel({items:[this.service],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"servicegroup-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Nagios.Servicegroup_Service.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosServicegroup_ServiceStore",url:"php/model/sql.php",module:"nagios_servicegroup_service",recordStruct:rsNagios_servicegroup_service,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.service_id){Ext.applyIf(a,{sortField:"servicegroup",columns:[{dataIndex:"servicegroup",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_servicegroup",name:"servicegroup_id",allowBlank:false}],titleLang:"servicegroupSubTab"})
}else{Ext.applyIf(a,{sortField:"service",columns:[{dataIndex:"service",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_service",name:"service_id",allowBlank:false}],titleLang:"serviceSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Service_Host.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosService_HostStore",url:"php/model/sql.php",module:"nagios_service_host",recordStruct:rsNagios_service_host,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.service_id){Ext.applyIf(a,{sortField:"host",columns:[{dataIndex:"host",widthCh:40,sortable:true},{xtype:"actioncolumn",dataIndex:"status_current_state",flex:1,rendererBase:b,sortable:false,items:[{getClass:function(c,d,f){return(Nagios.Utils.getIconStateService(f))
}}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"},{dataIndex:"status_last_update_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_host",name:"host_id",allowBlank:false}],titleLang:"serviceHostSubTab",insertMenu:[{text:findLangS("nagios","linkExistHost"),handler:function(){this.createEditWindow(1)
},scope:this},{text:findLangS("nagios","createNewHost"),handler:function(){this.createNewIndirectRecord("Nagios.Host.Grid","host_id")
},scope:this}],editMenu:[{text:findLangS("nagios","editLinkHost"),handler:function(){this.createEditWindow(0)
},scope:this},{text:findLangS("nagios","editHost"),handler:function(){this.editIndirectRecord("Nagios.Host.Grid","host_id")
},scope:this}],deleteMenu:[{text:findLangS("nagios","unlinkHost"),handler:function(){this.confirmDeleteRule()
},scope:this},{text:findLangS("nagios","deleteHost"),handler:function(){this.confirmDeleteRule({id2:"host_id",table2:"nagios_host"})
},scope:this}],intervalRefreshScheduler:10})
}else{Ext.applyIf(a,{sortField:"service",columns:[{dataIndex:"service",widthCh:40,sortable:true},{xtype:"actioncolumn",dataIndex:"status_current_state",flex:1,rendererBase:b,sortable:false,items:[{getClass:function(c,d,f){return(Nagios.Utils.getIconStateService(f))
}}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"},{dataIndex:"status_last_update_time",width:__width_ColumnDateTime,renderer:renderDateTime,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_service",name:"service_id",allowBlank:false}],titleLang:"hostServiceSubTab",insertMenu:[{text:findLangS("nagios","linkExistService"),handler:function(){this.createEditWindow(1)
},scope:this},{text:findLangS("nagios","createNewService"),handler:function(){this.createNewIndirectRecord("Nagios.Service.Grid","service_id")
},scope:this}],editMenu:[{text:findLangS("nagios","editLinkService"),handler:function(){this.createEditWindow(0)
},scope:this},{text:findLangS("nagios","editService"),handler:function(){this.editIndirectRecord("Nagios.Service.Grid","service_id")
},scope:this}],deleteMenu:[{text:findLangS("nagios","unlinkService"),handler:function(){this.confirmDeleteRule()
},scope:this},{text:findLangS("nagios","deleteService"),handler:function(){this.confirmDeleteRule({id2:"service_id",table2:"nagios_service"})
},scope:this}],intervalRefreshScheduler:10})
}this.callParent([a]);
function b(k,f,d,l,h,g,c){return(Nagios.Utils.renderStateService(d))
}}});
Ext.define("Nagios.Service_Hostgroup.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosService_HostgroupStore",url:"php/model/sql.php",module:"nagios_service_hostgroup",recordStruct:rsNagios_service_hostgroup,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.service_id){Ext.applyIf(a,{sortField:"hostgroup",columns:[{dataIndex:"hostgroup",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_hostgroup",name:"hostgroup_id",allowBlank:false}],titleLang:"serviceHostgroupSubTab"})
}else{Ext.applyIf(a,{sortField:"service",columns:[{dataIndex:"service",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_service",name:"service_id",allowBlank:false}],titleLang:"hostgroupServiceSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Service_Contact.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosService_ContactStore",url:"php/model/sql.php",module:"nagios_service_contact",recordStruct:rsNagios_service_contact,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.service_id){Ext.applyIf(a,{sortField:"contact",columns:[{dataIndex:"contact",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_contact",name:"contact_id",allowBlank:false}],titleLang:"serviceContactSubTab"})
}else{Ext.applyIf(a,{sortField:"service",columns:[{dataIndex:"service",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_service",name:"service_id",allowBlank:false}],titleLang:"contactServiceSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Service_Contactgroup.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosService_ContactgroupStore",url:"php/model/sql.php",module:"nagios_service_contactgroup",recordStruct:rsNagios_service_contactgroup,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.service_id){Ext.applyIf(a,{sortField:"contactgroup",columns:[{dataIndex:"contactgroup",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_contactgroup",name:"contactgroup_id",allowBlank:false}],titleLang:"serviceContactgroupSubTab"})
}else{Ext.applyIf(a,{sortField:"service",columns:[{dataIndex:"service",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_service",name:"service_id",allowBlank:false}],titleLang:"contactgroupServiceSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Service.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.nagios_servicePanelX",constructor:function(a){this.serviceGrid=new Nagios.Service.Grid;
this.servicegroupGrid=new Nagios.Servicegroup.Grid;
a=Ext.applyIf(a||{},{id:"nagios_service-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.serviceGrid,this.servicegroupGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"service",subsystem:"nagios"});
this.callParent([a])
}});
Ext.define("Nagios.Contact.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosContactStore",url:"php/model/sql.php",module:"nagios_contact",recordStruct:rsNagios_contact,sortField:"contact_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"contact_name",sortable:true}],fullColumnSize:"contact_name",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:30,disableAutoAddTriggerWidth:true},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getDefaultValuesNagios",fpItemsSrc:[custom_configuration_existFcecust_getCustomers?{xtype:"CBX_custCustomer",name:"customer_id"}:undefined,{name:"contact_name",allowBlank:false},{name:"alias"},{xtype:"checkbox",name:"host_notifications_enabled",allowBlank:"color_label"},{xtype:"checkbox",name:"service_notifications_enabled",allowBlank:"color_label"},{xtype:"CBX_nagios_timeperiod",name:"host_notification_period_id",allowBlank:false},{xtype:"CBX_nagios_timeperiod",name:"service_notification_period_id",allowBlank:false},{xtype:"checkboxgroup",name:"host_notification_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"host_notification_option__b_down",autoBoxLabel:true,width:95},{name:"host_notification_option__b_unreachable",autoBoxLabel:true,width:95},{name:"host_notification_option__b_recoveries",autoBoxLabel:true,width:95},{name:"host_notification_option__b_flapping",autoBoxLabel:true,width:95},{name:"host_notification_option__b_scheduled",autoBoxLabel:true,width:95},{name:"host_notification_option__b_none",autoBoxLabel:true,width:95}],allowBlank:false},{xtype:"checkboxgroup",name:"service_notification_options",columns:3,defaults:{xtype:"checkbox"},items:[{name:"service_notification_option__b_warning",autoBoxLabel:true,width:95},{name:"service_notification_option__b_unknown",autoBoxLabel:true,width:95},{name:"service_notification_option__b_critical",autoBoxLabel:true,width:95},{name:"service_notification_option__b_recoveries",autoBoxLabel:true,width:95},{name:"service_notification_option__b_flapping",autoBoxLabel:true,width:95},{name:"service_notification_option__b_scheduled",autoBoxLabel:true,width:95},{name:"service_notification_option__b_none",autoBoxLabel:true,width:95}],allowBlank:false},{xtype:"CBX_nagios_command",name:"host_notification_command_id"},{xtype:"CBX_nagios_command",name:"service_notification_command_id"},{name:"email"},{name:"pager"},{name:"address1",fieldLabelLang:"addressx"},{name:"address2",hideLabel:true,width:__width_FieldChar(40),style:{marginLeft:__width_FieldChar(30)+__width_LabelFieldSeparator}},{xtype:"checkbox",name:"can_submit_commands"},{xtype:"checkbox",name:"retain_status_information"},{xtype:"checkbox",name:"retain_nonstatus_information"}],propRecordText:function(b){return(b.contact_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"contactTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){return(Nagios.Utils.getFieldDescr("contact",b))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Contact.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"contact",stripeRows:false,deferredLoad:true});
this.callParent([a])
},getDefaultValues:function(a){return({service_notification_period_id:a.rslt._24x7*1,host_notification_period_id:a.rslt._24x7*1,service_notification_option__b_warning:true,service_notification_option__b_unknown:true,service_notification_option__b_critical:true,service_notification_option__b_recoveries:true,service_notification_option__b_flapping:true,service_notification_option__b_scheduled:true,host_notification_option__b_down:true,host_notification_option__b_unreachable:true,host_notification_option__b_recoveries:true,host_notification_option__b_flapping:true,host_notification_option__b_scheduled:true,host_notification_command_id:a.rslt._notify_host_by_email*1,service_notification_command_id:a.rslt._notify_service_by_email*1})
},setContextItems:function(a,d,f,k,h,c,b){if(custom_configuration_existFcecust_getCustomers){if(f=="select"&&k.name=="customer_id"){var g=this.getField("contact_name");
g.setValue(k.getRawValue())
}this.setReadOnly("contact_name",d.customer_id)
}}});
Ext.define("Nagios.Contact.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.notificationcommand=new Nagios.Contact_NotificationCommand.Grid({relFields:{contact_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.contactgroup=new Nagios.Contactgroup_Contact.Grid({relFields:{contact_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.host=new Nagios.Host_Contact.Grid({relFields:{contact_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1,contact:a.record.data});
this.service=new Nagios.Service_Contact.Grid({relFields:{contact_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.tabPanel=new Ext.TabPanel({items:[this.host,this.service,this.notificationcommand,this.contactgroup],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"contact-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Nagios.Contact_NotificationCommand.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosContact_NotificationCommandStore",url:"php/model/sql.php",module:"nagios_contact_notification_command",recordStruct:rsNagios_contact_notification_command,sortfield:"commmand",fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},columns:[{dataIndex:"command",flex:1,sortable:true}],fpItemsSrc:[{xtype:"ComboBoxA",name:"notification_type",widthChar:10,aData:[[1,"host"],[2,"service"]],allowBlank:false},{xtype:"CBX_nagios_command",name:"command_id",allowBlank:false}],enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",titleLang:"contactNotificationCommandSubTab",stripeRows:false,deferredLoad:true});
this.callParent([a])
},getDefaultValues:function(){return({notification_type:1})
}});
Ext.define("Nagios.Contactgroup.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosContactgroupStore",url:"php/model/sql.php",module:"nagios_contactgroup",recordStruct:rsNagios_contactgroup,sortField:"contactgroup_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"contactgroup_name",sortable:true}],fullColumnSize:"contactgroup_name",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"contactgroup_name",allowBlank:false},{name:"alias",allowBlank:false}],propRecordText:function(b){return(b.contactgroup_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"contactgroupTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){return(Nagios.Utils.getFieldDescr("contactgroup",b))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Contactgroup.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"contactgroup",stripeRows:false,deferredLoad:true});
this.callParent([a])
}});
Ext.define("Nagios.Contactgroup.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.contact=new Nagios.Contactgroup_Contact.Grid({relFields:{contactgroup_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.host=new Nagios.Host_Contactgroup.Grid({relFields:{contactgroup_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.service=new Nagios.Service_Contactgroup.Grid({relFields:{contactgroup_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.tabPanel=new Ext.TabPanel({items:[this.contact,this.host,this.service],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"contactgroup-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Nagios.Contactgroup_Contact.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosContactgroup_ContactStore",url:"php/model/sql.php",module:"nagios_contactgroup_contact",recordStruct:rsNagios_contactgroup_contact,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},enableEdit:true,subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
if(a.relFields.contact_id){Ext.applyIf(a,{sortField:"contactgroup",columns:[{dataIndex:"contactgroup",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_contactgroup",name:"contactgroup_id",allowBlank:false}],titleLang:"contactgroupSubTab"})
}else{Ext.applyIf(a,{sortField:"contact",columns:[{dataIndex:"contact",flex:1,sortable:true}],fpItemsSrc:[{xtype:"CBX_nagios_contact",name:"contact_id",allowBlank:false}],titleLang:"contactSubTab"})
}this.callParent([a])
}});
Ext.define("Nagios.Contact.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.nagios_contactPanelX",constructor:function(a){this.contactGrid=new Nagios.Contact.Grid;
this.contactgroupGrid=new Nagios.Contactgroup.Grid;
a=Ext.applyIf(a||{},{id:"nagios_contact-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.contactGrid,this.contactgroupGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"contact",subsystem:"nagios"});
this.callParent([a])
}});
Ext.define("Nagios.Timeperiod.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosTimeperiodStore",url:"php/model/sql.php",module:"nagios_timeperiod",recordStruct:rsNagios_timeperiod,sortField:"timeperiod_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"timeperiod_name",widthChar:30,sortable:true},{dataIndex:"alias",sortable:true}],fullColumnSize:"alias",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"timeperiod_name",allowBlank:false},{name:"alias",allowBlank:false}],propRecordText:function(b){return(b.timeperiod_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"timeperiodTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){return(Nagios.Utils.getFieldDescr("timeperiod",b))
}},colorLabelAllowBlankFalse:"red",plugins:[{ptype:"rowexpander",rowBodyContentCls:"Nagios.Timeperiod.GridExpPanel",rowBodyContentConfig:{level:a&&a.level||1},expandOnEnter:false,expandOnDblClick:false,autoRelayoutExpanders:true}],prefixCls:"timeperiod",stripeRows:false,deferredLoad:true});
this.callParent([a])
}});
Ext.define("Nagios.Timeperiod.GridExpPanel",{extend:"Ext.Panel",constructor:function(a){this.define=new Nagios.Timeperiod.Define.Grid({relFields:{timeperiod_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.exclude=new Nagios.Timeperiod.Exclude.Grid({relFields:{timeperiod_id:a.record.data.id},style:__style_SubgridBorder(),level:a.level+1,autoRelayoutExpanders:a.level>1});
this.tabPanel=new Ext.TabPanel({items:[this.define,this.exclude],activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"timeperiod-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Nagios.Timeperiod.Define.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosTimeperiodDefineStore",url:"php/model/sql.php",module:"nagios_timeperiod_define",recordStruct:rsNagios_timeperiod_define,sortField:"weekday",columns:[{dataIndex:"weekday",widthChar:15,sortable:true,renderer:renderArrayData,arrayData:arWeekday},{dataIndex:"time_define",flex:1,sortable:true}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{xtype:"CBX_weekday",name:"weekday",_clearButton:true,widthChar:20},{name:"time_define",allowBlank:false}],enableEdit:true,titleLang:"timeperiodDefineTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){if(b=="time_define"){return("<b>[weekday]</b><br>"+Nagios.Utils.getFieldDescr("timeperiod","weekday")+"<br><b>[exception]</b><br>"+Nagios.Utils.getFieldDescr("timeperiod","exception"))
}return(Nagios.Utils.getFieldDescr("timeperiod",b))
}},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
this.callParent([a])
}});
Ext.define("Nagios.Timeperiod.Exclude.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NagiosTimeperiodExcludeStore",url:"php/model/sql.php",module:"nagios_timeperiod_exclude",recordStruct:rsNagios_timeperiod_exclude,sortField:"exclude_timeperiod",columns:[{dataIndex:"exclude_timeperiod",flex:1,sortable:true}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{xtype:"CBX_nagios_timeperiod",name:"exclude_timeperiod_id",allowBlank:false,withoutTimeperiodId:a.relFields.timeperiod_id}],enableEdit:true,titleLang:"timeperiodExcludeTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(b){if(b=="exclude_timeperiod_id"){return(Nagios.Utils.getFieldDescr("timeperiod","exclude"))
}return(Nagios.Utils.getFieldDescr("timeperiod",b))
}},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
this.callParent([a])
}});
Ext.define("Nagios.Command.Grid",{extend:"Ext.ux.grid.GridForm",constructor:function(c){var b=Nagios.Utils.getCommandArgCount();
var a=[{xtype:"displayfield",value:"<i>name</i>",fieldClass:"x-form-field"},{xtype:"displayfield",value:"<i>default</i>",fieldClass:"x-form-field"},{xtype:"displayfield",value:"<i>need</i>",fieldClass:"x-form-field"}];
for(var d=1;
d<=b;
d++){a.push({xtype:"textfield",name:"arg"+d+"_name",width:__width_FieldChar(25),hideLabel:true,style:{marginRight:5},disabled:true},{xtype:"textfield",name:"arg"+d+"_default",width:__width_FieldChar(25),hideLabel:true,style:{marginRight:5},disabled:true},{xtype:"checkbox",name:"arg"+d+"_need",width:__width_FieldChar(10),hideLabel:true,disabled:true})
}c=Ext.applyIf(c||{},{storeId:"NagiosCommandStore",url:"php/model/sql.php",module:"nagios_command",recordStruct:rsNagios_command,sortField:"category",remoteSort:true,pageSize:30,columns:[{dataIndex:"category",widthChar:30,sortable:true},{dataIndex:"command_name",widthChar:30,sortable:true},{dataIndex:"command_line",sortable:true}],fullColumnSize:"command_line",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:60,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"category"},{name:"command_name",allowBlank:false},{xtype:"textarea",name:"command_line",height:__height_FieldLines(10),allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:"arguments:",width:__width_FieldChar(20),style:{"text-align":"right"}},{width:__width_LabelFieldSeparator,border:false},{xtype:"container",layout:{type:"table",columns:3},items:a}]}],propRecordText:function(f){return(f.command_name)
},enableEdit:true,enableSearchX:true,tbar:[{text:findLangS("nagios","applyVmConfig"),iconCls:"icon_menu_reload",scope:this,handler:function(){Nagios.Utils.applyVmConfig(this)
}},"-"],paginatorPrependButtons:true,paginatorDisplayInfo:false,titleLang:"commandTab",subsystem:"nagios",subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true,getHelp:function(f){return(Nagios.Utils.getFieldDescr("command",f))
}},colorLabelAllowBlankFalse:"red",stripeRows:false,deferredLoad:true});
this.callParent([c])
},setContextItems:function(g,d,b,l,c,a,h){var f=Nagios.Utils.getCommandArgCount();
for(var k=1;
k<=f;
k++){matchArg=d.command_line.match(new RegExp("\\$ARG"+k+"\\$"));
this.enableFieldIf("arg"+k+"_name",matchArg);
this.enableFieldIf("arg"+k+"_default",matchArg);
this.enableFieldIf("arg"+k+"_need",matchArg);
this.getField("arg"+k+"_name").allowBlank=!matchArg;
if(!matchArg){this.getField("arg"+k+"_name").clearInvalid();
this.getField("arg"+k+"_name").setValue("")
}}}});
Ext.define("Nagios.Setting.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.nagios_settingPanelX",constructor:function(a){this.timeperiodGrid=new Nagios.Timeperiod.Grid;
this.commandGrid=new Nagios.Command.Grid;
a=Ext.applyIf(a||{},{id:"nagios_setting-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.timeperiodGrid,this.commandGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"setting",subsystem:"nagios"});
this.callParent([a])
}});
Ext.define("Nagios.Utils",{singleton:true,subsystem:"nagios",getObjectDefinitions:function(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getNagiosObjectDefinition"},success:function(a){if(a.objects){this.objectDefinition=a.objects
}},scope:this})
},getFieldDescr:function(a,b){if(!b){return(null)
}var c=b.search("__");
if(c>0){b=b.substr(0,c)
}if(b.match(/_id$/)){b=b.substr(0,b.length-3)
}return(this.objectDefinition&&this.objectDefinition[a]&&this.objectDefinition[a][b]||null)
},getCommandArgCount:function(){return(9)
},setCommandArgFields:function(b,h,f,d){var g=b.name;
g=g.substr(0,g.length-3);
for(var c=1;
c<=this.getCommandArgCount();
c++){var a=f.getField(g+"_arg"+c);
if(a){if(h&&h["arg"+c+"_name"]){if(d=="select"){a.setValue(h["arg"+c+"_default"])
}a.setFieldLabel(h["arg"+c+"_name"]);
a.allowBlank=h["arg"+c+"_need"]*1?false:true;
if(a.allowBlank){a.clearInvalid()
}a.show()
}else{if(d=="select"){a.setValue("")
}a.setFieldLabel("");
a.allowBlank=true;
a.clearInvalid();
a.hide()
}}}},applyVmConfig:function(a){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"applyNagiosVmConfig"},success:function(b){Ext.Msg.alert(lang.information,findLangS(this.subsystem,"newConfigurationSuccessfullyAccepted"))
},scope:this,maskEl:a})
},renderStateHost:function(a){return(a.data.status_plugin_output)
},renderStateService:function(a){return(a.data.status_plugin_output)
},getIconStateHost:function(a){var b="icon_blank";
if(a.data.status_last_check&&a.data.status_last_update){switch(a.data.status_current_state_str){case"up":b="icon_ok";
break;
case"down":b="icon_state_error";
break;
case"unreachable":b="icon_state_warning";
break
}}return(b)
},getIconStateService:function(a){var b="icon_blank";
if(a.data.status_last_check&&a.data.status_last_update){switch(a.data.status_current_state_str){case"ok":b="icon_ok";
break;
case"warning":b="icon_state_warning";
break;
case"critical":b="icon_state_error";
break;
case"unknown":b="icon_state_warning";
break
}}return(b)
}});
Ext.ns("Tools");
Ext.define("Tools.DayStatsPanel",{extend:"Ext.ux.ToolsPanel",alias:"widget.day_statsPanelX",constructor:function(b){var a=25;
var d=32;
var c=[{xtype:"textfield",fieldLabel:this.mosLtText,helpText:this.mosLtHelp,name:"mos_lt",widthN:5,align:"right"}];
if(existsMosLqoCdr){c.push({border:false,colspan:2},{xtype:"textfield",fieldLabel:this.mosLqoCallerLtText,helpText:this.mosLqoCallerLtHelp,name:"mos_lqo_caller_lt",widthN:5,align:"right"},{xtype:"textfield",fieldLabel:this.mosLqoCalledLtText,helpText:this.mosLqoCalledLtHelp,name:"mos_lqo_called_lt",widthN:5,align:"right"})
}if(existsMosXrCdr){c.push({border:false,colspan:2},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",fieldLabel:this.mosXrAvgMinCallerLtText,helpText:this.mosXrAvgMinCallerLtHelp,name:"mos_xr_avg_caller_lt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",hideLabel:true,name:"mos_xr_min_caller_lt",widthN:5,align:"right"}],width:__width_FormChar(a,d),style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",fieldLabel:this.mosXrAvgMinCalledLtText,helpText:this.mosXrAvgMinCalledLtHelp,name:"mos_xr_avg_called_lt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",hideLabel:true,name:"mos_xr_min_called_lt",widthN:5,align:"right"}],width:__width_FormChar(a,d),style:{marginBottom:__height_FieldSeparator}})
}if(existsMosSilenceCdr){c.push({border:false,colspan:2},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",fieldLabel:this.mosSilenceAvgMinCallerLtText,helpText:this.mosSilenceAvgMinCallerLtHelp,name:"mos_silence_avg_caller_lt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",hideLabel:true,name:"mos_silence_min_caller_lt",widthN:5,align:"right"}],width:__width_FormChar(a,d),style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",fieldLabel:this.mosSilenceAvgMinCalledLtText,helpText:this.mosSilenceAvgMinCalledLtHelp,name:"mos_silence_avg_called_lt",widthN:5,align:"right"},{xtype:"displayfield_h16",value:"/",fieldClass:"x-form-field",style:{marginLeft:__width_FieldSeparator,marginRight:__width_FieldSeparator}},{xtype:"textfield",hideLabel:true,name:"mos_silence_min_called_lt",widthN:5,align:"right"}],width:__width_FormChar(a,d),style:{marginBottom:__height_FieldSeparator}})
}c.push({xtype:"textfield",fieldLabel:this.packetsLossPercGtText,helpText:this.packetsLossPercGtHelp,name:"packets_lost_perc_gt",widthN:5,align:"right"},{xtype:"textfield",fieldLabel:this.jitterGtText,helpText:this.jitterGtHelp,name:"jitter_gt",widthN:5,align:"right"},{xtype:"container",layout:"hbox",items:[{xtype:"ComboBoxA",fieldLabel:this.delayText,helpText:this.delayHelp,name:"delay_limit_ge",aData:arDelay,_clearButton:true,widthCh:12},{xtype:"displayfield_h16",value:this.delayCountText+":",fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator}},{xtype:"textfield",name:"delay_count_gt",widthN:5,align:"right",hideLabel:true}],width:__width_FormChar(a,d),style:{marginBottom:__height_FieldSeparator}});
b=Ext.applyIf(b||{},{id:"day_stats-panel",url:"php/model/tools.php",task:"day_stats",iconCls:"icon_menu_diag_system",formItems:[{xtype:"container",layout:"hbox",items:[{xtype:"datetimefield",fieldLabel:this.dateFrom,name:"date_from",value:date(),zeroTimeEmpty:true},{xtype:"displayfield_h16",value:this._dateTo+":",fieldClass:"x-form-field",style:{marginLeft:10,marginRight:__width_FieldSeparator}},{xtype:"datetimefield",name:"date_to",hideLabel:true,value:date(),zeroTimeEmpty:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",fieldLabel:this.address,name:"address",width:__width_FieldChar(50),enableKeyEvents:true},{xtype:"CBX_cbIpGroups",width:__width_FieldChar(50),emptyText:"select IP addresses group",_clearButton:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",fieldLabel:this.numbers,name:"numbers",width:__width_FieldChar(50),enableKeyEvents:true},{xtype:"CBX_cbNumberGroups",width:__width_FieldChar(50),emptyText:"select numbers group",_clearButton:true}],style:{marginBottom:__height_FieldSeparator}},{xtype:"fieldset",title:this.cdrBadFilters,border:true,labelWidth:__width_FieldChar(a),items:[{layout:{type:"table",columns:2},items:c,border:false,bodyStyle:__style_FormBackground()},{xtype:"checkbox",fieldLabel:this.oneWayText,helpText:this.oneWayHelp,name:"one_way",widthN:5}],style:__style_RedukFieldSet()},{layout:{type:"table",columns:2},items:[{xtype:"checkbox",fieldLabel:this.onlyConnectedCallsText,helpText:this.onlyConnectedCallsHelp,name:"only_cdr_with_rtp",checked:true,widthN:5,labelWidth:__width_FieldChar(a)+6},{xtype:"checkbox",fieldLabel:this.printCdr,helpText:this.printCdrHelp,name:"print_cdr_recs",widthN:5,labelWidth:__width_FieldChar(a)+6}],border:false,bodyStyle:__style_FormBackground()}],listeners:{afterrender:Ext.bind(this.autoEnableComboIpGroups,this)},wikiId:"Reports#Report_generator"});
this.callParent([b])
},htmlFormatRslt:function(b,a){return"<b>"+(a.date_from&&a.date_to&&!time_sec(a.date_from)&&a.date_from.getTime()==a.date_to.getTime()?"REPORT - "+Ext.Date.format(a.date_from,__format_DateDb):"STATISTICS - "+(a.date_from?"from "+(time_sec(a.date_from)?Ext.Date.format(a.date_from,__format_DateTimeDb):Ext.Date.format(a.date_from,__format_DateDb))+" ":"")+(a.date_to?"to "+(time_sec(a.date_to)?Ext.Date.format(a.date_to,__format_DateTimeDb):Ext.Date.format(a.date_to,__format_DateDb)):""))+"</b><br>"+(b.addresses&&b.addresses.length?"List of IP addresses: "+b.addresses.join(", ")+"<br>":"")+(b.numbers&&b.numbers.length?"List of numbers: "+b.numbers.join(", ")+"<br>":"")+"report generated "+Ext.Date.format(dateTime(null),__format_DateTimeDb)+"<br>"+b.rslt
},isOkQuery:function(a){return true
},reactivate:function(){this.autoEnableComboIpGroups()
},autoEnableComboIpGroups:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkFillCb"},success:function(a){var b=this.getField("cb_ip_groups_id");
if(b){b.enableIf(a.rslt.fill_cb_ip_groups*1);
if(a.rslt.fill_cb_ip_groups*1){if(!b.getValue()){b.reset()
}}else{b.setValue(null)
}}}})
}});
Ext.override(Tools.DayStatsPanel,{title:"Report generator",answerTitle:"result",Lrun:"generate",dateFrom:"Date from",_dateTo:"to",address:"IP Addresses",numbers:"Numbers",cdrBadFilters:"filter overview",mosLtText:"MOS <",mosLqoCallerLtText:"MOS LQO Caller <",mosLqoCalledLtText:"MOS LQO Called <",mosXrAvgMinCallerLtText:"MOS XR avg/min Caller <",mosXrAvgMinCalledLtText:"MOS XR avg/min Called <",mosSilenceAvgMinCallerLtText:"MOS Silence avg/min Caller <",mosSilenceAvgMinCalledLtText:"MOS Silence avg/min Called <",packetsLossPercGtText:"Packets Loss [%] >",jitterGtText:"Jitter >",delayText:"Delay >",delayCountText:"count >",oneWayText:"One way",onlyConnectedCallsText:"only connected calls",withoutStreamText:"Missing RTP",printCdr:"print filtered CDR"});
Ext.define("Tools.MtrPanel",{extend:"Ext.ux.ToolsPanel",alias:"widget.mtrPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"mtr-panel",url:"php/model/tools.php",task:"mtr",timeout:120000,iconCls:"icon_wrench",formItems:[{xtype:"textfield",fieldLabel:this.address,name:"address",width:__width_FieldChar(50),enableKeyEvents:true},{xtype:"CBX_cbIpGroups",width:__width_FieldChar(50),emptyText:"select IP addresses group",_clearButton:true}],runDisabled:true,listeners:{afterrender:Ext.bind(this.autoEnableComboIpGroups,this)},wikiId:"Tools#MTR"});
this.callParent([a])
},htmlFormatRslt:function(c){var a="";
for(var b=0;
b<c.rslt.length;
b++){if(b){a+="<br>"
}a+="<b>MTR to: "+c.rslt[b].address+"</b><br>";
a+=Ext.Date.format(dateTime(null),__format_DateTimeDb)+"<br>";
a+='<p style="font-family: courier">'+(c.rslt[b].rslt.join?c.rslt[b].rslt.join("<br>"):c.rslt[b].rslt).replaceall(" ","&nbsp;")+"</p>";
if(c.rslt[b].error){a+='<p style="font-family: courier; color: red">'+c.rslt[b].error+"</p>"
}if(c.rslt[b].returnValue==127){alertCommandNotFound("mtr");
break
}if(c.rslt[b].returnValue==126||c.rslt[b].returnValue==1){alertCommandPermissionDenied("mtr");
break
}}return a
},isOkQuery:function(a){return a.address&&a.address.length||a.cb_ip_groups_id
},reactivate:function(){this.autoEnableComboIpGroups()
},autoEnableComboIpGroups:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkFillCb"},success:function(a){var b=this.getField("cb_ip_groups_id");
if(b){b.enableIf(a.rslt.fill_cb_ip_groups*1);
if(a.rslt.fill_cb_ip_groups*1){if(!b.getValue()){b.reset()
}}else{b.setValue(null)
}}}})
}});
Ext.override(Tools.MtrPanel,{title:"MTR",answerTitle:"mtr result",address:"IP Addresses"});
Ext.define("Tools.HostnameTable.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.HostnameTable.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"HostnameTableStore",url:"php/model/sql.php",module:"hostname",recordStruct:rsHostname,sortField:"name",remoteSort:true,pageSize:30,columns:[{header:this.LnameText,dataIndex:"name",widthCh:50,sortable:true},{header:this.LipText,dataIndex:"ip",widthCh:35}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:10},fpItems:[{fieldLabel:this.LnameText,name:"name",helpText:this.LnameHelp,allowBlank:false,blankText:lang.requirefield},{fieldLabel:this.LipText,name:"ip",helpText:this.LipHelp,allowBlank:false,blankText:lang.requirefield,widthCh:35}],propRecordText:function(b){return(b.name)
},enableEdit:true,enableSearchX:true,enableExportCsv:true,enableImportCsv:true,paginatorPrependButtons:true,paginatorDisplayInfo:false});
this.callParent([a])
}});
Ext.override(Tools.HostnameTable.Grid,{LnameText:"Name",LnameHelp:"",LipText:"IP",LipHelp:""});
Ext.define("Tools.HostnameTable.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.hostname_tablePanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"hostname_table-panel",gridXType:"HostnameTable.GridX",wikiId:"Tools#IP_lookup"});
this.callParent([a])
}});
Ext.override(Tools.HostnameTable.Panel,{titleText:"IP Lookup"});
Ext.define("Tools.PrefixTable.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.PrefixTable.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"PrefixTableStore",url:"php/model/sql.php",module:"customer_prefix",recordStruct:rsPrefix,sortField:"name",remoteSort:true,pageSize:30,columns:[{header:this.LnameText,dataIndex:"name",widthCh:50,sortable:true},{header:this.LprefixText,dataIndex:"prefix",widthCh:15},{header:this.LidcustomerText,dataIndex:"id_customer",widthCh:15}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:10},fpItems:[{fieldLabel:this.LnameText,name:"name",helpText:this.LnameHelp,allowBlank:false,blankText:lang.requirefield},{fieldLabel:this.LprefixText,name:"prefix",helpText:this.LprefixHelp,allowBlank:false,blankText:lang.requirefield,widthCh:15},{fieldLabel:this.LidcustomerText,name:"id_customer",helpText:this.LidcustomerHelp,widthCh:15}],propRecordText:function(b){return(b.name)
},enableEdit:true,enableSearchX:true,enableExportCsv:true,enableImportCsv:true,paginatorPrependButtons:true,paginatorDisplayInfo:false});
this.callParent([a])
}});
Ext.override(Tools.PrefixTable.Grid,{LnameText:"Name",LnameHelp:"",LprefixText:"Prefix",LprefixHelp:"",LidcustomerText:"ID customer",LidcustomerHelp:"Custom number identifying the customer"});
Ext.define("Tools.PrefixTable.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.customer_prefixPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"customer_prefix-panel",gridXType:"PrefixTable.GridX",wikiId:"Tools#Prefix_lookup"});
this.callParent([a])
}});
Ext.override(Tools.PrefixTable.Panel,{titleText:"Prefix Lookup"});
Ext.define("Tools.CountryPrefixTable.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.CountryPrefixTable.GridX",subsystem:"setting_customer_country_prefix",constructor:function(a){var c=["international","local"];
for(var b=0;
b<c.length;
b++){c[b]=[c[b],this.findLangS("combodata",c[b])]
}a=Ext.applyIf(a||{},{storeId:"CountryPrefixTableStore",url:"php/model/sql.php",module:"customer_country_prefix",recordStruct:rsCountryPrefix,sortField:"prefix_regex",remoteSort:true,pageSize:30,columns:[{dataIndex:"prefix_regex",widthNum:10,sortable:true},{dataIndex:"country_name",widthCh:25},{dataIndex:"advanced_mode",renderer:renderTick,widthCh:8},{dataIndex:"international_local",renderer:d,widthCh:16},{dataIndex:"description",widthCh:50}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:17,disableAutoAddTriggerWidth:true},fpItems:[{xtype:"checkbox",name:"advanced_mode"},{name:"prefix",onlyNumberContent:true,widthCh:10},{name:"number_regexp_cond",widthCh:20,enableKeyEvents:true},{xtype:"numberfield",name:"number_length_from",minValue:1,maxValue:30,widthN:5},{xtype:"numberfield",name:"number_length_to",minValue:1,maxValue:30,widthN:5},{xtype:"fieldset",title:this.findLangS("title","trim_prefix"),_id:"trim_prefix",items:[{xtype:"textfield",name:"trim_prefixes",widthCh:38,saveIfDisabled:true,enableKeyEvents:true},{xtype:"numberfield",name:"trim_prefix_length",minValue:1,maxValue:30,widthN:5,saveIfDisabled:true,enableKeyEvents:true}],width:__width_FormChar(17,41),style:__style_RedukFieldSet()},{xtype:"ComboBoxA",name:"international_local",aData:c},{xtype:"ComboBoxX",name:"country_code",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],_clearButton:true,editable:false,_stringValue:true,_autoDisableIfEmpty:true,_listVertScroller:true},{fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp,xtype:"textarea",heightL:3}],ewConfig:{height:390},propRecordText:function(f){return(f.prefix)
},enableEdit:true,enableSearchX:true,enableExportCsv:true,enableImportCsv:true,paginatorPrependButtons:true,paginatorDisplayInfo:false});
this.callParent([a]);
function d(l,f,g,m,k,h){if(g.data.advanced_mode){return(this.findLangS("combodata",l))
}return("")
}},setContextItems:function(a,d,f,h,g,c,b){this.showFieldIf(["number_regexp_cond","number_length_from","number_length_to","trim_prefixes","trim_prefix_length","international_local"],d.advanced_mode);
this.showFieldIf("prefix",!d.advanced_mode);
this.allowBlankField("prefix",d.advanced_mode?true:false);
this.enableFieldIf("country_code",!d.advanced_mode||d.international_local=="international");
this.allowBlankField("country_code",d.advanced_mode?true:false);
this.allowBlankField("number_regexp_cond",d.advanced_mode?false:true);
this.enableFieldIf("trim_prefixes",d.trim_prefixes||!d.trim_prefix_length);
this.enableFieldIf("trim_prefix_length",!d.trim_prefixes);
this.showItemBy("_id","trim_prefix",d.advanced_mode)
},prepareDataForEdit:function(a){if(!a.international_local){a.international_local="international"
}},prepareDataForSave:function(a){if(this.memoryStore){a.prefix_regex=a.advanced_mode?a.number_regexp_cond:a.prefix;
a.country_name=this.getField("country_code").getRawValue()
}},getDefaultValues:function(){return({})
},onChangeRecords:function(a,b){refreshInternationalRules()
}});
Ext.define("Tools.CountryPrefixTable.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.customer_country_prefixPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"customer_country_prefix-panel",gridXType:"CountryPrefixTable.GridX",wikiId:"Tools#CustomerCountryPrefix"});
this.callParent([a])
}});
Ext.override(Tools.CountryPrefixTable.Panel,{titleText:"Customer country prefixes"});
Ext.define("Tools.UploadFile",{extend:Ext.form.FormPanel,constructor:function(d){var g={load_pcap:{windowTitle:this.LwindowTitleLoadPcap,fieldLabel:this.LfileLoadPcapText,url:"php/model/utilities.php",task:"upload",wikiId:"Tools#Load_pcap"},load_geoip_city_data:{windowTitle:d.shiftKey&&d.ctrlKey?this.LwindowTitleLoadGeoIpCityData_extend:this.LwindowTitleLoadGeoIpCityData,fieldLabel:this.LfileLoadGeoIpDataText,url:"php/model/utilities.php",task:"upload",enableUrl:true,enableLoadFromVoipmonitorOrg:true,loadFromVoipmonitorOrgTask:"downloadGeoPosData",wikiId:"Settings#Load_GeoIP_data"},load_geoip_city_file:{windowTitle:this.LwindowTitleLoadGeoIpCityData,fieldLabel:this.LfileLoadGeoIpDataText,url:"php/model/utilities.php",task:"upload",enableUrl:true,enableLoadFromVoipmonitorOrg:true,loadFromVoipmonitorOrgTask:"downloadGeoipCity",wikiId:"Settings#Load_GeoIP_data"},load_geoip_country_data:{windowTitle:this.LwindowTitleLoadGeoIpCountryData,fieldLabel:this.LfileLoadGeoIpDataText,url:"php/model/utilities.php",task:"upload",enableUrl:true,enableLoadFromVoipmonitorOrg:true,loadFromVoipmonitorOrgTask:"downloadGeoCountryPosData",wikiId:"Settings#Load_GeoIP_data"},load_osm_tiles:{windowTitle:this.LwindowTitleLoadOSMtiles,fieldLabel:this.LfileLoadOSMtilesText,url:"php/model/utilities.php",task:"upload",enableUrl:true,enableLoadFromVoipmonitorOrg:true,maxZoomLevelFrom:6,maxZoomLevelTo:8,loadFromVoipmonitorOrgTask:"downloadOSMtiles",wikiId:"Settings#Load_OSMtiles"},batch_download_cdr_wav:{windowTitle:this.LwindowTitleBatchDownloadCdr,fieldLabel:this.LfileBatchDownloadCdrText,url:"php/model/utilities.php",task:"upload",enableDownloadExampleSourceFile:true,wikiId:"Tools#Batch_download_CDR_Wav"},import_from_csv:{windowTitle:this.LwindowTitleImportFromCsv,fieldLabel:this.LfileImportFromCsvText,url:"php/model/sql.php",task:"IMPORT",module:d.module,relFields:d.grid&&d.grid.relFields},restore_gui_config_tables:{windowTitle:this.LwindowTitleRestoreGuiConfigTables,fieldLabel:this.LfileRestoreGuiTablesText,url:"php/model/utilities.php",task:"upload"},restore_gui_data_tables:{windowTitle:this.LwindowTitleRestoreGuiDataTables,fieldLabel:this.LfileRestoreGuiTablesText,url:"php/model/utilities.php",task:"upload"},restore_gui_configuration:{windowTitle:this.LwindowTitleRestoreGuiConfiguration,fieldLabel:this.LfileRestoreGuiConfigurationText,url:"php/model/utilities.php",task:"upload"}};
var c=[{xtype:"filefield",name:"file",allowBlank:!!g[d.type].enableUrl,fieldLabel:g[d.type].fieldLabel,buttonText:this.LfileButtonText,width:350,labelWidth:60}];
if(g[d.type].enableUrl){var f=[{xtype:"textfield",name:"url",fieldLabel:this.Lurl,width:350,labelWidth:60}];
if(g[d.type].maxZoomLevelFrom&&g[d.type].maxZoomLevelTo){f.push({xtype:"numberfield",name:"max_zoom_level",value:window._select_download_osm_tiles_max_zoom||g[d.type].maxZoomLevelFrom,minValue:g[d.type].maxZoomLevelFrom,maxValue:g[d.type].maxZoomLevelTo,fieldLabel:this.LmaxZoomLevel,width:100,labelWidth:60,listeners:{change:function(l){window._select_download_osm_tiles_max_zoom=l.getValue()
}}})
}c={xtype:"tabpanel",items:[{items:f,title:this.Lurl},{items:c,title:this.LlocalFile}],defaults:{style:{padding:5,"background-color":__color_FormBackground},bodyStyle:{"background-color":__color_FormBackground},border:false},activeTab:0,border:false}
}var h=[];
if(g[d.type].enableLoadFromVoipmonitorOrg){h.push({text:this.LloadFromVoipmonitorOrg,scope:this,handler:b})
}if(g[d.type].enableDownloadExampleSourceFile){h.push({text:this.LdownloadExampleSourceFile,scope:this,handler:a},"->")
}h.push({text:lang.okButtonText,iconCls:"icon_upload",scope:this,handler:k},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close();
if(this.onCancelForm){this.onCancelForm()
}}});
d=Ext.applyIf(d||{},{windowTitle:g[d.type].windowTitle,windowIconCls:"icon_upload",url:g[d.type].url,frame:true,border:false,autoWidth:true,autoHeight:true,items:c,buttons:h,windowWikiId:g[d.type].wikiId});
this.callParent([d]);
function k(){if(!this.getForm().isValid()){return
}if(g[d.type].enableUrl){var l=this.getForm().getFieldValues();
l.file=this.findC("name","file").getValue();
if(!l.file&&!l.url){Ext.Msg.alert(this.LmissingFileOrUrl,this.LmissingFileOrUrlText);
return
}}this.maskLoad();
this.getForm().submit({scope:this,params:{task:g[this.type].task,module:g[this.type].module,params:Ext.encode({type:this.type,relFields:g[this.type].relFields,formData:this.getForm().getFieldValues(),extendedVersion:this.type=="load_geoip_city_data"&&this.shiftKey&&this.ctrlKey})},success:function(m,n){this.unmask();
this.ownerCt.close();
switch(this.type){case"load_pcap":var p=Ext.getCmp("CDR-panel");
if(p){p.cdrGrid.reload()
}break;
case"load_geoip_city_data":case"load_geoip_country_data":Ext.Msg.alert(this.LwindowTitleLoadGeoIpData,lang.success);
break;
case"batch_download_cdr_wav":var m=new Tools.BatchDownloadCdr({data:n.result.rows,file_format:"audio"});
var o=new Ext.Window({title:m.windowTitle,iconCls:m.iconCls,layout:"fit",items:m,border:false,modal:true,closable:true,resizable:false});
o.show();
break;
case"import_from_csv":this.grid.reload();
break;
case"load_geoip_city_file":Tools.DownloadData.applyGeoipCityFile(n.result.file,this.onSuccessApplyData,this.onErrorApplyData,null,this.maskEl||mviewport,true);
break;
case"load_osm_tiles":Tools.DownloadData.applyOSMtilesFile(n.result.file,this.onSuccessApplyData,this.onErrorApplyData,null,this.maskEl||mviewport,true);
break;
case"restore_gui_config_tables":new Tools.RestoreGuiConfiguration({_restoreType:"tables_config",restoreData:n.result,autoCreateWindow:true});
break;
case"restore_gui_data_tables":new Tools.RestoreGuiConfiguration({_restoreType:"tables_data",restoreData:n.result,autoCreateWindow:true});
break;
case"restore_gui_configuration":new Tools.RestoreGuiConfiguration({_restoreType:"files",restoreData:n.result,autoCreateWindow:true});
break
}},error:function(m,n){this.unmask();
alertSubmitError(n)
},failure:function(m,n){this.unmask();
if(!onAjaxRequestException(n.response,{fce:k,scope:this})){return
}alertSubmitFailure(n)
}})
}function b(){if(g[this.type].loadFromVoipmonitorOrgTask=="downloadGeoipCity"){var l=this;
Tools.DownloadData.downloadGeoipCity(function(m,o,n){l.ownerCt.close();
Tools.DownloadData.applyGeoipCityFile(m,l.onSuccessApplyData,l.onErrorApplyData,null,l.maskEl||mviewport,true)
},this.onErrorDownloadData,null,this);
return
}else{if(g[this.type].loadFromVoipmonitorOrgTask=="downloadOSMtiles"){var l=this;
Tools.DownloadData.downloadOSMtiles(this.findC("name","max_zoom_level").getValue(),function(m,o,n){l.ownerCt.close();
Tools.DownloadData.applyOSMtilesFile(m,l.onSuccessApplyData,l.onErrorApplyData,null,l.maskEl||mviewport,true)
},this.onErrorDownloadData,null,this);
return
}}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:g[this.type].loadFromVoipmonitorOrgTask,params:Ext.encode({extendedVersion:this.type=="load_geoip_city_data"&&this.shiftKey&&this.ctrlKey})},success:function(m){var o=null;
switch(this.type){case"load_geoip_city_data":case"load_geoip_country_data":beginLoadMaskWithStopButton_ajax(mviewport,"fillTableGeoPosData_loadMask","abortFillTableData");
var n;
var p;
switch(this.type){case"load_geoip_city_data":n="fillTableGeoPosData";
p={localZipFile:m.localZipFile,extendedVersion:this.type=="load_geoip_city_data"&&this.shiftKey&&this.ctrlKey,timestampId:mviewport._loadMask_timestampId};
break;
case"load_geoip_country_data":n="fillTableGeoCountryPosData";
p={localZipFile:m.localZipFile,timestampId:mviewport._loadMask_timestampId};
break
}o=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:n,params:Ext.encode(p)},success:function(q){endLoadMaskWithStopButton_ajax(mviewport)
},error2:function(){endLoadMaskWithStopButton_ajax(mviewport)
},failure:function(q){if(!o._aborted){alertAjaxFailure(q)
}endLoadMaskWithStopButton_ajax(mviewport)
},timeout:60*60*1000});
startLoadMaskWithStopButton_ajax(mviewport,o);
break
}this.ownerCt.close()
},maskEl:this,maskMsg:lang.downloadPleaseWait,timeout:10*60*1000})
}function a(){this.maskLoad();
Ext.defer(this.unmask,1000,this);
formPostSafe("php/model/utilities.php","POST",{task:"exampleSourceFile",params:Ext.encode({type:d.type})})
}}});
Ext.override(Tools.UploadFile,{LwindowTitleLoadPcap:"load pcap",LfileLoadPcapText:"pcap file",LwindowTitleLoadGeoIpData:"load geoip data",LwindowTitleLoadGeoIpData_extend:"load geoip data - extended version",LwindowTitleLoadGeoIpCityData:"load geoip - city data",LwindowTitleLoadGeoIpCityData_extend:"load geoip - city data - extended version",LwindowTitleLoadGeoIpCountryData:"load geoip - country data",LwindowTitleLoadOSMtiles:"load OSM tiles",LfileLoadGeoIpDataText:"data file",LfileLoadOSMtilesText:"data file",LwindowTitleBatchDownloadCdr:"batch download CDR",LfileBatchDownloadCdrText:"data file",LwindowTitleImportFromCsv:"import from csv",LfileImportFromCsvText:"csv file",LwindowTitleRestoreGuiConfigTables:"Restore GUI configuration tables",LwindowTitleRestoreGuiDataTables:"Restore GUI data tables",LfileRestoreGuiTablesText:"backup zip file",LwindowTitleRestoreGuiConfiguration:"Restore GUI configuration",LfileRestoreGuiConfigurationText:"backup zip file",LfileButtonText:"Select File...",LlocalFile:"local file",Lurl:"URL",LmaxZoomLevel:"max zoom",LmissingFileOrUrl:"missing file or url",LmissingFileOrUrlText:"Missing input data. Select input file or URL!",LloadFromVoipmonitorOrg:"load from "+appWeb,LdownloadExampleSourceFile:"example csv file"});
Ext.define("Tools.RestoreGuiConfiguration",{extend:"Ext.Panel",subsystem:"tools",constructor:function(c){var a=new Ext.data.ArrayStore({fields:c._restoreType=="tables_config"||c._restoreType=="tables_data"?["checked","table"]:["checked","zipname","description","filepathname"],data:[]});
if(c._restoreType=="tables_config"||c._restoreType=="tables_data"){for(var f=0;
f<c.restoreData.tables.length;
f++){a.add({checked:true,table:c.restoreData.tables[f]})
}}else{for(var f=0;
f<c.restoreData.listfiles.length;
f++){a.add({checked:true,zipname:c.restoreData.listfiles[f].zipname,description:c.restoreData.listfiles[f].description,filepathname:c.restoreData.listfiles[f].filepathname})
}}var d=[{xtype:"checkcolumn",dataIndex:"checked",header:'<img src="'+__extjs_images_path()+'menu/default-checked.gif" style="margin-left: 1px;">',checked:true,width:28,sortable:false,hideable:false,draggable:false,resizable:false,menuDisabled:true,listeners:{scope:this,checkchange:function(l,k,m){var h=this.grid.store.getAt(k);
if(h){h.data.checked=m;
h.commit()
}}}}];
if(c._restoreType=="tables_config"||c._restoreType=="tables_data"){d.push({dataIndex:"table",align:"left",flex:1,header:this.findLangS("column","table")})
}else{d.push({dataIndex:"description",align:"left",flex:1,header:this.findLangS("column","description")},{dataIndex:"filepathname",align:"left",flex:1,header:this.findLangS("column","filepathname")})
}this.grid=new Ext.grid.GridPanel({store:a,columns:{items:d,defaults:{sortable:false}},listeners:{scope:this,afterrender:function(k){var h=k.headerCt.items.get(0);
h.on("headerclick",function(){g(k,h)
},this)
}},width:500,height:180,border:true});
c=Ext.applyIf(c||{},{items:[{xtype:"displayfield",value:this.findLangS("text",c._restoreType=="tables_config"||c._restoreType=="tables_data"?"selectTablesForRestore":"selectFilesForRestore")},this.grid,{xtype:"displayfield",value:this.findLangS("text",c._restoreType=="tables_config"||c._restoreType=="tables_data"?"clickToButtonRestoreForStartRestoreSelectedTables":"clickToButtonRestoreForStartRestoreSelectedFiles")}],buttons:[{text:lang.restoreButtonText,iconCls:"icon_ok",handler:this.restore,scope:this},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){this.win.close()
},scope:this}],border:false,bodyStyle:{"background-color":__color_WindowFrame},style:{"background-color":__color_WindowFrame}});
this.callParent([c]);
if(c.autoCreateWindow){this.win=new Ext.Window({title:this.findLangS("title",c._restoreType=="tables_config"?"restoreGuiConfigTables_selectTables":c._restoreType=="tables_data"?"restoreGuiDataTables_selectTables":"restoreGuiConfiguration_selectFiles"),layout:"fit",items:this,border:false,modal:true,closable:true,resizable:false,listeners:{close:function(){this.cancel()
},scope:this}});
this.win.show()
}function g(m,l){b(l,!l.checked);
for(var k=0;
k<m.store.getCount();
k++){var h=m.store.getAt(k);
h.data.checked=l.checked;
h.commit()
}}function b(h,k){h.checked=k;
h.setText('<img src="'+__extjs_images_path()+"menu/default-"+(h.checked?"":"un")+'checked.gif">')
}},restore:function(){if(this._restoreType=="tables_config"||this._restoreType=="tables_data"){this.restoreTables()
}else{this.restoreFiles()
}},restoreTables:function(){var a=[];
this.grid.store.each(function(b){if(b.data.checked){a.push(b.data.table)
}});
if(a.length){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"runRestoreGuiTables",params:Ext.encode({tables:a,file:this.restoreData.zipfile,hash:this.restoreData.zipfile_hash})},success:function(b){Ext.Msg.longalert(this.findLangS("title",this._restoreType=="tables_config"?"restoreGuiConfigTables":"restoreGuiDataTables"),this.findLangS("text","restoreGuiTablesSuccess"),function(c){this.win.close();
window.onbeforeunload_disable=true;
window.location="./"
},this)
},maskEl:this,scope:this,timeout:30*60*1000})
}},restoreFiles:function(){var a=[];
this.grid.store.each(function(b){if(b.data.checked){a.push(b.data.zipname)
}});
if(a.length){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"runRestoreGuiConfiguration",params:Ext.encode({zipnames:a,file:this.restoreData.zipfile,hash:this.restoreData.zipfile_hash})},success:function(c){var d=false;
var h=false;
var b='<table style="font: '+__font_Grid+';">';
for(var g=0;
g<c.listfiles.length;
g++){if(c.listfiles[g].skip){continue
}var f=c.listfiles[g];
b+="<tr><td>"+f.filepathname+"<td>"+f.description;
if(f.error){b+='<td style="color: red;">'+f.error;
h=true
}else{if(f.warnings){b+='<td style="color: chocolate;">'+f.warnings.join(", ");
d=true
}else{b+='<td style="color: green;">OK'
}}}b+="</table>";
Ext.Msg.longalert(this.findLangS("title","restoreGuiConfiguration"),this.findLangS("text",h?"restoreGuiConfigurationErrors":d?"restoreGuiConfigurationWarnings":"restoreGuiConfigurationSuccess")+"<br><br>"+b+(h||d?"<br><br>"+this.findLangS("text","restoreGuiConfigurationErrorsAndWarning"):""),function(k){if(!h){this.win.close();
window.onbeforeunload_disable=true;
window.location="./"
}},this)
},maskEl:this,scope:this,timeout:30*60*1000})
}},cancel:function(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"safeUnlinkTemplateFileByHash",params:Ext.encode({file:this.restoreData.zipfile,hash:this.restoreData.zipfile_hash})}})
}});
Ext.define("Tools.BatchDownloadCdr",{extend:"Ext.Panel",constructor:function(b){if(!b.CDR){for(var d=0;
d<b.data.length;
d++){b.data[d].splice(0,0,d+1)
}}this.store=new Ext.data.ArrayStore({fields:rsBatchDownloadCdr,data:b.CDR?[]:b.data});
if(b.CDR){for(var d=0;
d<b.data.length;
d++){this.store.add({id:d+1,calldate:b.data[d].calldate,cdr_id:b.data[d].cdr_id,caller:b.data[d].caller,called:b.data[d].called})
}}var c=[];
if(b.CDR){c.push({header:this.Lcaller,dataIndex:"caller",width:__width_ColumnChar(15),sortable:false},{header:this.Lcalled,dataIndex:"called",width:__width_ColumnChar(15),sortable:false})
}else{c.push({header:this.Lnumber,dataIndex:"number",width:__width_ColumnChar(15),sortable:false},{header:this.LnumberName,dataIndex:"number_name",width:__width_ColumnChar(15),sortable:false})
}c.push({header:this.Lcalldate,dataIndex:"calldate",renderer:renderDateTime,width:__width_ColumnDateTime,sortable:false},{header:this.Lresult,dataIndex:"result",flex:1,sortable:false});
this.grid=new Ext.grid.GridPanel({store:this.store,columns:c,border:true});
var a=[[1,"wav"],[2,"ogg"],[3,"pcap (sip)"],[4,"pcap (sip + rtp)"]];
if(Ext.isString(b.file_format)){if(b.file_format=="audio"){b.file_format=1
}else{for(var d=0;
d<a.length;
d++){if(a[d][1].match(b.file_format)){b.file_format=a[d][0];
break
}}}}if(!b.file_format||Ext.isString(b.file_format)){b.file_format=1
}b=Ext.applyIf(b||{},{layout:"fit",items:[this.grid,this.info],buttons:[{xtype:"progressbar",width:300,_id:"progressbar",hidden:true},{text:lang.stop,iconCls:"icon_cancel",scope:this,handler:this.stopProgress,_id:"cancel_progress",hidden:true},"->",{xtype:"ComboBoxA",name:"file_format",value:b.file_format||1,aData:a,width:__width_FieldChar(16)+__width_Trigger,_id:"file_format",disabled:true,listeners:{scope:this,select:function(f){this.onSelectFileFormat(f.getValue())
}}},{text:lang.downloadButtonText,scope:this,handler:function(){this.download()
},_id:"download",disabled:true}],border:false,windowTitle:this.LwindowTitle,width:Math.min(700,Ext.dom.Element.getViewportWidth()*3/5),height:Math.min(400,Ext.dom.Element.getViewportHeight()*4/5),listeners:{scope:this,afterrender:function(){Ext.defer(this.onAfterRender,500,this)
}}});
this.callParent([b])
},onAfterRender:function(){this.ownerCt.on("close",this.onCloseWindow,this);
this.getCdrData()
},onSelectFileFormat:function(b){var a={1:0,2:0,3:1,4:1};
if(!this.setCdrDataForFileFormat||a[this.setCdrDataForFileFormat]!=a[b]){this.getCdrData()
}},onCloseWindow:function(){this.unlinkTempFile()
},getCdrData:function(b){if(!Ext.isDefined(b)){if(this.setCdrDataForFileFormat){delete this.setCdrDataForFileFormat
}this.clearFileRslt();
this.enableDownloadButton(false);
this.showProgress(true);
this.updateProgress(0,this.store.getCount());
this.stop=false;
this.getCdrData(0)
}else{if(b<this.store.getCount()){var a=cloneObject(this.store.getAt(b).data);
a.calldate=Ext.Date.format(a.calldate,a.calldate.getMilliseconds()?__format_DateTimeMs:__format_DateTime);
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getCdrForBatchDownloadCdr",params:Ext.encode({data:[a],file_format:this.getFileFormat()})},success:function(c){if(this.getEl()){if(this.stop){this.showProgress(false);
this.enableDownloadButton(true)
}else{this.updateProgress(b+1,this.store.getCount());
this.setFileRslt(c.data);
this.getCdrData(b+1)
}}},error:function(c,d){if(this.getEl()){alertAjaxError(d,null,{text:lang.retry+"?",yes:function(){if(this.getEl()){this.getCdrData(b)
}},no:function(){if(this.getEl()){this.unmask();
this.showProgress(false);
this.enableDownloadButton(true)
}},scope:this})
}},failure2:function(){if(this.getEl()){this.showProgress(false);
this.enableDownloadButton(true)
}},scope:this})
}else{this.showProgress(false);
this.enableDownloadButton(true);
this.setCdrDataForFileFormat=this.getFileFormat()
}}},setFileRslt:function(c){for(var b=0;
b<c.length;
b++){var a=this.grid.store.getById(c[b].id);
if(a){a.data.cdr=c[b].cdr;
a.beginEdit();
a.data.result=this.getResultFromCdr(c[b].cdr);
a.endEdit()
}}},clearFileRslt:function(){for(var b=0;
b<this.grid.store.getCount();
b++){var a=this.grid.store.getAt(b);
if(a){if(Ext.isDefined(a.data.cdr)){delete a.data.cdr
}if(Ext.isDefined(a.data.result)){a.beginEdit();
delete a.data.result;
a.endEdit()
}}}},getResultFromCdr:function(c){var a='<table style="width: 100%; font: '+__font_Grid+'; table-layout: fixed;">';
if(!c||!c.length){a+='<tr><td style="width: 50px; text-align: right"></td><td style="width: 50px; text-align: center; color: red;">ERROR</td><td>No CDR found</td></tr>'
}else{for(var b=0;
b<c.length;
b++){a+="<tr>";
a+='<td style="width: 50px; text-align: right">'+c[b].id+"</td>";
a+='<td style="width: 50px; text-align: center; color: '+(c[b].file_ok?"green":"red")+';">'+(c[b].file_ok?"OK":"ERROR")+"</td>";
a+="<td>"+(c[b].file_error||"")+"</td>";
a+="</tr>"
}}a+="</table>";
return(a)
},getOkCdr:function(){var d=[];
var f=this.grid.store.getCount();
for(var c=0;
c<f;
c++){var a=this.grid.store.getAt(c);
if(a&&a.data.cdr&&a.data.cdr.length){for(var b=0;
b<a.data.cdr.length;
b++){if(a.data.cdr[b]&&a.data.cdr[b].file_ok){d.push({id:a.data.cdr[b].id,calldate:a.data.cdr[b].calldate,caller:a.data.cdr[b].caller,called:a.data.cdr[b].called,number:a.data.number,number_name:a.data.number_name})
}}}}return(d)
},getCsv:function(){var c="";
var g=this.grid.store.getCount();
for(var f=0;
f<g;
f++){var a=this.grid.store.getAt(f);
if(a){var d=(f+1)+',"'+a.data.number+'","'+a.data.number_name+'","'+Ext.Date.format(a.data.calldate,__format_DateTimeDb)+'",';
if(a.data.cdr&&a.data.cdr.length){for(var b=0;
b<a.data.cdr.length;
b++){if(a.data.cdr[b].file_ok){c+=d+'"OK",'+a.data.cdr[b].id+',"'+a.data.cdr[b].calldate+'","'+a.data.cdr[b].caller+'","'+a.data.cdr[b].called+'",\n'
}else{c+=d+'"ERROR","'+a.data.cdr[b].file_error+'"\n'
}}}else{c+=d+'"ERROR","No CDR found"\n'
}}}return(c)
},isOkWavRslt:function(){var a=this.getOkCdr();
return(a.length>0)
},download:function(b,c,d,a){if(!Ext.isDefined(b)){this.showProgress(true);
this.updateProgress(0,this.store.getCount());
this.enableDownloadButton(false);
this.stop=false;
this.download(0,this.getOkCdr())
}else{if(b<c.length){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"batchPrepareCdr",params:Ext.encode({cdr:[c[b]],log:b==c.length-1?this.getCsv():undefined,file_format:this.getFileFormat(),file:d,finish:b==c.length-1})},success:function(f){if(this.getEl()){if(this.stop){this.showProgress(false);
this.enableDownloadButton(true);
this.unlinkTempFile()
}else{this.updateProgress(b+1,c.length);
this.download(b+1,c,f.file,f.hash)
}}},error:function(f,g){if(this.getEl()){alertAjaxError(g,null,{text:lang.retry+"?",yes:function(){if(this.getEl()){this.download(b,c,f.file,f.hash)
}},no:function(){if(this.getEl()){this.unmask();
this.showProgress(false);
this.enableDownloadButton(true);
this.unlinkTempFile()
}},scope:this})
}},failure2:function(){if(this.getEl()){this.showProgress(false);
this.enableDownloadButton(true);
this.unlinkTempFile()
}},scope:this})
}else{this.showProgress(false);
this.enableDownloadButton(true);
if(d&&a){this.maskLoadTime(1000);
formPostSafe("php/model/utilities.php","POST",{task:"batchDownloadCdr",params:Ext.encode({file:d,hash:a})})
}}}},getFileFormat:function(){var a=this.dockedItems.items[0];
return(a.findC("name","file_format").getValue()||this.file_format)
},enableDownloadButton:function(c){var b=this.isOkWavRslt();
var a=this.dockedItems.items[0];
a.findC("_id","download").enableIf(b&&c);
a.findC("_id","file_format").enableIf(b&&c)
},showProgress:function(a){var b=this.dockedItems.items[0];
b.findC("_id","progressbar").setVisible(a);
b.findC("_id","cancel_progress").setVisible(a);
b.updateLayout()
},updateProgress:function(c,b){var a=this.dockedItems.items[0];
a.findC("_id","progressbar").updateProgress(c/b)
},stopProgress:function(){this.stop=true
},unlinkTempFile:function(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"batchPrepareCdr_unlinkTempFile"}})
}});
Ext.override(Tools.BatchDownloadCdr,{LwindowTitle:"batch download CDR",Lnumber:"number",LnumberName:"number name",Lcalldate:"call datetime",Lcaller:"caller",Lcalled:"called",Lresult:"result: CDR ID, state, error"});
Ext.define("Tools.AuditForm",{extend:Ext.form.FormPanel,constructor:function(a){a=Ext.applyIf(a||{},{windowTitle:this.LwindowTitle,windowIconCls:"icon_script_edit",url:"php/model/utilities.php",frame:true,border:false,autoWidth:true,autoHeight:true,items:[{xtype:"displayfield",name:"activity",fieldLabel:this.LtypeActivityText,helpText:this.LtypeActivityHelp,value:getDataArrayItem(arAuditActivity,a.activity),width:400,labelWidth:90},{xtype:"textarea",name:"reason",allowBlank:!!a.allowBlankReason,fieldLabel:this.LreasonText,helpText:this.LreasonHelp,width:400,height:80,labelWidth:90,enableKeyEvents:true,listeners:{scope:this,keydown:function(d,c){if(c.keyCode==c.ENTER&&!c.ctrlKey&&!c.altKey){this._enterInTextAreaField=d
}}}},{xtype:"displayfield",name:"activity",value:this.LhelpContinue,width:400,style:{paddingRight:3},fieldStyle:{"text-align":"right","font-style":"italic","padding-right":3}}],buttons:[{text:lang.continueButtonText,iconCls:"icon_ok",scope:this,handler:b},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}],listeners:{scope:this,afterrender:function(){focusField=this.getForm().findField("reason");
if(focusField){focusField.focus(false,200)
}Ext.create("Ext.util.KeyNav",this.el,{enter:function(){if(this._enterInTextAreaField){this._enterInTextAreaField=null;
return true
}else{b.call(this)
}},scope:this})
},close:function(){if(!this.okSuccess&&this.fceCancel){this.fceCancel.call(this.fceContinueScope)
}}}});
this.callParent([a]);
function b(){if(!this.getForm().isValid()){return
}this.maskLoad();
var c={activity:this.activity,activity_name:getDataArrayItem(arAuditActivity,this.activity),cdrId:this.cdrId,messageId:this.messageId,ss7Id:this.ss7Id,filterData:this.filterData,formData:this.getForm().getFieldValues()};
if(this.mergeParams){Ext.applyIf(c,this.mergeParams)
}this.getForm().submit({scope:this,params:{task:"saveAudit",params:Ext.encode(c)},success:function(d,f){this.okSuccess=true;
this.unmask();
this.ownerCt.close();
this.fceContinue.call(this.fceContinueScope,f.result&&f.result.audit_log_id)
},failure:function(d,f){this.unmask();
if(!onAjaxRequestException(f.response,{fce:b,scope:this})){return
}alertSubmitFailure(f)
}})
}},createWindow:function(){this.window=new Ext.Window({title:this.windowTitle,iconCls:this.windowIconCls,layout:"fit",items:this,border:false,modal:true,closable:true,resizable:false});
this.window.show()
},audit:function(){if(this.autoAudit){var a={activity:this.activity,activity_name:getDataArrayItem(arAuditActivity,this.activity),cdrId:this.cdrId,messageId:this.messageId,ss7Id:this.ss7Id,filterData:this.filterData,autoAudit:true,autoAuditParams:this.autoAuditParams};
if(this.mergeParams){Ext.applyIf(a,this.mergeParams)
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveAudit",params:Ext.encode(a)},success:function(b){this.fceContinue.call(this.fceContinueScope,b&&b.audit_log_id)
},error:function(){this.createWindow()
}})
}else{this.createWindow()
}}});
Ext.override(Tools.AuditForm,{LwindowTitle:"activity audit",LtypeActivityText:"activity type",LtypeActivityHelp:"",LreasonText:"reason",LreasonHelp:"",LhelpContinue:"for continue press [ctrl]+[enter]"});
Ext.define("Tools.EmailForm",{extend:Ext.form.FormPanel,constructor:function(b){var a=[{xtype:"textfield",name:"email",value:b.email,allowBlank:false,fieldLabel:this.LtoText,helpText:this.LtoHelp,width:250,labelWidth:50}];
if(Ext.isDefined(b.from)){a.push({xtype:"textfield",name:"from",value:b.from,allowBlank:false,fieldLabel:this.LfromText,helpText:this.LfromHelp,width:250,labelWidth:50})
}if(Ext.isDefined(b.subject)){a.push({xtype:"textfield",name:"subject",value:b.subject,allowBlank:false,fieldLabel:this.LsubjectText,helpText:this.LsubjectHelp,width:400,labelWidth:50})
}if(Ext.isDefined(b.message)){a.push({xtype:"textarea",name:"message",value:b.message,allowBlank:false,fieldLabel:this.LmessageText,helpText:this.LmessageHelp,width:400,labelWidth:50,height:100,enableKeyEvents:true,listeners:{scope:this,keydown:function(f,d){if(d.keyCode==d.ENTER&&!d.ctrlKey&&!d.altKey){this._enterInTextAreaField=f
}}}})
}if(Ext.isDefined(b.signature)){a.push({xtype:"textarea",name:"signature",value:b.signature,allowBlank:false,fieldLabel:this.LsignatureText,helpText:this.LsignatureHelp,width:400,labelWidth:50,height:60,enableKeyEvents:true,listeners:{scope:this,keydown:function(f,d){if(d.keyCode==d.ENTER&&!d.ctrlKey&&!d.altKey){this._enterInTextAreaField=f
}}}})
}b=Ext.applyIf(b||{},{windowTitle:this.LwindowTitle,windowIconCls:"icon_email_send",frame:true,border:false,autoWidth:true,autoHeight:true,items:a,buttons:[{text:lang.sendButtonText,iconCls:"icon_email_send",scope:this,handler:c},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}],listeners:{scope:this,afterrender:function(){focusField=this.getForm().findField("email");
if(focusField){focusField.focus(false,200)
}Ext.create("Ext.util.KeyNav",this.el,{enter:function(){if(this._enterInTextAreaField){this._enterInTextAreaField=null;
return true
}else{c.call(this)
}},scope:this})
}}});
this.callParent([b]);
function c(){if(!this.getForm().isValid()){return
}var d=this.getForm().getFieldValues();
this.fceSubmit.call(this.fceSubmitScope,d,this.fceSubmitParams);
this.ownerCt.close()
}},createWindow:function(){this.window=new Ext.Window({title:this.windowTitle,iconCls:this.windowIconCls,layout:"fit",items:this,border:false,modal:true,closable:true,resizable:false});
this.window.show()
}});
Ext.override(Tools.EmailForm,{LwindowTitle:"send email",LtoText:"to",LtoHelp:"",LfromText:"from",LfromHelp:"",LsubjectText:"subject",LsubjectHelp:"",LmessageText:"message",LmessageHelp:"",LsignatureText:"signature",LsignatureHelp:""});
Ext.define("Tools.AuthChangeGuide",{extend:"Ext.form.FormPanel",subsystem:"changeUserAuth",constructor:function(a){this.msgHeader=this.findLangS("title","authErrorTitle");
if(a.what=="selfaction"){var g=[{xtype:"displayfield",name:"possibleActions"}];
if(!(user.sqlrow.hide_change_password*1)){g.push({xtype:"checkbox",name:"setPassword"})
}g.push({xtype:"checkbox",name:"set2FAsecret",boxLabel:this.findLangS("checkbox",user.sqlrow.exist_secret?"change2FAsecret":"set2FAsecret")})
}else{var g=[{xtype:"displayfield",name:"requiredActions"}];
if(a.reqPass){g.push({xtype:"displayfield",name:"requirePassword"})
}if(a.req2FA){g.push({xtype:"displayfield",name:"require2FA"})
}}var f=[{xtype:"displayfield",name:"authRequired"},{xtype:"textfield",name:"password",inputType:"password",allowBlank:false}];
if(user.sqlrow.exist_secret){f.push({xtype:"textfield",name:"code2fa",allowBlank:false})
}var m=[{xtype:"displayfield",name:"newPassword"},{xtype:"textfield",name:"newpassword",inputType:"password",allowBlank:false,vtype:"testDiffPasswordNewOld",_passwordOldField:"password",_form:this,msgTarget:"side"},{xtype:"textfield",name:"newpassword2",inputType:"password",allowBlank:false,vtype:"testEqPasswordNewAgain",_passwordNewField:"password_new",_form:this,msgTarget:"side"}];
var h=[{xtype:"displayfield",name:"new2FA"},{xtype:"displayfield",name:"secret",width:"100%",style:{"text-align":"center"}},{xtype:"container",layout:{type:"hbox",pack:"center",align:"middle"},items:{xtype:"image",alt:"QR Image",name:"qrcode",src:"",width:200,height:200}}];
var n=[{xtype:"displayfield",name:"verify"},{xtype:"textfield",name:"verifypassword",inputType:"password",allowBlank:false,hidden:true},{xtype:"textfield",name:"verifycode2fa",allowBlank:false,hidden:true}];
var b=[{xtype:"displayfield",name:"finish"}];
var k=[{_id:"start_info_form",items:g,hidden:false},{_id:"auth_form",items:f,enableStep:function(o){return(!o.config.skipAuth)
}},{_id:"newpass_form",items:m,enableStep:function(o){return(o.rsltData.doPass)
}},{_id:"new2fa_form",items:h,enableStep:function(o){return(o.rsltData.do2FA)
}},{_id:"verify_form",items:n,enableStep:function(o){return(o.rsltData.do2FA)
}},{_id:"finish_form",items:b}];
for(var d=0;
d<k.length;
d++){Ext.applyIf(k[d],{xtype:"container",layout:{type:"vbox",align:"stretch"},hidden:true,border:false});
for(var c=0;
c<k[d].items.length;
c++){switch(k[d].items[c].xtype){case"textfield":Ext.applyIf(k[d].items[c],{fieldLabel:this.findLangS("field",k[d].items[c].name),enableKeyEvents:true,listeners:{scope:this,keyup:this.checkContentStep,change:this.checkContentStep}});
break;
case"checkbox":Ext.applyIf(k[d].items[c],{boxLabel:this.findLangS("checkbox",k[d].items[c].name),listeners:{scope:this,change:this.checkContentStep}});
break;
case"displayfield":Ext.applyIf(k[d].items[c],{value:this.findLangS("text",k[d].items[c].name)});
break
}}var l=this.findLangS("title",k[d]._id);
if(l){k[d].items=[{xtype:"displayfield",value:l,width:"100%",fieldStyle:{"font-weight":"bold","font-style":"italic"},style:{paddingLeft:5,paddingRight:5,paddingTop:2,paddingBottom:2,"background-color":__color_ButtonsBackground}},{xtype:"container",items:k[d].items,style:{padding:5}},{xtype:"container",flex:1},{xtype:"displayfield",name:"error",width:"100%",fieldStyle:{color:"red"},style:{padding:5}}]
}else{Ext.applyIf(k[d],{style:{padding:5}})
}}a=Ext.applyIf(a||{},{windowTitle:this.findLangS("title","authChangeAuth"),layout:"fit",items:k,border:false,bodyStyle:{"background-color":__color_WindowFrame},buttons:[{name:"prevButton",text:lang.prevButtonText,scope:this,handler:function(){this.handlePrev()
},hidden:true},{name:"nextButton",text:lang.nextButtonText,scope:this,handler:function(){this.handleNext()
},disabled:a.what=="selfaction"}],height:400,width:500,listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",this.el,{enter:function(){this.handleNext()
},scope:this});
Ext.defer(function(){this.evAfterShowStep();
this.checkContentStep()
},100,this)
}},activeStep:k[0]._id});
this.callParent([a]);
this.stateNext="next_start_info_form_button";
this.statePrev="";
this.rsltData={}
},handleNext:function(){if(this.checkContentStep()===true){if(Ext.isFunction(this[this.stateNext])){this[this.stateNext]()
}else{this.nextStep()
}}},handlePrev:function(){if(Ext.isFunction(this[this.statePrev])){this[this.statePrev]()
}else{this.prevStep()
}},next_start_info_form_button:function(){var a=this.getForm().getFieldValues();
this.rsltData.doPass=this.config.reqPass||(a&&a.setPassword);
this.rsltData.do2FA=this.config.req2FA||(a&&a.set2FAsecret);
this.findC("name","verifypassword").showIf(this.rsltData.doPass);
this.findC("name","verifycode2fa").showIf(this.rsltData.do2FA);
this.nextStep()
},next_auth_form_button:function(){var a=this.getForm().getFieldValues();
this.rsltData.old_password=a.password;
this.rsltData.old_code2fa=a.code2fa;
var b={action:"authExistUser",password:this.rsltData.old_password,code2fa:this.rsltData.old_code2fa};
ajaxSafeRequest({maskEl:this,scope:this,url:"php/model/utilities.php",params:{task:"verifyAuth",params:Ext.encode(b)},success:function(c){if(c.success){this.nextStep()
}},error:function(c){Ext.Msg.alert(this.msgHeader,c.error)
}})
},next_newpass_form_button:function(){var a=this.getForm().getFieldValues();
this.rsltData.new_password=a.newpassword;
var b={action:"checkPassword",password:this.rsltData.new_password};
ajaxSafeRequest({maskEl:this,scope:this,url:"php/model/utilities.php",params:{task:"verifyAuth",params:Ext.encode(b)},success:function(c){if(c.success){this.nextStep()
}},error:function(c){Ext.Msg.alert(this.msgHeader,c.error)
}})
},next_verify_form_button:function(){var a=this.getForm().getFieldValues();
var b={action:"authCheckNewSetting",setPassword:this.rsltData.doPass,set2FAsecret:this.rsltData.do2FA,newpassword:this.rsltData.new_password,verifypassword:a.verifypassword,code2fa:a.verifycode2fa,secret:this.rsltData.new_2fa_secret};
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"verifyAuth",params:Ext.encode(b)},success:function(c){if(c.success){this.nextStep()
}},error:function(c){Ext.Msg.alert(this.msgHeader,c.error)
},maskEl:this,scope:this})
},next_finish_form_button:function(){var a={setPassword:this.rsltData.doPass,set2FAsecret:this.rsltData.do2FA,newpassword:this.rsltData.new_password,secret:this.rsltData.new_2fa_secret};
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"changeUserAuth",params:Ext.encode(a)},success:function(b){if(this.rsltData.do2FA){user.sqlrow.exist_secret=true
}this.ownerCt.close()
},error:function(b){Ext.Msg.alert(this.msgHeader,b.error)
},maskEl:this,scope:this})
},gen2FAsecret:function(){if(this.gen2FAsecret_ok){return
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"handle2FA",params:Ext.encode({username:window.username,secret:undefined})},success:function(a){var b=this.findC("name","secret");
var c=this.findC("name","qrcode");
if(b&&c){this.rsltData.new_2fa_secret=a.secret;
b.setValue(a.secret);
c.setSrc("data:image/png;base64,"+a.encqrcode);
this.gen2FAsecret_ok=true
}},scope:this,maskEl:this})
},nextStep:function(){var c=this.getIndexActiveStep();
var a=null;
for(var b=c+1;
b<this.config.items.length;
b++){if(!this.config.items[b].enableStep||this.config.items[b].enableStep(this)){var a=this.config.items[b]._id;
break
}}if(a){this.hideShowStep(a)
}},prevStep:function(){var c=this.getIndexActiveStep();
var a=null;
for(var b=c-1;
b>=0;
b--){if(!this.config.items[b].enableStep||this.config.items[b].enableStep(this)){var a=this.config.items[b]._id;
break
}}if(a){this.hideShowStep(a)
}},getIndexActiveStep:function(){var b=-1;
for(var a=0;
a<this.config.items.length;
a++){if(this.config.items[a]._id==this.activeStep){return(a)
}}return(null)
},hideShowStep:function(a){this.cascade(function(b){if(b._id){if(b._id==a){b.show();
this.getBottomToolbar().findC("name","prevButton").showIf(a!="start_info_form");
this.getBottomToolbar().findC("name","nextButton").setText(a=="finish_form"?lang.finishButtonText:lang.nextButtonText);
this.stateNext="next_"+a+"_button";
this.statePrev="prev_"+a+"_button";
this.activeStep=a;
Ext.defer(function(){this.evAfterShowStep();
this.checkContentStep()
},100,this)
}else{b.hide()
}}},this)
},evAfterShowStep:function(){if(this.activeStep=="new2fa_form"){this.gen2FAsecret()
}var b=this.findC("_id",this.activeStep);
if(b){var a=null;
b.cascade(function(c){if(!a&&(c.xtype=="textfield"||c.xtype=="checkbox")){a=c
}});
if(a){a.focus()
}else{b.focus()
}}},checkContentStep:function(){var c=this.getFieldValuesStep();
var d=false;
var b=null;
switch(this.activeStep){case"start_info_form":if(this.config.what=="selfaction"){if(c.setPassword||c.set2FAsecret){d=true
}else{b="authMissingSetting"
}}else{d=true
}break;
case"auth_form":if(Ext.isDefined(c.password)&&!c.password){b="authMissingOldPassword"
}else{if(Ext.isDefined(c.code2fa)&&!c.code2fa){b="authMissingOld2FAcode"
}else{d=true
}}break;
case"newpass_form":if(c.newpassword==this.rsltData.old_password){b="authNeedDiffPasswordNewOld"
}else{if(c.newpassword||c.newpassword2){if(c.newpassword==c.newpassword2){d=true
}else{b="authDifferentNewPassword"
}}else{b="authMissingNewPassword"
}}break;
case"new2fa_form":d=true;
break;
case"verify_form":if(Ext.isDefined(c.verifypassword)&&!c.verifypassword){b="authMissingPassword"
}else{if(Ext.isDefined(c.verifycode2fa)&&!c.verifycode2fa){b="authMissing2FAcode"
}else{d=true
}}break;
case"finish_form":d=true;
break
}this.getBottomToolbar().findC("name","nextButton").enableIf(d);
if(b){b=this.findLangS("text",b)||b
}var f=this.findC("_id",this.activeStep);
var a=f.findC("name","error");
a.setValue(b);
return(b?b:d)
},getFieldValuesStep:function(){var a=null;
var b=this.findC("_id",this.activeStep);
b.cascade(function(c){if(!c.hidden&&(c.xtype=="textfield"||c.xtype=="checkbox")){if(a===null){a={}
}a[c.name]=c.getValue()
}});
return(a)
}});
Ext.define("Tools.ServerSideConfiguration",{extend:"Ext.Panel",enableCheckBoxBool:false,constructor:function(v){var o="serverSideConfig";
if(!Ext.ClassManager.isCreated(o)){Ext.define(o,{extend:"Ext.data.Model",fields:rsServerSideConfig,idProperty:"ID"})
}this.store=new Ext.data.Store({storeId:"StoreServerSideConfig",model:o,proxy:{type:"ajax",url:"php/model/utilities.php",actionMethods:"POST",extraParams:{task:"getServerSideConfiguration"},reader:{rootProperty:"results",totalProperty:"total",idProperty:"mainname"}},pageSize:-1,remoteSort:true,listeners:{scope:this,load:h},groupField:"group"});
var k=this.store;
this.store.load();
this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{beforeedit:q,edit:b,canceledit:c}});
this.grid=new Ext.grid.GridPanel({store:this.store,columns:[{xtype:"actioncolumn",header:this.LenabledText,dataIndex:"disabled",width:60,rendererBase:function(D,A,z,E,C,B,y){A.style="padding-left: 2; padding-top: 0; padding-bottom: 0;";
return("")
},items:[{getClass:function(y,z,A){return(!s(A)?"icon_blank":A.data.disabled?"icon_cross":"icon_ok")
},handler:function(z,D,A,B,C,y){y.data.disabled=!y.data.disabled;
y.commit();
g(z.ownerCt)
},scope:this}],iconDivStyle:"padding-left: 17; height:15; width: 15;"},{header:this.LnameText,dataIndex:"name",flex:1,sortable:false,renderer:p},{header:this.LvalueText,dataIndex:"value",flex:1,sortable:false,renderer:l,getEditor:m,_panel:this}],viewConfig:{stripeRows:false,listeners:{cellcontextmenu:function(A,y,B,z,D,E,C){C.stopEvent()
}},onFocusEnter:function(){},onFocusLeave:function(){}},plugins:[this.cellEditing],features:[{ftype:"grouping",groupHeaderTpl:"{name}"}],border:true,hideHeaders:true,region:"center",bufferedRenderer:false});
this.grid.selModel.on("selectionchange",n,this);
var a=this.grid;
this.info=new Ext.Panel({height:80,border:true,region:"south",autoScroll:true,style:{"padding-top":3,"background-color":__color_WindowFrame}});
var t=this.info;
v=Ext.applyIf(v||{},{layout:"border",items:[this.grid,this.info],buttons:{items:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:this.save},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}],style:{"background-color":__color_WindowFrame,padding:5,marginTop:0}},buttonAlign:"center",border:false,windowTitle:this.LwindowTitle,iconCls:"icon_wrench",width:Math.min(700,Ext.dom.Element.getViewportWidth()*3/5),height:Ext.dom.Element.getViewportHeight()*4/5,windowWikiId:"Settings#System_configuration"});
var w=this;
this.callParent([v]);
function p(C,y,z,D,B,A){if(s(z)&&!z.data.disabled&&z.data.type=="bool"&&!z.data.value){return(renderStringStyle(C,{color:"#531619"}))
}return(d(C,z))
}function l(E,y,z,F,C,A){if(z.data.type=="bool"){E=E?"TRUE":"false"
}else{if(z.data.array_values&&!z.data.array_values.length){E=z.data.array_values[E]
}}if(z.data.subtype=="password"){var D=E&&E.length;
E="";
for(var B=0;
B<D;
B++){E+="&bull;"
}}return(d(E,z))
}function d(A,y){var B=s(y);
var z=y.data.disabled?"grey":!B?"#8084A5":undefined;
return(renderStringStyle(A,{color:z,italic:!B||y.data.disabled,strike:y.data.disabled}))
}function m(z,A){this._panel.cellEditing._record=z;
this._panel.cellEditing._type=null;
this._panel.cellEditing.editors.clear();
if(z.data.disabled||!s(z)){return(false)
}var D;
if(z.data.array_values){var E=[];
var y=[];
var C;
if(z.data.array_values.length){for(var B=0;
B<z.data.array_values.length;
B++){E.push([z.data.array_values[B]])
}y.push("id");
C="id"
}else{for(var B in z.data.array_values){E.push([B,z.data.array_values[B]])
}y.push("id","descr");
C="descr"
}D={xtype:"ComboBoxA",editable:false,aData:{data:E,fields:y},valueField:"id",displayField:C,_stringValue:true}
}else{if(z.data.type=="bool"){if(w.enableCheckBoxBool){D={xtype:"checkbox",fieldStyle:{marginTop:5},listeners:{afterrender:function(F){F.getEl().down(".x-form-item-body").setStyle({"text-align":"left","padding-left":5})
}}};
this._panel.cellEditing._type="checkBoxBool"
}else{D={xtype:"ComboBoxA",editable:false,aData:[[1,"TRUE"],[0,"false"]]};
this._panel.cellEditing._type="comboBoxBool"
}}}if(!D){D={xtype:"textfield"};
if(z.data.subtype=="password"){D.inputType="password"
}}if(!D.listeners){D.listeners={}
}if(D.xtype=="ComboBoxA"){Ext.applyIf(D.listeners,{afterrender:function(F){Ext.defer(function(){F.expand()
},10)
}})
}Ext.applyIf(D.listeners,{collapse:r,select:r,change:u});
D.editorCfg={allowBlur:false,onFocusEnter:function(){},onFocusLeave:function(F){if(this[this.focusLeaveAction]()===false){F.event.stopEvent();
return
}this.completeEdit()
}};
return(D)
}function r(y){if(y.xtype=="ComboBoxA"){w.cellEditing.completeEdit()
}}function u(y){if(y.xtype&&y.xtype.match&&y.xtype.match(/^checkbox/)){w.cellEditing.completeEdit()
}}function h(z,y){}function b(y,z){if(y._type=="comboBoxBool"){z.record.data.value=z.value==1
}if(z.record.data.value!=z.originalValue){g(this.view.ownerCt)
}}function q(y,z){if(y._type=="comboBoxBool"){z.value=z.value?1:0
}}function c(y,z){}function f(z){var y;
k.each(function(A){if(A.data.mainname==z){y=A.data.value
}});
return(y)
}function s(y){if(!y.data.context_enable){return(true)
}for(var z in y.data.context_enable){if(f(z)!=y.data.context_enable[z]){return(false)
}}return(true)
}function g(y){if(y&&y.maskLoad){y.maskLoad()
}Ext.defer(function(){a.store.each(function(z){z.commit()
});
if(y&&y.unmask){y.unmask()
}},100)
}function n(y,z){var A="";
if(z&&z.length&&z[0].data.comment){if(Ext.isArray(z[0].data.comment)){A=z[0].data.comment.join("<br>")
}else{A=z[0].data.comment
}}if(A){A='<div style="padding:5;">'+A+"</div>"
}t.body.setHtml(A)
}},save:function(){var a=[];
this.store.each(function(b){a.push(b.data)
});
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setServerSideConfiguration",params:Ext.encode({data:a})},success:function(b){this.ownerCt.close();
Ext.Msg.confirm("",this.LreloadWithNewSystemConfigurationConfirm,function(c){if(c=="yes"){mviewport.getEl().mask(lang.pleaseWait,"x-mask-loading");
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setCheckTables"},success:function(d){window.onbeforeunload_disable=true;
window.location.reload(true)
},errorFailure2:function(){mviewport.getEl().unmask()
}})
}},this)
},maskEl:this})
}});
Ext.override(Tools.ServerSideConfiguration,{LwindowTitle:"System configuration",LnameText:"name",LvalueText:"value",LenabledText:"enabled",LreloadWithNewSystemConfigurationConfirm:"Reload application with new system configuration?"});
Ext.define("Tools.DownloadData",{singleton:true,downloadGeoipCity:function(d,c,a,b){this.downloadDataFile("downloadGeoipCity","GeoIP city",null,d,c,a,b)
},downloadOSMtiles:function(b,f,d,a,c){this.downloadDataFile("downloadOSMtiles","OSM tiles",{maxZoom:b},f,d,a,c)
},downloadDataFile:function(b,h,g,f,d,a,c){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b,params:Ext.encode(g)},success:function(k){f(k.file,a,c)
},error:function(k){var l=getStringAjaxError(k);
Ext.Msg.longalert(lang.alertAjaxErrorHeader,l,function(){if(d){d(a)
}})
},failure2:function(){if(d){d(a)
}},maskEl:c,maskMsg:"Please wait ... download "+h,timeout:60*60*1000})
},applyGeoipCityFile:function(f,k,g,d,h,l){var b={dataName:"GeoIP data",checkNeedFillTask:"checkNeedFillGeoipCity",checkNeedFillFunction:function(m){return(m.emptyTable||m.newVersion||m.rowsInTable<m.rowsInFile-10)
},startFillTask:"startFillGeoipCity",stateFill:"stateFillGeoipCity",abortFillTask:"abortFillTableData",removeTmpFileTask:"removeGeoipCityTmpFile"};
var a={dataName:"GeoIPv6 data",checkNeedFillTask:"checkNeedFillGeoipCity",checkNeedFillTask_params:{v6:true},checkNeedFillFunction:function(m){return(m.emptyTable||m.newVersion||m.rowsInTable<m.rowsInFile-10)
},startFillTask:"startFillGeoipCity",startFillTask_params:{v6:true},stateFill:"stateFillGeoipCity",stateFill_params:{v6:true},abortFillTask:"abortFillTableData",removeTmpFileTask:"removeGeoipCityTmpFile"};
var c=[b,a];
this.applyDataFile(f,k,g,null,null,d,h,l,c)
},applyOSMtilesFile:function(c,h,f,a,d,g){var b={dataName:"OSM tiles",checkNeedFillTask:"checkNeedFillOSMtiles",checkNeedFillFunction:function(k){return(k.emptyTable||k.newVersion||k.rowsInTable<k.rowsInFile)
},startFillTask:"startFillOSMtiles",stateFill:"stateFillOSMtiles",abortFillTask:"abortFillTableData",removeTmpFileTask:"removeOSMtilesTmpFile"};
this.applyDataFile(c,h,f,null,null,a,d,g,b)
},applyDataFile:function(d,m,h,p,o,c,k,t,b){if(Ext.isArray(b)){var n=this;
var f=0;
var s=0;
var g=null;
a();
function a(){g=Ext.apply({},b[f],{disableRemoveTmpFile:true});
n.applyDataFile(d,function(){++f;
if(f==b.length){q()
}else{a()
}},function(){if(h){h(c)
}l()
},function(){++s;
if(s==b.length){Ext.Msg.alert("",g.dataName+" is actual")
}else{++f;
if(f==b.length){q()
}else{a()
}}},null,c,k,t,g)
}function q(){if(m){m(c)
}l()
}function l(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:g.removeTmpFileTask}})
}return
}var r=false;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b.checkNeedFillTask,params:Ext.encode(Ext.apply({file:d,quick:!t},b.checkNeedFillTask_params||{}))},success:function(u){if(u.error){Ext.Msg.alert("",u.error)
}else{if(!u.unsupported&&u.rowsInFile){if(t&&!b.checkNeedFillFunction(u)){if(p){p(c)
}else{Ext.Msg.alert("",b.dataName+" is actual")
}return
}var v=(new Date).getTime();
var w=new Tools.ProgressProcess({text:"updating "+b.dataName+" - please wait ...",fceCancel:function(){r=true;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b.abortFillTask,params:Ext.encode({timestampId:v})}});
if(!b.disableRemoveTmpFile){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b.removeTmpFileTask}})
}if(h||o){Ext.defer(function(){if(h){h(c)
}if(o){o(c)
}},100)
}},fcePercState:function(y){if(y>1){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b.stateFill,params:Ext.encode(b.stateFill_params||{})},success:function(z){if(z.count<u.rowsInFile-2&&w){w.setPercState(z.count/u.rowsInFile*100)
}}})
}},refreshInterval:2000});
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b.startFillTask,params:Ext.encode(Ext.apply({file:d,timestampId:v},b.startFillTask_params||{}))},success:function(){w.close();
w=null;
if(!r&&m){m(c)
}if(!b.disableRemoveTmpFile){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:b.removeTmpFileTask}})
}},error:function(y){w.close();
var z=getStringAjaxError(y);
Ext.Msg.longalert(lang.alertAjaxErrorHeader,z,function(){if(h){h(c)
}})
},failure2:function(){w.close();
if(h){h(c)
}},timeout:60*60*1000})
}}},maskEl:k,timeout:60*60*1000})
}});
Ext.define("Tools.ParseObjectToTreePanel",{extend:"Ext.tree.Panel",alias:"widget.ParseObjectToTreePanel",constructor:function(c){var a="ParseObjectToTree_model";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:[{name:"field",type:"string"},{name:"value",type:"string"}]})
}var b=Ext.create("Ext.data.TreeStore",{model:a,root:{expanded:true,children:objectToTreeStoreData(Ext.decode(c.data))}});
Ext.applyIf(c,{useArrows:true,rootVisible:false,store:b,columns:[{xtype:"treecolumn",dataIndex:"field",text:this.LfieldText,flex:2},{dataIndex:"value",text:this.LvalueText,flex:3}],viewConfig:{enableTextSelection:true,listeners:{scope:this,cellcontextmenu:d}}});
this.callParent([c]);
function d(o,p,m,l,q,n,g){g.stopEvent();
var k=null;
if(o&&m>=0&&o.ownerCt&&o.ownerCt.columns&&m<o.ownerCt.columns.length){k=o.ownerCt.columns[m]
}var f=[];
if(!l.data.leaf){f.push({text:l.data.expanded?this.LcollapseBranch:this.LexpandBranch,handler:function(){if(l.data.expanded){l.collapse(true)
}else{l.expand(true)
}},scope:this})
}if(isClipboardCopySupport()){f.push(new cClipboardMenuItem({text:l.data.leaf?this.LcopyItemInJsonToClipboard:this.LcopyBranchInJsonToClipboard,getClipText:function(v){var u=[];
u.push(l.data.field);
var s=l.parentNode;
while(s&&s.data.field){u.push(s.data.field);
s=s.parentNode
}var t=Ext.decode(this.data);
for(var r=u.length-1;
r>=0;
r--){t=t[u[r]]
}rsltData={};
rsltData[l.data.field]=t;
return(Ext.encode(rsltData))
},hideOnClick:false,scope:this}));
f.push(new cClipboardMenuItem({text:this.LcopyAllInJsonToClipboard,getClipText:function(r){return(this.data)
},hideOnClick:false,scope:this}));
if(k){f.push(new cClipboardMenuItem({text:lang.clipboard.CopyCellTo+(Ext.isChrome?"&nbsp;&nbsp;":""),getClipText:function(r){return(r.clipboardText)
},getClipTextParams:{clipboardText:l.data[k.dataIndex]},hideOnClick:false,scope:this}))
}}if(f.length){var h=new Ext.menu.Menu({items:f});
h.showAtMouse(g)
}}}});
Ext.override(Tools.ParseObjectToTreePanel,{LfieldText:"field",LvalueText:"value",LexpandBranch:"Expand branch",LcollapseBranch:"Collapse branch",LcopyItemInJsonToClipboard:"Copy item in JSON to clipboard",LcopyBranchInJsonToClipboard:"Copy branch in JSON to clipboard",LcopyAllInJsonToClipboard:"Copy all in JSON to clipboard"});
Ext.define("Tools.ParseXmlPdmlPanel",{extend:"Ext.tree.Panel",alias:"widget.ParseXmlPdmlPanel",constructor:function(c){var l="ParseXmlPdml_model";
if(!Ext.ClassManager.isCreated(l)){Ext.define(l,{extend:"Ext.data.Model",fields:[{name:"id",type:"string"},{name:"key",type:"string"},{name:"value",type:"string"}]})
}var o=Ext.create("Ext.data.TreeStore",{model:"ParseXmlPdml_model",proxy:{type:"ajax",url:"php/model/utilities.php",actionMethods:"POST",extraParams:{task:"loadTreeData",params:Ext.encode({data:c.data,dataId:c.dataId,pdml:c.pdml,keepTopLevel:c.keepTopLevel,onlyKeyColumn:c.onlyKeyColumn})},reader:{type:"json"}},root:{id:"root",expanded:true},listeners:{scope:this,load:function(p,q){if(this.onLoad){this.onLoad(q)
}if(this.autoExpandAll&&!this.autoExpandAllDone){this.autoExpandAllDone=true;
this.expandAll()
}if(this.autoExpandRtpBranch&&!this.autoExpandRtpBranchDone){this.autoExpandRtpBranchDone=true;
b.call(this)
}}}});
o.proxy.on("exception",onGridStoreException,o);
var d=[{xtype:"treecolumn",text:c.packetDetail?this.LfieldText:this.LkeyText,flex:c.flexKeyColumn||2,sortable:false,dataIndex:"key",renderer:c.proportionalFont||c.proportionalFontKeyColumn?n:undefined}];
if(!c.onlyKeyColumn){d.push({text:c.packetDetail?this.LvalueText:this.LkeyValue,flex:c.flexValueColumn||3,dataIndex:"value",sortable:true,renderer:c.proportionalFont||c.proportionalFontValueColumn?n:m})
}var f=[];
if(c.enableTbarButtonExpandAll){f.push({text:this.LexpandAll,handler:a,scope:this})
}if(c.enableTbarButtonExpandSipBranch){f.push({text:this.LexpandSipBranch,handler:k,scope:this})
}if(c.enableTbarButtonExpandRtpBranch){f.push({text:this.LexpandRtpBranch,handler:b,scope:this})
}Ext.applyIf(c,{iconCls:c.packetDetail||c.disableIcon?undefined:"icon_tree",store:o,rootVisible:false,columns:d,animate:false,useArrows:true,tbar:f.length?f:undefined,viewConfig:{enableTextSelection:true,listeners:{scope:this,cellcontextmenu:h}},listeners:{scope:this,afteritemexpand:function(){this.updateLayout()
},afteritemcollapse:function(){this.updateLayout()
},cellclick:function(p,w,r,q,t,v,u,s){g.call(this,q.data.key,q.data.value)
}}});
this.callParent([c]);
function m(u,p,r,v,t,s,q){p.style="cursor: text;";
return(u)
}function n(v,p,r,w,t,s,q){var u=q&&q.ownerCt&&q.ownerCt.getHeaderContainer?q.ownerCt.getHeaderContainer().getHeaderAtIndex(t):null;
p.style="cursor: text;";
return(v?('<span style="font:'+__font_Monospace+"; display: inline-block; "+(u&&u.dataIndex=="key"?"margin-top: 2px;":"")+'">'+v+"</span>"):v)
}function g(r,t){if(this.enableShowThumbnail&&r.match(/thumbnail/i)){var u="data:image/jpeg;base64,"+t;
var s=Math.min(850,Ext.dom.Element.getViewportWidth()-20);
var p=Ext.dom.Element.getViewportHeight()-50;
var q=new Ext.Window({closable:true,maximizable:true,resizable:true,layout:"fit",width:200,height:200,items:{xtype:"panel",html:'<img src="'+u+'">',autoScroll:true,border:false,style:{padding:4,"background-color":"white"}}});
q.show()
}}function h(w,y,u,t,z,v,q){q.stopEvent();
var s=null;
if(w&&u>=0&&w.ownerCt&&w.ownerCt.columns&&u<w.ownerCt.columns.length){s=w.ownerCt.columns[u]
}var p=[];
if(!t.data.leaf){p.push({text:t.data.expanded?this.LcollapseBranch:this.LexpandBranch,handler:function(){if(t.data.expanded){t.collapse(true)
}else{t.expand(true)
}}})
}if(s){p.push(new cClipboardMenuItem({text:lang.clipboard.CopyCellTo+(Ext.isChrome?"&nbsp;&nbsp;":""),getClipText:function(A){return(A.clipboardText)
},getClipTextParams:{clipboardText:t.data[s.dataIndex]},hideOnClick:false,scope:this}))
}if(p.length){var r=new Ext.menu.Menu({items:p});
r.showAtMouse(q)
}}function a(){this.expandAll()
}function k(){var t;
var r=this.items.get(0).store;
var p=r.getCount();
for(var s=0;
s<p;
s++){var q=r.getAt(s);
if(q.data.key.match("Session Initiation Protocol")){t=q;
break
}}if(t){t.expand(true)
}}function b(){var t;
var r=this.items.get(0).store;
var p=r.getCount();
for(var s=0;
s<p;
s++){var q=r.getAt(s);
if(q.data.key.match("Real-Time Transport Protocol")){t=q;
break
}}if(t){t.expand(true)
}}}});
Ext.override(Tools.ParseXmlPdmlPanel,{LkeyText:"Key",LkeyValue:"Value",LfieldText:"field",LvalueText:"value",LexpandAll:"Expand All",LexpandSipBranch:"Expand SIP branch",LexpandRtpBranch:"Expand RTP branch",LexpandBranch:"Expand branch",LcollapseBranch:"Collapse branch"});
function checkCallStats(d){if(window.maxCallsExceeded&&window.maxCallsPeek&&window.limitMaxCalls&&window.callStats){var c="Number of concurrent calls was exceeded.";
var b=user_is_admin()?"The average peak is "+maxCallsPeek+" calls and the limit for this license is "+limitMaxCalls+". Please contact the support.":"There is problem with the license. Please contact admin.";
var a=Ext.decode(callStats);
if(user_is_admin()&&a.length>=2){new Tools.CallStatsChart({header:c,text:b,onCloseWindow:function(){if(d&&d.length){window[d[0]](d.splice(1))
}}})
}else{Ext.Msg.alert(c,b,function(f){if(f=="ok"&&d&&d.length){window[d[0]](d.splice(1))
}})
}}else{if(d&&d.length){window[d[0]](d.splice(1))
}}}function showCallStats(){beginLoadMaskWithStopButton_ajax(mviewport,"showCallStats_loadMask","abortCalcCallStats");
var a=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCalcCallStats",params:Ext.encode({timestampId:mviewport._loadMask_timestampId})},success:function(b){new Tools.CallStatsChart({callStats:b.callStats,header:"Concurrent calls stats",text:"Number of concurrent calls",buttons:false});
endLoadMaskWithStopButton_ajax(mviewport)
},error2:function(){endLoadMaskWithStopButton_ajax(mviewport)
},failure:function(b){if(!a._aborted){alertAjaxFailure(b)
}endLoadMaskWithStopButton_ajax(mviewport)
},timeout:60*60*1000});
startLoadMaskWithStopButton_ajax(mviewport,a)
}Ext.define("Tools.CallStatsChart",{extend:"Ext.chart.CartesianChart",constructor:function(b){var m=new Ext.data.JsonStore({fields:[{name:"date",type:"date",dateFormat:__format_DateDb},{name:"type",type:"string"},{name:"max_peak",type:"integer"},{name:"max_avg_peak",type:"integer"},{name:"max_avg_sum",type:"integer"}],data:b.callStats||Ext.decode(callStats)});
if(b.autoCalcCallStats){if(!Ext.isNumber(b.autoCalcCallStats)){b.autoCalcCallStats=22
}var l=decDay(date(),b.autoCalcCallStats-1);
for(var c=0;
c<b.autoCalcCallStats;
c++){m.add({date:l,type:"",max_peak:0,max_avg_peak:0,max_avg_sum:0});
l=incDay(l,1)
}}b=Ext.applyIf(b||{},{store:m,axes:[{type:"numeric",position:"left",fields:["max_avg_peak"],minimum:0,grid:true,title:"#calls avg peak"},{type:"category",position:"bottom",fields:"date",grid:true,renderer:function(q,p,o,r){return(Ext.Date.format(p,"Y-m-d"))
},label:{rotate:{degrees:-60}},title:"day"}],series:[{type:"bar",axis:"left",xField:"date",yField:"max_avg_peak",label:{display:"insideEnd",field:"max_avg_peak",color:"#000",orientation:"horizontal","text-anchor":"middle",font:"bold italic 11px Tahoma, Arial, Helvetica, Sans-serif",renderer:function(o){return(o||"")
}},renderer:function(r,q,s,p){var o=s.store.getAt(p).data.max_avg_peak>limitMaxCalls?"#EA4446":"#78D162";
return({fillStyle:o,strokeStyle:o})
},title:"#calls avg peak"}],border:false,animation:false,theme:"CallStatsChart"});
if(b.header&&b.text){Ext.applyIf(b,{flex:1,background:{fill:__color_WindowFrame}})
}else{Ext.applyIf(b,{flex:1,background:{fill:"white"}})
}var h=null;
if(b.header){h=b.header;
delete b.header
}this.callParent([b]);
if(h&&b.text){var a=Math.min(700,Ext.dom.Element.getViewportWidth()*3/5);
var n=Math.min(480-(b.buttons===false?35:0),Ext.dom.Element.getViewportHeight()*3/5);
var k=[{text:"OK",handler:function(){f.close()
}}];
if(!window.isCloud){k.push({text:"try unblock",handler:d,scope:this},{text:"set new key",handler:g,scope:this})
}var f=new Ext.Window({title:h,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",html:b.text,border:false,style:{"background-color":__color_WindowFrame,padding:10,paddingBottom:20},bodyStyle:{"background-color":__color_WindowFrame}},this],border:false,width:a,height:n,modal:b.modal,buttons:b.buttons===false?undefined:k,wikiId:b.autoCalcCallStats?undefined:"Tools#Concurrent_calls_stats",listeners:{scope:this,activate:function(){this.onActivateWindow()
},close:function(){this.closeWindow();
if(this.onCloseWindow){this.onCloseWindow()
}}}});
f.show()
}function d(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"resetCallStats"},success:function(o){this.store.removeAll();
this.store.add(o.callStats);
this.refresh()
},maskEl:f})
}function g(){changeLicenseKey("change_license_key")
}},getSvg:function(){var a=this.getImage();
if(a&&a.data){return(decodeURIComponent(a.data).substr(24))
}},onActivateWindow:function(){if(this.windowIsActivated){return
}this.windowIsActivated=true;
if(this.autoCalcCallStats){this.calc()
}},calc:function(){if(this.closedWindow||this.calcStop||this.calcIndex>=this.store.getCount()){delete this.calcStop;
delete this.calcIndex;
delete this.calcCallStatsRequest;
if(this.progressBar){this.progressBar.close();
delete this.progressBar
}return
}if(!Ext.isDefined(this.calcIndex)){this.calcIndex=0
}if(!this.progressBar){this.progressBar=new Tools.ProgressProcess({text:"loading - please wait ...",fceCancel:function(){this.calcStop=true;
abortRequest(this.calcCallStatsRequest,this.calcCallStatsRequestTimestamp)
},fceCancelScope:this,fcePercState:function(){if(this.closedWindow){return
}this.progressBar.toFront()
},fcePercStateScope:this,modal:false})
}this.progressBar.setPercState(this.calcIndex/this.store.getCount()*100);
this.calcCallStatsRequestTimestamp=(new Date).getTime();
var a=this.store.getCount()-1-this.calcIndex;
this.calcCallStatsRequest=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCalcCallStats",params:Ext.encode({day:this.store.getAt(a).data.date,filter:this.cdrFilter,timestampId:this.calcCallStatsRequestTimestamp})},success:function(b){if(this.closedWindow){return
}this.store.getAt(a).data.max_avg_peak=Math.floor(b.max_avg_peak);
this.processData();
this.redraw();
++this.calcIndex;
this.calc()
},errorFailure:function(){}})
},closeWindow:function(){this.closedWindow=true;
if(this.progressBar){this.progressBar.close();
delete this.progressBar
}}});
Ext.define("Ext.chart.theme.CallStatsChart",{extend:"Ext.chart.theme.Base",alias:"chart.theme.CallStatsChart",constructor:function(a){a.axis={left:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},bottom:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fill:"black"}}};
this.callParent([a])
}});
Ext.define("Tools.ChunkPlayer",{constructor:function(a){a=Ext.applyIf(a||{},{mode:"file",analyser_mode:"osc",bytesPerSample:2,audioBufferChunkMaxLengthTime:10,audioBufferMaxLengthTime:20,audioBufferMinLengthTime:6,compressMode:"zip",waveScale:2,waveScaleMinFix:-5,waveScaleMin:-5,waveScaleMax:25,waitForBufferText:"wait for buffer",liveStreamEndText:"live stream end",countInfoItems:4,colorWave:"#00A7E3",colorRuler:"orange",enableSwitchBuffers:true});
Ext.apply(this,a);
if(this.mode=="file"){if(this.inputAudioFile){this.channels=this.inputAudioFile.channels;
this.sampleRate=this.inputAudioFile.sampleRate;
this.createPlayer()
}else{ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getAudioInfoForFile",params:Ext.encode({audioFile:okTimeSecSet(this.audioFile,300)})},success:function(b){if(a.onSuccessGetAudioInfoForFile){a.onSuccessGetAudioInfoForFile()
}if(b.channels*1&&b.sample_rate*1){this.channels=b.channels*1;
this.sampleRate=b.sample_rate*1;
this.createPlayer()
}else{Ext.Msg.alert("","get audio information failed")
}}})
}}else{this.channels=1,this.sampleRate=8000;
this.createPlayer()
}},createPlayer:function(){this.audioBufferSampleRate=Ext.isSafari&&this.sampleRate<24000?24000:this.sampleRate;
this.audioBufferMaxLengthSamples=this.audioBufferMaxLengthTime*this.sampleRate;
this.audioBufferMinLengthSamples=this.audioBufferMinLengthTime*this.sampleRate;
var k=[];
for(var q=0;
q<this.countInfoItems;
q++){k.push({xtype:"displayfield",name:"ii_"+(q+1),width:__width_FormChar(30,30),labelWidth:__width_FieldChar(30),value:"",fieldLabel:"-"})
}var t=15;
var m=this.heightWave||120;
var p=this.heightSpectrogram||64;
this._heightWaveRuler=t;
this._heightWave=m;
this._heightSpectrogram=p;
var a=65;
var g=60;
var c=150;
var o=[];
var s=[];
var f=0;
var b={"border-bottom":"1px","border-style":"dotted","border-top":"0px","border-left":"0px","border-right":"0px","border-color":this.colorWave};
s.push({xtype:"container",height:t+1,listeners:{scope:this,afterrender:function(v){this.audioWaveRuler=v
}},style:b});
f+=t+1;
this.audioSpectrogram=[];
this.audioWaveCanvas=[];
function d(v){s.push({xtype:"container",items:{xtype:"box",autoEl:{tag:"img",cls:"unselectable",src:"data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs="},height:p,listeners:{scope:this,afterrender:function(w){this.audioSpectrogram[w.channel-1]=w
}},style:{display:"none"},channel:v+1},height:p+1,style:b,hidden:this.hiddenSpectrogram});
if(!this.hiddenSpectrogram){f+=p+1
}}function h(v){s.push({xtype:"box",autoEl:{tag:"canvas"},height:m+1,listeners:{scope:this,afterrender:function(w){this.audioWaveCanvas[w.channel-1]=w
}},style:b,channel:v+1,hidden:this.hiddenWave});
if(!this.hiddenWave){f+=m+1
}}for(var n=0;
n<this.channels;
n++){if(!this.disableSpectrogram&&this.mode=="file"&&n==0){d.call(this,n)
}if(!this.disableWave){h.call(this,n)
}if(this.mode=="file"&&this.channels>1&&n==this.channels-1){d.call(this,n)
}}o.push({xtype:"container",items:{xtype:"container",layout:"absolute",items:[{xtype:"container",layout:{type:"vbox"},items:s,height:f,listeners:{scope:this,afterrender:function(v){this.audioWaveSubSubContainer=v
}}},{xtype:"panel",width:this.timeIndicationWidth||1,height:f,x:0,y:0,border:false,bodyStyle:{"background-color":this.timeIndicationColor||"orange"},listeners:{scope:this,afterrender:function(v){this.audioWavePositionPanel=v
}}}],height:f,listeners:{scope:this,afterrender:function(v){this.audioWaveSubContainer=v;
v.getEl().on("mousedown",function(w){this.wavePosMouseDownX=w.browserEvent.clientX;
this.wavePosMouseDownScroll=this.audioWaveContainer.getEl().dom.scrollLeft
},this);
v.getEl().on("mouseup",function(w){if(Math.abs(this.wavePosMouseDownX-w.browserEvent.clientX)<3){var y=w.browserEvent.clientX-this.audioWaveSubContainer.getEl().getX();
this.seekByWavePosition(y)
}if(this.wavePosMouseDownX){delete this.wavePosMouseDownX
}this.audioWaveSubContainer.getEl().setStyle("cursor","default")
},this);
v.getEl().on("mousemove",function(w){if(this.wavePosMouseDownX&&Math.abs(this.wavePosMouseDownX-w.browserEvent.clientX)>3){this.suspendAutoScrollWaveUntil=(new Date).getTime()+5000;
this.audioWaveContainer.getEl().dom.scrollLeft=this.wavePosMouseDownScroll-(w.browserEvent.clientX-this.wavePosMouseDownX);
this.audioWaveSubContainer.getEl().setStyle("cursor","move")
}},this)
}},hidden:this.mode=="file"},style:{"background-color":"black"},listeners:{scope:this,afterrender:function(v){this.audioWaveContainer=v;
if(!this.disableZoom){v.getEl().on("scroll",function(w){this.onScrollWave()
},this);
v.getEl().on("mousewheel",function(w){if(w.browserEvent.wheelDeltaY>0){if(this.waveScale>this.waveScaleMin){this.waveZoom(-1)
}}else{if(w.browserEvent.wheelDeltaY<0){if(this.waveScale<this.waveScaleMax){this.waveZoom(1)
}}}},this);
v.getEl().on("mousedown",function(w){var y=w.browserEvent.clientY-this.audioWaveContainer.getEl().getY();
if(y>=f){this.waveScrollerMousing=true;
this.suspendAutoScrollWaveUntil=(new Date).getTime()+5000
}},this);
v.getEl().on("mouseup",function(w){if(this.waveScrollerMousing){delete this.waveScrollerMousing
}},this)
}}},height:f+(this.disableZoom?0:__height_Scroller),overflowX:this.disableZoom?"hidden":"scroll",overflowY:"hidden"});
if(this.enableAnalyser){o.push({xtype:"container",layout:"fit",items:{xtype:"box",layout:"fit",autoEl:{tag:"canvas"},listeners:{scope:this,afterrender:function(v){this.audioVisualizerCanvas=v
}}},flex:1})
}if(!this.disableSlider){o.push({xtype:"slider",height:20,hideLabel:true,useTips:false,minValue:0,maxValue:999,animate:false,_id:"slider",listeners:{scope:this,change:this.onSliderChange,dragstart:this.onSliderDragStart,dragend:this.onSliderDragEnd},style:{marginTop:0,marginBottom:0,"background-color":__color_WindowFrame}})
}if(this.compactPlayer){var r=[];
r.push({text:"<b>"+lang.play_player+"</b>",iconCls:"icon_rec_play",enableToggle:true,_id:"play"},{text:"<b>"+lang.pause_player+"</b>",iconCls:"icon_rec_pause",enableToggle:true,_id:"pause"},{text:"<b>"+lang.stop_player+"</b>",iconCls:"icon_rec_stop",enableToggle:true,_id:"stop"});
if(!this.disableZoom){r.push({iconCls:"icon_magnifier_zoom_in",_id:"zoom_in",width:24,style:{"margin-left":"10px","margin-right":"2px"},disabled:this.waveScale>this.waveScaleMin},{iconCls:"icon_magnifier_zoom_out",width:24,_id:"zoom_out",disabled:this.waveScale<this.waveScaleMax})
}var u=[];
if(this.prevButtons&&this.prevButtons.length){u=u.concat(this.prevButtons)
}u.push({xtype:"container",layout:{type:"hbox",pack:"center"},items:{xtype:"displayfield",border:false,width:g+20,value:"00:00:00",fieldStyle:{"font-weight":"bold","text-align":"right",height:14,"min-height":14},listeners:{scope:this,afterrender:function(v){this.playTimeField=v
}}}},{xtype:"container",width:50},{xtype:"container",layout:{type:"hbox"},defaults:{xtype:"button",width:a,style:{"margin-right":"2px"},handler:this.buttonsHandler,scope:this},items:r});
if(this.nextButtons&&this.nextButtons.length){u=u.concat(this.nextButtons)
}o.push({xtype:"panel",layout:{type:"hbox",pack:"center"},items:u,border:false,style:{marginTop:2,marginBottom:2},bodyStyle:{"background-color":__color_WindowFrame}})
}else{o.push({xtype:"container",layout:{type:"hbox",pack:"center"},items:{xtype:"displayfield",border:false,width:g,value:"00:00:00",fieldStyle:{"font-weight":"bold","text-align":"right",height:14,"min-height":14},listeners:{scope:this,afterrender:function(v){this.playTimeField=v
}}}});
var r=[];
if(this.prevButtons&&this.prevButtons.length){r=r.concat(this.prevButtons)
}r.push({text:"<b>"+lang.backward_player+"</b>",_id:"backward"},{text:"<b>"+lang.play_player+"</b>",iconCls:"icon_rec_play",enableToggle:true,_id:"play"},{text:"<b>"+lang.pause_player+"</b>",iconCls:"icon_rec_pause",enableToggle:true,_id:"pause"},{text:"<b>"+lang.stop_player+"</b>",iconCls:"icon_rec_stop",enableToggle:true,_id:"stop"},{text:"<b>"+lang.forward_player+"</b>",_id:"forward"});
if(!this.disableZoom){r.push({iconCls:"icon_magnifier_zoom_in",_id:"zoom_in",width:24,style:{"margin-left":"20px","margin-right":"2px"},disabled:this.waveScale>this.waveScaleMin},{iconCls:"icon_magnifier_zoom_out",width:24,_id:"zoom_out",disabled:this.waveScale<this.waveScaleMax})
}if(this.nextButtons&&this.nextButtons.length){r=r.concat(this.nextButtons)
}if(this.mode=="file"&&!this.disableDownloadAudio){r.push({iconCls:"icon_save",width:34,_id:"download_audio",menu:{defaults:{handler:this.buttonsHandler,scope:this},items:[{text:"WAV",_id:"download_audio_wav"},{text:"OGG",_id:"download_audio_ogg"}]},style:{"margin-left":"20px"}})
}o.push({xtype:"container",layout:{type:"hbox",pack:"center"},defaults:{xtype:"button",width:a,style:{"margin-right":"2px"},handler:this.buttonsHandler,scope:this},items:r,style:{"margin-top":"5px"}});
o.push({xtype:"container",layout:{type:"hbox",pack:"center"},items:{xtype:"displayfield",border:false,width:c,value:this.waitForBufferText,fieldStyle:{color:"red","font-weight":"bold","text-align":"center",height:14,"min-height":14},listeners:{scope:this,afterrender:function(v){this.infoField=v
}}}})
}if(this.configPanel){o.push(this.configPanel)
}if(this.debug){o.push({xtype:"container",items:k,style:{padding:2},height:__height_Form(this.countInfoItems)+10})
}if(this.playerContainer){this.playerContainer.add({xtype:"panel",layout:{type:"vbox",align:"stretch"},items:o,border:false,bodyStyle:{"background-color":__color_WindowFrame}})
}else{var l={width:Ext.dom.Element.getViewportWidth()-40,border:false,modal:!this.modelessWindow,layout:{type:"vbox",align:"stretch"},items:o,listeners:{scope:this,afterrender:function(){new Ext.KeyMap(this.playerWindow.getEl(),{key:" ".charCodeAt(0),fn:function(){if(this.state=="play"){this.pause()
}else{if(this.state=="pause"){this.unpause()
}}},scope:this})
},afterlayout:function(w){if(w.getHeight()>Ext.dom.Element.getViewportHeight()){var v=w.getHeight()-Ext.dom.Element.getViewportHeight();
if(this.configPanel&&this.configPanel.getHeight()>60){this.configPanel.setHeight(Math.max(this.configPanel.getHeight()-v,60))
}}},beforeclose:function(){if(this.evBeforeCloseWindow){this.evBeforeCloseWindow()
}},close:function(){if(this.evCloseWindow){this.evCloseWindow()
}this.onClose()
}},bodyStyle:{"background-color":__color_WindowFrame}};
this.playerWindow=new Ext.Window(l);
this.playerContainer=this.playerWindow;
this.playerWindow.show()
}this.configTimer={run:this.onTimer,interval:100,scope:this};
this.audioContext=window.AudioContext?new AudioContext():new webkitAudioContext();
if(this.enableAnalyser){this.audioAnalyser=this.audioContext.createAnalyser();
this.audioAnalyser.fftSize=this.analyser_mode=="line"?256:2048
}this.audioBuffers=[];
for(var q=0;
q<(this.enableSwitchBuffers?2:1);
q++){this.audioBuffers[q]=this.audioContext.createBuffer(this.channels,this.audioBufferMaxLengthSamples*(this.audioBufferSampleRate/this.sampleRate),this.audioBufferSampleRate)
}this.audioBuffersIndexActive=0;
if(this.compressMode=="ogg"){this.audioContextConvert=window.OfflineAudioContext?new OfflineAudioContext(this.channels,this.audioBufferChunkMaxLengthTime,this.sampleRate):new webkitOfflineAudioContext(this.channels,this.audioBufferChunkMaxLengthTime,this.sampleRate)
}this.activeChunks={};
this.startTime=0;
this.audioRequest=new XMLHttpRequest();
this.audioRequest.addEventListener("load",function(){this.onAudioLoad()
}.bind(this),false);
this.audioRequest.addEventListener("error",function(){this.onErrorLoad()
}.bind(this),false);
if(this.enableAnalyser){this.audioVisualizerInit()
}this.firstPlay=true;
this.state="";
window.chp=this;
if(this.mode=="file"){this.prepareRawAudioFile()
}else{this.start()
}},getHeightWaveSpectrogram:function(){var a=this._heightWaveRuler+1;
for(var b=0;
b<this.channels;
b++){if(!this.disableWave&&!this.hiddenWave){a+=this._heightWave+1
}if(!this.disableSpectrogram&&!this.hiddenSpectrogram){a+=this._heightSpectrogram+1
}}return(a)
},switchHidden:function(d,c){var a=false;
if(!this.disableWave){if(d!=this.hiddenWave){for(var b=0;
b<this.channels;
b++){this.audioWaveCanvas[b].showIf(!d)
}this.hiddenWave=d;
a=true
}}if(!this.disableSpectrogram){if(c!=this.hiddenSpectrogram){for(var b=0;
b<this.channels;
b++){this.audioSpectrogram[b].showIf(!c);
this.audioSpectrogram[b].ownerCt.showIf(!c)
}this.hiddenSpectrogram=c
}}if(a&&!d){this.drawWave()
}this.audioWaveSubContainer.ownerCt.setHeight(this.getHeightWaveSpectrogram()+(this.disableZoom?0:__height_Scroller));
this.audioWaveSubContainer.setHeight(this.getHeightWaveSpectrogram());
this.audioWaveSubSubContainer.setHeight(this.getHeightWaveSpectrogram());
this.audioWavePositionPanel.setHeight(this.getHeightWaveSpectrogram())
},prepareRawAudioFile:function(a){if(a){this.stop();
if(this.audioRequestState=="run"){this.audioRequest.abort();
this.audioRequestState=null
}for(var b in this.activeChunks){this.destroyChunk(this.activeChunks[b])
}this.activeChunks={};
this.audioBuffersIndexActive=0;
this.startTime=0;
this.gotoTimeSet=0;
this.audioBufferCountSamplesPrepared=0;
this.needFirstSample=0;
this.audioFile=a;
if(a=="none"){if(this.infoField){this.infoField.setValue("&nbsp;")
}this.clearWave();
this.clearSpectrogram();
this.setWavePosition(0);
this.slider.setValue(0);
this.playTimeField.setValue("---");
this.state="none";
this.setButtonsState();
return
}if(this.infoField){this.infoField.setValue(this.waitForBufferText)
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getAudioInfoForFile",params:Ext.encode({audioFile:okTimeSecSet(this.audioFile,300)})},success:function(c){if(!this.playerContainer.getEl()){return
}if(c.channels*1&&c.sample_rate*1){this.channels=c.channels*1;
this.sampleRate=c.sample_rate*1;
this.prepareRawAudioFile()
}else{Ext.Msg.alert("","get audio information failed");
this.prepareRawAudioFile("none")
}}});
return
}if(this.inputAudioFile){this.onSuccessPrepareRawAudioFile(this.inputAudioFile.audioInfo)
}else{ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"prepareAudioFileForChunkPlayer",params:Ext.encode({sample_rate:this.sampleRate,channels:this.channels,audioFile:okTimeSecSet(this.audioFile,300),client_panel_id:this.getClientPanelId()})},success:function(c){if(!this.playerContainer.getEl()){return
}this.onSuccessPrepareRawAudioFile(c)
},maskEl:this.playerContainer})
}},onSuccessPrepareRawAudioFile:function(a){this.audioInfo=a;
while(this.getWidthWave(this.waveScaleMin)>30000){do{++this.waveScaleMin
}while(!this.waveScaleMin)
}for(this.waveScale=this.waveScaleMin;
this.waveScale<=this.waveScaleMax;
this.waveScale++){if(this.waveScale&&this.getWidthWave()<this.playerContainer.getWidth()){break
}}if(this.audioWaveSubContainer){this.audioWaveSubContainer.show()
}this.drawWave();
this.start();
this.setButtonsState();
if(this.mode!="live"&&!this.disableSpectrogram){this.getSpectrogram()
}},getAudioInfo:function(){return({channels:this.channels,sampleRate:this.sampleRate,audioInfo:this.audioInfo})
},getSpectrogram:function(){if(!this.audioWaveSubContainer){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getAudioDataSpectrogram",params:Ext.encode({audio_info:this.audioInfo,client_panel_id:this.getClientPanelId()})},success:function(a){if(!this.playerContainer.getEl()){return
}if(a.spectrograms){this.audioInfo.spectrograms=a.spectrograms;
this.drawSpectrogram()
}}})
},start:function(){if(this.evGotoTime){this.evGotoTime(0)
}this.state="play";
this.audioLoad();
if(this.disableAutoPlay){delete this.state;
if(this.infoField){this.infoField.setValue("&nbsp;")
}}Ext.TaskManager.start(this.configTimer)
},onClose:function(){this.stop();
Ext.TaskManager.stop(this.configTimer);
if(this.audioSource){try{this.audioSource.stop(0)
}catch(c){}this.audioSource.disconnect()
}if(this.audioContext){if(this.audioContext.close){this.audioContext.close()
}delete this.audioContext
}if(this.audioContextConvert){delete this.audioContextConvert
}var a=null;
if(this.mode=="file"){if(!this.disableUnlinkAudioFile){a="php/model/utilities.php?task=removeAudioFileForChunkPlayer&params="+encodeURIComponent(Ext.encode({client_panel_id:this.getClientPanelId()}))
}}else{if(this.urlClose){a=this.urlClose
}}if(a){ajaxSafeRequest({scope:this,url:a,success:function(){},error:function(){},failure:function(){}})
}for(var b in this.activeChunks){this.destroyChunk(this.activeChunks[b])
}},audioLoad:function(b){if(this.mode=="file"&&(b>=this.audioInfo.samples||this.state!="play")){return
}this.audioRequestState="run";
this.audioRequestTime=(new Date).getTime();
var a=null;
if(this.mode=="file"){a="php/model/utilities.php?task=getAudioDataChunk&params="+encodeURIComponent(Ext.encode({client_panel_id:this.getClientPanelId(),start:(b||0)*this.channels*this.bytesPerSample,length:4*this.sampleRate*this.channels*this.bytesPerSample,compress_mode:this.compressMode,sample_rate:this.sampleRate,channels:this.channels}))
}else{a=this.url+"&compress_mode="+this.compressMode
}if(a){this.audioRequest.open("POST",a,true);
this.audioRequest.responseType="arraybuffer";
this.audioRequest.send()
}},onAudioLoad:function(){if(!this.playerContainer.getEl()||this.audioRequestState!="run"){return
}this.audioRequestState="ok";
if(!this.audioContext){return
}var f=Ext.isDefined(this.needFirstSample)?this.needFirstSample:this.getLastSampleInActiveChunks()+1;
if(Ext.isDefined(this.needFirstSample)){delete this.needFirstSample
}var d=new Uint8Array(this.audioRequest.response);
while(d.length&&d[0]==10){d=d.slice(1)
}var a=null;
var b=null;
if(d.length<100){if(d[0]==101&&d[1]==114){a=String.fromCharCode.apply(null,d);
if(a.substr(0,7)!=="error: "){a=null
}}else{if(d[0]==105&&d[1]==110){b=String.fromCharCode.apply(null,d);
if(b.substr(0,13)!=="information: "){b=null
}}}}if(!a&&!b){if(this.audioRequest.response.byteLength>10){switch(this.compressMode){case"ogg":var c=this;
this.audioContextConvert.decodeAudioData(this.audioRequest.response,function(h){var g=[];
for(var k=0;
k<c.channels;
k++){g[k]=new Float32Array(h.getChannelData(k))
}c.processLoadChannels(f,g)
});
break;
case"zip":d=pako.inflate(d).buffer;
this.processLoadData(f,d);
break
}}else{a="end stream"
}}if(this.mode=="live"&&a){debug_log("live stream end: "+a);
this.liveStreamEnd=true;
if(this.infoField){this.infoField.setValue(this.liveStreamEndText)
}}},processLoadData:function(b,a){this.activeChunks[b]={firstSample:b,lastSample:b+parseInt(a.byteLength/(this.bytesPerSample*this.channels))-1,data:a};
if(this.mode=="live"){this.calculatePeaksInChunks(this.activeChunks[b])
}this.afterProcessLoadDataOrChannels()
},processLoadChannels:function(b,a){this.activeChunks[b]={firstSample:b,lastSample:b+a[0].length-1,channels:a};
if(this.mode=="live"){this.calculatePeaksInChunks(this.activeChunks[b])
}this.afterProcessLoadDataOrChannels()
},afterProcessLoadDataOrChannels:function(){if(this.mode=="live"){this.setAudioInfo();
this.drawWave()
}this.audioSetBuffer();
if(this.state=="play"){if(this.okAudioBufferForPlay()){this.audioPlay();
if(this.infoField){this.infoField.setValue("&nbsp;")
}}else{if(this.infoField){this.infoField.setValue(this.waitForBufferText)
}}}},onErrorLoad:function(){this.audioRequestState="error"
},audioPlay:function(){if(!this.audioContext||this.state!="play"){return
}var c=this.audioSource;
this.audioSource=this.audioContext.createBufferSource();
this.audioSource.buffer=this.audioBuffers[this.enableSwitchBuffers?(this.audioBuffersIndexActive?0:1):0];
this.audioSource.connect(this.audioContext.destination);
if(this.audioAnalyser){this.audioSource.connect(this.audioAnalyser)
}var b=this.getPlayTime();
var a=b-this.audioBufferFirstSamplePrepared/this.sampleRate;
try{c.stop(0)
}catch(d){}this.audioSource.start(0,a);
this.audioBuffersIndexActive=this.enableSwitchBuffers?(this.audioBuffersIndexActive?0:1):0;
if(this.enableSwitchBuffers){debug_log("active buffer index: "+this.audioBuffersIndexActive)
}this.showInfoValue(3,"set new play time in buffer",formatNumber(a,2));
this.audioContext.startPlayTime=this.audioContext.currentTime;
this.audioContext.offsetPlayTime=a;
this.audioBufferCountSamplesActive=this.audioBufferCountSamplesPrepared;
this.audioBufferFirstSampleActive=this.audioBufferFirstSamplePrepared;
if(this.firstPlay){if(this.audioAnalyser){this.refreshVisualizer()
}this.firstPlay=false
}this.audioSource.playbackRate.value=1;
if(Ext.isDefined(this.gotoTimeSet)){delete this.gotoTimeSet
}},stopPlay:function(){try{this.audioSource.stop(0)
}catch(a){}if(this.prevPlayTime){delete this.prevPlayTime
}},gotoTime:function(a){debug_log("goto time: "+a);
this.stopPlay();
this.gotoTimeSet=a;
if(this.getIndexOfActiveChunkForTime(a)<0){if(this.audioRequestState=="run"){this.audioRequest.abort()
}this.needFirstSample=parseInt(a*this.sampleRate);
this.audioLoad(parseInt(a*this.sampleRate))
}else{this.audioSetBuffer();
if(this.okAudioBufferForPlay()){this.audioPlay()
}}if(this.evGotoTime){this.evGotoTime(a)
}},audioSetBuffer:function(){var o=this.getIndexOfActiveChunkForTime(this.getPlayTime());
if(o<0){this.needFirstSample=parseInt(this.getPlaySample());
return
}this.showInfoValue(2,"first active chunk / sample",o);
var m=[];
for(var a=0;
a<this.channels;
a++){var b=this.enableSwitchBuffers?(this.audioBuffersIndexActive?0:1):0;
m[a]=this.audioBuffers[b].getChannelData(a)
}var p=0;
var c=0;
var f=0;
var q=this.audioBufferSampleRate/this.sampleRate;
var l=o;
while(l>=0){var h=0;
if(this.activeChunks[l].data){var g=this.bytesPerSample==2?new Int16Array(this.activeChunks[l].data):new Int8Array(this.activeChunks[l].data);
if(p&&f>=this.activeChunks[l].firstSample){h=(f-this.activeChunks[l].firstSample+1)*this.channels
}for(;
h<g.length-this.channels;
h+=this.channels){for(var a=0;
a<this.channels;
a++){for(var d=0;
d<q;
d++){m[a][p*q+d]=g[h+a]/(65535/2)
}}++p
}}else{var n=this.activeChunks[l].channels;
if(p&&f>=this.activeChunks[l].firstSample){h=(f-this.activeChunks[l].firstSample+1)
}for(;
h<n[0].length-this.channels;
h++){for(var a=0;
a<this.channels;
a++){for(var d=0;
d<q;
d++){m[a][p*q+d]=n[a][h]
}}++p
}}f=this.activeChunks[l].lastSample;
++c;
i_next=this.getIndexOfActiveChunkForSample(this.activeChunks[l].lastSample+1);
if(i_next<0&&this.mode=="file"&&this.activeChunks[l].lastSample<this.audioInfo.samples-1){this.needFirstSample=this.activeChunks[l].lastSample+1;
break
}if(i_next>=0&&(p+(this.activeChunks[i_next].data?this.activeChunks[i_next].data.byteLength/(this.bytesPerSample*this.channels):this.activeChunks[i_next].channels[0].length))>this.audioBufferMaxLengthSamples){break
}l=i_next
}this.audioBufferCountSamplesPrepared=p;
this.audioBufferFirstSamplePrepared=this.activeChunks[o].firstSample;
this.showInfoValue(4,"buffer length",p+" / "+formatNumber(p/this.sampleRate,2))
},okAudioBufferForPlay:function(){return(this.audioBufferCountSamplesPrepared>=this.audioBufferMinLengthSamples||(this.mode=="live"&&(this.liveStreamEnd||this.state=="play"&&this.getPlayTime()>this.audioBufferMinLengthTime&&this.audioBufferCountSamplesPrepared>=this.sampleRate/2))||(this.mode=="file"&&(this.audioInfo.time-this.getPlayTime()<this.audioBufferMinLengthTime-0.5||this.audioBufferCountSamplesPrepared>=this.audioInfo.samples-100)))
},getLastSampleInActiveChunks:function(){var a=-1;
for(var b in this.activeChunks){a=this.activeChunks[b].lastSample
}return(a)
},getIndexOfActiveChunkForTime:function(a){return(this.getIndexOfActiveChunkForSample(parseInt(a*this.sampleRate)))
},getIndexOfActiveChunkForSample:function(b){for(var a in this.activeChunks){if(b>=this.activeChunks[a].firstSample&&b<=this.activeChunks[a].lastSample){return(a)
}}return(-1)
},calculatePeaksInChunks:function(c){var b=20;
var h=parseInt(this.sampleRate*b/1000);
c.peaks=[];
if(c.channels){var g=0;
for(var d=0;
d<c.channels.length;
d++){c.peaks.push([]);
for(i=0;
i<c.channels[d].length;
i++){if(!(i%h)){if(i){c.peaks[d].push(g*(this.bytesPerSample?65535:256)/2)
}g=0
}var a=c.channels[d][i];
if(a<0){a=-a
}if(a>g){g=a
}}}}else{if(c.data){var g=[];
var f=this.bytesPerSample==1?new Int8Array(c.data):new Int16Array(c.data);
for(var d=0;
d<this.channels;
d++){c.peaks.push([]);
g.push(0)
}for(i=0;
i<f.length;
i+=this.channels){if(!(i%h)){if(i){for(var d=0;
d<this.channels;
d++){c.peaks[d].push(g[d]);
g[d]=0
}}for(var d=0;
d<this.channels;
d++){var a=f[i+d]*1.5;
if(a<0){a=-a
}if(a>g[d]){g[d]=a
}}}}}}},setAudioInfo:function(){var b=0;
var a=[];
for(var d=0;
d<this.channels;
d++){a.push([])
}for(var c in this.activeChunks){b+=this.activeChunks[c].lastSample-this.activeChunks[c].firstSample+1;
for(var d=0;
d<this.channels;
d++){a[d]=a[d].concat(this.activeChunks[c].peaks[d])
}}this.audioInfo={samples:b,time:b/this.sampleRate,peaks:a}
},getPlayTime:function(){if(Ext.isDefined(this.gotoTimeSet)){return(this.gotoTimeSet)
}if(this.state=="pause"&&Ext.isDefined(this.pausePlayTime)){return(this.pausePlayTime)
}if(!this.audioContext.startPlayTime||!this.audioBufferCountSamplesActive){return(0)
}return(Math.min(this.audioContext.currentTime-this.audioContext.startPlayTime+this.audioContext.offsetPlayTime,this.audioBufferCountSamplesActive/this.sampleRate)+this.audioBufferFirstSampleActive/this.sampleRate)
},getPlaySample:function(){return(this.getPlayTime()*this.sampleRate)
},isShortAudioBuffer:function(){return(this.audioBufferCountSamplesActive-(this.getPlaySample()-this.audioBufferFirstSampleActive)<=this.audioBufferMinLengthSamples)
},audioVisualizerInit:function(){var b=this.audioVisualizerCanvas.ownerCt.getWidth();
var a=this.audioVisualizerCanvas.ownerCt.getHeight();
this.audioVisualizerCanvas.getEl().dom.width=b*1;
this.audioVisualizerCanvas.getEl().dom.height=a*1;
this.audioVisualizerCtx=this.audioVisualizerCanvas.getEl().dom.getContext("2d");
this.audioVisualizerGradient=this.audioVisualizerCtx.createLinearGradient(0,0,0,a);
this.audioVisualizerGradient.addColorStop(1,"green");
this.audioVisualizerGradient.addColorStop(0.75,"green");
this.audioVisualizerGradient.addColorStop(0.25,"green");
this.audioVisualizerGradient.addColorStop(0,"red")
},audioVisualizerDraw:function(b){if(!this.audioVisualizerCanvas||!this.audioVisualizerCanvas.getEl()){return
}var a=this.audioVisualizerCanvas.getEl().dom.width;
var l=this.audioVisualizerCanvas.getEl().dom.height;
this.audioVisualizerCtx.clearRect(0,0,a,l);
if(this.analyser_mode=="line"){var m=parseInt((a/this.audioAnalyser.frequencyBinCount)*2.5);
var k;
var f=0;
for(var c=0;
c<this.audioAnalyser.frequencyBinCount;
c++){k=b[c];
this.audioVisualizerCtx.fillStyle="rgb("+(k+100)+",50,50)";
this.audioVisualizerCtx.fillRect(f,l-k/2,m,k/2);
f+=m+1
}}else{this.audioVisualizerCtx.lineWidth=2;
this.audioVisualizerCtx.strokeStyle="rgb(0,167,227)";
this.audioVisualizerCtx.beginPath();
var g=a*1/this.audioAnalyser.frequencyBinCount;
var f=0;
for(var c=0;
c<this.audioAnalyser.frequencyBinCount;
c++){var h=b[c]/128;
var d=h*l/2;
if(c===0){this.audioVisualizerCtx.moveTo(f,d)
}else{this.audioVisualizerCtx.lineTo(f,d)
}f+=g
}this.audioVisualizerCtx.lineTo(a,l/2);
this.audioVisualizerCtx.stroke()
}},audioVisualizationData:function(){var a=new Uint8Array(this.audioAnalyser.frequencyBinCount);
if(this.analyser_mode=="line"){this.audioAnalyser.getByteFrequencyData(a)
}else{this.audioAnalyser.getByteTimeDomainData(a)
}return a
},refreshVisualizer:function(){this.audioVisualizerDraw(this.audioVisualizationData());
if(this.getEl()){requestAnimationFrame(this.refreshVisualizer.bind(this))
}},drawSpectrogram:function(){if(!this.audioWaveSubContainer){return
}for(var a=0;
a<this.channels;
a++){if(this.audioSpectrogram[a]){this.audioSpectrogram[a].getEl().dom.setAttribute("src","data:image/jpg;base64,"+this.audioInfo.spectrograms[a]);
this.audioSpectrogram[a].getEl().setStyle("display","inline")
}}},clearSpectrogram:function(){for(var a=0;
a<this.channels;
a++){this.audioSpectrogram[a].getEl().dom.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=")
}},drawWave:function(c){if(!this.audioWaveSubContainer){return
}var b=this.getWidthWave();
this.audioWaveSubContainer.setWidth(b);
this.audioWaveSubSubContainer.setWidth(b);
this.audioWaveSubSubContainer.getEl().setWidth(b);
if(this.audioWaveRuler){this.audioWaveRuler.setWidth(b)
}for(var a=0;
a<this.channels;
a++){if(this.mode=="file"&&!this.disableSpectrogram){this.audioSpectrogram[a].setWidth(b)
}}if(!this.disableWave){this._drawWave(c,b)
}if(c){this.clearWaveRuler()
}else{this.setWaveRuler()
}},_drawWave:function(g,b){var c=this.convPeakWave(65535/2);
this.audioWaveCtx=[];
for(var a=0;
a<this.channels;
a++){var p=this.audioWaveCanvas[a].getHeight();
this.audioWaveCanvas[a].ownerCt.setWidth(b);
this.audioWaveCanvas[a].setWidth(b);
this.audioWaveCanvas[a].getEl().dom.width=b;
this.audioWaveCanvas[a].getEl().dom.height=p;
this.audioWaveCtx[a]=this.audioWaveCanvas[a].getEl().dom.getContext("2d");
this.audioWaveCtx[a].clearRect(0,0,b,p);
if(g){continue
}var m=p;
var l=parseInt(m/2);
var d=c/l*1.01;
this.audioWaveCtx[a].fillStyle=this.colorWave;
for(var o=0;
o<2;
o++){this.audioWaveCtx[a].beginPath();
this.audioWaveCtx[a].moveTo(0,l);
this.audioWaveCtx[a].lineTo(1,l);
var n=0;
for(var k=0;
k<this.audioInfo.peaks[a].length;
k+=(this.waveScale>1?this.waveScale:1)){var f=this.convPeakWave(this.audioInfo.peaks[a][k]);
if(this.waveScale>1){for(var h=1;
h<this.waveScale;
h++){if(k+h<this.audioInfo.peaks[a].length&&this.audioInfo.peaks[a][k+h]>f){f=this.convPeakWave(this.audioInfo.peaks[a][k+h])
}}}for(var h=0;
h<(this.waveScale<1?(-this.waveScale+1):1);
h++){this.audioWaveCtx[a].lineTo(n+1,parseInt(l+f*(o?-1:1)/d)+1);
n++
}}this.audioWaveCtx[a].lineTo(n+1,l);
this.audioWaveCtx[a].fill()
}this.audioWaveCtx[a].strokeStyle=this.colorWave;
this.audioWaveCtx[a].lineWidth=1;
this.audioWaveCtx[a].beginPath();
this.audioWaveCtx[a].moveTo(0,l);
this.audioWaveCtx[a].lineTo(n,l);
this.audioWaveCtx[a].stroke()
}},clearWave:function(){this.drawWave(true)
},convPeakWave:function(a){return(Math.pow(a,0.7))
},waveZoom:function(a){if(this.waveScale+a>=this.waveScaleMin&&this.waveScale+a<=this.waveScaleMax){do{this.waveScale+=a
}while(!this.waveScale);
this.drawWave();
this.setPlayPosition();
this.setButtonsState()
}},downloadAudio:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"prepareAudioFileForDownload",params:Ext.encode({client_panel_id:this.getClientPanelId(),fileBaseName:this.audioFile.fileName.substr(0,this.audioFile.fileName.length-4),sample_rate:this.sampleRate,channels:this.channels,format:a})},success:function(b){downloadPrepareFileHash(b)
},maskEl:this})
},setWaveRuler:function(){if(!this.audioWaveRuler){return
}var f={20:[[1,1],[1,1],[1,1],[1,1],[1,1],[],[1,5],[1,5],[1,10],[1,15],[2,30],[2,30],[5,30],[5,30],[10,30],[10,30],[10,30],[10,30],[15,60]],40:[[1,1],[1,1],[1,1],[1,1],[1,1],[],[1,5],[1,5],[1,10],[1,15],[2,30],[2,30],[5,30],[5,30],[10,30],[10,30],[10,30],[10,30],[15,60]],80:[[1,1],[1,1],[1,1],[1,2],[1,2],[],[1,5],[1,10],[1,15],[2,30],[2,30],[2,30],[5,30],[10,60]]};
var c=this.audioInfo.ms_per_pixel?f[this.audioInfo.ms_per_pixel][Math.min(this.waveScale+-this.waveScaleMinFix,f[this.audioInfo.ms_per_pixel].length-1)]:[1,5];
var a="";
var d=1;
var b=this.getWidthWave();
while(d<this.audioInfo.time){if(!(d%c[0])){var g=d/this.audioInfo.time*b;
a+='<div style="position: absolute;left: '+parseInt(g)+"px;top: 0px;width: 1px;height: "+(d%c[1]?4:this.audioWaveRuler.getHeight()-3)+"px;border-left: 1px;border-top: 0px;border-bottom:0px;border-right: 0px;border-color: "+this.colorRuler+';border-style: solid;">'+(d%c[1]?"":'<span style="color: '+this.colorRuler+'; font-size: 9px; padding-left: 2px; padding-top: 3px; display: block;">'+formatTimeHMSfromS(d)+"</span>")+"</div>"
}d+=1
}this.audioWaveRuler.setHtml(a)
},clearWaveRuler:function(){if(this.audioWaveRuler){this.audioWaveRuler.setHtml("")
}},getWidthWave:function(a){if(!Ext.isDefined(a)){a=this.waveScale
}return(parseInt(a>0?this.audioInfo.peaks[0].length/a:this.audioInfo.peaks[0].length*(-a+1)))
},seekBySliderPosition:function(){if(this.state=="none"||this.seeking||this.settingPlayPosition){return
}if(this.suspendAutoScrollWaveUntil){delete this.suspendAutoScrollWaveUntil
}this.seeking=true;
if(!this.slider){this.slider=this.playerContainer.findC("_id","slider")
}if(this.slider){this.gotoTime(this.audioInfo.time/this.slider.maxValue*this.slider.getValue())
}this.setPlayPosition();
if(this.state!="play"){this.pause(true)
}delete this.seeking
},gotoSliderTime:function(a){if(!this.audioInfo||this.sliderDragging){return
}if(!this.slider){this.slider=this.playerContainer.findC("_id","slider")
}if(this.slider){this.gotoSliderPosition(a/this.audioInfo.time*this.slider.maxValue)
}},gotoSliderPosition:function(a){this.setSliderPosition(a)
},setSliderPosition:function(a){if(!this.slider){this.slider=this.playerContainer.findC("_id","slider")
}if(this.slider){this.slider.setValue(parseInt(a))
}},seekByWavePosition:function(a){if(this.state=="none"||this.seeking||this.settingPlayPosition){return
}this.seeking=true;
this.gotoTime(this.audioInfo.time/this.getWidthWave()*a);
this.setPlayPosition();
if(this.state!="play"){this.pause(true)
}delete this.seeking
},gotoWaveTime:function(a){if(this.audioInfo){this.gotoWavePosition(a/this.audioInfo.time*this.getWidthWave())
}},gotoWavePosition:function(a){if(this.suspendAutoScrollWaveUntil){if((new Date).getTime()>this.suspendAutoScrollWaveUntil){delete this.suspendAutoScrollWaveUntil
}}if(!this.suspendAutoScrollWaveUntil&&!this.waveScrollerMousing){this.adjustWaveScroll(a)
}this.setWavePosition(a)
},adjustWaveScroll:function(a){if(!this.audioWaveContainer){return
}if(a<this.audioWaveContainer.getEl().dom.scrollLeft+50){this.suspendOnScrollWave=(this.suspendOnScrollWave||0)+1;
this.audioWaveContainer.setScrollX(Math.max(a-100,0))
}if(a>this.audioWaveContainer.getEl().dom.scrollLeft+this.audioWaveContainer.getWidth()-50){this.suspendOnScrollWave=(this.suspendOnScrollWave||0)+1;
this.audioWaveContainer.setScrollX(a-(this.audioWaveContainer.getWidth()-300))
}},setWavePosition:function(a){if(this.audioWavePositionPanel){this.audioWavePositionPanel.setPosition(parseInt(a),0)
}},onTimer:function(){if(this.mode=="file"&&this.state!="play"){return
}if(this.audioInfo){var a=this.getPlayTime();
if(a&&(roundNumber(a,1)>=roundNumber(this.audioInfo.time,1)||this.mode=="live"&&this.prevPlayTime&&a==this.prevPlayTime)){if(this.mode=="file"){this.stop()
}else{if(this.mode=="live"){if(this.liveStreamEnd){this.stop()
}else{this.stopPlay()
}}}}this.prevPlayTime=a
}if(!Ext.isDefined(this.needFirstSample)&&(this.mode=="file"||(this.mode=="live"&&this.liveStreamEnd))&&this.isShortAudioBuffer()&&this.audioBufferFirstSampleActive+this.audioBufferCountSamplesActive<this.audioInfo.samples-100){this.audioSetBuffer();
if(this.audioBufferCountSamplesPrepared>=this.audioBufferMinLengthSamples){this.audioPlay();
return
}}if(this.audioRequestState!="run"&&!(this.mode=="live"&&this.liveStreamEnd)){if(!this.audioRequestState||this.audioRequestState=="error"||((this.mode!="file"||Ext.isDefined(this.needFirstSample))&&((new Date).getTime()-this.audioRequestTime>1000))){this.audioLoad(this.needFirstSample)
}}this.setPlayPosition();
this.setButtonsState()
},setPlayPosition:function(){this.playTimeField.setValue(formatTimeHMSfromS(this.getPlayTime(),1,true));
this.settingPlayPosition=true;
this.gotoWaveTime(this.getPlayTime());
this.gotoSliderTime(this.getPlayTime());
delete this.settingPlayPosition;
this.showInfo();
if(this.evPlayTime){this.evPlayTime(this.getPlayTime())
}},onScrollWave:function(){if(this.suspendOnScrollWave>0){--this.suspendOnScrollWave;
if(!this.suspendOnScrollWave){delete this.suspendOnScrollWave
}return
}if(this.waveScrollerMousing){this.suspendAutoScrollWaveUntil=(new Date).getTime()+5000
}},onSliderChange:function(){if(!this.sliderDragging){this.seekBySliderPosition()
}},onSliderDragStart:function(){this.sliderDragging=true
},onSliderDragEnd:function(){delete this.sliderDragging;
this.seekBySliderPosition()
},showInfo:function(){if(this.debug){this.showInfoValue(1,"play time",formatTimeHMSfromS(this.getPlayTime(),1,true))
}},showInfoValue:function(d,a,c){if(this.debug){var b=this["ii_"+d];
if(!b){b=this["ii_"+d]=this.playerContainer.findC("name","ii_"+d)
}if(b){b.labelEl.dom.innerHTML=(a||"-")+":";
b.setValue(c)
}}},buttonsHandler:function(a){if(this.suspendAutoScrollWaveUntil){delete this.suspendAutoScrollWaveUntil
}switch(a._id){case"play":this.play();
break;
case"stop":this.stop();
break;
case"pause":if(this.state=="play"){this.pause()
}else{if(this.state=="pause"){this.unpause()
}}break;
case"backward":case"forward":var b=a._id=="backward"?-5:5;
this.timeShift(b);
break;
case"zoom_in":this.waveZoom(-1);
break;
case"zoom_out":this.waveZoom(1);
break;
case"download_audio_wav":case"download_audio_ogg":this.downloadAudio(a._id=="download_audio_wav"?"wav":"ogg");
break
}this.setButtonsState()
},play:function(){if(this.state!="play"){if(this.state=="pause"){this.unpause()
}else{this.state="play";
this.audioPlay()
}}this.setButtonsState()
},stop:function(a){if(this.state){delete this.state;
this.stopPlay();
if(!a){this.gotoTime(0);
this.setPlayPosition()
}}if(!a){this.setButtonsState()
}},pause:function(a){if(this.state=="play"||a){this.state="pause";
this.pausePlayTime=this.getPlayTime();
this.stopPlay();
if(this.evGotoTime){this.evGotoTime(this.pausePlayTime)
}}this.setButtonsState()
},unpause:function(){if(this.state=="pause"){this.state="play";
this.gotoTime(this.pausePlayTime);
delete this.pausePlayTime
}this.setButtonsState()
},timeShift:function(b){if(!this.state){this.pause(true)
}var a=(this.state=="pause"?this.pausePlayTime:this.getPlayTime())+b;
if(a>=this.audioInfo.time){return
}else{if(a<0){a=0
}}this.gotoTime(a);
if(this.state=="pause"){this.pausePlayTime=a
}this.setPlayPosition()
},setButtonsState:function(){var c=["backward","play","pause","stop","forward","zoom_in","zoom_out","download_audio"];
if(!this.buttons){this.buttons={}
}for(var b=0;
b<c.length;
b++){if(!Ext.isDefined(this.buttons[c[b]])){var a=this.playerContainer.findC("_id",c[b]);
this.buttons[c[b]]=a||false
}this.setButtonEnable(c[b],this.state!="none")
}if(this.state!="none"){this.setButtonToggle("play",this.state=="play");
this.setButtonToggle("pause",this.state=="pause");
this.setButtonEnable("pause",this.state);
this.setButtonToggle("stop",!this.state);
this.setButtonEnable("zoom_in",this.waveScale>this.waveScaleMin);
this.setButtonEnable("zoom_out",this.waveScale<this.waveScaleMax)
}},setButtonToggle:function(b,a){if(this.buttons[b]){this.buttons[b].toggle(a)
}},setButtonEnable:function(b,a){if(this.buttons[b]){this.buttons[b].enableIf(a)
}},destroyChunk:function(a){if(a.channels){for(var b=0;
b<a.channels.length;
b++){if(a.channels[b]){delete a.channels[b]
}}}if(a.data){delete a.data
}if(a.peaks){for(var b=0;
b<a.peaks.length;
b++){if(a.peaks[b]){delete a.peaks[b]
}}}},center:function(){this.playerContainer.center()
},getClientPanelId:function(){return(window.client_panel_id+(this._player_id||""))
}});
Ext.define("Tools.ChunkPlayer_old",{extend:"Ext.Window",constructor:function(b){b=Ext.applyIf(b||{},{width:520,height:200,border:false,modal:true,layout:"fit",items:{id:"audioVisualizerContainer",xtype:"panel",html:'<canvas id="audioVisualizer"></canvas>',border:false,bodyStyle:{"background-color":__color_WindowFrame}}});
this.callParent([b]);
this.on("close",this.onClose,this);
this.show();
if(!window.audioContext){audioContext=window.webkitAudioContext?new webkitAudioContext():new AudioContext();
audioAnalyser=audioContext.createAnalyser();
audioAnalyser.fftSize=2048
}this.audioBufferSampleRate=Ext.isSafari?24000:8000;
this.audioBuffer=audioContext.createBuffer(1,this.audioBufferSampleRate*15,this.audioBufferSampleRate);
this.activeChunks=[];
this.startTime=0;
this.offsetTime=0;
this.audioRequest=new XMLHttpRequest();
var c=this;
var a=function(){c.onAudioLoad()
};
this.audioRequest.addEventListener("load",a,false);
this.audioLoad();
this.audioVisualizerInit();
this._refreshVisualizer=function(){c.audioVisualizerDraw(c.audioVisualizationData());
if(c.getEl()){requestAnimationFrame(c._refreshVisualizer)
}};
this.firstPlay=true
},onClose:function(){if(this.audioSource){try{this.audioSource.stop(0)
}catch(a){}this.audioSource.disconnect()
}if(this.urlClose){ajaxSafeRequest({scope:this,url:this.urlClose,success:function(){},error:function(){},failure:function(){}})
}},audioLoad:function(){this.audioRequest.open("POST",this.url,true);
this.audioRequest.responseType="arraybuffer";
this.audioRequest.send()
},onAudioLoad:function(){if(!this.startTime){this.startTime=audioContext.currentTime
}this.activeChunks.push(this.audioRequest.response);
if(this.audioRequest.response.byteLength>2){this.audioSetBuffer()
}this.audioPlay();
if(this.audioRequest.response.byteLength<=2){var b=Math.max(0,audioContext.currentTime-this.startTime-this.offsetTime);
var a=this.audioBufferLength();
if(a<b+1){this.hangedUp=true;
this.unmask();
this.removeAll();
this.add({layout:{type:"vbox",align:"center",pack:"center"},items:{xtype:"displayfield",value:lang.callHangedUp,fieldStyle:{"font-weight":"bold"}},border:false,bodyStyle:{"background-color":__color_WindowFrame}});
Ext.defer(function(){if(this.getEl()){this.close()
}},3000,this)
}}if(!this.hangedUp){Ext.defer(function(){if(this.getEl()){this.audioLoad()
}},1000,this)
}},audioPlay:function(){if(this.audioSource){try{this.audioSource.stop(0)
}catch(b){}}var a=Math.max(0,audioContext.currentTime-this.startTime-this.offsetTime);
if(this.fillBuffer){a=Math.max(0,this.fillBufferCurrentTime-this.startTime-this.offsetTime);
debug_log(this.fillBufferCurrentTime+" - "+audioContext.currentTime)
}this.lastCurrentBufferTime=a;
debug_log("buffer time: "+a+" s");
debug_log("current time: "+(audioContext.currentTime-this.startTime)+" s");
if(this.fillBuffer){return
}this.audioSource=audioContext.createBufferSource();
this.audioSource.buffer=this.audioBuffer;
this.audioSource.connect(audioAnalyser);
this.audioSource.connect(audioContext.destination);
if(a<this.audioBufferLength()){this.audioSource.start(0,a);
if(this.firstPlay){this._refreshVisualizer();
this.firstPlay=false
}}this.audioSource.playbackRate.value=1
},audioSetBuffer:function(){var c=0;
if(!this.fillBuffer&&this.lastCurrentBufferTime>0){for(var h=0;
h<this.activeChunks.length;
h++){c+=this.activeChunks[h].byteLength/2/8000;
if(c<this.lastCurrentBufferTime){this.offsetTime+=this.activeChunks[h].byteLength/2/8000;
this.activeChunks.splice(0,1);
--h;
debug_log("splice buffer")
}else{break
}}}var a=0;
var m=this.audioBuffer.getChannelData(0);
var l=this.audioBufferSampleRate/8000;
for(var h=0;
h<this.activeChunks.length;
h++){var f=new Int16Array(this.activeChunks[h]);
for(var g=0;
g<f.length-1;
g++){for(var d=0;
d<l;
d++){m[a*l+d]=f[g]/65535
}++a
}}var b=a/8000;
debug_log("buffer length: "+b+" s");
if(b<(this.fillBuffer?6:2.5)){if(!this.fillBuffer){this.fillBuffer=true;
this.fillBufferCurrentTime=audioContext.currentTime;
this.mask("waiting for buffer","x-mask-loading")
}}else{if(this.fillBuffer){this.fillBuffer=false;
this.offsetTime+=audioContext.currentTime-this.fillBufferCurrentTime;
this.unmask()
}}},audioBufferLength:function(){var b=0;
for(var a=0;
a<this.activeChunks.length;
a++){b+=this.activeChunks[a].byteLength/2/8000
}return(b)
},audioVisualizerInit:function(){this.audioVisualizerContainer=document.getElementById("audioVisualizerContainer");
this.audioVisualizerCanvas=document.getElementById("audioVisualizer");
this.audioVisualizerCanvas.width=parseInt(this.audioVisualizerContainer.style.width);
this.audioVisualizerCanvas.height=parseInt(this.audioVisualizerContainer.style.height);
this.audioVisualizerCtx=this.audioVisualizerCanvas.getContext("2d");
this.audioVisualizerGradient=this.audioVisualizerCtx.createLinearGradient(0,0,0,this.audioVisualizerCanvas.height);
this.audioVisualizerGradient.addColorStop(1,"green");
this.audioVisualizerGradient.addColorStop(0.75,"green");
this.audioVisualizerGradient.addColorStop(0.25,"green");
this.audioVisualizerGradient.addColorStop(0,"red")
},audioVisualizerDraw:function(d){this.audioVisualizerCtx.clearRect(0,0,this.audioVisualizerCanvas.width,this.audioVisualizerCanvas.height);
this.audioVisualizerCtx.fillStyle=this.audioVisualizerGradient;
for(var b=0,a=d.length;
b<Math.min(a,this.audioVisualizerCanvas.width/3);
b+=1){var c=d[b]/2;
this.audioVisualizerCtx.fillRect(b*3,this.audioVisualizerCanvas.height-c,2,this.audioVisualizerCanvas.height)
}return this
},audioVisualizationData:function(){var a=new Uint8Array(audioAnalyser.frequencyBinCount);
audioAnalyser.getByteFrequencyData(a);
return a
}});
Ext.define("Tools.WavPlayerWS",{extend:"Ext.Window",play:function(){this.wavesurfer.play()
},pause:function(){this.wavesurfer.pause()
},stop:function(){this.wavesurfer.stop()
},backward:function(){this.wavesurfer.skipBackward()
},forward:function(){this.wavesurfer.skipForward()
},togglemute:function(){this.wavesurfer.toggleMute()
},constructor:function(b){var a='<div id="waveform"><div class="progress progress-striped active" id="progress-bar"><div class="progress-bar progress-bar-info"></div></div><div id="wave-spectrogram"></div><!-- Here be the waveform --><div id="wave-timeline"></div></div>';
var c=65;
var d=60;
b=Ext.applyIf(b||{},{border:false,modal:true,layout:"fit",items:{layout:{type:"vbox",align:"center",pack:"center"},items:[{width:Ext.dom.Element.getViewportWidth()*9/10,height:230,html:a,border:false},{layout:"hbox",items:[{xtype:"displayfield",border:false,width:d,value:"0:0",fieldStyle:{"font-weight":"bold","text-align":"right"},style:{"margin-right":"4px"},_id:"playTime"},{xtype:"displayfield",border:false,width:d,value:"",fieldStyle:{"font-weight":"bold","text-align":"left"},style:{"margin-left":"4px"},_id:"endTime"}],bodyStyle:{"background-color":__color_WindowFrame},border:false},{layout:"hbox",items:[{xtype:"button",text:"<b>"+lang.backward_player+"</b>",width:c,style:{"margin-right":"2px"},handler:this.backward,scope:this,_id:"play"},{xtype:"button",text:"<b>"+lang.play_player+"</b>",width:c,iconCls:"icon_rec_play",style:{"margin-right":"2px"},handler:this.play,scope:this,_id:"play"},{xtype:"button",text:"<b>"+lang.pause_player+"</b>",width:c,iconCls:"icon_rec_pause",style:{"margin-right":"2px"},handler:this.pause,scope:this,_id:"pause"},{xtype:"button",text:"<b>"+lang.stop_player+"</b>",width:c,iconCls:"icon_rec_stop",handler:this.stop,scope:this,_id:"stop",style:{"margin-right":"2px"}},{xtype:"button",text:"<b>"+lang.forward_player+"</b>",width:c,style:{"margin-right":"2px"},handler:this.forward,scope:this,_id:"play"},{xtype:"button",text:"<b>"+lang.togglemute_player+"</b>",width:c,enableToggle:true,toggleHandler:this.togglemute,style:{"margin-right":"2px"},scope:this,_id:"play"},{}],style:{"margin-top":"5px"},bodyStyle:{"background-color":__color_WindowFrame},border:false}],bodyStyle:{"background-color":__color_WindowFrame},border:false},style:{"padding-bottom":"10px"},listeners:{scope:this,afterrender:this.onAfterRender,close:this.onClose,destroe:this.onDestroy}});
this.callParent([b]);
this.show()
},onAfterRender:function(){if(this.initPlayer()){this.maskLoad(100)
}else{Ext.defer(function(){var a=lang.wavPlayerError+": "+(this.wavesurfer&&this.wavesurfer.backend&&this.wavesurfer.backend.error?this.wavesurfer.backend.error:lang.unknown);
if(this.sound_fail){Ext.Msg.confirm("",a+"<br><br>"+lang.tryOldPlayer+"?",function(b){if(b=="yes"){new Tools.WavPlayer({sound:this.sound_fail})
}},this)
}else{Ext.Msg.alert("",a)
}this.close()
},10,this)
}},onTimer:function(){var c=this.wavesurfer.getCurrentTime();
var b=parseInt(c)%60;
var a=parseInt(parseInt(c)/60);
var f=parseInt((c-Math.floor(c))*10);
function d(h,g){return(1000000000000000+h+"").slice(-g)
}this._playTime.setValue(d(a,2)+":"+d(b,2)+":"+f)
},initPlayer:function(){this.wavesurfer=Object.create(WaveSurfer);
this._playTime=this.findC("_id","playTime");
var c={container:document.querySelector("#waveform"),waveColor:"#00A7E3",progressColor:"#00719A",loaderColor:"#00719A",cursorColor:"navy"};
var a=document.querySelector("#progress-bar");
var f=a.querySelector(".progress-bar");
var g=function(h){a.style.display="block";
f.style.width=h+"%"
};
var b=function(){a.style.display="none"
};
var d=this;
this.wavesurfer.on("loading",function(){d.maskLoad()
});
this.wavesurfer.on("ready",function(){d.unmask()
});
this.wavesurfer.on("destroy",b);
this.wavesurfer.on("error",function(h){b();
d.unmask();
d.close();
if(d.sound_fail){Ext.Msg.confirm("",h+"<br><br>"+lang.tryOldPlayer+"?",function(k){if(k=="yes"){new Tools.WavPlayer({sound:d.sound_fail})
}})
}else{Ext.Msg.alert(lang.error,h)
}return
});
this.wavesurfer.on("ready",Ext.bind(function(){var k=Object.create(WaveSurfer.Timeline);
k.init({wavesurfer:this.wavesurfer,container:"#wave-timeline"});
var h={play:Ext.bind(function(){this.wavesurfer.playPause()
},this),back:Ext.bind(function(){this.wavesurfer.skipBackward()
},this),forth:Ext.bind(function(){this.wavesurfer.skipForward()
},this),"toggle-mute":Ext.bind(function(){this.wavesurfer.toggleMute()
},this)};
[].forEach.call(document.querySelectorAll("[data-action]"),function(l){l.addEventListener("click",function(n){var m=n.currentTarget.dataset.action;
if(m in h){n.preventDefault();
h[m](n)
}})
});
this.timer=Ext.TaskManager.start({run:this.onTimer,interval:100,scope:this});
this.wavesurfer.play()
},this));
if(!this.wavesurfer.init(c)){return(false)
}this.wavesurfer.load(this.sound);
if(this.wavesurfer.enableDragSelection){this.wavesurfer.enableDragSelection({color:"rgba(0, 255, 0, 0.1)"})
}window._wav_player=this;
return(true)
},onClose:function(){if(this.timer){Ext.TaskManager.stop(this.timer)
}this.wavesurfer.destroy()
},onDestroy:function(){if(this.timer){Ext.TaskManager.stop(this.timer)
}}});
Ext.define("Tools.WavPlayer",{extend:"Ext.Window",constructor:function(c){var a=1;
var d=2;
var b=Ext.isIE?'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+a+'" height="'+d+'" id="haxe" class="wav-player" align="middle"> <param name="movie" value="swf/wavplayer2.swf?gui=full&w='+a+"&h="+d+"&sound="+c.sound+'&"/> <param name="allowScriptAccess" value="always" /> <param name="quality" value="high" /> <param name="scale" value="noscale" /> <param name="salign" value="lt" /> <param name="bgcolor" value="'+__color_WindowFrame+'"/> </object>':'<embed src="swf/wavplayer2.swf?gui=full&w='+a+"&h="+d+"&sound="+c.sound+'" id="haxe" class="wav-player" bgcolor="'+__color_WindowFrame+'" width="'+a+'" height="'+d+'" name="haxe" quality="high" align="middle" scale="noscale" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />';
var f=65;
var g=60;
c=Ext.applyIf(c||{},{border:false,modal:true,layout:"fit",items:{layout:{type:"vbox",align:"center",pack:"center"},items:[{html:b,border:false},{layout:"hbox",items:[{xtype:"displayfield",border:false,width:g,value:"",fieldStyle:{"font-weight":"bold","text-align":"right"},style:{"margin-right":"4px"},_id:"playTime"},{xtype:"slider",width:300,height:20,hideLabel:true,useTips:false,minValue:0,maxValue:99,animate:false,_id:"slider",disabled:true,listeners:{scope:this,change:this.sliderChange,dragstart:this.sliderDragStart,dragend:this.sliderDragEnd},cls:"wav-player",style:{"margin-top":"-1px"}},{xtype:"displayfield",border:false,width:g,value:"",fieldStyle:{"font-weight":"bold","text-align":"left"},style:{"margin-left":"4px"},_id:"endTime"}],bodyStyle:{"background-color":__color_WindowFrame},border:false},{layout:"hbox",items:[{xtype:"button",text:"<b>"+lang.play_player+"</b>",width:f,iconCls:"icon_rec_play",style:{"margin-right":"2px"},handler:this.play,scope:this,_id:"play",disabled:true},{xtype:"button",text:"<b>"+lang.pause_player+"</b>",width:f,iconCls:"icon_rec_pause",style:{"margin-right":"2px"},handler:this.pause,scope:this,_id:"pause",disabled:true},{xtype:"button",text:"<b>"+lang.stop_player+"</b>",width:f,iconCls:"icon_rec_stop",handler:this.stop,scope:this,_id:"stop",disabled:true}],style:{"margin-top":"5px"},bodyStyle:{"background-color":__color_WindowFrame},border:false}],bodyStyle:{"background-color":__color_WindowFrame},border:false},style:{"padding-bottom":"10px"},listeners:{scope:this,afterrender:this.onAfterRender,close:this.onClose,destroe:this.onDestroy}});
this.callParent([c]);
this.show()
},onAfterRender:function(){this.maskLoad(100);
this.initPlayer()
},initPlayer:function(){this.player=this.getPlayer();
if(this.getEl()&&(!this.player||!this.player.dom||!this.player.dom.attachHandler)){Ext.defer(this.initPlayer,200,this);
return
}this.player.dom.attachHandler("PLAYER_PLAYING","wavPlayerHandlerPlaying",this.id);
this.player.dom.attachHandler("PLAYER_PAUSED","wavPlayerHandlerPaused",this.id);
this.player.dom.attachHandler("PLAYER_STOPPED","wavPlayerHandlerStopped",this.id);
this.player.dom.attachHandler("PLAYER_LOAD","wavPlayerHandlerLoad",this.id);
this.player.dom.attachHandler("PLAYER_BUFFERING","wavPlayerHandlerBuffering",this.id);
this._playTime=this.findC("_id","playTime");
this._endTime=this.findC("_id","endTime");
this._slider=this.findC("_id","slider");
this._play=this.findC("_id","play");
this._stop=this.findC("_id","stop");
this._pause=this.findC("_id","pause");
this.state="load";
this.player.dom.doPlay();
this.timer=Ext.TaskManager.start({run:this.onTimer,interval:100,scope:this});
window._wav_player=this
},onClose:function(){if(this.timer){Ext.TaskManager.stop(this.timer)
}},onDestroy:function(){if(this.timer){Ext.TaskManager.stop(this.timer)
}},getPlayer:function(){return(this.body.down(".wav-player"))
},play:function(){if(this.state=="stop"){this.ignoreEventOnStopped=true;
this.maskLoad();
this.player.dom.doPlay();
this.ignoreEventOnStopped=false
}else{if(this.state=="ready"){this.timeBegin=-1;
this.player.dom.doSeek(0);
this.state="playing";
this.onStateChange()
}}},stop:function(){this.player.dom.doSeek(0);
this.player.dom.doPause();
this.state="ready";
this.clearPlayTime();
this.onStateChange();
this.seekTimeS=null;
this.seekTimeDo=false;
this.seekMask=null;
this.unmask()
},seek:function(a){this.setPlayTime(a,true);
if(this.sliderDragging){this.lastDraggingTimeS=a
}else{this.player.dom.doPause();
this.seekTimeS=a;
this.seekTimeDo=true;
this.waitToOnPlayingEvent=false
}},pause:function(){if(this.state=="playing"){this.player.dom.doPause();
this.state="paused"
}else{this.player.dom.doResume();
this.state="playing"
}this.onStateChange()
},sliderChange:function(a,b){if(!this.sliderSetting&&this.endTimeS){this.seekPos=b;
this.seek(b/100*this.endTimeS)
}},sliderDragStart:function(){this.sliderDragging=true
},sliderDragEnd:function(){this.sliderDragging=false;
if(Ext.isDefined(this.lastDraggingTimeS)&&this.lastDraggingTimeS!==null){this.seek(this.lastDraggingTimeS);
this.lastDraggingTimeS=null
}},onPlaying:function(a){if(this.ignoreEventOnPlaying){return
}if(this.state=="load"){this.ignoreEventOnPlaying=true;
this.player.dom.doSeek(0);
this.player.dom.doPause();
this.state="ready";
this.onStateChange();
this.unmask();
this.ignoreEventOnPlaying=false
}else{this.state="playing";
this.onStateChange();
this.timeBegin=a;
this.timeBeginAt=new Date();
if(!this.seekMask||!this.seekTimeS){this.unmask()
}}this.waitToOnPlayingEvent=false
},onPaused:function(a){if(this.state=="playing"){this.timeBegin=a;
this.timeBeginAt=new Date()
}},onStopped:function(){if(this.ignoreEventOnStopped){return
}this.stop()
},onLoad:function(a){if(this.state=="load"){if(a===0){Ext.Msg.alert(lang.error,lang.errorLoadingWavFile,function(){this.close()
},this);
return
}this.clearPlayTime();
this.setEndTime(a)
}},onBuffering:function(a){},onTimer:function(){if(this.timeBegin==-1){return
}if(this.state=="playing"||this.seekTimeDo){var b=new Date();
var a=(b.getTime()-this.timeBeginAt.getTime())/1000+this.timeBegin;
if(this.seekTimeS!==null){if(this.seekTimeDo||a<this.seekTimeS-0.5||a>this.seekTimeS+0.5){if(!this.waitToOnPlayingEvent){this.waitToOnPlayingEvent=true;
this.player.dom.doSeek(this.seekTimeS)
}if(!this.seekMask&&a<this.seekTimeS-30){this.maskLoad(1000);
this.seekMask=true
}this.seekTimeDo=false
}else{this.seekTimeS=null;
if(this.seekMask){this.unmask();
this.seekMask=null
}this.setPlayTime(a)
}}else{if(a>this.endTimeS){this.stop()
}else{this.setPlayTime(a);
if(this.seekMask){this.unmask();
this.seekMask=null
}}}}this.oldSeekPos=this.seekPos
},onStateChange:function(){this._play.enableIf(this.state=="stop"||this.state=="ready");
this._pause.enableIf(this.state=="playing"||this.state=="paused");
this._stop.enableIf(this.state=="playing"||this.state=="paused");
this._slider.enableIf(this.state=="playing"||this.state=="paused")
},setPlayTime:function(d,b){var c=time(d);
var a=parseInt((c.getTime()%1000)/100);
this._playTime.setValue(Ext.Date.format(c,"i:s")+"."+(a?a:"0"));
if(!b){this.setSlider(d)
}},clearPlayTime:function(){this._playTime.setValue("00:00.0");
this.setSlider(0)
},setEndTime:function(c){this.endTimeS=c;
var b=time(c);
var a=parseInt((b.getTime()%1000)/100);
this._endTime.setValue(Ext.Date.format(b,"i:s")+"."+(a?a:"0"))
},setSlider:function(a){if(this.sliderDragging||this.oldSeekPos!=this.seekPos){return
}this.sliderSetting=true;
if(a){if(this.endTimeS){this._slider.setValue(Math.round(100*a/this.endTimeS))
}}else{this._slider.setValue(0)
}this.sliderSetting=false
}});
function wavPlayerHandlerPlaying(d,c,b,a){Ext.getCmp(d).onPlaying(c,b,a)
}function wavPlayerHandlerPaused(d,c,b,a){Ext.getCmp(d).onPaused(c,b,a)
}function wavPlayerHandlerStopped(d,c,b,a){Ext.getCmp(d).onStopped(c,b,a)
}function wavPlayerHandlerLoad(d,c,b,a){Ext.getCmp(d).onLoad(c,b,a)
}function wavPlayerHandlerBuffering(d,c,b,a){Ext.getCmp(d).onBuffering(c,b,a)
}function excludeIp(a,b){a=Ext.decode(a);
if(!a){return
}if(a.alert_id){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getAlertName",params:Ext.encode({alert_id:a.alert_id})},success:function(c){Ext.Msg.confirm("","Do you want to exlude "+(b?"destination ":"")+"IP: "+a.ip+" from alert "+c.alert_name+" ?",function(d){if(d=="yes"){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"excludeIpFromAlert",params:Ext.encode({alert_id:a.alert_id,ip:a.ip,ip_is_dst:b?1:0})}})
}})
}})
}}function excludeNumber(a){a=Ext.decode(a);
if(!a){return
}if(a.alert_id){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getAlertName",params:Ext.encode({alert_id:a.alert_id})},success:function(b){Ext.Msg.confirm("","Do you want to exlude number: "+a.number+" from alert "+b.alert_name+" ?",function(c){if(c=="yes"){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"excludeNumberFromAlert",params:Ext.encode({alert_id:a.alert_id,number:a.number})}})
}})
}})
}}Ext.define("Tools.ProgressProcess",{extend:"Ext.Window",constructor:function(b){var a=[];
if(b&&b.text){a.push({xtype:"displayfield",value:b.text,style:{marginTop:4}})
}this.progressBar=new Ext.ProgressBar({width:300,height:20,style:{marginTop:4,marginBottom:6}});
a.push(this.progressBar);
if(b&&b.fceCancel){this.cancelButton=new Ext.Button({text:lang.cancelButtonText,scope:this,handler:this.cancel,style:{marginBottom:4}});
a.push(this.cancelButton)
}b=Ext.applyIf(b||{},{layout:"fit",items:{xtype:"container",layout:{type:"vbox",align:"center"},items:a},closable:false,header:false,border:false,modal:true,bodyStyle:{"background-color":__color_WindowFrame},listeners:{scope:this,close:function(){Ext.TaskManager.stop(this.refreshSchedulerObj);
if(this.nextFunctions&&this.nextFunctions.length){window[this.nextFunctions[0]](this.nextFunctions.splice(1))
}}}});
this.callParent([b]);
this.show();
this.refreshSchedulerObj=Ext.TaskManager.start({run:this.refreshScheduler,interval:b.refreshInterval||500,scope:this})
},refreshScheduler:function(){if(!this.refreshCounter){this.refreshCounter=1
}this.getPercState();
++this.refreshCounter
},getPercState:function(){return(this.fcePercState?this.fcePercState.call(this.fcePercStateScope,this.refreshCounter):undefined)
},setPercState:function(a){this.progressBar.updateProgress(a/100)
},cancel:function(){if(this.fceCancel){this.fceCancel.call(this.fceCancelScope);
this.close()
}}});
function upgradeSnifferByGit(f,m){var c=["check_git_directory","git_pull","configure","make_clean","make","install"];
var l=[];
for(var g=0;
g<c.length;
g++){l.push({value:lang.upgradeSnifferByGitSteps[c[g]],style:{marginRight:20}},{value:"",width:150,upgradeStep:c[g]})
}var h=0;
var a=null;
var d=new Ext.Window({title:lang.upgradingSensorPleaseWait.template([f.name]),items:{layout:{type:"table",columns:2},defaults:{xtype:"displayfield"},items:l,border:false,bodyStyle:{"background-color":__color_WindowFrame}},autoWidth:true,autoHeight:true,border:false,modal:true,closable:false,bodyStyle:{"background-color":__color_WindowFrame}});
d.on("activate",b,null,{single:true});
d.show();
function b(){k()
}function k(){var n=d.findC("upgradeStep",c[h]);
n.setValue(lang.processing+" ...");
n.inputEl.setStyle({color:"blue","font-weight":"bold"});
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"upgradeSnifferByGit",params:Ext.encode({task:c[h],sensorData:f})},success:function(o){n.setValue(lang.OK);
n.inputEl.setStyle({color:"green","font-weight":"bold"});
if(h<c.length-1){++h;
k()
}else{h=0;
d.close();
Ext.defer(function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartSensor",params:Ext.encode({host:f.host,port:f.port,id_sensor:f.id_sensor,read_timeout:f.read_timeout})},success:function(){if(m){m.mask(lang.restartingSensor+" "+f.name);
Ext.defer(function(){m.unmask();
m.store.load()
},(window.isCloud?20:10)*1000)
}},maskEl:m,maskMsg:lang.restartingSensor+" "+f.name})
},500)
}},error:function(o,p){var q=h;
h=0;
n.setValue(lang.FAIL);
n.inputEl.setStyle({color:"red","font-weight":"bold"});
Ext.defer(function(){var r=null;
if(p&&p.responseText){r=Ext.decode(p.responseText);
if(isDataEmpty(r)){r={msg:p.responseText}
}}var s=getStringAjaxError(r);
Ext.Msg.longalert(lang.upgradeSnifferByGitSteps[c[q]]+" - "+lang.failed,s,function(){Ext.defer(function(){d.close()
},2000)
})
},2000)
},failure2:function(){h=0;
n.setValue(lang.FAIL);
n.inputEl.setStyle({color:"red","font-weight":"bold"});
Ext.defer(function(){d.close()
},2000)
}})
}}Ext.define("Tools.LogSensor.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"sensors",constructor:function(d){var g=[];
if(!d||!d.relFields){g.push({xtype:"checkcolumn",header:"",dataIndex:"confirmed",width:__width_FieldChar(10),align:"center",listeners:{scope:this,checkchange:function(o,n,p){var m=this.store.getAt(n);
if(m){m.data.confirmed=p;
m.commit();
this.saveRecord({data:{ID:m.data.ID,confirmed:p*1}})
}}}},{dataIndex:"time",renderer:l,width:__width_ColumnDateTime},{dataIndex:"id_sensor",renderer:a,widthCh:10,align:"center"},{dataIndex:"type",renderer:renderArrayData,arrayData:arLogSensorType,renderer2:f,widthCh:15},{dataIndex:"message",renderer:c,widthCh:50})
}else{g.push({dataIndex:"message",renderer:c,flex:1})
}d=Ext.applyIf(d||{},{storeId:!d||!d.relFields?"LogSensorMainStore":"LogSensorSubStore",url:"php/model/sql.php",module:"log_sensor",recordStruct:rsLogSensor,keyField:"ID",sort:[{property:"time",direction:"DESC"},{property:"ID",direction:"DESC"}],remoteSort:true,columnsDefaults:{sortable:false},columns:g,getRowClass:k});
if(!d||!d.relFields){var b={_own:true,xtype:"pagingtoolbar",displayInfo:false,border:false,height:43,style:{background:__color_TabGroupBackgroud,"border-width":0}};
var h=[{xtype:"buttongroup",title:findLangSd("dateRange"),columns:2,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:2},{value:findLangSd("from")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",_searchField:"time_from",_gridForm:this,_buttonGroup:true},{value:findLangSd("to")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchDateTimeX",_searchField:"time_to",_gridForm:this,_buttonGroup:true}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:findLangSd("search"),columns:4,defaults:{xtype:"displayfield"},items:[{xtype:"container",height:1,colspan:4},{value:this.findLangS("tbar","type")+":",fieldCls:"x-toolbar-text"},{xtype:"ComboBoxA",aData:arLogSensorType,multiSelect:true,_arraySeparator:",",_clearButton:true,_searchField:"type",_gridForm:this,width:125,_buttonGroup:true},{value:findLangSd("grid","quickSearch")+":",fieldCls:"x-toolbar-text"},{xtype:"SearchFieldX",_gridForm:this,width:125,_buttonGroup:true},{value:findLangSd("grid","sensor")+":",fieldCls:"x-toolbar-text"},{xtype:"CBX_sensor",_noLabel:true,value:_sensorId_all,width:125,_multiSelect2:true,_evSelectMode2:true,_addEmptySensorId:true,_addAll:true,_searchField:"id_sensor",_gridForm:this,_buttonGroup:true},{value:this.findLangS("tbar","showConfirmed")+":",fieldCls:"x-toolbar-text"},{xtype:"checkbox",_gridForm:this,_buttonGroup:true,listeners:{scope:this,afterrender:function(m){m.bodyEl.setStyle({height:"13px","min-height":"13px",overflow:"hidden"});
m.displayEl.setStyle({"margin-top":"0px"})
},change:function(n,m){this.setExtraParam("show_confirmed",m*1,true)
}},style:{marginTop:"2px",marginBottom:"0px"}}],style:{background:__color_TabGroupBackgroud,"border-width":0}},{xtype:"buttongroup",title:this.findLangS("tbar","paginator"),items:b,style:{background:__color_TabGroupBackgroud,"border-width":0}},{text:this.findLangS("tbar","confirmAll"),iconCls:"icon_ok",scope:this,handler:this.confirmAll}];
d=Ext.applyIf(d||{},{pageSize:30,tbar:h,paginator:b,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Tools.LogSensor.Grid.GridExpPanel",expandOnEnter:false,expandOnDblClick:false,enableExpand:function(m){return(m.data.is_group)
}}],prefixCls:"main",fullColumnSize:"message",fullColumnSizeDecrementScroller:true})
}else{d=Ext.applyIf(d||{},{hideHeaders:true})
}this.callParent([d]);
function l(r,o,n,s,q,p,m){return(f(renderDateTime(r),o,n))
}function a(r,o,n,s,q,p,m){return(f(r||"local",o,n))
}function c(s,o,n,t,q,p,m){var r="";
if(n.data.subject){r+=n.data.subject
}if(n.data.message){if(r){r+="<br>"
}r+=n.data.message.replaceall("\n","<br>")
}return(f(renderStringStyle(r,{forceMultiLine:true}),o,n))
}function f(s,o,n,t,r,q,m){if(!n.data.ID_parent){var p=n.data.confirmed?"darkgrey":["error","critical","alertÍ„","emergency"].inArray(n.data.type)?"red":null;
if(p){s=renderStringStyle(s,{color:p})
}}return(s)
}function k(m,p,o,n){if(!m.data.ID_parent&&["error","critical","alertÍ„","emergency"].inArray(m.data.type)){return(addBackgroundColorRuleToStyleSheet("#FFEBEC","main-cell"))
}}},confirmAll:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"confirmAllUnconfirmedRowsInLogSensor"},success:function(a){if(this.getEl()&&this.store){this.store.each(function(c){c.data.confirmed=true;
c.commit()
})
}var b=this.findWindow();
if(b){b.close()
}}})
}});
Ext.define("Tools.LogSensor.Grid.GridExpPanel",{extend:"Ext.Panel",subsystem:"sensors",constructor:function(a){var b=false;
this.sublogSensor=new Tools.LogSensor.Grid({title:b?this.findLangS("title","sublogs"):null,relFields:{ID_parent:a.record.data.ID},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder}});
this.panel=new Ext.create(b?"Ext.TabPanel":"Ext.Panel",{items:this.sublogSensor,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"main-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.panel,border:false});
this.callParent([a])
}});
Ext.define("Tools.checkTablesIdProblems",{extend:"Ext.Panel",subsystem:"tools",constructor:function(b){var g=this;
var h=new Ext.data.ArrayStore({fields:["checked","table","table_size","problems","severity_max"],data:[]});
this.loadData(b.data,h,false);
var c=[{xtype:"checkcolumn",dataIndex:"checked",header:'<img src="'+__extjs_images_path()+'menu/default-unchecked.gif" style="margin-left: 1px;">',checked:false,width:28,sortable:false,hideable:false,draggable:false,resizable:false,menuDisabled:true,listeners:{scope:this,checkchange:function(p,o,q){var n=this.grid.store.getAt(o);
if(n){n.data.checked=q;
n.commit()
}g.renderSql()
}}},{dataIndex:"table",align:"left",header:this.findLangS("column","table"),width:__width_ColumnChar(20)},{dataIndex:"table_size",align:"left",header:this.findLangS("column","table_size"),renderer:m,width:__width_ColumnChar(20)},{dataIndex:"problems",align:"left",header:this.findLangS("column","problem_description"),renderer:k,flex:1},{dataIndex:"severity_max",align:"left",header:this.findLangS("column","problem_severity"),renderer:f,width:__width_ColumnChar(10)}];
this.grid=new Ext.grid.GridPanel({store:h,columns:{items:c,defaults:{sortable:false}},viewConfig:{stripeRows:false},listeners:{scope:this,afterrender:function(o){var n=o.headerCt.items.get(0);
n.on("headerclick",function(){d(o,n)
},this)
}},border:true,flex:true});
this.sqlPanel=new Ext.panel.Panel({bodyStyle:{padding:5},flex:true});
this.oldestDateInSpoolLabel=new Ext.form.field.Display({xtype:"displayfield_h16",value:this.findLangS("field","oldest_date_in_spool")+":"});
this.oldestDateInSpool_value=null;
this.oldestDateInSpool=new Ext.form.field.Date({format:__format_Date,width:__width_FieldDate,listeners:{scope:this,select:function(o,n){this.oldestDateInSpool_value=n;
this.renderSql()
},change:function(o,n){this.oldestDateInSpool_value=n;
this.renderSql()
}}});
this.buttonRunSql=new Ext.button.Button({xtype:"button",text:"<b>"+this.findLangS("button","runSql")+"</b>",iconCls:"icon_database_go",handler:function(){this.runSql(true)
},scope:this});
if(isClipboardCopySupport()){this.buttonCopySqlToClipboard=new Ext.button.Button({xtype:"button",text:this.findLangS("button","copySqlToClipboard"),handler:function(){clipboardCopy(this.sqlPanel.body.dom.innerText)
},scope:this})
}this.showLowSeverity_value=false;
if(this.existsLowSeverity(b.data)){this.showLowSeverity=new Ext.form.field.Checkbox({boxLabel:this.findLangS("text","showLowSeverity"),checked:this.showLowSeverity_value,listeners:{scope:this,change:function(o,n){this.showLowSeverity_value=n;
this.loadData(b.data,this.grid.store,this.showLowSeverity_value);
this.renderSql()
}}})
}this.sqlWarning=new Ext.form.field.Display({fieldStyle:{color:"red","font-weight":"bold"}});
var l=[{xtype:"displayfield_h16",value:this.findLangS("text","sqlQueriesToSolveProblems")},{xtype:"container",flex:1}];
l.push(this.buttonRunSql);
if(this.buttonCopySqlToClipboard){l.push({xtype:"container",width:5},this.buttonCopySqlToClipboard)
}l.push({xtype:"container",flex:1});
l.push(this.oldestDateInSpoolLabel,this.oldestDateInSpool);
if(this.showLowSeverity){l.push({xtype:"container",width:5},this.showLowSeverity)
}b=Ext.applyIf(b||{},{layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield_h16",value:this.findLangS("text","tableProblems")},this.grid,{xtype:"container",layout:{type:"hbox",align:"stretch"},items:l,style:{paddingTop:2,paddingBottom:2}},this.sqlWarning,this.sqlPanel],border:false,bodyStyle:{"background-color":__color_WindowFrame},style:{"background-color":__color_WindowFrame},listeners:{scope:this,afterrender:function(){this.renderSql()
}}});
this.callParent([b]);
window.__checkTablesIdProblems=this;
if(b.autoCreateWindow){this.win=new Ext.Window({layout:"fit",title:this.findLangS("title","problemsInTables"),iconCls:"icon_wrench",width:Ext.dom.Element.getViewportWidth()-80,height:Ext.dom.Element.getViewportHeight()-80,items:this,border:false,modal:true,closable:true,resizable:false,listeners:{close:function(){if(b.onCloseWindow){b.onCloseWindow()
}}}});
this.win.show()
}function d(q,p){a(p,!p.checked);
for(var o=0;
o<q.store.getCount();
o++){var n=q.store.getAt(o);
n.data.checked=p.checked;
n.commit()
}g.renderSql()
}function a(n,o){n.checked=o;
n.setText('<img src="'+__extjs_images_path()+"menu/default-"+(n.checked?"":"un")+'checked.gif">')
}function m(s,n,p,t,r,q){var o="rows: "+s.rows+"<br>data: "+roundNumber(s.data_length/Math.pow(1024,2),1)+" MB<br>index: "+roundNumber(s.index_length/Math.pow(1024,2),1)+" MB";
return(renderStringStyle(o,{color:(s.data_length*1+s.index_length*1)>Math.pow(1024,3)?"red":"black"}))
}function k(t,v,p,s,q,u){var r="";
for(var o=0;
o<t.length;
o++){if(o){r+="<br>"
}for(var n=0;
n<t[o].descr.length;
n++){r+=t[o].descr[n]+"<br>"
}}return(r)
}function f(s,o,p,t,r,q){var n={"1":{c:"green",t:"LOW"},"2":{c:"orange",t:"MEDIUM"},"3":{c:"red",t:"CRITICAL"}};
if(s&&Ext.isDefined(n[s])){return(renderStringStyle(n[s].t,{color:n[s].c}))
}return("")
}},loadData:function(f,a,g){a.removeAll();
for(var d=0;
d<f.length;
d++){var h=f[d].problems;
var c=0;
for(var b=0;
b<h.length;
b++){if(h[b].severity>c){c=h[b].severity
}}if(g||c>=2){a.add({table:f[d].table,table_size:f[d].table_size,problems:f[d].problems,severity_max:c})
}}},runSql:function(a){if(a){Ext.Msg.confirm("",this.findLangS("text","confirmRunBatchSql"),function(b){if(b=="yes"){this.runSql()
}},this);
return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"runQueriesForFixTablesIdProblems",params:Ext.encode({tables:this.getSelectTables(),limitDate:this.oldestDateInSpool_value,sqlBatchType:modifySqlSchema_type()})},success:function(b){var c=this;
c.win.hide();
showSqlBatch(null,function(){c.win.close()
})
},maskEl:this})
},renderSql:function(){var a=this.getSelectTables();
if(!a.length){this.sqlPanel.body.dom.innerText="";
this.sqlPanel.disable();
this.sqlWarning.hide();
this.oldestDateInSpool.hide();
this.oldestDateInSpoolLabel.hide();
this.buttonRunSql.disable();
this.buttonCopySqlToClipboard.disable();
return
}if(this.needSetOldestDateInSpool(a)){this.oldestDateInSpool.show();
this.oldestDateInSpoolLabel.show();
if(!this.oldestDateInSpool_value){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkOldestDateInSpool"},success:function(b){if(b.need_upgrade_sensors){Ext.Msg.confirm("",this.findLangS("text","upgradeSensorsQuestionBeforeUpgradingSqlSchema"),function(c){if(c=="yes"){Settings.Utils.upgradeSensors({sensors:b.need_upgrade_sensors,scope:this,okIfAllSuccess:true,onOk:function(g,d,f){f.close();
this.renderSql()
}})
}},this);
return
}else{this.oldestDateInSpool_value=b.oldest_date_in_spool;
this.oldestDateInSpool.setValue(this.oldestDateInSpool_value);
this._renderSql()
}},maskEl:this})
}else{this._renderSql()
}}else{this.oldestDateInSpool.hide();
this.oldestDateInSpoolLabel.hide();
this._renderSql()
}},_renderSql:function(){var a=this.getSelectTables();
this.sqlWarning.showIf(this.needSizeWarning(a));
this.sqlWarning.setValue(this.needSizeWarning(a)?this.findLangS("text","sqlOperationCanTakeLotOfTime")+"!!!":"");
this.sqlPanel.enable();
this.sqlPanel.unmask();
this.buttonRunSql.enable();
this.buttonCopySqlToClipboard.enable();
this.setSql()
},setSql:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getQueriesForFixTablesIdProblems",params:Ext.encode({tables:this.getSelectTables(),limitDate:this.oldestDateInSpool_value})},success:function(a){this.sqlPanel.body.dom.innerText=a.queries
},maskEl:this})
},getSelectTables:function(){var a=[];
this.grid.store.each(function(b){if(b.data.checked){a.push(b.data.table)
}});
return(a)
},needSetOldestDateInSpool:function(d){if(!d){d=this.getSelectTables()
}for(var b=0;
b<this.config.data.length;
b++){if(!d||d.isIn(this.config.data[b].table)){var c=this.config.data[b].problems;
for(var a=0;
a<c.length;
a++){if(c[a].remove_old_partitions=="via_spool"){return(true)
}}}}},needSizeWarning:function(b){if(!b){b=this.getSelectTables()
}for(var a=0;
a<this.config.data.length;
a++){if(!b||b.isIn(this.config.data[a].table)){if((this.config.data[a].table_size.data_length*1+this.config.data[a].table_size.data_length*1)>Math.pow(1024,3)){return(true)
}}}return(false)
},existsLowSeverity:function(d){if(!d){d=this.config.data
}for(var c=0;
c<d.length;
c++){var f=d[c].problems;
var b=0;
for(var a=0;
a<f.length;
a++){if(f[a].severity>b){b=f[a].severity
}}if(b==1){return(true)
}}return(false)
}});
function checkTablesIdProblems(b,a){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"checkTablesIdProblems",params:Ext.encode({sqlBatchType:modifySqlSchema_type()})},success:function(c){if(c.sqlBatch&&!c.sqlBatchComplete){new Tools.sqlBatch({data:c.sqlBatch,autoCreateWindow:true,onCloseWindow:function(){if(b&&b.length){window[b[0]](b.splice(1))
}}});
return
}var g=false;
if(c.problems&&c.problems.length){for(var f=0;
f<c.problems.length;
f++){for(var d=0;
d<c.problems[f].problems.length;
d++){if(c.problems[f].problems[d].severity>1){g=true
}}}}if(g){new Tools.checkTablesIdProblems({data:c.problems,autoCreateWindow:true,onCloseWindow:function(){if(b&&b.length){window[b[0]](b.splice(1))
}}})
}else{if(b&&b.length){window[b[0]](b.splice(1))
}if(a){Ext.Msg.alert("",findLangS("tools","text","mysqlSchemaIsOK"))
}}}})
}Ext.define("Tools.sqlBatch",{extend:"Ext.Panel",subsystem:"tools",constructor:function(c){var b=new Ext.data.ArrayStore({fields:["order_num","sql","run_at","finish_at","duration","pid","task_id","error"],data:[]});
if(c.data){this._loadData(c.data,b)
}var f=[{xtype:"actioncolumn",header:"",width:20,items:[{getClass:function(h,k,l){return(l.data.finish_at?(l.data.error?"icon_state_error":"icon_ok"):l.data.pid?"icon_rec_play":"icon_blank")
},scope:this}]},{dataIndex:"order_num",width:__width_ColumnNum(5),align:"right"},{dataIndex:"sql",renderer:function(o,l,k,p,n,m,h){rslt=o;
if(k.data.error){rslt+='<br><span style="color: red;">'+k.data.error+"</span>"
}return(rslt)
},flex:1},{dataIndex:"run_at",width:__width_ColumnNum(14)},{dataIndex:"finish_at",width:__width_ColumnNum(14)},{dataIndex:"duration",width:__width_ColumnNum(6),align:"right"},{dataIndex:"pid",width:__width_ColumnNum(6),align:"right"},{dataIndex:"task_id",width:__width_ColumnNum(6),align:"right"}];
for(var d=0;
d<f.length;
d++){if(!Ext.isDefined(f[d].header)){var g=this.findLangS("column",f[d].dataIndex);
f[d].header=g||f[d].dataIndex
}}this.grid=new Ext.grid.GridPanel({store:b,columns:{items:f,defaults:{sortable:false}},viewConfig:{stripeRows:false},border:true,flex:true});
if(user_is_admin()){this.cancelButton=new Ext.button.Button({xtype:"button",text:"<b>"+lang.cancelButtonText+"</b>",iconCls:"icon_cross",handler:function(){this.cancelSqlBatch(true)
},scope:this});
this.closeButton=new Ext.button.Button({xtype:"button",text:"<b>"+lang.closeButtonText+"</b>",handler:function(){this.win.close()
},scope:this,hidden:true})
}var a=[{xtype:"displayfield_h16",value:this.findLangS("text","databaseMaintenanceInProgress"),fieldStyle:{color:"red","font-weight":"bold"},_id:"header_text"},{xtype:"displayfield_h16",value:this.findLangS("text","sqlQueue")},this.grid];
if(this.cancelButton){a.push({xtype:"container",layout:{type:"vbox",align:"center"},items:[this.cancelButton,this.closeButton],style:{padding:5}})
}c=Ext.applyIf(c||{},{layout:{type:"vbox",align:"stretch"},items:a,border:false,bodyStyle:{"background-color":__color_WindowFrame},style:{"background-color":__color_WindowFrame},listeners:{scope:this,afterrender:function(){this.configTimer={run:this.onTimer,interval:3000,scope:this};
Ext.TaskManager.start(this.configTimer)
},destroy:function(){Ext.TaskManager.stop(this.configTimer)
}}});
this.callParent([c]);
window.__sqlBatch=this;
if(c.autoCreateWindow){this.win=new Ext.Window({layout:"fit",title:this.findLangS("title","updateTablesSchema"),iconCls:"icon_wrench",width:Ext.dom.Element.getViewportWidth()-80,height:Ext.dom.Element.getViewportHeight()-80,items:this,border:false,modal:true,closable:false,resizable:false,listeners:{close:function(){if(c.onCloseWindow){c.onCloseWindow()
}}}});
this.win.show()
}},loadData:function(b,a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"loadSqlBatch",params:Ext.encode({type:modifySqlSchema_type(),enableRunSql:user_is_admin()&&b})},success:function(c){this._loadData(c.sqlBatch);
if(c.sqlBatchComplete){if(user_is_admin()){this.cancelButton.hide();
this.closeButton.show();
var d=this.findC("_id","header_text");
if(d){d.setValue(this.findLangS("text","databaseMaintenanceIsComplete"));
d.setFieldStyle({color:"blue"})
}Ext.defer(function(){if(this.win&&this.win.close){this.win.close()
}},15000,this)
}else{this.win.close()
}}},maskEl:a?this:undefined})
},_loadData:function(c,a){if(!a){a=this.grid.store
}a.removeAll();
if(c&&c.length){for(var b=0;
b<c.length;
b++){a.add(c[b])
}}},onTimer:function(){this.loadData(true,false)
},cancelSqlBatch:function(a){if(a){Ext.Msg.confirm("",this.findLangS("text","confirmCancelBatchSql"),function(b){if(b=="yes"){this.cancelSqlBatch()
}},this);
return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"cancelSqlBatch",params:Ext.encode({type:modifySqlSchema_type()})},success:function(b){this.win.close()
}})
}});
function showSqlBatch(a,b){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"loadSqlBatch",params:Ext.encode({type:modifySqlSchema_type()})},success:function(c){if(c.sqlBatch&&!c.sqlBatchComplete){new Tools.sqlBatch({data:c.sqlBatch,autoCreateWindow:true,onCloseWindow:function(){if(a&&a.length){window[a[0]](a.splice(1))
}else{if(b){b()
}}}});
return
}else{if(a&&a.length){window[a[0]](a.splice(1))
}}}})
}function modifySqlSchema_type(){return("modify_sql_schema")
}function generateDebugLog(){var c=dateTime().getTime();
var b=new Ext.form.FormPanel({defaults:{xtype:"textfield",width:__width_FormChar(10,50),labelWidth:__width_FieldChar(10)},items:[{xtype:"textarea",name:"notes",fieldLabel:findLangS("tools","field","notes")},{name:"email",fieldLabel:findLangS("tools","field","email")},{xtype:"displayfield",value:findLangS("tools","text","generateDebugLogInfo")}],buttons:{items:[{text:lang.sendButtonText,handler:function(){d()
}},{text:lang.cancelButtonText,handler:function(){b.ownerCt.close()
}}],style:{"background-color":__color_WindowFrame,marginTop:0}},bodyStyle:{"background-color":__color_WindowFrame},border:false});
var k=new Ext.Window({title:findLangS("tools","title","generateDebugLog"),iconCls:"icon_wrench",items:b,autoWidth:true,autoHeight:true,border:false,modal:true,listeners:{afterrender:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"testExistsSensorsCommand",params:Ext.encode({command:"get_sensor_information"})},success:function(m){if(m.sensorsWithoutCommand){Ext.Msg.confirm("",findLangS("tools","text","upgradeSensorsQuestionBeforeUpgradingSqlSchema"),function(n){if(n=="yes"){Settings.Utils.upgradeSensors({sensors:m.sensorsWithoutCommand})
}},this)
}},maskEl:k})
}}});
var f;
var h;
k.show();
function d(){if(!b.getForm().isValid()){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"testExistsSensorsCommand",params:Ext.encode({command:"get_sensor_information"})},success:function(m){if(m.sensorsWithoutCommand){Ext.Msg.confirm("",findLangS("tools","text","upgradeSensorsQuestionBeforeUpgradingSqlSchema"),function(n){if(n=="yes"){Settings.Utils.upgradeSensors({sensors:m.sensorsWithoutCommand,okIfAllSuccess:true,onOk:function(q,o,p){p.close();
a()
}})
}},this)
}else{a()
}},maskEl:k})
}function a(){var m=b.getForm().getFieldValues();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"generateDebugLog",params:Ext.encode({params:m,id:c})},success:function(n){f._win.close();
g(n.link,n.hash)
},errorFailure2:function(){f._win.close()
},timeout:30*60*1000});
f=l()
}function g(o,p){var m=o+"?hash="+p;
msg='<div style="font: '+__font_Grid+'; font-size: 120%;">'+findLangS("tools","text","generateDebugLogLinkInfo")+"</div>";
msg+='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100">';
msg+='<tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+m+'" target="_blank">'+m+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr>";
msg+="</table>";
var n=400+6+100+6+30;
Ext.Msg.show({title:findLangS("tools","title","generateDebugLog"),msg:msg,buttons:Ext.Msg.OK,minWidth:n,width:n,fn:function(){var q=Ext.getCmp("copy_button");
if(q){q.destroy()
}k.close()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(q){return(q.clipboardText)
},getClipTextParams:{clipboardText:m},id:"copy_button",renderTo:"copy_button_div"})
}function l(){var n=new Ext.Panel({layout:{type:"vbox",align:"center"},items:[{xtype:"displayfield",value:"Loading ...",width:300,height:50,style:{margin:"4px","margin-top":"0px"},fieldStyle:{"font-size":11},_id:"waitText"},{xtype:"progressbar",width:300,_id:"progressbar",hidden:true,style:{"margin-bottom":"8px"}},{xtype:"button",text:"stop load",iconCls:"icon_cancel",style:{"border-style":"solid","border-color":"#BBBBBB","background-color":"#F8F8F8",padding:"2px !important"},handler:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"generateDebugLog",params:Ext.encode({task:"stop",tar:h})},success:function(o){n._win.close()
},errorFailure:function(){}})
},disabled:true,_id:"stop"}],border:false,bodyStyle:{"background-color":__color_WindowFrame},configTimer:{run:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"generateDebugLog",params:Ext.encode({task:"get_process_info",id:c})},success:function(o){if(!o.data){return
}h=o.data.tar;
var r=n.findC("_id","stop");
if(r){r.enable()
}var s=n.findC("_id","waitText");
var p=n.findC("_id","progressbar");
if(o.data.type_info=="upload_perc"){s.setValue("Uploading ... ");
s.setHeight(23);
p.show();
p.updateProgress(o.data.type_info_2/100)
}else{var q="sensor id "+(o.data.sensor_id>0?o.data.sensor_id:"local");
if(o.data.type_info){q+=", "+o.data.type_info
}if(o.data.type_info_2){q+=", "+o.data.type_info_2
}s.setValue("Loading ... "+q+" ...")
}},errorFailure:function(){}})
},interval:350,scope:this}});
var m=new Ext.Window({layout:"fit",items:n,autoWidth:true,autoHeight:true,border:false,modal:true,closable:false,draggable:false,header:false,listeners:{afterrender:function(){Ext.TaskManager.start(n.configTimer)
},close:function(){Ext.TaskManager.stop(n.configTimer)
}}});
m.show();
n._win=m;
return(n)
}}Ext.ns("Tools");
function rtpStreamAnalysis(a){var c={task:"prepare",cdr_id:a.cdr_id,ssrc:a.ssrc*1,ip_src:a.ip_src,ip_dst:a.ip_dst,port_src:a.port_src,port_dst:a.port_dst,stream_index:a.stream_index,timestamp_id:"tsid_"+(new Date).getTime()};
var b=a.maskEl||activePanel;
if(!b&&document.id&&Ext.get(document.id)&&Ext.get(document.id).down&&Ext.get(document.id).down(".x-panel")){b=Ext.getCmp(Ext.get(document.id).down(".x-panel").id)
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode(c)},success:function(d){var g=new Tools.RtpStreamAnalysis({rsa_data:d.rsa_data,rsa_data_total:d.rsa_data_total,rsa_data_pages:d.rsa_data_pages,rsa_data_page_length:d.rsa_data_page_length,rsa_data_time_array:d.rsa_data_time_array,rsa_data_big_transit_array:d.rsa_data_big_transit_array,params:c});
var f=new Tools.RtpStreamAnalysis.Tabs({items:[g],params:{cdr_id:a.cdr_id},autoCreateWindow:true})
},maskEl:b})
}Ext.define("Tools.RtpStreamAnalysis",{extend:"Ext.Panel",subsystem:"rtpStreamAnalysis",constructor:function(b){window.RtpStreamAnalysis=this;
var m=this;
var q=user_can_play_audio()?true:false;
this.fields=[{name:"id",type:"integer"},{name:"counter",type:"integer",header:"packet"},{name:"time_real",type:"integer",header:"time [s]",unit:"us",units:"s",dec:3},{name:"time_rtp",type:"integer",header:"rtp ts [s]",unit:"us",units:"s",dec:3},{name:"seq",type:"integer",header:"seq",rendererBackground:n},{name:"delta_real",type:"integer",header:"delta [ms]",unit:"us",units:"ms",dec:1,chart:{minimum:0}},{name:"delta_rtp",type:"integer",unit:"us",units:"ms",dec:1},{name:"transit",type:"integer",header:"transit [ms]",unit:"us",units:"ms",dec:1,rendererBackground:p,chart:{minimum:0}},{name:"skew",type:"integer",header:"skew [ms]",unit:"us",units:"ms",dec:1,chart:{minimum:0}},{name:"jitter",type:"float",header:"jitter",dec:1,chart:{minimum:0}},{name:"jitter_rsa",type:"float",dec:1},{name:"marker",type:"integer",header:"marker",align:"center",tick:true,width:__width_ColumnNum(6)},{name:"bad_seq",type:"integer",header:"bad seq",align:"center",tick:true,width:__width_ColumnNum(6)},{name:"mos_f1",type:"string",header:"mos 50",unit:"mos10",dec:1,chart:{minimum:0}},{name:"mos_f2",type:"string",header:"mos 200",unit:"mos10",dec:1,chart:{minimum:0}},{name:"mos_adapt",type:"string",header:"mos adapt",unit:"mos10",dec:1,chart:{minimum:0}},{name:"mos_silence",type:"string",header:"mos silence",unit:"mos10",dec:1,chart:{minimum:0}},{name:"payload_len",type:"integer",header:"payload len"},{name:"codec",type:"integer",header:"codec",typeColumn:"codec"},{name:"energylevel",type:"integer",header:"energylevel",chart:{minimum:0}}];
var k=[];
for(var g=0;
g<this.fields.length;
g++){if(this.fields[g].chart){k.push([this.fields[g].name,this.findLangS("column",this.fields[g].header)])
}}function n(v,c,s,w,u,t,r){if(s.data.bad_seq){return("#FF6060")
}}function p(y,B,r,t,s,z,u){var w=[[200,"#FF7D7D"],[100,"#DA8EFF"],[50,"#FFCC73"]];
var A=Math.abs(y);
for(var c=0;
c<w.length;
c++){if(A>=w[c][0]*1000){return(w[c][1])
}}}this.store_grid=new Ext.data.ArrayStore({fields:this.fields,data:b.rsa_data});
var f=["counter","time_real","time_rtp","seq","delta_real","transit","skew","jitter","marker","bad_seq","payload_len","codec","mos_f1","mos_f2","mos_adapt","mos_silence","energylevel"];
this.grid_columns=[];
for(var l=0;
l<f.length;
l++){for(var g=0;
g<this.fields.length;
g++){if(f[l]==this.fields[g].name&&this.fields[g].header){var d={dataIndex:this.fields[g].name,header:this.findLangS("column",this.fields[g].header)||this.fields[g].header,align:this.fields[g].align||"right",width:this.fields[g].width||__width_ColumnNum(9),rendererBackground:this.fields[g].rendererBackground,renderer:function(y,A,t,v,u,z,w){var s=w&&w.ownerCt&&w.ownerCt.getHeaderContainer?w.ownerCt.getHeaderContainer().getHeaderAtIndex(u):null;
if(s){if(s.rendererBackground){var c=s.rendererBackground(y,A,t,v,u,z,w);
if(c){A.style="background-color: "+c
}}var r=m.getValueConfiguration(s.dataIndex);
if(r.tick){if(y){var c=s.dataIndex=="marker"?"#60FF60":s.dataIndex=="bad_seq"?"#FF6060":"white";
A.style="background-color: "+c+"; padding-bottom: 1px;";
return('<img src="images/tick_small_black.png">')
}}else{return(m.renderValue(y,s.dataIndex,false))
}}},columnTip:this.findLangS("columnTip",this.fields[g].header)};
if(this.fields[g].name=="counter"){Ext.apply(d,{xtype:"actioncolumn",rendererBase:d.renderer,items:[{getClass:function(c,r,s){return("icon_magnifier")
},handler:function(r,v,c,s,t){var u=r.store.getAt(v);
this.addPacketDetail(u)
},scope:this}],iconDivStyle:"float:left; height: 15; width: 15;",baseContentDivStyle:"padding-left: 20"});
delete d.renderer
}switch(this.fields[g].typeColumn){case"codec":Ext.apply(d,{renderer:renderArrayData,arrayData:arCodec,arrayDataRsltIndex:2});
break
}this.grid_columns.push(d)
}}}this.directUpdateCharts=false;
var o={xtype:"checkbox",checked:this.directUpdateCharts,boxLabel:this.findLangS("field","directUpdateCharts"),height:22,style:{paddingRight:4},listeners:{scope:this,change:function(c){this.directUpdateCharts=c.getValue()
}}};
this.bbarContainer=new Ext.Container({layout:"hbox",items:[]});
var a=[];
this._find_field="transit";
this._find_operator=">=";
this._find_value=50;
a.push(this.findLangS("text","findNext")+":",{xtype:"ComboBoxA",aData:k,value:this._find_field,width:__width_FieldChar(10)+__width_Trigger,listeners:{select:function(c){this._find_field=c.getValue()
},scope:this},style:{marginBottom:"0px !important"},fieldStyle:{height:"17 !important","min-height":"17 !important"}},{xtype:"ComboBoxA",aData:[[">",">"],[">=",">="],["<","<"],["<=","<="]],value:this._find_operator,width:__width_FieldChar(3)+__width_Trigger,listeners:{select:function(c){this._find_operator=c.getValue()
},scope:this},style:{marginBottom:"0px !important"},fieldStyle:{height:"17 !important","min-height":"17 !important"}},{xtype:"textfield",width:__width_FieldNum(4)+__width_Trigger,value:this._find_value,triggers:{search:{cls:"x-form-search-trigger",handler:function(c){this._find_value=c.getValue();
this.findNextValue()
},scope:this}},listeners:{afterrender:function(c){c.on("specialkey",function(s,r){if(r.getKey()==r.ENTER){this._find_value=s.getValue();
this.findNextValue()
}},this)
},scope:this},style:{marginBottom:"0px !important"},fieldStyle:{height:"17 !important","min-height":"17 !important","text-align":"right"}});
a.push(this.bbarContainer,Ext.dom.Element.getViewportWidth()>1400?{xtype:"container",width:4}:"->",o);
if(b.rsa_data_pages>1){this.grid_paging=new Ext.toolbar.Paging({currentPage:1,pageCount:b.rsa_data_pages,update:function(){if(this.pageCount>1){this.show()
}else{this.hide()
}this.setChildDisabled("#first",this.currentPage==1||this.pageCount<=1);
this.setChildDisabled("#prev",this.currentPage==1||this.pageCount<=1);
this.setChildDisabled("#next",this.currentPage==this.pageCount||this.pageCount<=1);
this.setChildDisabled("#last",this.currentPage==this.pageCount||this.pageCount<=1);
this.child("#afterTextItem").setText(this.currentPage+" of "+this.pageCount)
},moveFirst:function(){if(this.pageCount){this.currentPage=1
}this.update();
m.loadActivePage()
},movePrevious:function(){if(this.pageCount&&this.currentPage>1){--this.currentPage
}this.update();
m.loadActivePage()
},moveNext:function(){if(this.pageCount&&this.currentPage<this.pageCount){++this.currentPage
}this.update();
m.loadActivePage()
},moveLast:function(){if(this.pageCount){this.currentPage=this.pageCount
}this.update();
m.loadActivePage()
},items:a})
}this.grid=new Ext.grid.GridPanel({store:this.store_grid,columns:{items:this.grid_columns,defaults:{sortable:false}},flex:1,border:true,bbar:this.grid_paging?this.grid_paging:a,listeners:{scope:this,afterrender:function(){if(this.grid_paging){this.grid_paging.items.get(11).hide();
this.grid_paging.items.get(10).hide();
this.grid_paging.child("#inputItem").hide();
this.grid_paging.update()
}}},viewConfig:{enableTextSelection:true,listeners:{render:function(c){c.tip=Ext.create("Ext.tip.ToolTip",{target:c.el,delegate:c.cellSelector,trackMouse:true,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,listeners:{beforeshow:function r(y){var w=c.getHeaderByCell(y.triggerElement);
var z=Ext.fly(y.triggerElement).up(".x-grid-row");
if(z){var s=c.getRecord(z);
var t=w.config.columnTip;
if(t){var u=getSizeHtml(t,false,{"white-space":"nowrap",font:__font_Grid});
var v=(u[0]>250?250:u[0])+10;
y.update('<div style="padding-left: 5; padding-right: 5; width: '+v+'; word-wrap: break-word; white-space: normal;">'+t+"</div>");
return
}}y.update(null)
}}})
}}}});
this.maxCharts=4;
this.chartType=["delta_real","skew","jitter"];
while(this.chartType.length<this.maxCharts){this.chartType.push(null)
}this.chartColor=["#26D050","red","blue"];
while(this.chartColor.length<this.maxCharts){this.chartColor.push(null)
}this.chartEnable=[true,true,true];
while(this.chartEnable.length<this.maxCharts){this.chartEnable.push(null)
}this.chartTypeCombo=[];
this.chartColorCombo=[];
this.chartEnableCheckBox=[];
var h=[];
for(var g=0;
g<this.maxCharts;
g++){h.push({xtype:"displayfield",value:(g+1)+":",style:{marginRight:2}});
this.chartTypeCombo[g]=new Ext.ux.combobox.ComboBoxA({_i:g,value:this.chartType[g],aData:k,width:__width_FieldChar(15)+__width_Trigger,listeners:{scope:this,select:function(c){this.chartType[c._i]=c.getValue();
this.createGridChart();
if(this.chart){this.createChart()
}}},style:{marginRight:2},_clearButton:true});
h.push(this.chartTypeCombo[g]);
this.chartColorCombo[g]=new Ext.ux.colorpicker.ColorPickerField({_i:g,value:this.chartColor[g],width:__width_FieldChar(9)+__width_Trigger,listeners:{scope:this,select:function(c){this.chartColor[c._i]=c.getValue();
this.createGridChart();
if(this.chart){this.createChart()
}}},style:{marginRight:2},_color:true});
h.push(this.chartColorCombo[g]);
this.chartEnableCheckBox[g]=new Ext.form.field.Checkbox({_i:g,checked:this.chartEnable[g],width:__width_FieldChar(4),listeners:{scope:this,change:function(c){this.chartEnable[c._i]=c.getValue();
this.createGridChart();
if(this.chart){this.createChart()
}}}});
h.push(this.chartEnableCheckBox[g])
}if(q){h.push({xtype:"container",flex:Ext.dom.Element.getViewportWidth()>1400?undefined:1,width:Ext.dom.Element.getViewportWidth()>1400?10:undefined},{xtype:"button",iconCls:"icon_menu_audio_voices",text:this.findLangS("button","createAudio"),handler:function(){this.createAudioFile(true)
},scope:this,_btn:"createAudio"})
}this.chartSelectTypePanel=new Ext.Container({layout:"hbox",items:h,height:24});
this.gridChartContainer=new Ext.Panel({layout:"fit",height:125,border:false});
this.gridChartPanel=new Ext.Panel({layout:{type:"vbox",align:"stretch"},border:true,items:[{xtype:"container",layout:{type:"vbox",align:"center"},items:{xtype:"displayfield_h16",value:this.findLangS("title","zoom_chart"),style:{marginTop:-3,marginBottom:-2,marginLeft:3},fieldStyle:{"font-size":"90%",color:"grey"},_id:"title_grid_chart"}},this.gridChartContainer],style:{marginBottom:2}});
this.chartContainer=new Ext.Panel({layout:"fit",height:125,border:false});
this.chartPanel=new Ext.Panel({layout:{type:"vbox",align:"stretch"},border:true,items:[{xtype:"container",layout:{type:"vbox",align:"center"},items:{xtype:"displayfield_h16",value:this.findLangS("title","chart"),style:{marginTop:-3,marginBottom:-2,marginLeft:3},fieldStyle:{"font-size":"90%",color:"grey"},_id:"title_chart"}},this.chartContainer],style:{marginBottom:2}});
this.audioContainer=new Ext.Panel({layout:"fit",border:false});
this.audioPanel=new Ext.Panel({layout:{type:"vbox",align:"stretch"},border:true,items:[this.audioContainer],style:{marginBottom:2},hidden:true});
Ext.applyIf(b,{layout:{type:"vbox",align:"stretch"},items:[this.chartSelectTypePanel,this.chartPanel,this.gridChartPanel,this.audioPanel,this.grid],border:false,style:{"background-color":__color_WindowFrame,padding:0},bodyStyle:{"background-color":__color_WindowFrame},view:{listeners:{scope:this,scroll:this.onScrollDefer}},listeners:{scope:this,afterrender:this.onAfterRender}});
if(!b.autoCreateWindow){Ext.applyIf(b,{title:this.getTitleText(b.params)});
b.style.padding=4
}else{Ext.applyIf(b,{width:Ext.dom.Element.getViewportWidth()*9/10,height:Ext.dom.Element.getViewportHeight()*9/10})
}this.callParent([b]);
this.grid.selModel.on("selectionchange",this.onSelectionChange,this);
this.syncDuringPlay=false;
if(b.autoCreateWindow){this.win=new Ext.Window({title:this.findLangS("title","rtpStreamAnalysis")+" : "+this.getTitleText(b.params),iconCls:undefined,layout:"fit",items:this,border:false,listeners:{scope:this,activate:this.onActivateWindow,beforeclose:this.onBeforeCloseWindow,close:this.onCloseWindow},wikiId:"Call_Detail_Record_-_CDR#RtpStreamAnalysis"});
this.win.show()
}},onAfterRender:function(){for(var a=0;
a<this.maxCharts;
a++){this.chartColorCombo[a].setValue(this.chartColorCombo[a].getValue())
}this.grid.getView().on("scroll",this.onScrollDefer,this);
if(this.callOnReadyAfterRender){this.onReady()
}},onActivateWindow:function(){if(!this._firstActivated){Ext.defer(this.onReady,100,this);
this._firstActivated=true
}},onCloseWindow:function(){this.onBeforeDestroy()
},onBeforeCloseWindow:function(){this.closeAllWindows()
},onReady:function(){if(!this.getGridRows()){Ext.defer(this.onReady,100,this);
return
}if(this.config.rsa_data_total>this.getChartWidth()){Ext.defer(function(){this.createGridChart(0);
this.createChart();
this.onScrollDefer()
},250,this)
}else{this.chartPanel.hide();
this.findC("_id","title_grid_chart").setValue(this.findLangS("title","one_chart"));
Ext.defer(function(){this.createGridChart(0);
this.onScrollDefer()
},250,this)
}},loadActivePage:function(){if(!this.grid_paging){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"load_page",page:this.grid_paging.currentPage,timestamp_id:this.params.timestamp_id})},success:function(a){if(a.rsa_data){this.store_grid.removeAll();
this.store_grid.add(a.rsa_data);
this.setGridChartData(0,true);
this.setGridChartIndication(0);
this.setChartIndication(0);
this.onScroll()
}},maskEl:this})
},setPage:function(c,d,a,b){if(!this.grid_paging){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"load_page",page:c,timestamp_id:this.params.timestamp_id})},success:function(f){if(f.rsa_data){this.store_grid.removeAll();
this.store_grid.add(f.rsa_data);
this.setGridChartData(0,true);
this.setPosition(d,a,b);
this.grid_paging.currentPage=c;
this.grid_paging.update()
}},maskEl:this})
},onScroll:function(){var f=this.grid.selModel.getSelection();
if(f.length){var b=this.getTopBottomRowInGrid();
var a=this.store_grid.indexOf(f[0]);
if(a>=b[0]&&a<=b[1]){this.setGridChartData(a);
this.setChartIndication(a);
if(this.chunkPlayer){this.setChunkPlayerPosition(a)
}return
}}var d=this.grid.getView().getEl().dom.scrollHeight-this.grid.getView().getEl().dom.clientHeight;
if(d){var c=this.grid.getView().getScrollY()/d*(this.store_grid.getCount()-this.getGridRows())+this.getGridRows()/2;
if(c>=this.store_grid.getCount()){c=this.store_grid.getCount()-1
}c=Math.max(parseInt(c),0)
}else{var c=0
}this.setGridChartData(c);
this.setChartIndication(c);
if(this.chunkPlayer){this.setChunkPlayerPosition(c)
}},onScrollDefer:function(){if(this.directUpdateCharts){this.onScroll();
return
}if(this._onScroll_timeoutId){clearTimeout(this._onScroll_timeoutId);
delete this._onScroll_timeoutId
}this._onScroll_timeoutId=setTimeout(Ext.bind(this.onScroll,this),100)
},onSelectionChange:function(a){if(this.store_grid.getCount()){this.onScroll()
}},setPosition:function(b,a,d){if(b>=this.store_grid.getAt(0).data.id&&b<=this.store_grid.getAt(this.store_grid.getCount()-1).data.id){var h=-1;
var k=-1;
for(var f=0;
f<this.store_grid.getCount();
f++){var g=Math.abs(a-this.store_grid.getAt(f).data.counter);
if(h<0||g<k){k=g;
h=f
}}if(h>=0){var l=this.grid.getView().getEl().dom.scrollHeight-this.grid.getView().getEl().dom.clientHeight;
var c=(h-this.getGridRows()/2)/(this.store_grid.getCount()-this.getGridRows())*l;
if(c<0){c=0
}if(c>l){c=l
}this._setPosition_source=d;
this.grid.getView().setScrollY(c);
this.grid.selModel.select(this.store_grid.getAt(h));
if(this.chunkPlayer){this.setChunkPlayerPosition(h)
}}}else{this.setPage(Math.ceil(b/this.config.rsa_data_page_length),b,a,d)
}},setPositionByTime:function(h,d){var b=h*1000000;
var f=-1;
var a=-1;
for(var c=0;
c<this.rsa_data_time_array.length;
c++){var g=Math.abs(b-this.rsa_data_time_array[c]);
if(f<0||g<a){a=g;
f=c
}}if(f>=0){this.setPosition(f+1,f+1,d)
}},setChunkPlayerPosition:function(a){if(!this.store_grid.getAt(a)){return
}this._disableChunkPlayer_evGotoTime=true;
this._disableChunkPlayer_evPlayTime=true;
this.chunkPlayer.gotoTime(this.store_grid.getAt(a).data.time_real/1000000);
this.chunkPlayer.setPlayPosition();
Ext.defer(function(){delete this._disableChunkPlayer_evGotoTime;
delete this._disableChunkPlayer_evPlayTime
},100,this)
},createGridChart:function(g){var k=this;
var d=null;
if(this.store_grid_chart){this.store_grid_chart.removeAll();
this.store_grid_chart.destroy();
delete this.store_grid_chart
}if(this.grid_chart){if(!Ext.isDefined(g)){g=this.grid_chart._selectedIndexRow;
d=this.grid_chart._limitValue
}this.grid_chart.destroy();
delete this.grid_chart
}this.gridChartContainer.removeAll();
this.store_grid_chart=new Ext.data.ArrayStore({fields:this.fields,data:[],storeId:"id"});
var n=this.fillStoreGridChart(g);
var h=[];
var l=[];
for(var c=0;
c<this.chartType.length;
c++){if(this.chartType[c]&&this.chartEnable[c]){h.push(this.chartType[c]);
l.push(this.chartColor[c])
}}var a=["marker","bad_seq"];
var f=[{type:"numeric",position:"bottom",fields:"id",minimum:0,majorTickSteps:20,minorTickSteps:1,minimum:Math.max(this.store_grid_chart.getAt(0).data.id-1,0),renderer:function(q,p,o,s){var r=k.store_grid_chart.getById(Math.round(p))||k.store_grid_chart.getById(Math.floor(p))||k.store_grid_chart.getById(Math.floor(p)+1);
if(r&&r.data){return(r.data.counter)
}return("")
},limits:[{value:Ext.isEmpty(d)?-1:d,line:{strokeStyle:"red",lineWidth:2,lineDash:[2,1]}}]}];
for(var c=0;
c<h.length;
c++){f.push({type:"numeric",position:"left",fields:h[c],grid:true,minimum:this.getMinimumForChartSeries(h[c],this.store_grid_chart),_chartType:h[c],renderer:function(q,p,o,s){var r=p;
if(r){return(k.renderValue(r,q._chartType,true))
}return("")
},title:{color:l[c],text:this.findLangS("column",this.getValueConfiguration(h[c]).header)},label:{fill:l[c]},style:{strokeStyle:l[c]}})
}f.push({type:"numeric",position:"right",minimum:0,maximum:30,majorTickSteps:1,minorTickSteps:0,renderer:function(q,p,o,r){return("")
},fields:a});
var b=[];
for(var c=0;
c<h.length;
c++){var m={type:"line",xField:"id",yField:h[c],highlight:false,color:l[c],renderer:function(q,p,r,o){q.attr.canvasAttributes.strokeStyle=this.color;
q.attr.canvasAttributes.strokeOpacity=0.6
}};
if(c==0){m.tips={renderer:function(t,r,q){if(!r||!r.data){return
}var s='<table style="font-size: 11;"><tr><td>packet&nbsp;&nbsp;&nbsp;<td>'+r.data.counter+"<tr><td>time<td>"+k.renderValue(r.data.time_real,"time_real",true)+"<tr><td>seq<td>"+r.data.seq;
for(var p=0;
p<h.length;
p++){s+="<tr><td>"+k.findLangS("column",k.getValueConfiguration(h[p]).header)+'&nbsp;&nbsp;&nbsp;<td style="color: '+l[p]+';">'+k.renderValue(r.data[h[p]],h[p],true)
}s+='<tr><td colspan=2 style="font-size: 11; font-style:italic;">click to go</table>';
var o=getSizeHtml(s);
t.setWidth(o[0]+10);
t.setHeight(o[1]+5);
t.setTitle(s)
}}
}b.push(m)
}b.push({type:"scatter",xField:"id",yField:"marker",marker:{type:"triangle",size:3,radius:3,stroke:"black"},style:{fill:"black",stroke:"black"},renderer:function(q,p,r,o){return(r.store.getAt(o).data.marker?{size:3,radius:3}:{size:0,radius:0})
},highlight:false,axis:"right"},{type:"scatter",xField:"id",yField:"bad_seq",marker:{type:"triangle",size:3,radius:3,stroke:"red"},style:{fill:"red",stroke:"red"},renderer:function(q,p,r,o){return(r.store.getAt(o).data.bad_seq?{size:3,radius:3}:{size:0,radius:0})
},highlight:false,axis:"right"});
this.grid_chart=new Ext.chart.CartesianChart({xtype:"cartesian",store:this.store_grid_chart,shadow:false,animation:false,border:false,axes:f,series:b,height:this.gridChartContainer.getHeight()-20,style:{paddingTop:15},plugins:{ptype:"chartitemevents",handleEvent:function(u){if(u.type=="click"||u.type=="mousemove"){var q=k.grid_chart;
var t=q.getEventXY(u);
var s=q.axes[0].sprites[0].attr.length;
if(t[0]>=0&&t[0]<=s){var o=Math.min(parseInt(t[0]/s*q.store.getCount()),q.store.getCount()-1);
if(u.type=="click"){k.setPosition(q.store.getAt(o).data.id,q.store.getAt(o).data.counter,"grid_chart")
}else{var p=q.store.getAt(o);
var r={category:"markers",index:o,record:p,series:q.series[0],sprites:q.series[0].sprites,sprite:q.series[0].sprites[0]};
q.series[0].showTooltip(r,u)
}q.el.dom.style.cursor="pointer"
}else{q.el.dom.style.cursor="default"
}}else{if(u.type=="mouseout"){k.grid_chart.series[0].getTooltip().hide()
}}}},theme:"RtpStreamAnalysis",style:{paddingTop:0,paddingBottom:0,marginTop:0,marginBottom:0},insetPadding:{top:6,bottom:0,left:2,right:2},_selectedIndexRow:g,_firstLastIndexRow:n});
this.gridChartContainer.add(this.grid_chart);
if(Ext.isEmpty(d)){this.setGridChartIndication(g,true)
}else{this.grid_chart._limitValue=d
}},fillStoreGridChart:function(c){var a=this.getChartRowRange(c);
this.store_grid_chart.removeAll();
for(var b=a[0];
b<=a[1];
b++){this.store_grid_chart.add(this.store_grid.getAt(b).data)
}return(a)
},createChart:function(b){var v=this;
var d=[];
var s=[];
for(var p=0;
p<this.chartType.length;
p++){if(this.chartType[p]&&this.chartEnable[p]){d.push(this.chartType[p]);
s.push(this.chartColor[p])
}}if(!b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"chart_data",chart_type:d,chart_length:this.getChartWidth(),timestamp_id:this.params.timestamp_id})},success:function(w){this.createChart(w.chart_data)
},maskEl:this.chartPanel});
return
}var f=0;
if(this.store_chart){this.store_chart.removeAll();
this.store_chart.destroy();
delete this.store_chart
}if(this.chart){var f=this.grid_chart._selectedIndexRow;
this.chart.destroy();
delete this.chart
}var a=["marker","bad_seq"];
var k=[{name:"id",type:"integer"},{name:"counter",type:"integer"},{name:"seq",type:"integer"},{name:"time",type:"integer"}];
for(var p=0;
p<d.length;
p++){k.push({name:d[p]+"_min",type:"float"},{name:d[p]+"_max",type:"float"},{name:d[p]+"_min_orig",type:"float"},{name:d[p]+"_max_orig",type:"float"})
}for(var p=0;
p<a.length;
p++){k.push({name:a[p],type:"integer"})
}this.store_chart=new Ext.data.ArrayStore({fields:k,data:[],storeId:"id"});
var h=[];
var l=[];
var q=[];
for(var p=0;
p<d.length;
p++){var u=this.getChartConfiguration(d[p]);
h.push(u&&Ext.isDefined(u.minimum)?u.minimum:null);
l.push(null);
for(var m=0;
m<b.length;
m++){if(!Ext.isEmpty(b[m][d[p]]["i"])&&(Ext.isEmpty(h[p])||b[m][d[p]]["i"]*1<h[p])){h[p]=b[m][d[p]]["i"]*1
}if(!Ext.isEmpty(b[m][d[p]]["m"])&&(Ext.isEmpty(l[p])||b[m][d[p]]["m"]*1>l[p])){l[p]=b[m][d[p]]["m"]*1
}}q.push(h[p]<0?getNumericAxisConfig(-h[p],5,0).max:0)
}for(var p=0;
p<b.length;
p++){var t={id:p+1,counter:b[p]["_c"],seq:b[p]["_s"],time:b[p]["_t"]};
for(var m=0;
m<d.length;
m++){t[d[m]+"_min"]=b[p][d[m]]["i"]*1+q[m];
t[d[m]+"_max"]=b[p][d[m]]["m"]*1-b[p][d[m]]["i"]*1+(l[m]-h[m])/50;
t[d[m]+"_min_orig"]=b[p][d[m]]["i"];
t[d[m]+"_max_orig"]=b[p][d[m]]["m"]
}for(var m=0;
m<a.length;
m++){t[a[m]]=b[p][a[m]]
}this.store_chart.add(t)
}var c=[];
for(var p=0;
p<d.length;
p++){c[p]=[];
c[p].push(d[p]+"_min",d[p]+"_max")
}var n=[];
for(var p=0;
p<a.length;
p++){n.push(a[p])
}var o=[{type:"numeric",position:"bottom",fields:"id",minimum:0,majorTickSteps:20,minorTickSteps:1,renderer:function(z,y,w,B){var A=v.store_chart.getById(Math.round(y))||v.store_chart.getById(Math.floor(y))||v.store_chart.getById(Math.floor(y)+1);
if(A&&A.data){return(A.data.counter)
}return("")
},limits:[{value:-1}]}];
for(var p=0;
p<d.length;
p++){o.push({type:"numeric",position:"left",fields:c[p],grid:true,minimum:this.getMinimumForChartSeries(d[p],this.store_chart),_shift:q[p],_chartType:d[p],renderer:function(z,y,w,B){var A=y-z._shift;
if(A){return(v.renderValue(A,z._chartType,true))
}return("")
},title:{color:s[p],text:this.findLangS("column",this.getValueConfiguration(d[p]).header)},label:{fill:s[p]},style:{strokeStyle:s[p]}})
}o.push({type:"numeric",position:"right",minimum:0,maximum:30,majorTickSteps:1,minorTickSteps:0,renderer:function(z,y,w,A){return("")
},fields:n});
var g=[];
for(var p=0;
p<d.length;
p++){var r={type:"area",xField:"id",yField:c[p],highlight:false,colors:["-",s[p]],stacked:true,shift:q[0],renderer:function(A,z,B,y){var C=this._yField.indexOf(A._field);
var w=this._colors[C];
if(w=="-"){A.attr.canvasAttributes.fillStyle="white";
A.attr.canvasAttributes.fillOpacity=0
}else{A.attr.canvasAttributes.fillOpacity=0.3
}A.attr.canvasAttributes.strokeStyle=this._colors[1];
A.attr.canvasAttributes.strokeOpacity=0.6
}};
if(p==0){r.tips={renderer:function(C,A,z){if(!A||!A.data){return
}var B='<table style="font-size: 11;"><tr><td>packet&nbsp;&nbsp;&nbsp;<td>'+A.data.counter+"<tr><td>time<td>"+v.renderValue(A.data.time,"time_real",true)+"<tr><td>seq<td>"+A.data.seq;
for(var y=0;
y<d.length;
y++){B+="<tr><td>"+v.findLangS("column",v.getValueConfiguration(d[y]).header)+'&nbsp;&nbsp;&nbsp;<td style="color: '+s[y]+';">'+v.renderValue(A.data[d[y]+"_min_orig"],d[y],true)+" - "+v.renderValue(A.data[d[y]+"_max_orig"],d[y],true)
}B+='<tr><td colspan=2 style="font-size: 11; font-style:italic;">click to go</table>';
var w=getSizeHtml(B);
C.setWidth(w[0]+10);
C.setHeight(w[1]+5);
C.setTitle(B)
}}
}g.push(r)
}g.push({type:"scatter",xField:"id",yField:"marker",marker:{type:"triangle",size:3,radius:3,stroke:"black"},style:{fill:"black",stroke:"black"},renderer:function(z,y,A,w){return(A.store.getAt(w).data.marker?{size:3,radius:3}:{size:0,radius:0})
},highlight:false,axis:"right"},{type:"scatter",xField:"id",yField:"bad_seq",marker:{type:"triangle",size:3,radius:3,stroke:"red"},style:{fill:"red",stroke:"red"},renderer:function(z,y,A,w){return(A.store.getAt(w).data.bad_seq?{size:3,radius:3}:{size:0,radius:0})
},highlight:false,axis:"right"});
this.chart=new Ext.chart.CartesianChart({xtype:"cartesian",store:this.store_chart,shadow:false,animation:false,border:false,axes:o,series:g,height:this.gridChartContainer.getHeight()-20,style:{paddingTop:15},plugins:{ptype:"chartitemevents",handleEvent:function(D){if(D.type=="click"||D.type=="mousemove"){var z=v.chart;
var C=z.getEventXY(D);
var B=z.axes[0].sprites[0].attr.length;
if(C[0]>=0&&C[0]<=B){var w=Math.min(parseInt(C[0]/B*z.store.getCount()),z.store.getCount()-1);
if(D.type=="click"){v.setPosition(z.store.getAt(w).data.counter,z.store.getAt(w).data.counter,"chart")
}else{var y=z.store.getAt(w);
var A={category:"markers",index:w,record:y,series:z.series[0],sprites:z.series[0].sprites,sprite:z.series[0].sprites[0]};
z.series[0].showTooltip(A,D)
}z.el.dom.style.cursor="pointer"
}else{z.el.dom.style.cursor="default"
}}else{if(D.type=="mouseout"){v.chart.series[0].getTooltip().hide()
}}}},theme:"RtpStreamAnalysis",style:{paddingTop:0,paddingBottom:0,marginTop:0,marginBottom:0},insetPadding:{top:6,bottom:0,left:2,right:2}});
this.chartContainer.add(this.chart);
this.setChartIndication(f);
if(!f){this.onScroll()
}},setGridChartData:function(c,b){if(!b){if(c>this.grid_chart._firstLastIndexRow[0]+(this.grid_chart._firstLastIndexRow[1]-this.grid_chart._firstLastIndexRow[0])/(this._setPosition_source=="grid_chart"?100:8)&&c<this.grid_chart._firstLastIndexRow[1]-(this.grid_chart._firstLastIndexRow[1]-this.grid_chart._firstLastIndexRow[0])/(this._setPosition_source=="grid_chart"?100:8)){this.setGridChartIndication(c);
return
}}this.grid_chart.isInitializing=true;
this.store_grid_chart.removeAll();
var a=this.fillStoreGridChart(c);
this.grid_chart.axes[0].setMinimum(Math.max(this.store_grid_chart.getAt(0).data.id-1,0));
this.grid_chart.axes[1].setMinimum(this.grid_chart.axes[1].fields,this.store_grid_chart);
this.grid_chart.isInitializing=false;
this.grid_chart.processData();
this.grid_chart.redraw();
this.grid_chart._selectedIndexRow=c;
this.grid_chart._firstLastIndexRow=a;
this.setGridChartIndication(c)
},setGridChartIndication:function(a,b){if(b){Ext.defer(function(){this._setGridChartIndication(a)
},100,this)
}else{this._setGridChartIndication(a)
}},_setGridChartIndication:function(g){var b=this.store_grid.getAt(g).data.counter;
var d=-1;
var a=-1;
for(var c=0;
c<this.store_grid_chart.getCount();
c++){var f=Math.abs(b-this.store_grid_chart.getAt(c).data.counter);
if(d<0||f<a){a=f;
d=c
}}if(d>=0){this.grid_chart.axes[0].setLimits({value:this.store_grid_chart.getAt(d).data.id,line:{strokeStyle:"red",lineWidth:2,lineDash:[2,1]}});
this.grid_chart.axes[0].renderLimits();
this.grid_chart.updateLayout();
this.grid_chart._limitValue=this.store_grid_chart.getAt(d).data.id
}},setChartIndication:function(a,b){if(b){Ext.defer(function(){this._setChartIndication(a)
},100,this)
}else{this._setChartIndication(a)
}},_setChartIndication:function(g){if(!this.chart){return
}var b=this.store_grid.getAt(g).data.counter;
var d=-1;
var a=-1;
for(var c=0;
c<this.store_chart.getCount();
c++){var f=Math.abs(b-this.store_chart.getAt(c).data.counter);
if(d<0||f<a){a=f;
d=c
}}if(d>=0){this.chart.axes[0].setLimits({value:this.store_chart.getAt(d).data.id,line:{strokeStyle:"red",lineWidth:2,lineDash:[2,1]}});
this.chart.axes[0].renderLimits();
this.chart.updateLayout()
}},getChartWidth:function(){return(parseInt(this.gridChartContainer.getWidth()/2))
},getChartRowRange:function(c){var b=this.getChartWidth();
var a=parseInt(c-b/2);
var d=a+b;
if(d>=this.store_grid.getCount()){d=this.store_grid.getCount()-1;
a=d-b
}if(a<0){a=0;
d=Math.min(a+b,this.store_grid.getCount()-1)
}return([a,d])
},getValueConfiguration:function(b){for(var a=0;
a<this.fields.length;
a++){if(this.fields[a].name==b){return(this.fields[a])
}}return(null)
},getChartConfiguration:function(b){for(var a=0;
a<this.fields.length;
a++){if(this.fields[a].name==b){return(Ext.isObject(this.fields[a].chart)?this.fields[a].chart:{})
}}return(null)
},getMinimumForChartSeries:function(f,a){if(Ext.isArray(f)){var h=null;
for(var d=0;
d<f.length;
d++){var c=this.getMinimumForChartSeries(f[d],a);
if(!Ext.isEmpty(c)&&(Ext.isEmpty(h)||c<h)){h=c
}}return(h)
}else{var b=this.getChartConfiguration(f);
var h=null;
if(Ext.isDefined(b.minimum)){h=b.minimum
}for(var d=0;
d<a.getCount();
d++){var g=a.getAt(d).data;
if(Ext.isDefined(g[f])&&(Ext.isEmpty(h)||g[f]<h)){h=g[f]
}if(Ext.isDefined(g[f+"_min"])&&(Ext.isEmpty(h)||g[f+"_min"]<h)){h=g[f+"_min"]
}}return(h)
}},getMaximumForChartSeries:function(d,b){if(Ext.isArray(d)){var g=null;
for(var c=0;
c<d.length;
c++){var a=this.getMaximumForChartSeries(d[c],b);
if(!Ext.isEmpty(a)&&(Ext.isEmpty(g)||a>g)){g=a
}}return(g)
}else{var g=null;
for(var c=0;
c<b.getCount();
c++){var f=b.getAt(c).data;
if(Ext.isDefined(f[d])&&(Ext.isEmpty(g)||f[d]>g)){g=f[d]
}if(Ext.isDefined(f[d+"_min"])&&(Ext.isEmpty(g)||f[d+"_min"]>g)){g=f[d+"_min"]
}}return(g)
}},renderValue:function(c,b,a){valueConfiguration=this.getValueConfiguration(b);
switch(valueConfiguration.unit){case"us":if(valueConfiguration.units=="ms"){if(a&&Math.abs(c)>=1000000){return(formatNumber(c/1000000,valueConfiguration.dec||0)+(a?" s":""))
}else{return(formatNumber(c/1000,valueConfiguration.dec||0)+(a?" ms":""))
}}else{if(valueConfiguration.units=="s"){return(formatNumber(c/1000000,valueConfiguration.dec||0)+(a?" s":""))
}}break;
case"mos10":return(formatNumber(c/10,valueConfiguration.dec||0))
}return(formatNumber(c,valueConfiguration.dec||0))
},getTopBottomRowInGrid:function(){var d=this.grid;
var b=d.view.el.getTop();
var c=d.view.el.getBottom();
var f,a;
Ext.each(d.view.getNodes(),function(g){if(!Ext.isDefined(f)&&Ext.fly(g).getBottom()>b){f=d.store.indexOf(d.view.getRecord(g))
}if(Ext.fly(g).getTop()<c){a=d.store.indexOf(d.view.getRecord(g))
}});
return([f,a])
},getGridRows:function(){if(this._lastGridRows&&this._lastGridRows_for_gridHeight==this.grid.getHeight()){return(this._lastGridRows)
}var a=this.getTopBottomRowInGrid();
var b=a[1]-a[0]+1;
if(b>0){this._lastGridRows=b;
this._lastGridRows_for_gridHeight=this.grid.getHeight();
return(this._lastGridRows)
}},createAudioFile:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"create_audio",timestamp_id:this.params.timestamp_id})},success:function(b){this._createAudioFile_result=b;
this.createAudioPlayer(b,a)
},maskEl:this})
},createAudioPlayer:function(a,k,h){var g=this;
delete this._disableChunkPlayer_evGotoTime;
delete this._disableChunkPlayer_evPlayTime;
var c=[];
var f=[];
if(k){var b=["spectrogram","wave","spectrogram & wave"];
for(var d=0;
d<b.length;
d++){b[d]=[b[d],this.findLangS("combomenu",b[d])]
}f.push({xtype:"ComboBoxA",aData:b,value:"spectrogram",listeners:{select:function(l){var m=l.getValue();
g.chunkPlayer.switchHidden(!m.match("wave"),!m.match("spectrogram"))
}},width:__width_FieldChar(20),style:{marginLeft:15}})
}f.push({xtype:"checkbox",boxLabel:"sync&nbsp;during&nbsp;play",checked:this.syncDuringPlay,listeners:{change:function(l){g.syncDuringPlay=l.getValue()
}},width:__width_FieldChar(20),style:{marginLeft:15}});
if(k){c.push({xtype:"container",flex:1});
f.push({xtype:"container",flex:1},{xtype:"button",text:this.findLangS("button","undock"),handler:function(){var l=g.chunkPlayer.getAudioInfo();
g.chunkPlayer.disableUnlinkAudioFile=true;
g._disableChunkPlayer_evGotoTime=true;
g._disableChunkPlayer_evPlayTime=true;
g.chunkPlayer.onClose();
g.chunkPlayer.destroy();
delete g.chunkPlayer;
g.audioContainer.removeAll();
g.audioPanel.hide();
Ext.defer(function(){g.createAudioPlayer(null,false,l);
g.addAudioWindow(g.chunkPlayer)
},100)
},style:{marginRight:2}},{xtype:"button",text:this.findLangS("button","close"),handler:function(){g._disableChunkPlayer_evGotoTime=true;
g._disableChunkPlayer_evPlayTime=true;
g.chunkPlayer.onClose();
g.chunkPlayer.destroy();
delete g.chunkPlayer;
g.audioContainer.removeAll();
g.audioPanel.hide();
var l=g.findC("_btn","createAudio");
if(l){l.show()
}},style:{marginRight:2}})
}this.chunkPlayer=new Tools.ChunkPlayer({docked:k,audioFile:a,inputAudioFile:h,playerContainer:k?this.audioContainer:null,onSuccessGetAudioInfoForFile:function(){if(k){g.audioPanel.show()
}var l=g.findC("_btn","createAudio");
if(l){l.hide();
if(!k){g.addAudioWindow(g.chunkPlayer)
}}},hiddenWave:k,disableSlider:k,compactPlayer:k,disableAutoPlay:true,disableDownloadAudio:true,modelessWindow:true,prevButtons:c,nextButtons:f,timeIndicationWidth:k?2:undefined,timeIndicationColor:k?"red":undefined,evGotoTime:function(l){if((!g.chunkPlayer||g.chunkPlayer.state!="play"||g.syncDuringPlay)&&!g._disableChunkPlayer_evGotoTime){g._disableChunkPlayer_evGotoTime=true;
g._disableChunkPlayer_evPlayTime=true;
g.setPositionByTime(l,"player");
Ext.defer(function(){delete g._disableChunkPlayer_evGotoTime;
delete g._disableChunkPlayer_evPlayTime
},100,this)
}},evPlayTime:function(m){if(g.syncDuringPlay&&!g._disableChunkPlayer_evPlayTime){g._disableChunkPlayer_evGotoTime=true;
g._disableChunkPlayer_evPlayTime=true;
var l=(new Date).getTime();
if(!g._lastSetPlayTime_at_ms||l>g._lastSetPlayTime_at_ms+500){g.setPositionByTime(m,"player");
g._lastSetPlayTime_at_ms=l
}Ext.defer(function(){delete g._disableChunkPlayer_evGotoTime;
delete g._disableChunkPlayer_evPlayTime
},100,this)
}},evBeforeCloseWindow:function(){g._disableChunkPlayer_evGotoTime=true;
g._disableChunkPlayer_evPlayTime=true
},evCloseWindow:function(){g.removeAudioWindow();
var l=g.findC("_btn","createAudio");
if(l){l.show()
}delete g.chunkPlayer
},_player_id:this.params.timestamp_id})
},addPacketDetail:function(a){if(this.windows&&this.windows[a.data.id]){this.windows[a.data.id].win.toFront();
return
}this.toFrontPacketDetail();
var b=new Tools.RtpStreamAnalysis.Packet({rec_data:a.data,main_panel:this,autoCreateWindow:true});
if(!this.windows){this.windows={}
}this.windows[a.data.id]=b;
this.bbarContainer.add({xtype:"button",text:"seq: "+a.data.seq,iconCls:"icon_magnifier",scope:this,handler:function(c){this.toFrontPacketDetail(c._windowId)
},_windowId:a.data.id,listeners:{scope:this,render:function(c){c.mon(c.getEl(),"mousedown",function(){Ext.defer(function(){this.toFrontPacketDetail(c._windowId)
},100,this)
},this)
},click:function(c){this.toFrontPacketDetail(c._windowId)
}}})
},removePacketDetail:function(b){if(this.windows&&this.windows[b.id]){delete this.windows[b.id];
var a=this.bbarContainer.findC("_windowId",b.id);
if(a){a.destroy()
}}},addAudioWindow:function(a){var b="audio";
if(!this.windows){this.windows={}
}this.windows[b]=a;
this.bbarContainer.add({xtype:"button",text:this.findLangS("button","audio"),iconCls:"icon_menu_audio_voices",scope:this,handler:function(c){this.toFrontPacketDetail(c._windowId)
},_windowId:b,listeners:{scope:this,render:function(c){c.mon(c.getEl(),"mousedown",function(){Ext.defer(function(){this.toFrontPacketDetail(c._windowId)
},100,this)
},this)
},click:function(c){this.toFrontPacketDetail(c._windowId)
}}})
},removeAudioWindow:function(){var a="audio";
if(this.windows&&this.windows[a]){delete this.windows[a];
var b=this.bbarContainer.findC("_windowId",a);
if(b){b.destroy()
}}},toFrontPacketDetail:function(a){for(var b in this.windows){var c=this.windows[b].win||this.windows[b].playerWindow;
c.toFront()
}if(Ext.isDefined(a)){var c=this.windows[a].win||this.windows[a].playerWindow;
c.toFront()
}},closeAllWindows:function(){if(this.windows){var b;
do{b=null;
for(var a in this.windows){b=this.windows[a].win||this.windows[a].playerWindow;
if(b){b.close();
break
}}}while(b)
}},showAllWindows:function(){this._operAllWindows("show")
},hideAllWindows:function(){this._operAllWindows("hide")
},_operAllWindows:function(b){if(this.windows){for(var a in this.windows){win=this.windows[a].win||this.windows[a].playerWindow;
if(win){win[b]()
}}}},onBeforeDestroy:function(){if(this.chunkPlayer){this._disableChunkPlayer_evGotoTime=true;
this._disableChunkPlayer_evPlayTime=true;
this.chunkPlayer.onClose()
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"delete_template",timestamp_id:this.params.timestamp_id})}})
},findNextValue:function(){var b=this.grid.selModel.getSelection();
var a=b.length?b[0]:this.store_grid.getAt(0);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"find_next",from_id:a.data.id+1,field:this._find_field,operator:this._find_operator,value:this._find_value,timestamp_id:this.params.timestamp_id})},success:function(c){if(c.nextId){this.setPosition(c.nextId,c.nextId,"find_next")
}else{Ext.Msg.alert("",this.findLangS("text","notFound"))
}},maskEl:this})
},getTitleText:function(a){return(CDR.Utils.rtpStreamTextInfo(a))
}});
Ext.define("Tools.RtpStreamAnalysis.Tabs",{extend:"Ext.tab.Panel",subsystem:"rtpStreamAnalysis",constructor:function(a){window.RtpStreamAnalysisTab=this;
Ext.applyIf(a,{layout:"fit",tabBar:{items:[{xtype:"button",text:this.findLangS("button","nextStream"),scope:this,handler:this.onBtnNextStream,height:17,style:{marginLeft:2,marginTop:2,marginBottom:2},innerStyle:{marginTop:-5},hidden:true,_btnId:"nextStream"}]},listeners:{scope:this,tabchange:this.onTabChange}});
this.callParent([a]);
if(a.autoCreateWindow){this.win=new Ext.Window({title:this.findLangS("title","rtpStreamAnalysis"),iconCls:undefined,layout:"fit",items:this,border:false,listeners:{scope:this,activate:this.onActivateWindow,beforeclose:this.onBeforeCloseWindow,close:this.onCloseWindow},width:Ext.dom.Element.getViewportWidth()-20,height:Ext.dom.Element.getViewportHeight()-20,wikiId:"Call_Detail_Record_-_CDR#RtpStreamAnalysis"});
this.win.show()
}},onActivateWindow:function(){if(!this._firstActivated){Ext.defer(function(){CDR.Utils.getCdrRtpStreams({cdr_id:this.config.params.cdr_id,all_streams:true},function(c){if(c&&c.length){c.sort(function(h,g){return(g.received-h.received)
});
this.rtpStreams=[];
for(var d=0;
d<c.length;
d++){this.rtpStreams.push({ssrc:c[d].ssrc,ip_src:c[d].saddr,ip_dst:c[d].daddr,port_src:c[d].sport,port_dst:c[d].dport,stream_index:c[d].index,received:c[d].received})
}var f=this.getNextRtpStreams();
if(f&&f.length){this.tabBar.findC("_btnId","nextStream").show()
}}},this);
for(var a=0;
a<this.items.getCount();
a++){var b=this.items.get(a);
if(b.onReady){b.onReady()
}}},100,this);
this._firstActivated=true
}},onCloseWindow:function(){for(var a=0;
a<this.items.getCount();
a++){var b=this.items.get(a);
if(b.onBeforeDestroy){b.onBeforeDestroy()
}}},onBeforeCloseWindow:function(){for(var a=0;
a<this.items.getCount();
a++){var b=this.items.get(a);
if(b.closeAllWindows){b.closeAllWindows()
}}},onBtnNextStream:function(){var a=this.getNextRtpStreamsMenu();
var b=new Ext.menu.Menu({items:a,defaults:{handler:function(c){this.addNextRtpStream(c._rtpStream)
},scope:this}});
b.showAtMouse()
},getNextRtpStreams:function(){var b=[];
if(this.rtpStreams){for(var a=0;
a<this.rtpStreams.length;
a++){if(!this.rtpStreamIsOpen(this.rtpStreams[a])){b.push(this.rtpStreams[a])
}}}return(b)
},getNextRtpStreamsMenu:function(){var c=[];
var b=this.getNextRtpStreams();
if(b&&b.length){for(var a=0;
a<b.length;
a++){c.push({text:CDR.Utils.rtpStreamTextInfo(b[a],{packets:true}),_rtpStream:b[a]})
}}return(c)
},rtpStreamIsOpen:function(b){for(var a=0;
a<this.items.getCount();
a++){var c=this.items.get(a);
if(c.config&&c.config.params){if(this.eqRtpStreamParams(c.config.params,b)){return(true)
}}}return(false)
},eqRtpStreamParams:function(c,b){var d=["ssrc","ip_src","ip_dst","port_src","port_dst"];
for(var a=0;
a<d.length;
a++){if(c[d[a]]!=b[d[a]]){return(false)
}}return(true)
},addNextRtpStream:function(a){var b={task:"prepare",cdr_id:this.config.params.cdr_id,ssrc:a.ssrc*1,ip_src:a.ip_src,ip_dst:a.ip_dst,port_src:a.port_src,port_dst:a.port_dst,stream_index:a.stream_index,timestamp_id:"tsid_"+(new Date).getTime()};
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode(b)},success:function(c){var d=new Tools.RtpStreamAnalysis({rsa_data:c.rsa_data,rsa_data_total:c.rsa_data_total,rsa_data_pages:c.rsa_data_pages,rsa_data_page_length:c.rsa_data_page_length,rsa_data_time_array:c.rsa_data_time_array,rsa_data_big_transit_array:c.rsa_data_big_transit_array,params:b,callOnReadyAfterRender:true});
this.add(d);
this.setActiveTab(d);
var f=this.getNextRtpStreams();
if(!(f&&f.length)){this.tabBar.findC("_btnId","nextStream").hide()
}},maskEl:this})
},onTabChange:function(b,a,c){if(c&&c.hideAllWindows){c.hideAllWindows()
}if(a&&a.showAllWindows){a.showAllWindows()
}}});
Ext.define("Tools.RtpStreamAnalysis.Packet",{extend:"Ext.Panel",subsystem:"rtpStreamAnalysis",constructor:function(a){Ext.applyIf(a,{layout:"fit",items:{xtype:"tabpanel",layout:"fit",border:false,plain:true,bodyBorder:false,activeTab:0,cls:"frame_window-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},listeners:{scope:this,afterrender:this.onAfterRender}});
if(a.autoCreateWindow){Ext.applyIf(a,{width:Math.min(Ext.dom.Element.getViewportWidth()*2/3,800),height:Math.min(Ext.dom.Element.getViewportHeight()*2/3,600)})
}this.callParent([a]);
if(a.autoCreateWindow){this.win=new Ext.Window({title:"seq: "+a.rec_data.seq,iconCls:"icon_magnifier",layout:"fit",items:this,border:false,maximizable:true,listeners:{scope:this,close:function(){this.main_panel.removePacketDetail(this.rec_data)
}}});
this.win.show();
this.win.updateLayout()
}},onAfterRender:function(){var a=this;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"rtpStreamAnalysis",params:Ext.encode({task:"packet_pdml",seq:this.rec_data.seq,timestamp_id:this.main_panel.params.timestamp_id})},success:function(b){this.items.get(0).add({title:this.findLangS("title","tree"),xtype:"panel",layout:"fit",border:false,items:new Tools.ParseXmlPdmlPanel({data:b.data,pdml:true,onlyKeyColumn:true,proportionalFont:true,hideHeaders:true,disableIcon:true,border:false,enableTbarButtonExpandAll:true,autoExpandRtpBranch:true,onLoad:function(c){for(var d=0;
d<c.length;
d++){if(c[d].data.key&&c[d].data.key.match&&c[d].data.key.match("Payload:")&&c[d].data.value&&c[d].data.value.match&&c[d].data.value.match(":")){a.showPayload(c[d].data.value)
}}}})});
this.items.get(0).setActiveTab(0)
},maskEl:this})
},showPayload:function(c){if(this.showPayloadDone){return
}c=c.split(":");
var b="";
for(var a=0;
a<c.length;
a++){if(a){if(!(a%16)){b+="<br>"
}else{if(!(a%8)){b+=" &nbsp; "
}}}if(!(a%16)){b+=a.toString(16).lpad(4,"0")+" &nbsp; "
}b+=c[a]+" "
}this.items.get(0).add({title:this.findLangS("title","payload"),xtype:"panel",html:b,autoScroll:true,border:false,style:{padding:4},bodyStyle:{font:__font_Monospace}});
this.showPayloadDone=true
}});
Ext.define("Ext.chart.theme.RtpStreamAnalysis",{extend:"Ext.chart.theme.Base",alias:"chart.theme.RtpStreamAnalysis",constructor:function(a){a.axis={left:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},right:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}},bottom:{label:{font:"10px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"#303030"},title:{font:"bold 11px Tahoma, Arial, Helvetica, Sans-serif",fillStyle:"black"}}};
this.callParent([a])
}});
Ext.ns("Tools");
Ext.define("Tools.Tree.Arrange",{extend:"Ext.tree.Panel",subsystem:"treeArrange",constructor:function(b){window.treeArrange=this;
this.safeMode=true;
var a=b.modelName||"TreeArrange_model";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:b.recordStruct||[{name:"id",type:"number"},{name:"data_id",type:"number"},{name:"order",type:"number"},{name:"folder",type:"bool"},{name:"name",type:"string"},{name:"user",type:"string"}],idProperty:b.keyField||"id"})
}var d={type:"ajax",url:"php/model/utilities.php",actionMethods:"POST",extraParams:{task:"treeArrange",params:Ext.encode({subTask:"load",dataType:b.dataType,suppressCondUsersForAdmin:b.suppressCondUsersForAdmin,hideEmptyFolders:b&&b.hideEmptyFolders,onlyFolders:b&&b.onlyFolders})},reader:{type:"json"}};
this.store=Ext.create("Ext.data.TreeStore",{model:a,proxy:d,root:{root:true,id:0,data_id:null,order:null,folder:null,name:"root",user:null,expanded:true}});
var f=[];
if(!(b&&b.disableTbar)){if(!b||b.enableAddFolder!==false){f.push({scope:this,text:this.findLangS("button","newFolder"),iconCls:"icon_add",handler:this.newFolder,_id:"newFolder"})
}if(!b||b.enableRenameFolder!==false){f.push({scope:this,text:this.findLangS("button","renameFolder"),iconCls:"icon_edit",handler:this.renameFolder,_id:"renameFolder",disabled:true})
}if(!b||b.enableRemoveFolder!==false){f.push({scope:this,text:this.findLangS("button","removeFolder"),iconCls:"icon_remove",handler:this.removeFolder,_id:"removeFolder",disabled:true})
}if(b&&b.tbarNext){f=f.concat(b.tbarNext)
}}b=Ext.applyIf(b||{},{store:this.store,hideHeaders:true,rootVisible:false,columns:[{xtype:"treecolumn",flex:1,dataIndex:"name",renderer:function(n,g,k,o,m,l,h){return(h.ownerCt.comboBox?'<span style="font-size: 110%;">'+k.data.name+"</span>"+(!k.data.folder&&k.data.user?'<span style="font-size: 90%;"> / '+k.data.user+"</span>":""):k.data.name+(!k.data.folder&&k.data.user?'<span style="font-size: 80%;"> / '+k.data.user+"</span>":""))
}}],tbar:f.length?f:undefined,listeners:{scope:this,afterrender:this.onAfterRender,cellclick:function(g,p,k,h,m,o,n,l){if(this.onClick){this.onClick.call(this.onClickScope,h.data,h.parentNode&&h.parentNode.data)
}}}});
if(!(b&&b.disableDD)){b=Ext.applyIf(b||{},{viewConfig:{plugins:{ptype:"treeviewdragdrop",ddGroup:"selDD",dragGroup:"selDD"},copy:false,listeners:{scope:this,drop:function(l,n,m,h,k){var o=n.records[0];
var p=m;
var g=null;
switch(h){case"append":g=p.data.folder?p:p.parentNode;
break;
case"after":case"before":g=p.parentNode;
while(!(g.data.folder||g.data.root)){g=g.parentNode
}break
}this.drop(o,p,g,h)
}}}})
}this.callParent([b]);
this.selModel.on("selectionchange",this.selectionChange,this);
if(this.autoCreateWindow){var c={};
if(Ext.isObject(b.autoCreateWindow)){Ext.apply(c,b.autoCreateWindow)
}Ext.applyIf(c,{layout:"fit",items:this,border:false,listeners:{scope:this,activate:this.onActivateWindow,beforeclose:this.onBeforeCloseWindow,close:this.onCloseWindow}});
this.win=new Ext.Window(c);
this.win.show()
}},onAfterRender:function(){},onActivateWindow:function(){},onBeforeCloseWindow:function(){},onCloseWindow:function(){},selectionChange:function(a,b){if(!b){b=this.selModel.getSelection()
}this.enableBtn("renameFolder",b.length==1&&b[0].data.folder);
this.enableBtn("removeFolder",b.length==1&&b[0].data.folder);
if(this.onSelectionChange){this.onSelectionChange(a,b)
}},drop:function(c,d,a,b){if(b=="append"&&!a.isLoaded()){this.store.on("load",function(){this._drop(c,d,a,b)
},this,{single:true})
}else{this._drop(c,d,a,b)
}},_drop:function(c,d,a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"treeArrange",params:Ext.encode({subTask:"drop",dataType:this.dataType,suppressCondUsersForAdmin:this.suppressCondUsersForAdmin,src:c.data,dst:a.data,posData:this.getPosData(a)})},success:function(f){this.__after_drop(a,f.id)
}})
},__after_drop:function(b,a){if(this.safeMode){var d=this.getScrollTop();
var c=this.getExpandedItems();
this.store.on("load",function(){var f=this;
this.expandItems(c,function(){f.ownerCt.focus();
f.setScrollTop(d);
f.selModel.select(f.store.getNodeById(a));
f.focusSelectionRow()
})
},this,{single:true});
Ext.defer(function(){this.store.read({node:b})
},10,this)
}else{this.selModel.select(this.store.getNodeById(a))
}},newFolder:function(){var c=true;
var a=false;
var b=this.selModel.getSelection();
if(b.length&&b[0].data.folder){a=true
}if(c&&a){var d=new Ext.menu.Menu({items:[{text:this.findLangS("menu","inRoot"),_menuId:"root"},{text:this.findLangS("menu","inSelected"),_menuId:"selected"}],defaults:{handler:function(f){this.newFolderForm(f._menuId=="root")
},scope:this}});
d.showAtMouse()
}else{if(c||a){this.newFolderForm(c)
}}},newFolderForm:function(a){var c;
var d=new Ext.Window({title:this.findLangS("title","newFolder"),iconCls:"icon_add",layout:"fit",items:{xtype:"form",layout:"form",frame:true,border:false,items:{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","name"),labelWidth:__width_FieldChar(12),allowBlank:false},buttons:[{text:lang.saveButtonText,iconCls:"icon_save",handler:b,scope:this,_id:"save"},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){d.destroy()
}}],width:300,listeners:{scope:this,afterrender:function(f){c=f;
Ext.defer(function(){Ext.create("Ext.util.KeyNav",c.el,{enter:b,scope:this});
c.getForm().findField("name").focus(false,200)
},200,this)
}}},border:false,modal:true,closable:true,resizable:false});
d.show();
function b(){if(c.getForm().isValid()){this._newFolder(a,c,c.getForm().findField("name").getValue())
}}},_newFolder:function(b,f,c){var a=null;
if(b){a=this.store.getRootNode()
}else{var d=this.selModel.getSelection();
if(d.length){a=d[0]
}}if(!a){return
}if(!a.isLoaded()){this.store.on("load",function(){this._newFolder(b,f,c)
},this,{single:true});
a.expand();
return
}var g=this.getPosData(a);
g.push({id:"new",name:"name",folder:true});
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"treeArrange",params:Ext.encode({subTask:"addFolder",name:c,parentId:a.data.root?null:a.data.id,dataType:this.dataType,suppressCondUsersForAdmin:this.suppressCondUsersForAdmin,posData:g})},success:function(h){this.__newFolder(a,{id:h.id,name:c});
f.ownerCt.close()
}})
},__newFolder:function(a,b){a.data.leaf=false;
a.appendChild(this.createChildFolder(b));
this.store.on("load",function(){this.__after_newFolder(a,b)
},this,{single:true})
},__after_newFolder:function(a,b){if(this.safeMode){var d=this.getScrollTop();
var c=this.getExpandedItems();
this.store.on("load",function(){var f=this;
this.expandItems(c,function(){f.ownerCt.focus();
f.selModel.select(f.store.getNodeById(b.id));
f.setScrollTop(d);
f.focusSelectionRow()
})
},this,{single:true});
Ext.defer(function(){this.store.read({node:a})
},10,this)
}else{this.selModel.select(this.store.getNodeById(b.id))
}},renameFolder:function(){var a=this.selModel.getSelection();
if(!(a.length==1&&a[0].data.folder)){return
}var c;
var d=new Ext.Window({title:this.findLangS("title","renameFolder"),layout:"fit",items:{xtype:"form",layout:"form",frame:true,border:false,items:{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","name"),value:a[0].data.name,labelWidth:__width_FieldChar(12),allowBlank:false},buttons:[{text:lang.saveButtonText,iconCls:"icon_save",handler:b,scope:this,_id:"save"},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){d.destroy()
}}],width:300,listeners:{scope:this,afterrender:function(f){c=f;
Ext.defer(function(){Ext.create("Ext.util.KeyNav",c.el,{enter:b,scope:this});
c.getForm().findField("name").focus(false,200)
},200,this)
}}},border:false,modal:true,closable:true,resizable:false});
d.show();
function b(){if(c.getForm().isValid()){this._renameFolder(c,a[0].data.id,c.getForm().findField("name").getValue(),a[0])
}}},_renameFolder:function(c,d,a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"treeArrange",params:Ext.encode({subTask:"renameFolder",id:d,name:a,dataType:this.dataType,suppressCondUsersForAdmin:this.suppressCondUsersForAdmin})},success:function(f){b.beginEdit();
b.data.name=a;
b.endEdit();
c.ownerCt.close()
}})
},removeFolder:function(){var a=this.selModel.getSelection();
if(a.length!=1){return
}Ext.Msg.confirm("",this.findLangS("text","deleteSelectedFolderQuestion"),function(b){if(b=="yes"){this._removeFolder(a[0])
}},this)
},_removeFolder:function(c){var a=c.parentNode;
var b=this.getLeavesItems(c);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"treeArrange",params:Ext.encode({subTask:"removeFolder",id:c.data.id,parent_id:c.parentNode.data.id,dataType:this.dataType,suppressCondUsersForAdmin:this.suppressCondUsersForAdmin})},success:function(d){c.remove();
this.selectionChange();
for(var f=0;
f<b.length;
f++){a.appendChild(this.createChildLeaf(b[f]))
}if(this.safeMode){var g=this.getExpandedItems();
this.store.on("load",function(){this.expandItems(g)
},this,{single:true});
Ext.defer(function(){this.store.read({node:a})
},100,this)
}}})
},getLeavesItems:function(a){items=[];
a.cascade(function(b){if(!b.data.folder){items.push(b.data)
}});
return(items)
},getExpandedItems:function(a){items=[];
this.store.getRootNode().cascade(function(b){if(b.data.expanded){items.push(b.data)
}});
return(items)
},expandItems:function(b,a){if(!b||!b.length){if(a){a()
}return
}var c=b[0].id?this.store.getNodeById(b[0].id):this.store.getRootNode();
if(c&&!c.data.expanded){c.on("expand",function(){this.expandItems(b.splice(1),a)
},this,{single:true});
c.expand()
}else{this.expandItems(b.splice(1),a)
}},getPosData:function(a){var c=[];
for(var b=0;
b<a.childNodes.length;
b++){c.push({id:a.childNodes[b].data.id,data_id:a.childNodes[b].data.data_id,name:a.childNodes[b].data.name,folder:a.childNodes[b].data.folder})
}return(c)
},createChildLeaf:function(a){return({id:a.id||0,data_id:a.data_id,order:a.order,folder:false,name:a.name,user:a.user,leaf:true})
},createChildFolder:function(a){return({id:a.id||0,data_id:a.data_id,order:a.order,folder:true,name:a.name,user:a.user,leaf:false,expanded:true})
},getScrollTop:function(){return(this.getView().getEl().getScrollTop())
},setScrollTop:function(a){this.getView().getEl().setScrollTop(a)
},focusSelectionRow:function(){var b=null;
var a=this.selModel.getSelection();
if(a.length){b=a[0]
}if(b){this.getView().focusRow(b)
}},reload:function(a,g,f,h){if(a){var d=this.getScrollTop();
var c=this.getExpandedItems()
}if(g){var b=this.selModel.getSelection();
if(b.length){b=b[0]
}else{b=null
}}this.store.on("load",function(){var k=this;
if(a){this.expandItems(c,function(){k.setScrollTop(d);
if(g&&b){k.selModel.select(k.store.getById(b.data[k.store.model.idProperty]));
k.focusSelectionRow()
}if(f){f.call(h)
}})
}else{if(g&&b){k.selModel.select(b);
k.focusSelectionRow()
}if(f){f.call(h)
}}},this,{single:true});
this.store.load()
}});
Ext.define("Tools.Tree.Arrange.Template",{extend:"Tools.Tree.Arrange",constructor:function(a){var b=[];
if(!(a&&a.disableTbar)){b.push({scope:this,text:this.findLangS("button","renameTemplate_"+a.dataType),iconCls:"icon_edit",handler:this.renameTemplate,_id:"renameTemplate",disabled:true},{scope:this,text:this.findLangS("button","removeTemplate_"+a.dataType),iconCls:"icon_remove",handler:this.deleteTemplate,_id:"deleteTemplate",disabled:true})
}a=Ext.applyIf(a||{},{tbarNext:b});
this.callParent([a])
},onSelectionChange:function(a,b){this.enableBtn("renameTemplate",b.length==1&&!b[0].data.folder&&b[0].data.data_id<100000);
this.enableBtn("deleteTemplate",b.length==1&&!b[0].data.folder&&b[0].data.data_id<100000)
},renameTemplate:function(){var a=this.selModel.getSelection();
if(!(a.length==1&&!a[0].data.folder&&a[0].data.data_id<100000)){return
}var c;
var d=new Ext.Window({title:this.findLangS("title","renameTemplate_"+this.dataType),layout:"fit",items:{xtype:"form",layout:"form",frame:true,border:false,items:{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","name"),value:a[0].data.name,labelWidth:__width_FieldChar(12),allowBlank:false},buttons:[{text:lang.saveButtonText,iconCls:"icon_save",handler:b,scope:this,_id:"save"},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:function(){d.destroy()
}}],width:300,listeners:{scope:this,afterrender:function(f){c=f;
Ext.defer(function(){Ext.create("Ext.util.KeyNav",c.el,{enter:b,scope:this});
c.getForm().findField("name").focus(false,200)
},200,this)
}}},border:false,modal:true,closable:true,resizable:false});
d.show();
function b(){if(c.getForm().isValid()){this._renameTemplate(c,a[0].data.data_id,c.getForm().findField("name").getValue(),a[0])
}}},_renameTemplate:function(c,d,a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"renameTemplate",params:Ext.encode({id:d,name:a})},success:function(f){b.beginEdit();
b.data.name=a;
b.endEdit();
c.ownerCt.close()
}})
},deleteTemplate:function(){var a=this.selModel.getSelection();
if(!(a.length==1&&!a[0].data.folder&&a[0].data.data_id<100000)){return
}Ext.Msg.confirm("",this.findLangS("text","deleteSelectedTemplate_"+this.dataType+"Question"),function(b){if(b=="yes"){this._deleteTemplate(a[0].data.data_id,a[0].data.name,a[0])
}},this)
},_deleteTemplate:function(c,a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"deleteTemplate",params:Ext.encode({id:c})},success:function(d){b.remove()
}})
}});
Ext.ns("Tools");
Ext.define("Tools.Pcaps",{singleton:true,mergePcap:function(b){var n=(new Date).getTime();
var m=[];
var p=window.maximum_parallel_tasks_in_merge_pcaps>0?window.maximum_parallel_tasks_in_merge_pcaps:4;
h();
function h(){var s=Ext.apply({},b);
delete s.onSuccess;
delete s.onSuccessScope;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"mergePcap",params:Ext.encode(Ext.apply(s,{subtask:"getIds",mergeUniqueKey:n}))},success:function(t){if(t&&t.recs_count>0){if(t.maximum_parallel_tasks_in_merge_pcaps>0){p=t.maximum_parallel_tasks_in_merge_pcaps
}for(var u=0;
u<t.recs_count;
u++){m.push({recIndex:u})
}a()
}},maskEl:b.maskElId&&Ext.getCmp(b.maskElId),timeout:30*60*1000})
}function a(){if(f()){l()
}while(g()<p){var s=c();
if(s>=0){k(s)
}else{break
}}}function k(s){m[s].active=true;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"mergePcap",params:Ext.encode({subtask:"getPcap",recIndex:s,mergeUniqueKey:n})},success:function(t){m[s].active=false;
m[s].ok=true;
a()
},error:function(t){m[s].active=false;
m[s].error=getStringAjaxError(t);
m[s].error_rec=t.error_rec;
a()
},failure:function(t){m[s].active=false;
m[s].error=getStringAjaxFailure(t);
a()
},maskEl:b.maskElId&&Ext.getCmp(b.maskElId),timeout:30*60*1000})
}function l(){var u="pcapTools";
var t=null;
if(d()){t='<table style="font: '+__font_Grid+'; table-layout: fixed;"><th>'+findLangS(u,"column","id")+"<th>"+findLangS(u,"column","calldate")+"<th>"+findLangS(u,"column","caller")+"<th>"+findLangS(u,"column","called")+"<th>"+findLangS(u,"column","error");
for(var s=0;
s<m.length;
s++){if(m[s].error){t+="<tr><td>"+m[s].error_rec.id+"<td>"+m[s].error_rec.calldate+"<td>"+m[s].error_rec.caller+"<td>"+m[s].error_rec.called+"<td>"+m[s].error
}}t+="</table>"
}if(o()){if(t){Ext.Msg.confirm("",findLangS(u,"text","errors_missingPcaps")+":<br><br>"+t+"<br><br>"+findLangS(u,"text","questionContinue"),function(v){if(v=="yes"){q()
}else{r()
}})
}else{q()
}}else{Ext.Msg.alert("",findLangS(u,"text","errors_missingPcaps")+":<br><br>"+t,function(v){r()
})
}}function q(){if(b.downloadPcap){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"mergePcap",params:Ext.encode({mergeUniqueKey:n,prepare:true})},success:function(s){b.onSuccess.call(b.onSuccessScope,s)
},maskEl:b.maskElId&&Ext.getCmp(b.maskElId),timeout:30*60*1000})
}else{b.onSuccess.call(b.onSuccessScope,n)
}}function r(){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"mergePcap",params:Ext.encode({subtask:"cancel",mergeUniqueKey:n})}})
}function g(){var t=0;
for(var s=0;
s<m.length;
s++){if(m[s].active){++t
}}return(t)
}function c(){for(var s=0;
s<m.length;
s++){if(!Ext.isDefined(m[s].active)){return(s)
}}return(-1)
}function f(){for(var s=0;
s<m.length;
s++){if(!Ext.isDefined(m[s].active)||m[s].active){return(false)
}}return(true)
}function o(){for(var s=0;
s<m.length;
s++){if(m[s].ok){return(true)
}}return(false)
}function d(){for(var s=0;
s<m.length;
s++){if(m[s].error){return(true)
}}return(false)
}}});
Ext.ns("Settings");
Ext.define("Settings.SensorTable.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SensorTable.GridX",subsystem:"sensors",constructor:function(a){var p=12;
var g=40;
this.enableDatabaseConfiguration=false;
var c=user_is_admin();
a=Ext.applyIf(a||{},{storeId:"SensorTableStore",url:"php/model/sql.php",module:"sensors",extraParams:{addLocalSensor:true,withDisabled:true},enableAutoLoad:false,keyField:"id",recordStruct:rsSensors,sortField:"name",remoteSort:false,columns:[c?{xtype:"checkcolumn",headerLang:"enable",dataIndex:"disable",width:50,renderer:function(s){var t=Ext.baseCSSPrefix,r=[t+"grid-checkheader"];
if(!s){r.push(t+"grid-checkheader-checked")
}return'<div class="'+r.join(" ")+'">&#160;</div>'
},listeners:{scope:this,checkchange:function(t,s,u){var r=this.store.getAt(s);
if(r){if(u&&this.isExpandRecord(r)){this.collapseRecord(r)
}r.data.disable=u;
r.commit();
this.saveRecord(r);
if(!u){this.loadSensorStat(r)
}}}}}:{headerLang:"enable",dataIndex:"disable",width:50,renderer:k},{xtype:"actioncolumn",dataIndex:"id_sensor",widthNum:11,rendererBase:f,items:[{getClass:function(r,t,u){var s="icon_blank";
if(!u.data.disable){if(l(u.data)){s="icon_wrench_orange"
}else{if(h(u.data)){s="icon_wrench"
}}}return(s)
},handler:function(s,w,r,t,u){var v=s.store.getAt(w);
if(d(v.data)){this.editConfiguration(v.data,"both")
}},enableHandler:function(u,w,y,z,r,t,s){return(d(y.data))
},tooltip:this.findLangS("tooltip","editConfiguration"),scope:this}],iconDivStyle:"float:left; height:15; width: 20;",baseContentDivStyle:"padding-left: 20"},{xtype:"actioncolumn",dataIndex:"name",widthCh:35,rendererBase:b,items:[{getClass:function(r,t,u){var s="icon_blank";
if(u.data.loadingSensorStat){s="icon_refresh_active"
}else{if(!u.data.disable){if(u.data.get_stat=="OK"){s=u.data.terminating_error?"icon_cross":"icon_ok"
}else{if(u.data.get_stat){s="icon_state_error"
}}}}return(s)
}},{getClass:function(r,t,u){var s="icon_blank";
if(!u.data.disable&&u.data.get_stat=="OK"&&!u.data.terminating_error&&q(u.data.version)){s="icon_menu_diag_system"
}return(s)
},handler:function(s,w,r,t,u){var v=s.store.getAt(w);
if(!v.data.disable&&v.data.get_stat=="OK"&&q(v.data.version)){this.showGraphs(v.data)
}},enableHandler:function(u,w,y,z,r,t,s){return(!y.data.disable&&y.data.get_stat=="OK"&&q(y.data.version))
},tooltip:this.findLangS("tooltip","graphs"),scope:this},{getClass:function(r,t,u){var s="icon_blank";
if(!u.data.disable&&u.data.get_stat=="OK"&&u.data.count_live_sniffers>0){s="icon_wireshark"
}return(s)
},handler:function(s,w,r,t,u){var v=s.store.getAt(w);
if(!v.data.disable&&v.data.get_stat=="OK"&&v.data.count_live_sniffers>0){this.showLiveSniffers(v.data)
}},enableHandler:function(u,w,y,z,r,t,s){return(!y.data.disable&&y.data.get_stat=="OK"&&y.data.count_live_sniffers>0)
},tooltip:this.findLangS("tooltip","liveSniffers"),scope:this}],iconDivStyle:"float:left; height:15; width: 48;",baseContentDivStyle:"padding-left: 50"},user_can_sensors_operations()?{xtype:"actioncolumn",dataIndex:"version",widthChar:20,rendererBase:b,items:[{getClass:function(r,s,t){return(this.enableDirectUpgrade(t)?"upgrade_red":null)
},handler:function(s,w,r,t,u){var v=s.store.getAt(w);
if(this.enableDirectUpgrade(v)){if(v.data.upgrade_by_git){this.upgradeByGit(v)
}else{this.directUgrade(v,u.xy||[u.x,u.y])
}}},enableHandler:function(u,w,y,z,r,t,s){return(this.enableDirectUpgrade(y))
},tooltip:this.findLangS("tootltip","upgradeSensorToNewVersion"),scope:this}],iconDivStyle:"float:right;",baseContentDivStyle:""}:{dataIndex:"version",widthCh:15,renderer:b},{dataIndex:"host",widthCh:20,headerLang:"managerIp",renderer:b},{dataIndex:"port",widthN:5,headerLang:"managerPort",renderer:b},{dataIndex:"default_for_active_call",widthCh:10,renderer:m},{dataIndex:"is_server",widthCh:10,renderer:m},{dataIndex:"auto_upgrade",widthCh:10,renderer:m}],fpDefaults:{xtype:"textfield",widthCh:g,labelCh:p,disableAutoAddTriggerWidth:true},fpItems:function(B,t,A,u){var y=[{name:"id_sensor",widthNum:5,allowBlank:false,blankText:lang.requirefield},{name:"name",allowBlank:false,blankText:lang.requirefield},{name:"host",widthChar:15,fieldLabelLang:"managerIp",allowBlank:false,blankText:lang.requirefield},{name:"port",widthChar:7,fieldLabelLang:"managerPort",allowBlank:u&&Ext.isEmpty(u.data.port),blankText:lang.requirefield},{xtype:"checkbox",name:"default_for_active_call",labelWidthForce:__width_FieldChar(25)},{xtype:"checkbox",name:"is_server",labelWidthForce:__width_FieldChar(25)},{xtype:"checkbox",name:"all_clients_in_active_calls",labelWidthForce:__width_FieldChar(25)},{xtype:"numberfield",name:"read_timeout",emptyText:10,widthNum:6,minValue:10,maxValue:300,labelWidthForce:__width_FieldChar(25)},{xtype:"colorpickerfield",name:"color_background",widthCh:12,_background:true,labelWidthForce:__width_FieldChar(25)},{xtype:"colorpickerfield",name:"color_chart",widthCh:12,_background:true,labelWidthForce:__width_FieldChar(25)}];
if(tcpdumpSensorsConfig){y.push({xtype:"fieldset",title:this.findLangS("title","tcpdumpParameters"),width:__width_FormChar(10,40)+20,items:[{xtype:"textfield",name:"interface",widthChar:8},{xtype:"textfield",name:"tcpdump_folder",widthChar:37},{xtype:"textfield",name:"tcpdump_mount_folder",widthChar:37}]})
}for(var s=0;
s<y.length;
s++){if(!Ext.isDefined(y[s].xtype)){y[s].xtype="textfield"
}}var z=[{xtype:"checkbox",name:"override_international_rules",labelWidth:__width_FieldChar(30)}];
z=z.concat(Settings.Utils.getInternationalRulesFormItems());
this.countryPrefixes=new Tools.CountryPrefixTable.Grid({storeId:"CountryPrefixSensorsTableStore",module:"customer_country_prefix_sensors",recordStruct:rsCountryPrefixSensors,memoryStore:true,relFields:t?undefined:{sensor_id:u.data.id},enableSearchX:false,enableExportCsv:false,enableImportCsv:false,pageSize:0,flex:1,border:true});
var w={xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"checkbox",name:"override_country_prefixes",labelWidth:__width_FieldChar(30)},this.countryPrefixes]};
var r=[{xtype:"checkbox",name:"auto_upgrade",labelWidth:__width_FieldChar(20)},{xtype:"timefield",name:"auto_upgrade_at",format:__format_TimeM,increment:15,labelWidth:__width_FieldChar(14),_width:__width_FieldTimeM+__width_Trigger},{xtype:"ComboBoxA",name:"auto_upgrade_week_days",aData:arWeekday,_clearButton:true,multiSelect:true,_arraySeparator:",",labelWidth:__width_FieldChar(14)},{xtype:"textfield",name:"auto_upgrade_email",labelWidth:__width_FieldChar(14)}];
var v={xtype:"tabpanel",items:[{xtype:"container",items:y,title:this.findLangS("title","basicData"),style:{"background-color":__color_FormBackground,padding:5}},{xtype:"container",items:z,title:this.findLangS("title","internationalRules"),style:{"background-color":__color_FormBackground,padding:5}},{xtype:"container",layout:"fit",items:w,title:this.findLangS("title","countryPrefixes"),style:{"background-color":__color_FormBackground,padding:5}},{xtype:"container",items:r,title:this.findLangS("title","autoUpgrade"),style:{"background-color":__color_FormBackground,padding:5}}],activeTab:0,plain:true,bodyBorder:false,border:false,height:__height_Form(15),tabBar:{renderTpl:__tpl_simplyTabPanel},width:__width_FormChar(p,g)+8};
return(v)
},propRecordText:function(r){return(r.name)
},getDefaultValues:function(){return({port:5029,default_for_active_call:true})
},testValidRecord:function(s,r,u){if(s.id_sensor<=0){Ext.Msg.alert(lang.error,this.findLangS("text","sensorIdMustBeGreaterThan0"));
return(false)
}var t=false;
this.store.each(function(v){if((r||u.id!=v.data.id)&&s.id_sensor==v.data.id_sensor){t=true
}});
if(t){Ext.Msg.alert(lang.error,this.findLangS("text","sensorIdMustBeUnique"));
return(false)
}if(!s.host.match(/[a-z]/i)&&!ip_is_valid(s.host)){Ext.Msg.alert(lang.error,this.findLangS("text","incorrectHostIp"));
return(false)
}return(true)
},enableEdit:c,enableSearchX:true,tbar:[{text:findLangSd("reloadSniffers"),iconCls:"icon_menu_reload",_btnId:"reload_vm",menu:[]},{text:this.findLangS("tbar","showStatus"),iconCls:"icon_table_lightning",_btnId:"_show_status",handler:function(){this.expandAll()
},scope:this},{text:this.findLangS("tbar","reloadStatus"),iconCls:"icon_table_refresh",_btnId:"_reload_status",handler:function(){this.load()
},scope:this},{text:this.findLangS("tbar","upgradeAll"),iconCls:"upgrade_red",_btnId:"upgrade_all",handler:function(){this.upgradeAll()
},hidden:true,scope:this},"-"],listeners:{scope:this,afterrender:this.loadSensors},plugins:[{ptype:"rowexpander",expandOnDblClick:false,keepExpand:true,getRowBody:function(t,s){var r="padding-right: 5px; width: 240px;";
return('<table border="1" bordercolor="#C5C5C5" class="cdr_expand_table" style=""><tr><td style="'+r+'"><b>'+s.findLangS("stat","version")+"</b></td><td>"+(t.get_stat=="OK"&&t.version&&user_can_sensors_operations()?'<img src="images/icon/arrow-circle-double-135.png" gridid="'+s.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).doRestartSensor(__RECORD_ID__);" width="16" style="cursor: pointer; margin-right: 4px; vertical-align: middle;" data-qtip="'+s.findLangS("tooltip","restartSensor")+'" >':"")+(t.get_stat=="OK"&&t.version&&!t.upgrade_by_git&&user_can_sensors_operations()&&s.upgradeVersions?'<img src="images/upgrade_blue.png" gridid="'+s.id+'" onclick="Ext.getCmp(this.attributes.gridid.nodeValue).doUpgradeSensor(__RECORD_ID__, event.xy || [ event.x, event.y]);" width="53" style="cursor: pointer; margin-right: 4px; vertical-align: middle;" data-qtip="'+s.findLangS("tooltip","upgradeSensor")+'" >':"")+t.version+'</td></tr><tr><td style="'+r+'"><b>'+s.findLangS("stat","pbStatString")+"</b></td><td>"+(t.get_stat=="OK"?(t.terminating_error||t.pbStatString||s.findLangS("text","waitForFirstState")):t.get_stat)+'</td></tr><tr><td style="'+r+'"><b>'+s.findLangS("stat","calldateOfLastRecordInSqlDatabase")+"</b></td><td>"+(t.storingCdrLastSavedAt?Ext.Date.format(t.storingCdrLastSavedAt,__format_DateTime):"")+'</td></tr><tr><td style="'+r+'"><b>'+s.findLangS("stat","timeOfLastSqlQueueRecord")+"</b></td><td>"+(t.storingCdrLastWriteAt?Ext.Date.format(t.storingCdrLastWriteAt,__format_DateTime):"")+'</td></tr><tr><td style="'+r+'"><b>'+s.findLangS("stat","pbCountPacketDrop")+"</b></td><td>"+(t.get_stat=="OK"?t.pbCountPacketDrop:"")+'</td></tr><tr><td style="'+r+'"><b>'+s.findLangS("stat","uptime")+"</b></td><td>"+(t.get_stat=="OK"?renderTime(t.uptime):"")+"</td></tr></table>")
},rowBodyPadding:3,enableExpand:function(r){return(!r.data.disable)
}}],loadMask:true,prefixCls:"sensor",getRowClass:n});
this.callParent([a]);
this.view.on("expandbody",this.onExpandRow,this);
this.view.on("collapsebody",this.onCollapseRow,this);
this.store.on("load",this.onLoad,this);
this.refreshTask=Ext.TaskManager.start({run:function(r){if(ActiveModule=="sensor_table"&&this.isVisible()){if(r==1||!(r%10)){this.load()
}else{this.store.load()
}}},interval:300000,scope:this});
var o=this;
function f(w,t,s,y,v,u,r){return(b(w<0?"local":w,t,s,y,v,u,r))
}function b(w,t,s,y,v,u,r){if(s.data.disable){w=renderStringStyle(w,{color:"grey",strike:true})
}return(w)
}function k(w,t,s,y,v,u,r){return(renderTick(!w,t,s,y,v,u,r))
}function m(w,t,s,y,v,u,r){if(!s.data.disable){return(renderTick(w,t,s,y,v,u,r))
}else{return("")
}}function q(r){versionA=r.split(".");
return(parseInt(versionA[0])*100+parseInt(versionA[1])>=1001)
}function d(r){return(!r.disable&&(l(r)||h(r)))
}function l(r){return((r.get_stat=="OK"||r.terminating_error)&&r.use_new_config)
}function h(r){return((r.get_stat=="OK"||r.terminating_error)&&r.use_new_config||r.get_stat!="OK"&&o.enableDatabaseConfiguration)
}function n(r,u,t,s){if(r.data.id<0){return(addBackgroundColorRuleToStyleSheet(__color_PanelBackgroud,"sensor-cell"))
}else{if(r.data.color_background){return(addBackgroundColorRuleToStyleSheet(r.data.color_background,"sensor-cell"))
}}}},isEnableEditRecord:function(a){return(a.data.id>=0)
},isEnableDeleteRecord:function(a){return(a.data.id>=0)
},loadSensors:function(){Settings.SensorTable.Utils.loadSensors({task:"setBtnMenuReload",btnId:"reload_vm",maskEl:this,panel:this,disableMask:true})
},doRestartSensor:function(b){var a=this.store.getById(b);
this.restartSensor(a.data)
},doUpgradeSensor:function(c,b){var a=this.store.getById(c);
this.upgradeSensor(a.data,null,null,b)
},restartSensor:function(h,g){if(!g){Ext.Msg.confirm(lang.questionText,findLangS("dashboard_d","text","restartSensor").template([h.name]),function(k){if(k=="yes"){this.restartSensor(h,true)
}},this);
return
}var c=lang.restartingSensor+" "+h.name;
var d;
var f;
d=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartSensor",params:Ext.encode({host:h.host,port:h.port,id_sensor:h.id_sensor,read_timeout:h.read_timeout})},success:function(k){abortRequest(f);
this.waitForSensorStat(h,c,20,function(){a.call(this)
},this)
},error:function(k,l){abortRequest(f);
if(k.error&&k.error.match("timeout")){b.call(this,20,this,c)
}else{alertAjaxError(l)
}},failure:function(k){if(!requestIsAborted(k)){alertAjaxFailure(k)
}},maskEl:this,maskMsg:c});
f=b.call(this,60,this,c);
function b(m,l,k){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"waitForSensorStat",params:Ext.encode({id_sensor:h.id_sensor,sleep:m,timeout:90})},success:function(n){if(n.ok){if(d){abortRequest(d);
d=null
}a.call(this)
}},errorFailure2:function(){},maskEl:l,maskMsg:k})
}function a(){this.store.load()
}},upgradeSensor:function(g,k,c,q){if(!k){if(!this.upgradeVersions||!this.upgradeVersions.length){return
}var o=[];
var b=[];
for(var h=0;
h<this.upgradeVersions.length;
h++){if(!this.upgradeVersions[h].version.devel&&!this.upgradeVersions[h].version.rc&&!this.upgradeVersions[h].version.beta){o.push({text:this.upgradeVersions[h].version.version,_version:this.upgradeVersions[h]})
}else{b.push({text:this.upgradeVersions[h].version.version,_version:this.upgradeVersions[h]})
}}if(b.length){o.push({text:this.findLangS("menu","betaVersions"),menu:{defaults:{scope:this,handler:function(t){this.upgradeSensor(g,t._version)
}},items:b}})
}var d=new Ext.menu.Menu({defaults:{scope:this,handler:function(t){this.upgradeSensor(g,t._version)
}},items:o});
d.showAt(q);
return
}if(!c){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getChangelogForSnifferVersion",params:Ext.encode({version:k.version.version,url_changelog:k.url_changelog})},success:function(t){var u=findLangS("dashboard_d","text","upgradeSensor").template([g.name,k.version.version]);
if(t.changelog){u+="<br><br><i><u>"+findLangS("dashboard_d","text","changelog")+":</u></i><br><br>"+t.changelog.replaceall("\n","<br>")
}Ext.Msg.longalert(lang.questionText,u,function(v){if(v=="yes"){this.upgradeSensor(g,k,true)
}},this,true,{buttons:Ext.Msg.YESNO})
},maskEl:this});
return
}var f=lang.upgradingSensor+" "+g.name+" "+lang.toVersion+" "+k.version.version;
var n=g.version;
var p=k.version.version;
var s=n&&p&&n!=p;
var m;
var a;
m=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartSensor",params:Ext.encode({host:g.host,port:g.port,id_sensor:g.id_sensor,read_timeout:g.read_timeout,upgrade:true,version:Ext.encode({version:k.version.version,url:k.url,md5_32:k.md5_32,md5_64:k.md5_64,md5_arm:k.md5_arm,md5_64_ws:k.md5_64_ws})})},success:function(t){abortRequest(a);
this.waitForSensorStat(g,f,20,function(){l.call(this)
},this)
},error:function(t,u){abortRequest(a);
if(t.error&&t.error.match("timeout")){r.call(this,s?p:false,20,this,f)
}else{alertAjaxError(u)
}},failure:function(t){if(!requestIsAborted(t)){alertAjaxFailure(t)
}},maskEl:this,maskMsg:f});
a=r.call(this,s?p:false,s?30:180,this,f);
function r(t,w,v,u){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:t?{task:"waitForSensorVersion",params:Ext.encode({id_sensor:g.id_sensor,sleep:w,timeout:180,version:t})}:{task:"waitForSensorStat",params:Ext.encode({id_sensor:g.id_sensor,sleep:w,timeout:180})},success:function(y){if(y.ok){if(m){abortRequest(m);
m=null
}if(t){r.call(this,false,0,this,u)
}else{l.call(this)
}}},errorFailure2:function(){},maskEl:v,maskMsg:u})
}function l(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"runCheckAndSaveNewVersionSniffer",params:Ext.encode({force:true})},success:function(){this.store.load()
},maskEl:this,maskMsg:lang.checkSensorsVersions})
}},waitForSensorStat:function(f,d,c,b,a){this.mask(d);
Ext.defer(function(){this.unmask();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"waitForSensorStat",params:Ext.encode({id_sensor:f.id_sensor,timeout:90})},success:function(){b.call(a)
},maskEl:this,maskMsg:d})
},c*1000,this)
},onLoad:function(c,b){this.okLoad=true;
if(this.expandRows){for(var d in this.expandRows){var a=this.store.getById(d*1);
if(a){this.collapseRecord(a);
this.expandRecord(a)
}}}this.autoShowUpgradeAllBtn();
this.loadSensorsStat();
this.autoCheckFinishLoadSensorsStat()
},onExpandRow:function(b,a){if(!this.expandRows){this.expandRows={}
}this.expandRows[a.data.id]=true
},onCollapseRow:function(b,a){if(this.expandRows&&this.expandRows[a.data.id]){delete this.expandRows[a.data.id]
}},load:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getVersionsSnifferForUpgrade"},success:function(a){this.upgradeVersions=a.results&&a.results.length?a.results:null;
this.store.load();
this.okLoadVersions=true
},error:function(){this.store.load()
},failure:function(){this.store.load()
},maskEl:this,maskMsg:this.findLangS("text","loadingUpgradeInformation")})
},loadSensorsStat:function(){this.store.each(function(a){if(!a.data.disable&&!a.data.get_stat){this.loadSensorStat(a)
}},this)
},loadSensorStat:function(d,c){if(Ext.isObject(d)){var b=null;
if(d.data){b=d.data
}else{if(d.id){b=d
}}if(b){d=b.id;
c=b.id_sensor
}else{return
}}var a=this.store.getById(d);
if(!a){return
}a.data.loadingSensorStat=true;
this.repaintRecord(a);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"loadSensorStat",params:Ext.encode({sensorId:c,id:d})},success:function(g,k,l){var n=Ext.decode(l.params.params);
var h=this.store.getById(n.id);
if(!h){return
}if(g&&g.stat){for(var m in g.stat){var f=getRecordItem(m,rsSensors);
if(f){h.data[m]=g.stat[m];
if(f.dateFormat){h.data[m]=Ext.Date.parse(h.data[m],f.dateFormat)
}}}}else{h.data.get_stat="unknown result"
}delete h.data.loadingSensorStat;
this.repaintRecord(h);
if(this.isExpandRecord(h)){this.collapseRecord(h);
this.expandRecord(h)
}this.autoShowUpgradeAllBtn();
this.autoCheckFinishLoadSensorsStat()
},error:function(f,h,k){var l=Ext.decode(k.params.params);
var g=this.store.getById(l.id);
if(!g){return
}g.data.get_stat=getStringAjaxError(f);
delete g.data.loadingSensorStat;
this.repaintRecord(g);
this.autoShowUpgradeAllBtn();
this.autoCheckFinishLoadSensorsStat()
},failure:function(g,h){var k=Ext.decode(h.params.params);
var f=this.store.getById(k.id);
if(!f){return
}delete f.data.loadingSensorStat;
f.data.get_stat=getStringAjaxFailure(g);
this.repaintRecord(f);
this.autoShowUpgradeAllBtn();
this.autoCheckFinishLoadSensorsStat()
}})
},autoShowUpgradeAllBtn:function(){var c=false;
this.store.each(function(d){if(d.data.upgrade_version_stable){c=true
}});
var b=this.getTopToolbar();
var a=b.findC("_btnId","upgrade_all",true);
if(a){a.showIf(c)
}},autoCheckFinishLoadSensorsStat:function(){var a=true;
this.store.each(function(b){if(!b.data.disable&&!b.data.get_stat){a=false
}});
if(a){this.okLoadSensorsStat=true;
if(this.runUpgradeAllAfterLoadVersions){delete this.runUpgradeAllAfterLoadVersions;
Ext.defer(this.upgradeAll,100,this)
}}},enableDirectUpgrade:function(a){return(!a.data.disable&&(a.data.upgrade_version_stable||a.data.upgrade_version_beta))
},directUgrade:function(d,f,a){if(!this.upgradeVersions||!this.upgradeVersions.length){return
}if(!a){if(d.data.upgrade_version_stable&&d.data.upgrade_version_beta){var c=new Ext.menu.Menu({defaults:{scope:this,handler:function(g){this.directUgrade(d,f,g._version)
}},items:[{text:d.data.upgrade_version_stable,_version:d.data.upgrade_version_stable},{text:d.data.upgrade_version_beta+" ("+this.findLangS("text","betaVersion")+")",_version:d.data.upgrade_version_beta}]});
c.showAt(f)
}else{this.directUgrade(d,f,d.data.upgrade_version_stable||d.data.upgrade_version_beta)
}}else{versionData=null;
for(var b=0;
b<this.upgradeVersions.length;
b++){if(this.upgradeVersions[b].version.version==a){versionData=this.upgradeVersions[b];
break
}}if(versionData){this.upgradeSensor(d.data,versionData,false,f)
}}},upgradeByGit:function(d){if(!this.upgradeVersions||!this.upgradeVersions.length){return
}var a=d.data.upgrade_version_stable||d.data.upgrade_version_beta;
var c=null;
for(var b=0;
b<this.upgradeVersions.length;
b++){if(this.upgradeVersions[b].version.version==a){c=this.upgradeVersions[b];
break
}}if(!c){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getChangelogForSnifferVersion",params:Ext.encode({version:c.version.version,url_changelog:c.url_changelog})},success:function(f){var g=findLangS("dashboard_d","text","upgradeSensor").template([d.data.name,c.version.version]);
if(f.changelog){g+="<br><br><i><u>"+findLangS("dashboard_d","text","changelog")+":</u></i><br><br>"+f.changelog.replaceall("\n","<br>")
}Ext.Msg.longalert(lang.questionText,g,function(h){if(h=="yes"){upgradeSnifferByGit(d.data,this)
}},this,true,{buttons:Ext.Msg.YESNO})
},maskEl:this})
},doUpgradeAll:function(){if(this.okLoadVersions&&this.okLoad&&this.okLoadSensorsStat){Ext.defer(this.upgradeAll,100,this)
}else{this.runUpgradeAllAfterLoadVersions=true
}},upgradeAll:function(){var f=[];
var c="";
this.store.each(function(g){if(!g.data.disable&&g.data.upgrade_version_stable&&!g.data.upgrade_by_git){f.push(g.data);
if(c){c+=", "
}c+=g.data.name
}});
if(!f.length){return
}var a=f[0].upgrade_version_stable;
var d=null;
for(var b=0;
b<this.upgradeVersions.length;
b++){if(this.upgradeVersions[b].version.version==a){d=this.upgradeVersions[b];
break
}}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getChangelogForSnifferVersion",params:Ext.encode({version:a,url_changelog:d.url_changelog})},success:function(g){var h=findLangS("dashboard_d","text",f.length>1?"upgradeSensors":"upgradeSensor").template([c,a]);
if(g.changelog){h+="<br><br><i><u>"+findLangS("dashboard_d","text","changelog")+":</u></i><br><br>"+g.changelog.replaceall("\n","<br>")
}Ext.Msg.longalert(lang.questionText,h,function(k){if(k=="yes"){this.upgradeSensors(f,c,d)
}},this,true,{buttons:Ext.Msg.YESNO})
},maskEl:this})
},upgradeSensors:function(c,b,a){Settings.Utils.upgradeSensors({scope:this,sensors:c,version:a,onOk:function(g,d,f){Ext.defer(function(){f.close();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"runCheckAndSaveNewVersionSniffer",params:Ext.encode({force:true})},success:function(){this.store.load()
},maskEl:this,maskMsg:lang.checkSensorsVersions})
},2*1000,this)
},maskEl:this})
},onChangeRecords:function(c,h,k){if(h.host==window.vpmanagerhost&&h.port==window.vpmanagerport){for(var d=0;
d<this.store.getCount();
d++){var b=this.store.getAt(d);
if(b.data.id<0){this.store.removeAt(d);
break
}}}if(!h.disable){this.loadSensorStat(h.id,h.id_sensor)
}fetchSensorInfo();
this.loadSensors();
var f=Ext.getCmp("SPY-panel");
if(f){f.spy.comboSensor.store.load();
var g=f.spy.comboSensor.getValue();
if(g){f.spy.comboSensor.setValue(null);
f.spy.comboSensor.setValue(g)
}}var a=Ext.getCmp("Livepacket-panel");
if(a){a.livepacket.filterSensor.store.load()
}},showGraphs:function(a){new Settings.SensorGraphs.Panel({sensorData:a,autoCreateWindow:true})
},showLiveSniffers:function(a){new Settings.SensorLiveSniffers.Panel({sensorData:a,sensorsGrid:this,autoCreateWindow:true})
},editConfiguration:function(a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getSensorConfiguration",params:Ext.encode({host:a.host,port:a.port,id_sensor:a.id_sensor,read_timeout:a.read_timeout,typeConfiguration:b})},success:function(c){new Settings.SensorConfiguration.Panel({sensorData:a,sensorConfiguration:c.configuration,sensorNextData:c.nextData,sensorsGrid:this,autoCreateWindow:true,typeConfiguration:b})
},maskEl:this})
},deferReload:function(a,b){this.mask(b);
Ext.defer(function(){this.unmask();
this.store.load()
},a||5000,this)
},setContextItems:function(a,d,f,h,g,c,b){this.enableFieldIf("all_clients_in_active_calls",d.is_server);
Settings.Utils.setContextItemsInternationalRules(this,a,d,d.override_international_rules);
this.countryPrefixes.enableIf(d.override_country_prefixes);
if(d.override_country_prefixes){this.countryPrefixes.unmask()
}this.enableFieldIf(["auto_upgrade_at","auto_upgrade_week_days","auto_upgrade_email","auto_upgrade_enable_beta"],d.auto_upgrade);
this.allowBlankField("auto_upgrade_at",!d.auto_upgrade)
},prepareDataForEdit:function(a){if(a.read_timeout===0){a.read_timeout=null
}},prepareDataForSave:function(a){if(this.countryPrefixes){a.country_prefixes=this.countryPrefixes.getAllGridData(true);
a.country_prefixes_updateRecords=this.countryPrefixes._updateRecords;
a.country_prefixes_deleteRecords=this.countryPrefixes._deleteRecords
}}});
Ext.define("Settings.SensorLiveSniffers.Panel",{extend:"Ext.ux.grid.GridForm",subsystem:"sensors",constructor:function(a){var b=[{dataIndex:"uid",widthNum:8}];
b.push({dataIndex:"user_name",widthCh:20});
if(user.sqlrow.login_table=="users"){b.push({xtype:"actioncolumn",dataIndex:"state",flex:1,rendererBase:renderString,items:[{getClass:function(f,g,h){return("icon_delete")
},handler:function(g,m,f,h,k){var l=g.store.getAt(m);
this.stop(l.data)
},tooltip:this.findLangS("tooltip","stopSniffing"),scope:this}],iconDivStyle:"float:left; height:15; width: 16;",baseContentDivStyle:"padding-left: 20"})
}a=Ext.applyIf(a,{storeId:"SensorTableLIveSniffers",url:"php/model/sql.php",module:"sensors_live_sniffers",extraParams:{sensor_id:a.sensorData.id},recordStruct:rsSensorLiveSniffers,columns:b});
this.callParent([a]);
var c=this;
if(a.autoCreateWindow){var d=new Ext.Window({title:this.findLangS("title","sensorLiveSniffers")+" - "+a.sensorData.name,iconCls:"icon_wireshark",layout:"fit",items:this,border:true,modal:true,closable:true,resizable:false,width:600,height:400,listeners:{close:function(){if(c.countStop){c.sensorsGrid.load()
}}}});
d.show()
}},stop:function(a){Ext.Msg.confirm(lang.questionText,this.findLangS("text","questionStopSniffing"),function(b){if(b=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"livepacketStop",params:Ext.encode({sensor:this.sensorData.id,uid:a.uid})},success:function(c){this.reload();
if(!this.countStop){this.countStop=1
}else{++this.countStop
}},scope:this,maskEl:this})
}},this)
}});
Ext.define("Settings.SensorGraphs.Panel",{extend:"Ext.Panel",subsystem:"sensors",constructor:function(c){if(!c){c={}
}var b=6;
var a=__width_FieldChar(b);
var d=[{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field","from")+":",width:a+__width_LabelFieldSeparator},{xtype:"button",iconCls:"icon_time",menu:getStdMenuTimeFrom(this,function(g){this.setTypeTimePeriod(g._typeTimeFrom);
this.reloadGraphs()
},[{text:lang.last+" 60 "+lang.minutes,_typeTimeFrom:"last_60m"},{text:lang.last+" 24 "+lang.hours,_typeTimeFrom:"last_24h"},{text:lang.last+" "+lang.week,_typeTimeFrom:"last_week_time"},{text:lang.last+" "+lang.month,_typeTimeFrom:"last_month_time"},{text:lang.last+" "+lang.year,_typeTimeFrom:"last_year_time"},{xtype:"menuseparator"},{text:lang.last+" 2 "+lang.hours,_typeTimeFrom:"last_2h"},{text:lang.last+" 3 "+lang.hours,_typeTimeFrom:"last_3h"},{text:lang.last+" "+2+" "+lang.days,_typeTimeFrom:"last_2d"},{text:lang.last+" "+3+" "+lang.days,_typeTimeFrom:"last_3d"},{text:lang.yesterday,_typeTimeFrom:"yesterday"}])},{xtype:"datefield",name:"date_from",format:__format_Date,width:__width_FieldDate,labelWidth:a,listeners:{scope:this,select:function(h,g){this.setTypeTimePeriod(null);
this.reloadGraphs()
}},style:{marginLeft:4}},{xtype:"timefield",name:"time_from",increment:30,format:__format_TimeM,width:__width_FieldTimeM,labelWidth:a,listeners:{scope:this,select:function(h,g){this.setTypeTimePeriod(null);
this.reloadGraphs()
}},style:{marginLeft:2}},{xtype:"displayfield",value:this.findLangS("field","to")+":",style:{marginLeft:10,marginRight:5}},{xtype:"datefield",name:"date_to",format:__format_Date,width:__width_FieldDate,labelWidth:a,listeners:{scope:this,select:function(h,g){this.setTypeTimePeriod(null);
this.reloadGraphs()
}}},{xtype:"timefield",name:"time_to",increment:30,format:__format_TimeM,width:__width_FieldTimeM,labelWidth:a,listeners:{scope:this,select:function(h,g){this.setTypeTimePeriod(null);
this.reloadGraphs()
}},style:{marginLeft:2}},{xtype:"button",iconCls:"icon_reload",handler:function(){this.setTimeFromToViaTypeTimePeriod();
this.reloadGraphs()
},scope:this,style:{marginLeft:4}}],style:{marginBottom:__height_FieldSeparator}}];
Ext.applyIf(c,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",items:d,border:false,bodyStyle:{"background-color":__color_WindowFrame}},{xtype:"container",name:"graphs",flex:1,width:"100%",autoScroll:true}],border:false,bodyStyle:{"background-color":__color_WindowFrame},listeners:{scope:this,afterrender:this.onAfterRender,destroy:this.onDestroy},width:600,height:Ext.dom.Element.getViewportHeight()-60});
this.callParent([c]);
if(c.autoCreateWindow){var f=new Ext.Window({title:this.findLangS("title","sensorGraphs")+" - "+c.sensorData.name,iconCls:"icon_menu_diag_system",layout:"fit",items:this,border:false,modal:true,closable:true,resizable:false});
f.show()
}},onAfterRender:function(){this.setTypeTimePeriod("last_60m");
Ext.defer(this.showGraphs,200,this);
var a=0;
this.autoReload=Ext.TaskManager.start({run:function(){if(a){this.setTimeFromToViaTypeTimePeriod();
this.reloadGraphs()
}++a
},interval:60000,scope:this})
},onDestroy:function(){Ext.TaskManager.stop(this.autoReload)
},showGraphs:function(a){if(!a){var d=this.getGraphsContainer();
d.removeAll()
}var c=this.getField("date_from").getValue()?completeDateTime(this.getField("date_from").getValue(),this.getField("time_from").getValue()):null;
var b=this.getField("date_to").getValue()?completeDateTime(this.getField("date_to").getValue(),this.getField("time_to").getValue()):null;
if(b&&!this.getField("time_to").getValue()){b=date(new Date(b.getTime()+36*3600*1000))
}if(!b){b=dateTimeM(new Date)
}if(!c){c=dateTimeM(new Date(b.getTime()-3600*1000))
}c=convSecTimeToNow(c.getTime()/1000);
b=convSecTimeToNow(b.getTime()/1000);
if(a){this._reloadGraphs(c,b)
}else{this._showGraphs(c,b)
}},reloadGraphs:function(){this.showGraphs(true)
},_showGraphs:function(b,a){this.__iterData={operation:"show",data:arSensorGraphsRRD,index:0,dateFrom:b,dateTo:a};
this.__iterGraph()
},_reloadGraphs:function(b,a){var c=this.getGraphsContainer();
this.__iterData={operation:"reload",data:c.items.items,index:0,dateFrom:b,dateTo:a};
this.__iterGraph()
},__iterGraph:function(){var c=this;
var g=this.getGraphsContainer();
var d=g.getWidth()-__width_Scroller-3;
var b=parseInt(d*2/5);
var a=null;
if(c.__iterData.operation=="reload"){a=g.items.get(c.__iterData.index)
}var f={sensorIdSensor:a?a._sensorData.id_sensor:this.sensorData.id_sensor,graph:a?a._graph:c.__iterData.data[c.__iterData.index][0],begin:c.__iterData.dateFrom,end:c.__iterData.dateTo,width:d,height:b,background:__color_WindowFrame.substr(1),noframe:true,panelId:this.id};
switch(c.__iterData.operation){case"show":g.add({xtype:"container",items:this.__getGraphImageConfig(f),width:d,height:b,style:{marginTop:5,marginBottom:5},_sensorData:this.sensorData,_graph:c.__iterData.data[c.__iterData.index][0]});
break;
case"reload":if(a.items.get(0).src){a.items.get(0).setSrc("php/model/utilities.php?task=sensorGraph&params="+encodeURIComponent(Ext.encode(f)))
}else{a.removeAll();
a.add(this.__getGraphImageConfig(f))
}break
}},__getGraphImageConfig:function(d){var f=this.getGraphsContainer();
var c=f.getWidth()-__width_Scroller-3;
var a=parseInt(c*2/5);
var b=this;
return({xtype:"image",width:c,height:a,src:"php/model/utilities.php?task=sensorGraph&params="+encodeURIComponent(Ext.encode(d)),listeners:{afterrender:function(g){g.getEl().on("load",function(){if(b.__iterData.index<b.__iterData.data.length-1){++b.__iterData.index;
b.__iterGraph()
}});
g.getEl().on("error",function(){var h={checkError:true};
Ext.apply(h,d);
ajaxSafeRequest({scope:b,url:"php/model/utilities.php",params:{task:"sensorGraph",params:Ext.encode(h)},success:function(k){var l=this.getGraphsContainer().items.get(b.__iterData.index);
l.removeAll();
l.add({xtype:"container",layout:{type:"hbox",align:"middle",pack:"center"},items:{xtype:"displayfield",value:k.error},height:a});
if(this.__iterData.index<this.__iterData.data.length-1){++this.__iterData.index;
this.__iterGraph()
}}})
})
},scope:this}})
},getField:function(a){return(this.getItem(a,"name",true))
},getGraphsContainer:function(){return(this.getItem("graphs","name",true))
},setTypeTimePeriod:function(a){this.typeTimePeriod=a;
if(this.typeTimePeriod){this.setTimeFromToViaTypeTimePeriod()
}},setTimeFromToViaTypeTimePeriod:function(){if(!this.typeTimePeriod){return
}var a=dateTimeM(getTimeInterval(this.typeTimePeriod)[0]);
var b=getTimeInterval(this.typeTimePeriod)[1];
if(b){b=dateTimeM(b)
}this.getField("date_from").setValue(date(a));
this.getField("time_from").setValue(time_sec(a)?time(a):null);
this.getField("date_to").setValue(b?date(b):null);
this.getField("time_to").setValue(b&&time_sec(b)?time(b):null)
}});
Ext.define("Settings.SensorConfiguration.Panel",{extend:"Ext.Panel",subsystem:"sensors",enableCheckBoxYesNo:false,constructor:function(b){var r=this;
this.store=new Ext.data.ArrayStore({storeId:"StoreServerSideConfig",fields:rsSensorConfig,groupField:"group_id"});
this.groupMap=[];
this.groupSubgroupMap=[];
this.groupIdSet=[];
for(var k in b.sensorConfiguration){if(!b.sensorConfiguration[k].minor){if(b.sensorConfiguration[k].name=="sniffer_mode"){if(!b.sensorConfiguration[k].value*1){b.sensorConfiguration[k].value=1
}}if(!this.groupMap.inArray(b.sensorConfiguration[k].group)){this.groupMap.push(b.sensorConfiguration[k].group)
}b.sensorConfiguration[k].group_subgroup=b.sensorConfiguration[k].group+"/"+b.sensorConfiguration[k].subgroup;
if(!this.groupSubgroupMap.inArray(b.sensorConfiguration[k].group_subgroup)){this.groupSubgroupMap.push(b.sensorConfiguration[k].group_subgroup)
}b.sensorConfiguration[k].group_id=this.groupMap.indexOf(b.sensorConfiguration[k].group)+1;
b.sensorConfiguration[k].group_subgroup_id=this.groupSubgroupMap.indexOf(b.sensorConfiguration[k].group_subgroup)+1;
if(b.sensorConfiguration[k].set){this.groupIdSet[b.sensorConfiguration[k].group_id]=true
}else{b.sensorConfiguration[k].value=b.sensorConfiguration[k].value_old=b.sensorConfiguration[k]["default"]
}if(b.sensorConfiguration[k].type=="integer"&&b.sensorConfiguration[k].only_menu){b.sensorConfiguration[k].value*=1;
b.sensorConfiguration[k].value_old*=1
}}}var d;
var a=0;
for(var k in b.sensorConfiguration){if(!b.sensorConfiguration[k].minor&&(!b.sensorConfiguration[k].minor_group_if_not_set||this.groupIdSet[b.sensorConfiguration[k].group_id])){if(d!=b.sensorConfiguration[k].group_subgroup_id){if(b.sensorConfiguration[k].subgroup){var h={group_id:b.sensorConfiguration[k].group_id,group:b.sensorConfiguration[k].group,subgroup:b.sensorConfiguration[k].subgroup,group_subgroup_id:b.sensorConfiguration[k].group_subgroup_id,group_subgroup:b.sensorConfiguration[k].group_subgroup,subgroup_label:true,id:++a};
this.store.add(h)
}}b.sensorConfiguration[k].id=++a;
this.store.add(b.sensorConfiguration[k]);
d=b.sensorConfiguration[k].group_subgroup_id
}}this.setSubGroupEnd(this.store);
this.cellEditing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,listeners:{beforeedit:t,edit:c,canceledit:o}});
this.selectLevel=0;
this.showDefaultItems=true;
this.filterString=null;
this.comboLevel=new Ext.ux.combobox.ComboBoxA({value:this.selectLevel,aData:[[0,this.findLangS("combo","levelNormal")],[1,this.findLangS("combo","levelAdvanced")],[2,this.findLangS("combo","levelExpert")]],width:__width_ColumnChar(15),listeners:{scope:this,select:this.refreshFilter}});
this.checkBoxShowDefaultItems=new Ext.form.Checkbox({checked:this.showDefaultItems,listeners:{scope:this,change:this.refreshFilter},fieldStyle:{marginTop:-2}});
this.grid=new Ext.grid.GridPanel({store:this.store,columns:[{dataIndex:"subgroup",width:20,sortable:false,renderer:n},{dataIndex:"name",flex:1,sortable:false,renderer:m},{dataIndex:"value",flex:1,sortable:false,renderer:s,getEditor:g,_panel:this},{xtype:"actioncolumn",dataIndex:"set",width:20,rendererBase:function(A,w,v,B,z,y,u){w.style="padding-left: 2; padding-top: 0; padding-bottom: 0;";
if(v.data.subgroup_end){w.tdCls="no-border"
}return("")
},items:[{getClass:function(u,w,y){return(r.editIsDisabled(y)?"icon_blank":r.valueIsSetAndChanged(y)?"icon_edit":r.isEnableUndoRemove(y)?"icon_pencil_delete":y.data.set&&r.valueIsSetInJson(y)?"icon_plugin_edit":y.data.set&&r.valueIsSetInDb(y)?"icon_database_green":y.data.set_in_config?"icon_page_text":"icon_blank")
},handler:function(v,B,u,w,y){var A=v.store.getAt(B);
if(!r.editIsDisabled(A)){if(r.isEnableUndoChange(A)){var z=new Ext.menu.Menu({items:[{text:this.findLangS("menu","undoChangeValue"),iconCls:"icon_undo",scope:this,handler:function(D){r.undoChange(A);
var C=this.getFixPositionRecord();
this.setFilter();
this.refreshGrid(C)
}}]});
z.showAtMouse(y)
}else{if(r.isEnableRemoveValueFromDb(A)||r.isEnableRemoveValueFromJson(A)){var z=new Ext.menu.Menu({items:[{text:this.findLangS("menu",r.isEnableRemoveValueFromDb(A)?"disableValueInDb":"disableValueInJson"),iconCls:"icon_undo",scope:this,handler:function(D){if(r.isEnableRemoveValueFromDb(A)){r.removeValueFromDb(A)
}else{r.removeValueFromJson(A)
}var C=this.getFixPositionRecord();
this.setFilter();
this.refreshGrid(C)
}}]});
z.showAtMouse(y)
}else{if(r.isEnableUndoRemove(A)){var z=new Ext.menu.Menu({items:[{text:this.findLangS("menu","undoRemoveValue"),iconCls:"icon_undo",scope:this,handler:function(D){r.undoRemove(A);
var C=this.getFixPositionRecord();
this.setFilter();
this.refreshGrid(C)
}}]});
z.showAtMouse(y)
}}}}},enableHandler:function(z,A,B,C,u,y,w){if(!r.editIsDisabled(B)&&(r.isEnableUndoChange(B)||r.isEnableRemoveValueFromDb(B)||r.isEnableRemoveValueFromJson(B)||r.isEnableUndoRemove(B))){return(true)
}return(false)
},tooltip:function(u,w,y){return(r.editIsDisabled(y)?null:r.valueIsSetAndChanged(y)?this.findLangS("text","valueHasChanged"):r.valueIsRemoved(y)?this.findLangS("text","valueIsRemoved"):y.data.set&&r.valueIsSetInJson(y)?this.findLangS("text","valueIsSetInActiveRun"):y.data.set&&r.valueIsSetInDb(y)?this.findLangS("text","valueIsSetInDatabase"):y.data.set_in_config?this.findLangS("text","valueIsSetInConfiguration"):"icon_blank")
},scope:this}]}],viewConfig:{stripeRows:false,markDirty:false,listeners:{scope:this,cellcontextmenu:function(w,u,y,v,A,B,z){z.stopEvent()
},render:function(u){u.tip=Ext.create("Ext.tip.ToolTip",{target:u.el,delegate:"td.x-grid-cell",trackMouse:true,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,listeners:{scope:this,beforeshow:function(B){var A=u.getHeaderByCell(B.triggerElement);
var w=Ext.fly(B.triggerElement);
var C=w&&w.up(".x-grid-row");
var v=C&&u.getRecord(C);
var z=this.grid.getSelectionModel().getSelection();
if(!v||z.length&&z[0].internalId==v.internalId){B.update(null);
return
}var y=null;
if(v&&A.xtype!="actioncolumn"){y=this.getHelp(v)
}B.update(y?y:null)
}}})
},groupclick:function(u,v,w){this.completeGridEdit();
this.grid.getSelectionModel().deselectAll()
}},onFocusEnter:function(){},onFocusLeave:function(){}},plugins:[this.cellEditing],features:[{ftype:"grouping",groupHeaderTpl:"{[this.owner.view.grid.ownerCt.renderGroup(values)]}"}],tbar:[this.findLangS("field","level")+":",this.comboLevel,"-",this.findLangS("field","showDefaultItems")+":",this.checkBoxShowDefaultItems,"->",{xtype:"SearchFieldX",name:"filter",value:this.filterString,_gridForm:true,onChangeValue:function(u){this.filterString=u;
this.refreshFilter()
},onChangeValueScope:this,width:__width_ColumnChar(40)}],border:true,hideHeaders:true,region:"center",bufferedRenderer:false});
this.grid.selModel.on("selectionchange",l,this);
this.grid.on("beforecellmousedown",function(y,C,v,u,z,B,A,w){if(r.enableGridEditor(u)&&r.grid.view.getColumnManager().getColumns()[v].dataIndex=="value"&&r.cellEditing.editing&&r.cellEditing.context&&r.cellEditing.context.record&&r.cellEditing.context.record.id!=u.id){this._autoStartGridEditRecord=u
}else{if(this._autoStartGridEditRecord){delete this._autoStartGridEditRecord
}}},this);
var q=[this.grid];
this.info=new Ext.Panel({height:80,border:true,region:"south",autoScroll:true,style:{"padding-top":3,"background-color":__color_WindowFrame}});
q.push(this.info);
b=Ext.applyIf(b||{},{layout:"border",items:q,buttons:{items:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:function(){if(this.save({panel:this,grid:this.grid,window:this.ownerCt})){this.ownerCt.close()
}}},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}],style:{"background-color":__color_WindowFrame,padding:5,marginTop:0}},buttonAlign:"center",border:false,windowTitle:this.findLangS("title","sensorConfiguration")+" - "+b.sensorData.name+(b.typeConfiguration=="direct"||b.typeConfiguration=="database"?" / "+this.findLangS("title",b.typeConfiguration=="direct"?"suffixDirectConfiguration":"suffixDatabaseConfiguration"):""),windowIconCls:b.typeConfiguration=="direct"?"icon_wrench_orange":"icon_wrench",width:Math.min(700,Ext.dom.Element.getViewportWidth()*3/5),height:Ext.dom.Element.getViewportHeight()*4/5,windowWikiId:"Settings#Sensor_configuration",listeners:{scope:this,afterrender:function(){this.setFilter();
this.refreshGrid()
}}});
this.callParent([b]);
if(b.autoCreateWindow){var p=new Ext.Window({title:this.windowTitle,iconCls:this.windowIconCls,layout:"fit",items:this,border:false,modal:true,closable:true,resizable:false,wikiId:this.windowWikiId});
p.show()
}function g(v){r.cellEditing._record=v;
r.cellEditing._selectEdit=false;
r.cellEditing._type=null;
r.cellEditing.editors.clear();
if(v.data.read_only){return(false)
}var A=false;
var y=false;
switch(v.data.type){case"yesno":A=true;
break;
case"integer":if(!r.cellEditing._forceEdit){A=true
}y=true;
break;
case"ip":case"float":case"hour_interval":case"ip_port":y=true;
break;
case"string":if(v.data.name!="interface"){y=true
}break;
case"type_compress_stream":case"type_compress_fileziphandle":A=true;
break
}var w=false;
if(A){var z=r.getEditItemComboConfigFromRec(v,true);
if(z){w=z;
if(w._checkBoxYesNo){w.xtype="checkbox";
r.cellEditing._type="checkBoxYesNo"
}else{w.xtype="ComboBoxA"
}}}if(y&&!w){var u=r.getEditItemTextConfigFromRec(v,true);
if((r.cellEditing._forceEdit||u.maxValue)&&!Ext.isDefined(u.minValue)){u.minValue=0
}if(u){w=u;
if(u.maxValue||u.minValue){w.xtype="numberfield"
}else{w.xtype="textfield"
}}}if(!w){return(false)
}w.editorCfg={allowBlur:false,onFocusEnter:function(){},onFocusLeave:function(B){if(this[this.focusLeaveAction]()===false){B.event.stopEvent();
return
}this.completeEdit()
}};
return(w)
}function t(u,v){debug_log("before grid edit - "+v.record.data.name);
if(u._type=="checkBoxYesNo"){v.value=v.value==="yes"
}}function c(w,y){debug_log("after grid edit - "+y.record.data.name);
var v=y.originalValue;
if(w._type=="checkBoxYesNo"){y.record.data.value=y.value?"yes":"no";
v=v=="yes"
}var u=false;
if(y.value!=v){u=true;
r.setAndChange(y.record);
r.maskLoad()
}r.refreshRecord(y.record);
Ext.defer(function(){if(u){var A=r.getFixPositionRecord();
r.setFilter();
r.refreshGrid(A)
}if(w._selectEdit){Ext.defer(function(){r.cellEditing._forceEdit=true;
r.startGridEdit(y.record);
r.cellEditing._forceEdit=false
},10,this)
}else{if(u&&r._autoStartGridEditRecord){var z=r._autoStartGridEditRecord;
Ext.defer(function(){r.startGridEdit(z)
},10,this)
}}if(r._autoStartGridEditRecord){delete r._autoStartGridEditRecord
}if(u){r.unmask()
}},10,this)
}function o(u,v){debug_log("cancel grid edit - "+v.record.data.name)
}function n(z,u,v,A,y,w){if(v.data.subgroup_label){u.tdAttr='colspan="10"';
u.tdCls="no-border width-1000";
z=v.data.subgroup
}else{u.tdCls="no-border";
z=""
}return(f(z,v))
}function m(z,u,v,A,y,w){if(v.data.subgroup_label){z=""
}else{if(v.data.description){z=v.data.description
}if(v.data.subgroup_end){u.tdCls="no-border"
}}if(z&&v.data.level){z="("+(v.data.level==1?"A":v.data.level==2?"E":"O")+") "+z
}return(f(z,v))
}function s(z,u,v,A,y,w){if(v.data.subgroup_label){z=""
}else{if(v.data.subgroup_end){u.tdCls="no-border"
}}return(r.renderValue(z,v,u))
}function f(v,u){return(r.renderGridString(v,u))
}function l(u,w){debug_log("selection change"+((w&&w.length==1)?" "+w[0].data.name:""));
var v="";
if(w&&w.length==1){v=this.getHelp(w[0])
}if(this.info){this.info.body.setHtml('<div style="padding:5;">'+v+"</div>")
}}},getRecordForItem:function(b){var a=this.store.findBy(function(c){return(c.data.name==b)
});
if(a<0){return(false)
}return(this.store.getAt(a))
},refreshGrid:function(b){var c=this.grid.view.getEl().dom.scrollTop;
this.setSubGroupEnd();
this.grid.view.refresh();
var a=false;
if(!this.setFixPositionRecord(b)){this.grid.view.getEl().dom.scrollTop=c
}},refreshRecord:function(a){this.grid.view.refreshNode(this.grid.store.indexOf(a))
},setSubGroupEnd:function(){for(var c=0;
c<this.store.getCount();
c++){var a=this.store.getAt(c);
var b=false;
if(c<this.store.getCount()-1){var d=this.store.getAt(c+1);
if(a.data.group_subgroup_id!=d.data.group_subgroup_id){b=true
}}else{b=true
}a.data.subgroup_end=b
}},setFilter:function(){var a=this.grid.getSelectionModel().getSelection();
if(a.length){this._actRecord_id=a[0].id
}this.store.clearFilter();
this.store.filter([Ext.create("Ext.util.Filter",{filterFn:Ext.bind(this.storeFilter,this),root:"data"})]);
if(this._actRecord_id){delete this._actRecord_id
}},storeFilter:function(a){if(!a){return(false)
}if(a.data.subgroup_label){var b=this.getRecordsInSubgroup(a.data.group_subgroup_id);
for(var c=0;
c<b.length;
c++){if(this._storeFilter(b[c])){return(true)
}}return(false)
}else{return(this._storeFilter(a))
}},_storeFilter:function(a){return(this._actRecord_id&&this._actRecord_id==a.id||((this.filterString?a.data.name&&a.data.name.match(this.filterString):(a.data.always_show||(a.data.level<=this.selectLevel&&((a.data.set&&!this.valueIsDefaultInConfig(a))||this.showDefaultItems||a.data.read_only))))&&this._enableIfFilter(a)))
},_enableIfFilter:function(a){if(!a.data.disable_if||!a.data.disable_if.split){return(true)
}var g=a.data.disable_if.split("|");
for(var d=0;
d<g.length;
d++){var c=g[d];
var b=null;
var k=null;
var h=null;
if(c.match("=")){b="="
}else{if(c.match("!")){b="!"
}}if(b){fieldValue=c.split(b);
if(fieldValue.length==2){k=fieldValue[0];
h=fieldValue[1]
}}if(k){var a=this.store.getAt(this.store.find("name",k));
if(a){var f=a.data.value;
if(b=="="?f==h:b=="!"?f!=h:false){return(false)
}}}}return(true)
},refreshFilter:function(){this.completeGridEdit();
this.selectLevel=this.comboLevel.getValue();
this.showDefaultItems=this.checkBoxShowDefaultItems.getValue();
var a=this.getFixPositionRecord();
this.setFilter();
this.refreshGrid(a)
},getRecordsInSubgroup:function(b){var a=[];
this.grid.store.each(function(c){if(!c.data.subgroup_label&&c.data.group_subgroup_id==b){a.push(c)
}});
return(a)
},enableGridEditor:function(a){return(!a.data.subgroup_label&&a.data.name!="interface"&&["yesno","integer","ip","float","hour_interval","ip_port","string","type_compress_stream","type_compress_fileziphandle"].isIn(a.data.type))
},startGridEdit:function(b){if(this.enableGridEditor(b)){var a=new Ext.grid.CellContext(this.grid.view).setPosition(b,2);
this.grid.view.activateCell(a)
}if(this._autoStartGridEditRecord){delete this._autoStartGridEditRecord
}},completeGridEdit:function(){this.cellEditing.completeEdit()
},enableGridTableEditor:function(a){return(!a.data.subgroup_label&&(a.data.name=="interface"||["string_list","ports","hosts","ip_port_list","ip_port_str_list","nat_aliases_list","custom_headers_list"].isIn(a.data.type)))
},renderGroup:function(a){return(a.rows[0].data.group.toUpperCase())
},renderValue:function(m,h,p){if(!m||!Ext.isString(m)||m*1&&h.data.menu_value){var c=this.getMenuComboFromRec(h);
if(c&&c.length){for(var g=0;
g<c.length;
g++){if(c[g].value_int==m*1){return(this.renderGridString(c[g].str,h))
}}}}switch(h.data.name){case"id_sensor":return(this.renderGridString(m>0?m:"local",h))
}switch(h.data.type){case"yesno":if(h.data.menu=="yes:1;no:0"){if(this.enableCheckBoxYesNo){if(h.data.value=="yes"){p.style="padding: 0; padding-left: 5px;";
return("<img src=images/tick_small_"+(h.data.set?"black":"grey")+".png>")
}else{return("")
}}else{m=h.data.value
}}break;
case"integer":if(h.data.subtype=="port"&&!(m*1)){m=null
}break;
case"ip":if(!this.validIp(m)){m=null
}break;
case"string":if(h.data.name=="interface"){var b=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(b,h,p)
}break;
case"string_list":var a=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(a,h,p);
break;
case"hour_interval":if(!this.validHourInterval(m)){m=null
}break;
case"ports":var f=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(f,h,p);
break;
case"hosts":var k=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(k,h,p);
break;
case"ip_port":if(!this.validIpPort(m)){m=null
}break;
case"ip_port_list":var d=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(d,h,p);
break;
case"ip_port_str_list":var l=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(l,h,p);
break;
case"nat_aliases_list":var o=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(o,h,p);
break;
case"custom_headers_list":var n=this.eexplodeValue(m,h.data.type,h.data.name);
m=this.renderTableItems(n,h,p);
break
}return(this.renderGridString(m,h))
},renderGridString:function(d,a){var c={};
if(a.data.subgroup_label){Ext.apply(c,{color:"#616161",bold:true})
}else{if(a.data.name!="id_sensor"){var b=(a.data.set&&!this.valueIsDefaultInConfig(a))||a.data.read_only||a.data.always_show?undefined:"#606060";
Ext.apply(c,{color:b})
}}return(renderStringStyle(d,c))
},renderTableItems:function(h,f,m){var l=true;
var d=true;
m.style="padding: 0; padding-left: 6px;";
var k=this;
var a="";
if(!(f.data.set&&!this.valueIsDefaultInConfig(f))){a+="color: #616161;"
}var n='<table cellpadding=0 cellspacing=0 border=0 style="font: '+__font_Grid+";"+a+'; width: 100%;">';
if(h){for(var b=0;
b<h.length;
b++){if(f.data.type!="ports"||!(b%2)){n+="<tr>"
}n+='<td style="border-bottom: 1px solid #EEE; width: 50%; '+(f.data.type=="ports"&&(b%2)?"padding-left: 3px;":"")+'">'+h[b];
if(d){n+='<td style="border-bottom: 1px solid #EEE; width: 20px; text-align: right;">';
var g='<img src=images/icon/delete_small.png style="cursor: pointer;" tab_value="'+h[b]+'" tab_item="'+f.data.name+'" panel_id='+k.id+' onclick="Ext.getCmp(this.attributes.panel_id.nodeValue).deleteTableItem(this.attributes.tab_value.nodeValue, this.attributes.tab_item.nodeValue);" >';
n+=g
}if(f.data.type=="ports"&&!(b%2)){n+='<td style="border-bottom: 1px solid #EEE; border-right: 1px solid #EEE;">'
}}if(f.data.type=="ports"&&h.length==1){n+='<td style="border-bottom: 1px solid #EEE; width: 50%; padding-left: 3px;">&nbsp<td style="border-bottom: 1px solid #EEE; width: 20px; text-align: right;"><img src=images/icon/delete_small.png style="visibility: hidden;">'
}}if(l){n+='<tr><td colspan=10 style="text-align: center; padding-top: 2px; padding-bottom: 2px;">';
var c='<img src=images/icon/add_small.png style="cursor: pointer;" tab_item="'+f.data.name+'" panel_id='+k.id+' onclick="Ext.getCmp(this.attributes.panel_id.nodeValue).addTableItem(this.attributes.tab_item.nodeValue);" >';
n+=c
}n+="</table>";
return(n)
},addTableItem:function(n){var b=this.getRecordForItem(n);
if(!b){return
}var g=this;
var d="text";
var k=this.getEditItemComboConfigFromRec(b);
if(k){d="combo"
}else{k=this.getEditItemTextConfigFromRec(b)
}Ext.apply(k,{name:"new_item",fieldLabel:this.findLangS("field","newItem").template([n]),width:__width_FormChar(30,40),labelWidth:__width_FieldChar(30),evKey:f,evSelect:h});
var a=new Ext.FormPanel({frame:true,items:[d=="combo"?new Ext.ux.combobox.ComboBoxA(k):(k.maxValue||k.minValue?new Ext.form.field.Number(k):new Ext.form.field.Text(k))],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",handler:m,disabled:true},{text:lang.cancelButtonText,iconCls:"icon_cancel",handler:l}],listeners:{afterrender:function(o){focusField=o.getForm().findField("new_item");
if(focusField){focusField.focus(false,200)
}Ext.create("Ext.util.KeyNav",o.el,{enter:function(){m()
}})
}}});
var c=new Ext.Window({title:this.findLangS("title","addItem").template([n]),items:a,layout:"fit",border:false,modal:true});
c.show();
function m(){var o=a.getForm().findField("new_item").getValue();
if(g.validItem(b.data.type,o)&&g.addItem(n,o)){c.close()
}}function l(){c.close()
}function f(q,o,p){var r=a.dockedItems.get(0).findC("text",lang.okButtonText);
if(r){r.enableIf(p)
}}function h(p,o){var q=a.dockedItems.get(0).findC("text",lang.okButtonText);
if(q){q.enableIf(o)
}}},addItem:function(f,d,c){var a=this.getRecordForItem(f);
if(!a){return(false)
}var b=this.eexplodeValue(a.data.value,a.data.type,f);
if(!b||!Ext.isArray(b)){b=[]
}else{if(b.inArray(d)){if(!c){Ext.Msg.alert("",this.findLangS("text","duplicityItemPrefix")+" "+f+" "+d)
}return(false)
}}b.push(d);
a.data.value=b.join(";");
this.setAndChange(a);
this.refreshGrid();
return(true)
},deleteTableItem:function(b,a){this.deleteItem(a,b)
},deleteItem:function(h,g,d,f){var b=this.getRecordForItem(h);
if(!b){return(false)
}var c=this.eexplodeValue(b.data.value,b.data.type,h);
if(c.inArray(g)){if(d||f){var a=c.indexOf(g);
c.splice(a,1);
b.data.value=c.length?c.join(";"):null;
this.setAndChange(b);
this.refreshGrid();
return(true)
}else{if(!f){Ext.Msg.confirm("",this.findLangS("text","deleteItemPrefix")+" "+h+" "+g+"?",function(k){if(k=="yes"){this.deleteItem(h,g,d,true)
}},this)
}}}return(false)
},getEditItemTextConfigFromRec:function(a,b){return(this.getEditItemTextConfig(a.data.type,a.data,b))
},getEditItemTextConfig:function(c,g,b){var f=this;
var a={enableKeyEvents:true,listeners:{keyup:d,keydown:d},isValid:function(){var h=this.getValue();
return(!h||f.validItem(c,h))
}};
if(g){if(g.password){a.inputType="password"
}if(g.maximum){a.maxValue=g.maximum
}if(g.minimum){a.minValue=g.minimum
}}return(a);
function d(l){var k=false;
l.validate();
var h=l.getValue();
if(!h||f.validItem(c,h)){l.clearInvalid();
k=true
}else{l.markInvalid("invalid content")
}if(l.evKey){l.evKey(l,h,k)
}}},getEditItemComboConfigFromRec:function(a,b){return(this.getEditItemComboConfig(a.data.type,a.data.name,a.data.menu,a.data.value,b,a.data))
},getEditItemComboConfig:function(p,b,r,q,d,l){var o=this;
var a=this.getMenuCombo(p,b,r,q,l);
if(a&&a.length){var g=[];
var h=false;
for(var k=0;
k<a.length;
k++){g.push([a[k].str,a[k].value,a[k].type]);
if(a[k].value){h=true
}}var f={editable:false,aData:{data:g,fields:["str","value","type"]},valueField:h?"value":"str",displayField:"str",_stringValue:true,_checkBoxYesNo:this.enableCheckBoxYesNo&&p=="yesno"&&a.length==2&&a[0].str=="yes"&&a[1].str=="no"};
if(f._checkBoxYesNo){Ext.applyIf(f,{checked:q=="yes"})
}if(d){Ext.apply(f,{listeners:{afterrender:function(s){if(s._checkBoxYesNo){s.getEl().down(".x-form-item-body").setStyle({"text-align":"left","padding-left":5})
}else{Ext.defer(function(){s.expand()
},10)
}},collapse:c,select:c,change:n}})
}else{Ext.apply(f,{listeners:{select:m}})
}return(f)
}return(null);
function c(s){if(l&&l.type=="integer"&&!l.only_menu&&!l.menu_value&&(s.getValue()*1==s.getValue()||s.getValue()=="value")){o.cellEditing._selectEdit=true;
o.completeGridEdit()
}else{if(s.xtype=="ComboBoxA"){o.completeGridEdit()
}}}function n(s){if(s.xtype&&s.xtype.match&&s.xtype.match(/^checkbox/)){o.completeGridEdit()
}}function m(s){if(s.evSelect){s.evSelect(s,s.getValue())
}}},getMenuComboFromRec:function(a){return(this.getMenuCombo(a.data.type,a.data.name,a.data.menu,a.data.value,a.data))
},getMenuCombo:function(k,b,m,l,g){var c=[];
switch(k){case"yesno":case"integer":if(!m||!m.eexplode){break
}var n=false;
var h=0;
var a=m.eexplode(";",true);
for(var f=0;
f<a.length;
f++){var d=a[f].eexplode(":",true);
if(d.length==2){c.push({str:d[0],value:g&&g.menu_value?d[1]*1:d[0],value_int:d[1]*1,type:"menu"});
if(l==d[0]){n=true
}if(d[1]>h){h=d[1]*1
}}}if(c.length&&k=="integer"&&(!g||!g.only_menu)){if(l&&!n){c.push({str:l,value:l,value_int:l*1,type:"integer"})
}else{c.push({str:"value",value:h+1,value_int:h+1,type:"integer"})
}}break;
default:if(!c.length&&m&&m.eexplode){var a=m.eexplode(";",true);
for(var f=0;
f<a.length;
f++){c.push({str:a[f]})
}}break
}return(c.length?c:null)
},valueIsInMenuExtendFromRec:function(a){return(this.valueIsInMenuExtend(a.data.type,a.data.name,a.data.menu,a.data.value))
},valueIsInMenuExtend:function(c,b,a,f){if(c!="integer"){return(false)
}var g=this.getMenuCombo(c,b,a,f);
if(g&&g.length){var d=g[g.length-1];
if(d.type=="integer"){return(true)
}}return(false)
},validItem:function(a,b){switch(a){case"yesno":return(true);
case"integer":return(this.validInteger(b));
case"ip":return(this.validIp(b));
case"float":return(this.validFloat(b));
case"string":case"string_list":return(true);
case"hour_interval":return(this.validHourInterval(b));
case"ports":return(this.validPort(b)||this.validPortRange(b));
case"hosts":return(this.validHost(b));
case"ip_port":case"ip_port_list":return(this.validIpPort(b));
case"ip_port_str_list":return(this.validIpPortStr(b));
case"nat_aliases_list":return(this.validNatAlias(b));
case"custom_headers_list":return(true);
case"type_compress_stream":case"type_compress_fileziphandle":return(true)
}},validInteger:function(a){return(a*1==parseInt(a))
},validFloat:function(a){return(a*1==a)
},validIp:function(a){return(ip_is_valid(a))
},validMaskLength:function(a){return(a*1==a&&a>=0&&a<=32)
},validPort:function(a){return(a*1==a&&a>0&&a<=65535)
},validPortRange:function(b){var a=b.split("-");
return(a.length>=2&&this.validPort(a[0].trim())&&this.validPort(a[1].trim()))
},validIpPort:function(c){if(!c||!Ext.isString(c)){return(false)
}var f=skip_ip(c);
if(f){var d=f[0];
var b=skip_separators(f[1],": \t");
var a=b[0];
return(this.validIp(d)&&this.validPort(a))
}return(false)
},validHour:function(a){return(a*1==a&&a>=0&&a<=23)
},validHourInterval:function(a){if(!a||!Ext.isString(a)){return(false)
}hourIntervalA=a.eexplode("-",true);
return(hourIntervalA.length==2&&this.validHour(hourIntervalA[0])&&this.validHour(hourIntervalA[1]))
},validHost:function(a){if(!a||!Ext.isString(a)){return(false)
}hostA=a.eexplode("/",true);
return(hostA.length>0&&this.validIp(hostA[0])&&(hostA.length==1||this.validMaskLength(hostA[1])))
},validIpPortStr:function(f){if(!f||!Ext.isString(f)){return(false)
}var d=skip_ip(f);
if(d){var c=d[0];
var a=skip_separators(d[1],": \t");
var b=a[0];
port_strA=b.eexplode(" ",true);
return(port_strA.length>=1&&port_strA.length<=2&&this.validIp(c)&&this.validPort(port_strA[0]))
}return(false)
},validNatAlias:function(b){if(!b||!Ext.isString(b)){return(false)
}var f=skip_ip(b);
if(f){var d=f[0];
var a=skip_separators(f[1],":= \t");
f=skip_ip(a[0]);
if(f){var c=f[0];
return(this.validIp(d)&&this.validIp(c))
}}return(false)
},eexplodeValue:function(c,b,a){if(!c||!c.eexplode){return(null)
}switch(b){case"string":if(a=="interface"){return(c.eexplode([",",";",":"," "],true))
}break;
case"string_list":return(c.eexplode(";",true));
case"ports":return(c.eexplode([",",";"],true,function(d){return(this.validPort(d)||this.validPortRange(d)?d:null)
},this));
case"hosts":return(c.eexplode(";",true,function(d){return(this.validHost(d)?d:null)
},this));
case"ip_port_list":return(c.eexplode(";",true,function(d){return(this.validIpPort(d)?d:null)
},this));
case"ip_port_str_list":return(c.eexplode(";",true,function(d){return(this.validIpPortStr(d)?d:null)
},this));
case"nat_aliases_list":return(c.eexplode(";",true,function(d){return(this.validNatAlias(d)?d:null)
},this));
case"custom_headers_list":return(c.eexplode(";",true))
}return(null)
},save:function(a){this.completeGridEdit();
this.setSensorConfiguration(a)
},setSensorConfiguration:function(a){var b=this.getConfiguration();
if(!b||!b.length){a.window.close();
return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setSensorConfiguration",params:Ext.encode({host:this.sensorData.host,port:this.sensorData.port,id_sensor:this.sensorData.id_sensor,read_timeout:this.sensorData.read_timeout,configuration:b,typeConfiguration:this.sensorNextData&&this.sensorNextData.setFromMysqlOk?"both":"direct"})},success:function(c){a.window.close();
if(c.apply_new_configuration){this.sensorsGrid.deferReload(10000,lang.applyNewConfigurationToSensor+" "+this.sensorData.name)
}},maskEl:this})
},getConfiguration:function(){configuration=[];
this.store.each(function(a){if(a.data.set&&a.data.state=="set"&&a.data.value!=a.data.value_old){configuration.push({name:a.data.name,value:a.data.value,set:1})
}else{if(a.data.set&&a.data.state=="remove"&&(a.data.set_in_db!=a.data.set_in_db_old||a.data.set_in_json!=a.data.set_in_json_old)){configuration.push({name:a.data.name,value:a.data.value,set:0})
}}});
return(configuration)
},getFixPositionRecord:function(g){var c=null;
var a=this.grid.view.getEl().getTop();
var b=this.grid.view.getEl().getBottom();
if(g){c=this.grid.store.indexOf(g)
}else{var l=this.grid.getSelectionModel().getSelection();
if(l.length){c=this.grid.store.indexOf(l[0]);
if(c<0){this.grid.getSelectionModel().deselectAll()
}}}if(c===null||c<0){for(var f=0;
f<this.grid.store.getCount();
f++){var m=Ext.fly(this.grid.view.getNode(this.grid.store.getAt(f)));
if(m){var k=m.getRegion().top;
if(k>=a){c=f;
break
}}}}if(!this.storeFilter(this.grid.store.getAt(c))){var f=j=c;
var h=false;
do{--f;
++j;
var d=0;
if(f>=0){var m=Ext.fly(this.grid.view.getNode(this.grid.store.getAt(f)));
if(m&&m.getRegion().top>=a){++d;
if(this.storeFilter(this.grid.store.getAt(f))){c=f;
h=true;
break
}}}if(j<this.grid.store.getCount()){var m=Ext.fly(this.grid.view.getNode(this.grid.store.getAt(j)));
if(m&&m.getRegion().bottom<=a){++d;
if(this.storeFilter(this.grid.store.getAt(j))){c=j;
h=true;
break
}}}}while(d);
if(!h){c=null
}}if(c!==null){var g=this.grid.store.getAt(c);
return({record_id:g.data.id,top:Ext.fly(this.grid.view.getNode(this.grid.store.getAt(c))).getRegion().top-a})
}return(null)
},setFixPositionRecord:function(c){if(c&&c.record_id){var a=null;
for(var b=0;
b<this.store.getCount();
b++){var d=this.grid.store.getAt(b);
if(d.data.id==c.record_id){a=d;
break
}}if(a){var f=Ext.fly(this.grid.view.getNode(a)).getRegion().top-this.grid.view.getEl().getTop();
this.grid.view.getEl().dom.scrollTop+=f-c.top;
return(true)
}}return(false)
},getHelp:function(a){if(!a||a.data.subgroup_label){return(null)
}return((window.debug?"name: "+a.data.name+"<br>type: "+a.data.type+"<br>":"")+(a.data.help||""))
},editIsDisabled:function(a){return(a.data.subgroup_label||a.data.read_only||a.data.always_show)
},setAndChange:function(a){a.data.set=true;
a.data.state="set"
},valueIsSetAndChanged:function(a){return(a.data.set&&a.data.state=="set")
},valueIsRemoved:function(a){return(a.data.set&&(a.data.set_in_db!=a.data.set_in_db_old||a.data.set_in_json!=a.data.set_in_json_old)&&a.data.state=="remove")
},valueIsSetInConfig:function(a){return(a.data.set_in_config)
},valueIsSetInDb:function(a){return(a.data.set_in_db)
},valueIsSetInJson:function(a){return(a.data.set_in_json)
},valueIsDefaultInConfig:function(a){return(a.data.set&&a.data.set_in_config&&!a.data.set_in_db&&!a.data.set_in_json&&a.data.value==a.data["default"])
},isEnableUndoChange:function(a){return(this.valueIsSetAndChanged(a))
},isEnableRemoveValueFromDb:function(a){return(a.data.set&&this.valueIsSetInDb(a))
},isEnableRemoveValueFromJson:function(a){return(a.data.set&&this.valueIsSetInJson(a))
},isEnableUndoRemove:function(a){return(this.valueIsRemoved(a))
},undoChange:function(a){a.data.set=a.data.set_old;
a.data.set_in_config=a.data.set_in_config_old;
a.data.set_in_db=a.data.set_in_db_old;
a.data.set_in_json=a.data.set_in_json_old;
a.data.value=a.data.value_old;
a.data.state=null
},removeValueFromDb:function(a){a.data.value=this.valueIsSetInConfig(a)?a.data.value_in_config:a.data["default"];
a.data.set_in_db=false;
a.data.set_in_json=false;
a.data.state="remove"
},removeValueFromJson:function(a){a.data.value=this.valueIsSetInConfig(a)?a.data.value_in_config:a.data["default"];
a.data.set_in_db=false;
a.data.set_in_json=false;
a.data.state="remove"
},undoRemove:function(a){a.data.set=a.data.set_old;
a.data.set_in_config=a.data.set_in_config_old;
a.data.set_in_db=a.data.set_in_db_old;
a.data.set_in_json=a.data.set_in_json_old;
a.data.value=a.data.value_old;
a.data.state=null
}});
function fetchSensorInfo(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"fetchSensorInfo"},success:function(b){window.localSensorId=b.local_sensor;
window.localSensorIdSensor=b.local_id_sensor;
window._default_sensors_for_active_call=b.default_sensors_for_active_call;
if(Ext.isDefined(b.enable_sensors)){user.sqlrow.enable_sensors=b.enable_sensors;
user.sqlrow._count_enable_sensors=b.count_enable_sensors
}if(a){a()
}}})
}Ext.define("Settings.SensorTable.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.sensor_tablePanelX",subsystem:"sensors",constructor:function(a){a=Ext.applyIf(a||{},{id:"sensor_table-panel",title:this.findLangS("title","sensors"),gridXType:"SensorTable.GridX",wikiId:"Settings#Sensors"});
this.callParent([a])
},doUpgradeAll:function(){this.getGrid().doUpgradeAll()
},reactivate:function(){this.getGrid().loadSensors();
this.getGrid().load()
}});
Ext.define("Settings.SensorTable.Utils",{singleton:true,loadSensors:function(a){ajaxSafeRequest({scope:this,maskEl:a.disableMask?null:a.panel,url:"php/model/utilities.php",params:{task:"getSensors"},success:function(b){if(a.task=="setBtnMenuReload"&&a.panel&&a.btnId){this.setBtnMenuRealoadVm(b.sensors,a)
}}})
},setBtnMenuRealoadVm:function(h,b){var g=b.panel.getTopToolbar();
var f=g.findC("_btnId",b.btnId,true);
if(h&&h.length){var d=[{text:findLangSd("ALL"),handler:Ext.bind(this.reloadVm,null,["all",b])}];
if(window.vpmanagerhost){d.push({text:findLangSd("LOCAL"),handler:Ext.bind(this.reloadVm,null,["local",b])})
}for(var c=0;
c<h.length;
c++){var a=findLangSd("sensor")+" "+h[c].id_sensor;
if(h[c].name){a+=" ("+h[c].name+")"
}d.push({text:a,handler:Ext.bind(this.reloadVm,null,[h[c].id_sensor,b])})
}f.menu.removeAll();
f.menu.add(d);
f.handler=null;
f.btnWrap.addCls("x-btn-arrow x-btn-arrow-right");
g.updateLayout()
}else{f.menu.removeAll();
f.handler=Ext.bind(this.reloadVm,null,["all",b]);
f.btnWrap.removeCls("x-btn-arrow x-btn-arrow-right");
g.updateLayout()
}},reloadVm:function(f,b){if(!b){b={}
}if(b.evBeforeRun){b.evBeforeRun()
}if(f&&Ext.isObject(f)){f=f._id
}var a=false;
var c=null;
if(b.panel){var d=b.panel.getTopToolbar();
if(d){c=d.findC("_btnId",b.btnId,true);
a=c.iconCls=="icon_menu_reload"
}}if(a){c.setIconCls("icon_refresh_active")
}ajaxSafeRequest({maskEl:b.maskEl,url:"php/model/sql.php",params:{module:"reloadvm",sensor:f||"all"},success:function(g){if(a){c.setIconCls("icon_menu_reload")
}if(b.evResult){b.evResult(g.result)
}else{Ext.Msg.alert(lang.info+" - "+findLangSd("reloadSniffers"),g.result)
}},error:function(g){if(a){c.setIconCls("icon_menu_reload")
}if(b.evResult){b.evResult(g.error)
}else{Ext.Msg.alert(lang.info+" - "+findLangSd("reloadSniffers"),g.error)
}},failure:function(){if(a){c.setIconCls("icon_menu_reload")
}if(b.evFailed){b.evFailed()
}}})
}});
Ext.define("CommonSettings.InternationalRules",{extend:"Ext.ux.setting.Form",subsystem:"common_settings",constructor:function(a){Ext.applyIf(a,{settingTableName:"international_rules",settingTableStruct:rsInternationalRules,specItems:{international_number_min_length:{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"international_number_min_length",fieldLabel:this.findLangS("field","international_number_min_length"),minValue:1,maxValue:63,align:"right",_width:__width_FieldNum(5),helpText:"<b>"+this.findLangS("field","international_number_min_length_prefixes_strict")+"</b><br>"+this.findLangS("field_help","international_number_min_length")},{xtype:"checkbox",name:"international_number_min_length_prefixes_strict",boxLabel:this.findLangS("field","international_number_min_length_prefixes_strict"),hideLabel:true,helpText:"<b>"+this.findLangS("field","international_number_min_length_prefixes_strict")+"</b><br>"+this.findLangS("field_help","international_number_min_length"),style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},international_number_min_length_prefixes_strict:{skip:true},country_code_for_local_numbers:{xtype:"ComboBoxX",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_listVertScroller:true,_clearButton:true,_width:__width_FieldChar(30)},enable_check_napa_without_prefix:{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"enable_check_napa_without_prefix",_width:__width_FieldChar(2),fieldLabel:this.findLangS("field","enable_check_napa_without_prefix")},{xtype:"numberfield",name:"min_length_napa_without_prefix",fieldLabel:this.findLangS("field","min_length_napa_without_prefix"),minValue:1,maxValue:63,align:"right",width:__width_Form(__width_FieldChar(10),__width_FieldNum(3)+__width_Trigger),labelWidth:__width_FieldChar(10),helpText:this.findLangS("field_help","min_length_napa_without_prefix"),style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},min_length_napa_without_prefix:{skip:true}},promptSave:true,smartSaveButton:true});
this.callParent([a])
},setContext:function(){var a=this.getFieldValues();
this.enableIf("international_number_min_length_prefixes_strict",a.international_number_min_length);
this.enableIf("min_length_napa_without_prefix",a.enable_check_napa_without_prefix)
},onSaveSuccess:function(){if(this._panel&&this._panel.doTestBilling){this._panel.doTestBilling(true)
}refreshInternationalRules();
if(this.onSave){this.onSave.call(this.onSaveScope)
}}});
Ext.define("CommonSettings.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.common_settingsPanelX",subsystem:"common_settings",constructor:function(a){this.internationalRules=new CommonSettings.InternationalRules({_panel:this,title:this.findLangS("title","internationalRulesTab")});
this.countryPrefixTable=new Tools.CountryPrefixTable.Grid({title:findLangS("setting_customer_country_prefix","title","country_prefixes_rules")});
a=Ext.applyIf(a||{},{id:"common_settings-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.internationalRules,this.countryPrefixTable],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"commonSettings",wikiId:"CommonSettings"});
this.callParent([a])
}});
function refreshInternationalRules(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshInternationalRules"},success:function(){},error:function(){}})
}function refreshCountryDetect(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshCountryDetect"},success:function(){},error:function(){}})
}Ext.define("Settings.GeoIP_customerType.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.GeoIP_customerType.GridX",subsystem:"setting_geoip_customer",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"GeoIP_customerTypeStore",url:"php/model/sql.php",module:"geoip_customer_type",keyField:"id",recordStruct:rsGeoipCustomerType,sortField:"descr",remoteSort:true,pageSize:30,columns:[{dataIndex:"descr",widthCh:30},{dataIndex:"latitude",headerLang:"lat_lng",widthCh:20,sortable:false,renderer:b},{dataIndex:"country_name",widthCh:20,sortable:false},{dataIndex:"note",widthCh:50}],fullColumnSize:"note",fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:[{xtype:"textfield",name:"descr",allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"latitude",fieldLabelLang:"latitude_longitude",widthNum:8,allowDecimals:true},{xtype:"textfield",name:"longitude",widthNum:8,allowDecimals:true,hideLabel:true,style:{marginLeft:__width_FieldSeparator}},{xtype:"button",iconCls:"icon_google_maps",width:22,scope:this,handler:this.setLatLngFromMap,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}},{name:"country_code",xtype:"ComboBoxX",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true},{xtype:"textarea",name:"note"}],propRecordText:function(c){return(c.descr)
},enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Settings.GeoIP_customerType.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],prefixCls:"geoip_type"});
this.callParent([a]);
function b(k,f,d,l,h,g,c){return(d.data.latitude&&d.data.longitude?d.data.latitude+" / "+d.data.longitude:"")
}},onChangeRecords:function(){this._change=true;
refreshCountryDetect()
},setLatLngFromMap:function(){var b=this.getValueField("latitude");
var a=this.getValueField("longitude");
new GMap.SelectPosPanel({pos:!Ext.isEmpty(b)&&!Ext.isEmpty(a)?{lat:parseFloat(b),lng:parseFloat(a)}:undefined,onOk:function(c){if(c){this.setValueField("latitude",c.lat);
this.setValueField("longitude",c.lng);
return(true)
}return(false)
},onOkScope:this,backgroundColor:__color_WindowFrame,windowConfig:{autoShow:true,width:800,height:600}})
}});
Ext.define("Settings.GeoIP_customerType.GridExpPanel",{extend:"Ext.Panel",subsystem:"setting_geoip_customer",constructor:function(a){this.geoipCustomer=new Settings.GeoIP_customer.Grid({title:this.findLangS("title","ip_network"),relFields:{type_id:a.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},decWidthColumn:2,parentGrid:a.grid,parentRecord:a.record});
this.tabPanel=new Ext.TabPanel({items:this.geoipCustomer,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"geoip_type-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Settings.GeoIP_customer.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.GeoIP_customer.GridX",subsystem:"setting_geoip_customer",constructor:function(a){var d=[{dataIndex:"ip",widthCh:40,sortable:true,renderer:c}];
if(!a.parentRecord.data.latitude&&!a.parentRecord.data.longitude){d.push({dataIndex:"latitude",headerLang:"lat_lng",widthCh:20,sortable:false,renderer:b})
}if(!a.parentRecord.data.country_code){d.push({dataIndex:"country_name",widthCh:20,sortable:false})
}d.push({dataIndex:"descr",widthCh:30},{dataIndex:"note",widthCh:50});
a=Ext.applyIf(a||{},{storeId:"GeoIP_customerStore",url:"php/model/sql.php",module:"geoip_customer",keyField:"id",recordStruct:rsGeoipCustomer,sortField:"ip",remoteSort:true,pageSize:30,columns:d,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(k,g,h,f){items=[{name:"ip",allowBlank:false,widthChar:35,enableKeyEvents:true},{xtype:"numberfield",name:"mask",_width:__width_FieldNum(3)+__width_Trigger,minValue:8,maxValue:32,allowDecimals:false,step:1}];
if(!this.parentRecord.data.latitude&&!this.parentRecord.data.longitude){items.push({xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"latitude",fieldLabelLang:"latitude_longitude",allowBlank:false,widthNum:8,allowDecimals:true},{xtype:"textfield",name:"longitude",allowBlank:false,widthNum:8,allowDecimals:true,hideLabel:true,style:{marginLeft:__width_FieldSeparator}},{xtype:"button",iconCls:"icon_google_maps",width:22,scope:this,handler:this.setLatLngFromMap,style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}})
}if(!this.parentRecord.data.country_code){items.push({name:"country_code",xtype:"ComboBoxX",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true})
}items.push({xtype:"textfield",name:"descr"},{xtype:"textarea",name:"note"});
return(items)
},propRecordText:function(f){return(ip_mask_text(f.ip,f.mask))
},enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false});
this.callParent([a]);
function c(m,h,g,n,l,k,f){return(ip_mask_text(m,g.data.mask))
}function b(m,h,g,n,l,k,f){return(g.data.latitude+" / "+g.data.longitude)
}},onChangeRecords:function(){this.parentGrid._change=true;
refreshCountryDetect()
},setContextItems:function(f,d,b,k,c,a,g){if(k&&k.name=="ip"){var h=ip_is_v6(this.getValueField("ip"));
var l=this.getField("mask");
l.maxValue=h?128:32
}},setLatLngFromMap:function(){var b=this.getValueField("latitude");
var a=this.getValueField("longitude");
new GMap.SelectPosPanel({pos:!Ext.isEmpty(b)&&!Ext.isEmpty(a)?{lat:parseFloat(b),lng:parseFloat(a)}:undefined,onOk:function(c){if(c){this.setValueField("latitude",c.lat);
this.setValueField("longitude",c.lng);
return(true)
}return(false)
},onOkScope:this,backgroundColor:__color_WindowFrame,windowConfig:{autoShow:true,width:800,height:600}})
}});
Ext.define("Settings.GeoIP_customer.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.geoip_customerPanelX",subsystem:"setting_geoip_customer",constructor:function(a){a=Ext.applyIf(a||{},{id:"geoip_customer-panel",titleLang:"panel",gridXType:"GeoIP_customerType.GridX"});
this.callParent([a])
}});
Ext.define("Settings.IpaccCaptIp.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.IpaccCaptIp.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"IpaccCaptIpStore",url:"php/model/sql.php",module:"ipacc_capt_ip",keyField:"id",recordStruct:rsIpaccCaptIp,sortField:"ip",remoteSort:true,pageSize:30,columns:[{header:this.LipNetText,dataIndex:"ip",widthCh:40,sortable:true,renderer:b},{header:this.LenableText,dataIndex:"enable",widthCh:13,renderer:renderCheckBox},{header:this.LnoteText,dataIndex:"note",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20},fpItems:[{fieldLabel:this.LipText,name:"ip",helpText:this.LipHelp,allowBlank:false,widthChar:35},{xtype:"numberfield",fieldLabel:this.LmaskText,name:"mask",helpText:this.LmaskHelp,_width:__width_FieldNum(3)+__width_Trigger,minValue:16,maxValue:32,allowDecimals:false,step:1},{xtype:"checkbox",fieldLabel:this.LenableText,name:"enable",helpText:this.LenableHelp},{xtype:"textarea",fieldLabel:this.LnoteText,name:"note",helpText:this.LnoteHelp}],propRecordText:function(c){return(ip_mask_text(c.ip,c.mask))
},getDefaultValues:function(){return({mask:32,enable:true})
},enableEdit:true,enableSearchX:true,enableExportCsv:true,enableImportCsv:true,paginatorPrependButtons:true,paginatorDisplayInfo:false});
this.callParent([a]);
function b(k,f,d,l,h,g,c){return(ip_mask_text(k,d.data.mask))
}},setContextItems:function(f,d,b,k,c,a,g){if(k&&k.name=="ip"){var h=ip_is_v6(this.getValueField("ip"));
var l=this.getField("mask");
l.maxValue=h?128:32
}}});
Ext.override(Settings.IpaccCaptIp.Grid,{LipNetText:"IP address / network",LipText:"IP address",LipHelp:"IP address or network.",LmaskText:"Network mask [16-32]",LmaskHelp:"Network mask from 16 - 32. 32 represents single IP adress. If you want to add whole 192.168.C.D network just add IP adress 192.168.0.0 and mask 16",LenableText:"Enable",LenableHelp:"",LnoteText:"Note",LnoteHelp:""});
Ext.define("Settings.IpaccCaptIp.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.ipacc_capt_ipPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"ipacc_capt_ip-panel",gridXType:"IpaccCaptIp.GridX"});
this.callParent([a])
}});
Ext.override(Settings.IpaccCaptIp.Panel,{titleText:"IPACC - next capture ip"});
Ext.define("Settings.IpaccConfigResellers.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.IpaccConfigResellers.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"IpaccConfigResellersStore",url:"php/model/sql.php",module:"ipacc_config_resellers",keyField:"id",recordStruct:rsIpaccConfigResellers,sortField:"reseller",remoteSort:true,pageSize:30,columns:[{header:this.LresellerIdText,dataIndex:"reseller",widthCh:20,sortable:true},{header:this.LlogoText,widthCh:8,renderer:b,align:"center"},{header:this.LdescrText,dataIndex:"descr",widthCh:40},{header:this.LappHeaderText,dataIndex:"app_header_text",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:40,labelCh:12,disableAutoAddTriggerWidth:true},fpItems:[{xtype:"CBX_custReseller",fieldLabel:this.LresellerText,name:"reseller",_stringValue:true,allowBlank:false},{fieldLabel:this.LdescrText,name:"descr"},{fieldLabel:this.LappHeaderText,name:"app_header_text"},{xtype:"fieldset",title:this.LcolorThemeShiftText,items:[{xtype:"colorpickerfield",name:"uc_color_theme_shift",fieldLabel:"HSV",_width:__width_FieldChar(7)+__width_Trigger*2},{xtype:"numberfield",name:"uc_color_theme_shift_h",fieldLabel:"H",widthNum:6,minValue:0,maxValue:359,step:10,enableKeyEvents:true},{xtype:"numberfield",name:"uc_color_theme_shift_s",fieldLabel:"S+",widthNum:6,minValue:0,maxValue:30,step:5,enableKeyEvents:true},{xtype:"numberfield",name:"uc_color_theme_shift_v",fieldLabel:"V+",widthNum:6,minValue:0,maxValue:30,step:5,enableKeyEvents:true}]},{xtype:"fieldset",title:this.LfontsText,items:[{xtype:"textfield",name:"uc_font_main_menu",fieldLabel:this.LmainMenuText,widthCh:35,enableKeyEvents:true}]},{xtype:"filefield",name:"file",fieldLabel:this.LfileText,buttonText:this.LfileButtonText}],propRecordText:function(c){return(c.reseller)
},enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,fileField:"logo"});
this.callParent([a]);
function b(k,f,d,l,h,g,c){return('<img src="'+getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"ipacc_config_resellers",id:d.data.id,attachmentFieldPrefix:"logo"})+'" height="25px">')
}},setContextItems:function(f,d,b,l,c,a,g){if(b=="select"&&l.name=="reseller"){var h=this.getField("descr");
h.setValue(l.getRawValue())
}if(this.formPanel._recordLoaded){if(b=="change"||b=="keyup"||b=="select"){if(l.name.match(/uc_color_theme_shift/)){if(b=="change"&&l.name=="uc_color_theme_shift"){this.colorThemeShiftDisable=true;
var k=rgbToHsv(hexToRgb(c));
k[1]=Math.round(k[1]*30/100);
k[2]=Math.round(k[1]*30/100);
colorThemeShift(k[0],k[1],k[2]);
this.getField("uc_color_theme_shift_h").setValue(k[0]);
this.getField("uc_color_theme_shift_s").setValue(k[1]);
this.getField("uc_color_theme_shift_v").setValue(k[2]);
this.colorThemeShiftDisable=false
}else{if(!this.colorThemeShiftDisable){colorThemeShift(d.uc_color_theme_shift_h,d.uc_color_theme_shift_s,d.uc_color_theme_shift_v)
}}}if(l.name=="uc_font_main_menu"){setMainMenuFont(d.uc_font_main_menu)
}}}},getDefaultValues:function(){colorThemeShift(0,0,0);
setMainMenuFont(null)
},prepareDataForEdit:function(a){colorThemeShift(a.uc_color_theme_shift_h,a.uc_color_theme_shift_s,a.uc_color_theme_shift_v);
setMainMenuFont(a.uc_font_main_menu)
},onWindowClose:function(a){colorThemeShift();
setMainMenuFont(uc_fontMainMenu)
}});
Ext.override(Settings.IpaccConfigResellers.Grid,{LresellerIdText:"reseller id",LresellerText:"reseller",LlogoText:"logo",LdescrText:"description",LappHeaderText:"app header",LcolorThemeShiftText:"color theme shift",LfontsText:"fonts",LmainMenuText:"main menu",LfileText:"logo",LfileButtonText:"Select File..."});
Ext.define("Settings.IpaccConfigResellers.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.ipacc_config_resellersPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"ipacc_config_resellers-panel",gridXType:"IpaccConfigResellers.GridX"});
this.callParent([a])
}});
Ext.override(Settings.IpaccConfigResellers.Panel,{titleText:"Resellers configuration"});
Ext.define("Settings.CdrCharts.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SettingsCdrCharts.GridX",constructor:function(d){var a=__width_FieldChar(15)+3;
d=Ext.applyIf(d||{},{storeId:"SettingsCdrChartsStore",url:"php/model/sql.php",module:"cdr_charts",recordStruct:rsCdrCharts,sortField:"order_int",remoteSort:true,columns:[{xtype:"checkcolumn",header:this.LenableText,dataIndex:"disable",width:50,renderer:function(h){var k=Ext.baseCSSPrefix,g=[k+"grid-checkheader"];
if(!h){g.push(k+"grid-checkheader-checked")
}return'<div class="'+g.join(" ")+'">&#160;</div>'
},listeners:{scope:this,checkchange:function(k,h,l){var g=this.store.getAt(h);
if(g){g.data.disable=l;
g.commit();
this.saveRecord(g)
}}}},{header:this.LtypeText,dataIndex:"default",widthCh:15,renderer:f},{header:this.LnameText,dataIndex:"name",widthCh:30,renderer:c},{header:this.LorderText,dataIndex:"order_int",widthNum:4,align:"right",renderer:b,editor:new Ext.form.field.Number},{header:this.LdescriptionText,dataIndex:"description",widthCh:40,renderer:c}],fpItems:function(l,h,k){var g={xtype:"container",items:[{xtype:"checkbox",fieldLabel:this.LenableText,name:"enable",helpText:this.LenableHelp,labelWidth:a,width:a+__width_FieldChar(50)},{xtype:"textfield",fieldLabel:this.LnameText,name:"name",helpText:this.LnameHelp,labelWidth:a,width:a+__width_FieldChar(50),allowBlank:false},{xtype:"numberfield",fieldLabel:this.LorderText,name:"order_int",helpText:this.LorderHelp,labelWidth:a,width:a+__width_FieldNum(3)+__width_Trigger,allowBlank:false,fieldStyle:{"text-align":"right"}},{xtype:"textarea",fieldLabel:this.LdescriptionText,name:"description",helpText:this.LdescriptionHelp,labelWidth:a,width:a+__width_FieldChar(50)}]};
k.chartConfig=new CDR.Chart.ConfigForm({chartConfig:{},disableCreateWindow:true,disableShowWindow:true,disableSaveCancelFormButtons:true,disableSaveDeleteChartButtons:true,disableChartTitle:true,cdrChartConfig:true,disableFilters:true,frame:false,prevInterval:true,prevIntervalHourTolerance:__default_chartPrevIntervalHourTolerance});
return({xtype:"container",layout:{type:"vbox",align:"stretch"},items:[g,{xtype:"container",layout:"fit",items:k.chartConfig,flex:1}]})
},fpConfig:{layout:"fit",autoHeight:false,width:CDR.Filter.getWidthForm()+__width_Scroller+4+8},ewConfig:{height:function(){return(Math.min(700,Ext.dom.Element.getViewportHeight()-40))
},resizable:false,autoScroll:false,autoHeight:false},propRecordText:function(g){return(g.name)
},enableEdit:true,stripeRows:false,disableCompleteFormFields:true,nextStdBar:[{text:this.LduplicationDefaultToCustom,handler:this.duplication,_id:"btn_duplication",scope:this,disabled:true}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],listeners:{scope:this,edit:function(g,h){h.record.commit();
if(h.value!=h.originalValue){this.saveRecord(h.record);
this.reload()
}}}});
this.callParent([d]);
function f(n,k,h,o,m,l,g){n=n?g.ownerCt.Ltype_default:g.ownerCt.Ltype_custom;
return(c(n,k,h,o,m,l,g))
}function b(n,k,h,o,m,l,g){return(c(n,k,h,o,m,l,g))
}function c(n,k,h,o,m,l,g){if(h.data.disable){n=renderStringStyle(n,{color:"grey",strike:true})
}return(n)
}},prepareDataForEdit:function(b,a){b.enable=!b.disable;
if(b.config_chart){a.chartConfig.setChartConfigFields(Ext.decode(b.config_chart))
}a.chartConfig.setTimeInterval()
},getDefaultValues:function(b){var a=0;
this.store.each(function(c){if(c.data.order_int>a){a=c.data.order_int
}});
return({order_int:a+1})
},prepareDataForSave:function(b,a){b.disable=!b.enable;
var c=a.chartConfig.getChartConfig();
c.title="none";
b.config_chart=Ext.encode(c)
},isEnableEditRecord:function(a){return(!a.data["default"])
},isEnableDeleteRecord:function(a){return(!a.data["default"])
},onSelectionChange:function(a){var b=a.getSelection();
this.enableBtn("btn_duplication",b.length&&b[0].data["default"])
},duplication:function(){var d=null;
var c=this.selModel.getSelection();
if(c.length){d=c[0].data
}if(d){var b=cloneObject(d);
b["default"]=false;
var a=0;
this.store.each(function(f){if(f.data.order_int>a){a=f.data.order_int
}});
b.order_int=a+1;
this.createEditWindow(true,null,{defaultValues:b})
}}});
Ext.override(Settings.CdrCharts.Grid,{LtypeText:"type",LenableText:"enable",LenableHelp:"",LnameText:"name",LnameHelp:"",LorderText:"order",LorderHelp:"",LdescriptionText:"description",LdescriptionHelp:"",Ltype_default:"default",Ltype_custom:"custom",LduplicationDefaultToCustom:"duplication default to custom"});
Ext.define("Settings.CdrCharts.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cdr_chartsPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cdr_charts-panel",iconCls:"icon_menu_diag_system",gridXType:"SettingsCdrCharts.GridX",wikiId:"Settings#CDR_charts"});
this.callParent([a])
}});
Ext.override(Settings.CdrCharts.Panel,{titleText:"CDR Charts",LrestoreDefaultButton:"restore default"});
Ext.define("Settings.CustomHeaders.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SettingsCustomHeaders.GridX",constructor:function(a){var b=[];
if(a.cdr||a.message){b.push({header:this.LspecialTypeText,dataIndex:"special_type",widthCh:15,renderer:renderArrayData,arrayData:a.cdr?arCdrCustomHeadersSpecialType:a.message?arMessageCustomHeadersSpecialType:undefined})
}b.push({header:this.LheaderFieldText,dataIndex:"header_field",widthCh:30},{header:this.LnameText,dataIndex:"name",widthCh:40});
if(a.cdr||a.message){b.push({header:this.LdefaultForLegsByHeaderText,dataIndex:"default_for_legs_by_header",widthCh:21,renderer:renderCheckBox,sortable:false},{header:this.LselectOccurrence,dataIndex:"select_occurrence",widthCh:21,renderer:renderCheckBox,sortable:false},{header:this.Lcseqmethod,dataIndex:"cseq_method",widthCh:21,renderer:renderCheckBox,sortable:false},{header:this.Lsipresponsecode,dataIndex:"sip_response_code",widthCh:21,renderer:renderCheckBox,sortable:false})
}if(a.sip_msg){b.push({header:this.LdirectionText,dataIndex:"direction",widthCh:10,renderer:renderArrayData,arrayData:arReqRespDirection})
}b.push({header:a.cdr?this.LshowAsColumnInCdrText:this.LshowAsColumnText,dataIndex:"show_as_column",widthCh:13,renderer:renderCheckBox,sortable:false});
if(a.cdr){b.push({header:this.LshowAsColumnInActiveCallsText,dataIndex:"show_as_column_spy",widthCh:13,renderer:renderCheckBox,sortable:false})
}a=Ext.applyIf(a,{storeId:a.cdr?"SettingsCdrCustomHeaders":a.message?"SettingsMessageCustomHeaders":a.sip_msg?"SettingsSipMsgCustomHeaders":undefined,url:"php/model/sql.php",module:a.cdr?"cdr_custom_headers":a.message?"message_custom_headers":a.sip_msg?"sip_msg_custom_headers":undefined,recordStruct:a.cdr?rsCdrCustomHeaders:a.message?rsMessageCustomHeaders:a.sip_msg?rsSipMsgCustomHeaders:undefined,sortField:"header_field",remoteSort:true,columns:b,fpDefaults:{xtype:"textfield",widthCh:35,labelCh:20,msgTarget:"side",disableAutoAddTriggerWidth:true},fpItems:function(k,g,h,c){var f=[];
var d=[];
if(this.cdr||this.message){d.push({xtype:"ComboBoxA",name:"special_type",aData:this.cdr?arCdrCustomHeadersSpecialType:this.message?arMessageCustomHeadersSpecialType:undefined,fieldLabel:this.LspecialTypeText,helpText:this.LspecialTypeHelp,_clearButton:true})
}d.push({name:"header_field",fieldLabel:this.LheaderFieldText,helpText:this.LheaderFieldHelp,allowBlank:false,readOnly:c&&c.data.type=="fixed",fieldStyle:c&&c.data.type=="fixed"?{"background-color":__color_FormBackground,"background-image":"none"}:undefined},{name:"name",fieldLabel:this.LnameText,helpText:this.LnameHelp,allowBlank:false},{name:"left_border",fieldLabel:this.LleftBorderText,helpText:this.LleftRightBorderRegularExpressionHelp},{name:"right_border",fieldLabel:this.LrightBorderText,helpText:this.LleftRightBorderRegularExpressionHelp},{name:"regular_expression",fieldLabel:this.LregularExpressionText,helpText:this.LleftRightBorderRegularExpressionHelp,vtype:"testRegExp"});
if(this.cdr||this.message){d.push({name:"default_for_legs_by_header",xtype:"checkbox",fieldLabel:this.LdefaultForLegsByHeaderText,helpText:this.LdefaultForLegsByHeaderTextHelp},{xtype:"ComboBoxA",name:"select_occurrence",aData:arFirstLastValue,fieldLabel:this.LselectOccurrence,helpText:this.LselectOccurrenceHelp,allowBlank:false},{xtype:"ComboBoxA",name:"cseq_method",aData:arSipMethod,fieldLabel:this.Lcseqmethod,helpText:this.LcseqmethodHelp,allowBlank:true,_clearButton:true,multiSelect:true,_arraySeparator:","},{name:"sip_response_code",fieldLabel:this.Lsipresponsecode,helpText:this.LsipresponsecodeHelp})
}if(this.sip_msg){d.push({xtype:"ComboBoxA",name:"direction",aData:arReqRespDirection,fieldLabel:this.LdirectionText,helpText:this.LdirectionHelp,allowBlank:false})
}d.push({xtype:"container",layout:"hbox",items:[{name:"show_as_column",xtype:"checkbox",fieldLabel:this.cdr?this.LshowAsColumnInCdrText:this.LshowAsColumnText,helpText:this.LshowAsColumnHelp,_width:20},{name:"width_column",xtype:"numberfield",fieldLabel:this.LwidthColumnShortText,helpText:this.LwidthColumnHelp,minValue:50,maxValue:300,allowDecimals:false,step:10,labelWidth:__width_FieldChar(6),width:__width_FormChar(6,7)}],style:{marginBottom:__height_FieldSeparator}});
if(this.cdr){d.push({xtype:"container",layout:"hbox",items:[{name:"show_as_column_spy",xtype:"checkbox",fieldLabel:this.LshowAsColumnInActiveCallsText,helpText:this.LshowAsColumnHelp,_width:20},{name:"width_column_spy",xtype:"numberfield",fieldLabel:this.LwidthColumnShortText,helpText:this.LwidthColumnHelp,minValue:50,maxValue:300,allowDecimals:false,step:10,labelWidth:__width_FieldChar(6),width:__width_FormChar(6,7)}],style:{marginBottom:__height_FieldSeparator}})
}if(this.cdr||this.message){if(window.existsHttpJj){d.push({name:"correlated_http_field",xtype:"textfield",fieldLabel:this.LcorrelatedHttpFieldText,helpText:this.LcorrelatedHttpFieldHelp},{name:"correlated_http_field_at_trim",xtype:"checkbox",fieldLabel:this.LcorrelatedHttpFieldAtTrimText,helpText:this.LcorrelatedHttpFieldAtTrimHelp})
}if(window.enable_screen_popup){d.push({name:"screen_popup_field",xtype:"checkbox",fieldLabel:this.LscreenPopupFieldText,helpText:this.LscreenPopupFieldHelp})
}}d.push({name:"description",xtype:"textarea",heightL:3,fieldLabel:this.LdescriptionText,helpText:this.LdescriptionHelp});
return(d)
},enableEdit:true,stripeRows:false,loadStoreAfterInserRecord:true,loadStoreAfterUpdateRecord:true});
this.callParent([a])
},onChangeRecords:function(a,b){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:this.cdr?"getCdrCustomHeadersData":this.message?"getMessageCustomHeadersData":this.sip_msg?"getSipMsgCustomHeadersData":undefined},success:function(c){if(this.cdr){if(dataCdrCustomHeaders!==c.data){window.needCdrColumnsReconfigure=true;
window.needSpyColumnsReconfigure=true
}dataCdrCustomHeaders=c.data;
if(window.needCdrColumnsReconfigure){autoFillDataStructCustomHeaders()
}}else{if(this.message){if(dataMessageCustomHeaders!==c.data){window.needMessageColumnsReconfigure=true
}dataMessageCustomHeaders=c.data;
if(window.needMessageColumnsReconfigure){autoFillDataStructCustomHeaders()
}}else{if(this.sip_msg){if(dataSipMsgCustomHeaders!==c.data){window.needSipMsgColumnsReconfigure=true
}dataSipMsgCustomHeaders=c.data;
if(window.needSipMsgColumnsReconfigure){autoFillDataStructCustomHeaders()
}}}}},scope:this});
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshCustomHeaders"},success:function(){},error:function(){}})
},setContextItems:function(a,d,f,h,g,c,b){this.enableFieldIf("width_column",d.show_as_column);
if(this.cdr){this.enableFieldIf("width_column_spy",d.show_as_column_spy)
}this.enableFieldIf(["header_field","left_border","right_border","regular_expression","direction","default_for_legs_by_header","select_occurrence","cseq_method","sip_response_code"],!d.special_type)
},getDefaultValues:function(){return({width_column:100,direction:"both"})
},prepareDataForSave:function(a){if(a.special_type){delete a.header_field;
delete a.left_border;
delete a.right_border;
delete a.regular_expression;
delete a.default_for_legs_by_header;
delete a.select_occurrence;
delete a.cseq_method;
delete a.sip_response_code
}}});
Ext.override(Settings.CustomHeaders.Grid,{LspecialTypeText:"special type",LspecialTypeHelp:"",LheaderFieldText:"header field",LheaderFieldHelp:"",LnameText:"name",LnameHelp:"",LleftBorderText:"left boundary",LrightBorderText:"right boundary",LregularExpressionText:"regular expression",LleftRightBorderRegularExpressionHelp:'It is possible to extract only part of a value in custom header based on left/right boundary or regexp. Example - you want to extract 101 from Digest username="101". Left boundary will be username=" and right boundary will be ". You can also use regexp instead of boundaries which will be in this case username="([^"]*)". If you use both left/right boundaries and regexp it will first get data from left/right boundaries and the result will be used for regexp and if boundaries will not find anything regexp will be not use.',LdefaultForLegsByHeaderText:"match in sip by header",LdefaultForLegsByHeaderTextHelp:"Enable this to use the header for matching CDRs with the same content in this header. ( in CDR section > CDR detail > Legs by header )",LselectOccurrence:"select occurrence",LselectOccurrenceHelp:"Get data from first or last sip message or leave sensor selection (custom_headers_last_value option in voipmonitor.conf).",Lcseqmethod:"CSEQ method",LcseqmethodHelp:"Select CSEq method. Can be select more options",Lsipresponsecode:"SIP response code",LsipresponsecodeHelp:"Get header from packet with these SIP response codes. Codes must be separated by comma. E.g. 3,3XX,48,48X,483",LdirectionText:"direction",LdirectionHelp:"",LshowAsColumnInCdrText:"show as column in CDR",LshowAsColumnInActiveCallsText:"show as column in active calls",LshowAsColumnText:"show as column",LshowAsColumnHelp:"",LwidthColumnText:"width column",LwidthColumnShortText:"width",LwidthColumnHelp:"",LcorrelatedHttpFieldText:"correlated http field",LcorrelatedHttpFieldHelp:"",LcorrelatedHttpFieldAtTrimText:"- trim @",LcorrelatedHttpFieldAtTrimHelp:"",LscreenPopupFieldText:"easy caller field",LscreenPopupFieldHelp:"",LdescriptionText:"description",LdescriptionHelp:""});
Ext.define("Settings.CdrCustomHeaders.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.cdr_custom_headersPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"cdr_custom_headers-panel",items:new Settings.CustomHeaders.Grid({cdr:true}),wikiId:"Settings#Custom_headers"});
this.callParent([a])
}});
Ext.override(Settings.CdrCustomHeaders.Panel,{titleText:"CDR Custom headers"});
Ext.define("Settings.MessageCustomHeaders.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.message_custom_headersPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"message_custom_headers-panel",items:new Settings.CustomHeaders.Grid({message:true}),wikiId:"Settings#Custom_headers"});
this.callParent([a])
}});
Ext.override(Settings.MessageCustomHeaders.Panel,{titleText:"Message Custom headers"});
Ext.define("Settings.SipMsgCustomHeaders.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.sip_msg_custom_headersPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"sip_msg_custom_headers-panel",items:new Settings.CustomHeaders.Grid({sip_msg:true}),wikiId:"Settings#Custom_headers"});
this.callParent([a])
}});
Ext.override(Settings.MessageCustomHeaders.Panel,{titleText:"Message Custom headers"});
Ext.define("Settings.MessageTypes.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SettingsMessageTypes.GridX",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"MessageTypes",url:"php/model/sql.php",module:"message_types",recordStruct:rsMessageTypes,sortField:"name",remoteSort:true,columns:[{header:this.LnameText,dataIndex:"name",widthCh:40},{header:this.LdescrText,dataIndex:"descr",widthCh:40},{header:this.LlikeContentTypeText,dataIndex:"like_content_type",widthCh:40},{header:this.LlikeMessageText,dataIndex:"like_message",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:35,labelCh:16},fpItems:[{name:"name",fieldLabel:this.LnameText,helpText:this.LnameHelp,allowBlank:false},{name:"descr",xtype:"textarea",heightL:3,fieldLabel:this.LdescrText,helpText:this.LdescrHelp},{name:"like_content_type",xtype:"textarea",heightL:6,fieldLabel:this.LlikeContentTypeText,helpText:this.LlikeContentTypeHelp},{name:"like_message",xtype:"textarea",heightL:6,fieldLabel:this.LlikeMessageText,helpText:this.LlikeMessageHelp}],enableEdit:true,stripeRows:false});
this.callParent([a])
}});
Ext.override(Settings.MessageTypes.Grid,{LnameText:"name",LnameHelp:"",LdescrText:"description",LdescrHelp:"",LlikeContentTypeText:"content type filter",LlikeContentTypeHelp:"SQL LIKE operand for search message by contenttype. More operands separated by new line will be combined with 'or' logical condition.<br><br>For example: %text/plain%",LlikeMessageText:"body message filter",LlikeMessageHelp:"SQL LIKE operand for search message by message body. More operands separated by new line will be combined with 'or' logical condition.<br><br>For example:<br>%&lt;external-content&gt;&lt;caption&gt;&lt;/caption&gt;%"});
Ext.define("Settings.MessageNoHashRules.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SettingsMessageNoHashRules.GridX",constructor:function(b){var c=16;
var a=35;
b=Ext.applyIf(b||{},{storeId:"MessageNoHashRules",url:"php/model/sql.php",module:"message_no_hash_rules",recordStruct:rsMessageNoHashRules,sortField:"name",remoteSort:true,columns:[{header:this.LnameText,dataIndex:"name",widthCh:40},{header:this.LcustomHeaderText,dataIndex:"custom_header",widthCh:20},{header:this.LdescrText,dataIndex:"descr",widthCh:40}],fpDefaults:{xtype:"textfield",widthCh:a,labelCh:c},fpItems:function(){return([{name:"name",fieldLabel:this.LnameText,helpText:this.LnameHelp,allowBlank:false},{name:"msg_custom_headers_id",xtype:"ComboBoxX",fieldLabel:this.LcustomHeaderText,helpText:this.LcustomHeaderHelp,valueField:"id",displayField:"name",url:"php/model/sql.php",module:"message_custom_headers",recordStruct:rsMessageCustomHeaders,sortField:"name",columns:[{fields:"name",widthCh:30}],editable:false,_infoEmpty:this.customHeaderEmptyText},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.LheaderContain+":",width:__width_FieldChar(c),fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{name:"header_regexp",xtype:"ListViewEditField",fieldLabel:this.LheaderRegexpText,helpText:this.LheaderRegexpHelp,valueSeparator:"\n",valueSeparatorAlter:null,width:__width_FieldChar(a),height:__height_FieldLines(8),newValue_fieldLabel:this.LnewHeaderRegexp_fieldLabel,editValue_fieldLabel:this.LeditHeaderRegexp_fieldLabel,newValue_title:this.LnewHeaderRegexp_title,editValue_title:this.LeditHeaderRegexp_title,save:d}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.LcontentContain+":",width:__width_FieldChar(c),fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{name:"content_regexp",xtype:"ListViewEditField",fieldLabel:this.LheaderRegexpText,helpText:this.LheaderRegexpHelp,valueSeparator:"\n",valueSeparatorAlter:null,width:__width_FieldChar(a),height:__height_FieldLines(8),newValue_fieldLabel:this.LnewContentRegexp_fieldLabel,editValue_fieldLabel:this.LeditContentRegexp_fieldLabel,newValue_title:this.LnewContentRegexp_title,editValue_title:this.LeditContentRegexp_title,save:d}],style:{marginBottom:__height_FieldSeparator-1}},{name:"descr",xtype:"textarea",heightL:3,fieldLabel:this.LdescrText,helpText:this.LdescrHelp}]);
function d(f,g){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkSnifferRegexp",params:Ext.encode({regexp:g.value})},success:function(h){if(h.failed){var k=findLangSd("invalidRegularExpression");
Ext.Msg.alert(lang.error,k,function(){g.field.markInvalid(k)
})
}else{if(g.isNew){f.addValue(g.value)
}else{f.modifyValue(g.record,g.value)
}g.panel.destroyWindow()
}}})
}},enableEdit:true,stripeRows:false});
this.callParent([b])
},onChangeRecords:function(a,b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshNoHashMessageRules"},success:function(){},error:function(){}})
}});
Ext.override(Settings.MessageNoHashRules.Grid,{LnameText:"name",LnameHelp:"",LcustomHeaderText:"custom header",LcustomHeaderHelp:"",LheaderContain:"header contain",LnewHeaderRegexp_fieldLabel:"header regexp",LeditHeaderRegexp_fieldLabel:"header regexp",LnewHeaderRegexp_title:"New header regexp",LeditHeaderRegexp_title:"Edit header regexp",LcontentContain:"content contain",LnewContentRegexp_fieldLabel:"content regexp",LeditContentRegexp_fieldLabel:"content regexp",LnewContentRegexp_title:"New content regexp",LeditContentRegexp_title:"Edit content regexp",LdescrText:"description",LdescrHelp:""});
Ext.define("Settings.MessageTypes.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.message_typesPanelX",constructor:function(a){this.searchTypesGrid=new Settings.MessageTypes.Grid({title:this.titleSearchTypes});
this.noHashRulesGrid=new Settings.MessageNoHashRules.Grid({title:this.titleNoHashRules});
a=Ext.applyIf(a||{},{id:"message_types-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.searchTypesGrid,this.noHashRulesGrid],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},wikiId:"Settings#Message_types"});
this.callParent([a])
}});
Ext.override(Settings.MessageTypes.Panel,{titleText:"Message types",titleSearchTypes:"Search types",titleNoHashRules:"No-hash rules"});
Ext.define("Settings.SendCallInfo.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.SettingsSendCallInfo.GridX",constructor:function(c){var b=15;
var h=35;
var a=__width_FieldChar(b);
var f=__width_FormChar(b,h)+__width_FieldChar(h)+__width_FieldSeparator;
c=Ext.applyIf(c||{},{storeId:"SendCallInfo",url:"php/model/sql.php",module:"send_call_info",recordStruct:rsSendCallInfo,sortField:"name",remoteSort:true,columns:[{header:this.LnameText,dataIndex:"name",widthCh:40},{header:this.LdescrText,dataIndex:"descr",widthCh:40},{header:this.LinfoOnText,dataIndex:"info_on",widthCh:10}],fpDefaults:{xtype:"textfield",widthCh:h,labelCh:b,disableAutoAddTriggerWidth:true},ewConfig:{width:f+40},fpItems:function(o,m,n,k){var l=[];
l.push({name:"name",fieldLabel:this.LnameText,helpText:this.LnameHelp,allowBlank:false},{name:"info_on",xtype:"ComboBoxA",fieldLabel:this.LinfoOnText,helpText:this.LinfoOnHelp,aData:[["183/180","183/180"],["200","200"],["183/180_200","183/180 & 200"],["INVITE","INVITE"]],_stringValue:true,widthCh:15,allowBlank:false},{name:"request_url",fieldLabel:this.LrequestUrlText,helpText:this.LrequestUrlHelp,allowBlank:false},{name:"request_type",xtype:"ComboBoxA",fieldLabel:this.LrequestTypeText,helpText:this.LrequestTypeHelp,aData:[["get","GET"],["post","POST"]],widthCh:8,allowBlank:false},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.LfiltersText+":",width:a,fieldStyle:{"text-align":"right"}},{xtype:"container",width:__width_LabelFieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",items:g.call(this,"caller")},{xtype:"container",items:g.call(this,"called")}],width:__width_FieldChar(h)},{xtype:"container",width:__width_FieldSeparator},{xtype:"container",layout:"vbox",items:[{xtype:"container",items:d.call(this,"caller")},{xtype:"container",items:d.call(this,"called")}],width:__width_FieldChar(h)}],width:f,style:{marginBottom:3}},{name:"descr",xtype:"textarea",heightL:3,fieldLabel:this.LdescrText,helpText:this.LdescrHelp});
return(l)
},enableEdit:true,stripeRows:false});
this.callParent([c]);
function g(k){return([{xtype:"displayfield_h16",value:k=="caller"?this.LincludeCallerNumberText:this.LincludeCalledNumberText,height:16,style:{marginTop:1,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbNumberGroups",name:"whitelist_number_"+k+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"whitelist_number_"+k,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}},{xtype:"displayfield_h16",value:k=="caller"?this.LexcludeCallerNumberText:this.LexcludeCalledNumberText,height:16,style:{marginTop:0,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbNumberGroups",name:"blacklist_number_"+k+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"blacklist_number_"+k,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:3}}])
}function d(k){return([{xtype:"displayfield_h16",value:k=="caller"?this.LincludeCallerIpText:this.LincludeCalledIpText,height:16,style:{marginTop:1,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbIpGroups",name:"whitelist_ip_"+k+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"whitelist_ip_"+k,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:0}},{xtype:"displayfield_h16",value:k=="caller"?this.LexcludeCallerIpText:this.LexcludeCalledIpText,height:16,style:{marginTop:0,marginBottom:0},fieldStyle:{"font-size":"90%"}},{xtype:"CBX_cbIpGroups",name:"blacklist_ip_"+k+"_group",hideLabel:true,_clearButton:true,_multiSelect2:true,_editTableButton:user_can_edit_codebooks(),style:{marginBottom:2}},{xtype:"textarea",name:"blacklist_ip_"+k,hideLabel:true,heightL:3,shrinkWrap:0,style:{paddingBottom:0,marginBottom:3}}])
}},getDefaultValues:function(){return{info_on:"200",request_type:"get"}
},onChangeRecords:function(a,b){if(b){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshSendCallInfo"},success:function(){},error:function(){}})
}}});
Ext.override(Settings.SendCallInfo.Grid,{LnameText:"name",LnameHelp:"",LinfoOnText:"info on",LinfoOnHelp:"",LrequestUrlText:"request url",LrequestUrlHelp:"",LrequestTypeText:"request type",LrequestTypeHelp:"",LfiltersText:"filters",LdescrText:"description",LdescrHelp:"",LincludeCallerNumberText:"include caller numbers",LexcludeCallerNumberText:"exclude caller numbers",LincludeCalledNumberText:"include called numbers",LexcludeCalledNumberText:"exclude called numbers",LincludeCallerIpText:"include source IP addresses",LexcludeCallerIpText:"exclude source IP addresses",LincludeCalledIpText:"include destination IP addresses",LexcludeCalledIpText:"exclude destination IP addresses"});
Ext.define("Settings.SendCallInfo.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.send_call_infoPanelX",constructor:function(a){a=Ext.applyIf(a||{},{id:"send_call_info-panel",gridXType:"SettingsSendCallInfo.GridX",wikiId:"Settings#Send_cal_info"});
this.callParent([a])
}});
Ext.override(Settings.SendCallInfo.Panel,{titleText:"Send call information"});
Ext.define("Setting.Localization.Lang.Grid",{extend:"Ext.ux.grid.GridForm",alias:"widget.Localization.Lang.GridX",subsystem:"setting",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"LocalizationLangStore",url:"php/model/sql.php",module:"locale_lang",recordStruct:rsLocaleLang,sortField:"lang_short",remoteSort:true,columns:[{dataIndex:"lang_short",widthCh:20},{headerLang:"flag",widthCh:10,renderer:a,align:"center"},{dataIndex:"lang",widthCh:40},{dataIndex:"note"}],fullColumnSize:"note",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:35,labelCh:20},fpItems:[{name:"lang_short",widthCh:15,allowBlank:false},{name:"lang",allowBlank:false},{xtype:"textarea",name:"note",heightL:4},{xtype:"filefield",name:"flag",buttonText:lang.upload_selectFileBtn}],propRecordText:function(c){return(c.lang)
},enableEdit:true,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Setting.Localization.Lang.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],prefixCls:"locale_lang",stripeRows:false,fileField:"flag",viewConfig:{onFocusEnter:function(){},onFocusLeave:function(){}}});
this.callParent([b]);
function a(k,f,d,l,h,g,c){return(d.data.flag_name?'<img src="'+getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"locale_lang",id:d.data.id,attachmentFieldPrefix:"flag"})+'" height="11px">':"")
}},prepareDataForSave:function(a){a.lang_short=a.lang_short.toLowerCase()
},onChangeRecords:function(a,b){if(a=="insert"){ajaxSafeRequest({scope:this,maskEl:this,url:"php/model/utilities.php",params:{task:"addLanguage",params:Ext.encode({language:b.lang_short,langJsData:treeToArray(langS_En,"//L//")})},success:function(c){}})
}}});
Ext.define("Setting.Localization.Lang.GridExpPanel",{extend:"Ext.Panel",subsystem:"setting",constructor:function(a){this.string=new Setting.Localization.String.Grid({title:findLangS(this.subsystem,"title","localizationLangStringTab"),relFields:{locale_id:a.record.data.id},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},language:a.record.data.lang_short,parentGrid:a.grid});
this.tabPanel=new Ext.TabPanel({items:this.string,activeTab:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"locale_lang-cell",style:{"border-style":"none"},tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Setting.Localization.String.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"setting",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"LocalizationStringStore",url:"php/model/sql.php",module:"locale_string",recordStruct:rsLocaleString,remoteSort:true,columnsDefaults:{sortable:false},columns:[{headerLang:"string_id",dataIndex:"string_group_id",widthCh:25},{dataIndex:"string_en",width:"38%"},{xtype:"actioncolumn",dataIndex:"string_locale",rendererBase:renderString,items:[{getClass:function(f,g,h){return("icon_edit")
},onMouseDown:function(g,n,h,k,l,f){var m=this.parentGrid.view.getEl().dom.scrollTop;
Ext.defer(function(){this.parentGrid.view.getEl().dom.scrollTop=m
},10,this)
},handler:function(g,m,h,k,l,f){g.grid.selModel.select(f);
g.grid.createEditWindow(0)
},scope:this}],iconDivStyle:"float:left; height:15; width: 15;",baseContentDivStyle:"padding-left: 20"}],fullColumnSize:"string_locale",fullColumnSizeDecrement:2,fpDefaults:{xtype:"textfield",widthCh:60,labelCh:10},fpItems:[{xtype:"textarea",name:"string_en",heightL:8,readOnly:true,fieldStyle:{"background-color":__color_FormBackground,"background-image":"none",border:"1px dotted "+__color_FieldBorder},listeners:{afterrender:function(f){f.inputWrap.setStyle({border:"none"})
}}},{xtype:"textarea",name:"string_locale",heightL:8}],propRecordText:function(f){return(f.string_group.toUpperCase()+" / "+f.string_group_id)
},enableEdit:true,enableInsert:false,enableDelete:false,enableSearchX:true,stripeRows:false,enableExportCsv:true,enableImportCsv:true,enableAutoLoad:false,disableLoadStore:true,forceUpdateRecordAfterUpdate:true,fixFieldsInUpdateRecord:["string_group_order"],groupField:"string_group_order",features:[{ftype:"grouping",groupHeaderTpl:"{[this.owner.view.ownerCt.renderGroup(values)]}"}],listeners:{scope:this,afterrender:a},minHeight:150,bufferedRenderer:false});
this.callParent([b]);
var d=this.getView().features[0];
d.groupRowTpl.html=d.groupRowTpl.html.replace('class="x-grid-group-hd','style="padding: 3; border-style: none;" class="x-grid-group-hd');
this.store.on("load",c,this);
function a(){ajaxSafeRequest({scope:this,maskEl:this,deferMask:true,url:"php/model/utilities.php",params:{task:"addLanguage",params:Ext.encode({language:this.language,langJsData:treeToArray(langS_En,"//L//"),check:true})},success:function(f){this.store.disableLoad=false;
this.store.load()
}})
}function c(){this.view.features[0].collapseAll()
}},renderGroup:function(d){var a=d.rows[0].data.string_group.toUpperCase();
var c=0;
for(var b=0;
b<d.rows.length;
b++){if(!d.rows[b].data.string_locale){++c
}}a+=" - "+d.rows.length;
if(c){a+=' / <span style="color:red;">'+c+"</span>"
}a+=" items";
return(a)
},onChangeRecords:function(a,b){this.view.refresh()
},onWindowOpen:function(){this.parentGrid_saveScrollerPosition=this.parentGrid.view.getEl().dom.scrollTop
},onWindowClose:function(){if(Ext.isDefined(this.parentGrid_saveScrollerPosition)){this.parentGrid.view.getEl().dom.scrollTop=this.parentGrid_saveScrollerPosition;
delete this.parentGrid_saveScrollerPosition
}}});
Ext.define("Setting.Localization.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.localizationPanelX",subsystem:"setting",constructor:function(a){a=Ext.applyIf(a||{},{id:"localization-panel",layout:"fit",gridXType:"Localization.Lang.GridX",titleLang:"localization",wikiId:"Settings#Localization"});
this.callParent([a])
}});
Ext.define("Settings.Utils",{singleton:true,getInternationalRulesFormItems:function(d){var a=d&&d.labelWidth||__width_FieldChar(30);
var c=[];
c.push({xtype:"textfield",name:"international_prefixes",fieldLabel:f("international_prefixes"),labelWidth:a},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"international_number_min_length",minValue:1,maxValue:63,align:"right",width:__width_Form(a,__width_FieldNum(3)+__width_Trigger),fieldLabel:f("international_number_min_length"),labelWidth:a,helpText:"<b>"+f("international_number_min_length_prefixes_strict")+"</b><br>"+b("international_number_min_length")},{xtype:"checkbox",name:"international_number_min_length_prefixes_strict",hideLabel:true,boxLabel:f("international_number_min_length_prefixes_strict"),helpText:"<b>"+f("international_number_min_length_prefixes_strict")+"</b><br>"+b("international_number_min_length"),style:{marginLeft:__width_FieldSeparator}}],widthCh:50,style:{marginBottom:__height_FieldSeparator}},{xtype:"ComboBoxX",name:"country_code_for_local_numbers",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_listVertScroller:true,_clearButton:true,fieldLabel:f("country_code_for_local_numbers"),labelWidth:a},{xtype:"container",layout:"hbox",items:[{xtype:"checkbox",name:"enable_check_napa_without_prefix",width:__width_Form(a,__width_FieldChar(2)),fieldLabel:f("enable_check_napa_without_prefix"),labelWidth:a},{xtype:"numberfield",name:"min_length_napa_without_prefix",minValue:1,maxValue:63,align:"right",width:__width_Form(__width_FieldChar(8),__width_FieldNum(3)+__width_Trigger),fieldLabel:f("min_length_napa_without_prefix"),labelWidth:__width_FieldChar(8),helpText:b("min_length_napa_without_prefix"),style:{marginLeft:__width_FieldSeparator}}],widthCh:50,style:{marginBottom:__height_FieldSeparator}},{xtype:"textfield",name:"skip_prefixes",fieldLabel:f("skip_prefixes"),labelWidth:a});
function f(g){return(findLangS("setting","international_rules_field",g))
}function b(g){return(findLangS("setting","international_rules_field_help",g))
}return(c)
},getInternationalRulesFormFieldNames:function(){return(["international_prefixes","international_number_min_length","international_number_min_length_prefixes_strict","country_code_for_local_numbers","enable_check_napa_without_prefix","min_length_napa_without_prefix","skip_prefixes"])
},setContextItemsInternationalRules:function(d,a,c,f){if(!Ext.isDefined(f)){f=true
}var g=this.getInternationalRulesFormFieldNames();
for(var b=0;
b<g.length;
b++){d.enableFieldIf(g[b],f)
}d.enableFieldIf("international_number_min_length_prefixes_strict",c.international_number_min_length);
d.enableFieldIf("min_length_napa_without_prefix",c.enable_check_napa_without_prefix)
},showIfItemsInternationalRules:function(c,a){var d=this.getInternationalRulesFormFieldNames();
for(var b=0;
b<d.length;
b++){c.showFieldIf(d[b],a)
}},loadSniffersVersion:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getVersionsSnifferForUpgrade"},success:function(b){if(a.onLoad){a.onLoad.call(a.onLoadScope||a.scope,b.results,a.data)
}},error:function(){if(a.onError){a.onError.call(a.onErrorScope||a.scope,a.data)
}},failure:function(){if(a.onFailure){a.onFailure.call(a.onFailureScope||a.scope,a.data)
}else{if(a.onError){a.onError.call(a.onErrorScope||a.scope,a.data)
}}},maskEl:a.maskEl,maskMsg:findLangS("setting","text","loadingUpgradeInformation")})
},getSensors:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getSensors",params:Ext.encode({withLocal:a.withLocal})},success:function(b){if(a.onLoad){a.onLoad.call(a.onLoadScope||a.scope,b.sensors,a.data)
}},error:function(){if(a.onError){a.onError.call(a.onErrorScope||a.scope,a.data)
}},failure:function(){if(a.onFailure){a.onFailure.call(a.onFailureScope||a.scope,a.data)
}else{if(a.onError){a.onError.call(a.onErrorScope||a.scope,a.data)
}}},maskEl:a.maskEl,maskMsg:findLangS("setting","text","loadingSensors")})
},upgradeSensors:function(s){if(!s){s={}
}if(!s.version){Settings.Utils.loadSniffersVersion({scope:s.scope||this,maskEl:s.maskEl,onLoad:function(w){for(var y=0;
y<w.length;
y++){if(!w[y].version.rc&&!w[y].version.beta){s.version=w[y];
Settings.Utils.upgradeSensors(s);
break
}}if(s.onError){s.onError.call(s.onErrorScope||s.scope,"check version information failed")
}},onError:function(){if(s.onError){s.onError.call(s.onErrorScope||s.scope,"download version information failed")
}}});
return
}if(!s.sensors||!Ext.isObject(s.sensors[0])){if(s.sensors){for(var p=0;
p<s.sensors.length;
p++){if(!Ext.isNumber(s.sensors[p])){s.sensors[p]*=1
}}}Settings.Utils.getSensors({scope:s.scope||this,maskEl:s.maskEl,onLoad:function(z){var y=[];
for(var w=0;
w<z.length;
w++){if(!s.sensors||s.sensors.isIn(z[w].id_sensor*1)){y.push(z[w])
}}if(y.length){s.sensors=y;
Settings.Utils.upgradeSensors(s)
}else{if(s.onError){s.onError.call(s.onErrorScope||s.scope,"check sesnors information failed")
}}},onError:function(){if(s.onError){s.onError.call(s.onErrorScope||s.scope,"get sensors information failed")
}}});
return
}var k="UpgradeSensors";
if(!Ext.ClassManager.isCreated(k)){Ext.define(k,{extend:"Ext.data.Model",fields:[{name:"name"},{name:"state"},{name:"description"}]})
}var r=new Ext.data.ArrayStore({model:k,data:[]});
for(var p=0;
p<s.sensors.length;
p++){r.add({name:s.sensors[p].name})
}var t=[{dataIndex:"name",width:__width_ColumnChar(15)},{dataIndex:"state",width:__width_ColumnChar(15)},{dataIndex:"description",flex:1}];
var c=new Ext.grid.Panel({store:r,columns:t,viewConfig:{stripeRows:false},width:600});
var a={run:o,interval:5000,counter:0};
var h=new Ext.util.TaskRunner();
var u=false;
var d="";
for(var p=0;
p<s.sensors.length;
p++){if(d){d+=", "
}d+=s.sensors[p].name
}var n=new Ext.Window({layout:"fit",items:[c],title:findLangS("sensors","title",s.sensors.length>1?"upgradeSensors":"upgradeSensor").template([d,s.version.version.version]),border:false,modal:true,listeners:{activate:function(){if(!u){u=true;
h.start(a);
m()
}},destroy:function(){h.stop(a)
},scope:s.scope||this}});
var v=0;
var f=false;
var b=0;
var q=0;
n.show();
function m(){if(v==r.getCount()){if(s.okIfAllSuccess?q==r.getCount():q>0){s.onOk.call(s.onOkScope||s.scope,q,r.getCount(),n)
}else{s.onError.call(s.onOkScope||s.scope,"update failed")
}return
}l(v,"processing...","blue");
var w;
var y;
w=ajaxSafeRequest({scope:s.scope||this,url:"php/model/utilities.php",params:{task:"restartSensor",params:Ext.encode({host:s.sensors[v].host,port:s.sensors[v].port,id_sensor:s.sensors[v].id_sensor,read_timeout:s.sensors[v].read_timeout,upgrade:true,version:Ext.encode({version:s.version.version.version,url:s.version.url,md5_32:s.version.md5_32,md5_64:s.version.md5_64,md5_arm:s.version.md5_arm,md5_64_ws:s.version.md5_64_ws})})},success:function(){if(!n.getEl()){return
}abortRequest(y);
l(v,"waiting...","blue");
f=true;
b=a.counter
},error:function(A){if(!n.getEl()){return
}if(!(A.error&&A.error.match("timeout"))){abortRequest(y);
var z=getStringAjaxError(A);
l(v,"ERROR","red");
g(v,z);
++v;
m()
}},failure:function(z){if(!n.getEl()){return
}if(!requestIsAborted(z)){abortRequest(y);
var A=getStringAjaxFailure(z);
l(v,"ERROR","red");
g(v,A);
++v;
m()
}}});
y=ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"waitForSensorVersion",params:Ext.encode({id_sensor:s.sensors[v].id_sensor,sleep:30,timeout:180,version:s.version.version.version})},success:function(z){if(z.ok){abortRequest(w);
l(v,"waiting...","blue");
f=true;
b=a.counter
}},errorFailure2:function(){}})
}function o(){if(!n.getEl()){return
}if(f){if(a.counter>b+20){f=false;
l(v,"ERROR","red");
g(v,"no response");
++v;
m()
}else{if(a.counter>b+3){ajaxSafeRequest({scope:s.scope||this,url:"php/model/utilities.php",params:{task:"loadSensorStat",params:Ext.encode({sensorId:s.sensors[v].id_sensor})},success:function(w){if(!n.getEl()){return
}debug_log(w.stat);
if(w.stat&&w.stat.get_stat=="OK"){f=false;
l(v,"OK","green");
++v;
++q;
m()
}}})
}}}++a.counter
}function l(A,z,y){var w=r.getAt(A);
if(w){w.data.state=y?renderStringStyle(z,{color:y}):z;
w.commit()
}}function g(z,y){var w=r.getAt(z);
if(w){w.data.description=y;
w.commit()
}}}});
Ext.ns("Billing");
Ext.define("Billing.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"BillingStore",url:"php/model/sql.php",module:"billing",recordStruct:rsBilling,sortField:"name",remoteSort:true,pageSize:30,columns:[{dataIndex:"name"},{dataIndex:"holiday_state_name"},{dataIndex:"default_customer_billing",widthCh:12,renderer:renderTick,align:"center"},{dataIndex:"description"},{dataIndex:"default_use_for_number_format",widthCh:18,renderer:a},{dataIndex:"default_use_for_number_type",widthCh:18,renderer:c}],columnsDefaults:{sortable:true,widthCh:40},fullColumnSize:"description",fullColumnSizeDecrementScroller:true,fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"name",allowBlank:false},{name:"id_holiday_state",xtype:"ComboBoxX",displayField:"name",url:"php/model/sql.php",module:"holiday_state",recordStruct:rsHolidayState,sortField:"name",columns:[{fields:"name",widthCh:30}],editable:false,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true},{name:"default_price",widthNum:10,_enableDecPoint:true,align:"right"},{name:"peak_offpeak",xtype:"checkbox"},{name:"default_price_peak",widthNum:10,_enableDecPoint:true,align:"right"},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"default_peak_starts_hour",minValue:0,maxValue:23,widthNum:5,fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"default_peak_starts_minute",fieldLabel:lang.minute,minValue:0,maxValue:59,widthNum:5,fieldStyle:{"text-align":"right"},labelWidth:__width_FieldChar(10),width:__width_FieldNum(5)+__width_FieldChar(10)+__width_LabelFieldSeparator}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"default_peak_ends_hour",minValue:0,maxValue:23,widthNum:5,fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"default_peak_ends_minute",fieldLabel:lang.minute,minValue:0,maxValue:59,widthNum:5,fieldStyle:{"text-align":"right"},labelWidth:__width_FieldChar(10),width:__width_FieldNum(5)+__width_FieldChar(10)+__width_LabelFieldSeparator}],style:{paddingBottom:__height_FieldSeparator}},{name:"default_weekend_start",xtype:"ComboBoxA",widthCh:16,aData:arWeekday,_clearButton:true},{name:"default_t1",xtype:"numberfield",widthNum:5,allowBlank:false},{name:"default_t2",xtype:"numberfield",widthNum:5,allowBlank:false},{name:"default_use_for_number_format",xtype:"ComboBoxA",aData:Billing.Utils.getComboAdata("default_use_for_number_format"),widthCh:23,_clearButton:true},{name:"default_use_for_number_type",xtype:"ComboBoxA",aData:Billing.Utils.getComboAdata("default_use_for_number_type"),widthCh:23,_clearButton:true},{name:"default_customer_billing",xtype:"checkbox"},{name:"currency_code",xtype:"ComboBoxX",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"currency",recordStruct:rsCurrency,sortField:"name",columns:[{fields:"code",widthChar:8},{fields:"custom_code",widthChar:8},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true},{name:"timezone_name",xtype:"ComboBoxA",aData:{data:window.timezones,fields:["tz"]},valueField:"tz",displayField:"tz",editable:false,_clearButton:true},{name:"description",xtype:"textarea",heightL:3}],enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Billing.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],prefixCls:"billing",stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([b]);
function a(m,d,g,n,l,k,f){var h=undefined;
if(Ext.isEmpty(m)){m="both";
h="grey"
}return(renderStringStyle(getDataArrayItem(Billing.Utils.getComboAdata(d.column.dataIndex),m),{color:h}))
}function c(m,d,g,n,l,k,f){var h=undefined;
if(Ext.isEmpty(m)){m="both";
h="grey"
}return(renderStringStyle(getDataArrayItem(Billing.Utils.getComboAdata(d.column.dataIndex),m),{color:h}))
}},setContextItems:function(a,d,f,h,g,c,b){this.enableFieldIf(["default_price_peak","default_peak_starts_hour","default_peak_starts_minute","default_peak_ends_hour","default_peak_ends_minute","default_weekend_start"],d.peak_offpeak)
},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
if(b.default_customer_billing){this.refresh()
}refreshBilling();
var c=this.store.getCount()>0;
if(window.fillBillingTable!=c){window.fillBillingTable=c;
window.needCdrColumnsReconfigure=true
}},getDefaultValues:function(){return({default_t1:1,default_t2:1})
}});
Ext.define("Billing.GridExpPanel",{extend:"Ext.Panel",subsystem:"billing",constructor:function(a){this.rule=new Billing.Rule.Grid({relFields:{id_billing:a.record.data.id},style:__style_SubgridBorder(),title:this.findLangS("title","billingRuleTab"),_billingData:a.record.data,_panel:a.grid._panel});
this.tabPanel=new Ext.TabPanel({items:this.rule,activeTabs:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"billing-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Billing.Rule.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(c){var b=[{name:"name",allowBlank:false},{name:"prefix_number",widthNum:20,regex:/^\+?\d+.*/},{name:"fixed_number",widthNum:20,regex:/^\+?\d+.*/},{name:"regex_number",widthNum:20,regex:/.*/},{name:"price",widthNum:10,_enableDecPoint:true,align:"right"}];
if(c._billingData&&c._billingData.peak_offpeak){b.push({name:"price_peak",widthNum:10,_enableDecPoint:true,align:"right"},{name:"override_default_peak_offpeak",xtype:"checkbox"},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"peak_starts_hour",minValue:0,maxValue:23,widthNum:5,fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"peak_starts_minute",fieldLabel:lang.minute,minValue:0,maxValue:59,widthNum:5,fieldStyle:{"text-align":"right"},labelWidth:__width_FieldChar(10),width:__width_FieldNum(5)+__width_FieldChar(10)+__width_LabelFieldSeparator}],style:{paddingBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"peak_ends_hour",minValue:0,maxValue:23,widthNum:5,fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"peak_ends_minute",fieldLabel:lang.minute,minValue:0,maxValue:59,widthNum:5,fieldStyle:{"text-align":"right"},labelWidth:__width_FieldChar(10),width:__width_FieldNum(5)+__width_FieldChar(10)+__width_LabelFieldSeparator}],style:{paddingBottom:__height_FieldSeparator}},{name:"weekend_start",xtype:"ComboBoxA",widthCh:16,aData:arWeekday,_clearButton:true})
}b.push({name:"t1",xtype:"numberfield",widthNum:5,allowBlank:false},{name:"t2",xtype:"numberfield",widthNum:5,allowBlank:false},{name:"use_for_number_format",xtype:"ComboBoxA",aData:Billing.Utils.getComboAdata("use_for_number_format"),widthCh:23,_clearButton:true},{name:"use_for_number_type",xtype:"ComboBoxA",aData:Billing.Utils.getComboAdata("use_for_number_type"),widthCh:23,_clearButton:true});
c=Ext.applyIf(c||{},{storeId:"BillingRuleDateStore",url:"php/model/sql.php",module:"billing_rule",recordStruct:rsBillingRule,sortField:"prefix_number",remoteSort:true,pageSize:25,columns:[{dataIndex:"name"},{dataIndex:"prefix_number"},{dataIndex:"fixed_number"},{dataIndex:"regex_number"},{dataIndex:"price",widthNum:6,align:"right"},{dataIndex:"t1",widthNum:6,align:"right"},{dataIndex:"t2",widthNum:6,align:"right"},{dataIndex:"use_for_number_format",widthCh:18,renderer:a},{dataIndex:"use_for_number_type",widthCh:18,renderer:d}],columnsDefaults:{sortable:true,widthCh:20},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:b,enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},enableExportCsv:true,enableImportCsv:true});
this.callParent([c]);
function a(n,f,h,o,m,l,g){var k=undefined;
if(Ext.isEmpty(n)){n=this._billingData.default_use_for_number_format||"both";
k="grey"
}return(renderStringStyle(getDataArrayItem(Billing.Utils.getComboAdata(f.column.dataIndex),n),{color:k}))
}function d(n,f,h,o,m,l,g){var k=undefined;
if(Ext.isEmpty(n)){n=this._billingData.default_use_for_number_type||"both";
k="grey"
}return(renderStringStyle(getDataArrayItem(Billing.Utils.getComboAdata(f.column.dataIndex),n),{color:k}))
}},setContextItems:function(a,d,f,h,g,c,b){this.enableFieldIf(["peak_starts_hour","peak_starts_minute","peak_ends_hour","peak_ends_minute","weekend_start"],d.override_default_peak_offpeak)
},getDefaultValues:function(){return({t1:this._billingData.default_t1,t2:this._billingData.default_t2,use_for_number_format:this._billingData.default_use_for_number_format,use_for_number_type:this._billingData.default_use_for_number_type})
},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
refreshBilling()
}});
Ext.define("Billing.Settings",{extend:"CommonSettings.InternationalRules",constructor:function(a){this.callParent([a])
}});
Ext.define("Billing.HolidayState.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"HolidayStateStore",url:"php/model/sql.php",module:"holiday_state",recordStruct:rsHolidayState,sortField:"name",remoteSort:true,pageSize:30,columns:[{dataIndex:"name"},{dataIndex:"country_name"}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"name",allowBlank:false},{name:"country_code",xtype:"ComboBoxX",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true},{name:"description",xtype:"textarea",heightL:3}],enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Billing.HolidayState.GridExpPanel",expandOnEnter:false,expandOnDblClick:false}],prefixCls:"holiday_state",stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([a])
},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
refreshBilling()
}});
Ext.define("Billing.HolidayState.GridExpPanel",{extend:"Ext.Panel",subsystem:"billing",constructor:function(a){this.date=new Billing.HolidayStateDate.Grid({relFields:{id_holiday_state:a.record.data.id},style:__style_SubgridBorder(),title:this.findLangS("title","holidayStateDateTab"),_panel:a.grid._panel});
this.tabPanel=new Ext.TabPanel({items:this.date,activeTabs:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:"holiday_state-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(a,{items:this.tabPanel,border:false});
this.callParent([a])
}});
Ext.define("Billing.HolidayStateDate.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"HolidayStateDateStore",url:"php/model/sql.php",module:"holiday_state_date",recordStruct:rsHolidayStateDate,sortField:"name",remoteSort:true,columns:[{dataIndex:"name"}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:[{name:"name",allowBlank:false},{name:"type_holiday",xtype:"ComboBoxA",aData:arTypeHoliday,widthCh:20,allowBlank:false},{xtype:"container",layout:"hbox",_id:"month_day",items:[{xtype:"numberfield",name:"month",allowBlank:false,minValue:1,maxValue:12,widthNum:5,fieldStyle:{"text-align":"right"}},{xtype:"numberfield",name:"month_day",allowBlank:false,minValue:1,maxValue:31,widthNum:5,fieldStyle:{"text-align":"right"},labelWidth:__width_FieldChar(12),width:__width_FieldNum(5)+__width_FieldChar(12)+__width_LabelFieldSeparator}],style:{paddingBottom:__height_FieldSeparator}},{name:"date",xtype:"datefield",allowBlank:false,_width:__width_FieldDate},{name:"description",xtype:"textarea",heightL:3}],enableEdit:true,enableSearchX:true,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([a])
},setContextItems:function(a,d,f,h,g,c,b){this.showFieldIf(["month","month_day"],d.type_holiday=="fixed");
this.needFillField(["month","month_day"],d.type_holiday=="fixed");
this.showItemBy("_id","month_day",d.type_holiday=="fixed");
this.showFieldIf("date",d.type_holiday=="movable");
this.needFillField("date",d.type_holiday=="movable")
},getDefaultValues:function(){return({type_holiday:"fixed"})
},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
refreshBilling()
}});
Ext.define("Billing.Assignment.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(a){a=Ext.applyIf(a||{},{storeId:a._operator?"BillingOperatorAssignmentStore":"BillingCustomerAssignmentStore",url:"php/model/sql.php",module:a._operator?"billing_operator_assignment":"billing_customer_assignment",recordStruct:a._operator?rsBillingOperatorAssignment:rsBillingCustomerAssignment,sortField:"name",remoteSort:true,pageSize:30,columns:[{dataIndex:"name"},{dataIndex:"billing_name"}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(k,g,h,d){var c=[{name:"name",allowBlank:false},{name:"id_billing",xtype:"ComboBoxX",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"billing",recordStruct:rsBilling,sortField:"name",columns:[{fields:"name",widthCh:30}],allowBlank:false,editable:false,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true},{name:"description",xtype:"textarea",heightL:3}];
var b;
if(!g){b={};
b[a._operator?"id_operator_assignment":"id_customer_assignment"]=d.data.id
}this.addresses=new Billing.Assignment.AddressesNumbers.Grid({_operator:a._operator,_addresses:true,memoryStore:true,relFields:b,width:__width_FieldChar(40),height:150,enableSearchX:false,border:true});
if(!a._operator){this.numbers=new Billing.Assignment.AddressesNumbers.Grid({_operator:a._operator,_numbers:true,memoryStore:true,relFields:b,width:__width_FieldChar(40),height:150,enableSearchX:false,border:true})
}this.sensors=new Billing.Assignment.AddressesNumbers.Grid({_operator:a._operator,_sensors:true,memoryStore:true,relFields:b,width:__width_FieldChar(40),height:150,enableSearchX:false,border:true});
if(this.addresses){c.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field",a._operator?"addresses_destination":"addresses_source")+":",width:__width_FieldChar(20),fieldStyle:{"text-align":"right"}},{width:__width_LabelFieldSeparator,border:false},this.addresses],style:{marginBottom:__height_FieldSeparator}})
}if(this.numbers){c.push({xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field",a._operator?"numbers_destination":"numbers_source")+":",width:__width_FieldChar(20),fieldStyle:{"text-align":"right"}},{width:__width_LabelFieldSeparator,border:false},this.numbers],style:{marginBottom:__height_FieldSeparator}})
}if(this.sensors){c.push({xtype:"checkbox",name:"limitation_for_sensors"},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field","sensors")+":",width:__width_FieldChar(20),fieldStyle:{"text-align":"right"}},{width:__width_LabelFieldSeparator,border:false},this.sensors],style:{marginBottom:__height_FieldSeparator}})
}c.push({xtype:"displayfield_h16",value:"<i>"+this.findLangS("text","internationalPrefixesConfiguration")+"</i>"});
var f=__width_FieldChar(30);
c=c.concat(Settings.Utils.getInternationalRulesFormItems({labelWidth:f}));
return(c)
},enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,plugins:[{ptype:"rowexpander",rowBodyContentCls:"Billing.Assignment.GridExpPanel",rowBodyContentConfig:{_operator:a._operator},expandOnEnter:false,expandOnDblClick:false}],prefixCls:a._operator?"billing_operator_assignment":"billing_customer_assignment",stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([a])
},prepareDataForSave:function(a){if(this.addresses){a.addresses=this.addresses.getAllGridData(true);
a.addresses_updateRecords=this.addresses._updateRecords;
a.addresses_deleteRecords=this.addresses._deleteRecords
}if(this.numbers){a.numbers=this.numbers.getAllGridData(true);
a.numbers_updateRecords=this.numbers._updateRecords;
a.numbers_deleteRecords=this.numbers._deleteRecords
}if(this.sensors){a.sensors=this.sensors.getAllGridData(true);
a.sensors_updateRecords=this.sensors._updateRecords;
a.sensors_deleteRecords=this.sensors._deleteRecords
}},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
refreshBilling()
},setContextItems:function(a,d,f,h,g,c,b){Settings.Utils.setContextItemsInternationalRules(this,a,d);
if(this.sensors){this.sensors.enableIf(d.limitation_for_sensors);
if(d.limitation_for_sensors){this.sensors.unmask()
}}}});
Ext.define("Billing.Assignment.GridExpPanel",{extend:"Ext.Panel",subsystem:"billing",constructor:function(c){var a={};
a[c._operator?"id_operator_assignment":"id_customer_assignment"]=c.record.data.id;
this.addresses=new Billing.Assignment.AddressesNumbers.Grid({_operator:c._operator,_addresses:true,relFields:a,style:__style_SubgridBorder(),title:this.findLangS("title",c._operator?"addresses_destinationTab":"addresses_sourceTab"),_panel:c.grid._panel});
if(!c._operator){this.numbers=new Billing.Assignment.AddressesNumbers.Grid({_operator:c._operator,_numbers:true,relFields:a,style:__style_SubgridBorder(),title:this.findLangS("title",c._operator?"numbers_destinationTab":"numbers_sourceTab"),_panel:c.grid._panel})
}var b=[];
if(this.addresses){b.push(this.addresses)
}if(this.numbers){b.push(this.numbers)
}this.tabPanel=new Ext.TabPanel({items:b,activeTabs:0,tabPosition:"top",plain:true,bodyBorder:false,border:false,cls:(c._operator?"billing_operator_assignment":"billing_customer_assignment")+"-cell expander-area-panel",tabBar:{renderTpl:__tpl_simplyTabPanel}});
Ext.apply(c,{items:this.tabPanel,border:false});
this.callParent([c])
}});
Ext.define("Billing.Assignment.AddressesNumbers.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(c){var d=[];
if(c._sensors){d.push({dataIndex:"sensor_id",widthNum:8},{dataIndex:"sensor_name",flex:1})
}else{if(c._addresses){d.push({dataIndex:"ip",headerLang:"ip_net",widthCh:40,renderer:b})
}else{d.push({dataIndex:"number",headerLang:"prefix_number",widthNum:20,renderer:f})
}}var a=[];
if(c._sensors){a.push()
}else{if(c._addresses){a.push({name:"ip",widthCh:35,allowBlank:false},{name:"mask",xtype:"numberfield",minValue:1,maxValue:32,_width:__width_FieldNum(3)+__width_Trigger})
}else{a.push({name:"number",widthCh:20,allowBlank:false},{name:"fixed",xtype:"checkbox"})
}a.push({name:"description",xtype:"textarea",heightL:3})
}c=Ext.applyIf(c||{},{storeId:c._operator?(c._sensors?"BillingOperatorAssignmentSensorsStore":c._addresses?"BillingOperatorAssignmentAddressesStore":"BillingOperatorAssignmentNumbersStore"):(c._sensors?"BillingCustomerAssignmentSensorsStore":c._addresses?"BillingCustomerAssignmentAddressesStore":"BillingCustomerAssignmentNumbersStore"),url:"php/model/sql.php",module:c._operator?(c._sensors?"billing_operator_assignment_sensors":c._addresses?"billing_operator_assignment_addresses":"billing_operator_assignment_numbers"):(c._sensors?"billing_customer_assignment_sensors":c._addresses?"billing_customer_assignment_addresses":"billing_customer_assignment_numbers"),recordStruct:c._operator?(c._sensors?rsBillingOperatorAssignmentSensors:c._addresses?rsBillingOperatorAssignmentAddresses:rsBillingOperatorAssignmentNumbers):(c._sensors?rsBillingCustomerAssignmentSensors:c._addresses?rsBillingCustomerAssignmentAddresses:rsBillingCustomerAssignmentNumbers),sortField:c._sensors?"sensor_id":c._addresses?"ip":"number",remoteSort:true,columns:d,columnsDefaults:{sortable:true,widthCh:40},fpDefaults:c._sensors?{labelCh:10}:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:a,fpItems:function(o,l,m,h){if(this._sensors){var g=this.getAllGridItems("id_sensor");
if(!l&&g&&g.isIn(h.data.id_sensor)){var n=g.indexOf(h.data.id_sensor);
if(n>=0){g.splice(n,1)
}}var k=[{xtype:"CBX_sensor",name:"id_sensor",widthCh:25,excludeIds:g,allowBlank:false}];
return(k)
}else{return(this.fpItemsSrc)
}},enableEdit:true,enableSearchX:true,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([c]);
function b(m,g,h,n,l,k){return(ip_mask_text(m,h.data.mask))
}function f(m,g,h,n,l,k){return(m+(m&&!h.data.fixed?"%":""))
}},prepareDataForSave:function(c){if(this._sensors){var a=this.getField("id_sensor");
if(a){var b=a.getSelectRecord();
if(b){c.sensor_id=b.data.id_sensor;
c.sensor_name=b.data.name
}}}else{if(!this._addresses){c.fixed=c.fixed?1:0
}}},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
refreshBilling()
},setContextItems:function(f,d,b,k,c,a,g){if(this._addresses){if(k&&k.name=="ip"){var h=ip_is_v6(this.getValueField("ip"));
var l=this.getField("mask");
l.maxValue=h?128:32
}}}});
Ext.define("Billing.Exclude.AddressesNumbersDomains.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"billing",constructor:function(c){var d=[];
switch(c._type){case"addresses":d.push({dataIndex:"ip",headerLang:"ip_net",widthCh:40,renderer:b});
break;
case"numbers":d.push({dataIndex:"number",headerLang:"prefix_number",widthNum:20,renderer:f});
break;
case"domains":d.push({dataIndex:"domain",widthNum:35});
break
}d.push({dataIndex:"side",widthCh:20,rendere:renderArrayData,arrayData:arCdrSide});
var a=[];
switch(c._type){case"addresses":a.push({name:"ip",widthCh:35,allowBlank:false},{name:"mask",xtype:"numberfield",minValue:1,maxValue:32,_width:__width_FieldNum(3)+__width_Trigger});
break;
case"numbers":a.push({name:"number",widthCh:20,allowBlank:false},{name:"fixed",xtype:"checkbox"});
break;
case"domains":a.push({name:"domain",widthCh:35,allowBlank:false});
break
}a.push({name:"side",xtype:"ComboBoxA",aData:arCdrSide,widthCh:20},{name:"description",xtype:"textarea",heightL:3});
c=Ext.applyIf(c||{},{storeId:c._type=="addresses"?"BillingExcludeAddressesStore":c._type=="numbers"?"BillingExcludeNumbersStore":c._type=="domains"?"BillingExcludeDomainsStore":null,url:"php/model/sql.php",module:c._type=="addresses"?"billing_exclude_addresses":c._type=="numbers"?"billing_exclude_numbers":c._type=="domains"?"billing_exclude_domains":null,recordStruct:c._type=="addresses"?rsBillingExcludeAddresses:c._type=="numbers"?rsBillingExcludeNumbers:c._type=="domains"?rsBillingExcludeDomains:null,sortField:c._type=="addresses"?"ip":c._type=="numbers"?"number":c._type=="domains"?"domain":null,remoteSort:true,pageSize:30,columns:d,columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItemsSrc:a,enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([c]);
function b(m,g,h,n,l,k){return(ip_mask_text(m,h.data.mask))
}function f(m,g,h,n,l,k){return(m+(m&&!h.data.fixed?"%":""))
}},prepareDataForSave:function(a){if(this._type=="numbers"){a.fixed=a.fixed?1:0
}},getDefaultValues:function(){return({side:"both"})
},onChangeRecords:function(a,b){this._panel.doTestBilling(true);
refreshBilling()
}});
Ext.define("Billing.Agregation.Settings",{extend:"Ext.ux.setting.Form",subsystem:"billing",constructor:function(a){Ext.applyIf(a,{settingTableName:"billing_agregation_settings",settingTableStruct:rsBillingAgregationSettings,specItems:{enable_by_ip:{xtype:"checkbox"},enable_by_number:{xtype:"checkbox"},enable_by_domain:{xtype:"checkbox"},week_start:{xtype:"CBX_weekday",_width:__width_FieldChar(12)+__width_Trigger}},defaultItem:{xtype:"numberfield",_width:__width_FieldChar(3)+__width_Trigger},promptSave:true});
this.callParent([a])
},getDefaultValues:function(){return({enable_by_ip:false,enable_by_number:false,enable_by_domain:false,week_start:2,hours_history_in_days:7,days_history_in_weeks:4,weeks_history_in_months:6,months_history_in_years:4})
}});
Ext.define("Billing.TestPanel",{extend:"Ext.Panel",subsystem:"billing",constructor:function(a){Ext.applyIf(a,{layout:{type:"hbox",align:"stretch"},items:[{xtype:"form",items:this.createFormRequest({labelAlign:"right",labelWidth_char:15}),border:false,bodyStyle:{background:__color_FormBackground},listeners:{scope:this,afterrender:function(b){this.requestForm=b
}}},{xtype:"form",items:this.createFormResponse({labelAlign:"right",labelWidth_char:15}),border:false,bodyStyle:{background:__color_FormBackground},listeners:{scope:this,afterrender:function(b){this.responseForm=b
}}},{xtype:"container",layout:"fit",items:{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield_h16",value:this.findLangS("field","debug_output"),fieldStyle:{"font-style":"italic"}},{xtype:"panel",flex:1,autoScroll:true,listeners:{scope:this,afterrender:function(b){this.debugPanel=b
}},bodyStyle:{padding:4,background:__color_FormBackground}}],style:{marginLeft:10}},flex:1}],bodyStyle:{padding:6,background:__color_FormBackground},listeners:{scope:this,resize:function(){if(this.debugPanel&&this.debugPanel.getHeight()>0&&this.getHeight()>0){if(!this.diffHeightDebugPanel){this.diffHeightDebugPanel=this.getHeight()-this.debugPanel.getHeight()
}if(this.diffHeightDebugPanel>0){this.debugPanel.setHeight(this.getHeight()-this.diffHeightDebugPanel)
}}},afterrender:function(){this.doTestBilling(true)
}}});
this.callParent([a])
},createFormRequest:function(b){var a=[{xtype:"displayfield_h16",value:this.findLangS("field","request"),style:{marginLeft:b&&b.labelWidth_char&&(__width_FieldChar(b.labelWidth_char)+__width_LabelFieldSeparator)},fieldStyle:{"font-weight":"bold","font-style":"italic"}},{xtype:"datetimefield",name:"calldate",inEditor:true},{xtype:"timefield_dhms",name:"duration",days:false,seconds:true},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"caller",widthChar:12},{xtype:"textfield",name:"caller_domain",widthChar:12,labelLang:"domain",labelWidthCh:8}],style:{marginBottom:__height_FieldSeparator}},{xtype:"container",layout:"hbox",items:[{xtype:"textfield",name:"called",widthChar:12},{xtype:"textfield",name:"called_domain",widthChar:12,labelLang:"domain",labelWidthCh:8}],style:{marginBottom:__height_FieldSeparator}},{xtype:"textfield",name:"sipcallerip",widthChar:20,vtype:"testIP"},{xtype:"textfield",name:"sipcalledip",widthChar:20,vtype:"testIP"},{xtype:"CBX_sensor",name:"sensor_id",widthChar:20}];
this.completeFormItems(a,Ext.apply({},b,{request:true}));
return(a)
},createFormResponse:function(b){var a=[{xtype:"displayfield_h16",value:this.findLangS("field","response"),style:{marginLeft:b&&b.labelWidth_char&&(__width_FieldChar(b.labelWidth_char)+__width_LabelFieldSeparator)},fieldStyle:{"font-weight":"bold","font-style":"italic"}},{xtype:"textfield",name:"price_operator",widthNum:14,readOnly:true,fieldStyle:{"text-align":"right",background:"none","background-color":__style_FormBackground}},{xtype:"textfield",name:"price_customer",widthNum:14,readOnly:true,fieldStyle:{"text-align":"right",background:"none","background-color":__style_FormBackground}}];
this.completeFormItems(a,Ext.apply({},b,{response:true}));
return(a)
},completeFormItems:function(a,c){for(var d=0;
d<a.length;
d++){if(a[d].name){var b=this.findLangS("field",a[d].labelLang||a[d].name);
if(b){a[d].fieldLabel=b;
a[d].labelAlign=c&&c.labelAlign||"right",a[d].labelWidth=a[d].labelWidthCh?__width_FieldChar(a[d].labelWidthCh):c&&c.labelWidth_char&&__width_FieldChar(c.labelWidth_char);
if(a[d].widthChar||a[d].widthNum){a[d].width=__width_Form(a[d].labelWidth,a[d].widthChar?__width_FieldChar(a[d].widthChar):__width_FieldNum(a[d].widthNum))
}}if(c.request){if(!a[d].listeners){a[d].listeners={}
}Ext.applyIf(a[d].listeners,{scope:this,change:this.onChangeRequestField,select:this.onSelectRequestField})
}}if(a[d].items){this.completeFormItems(a[d].items,c)
}}},onChangeRequestField:function(){if(this.requestForm.isValid()){this.doTestBilling(true)
}},onSelectRequestField:function(){this.doTestBilling(true)
},doTestBilling:function(b){if(this._timeoutResponseId){clearInterval(this._timeoutResponseId);
this._timeoutResponseId=null
}if(b){this._timeoutResponseId=setTimeout(Ext.bind(function(){this.doTestBilling()
},this),500);
return
}var a=this.getRequest();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"billing",params:Ext.encode({task:"test",request:a})},success:function(c){if(c.rslt){var h=c.rslt.operator_price;
if(h>0){if(c.rslt.operator_currency_code){h+="&thinsp;"+c.rslt.operator_currency_code
}this.getField("price_operator").setValue(h)
}else{this.getField("price_operator").setValue("")
}var m=c.rslt.customer_price;
if(m>0){if(c.rslt.customer_currency_code){m+="&thinsp;"+c.rslt.customer_currency_code
}this.getField("price_customer").setValue(m)
}else{this.getField("price_customer").setValue("")
}var l="";
for(var g=0;
g<2;
g++){var k=g==0?"operator":"customer";
var d=c.rslt[k+"_debug"];
if(d&&d.length){if(l){l+="<br>"
}l+='<span style="font-size: 120%; color: blue">'+this.findLangS("text",k)+"</span><br>";
for(var f=0;
f<d.length;
f++){l+='<span style="font-size: 110%;">'+d[f]+"</span><br>"
}}}this.setDebugPanelContent(l)
}else{if(c.error){this.clearResponse();
this.setDebugPanelContent('<span style="font-size: 110%; color: red;">'+c.error+"</span>")
}else{this.clearResponse()
}}}})
},getRequest:function(){var c={};
var b=this.requestForm.getForm().getFieldValues();
for(var a in b){if(!a.match("field")){c[a]=b[a]
}}if(!c.calldate){c.calldate=new Date
}return(c)
},clearResponse:function(){this.getField("price_operator").setValue("");
this.getField("price_customer").setValue("");
this.setDebugPanelContent("")
},getField:function(a){return(this.requestForm.getForm().findField(a)||this.responseForm.getForm().findField(a))
},setDebugPanelContent:function(a){this.debugPanel.setHtml(a)
}});
Ext.define("Billing.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.billing_configurationPanelX",subsystem:"billing",constructor:function(a){this.billingGrid=new Billing.Grid({_panel:this,title:this.findLangS("title","billingTab")});
this.holidayStateGrid=new Billing.HolidayState.Grid({_panel:this,title:this.findLangS("title","holidayStateTab")});
this.operatorAssignmentGrid=new Billing.Assignment.Grid({_operator:true,_panel:this,title:this.findLangS("title","operatorAssignmentTab")});
this.customerAssignmentGrid=new Billing.Assignment.Grid({_operator:false,_panel:this,title:this.findLangS("title","customerAssignmentTab")});
this.excludeAddresses=new Billing.Exclude.AddressesNumbersDomains.Grid({_type:"addresses",_panel:this,title:this.findLangS("title","addressesTab")});
this.excludeNumbers=new Billing.Exclude.AddressesNumbersDomains.Grid({_type:"numbers",_panel:this,title:this.findLangS("title","numbersTab")});
this.excludeDomains=new Billing.Exclude.AddressesNumbersDomains.Grid({_type:"domains",_panel:this,title:this.findLangS("title","domainsTab")});
this.agregationSettings=new Billing.Agregation.Settings({_panel:this,title:this.findLangS("title","settingsTab")});
this.agregationExcludeAddresses=new Billing.Exclude.AddressesNumbersDomains.Grid({_type:"addresses",_panel:this,title:this.findLangS("title","excludeAddressesTab"),storeId:"BillingAgregationExcludeAddressesStore",module:"billing_agregation_exclude_addresses"});
this.agregationExcludeNumbers=new Billing.Exclude.AddressesNumbersDomains.Grid({_type:"numbers",_panel:this,title:this.findLangS("title","excludeNumbersTab"),storeId:"BillingAgregationExcludeNumbersStore",module:"billing_agregation_exclude_numbers"});
this.agregationExcludeDomains=new Billing.Exclude.AddressesNumbersDomains.Grid({_type:"domains",_panel:this,title:this.findLangS("title","excludeDomainsTab"),storeId:"BillingAgregationExcludeDomainsStore",module:"billing_agregation_exclude_domains"});
this.currency=new OtherTables.Currency.Grid({_panel:this,title:this.findLangS("title","currencyTab")});
this.settings=new Billing.Settings({_panel:this,title:this.findLangS("title","settingsTab")});
this.testPanel=new Billing.TestPanel({collapsible:true,collapsedCls:"no-border",region:"south",floatable:true,span:true,border:false,title:this.findLangS("title","billingTest"),collapsible:true});
a=Ext.applyIf(a||{},{id:"billing_configuration-panel",layout:"border",bodyBorder:false,defaults:{split:true,animFloat:false,autoHide:false,useSplitTips:true},items:[{xtype:"panel",layout:"fit",region:"center",border:false,items:{xtype:"tabpanel",layout:"fit",items:[this.billingGrid,this.holidayStateGrid,this.operatorAssignmentGrid,this.customerAssignmentGrid,{xtype:"tabpanel",items:[this.excludeAddresses,this.excludeNumbers,this.excludeDomains],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",title:this.findLangS("title","excludeTab"),tabBar:{renderTpl:__tpl_simplyTabPanel}},{xtype:"tabpanel",items:[this.agregationSettings,this.agregationExcludeAddresses,this.agregationExcludeNumbers,this.agregationExcludeDomains],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",title:this.findLangS("title","agregationTab"),listeners:{beforedeactivate:function(b,c){return(this.agregationSettings.beforeDeactivateControl.call(this.agregationSettings,b,c))
},scope:this},tabBar:{renderTpl:__tpl_simplyTabPanel}},this.currency,this.settings],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel},listeners:{scope:this,tabchange:function(){this.doTestBilling(true)
}}}},this.testPanel],titleLang:"billingConfiguration",wikiId:"Billing"});
this.callParent([a])
},reactivate:function(){this.doTestBilling(true)
},doTestBilling:function(a){if(this.testPanel){this.testPanel.doTestBilling(a)
}}});
Ext.define("Billing.Utils",{singleton:true,subsystem:"billing",getComboAdata:function(a){switch(a){case"default_use_for_number_format":case"use_for_number_format":return([["original",this.findLangS("combodata","numberFormat_original")],["normalized",this.findLangS("combodata","numberFormat_normalized")],["both",this.findLangS("combodata","numberFormat_both")]]);
case"default_use_for_number_type":case"use_for_number_type":return([["local",this.findLangS("combodata","numberType_local")],["international",this.findLangS("combodata","numberType_international")],["both",this.findLangS("combodata","numberType_both")]])
}},revaluationBilling:function(t){var u=this;
var k=Ext.Date.format(new Date,__format_DateTimeDb)+(user_id()?"_"+user_id():"")+"_"+Math.floor(Math.random()*1000);
var g=15;
var o=30;
var b=new Ext.FormPanel({frame:true,border:false,autoHeight:true,autoWidth:true,labelAlign:"right",items:[{name:"id_customer",xtype:"ComboBoxX",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"billing",recordStruct:rsBilling,sortField:"name",columns:[{fields:"name",widthCh:30}],allowBlank:false,editable:false,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true,emptyText:this.findLangS("text","auto"),fieldLabel:this.findLangS("field","customer_rule"),labelWidth:__width_FieldChar(g),width:__width_FormChar(g,o)},{name:"id_operator",xtype:"ComboBoxX",valueField:"id",displayField:"name",url:"php/model/sql.php",module:"billing",recordStruct:rsBilling,sortField:"name",columns:[{fields:"name",widthCh:30}],allowBlank:false,editable:false,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true,emptyText:this.findLangS("text","auto"),fieldLabel:this.findLangS("field","operator_rule"),labelWidth:__width_FieldChar(g),width:__width_FormChar(g,o)},{name:"use_exclude_rules",xtype:"checkbox",value:true,fieldLabel:this.findLangS("field","use_exclude_rules"),labelWidth:__width_FieldChar(g),width:__width_FormChar(g,o)},{xtype:"container",layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"button",text:this.findLangS("button","start"),iconCls:"icon_go",_id:"btn_start",handler:function(){d()
}},{xtype:"button",text:this.findLangS("button","stop"),iconCls:"icon_stop",_id:"btn_stop",disabled:true,handler:function(){p()
},style:{marginLeft:4}}],width:__width_FormChar(g,o),style:{marginTop:10}},{xtype:"progressbar",width:__width_FormChar(g,o),_id:"progressbar",hidden:true,style:{marginTop:10}},{xtype:"displayfield",fieldLabel:this.findLangS("field","progress"),labelWidth:__width_FieldChar(g),width:__width_FormChar(g,o),_id:"progresstext",hidden:true}]});
var s={run:a,interval:1000};
var m=false;
var c=new Ext.Window({iconCls:"icon_coins",title:this.findLangS("title",t.cdr_ids?"revaluationBilling_selectedRows":"revaluationBilling_allFilteredRows"),autoHeight:true,border:false,layout:"fit",modal:true,items:b,listeners:{afterrender:function(){Ext.TaskManager.start(s)
},close:function(){Ext.TaskManager.stop(s);
p(true)
}}});
c.show();
function d(){n(true)
}function p(v){if(m){if(!v){c.maskLoad()
}h()
}}function a(){if(m){q()
}}function r(){if(b.getEl()&&b.getEl().dom){b.getForm().findField("id_operator").disable();
b.getForm().findField("id_customer").disable();
b.getForm().findField("use_exclude_rules").disable();
b.findC("_id","btn_start").disable();
b.findC("_id","btn_stop").enable();
b.findC("_id","progressbar").show();
b.findC("_id","progresstext").show();
b.findC("_id","progressbar").updateProgress(0);
b.findC("_id","progresstext").setValue("")
}m=true
}function l(){if(b.getEl()&&b.getEl().dom){b.getForm().findField("id_operator").enable();
b.getForm().findField("id_customer").enable();
b.getForm().findField("use_exclude_rules").enable();
b.findC("_id","btn_start").enable();
b.findC("_id","btn_stop").disable();
b.findC("_id","progressbar").hide();
b.findC("_id","progresstext").hide()
}m=false
}function n(v){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"billing",params:Ext.encode({task:"revaluation_prepare",params:{cdr_ids:t.cdr_ids,cdr_filter:t.cdr_filter,id_operator:b.getForm().findField("id_operator").getValue(),id_customer:b.getForm().findField("id_customer").getValue(),use_exclude_rules:b.getForm().findField("use_exclude_rules").getValue()?1:0},revaluation_id:k})},success:function(w){if(v){r();
f()
}}})
}function f(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"billing",params:Ext.encode({task:"revaluation_go",revaluation_id:k})},success:function(v){l();
if(v.ok){Ext.Msg.alert("",u.findLangS("text","theRevaluationWasCompletedSuccessfully"),function(w){c.close();
if(t.onSuccess){t.onSuccess()
}})
}},error2:function(){l()
},failure2:function(){l()
},timeout:12*60*60*1000})
}function h(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"billing",params:Ext.encode({task:"revaluation_stop",revaluation_id:k})},success:function(v){l();
if(c.getEl()&&c.getEl().dom){c.unmask()
}}})
}function q(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"billing",params:Ext.encode({task:"revaluation_state",revaluation_id:k})},success:function(v){var w=b.findC("_id","progressbar");
var y=b.findC("_id","progresstext");
if(w&&y){if(v.prepare){y.setValue("prepare")
}else{if(v.total){w.updateProgress(v.processed/v.total);
y.setValue(v.processed+" / "+v.total)
}}}}})
}},findLangS:function(a,b){return(findLangS(this.subsystem,a,b))
}});
function refreshBilling(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"refreshBilling"},success:function(){},error:function(){}})
}Ext.ns("OtherTables");
Ext.define("OtherTables.Currency.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"otherTables",constructor:function(b){b=Ext.applyIf(b||{},{storeId:"CurrencyStore",url:"php/model/sql.php",module:"currency",recordStruct:rsCurrency,sortField:"code",remoteSort:true,columns:[{dataIndex:"code",widthCh:12},{dataIndex:"custom_code",widthCh:12},{dataIndex:"name"},{dataIndex:"country_name",widthCh:25},{dataIndex:"main_currency",widthCh:12,renderer:renderTick,align:"center"},{dataIndex:"exchange_rate",widthCh:12,renderer:a,align:"right"}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(m,g,l,h){var k=[];
if(window.currencyCodes){var n=cloneObject(window.currencyCodes);
if(h&&h.data&&h.data.code){var d=false;
for(var f=0;
f<n.count;
f++){if(n[f][0]==h.data.code){d=true;
break
}}if(!d){n.push([h.data.code,h.data.name])
}}k.push({xtype:"ComboBoxA",name:"code",widthCh:13,allowBlank:false,aData:n,displayField:"id",_tpl:"{id} - {descr}",listConfig:{minWidth:300},_clearButton:true})
}else{k.push({name:"code",widthCh:10,allowBlank:false})
}k.push({name:"custom_code",widthCh:10},{name:"name",allowBlank:false},{name:"country_code",xtype:"ComboBoxX",valueField:"code",displayField:"name",url:"php/model/sql.php",module:"country_code",recordStruct:rsCountryCode,extraParams:{withoutContinents:true},sortField:"name",columns:[{fields:"code",widthNum:5},{fields:"name",widthCh:30}],editable:false,_stringValue:true,_autoDisableIfEmpty:true,_listVertScroller:true,_clearButton:true},{name:"main_currency",xtype:"checkbox"});
var c=this.getMainCurrencyCode();
if(c){k.push({xtype:"container",layout:"hbox",items:[{name:"exchange_rate",xtype:"textfield",widthNum:10,_enableDecPoint:true},{xtype:"displayfield_h16",value:c,_id:"exchange_rate_currency",style:{marginLeft:__width_FieldSeparator}}],style:{marginBottom:__height_FieldSeparator}})
}k.push({name:"description",xtype:"textarea",heightL:3});
return(k)
},enableEdit:true,enableSearchX:true,prefixCls:"currency",stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([b]);
function a(l,c,f,m,k,g,d){if(f.data.main_currency||!f.data.exchange_rate){return("")
}var h=d.ownerCt.getMainCurrencyCode();
if(!h){return("")
}return(f.data.exchange_rate+" "+h)
}},getMainCurrencyCode:function(){for(var a=0;
a<this.store.getCount();
a++){var b=this.store.getAt(a).data;
if(b.main_currency){return(b.custom_code||b.code||"")
}}return(null)
},onChangeRecords:function(a,b){if(b.exchange_rate){this.refresh()
}refreshBilling()
},setContextItems:function(a,d,f,h,g,c,b){if(h&&h.name=="code"&&f=="select"){this.getField("name").setValue(g?h.store.getById(g).data.descr:null)
}this.enableFieldIf("exchange_rate",!d.main_currency);
this.showItemBy("_id","exchange_rate_currency",!d.main_currency)
}});
Ext.define("OtherTables.Utils",{singleton:true,subsystem:"otherTables",fillCurencyCodes:function(){}});
Ext.ns("ACL");
Ext.define("ACL.Forms",{extend:Ext.form.FormPanel,constructor:function(a){a=Ext.applyIf(a||{},{windowTitle:a.type=="acl_whitelist"?"White List":a.type=="acl_blacklist"?"Black List":"Configuration",frame:true,border:false,autoWidth:true,autoHeight:true,labelAlign:"right",items:d(),buttons:[{text:lang.saveButtonText,iconCls:"icon_save",scope:this,handler:function(){this.ownerCt.close()
}},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){this.ownerCt.close()
}}]});
this.callParent([a]);
function d(){switch(a.type){case"acl_configuration":return(b());
case"acl_whitelist":case"acl_blacklist":return(c())
}}function b(){return[{xtype:"textfield",fieldLabel:"CISCO IP",width:200},{xtype:"textfield",fieldLabel:"port",width:150},{xtype:"textfield",fieldLabel:"username",width:250},{xtype:"textfield",fieldLabel:"password",width:250}]
}function c(){return[{xtype:"textfield",fieldLabel:"IP address",width:250},{xtype:"button",text:"add",width:50,hideLabel:true,style:{marginLeft:150}},{xtype:"textarea",fieldLabel:"IP addresses",width:250,height:300,disabled:true}]
}}});
Ext.ns("Fields");
Ext.define("Fields.CBX_Codec",{extend:"Ext.ux.combobox.ComboBoxA",alias:"widget.CBX_Codec",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxA",fieldLabel:findLangS("fields","field","CBX_Codec"),name:"codec",valueField:"id",displayField:"descr",editable:false,aData:{data:arCodec,fields:["id","id_string","descr"]}});
this.callParent([a])
}});
Ext.define("Fields.CBX_RegState",{extend:"Ext.ux.combobox.ComboBoxA",alias:"widget.CBX_RegState",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxA",fieldLabel:findLangS("fields","field","CBX_RegState"),name:"state",valueField:"id",displayField:"descr",editable:false,aData:{data:arRegState,fields:["id","descr"]}});
this.callParent([a])
}});
Ext.define("Fields.CBX_Trunk",{extend:"Ext.ux.combobox.ComboBoxA",alias:"widget.CBX_Trunk",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxA",fieldLabel:findLangS("fields","field","CBX_Trunk"),name:"trunk",editable:false,aData:arTrunk});
this.callParent([a])
}});
Ext.define("Fields.CBX_Users",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_Users",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",displayField:"username",fieldLabel:findLangS("fields","field","CBX_Users"),name:"user_uid",url:"php/model/sql.php",module:"user_admin",sortField:"username",recordStruct:rsUserAdmin,columns:[{title:findLangS("fields","field","CBX_Users"),fields:"username",widthCh:30}],editable:false,_enableZeroValue:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_Groups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_Groups",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",displayField:"name",fieldLabel:findLangS("fields","field","CBX_Groups"),url:"php/model/sql.php",module:"group_admin",sortField:"name",recordStruct:rsUserAdmin,columns:[{title:findLangS("fields","field","CBX_Groups"),fields:"name",widthCh:30}],editable:false,_enableZeroValue:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_ScreenPopupProfile",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_ScreenPopupProfile",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",displayField:"name",fieldLabel:findLangS("fields","field","CBX_ScreenPopupProfile"),url:"php/model/sql.php",module:"screen_popup_profile",sortField:"name",recordStruct:rsScreenPopupProfile,columns:[{title:findLangS("fields","field","CBX_ScreenPopupProfile"),fields:"name",widthCh:30}],editable:false});
this.callParent([a])
}});
Ext.define("Fields.CBX_CdrSipUsers",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_CdrSipUsers",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"sip_user_id",displayField:findLangS("fields","field","CBX_CdrSipUsers"),name:"sip_user_id",url:"php/model/sql.php",module:"CDR_sipUsers",sortField:"sip_user_name",recordStruct:rsCDR_sipUsers,columns:[{title:findLangS("fields","field","CBX_CdrSipUsers"),fields:"sip_user_name",widthCh:25}],editable:false,_enableZeroValue:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_CdrSipIP",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_CdrSipIP",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"sipip",displayField:"sip_iphost",fieldLabel:findLangS("fields","field","CBX_CdrSipIP"),name:"sipip",url:"php/model/sql.php",module:"CDR_sipIP",sortField:"sipip",recordStruct:rsCDR_sipIP,columns:[{title:findLangS("fields","field","CBX_CdrSipIP"),fields:"sip_ip",widthCh:15},{title:findLangS("fields","column","CBX_CdrSipIP_hostname"),fields:"sip_hostname",widthCh:25}],editable:false,_enableZeroValue:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_CdrCodecsA",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_CdrCodecsA",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"x_payload",displayField:"x_codec",fieldLabel:findLangS("fields","field","CBX_CdrCodecsA"),name:"x_payload",url:"php/model/sql.php",module:"CDR_codecsA",sortField:"payload",recordStruct:rsCDR_codecsA,columns:[{title:findLangS("fields","field","CBX_CdrCodecsA"),fields:"x_codec",widthCh:15}],editable:false,_enableZeroValue:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_CdrErrCodes",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_CdrErrCodes",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"lastSIPresponse",displayField:"lastSIPresponse",fieldLabel:findLangS("fields","field","CBX_CdrErrCodes"),name:"lastSIPresponse",url:"php/model/sql.php",module:"CDR_errCodes",sortField:"lastSIPresponse",recordStruct:rsCDR_errCodes,columns:[{title:findLangS("fields","column","CBX_CdrErrCodes"),fields:"lastSIPresponse",widthCh:25}],editable:false,_stringValue:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_MessageErrCodes",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_MessageErrCodes",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"lastSIPresponse",displayField:"lastSIPresponse",fieldLabel:findLangS("fields","field","CBX_MessageErrCodes"),name:"lastSIPresponse",url:"php/model/sql.php",module:"message_errCodes",sortField:"lastSIPresponse",recordStruct:rsCDR_errCodes,columns:[{title:findLangS("fields","column","CBX_MessageErrCodes"),fields:"lastSIPresponse",widthCh:25}],editable:false,_stringValue:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_MessageSipIP",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_MessageSipIP",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"sipip",displayField:"sip_iphost",fieldLabel:findLangS("fields","field","CBX_MessageSipIP"),name:"sipip",url:"php/model/sql.php",module:"message_sipIP",sortField:"sipip",recordStruct:rsCDR_sipIP,columns:[{title:findLangS("fields","field","CBX_MessageSipIP"),fields:"sip_ip",widthCh:15},{title:findLangS("fields","column","CBX_MessageSipIP_hostname"),fields:"sip_hostname",widthCh:25}],editable:false,_enableZeroValue:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_cbIpGroups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbIpGroups",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbIpGroups"),name:"cb_ip_groups_id",url:"php/model/sql.php",module:"cb_ip_groups",sortField:"descr",recordStruct:rsCbIpGroups,columns:[{title:findLangS("fields","column","CBX_cbIpGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbIpGroups_IP"),fields:"ip",widthCh:40}],pageSize:30,editable:false,_editTablePanel:Codebook.ipGroups.Grid,_autoDisableIfEmpty:!a._editTableButton});
this.callParent([a])
}});
Ext.define("Fields.CBX_cbNumberGroups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbNumberGroups",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbNumberGroups"),name:"cb_number_groups_id",url:"php/model/sql.php",module:"cb_number_groups",sortField:"descr",recordStruct:rsCbNumberGroups,columns:[{title:findLangS("fields","column","CBX_cbNumberGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbNumberGroups_number"),fields:"number",widthCh:40}],pageSize:30,editable:false,_editTablePanel:Codebook.numberGroups.Grid,_autoDisableIfEmpty:!a._editTableButton});
this.callParent([a])
}});
Ext.define("Fields.CBX_cbDomainGroups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbDomainGroups",constructor:function(a){var b=[{title:findLangS("fields","column","CBX_cbDomainGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbDomainGroups_domain"),fields:"domain",widthCh:40}];
if(!a.extraParams||!a.extraParams.side){b.push({title:findLangS("fields","column","CBX_cbDomainGroups_side"),fields:"side",widthCh:10,renderer:"renderSideCbDomainGroups"})
}Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbDomainGroups"),name:"cb_domain_groups_id",url:"php/model/sql.php",module:"cb_domain_groups",sortField:"descr",recordStruct:rsCbDomainGroups,columns:b,pageSize:30,editable:false,_editTablePanel:Codebook.domainGroups.Grid,_autoDisableIfEmpty:!a._editTableButton});
this.callParent([a])
},setSide:function(b){var c=this.store.proxy.extraParams.side;
if(!(!b&&!c||b==c)){var d={};
if(b){d.side=b
}this.setBaseParams(d);
this.clearStore();
var a=[{title:findLangS("fields","column","CBX_cbDomainGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbDomainGroups_domain"),fields:"domain",widthCh:40}];
if(!b){a.push({title:findLangS("fields","column","CBX_cbDomainGroups_side"),fields:"side",widthCh:10,renderer:"renderSideCbDomainGroups"})
}this.tpl=this.getTemplate(a,this);
this.listConfig.minWidth=this.getWidthTable(a)+3+(this.pageSize>0||this._listVertScroller?__width_Scroller:0);
if(this.picker){this.picker.destroy()
}this.picker=this.createPicker()
}}});
Ext.define("Fields.CBX_cbEmailGroups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbEmailGroups",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbEmailGroups"),name:"cb_email_groups_id",url:"php/model/sql.php",module:"cb_email_groups",sortField:"descr",recordStruct:rsCbEmailGroups,columns:[{title:findLangS("fields","column","CBX_cbEmailGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbEmailGroups_email"),fields:"email",widthCh:40}],editable:false});
this.callParent([a])
}});
Ext.define("Fields.CBX_cbCountryGroups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbCountryGroups",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbCountryGroups"),name:"cb_country_groups_id",url:"php/model/sql.php",module:"cb_country_groups",sortField:"descr",recordStruct:rsCbCountryGroups,columns:[{title:findLangS("fields","column","CBX_cbCountryGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbCountryGroups_country"),fields:"country",widthCh:40}],editable:false});
this.callParent([a])
}});
Ext.define("Fields.CBX_cbUaGroups",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbUaGroups",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbUaGroups"),name:"cb_ua_groups_id",url:"php/model/sql.php",module:"cb_ua_groups",sortField:"descr",recordStruct:rsCbUaGroups,columns:[{title:findLangS("fields","column","CBX_cbUaGroups_descr"),fields:"descr",widthCh:40},{title:findLangS("fields","column","CBX_cbUaGroups_ua"),fields:"ua",widthCh:40}],editable:false,_editTablePanel:Codebook.uaGroups.Grid,_autoDisableIfEmpty:!a._editTableButton});
this.callParent([a])
}});
Ext.define("Fields.CBX_cbTimePeriod",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cbTimePeriod",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cbTimePeriod"),name:"cb_timeperiod_id",url:"php/model/sql.php",module:"cb_timeperiod",sortField:"descr",recordStruct:rsCbTimePeriod,columns:[{title:findLangS("fields","column","CBX_cbTimePeriod_descr"),fields:"descr",widthCh:40}],editable:false,_editTablePanel:Codebook.timePeriod.Grid,_autoDisableIfEmpty:!a._editTableButton});
this.callParent([a])
}});
Ext.define("Fields.CBX_trackerStatus",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_trackerStatus",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_trackerStatus"),name:"status_id",displayField:"status",url:"php/model/sql.php",module:"tracker_status",sortField:"status_type",recordStruct:rsTrackerStatus,columns:[{title:findLangS("fields","column","CBX_trackerStatus_type"),fields:"status",widthCh:20},{title:findLangS("fields","column","CBX_trackerStatus_descr"),fields:"description",widthCh:40}],editable:false,_editTablePanel:Tracker.Status.Grid});
this.callParent([a])
}});
Ext.define("Fields.CBX_trackerCategory",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_trackerCategory",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_trackerCategory"),name:"category_id",displayField:"category",url:"php/model/sql.php",module:"tracker_category",sortField:"category",recordStruct:rsTrackerCategory,columns:[{title:findLangS("fields","column","CBX_trackerCategory_type"),fields:"category",widthCh:20},{title:findLangS("fields","column","CBX_trackerCategory_descr"),fields:"description",widthCh:40}],editable:false,_editTablePanel:Tracker.Category.Grid});
this.callParent([a])
}});
Ext.define("Fields.CBX_cust_reseller",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_custReseller",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:"auto_subsystem",name:"reseller_id",displayField:"name",url:"php/model/sql.php",module:"cust_resellers",sortField:"name",recordStruct:rsCustResellers,columns:[{fields:"name",widthCh:40}],subsystem:"cust",_listVertScroller:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_cust_customer",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_custCustomer",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:"auto_subsystem",name:"customer_id",displayField:"name",url:"php/model/sql.php",module:"cust_customers",sortField:"name",recordStruct:rsCustCustomers,extraParams:{without_subsidiaries:true},columns:[{fields:"name",widthCh:40}],subsystem:"cust",pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_cust_customer_ip_detail",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_custCustomerIpDetail",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",valueField:"ip",displayField:"ip",url:"php/model/sql.php",module:"cust_customer_ip_detail",recordStruct:rsCustCustomer_ip_detail,extraParams:{customer:a.customer},columns:[{fields:["city","address"],titleLang:"postAddress",widthCh:40},{fields:["connection_type","ip:bold"],titleLang:"type_ip",widthCh:30}],subsystem:"cust",_listVertScroller:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_sensor",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_sensor",constructor:function(b){var a=[];
if(b._addEmptySensorId&&window.vpmanagerhost&&window.localSensorId<0){a.push({id:_sensorId_empty,name:'<span style="color:blue">'+findLangS("fields","text","CBX_sensor_empty")+"</span>"})
}if(b._addAll&&user.sqlrow._count_enable_sensors*1!=0){a.push({id:_sensorId_all,name:'<span style="color:red">'+findLangS("fields","text","CBX_sensor_all")+"</span>"})
}var c=[];
if(b.columnSensorId||b._sensorIdWidth){c.push({fields:"id_sensor",widthCh:b._sensorIdWidth||7,align:"right",renderer:"renderIdSensor"})
}c.push({fields:"name",widthCh:b._nameWidth||b._listWidth||20});
Ext.applyIf(b||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_sensor"),name:"sensor_id",displayField:"name",url:"php/model/sql.php",module:"sensors",extraParams:{excludeIds:b.excludeIds?Ext.encode(b.excludeIds):undefined},sortField:"name",recordStruct:rsSensors,columns:c,editable:false,_enableNegativeValue:true,_stripTags:b&&(b._addEmptySensorId||b._addALL),_disableFilterField:true,initStore:function(d,g){for(var h=0;
h<a.length;
h++){var k=true;
if(a[h].id==_sensorId_empty){if(g._hideEmptyIfNotNeed){for(var f=0;
f<d.getCount();
f++){if((d.getAt(f).data.host==window.vpmanagerhost||d.getAt(f).data.host=="127.0.0.1"||d.getAt(f).data.host=="localhost")&&d.getAt(f).data.port==window.vpmanagerport){k=false
}}}}else{if(a[h].id==_sensorId_all){if(d.getCount()==1&&g._hideAllIfNotNeed){k=false
}}}if(k){d.add(a[h])
}}},_afterLoadStore:function(d){if(!this._initSetLocalSensor||this.value){return
}var f=null;
d.each(function(g){if(g.data.id==_sensorId_empty){f=_sensorId_empty
}});
if(!f){d.each(function(g){if((g.data.host==window.vpmanagerhost||g.data.host=="127.0.0.1"||g.data.host=="localhost")&&g.data.port==window.vpmanagerport){f=g.data.id
}})
}if(f){this.setValue(f)
}},_afterLoadStoreSelect:function(f,d){if(!Ext.isArray(d)){if(Ext.isString(d)){d=d.split(",")
}else{d=[String(d)]
}}if(d.inArray(String(_sensorId_empty))){this.addRecord(f,{id:_sensorId_empty,name:'<span style="color:blue">'+findLangS("fields","text","CBX_sensor_empty")+"</span>"},0,true)
}if(d.inArray(String(_sensorId_all))){this.addRecord(f,{id:_sensorId_all,name:'<span style="color:red">'+findLangS("fields","text","CBX_sensor_all")+"</span>"},0,true)
}}});
this.callParent([b])
}});
Ext.define("Fields.CBX_cdrCharts",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_cdrCharts",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_cdrCharts"),name:"cdr_chart_id",displayField:"name",url:"php/model/sql.php",module:"cdr_charts",sortField:"name",recordStruct:rsCdrCharts,columns:[{fields:"name",widthCh:30}],editable:false});
this.callParent([a])
}});
Ext.define("Fields.CBX_messageTypes",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_messageTypes",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",fieldLabel:findLangS("fields","field","CBX_messageTypes"),name:"message_type",valueField:"name",displayField:"name",url:"php/model/sql.php",module:"message_types",sortField:"name",recordStruct:rsMessageTypes,columns:[{fields:"name",widthCh:30}],_stringValue:true,editable:false});
this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_timeperiod",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_timeperiod",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_timeperiod",sortField:"timeperiod_name",recordStruct:rsNagios_timeperiod,displayField:"timeperiod_name",columns:[{fields:"timeperiod_name",widthCh:50}],_autoDisableIfEmpty:true});
if(a.withoutTimeperiodId){a.extraParams={withoutTimeperiodId:a.withoutTimeperiodId}
}this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_command",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_command",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_command",recordStruct:rsNagios_command,displayField:"command_name",columns:[{fields:"category",widthCh:20},{fields:"command_name",widthCh:35}],_autoDisableIfEmpty:true,_listVertScroller:true});
this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_contact",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_contact",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_contact",sortField:"contact_name",recordStruct:rsNagios_contact,displayField:"contact_name",columns:[{fields:"contact_name",widthCh:50}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_contactgroup",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_contactgroup",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_contactgroup",sortField:"contactgroup_name",recordStruct:rsNagios_contactgroup,displayField:"contactgroup_name",columns:[{fields:"contactgroup_name",widthCh:50}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_host",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_host",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_host",sortField:"host_name",recordStruct:rsNagios_host,displayField:"host_name",columns:[{fields:"host_name",widthCh:50}],_autoDisableIfEmpty:true,pageSize:30});
if(a.withoutHostId){a.extraParams={withoutHostId:a.withoutHostId}
}this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_hostgroup",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_hostgroup",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_hostgroup",sortField:"hostgroup_name",recordStruct:rsNagios_hostgroup,displayField:"hostgroup_name",columns:[{fields:"hostgroup_name",widthCh:50}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_service",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_service",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_service",sortField:"service_description",recordStruct:rsNagios_service,displayField:"service_description",columns:[{fields:"service_description",widthCh:50}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_nagios_servicegroup",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_nagios_servicegroup",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"nagios_servicegroup",sortField:"servicegroup_name",recordStruct:rsNagios_servicegroup,displayField:"servicegroup_name",columns:[{fields:"servicegroup_name",widthCh:50}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_alerts",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_alerts",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"alerts",sortField:"descr",recordStruct:rsAlerts,displayField:"descr",columns:[{fields:"descr",widthCh:40}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_dailyReports",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_dailyReports",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"daily_reports",sortField:"descr",recordStruct:rsDailyReports,displayField:"descr",columns:[{fields:"descr",widthCh:40}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
}});
Ext.define("Fields.CBX_alertsSent",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_alertsSent",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"alerts_sended",sortField:"send_time",sortDirection:"DESC",recordStruct:rsAlertsSended,displayField:"send_time",columns:[{fields:"send_time",widthNum:12,renderer:"renderDateTime"},{fields:"alert_descr",widthNum:30}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
},getDisplayValue:function(){if(this.value){var a=this.findRecord(this.valueField,this.value);
if(a){return(renderDateTime(a.data.send_time)+" / "+(this._maxLenDescr?a.data.alert_descr.substr(0,this._maxLenDescr):a.data.alert_descr))
}}return("")
}});
Ext.define("Fields.CBX_dailyReportsSent",{extend:"Ext.ux.combobox.ComboBoxX",alias:"widget.CBX_dailyReportsSent",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxX",url:"php/model/sql.php",module:"daily_reports_sended",sortField:"send_time",sortDirection:"DESC",recordStruct:rsDailyReportsSended,displayField:"send_time",columns:[{fields:"send_time",widthNum:12,renderer:"renderDateTime"},{fields:"report_descr",widthNum:30}],_autoDisableIfEmpty:true,pageSize:30});
this.callParent([a])
},getDisplayValue:function(){if(this.value){var a=this.findRecord(this.valueField,this.value);
if(a){return(renderDateTime(a.data.send_time)+" / "+(this._maxLenDescr?a.data.report_descr.substr(0,this._maxLenDescr):a.data.report_descr))
}}return("")
}});
Ext.define("Fields.CBX_weekday",{extend:"Ext.ux.combobox.ComboBoxA",alias:"widget.CBX_weekday",constructor:function(a){Ext.applyIf(a||{},{xtype:"ComboBoxA",valueField:"id",displayField:"descr",editable:false,aData:{data:arWeekday,fields:["id","descr"]}});
this.callParent([a])
}});
Ext.define("Fields.DisplayFieldVo3",{extend:"Ext.form.DisplayField",alias:"widget.displayfield_vo3",constructor:function(a){var b=a&&a.style?Ext.apply({},a.style):{};
a=Ext.apply({},a);
a.style=b;
Ext.applyIf(a.style,{paddingTop:3});
this.callParent([a])
}});
Ext.define("Fields.DisplayFieldHeight16",{extend:"Ext.form.DisplayField",alias:"widget.displayfield_h16",constructor:function(a){var b=a&&a.fieldStyle?Ext.apply({},a.fieldStyle):{};
a=Ext.apply({},a);
a.fieldStyle=b;
Ext.applyIf(a.fieldStyle,{height:"16px !important","min-height":"16px !important"});
this.callParent([a])
}});
Ext.define("Fields.DisplayFieldHeight16Vo3",{extend:"Ext.form.DisplayField",alias:"widget.displayfield_h16_vo3",constructor:function(a){var c=a&&a.style?Ext.apply({},a.style):{};
var b=a&&a.fieldStyle?Ext.apply({},a.fieldStyle):{};
a=Ext.apply({},a);
a.style=c;
a.fieldStyle=b;
Ext.applyIf(a.style,{paddingTop:3});
Ext.applyIf(a.fieldStyle,{height:"16px !important","min-height":"16px !important"});
this.callParent([a])
}});
Ext.define("Fields.MultiLevelsTree",{extend:"Ext.tree.Panel",constructor:function(b){var a=Ext.create("Ext.data.TreeStore",{model:b.modelName,proxy:{type:"ajax",url:"php/model/utilities.php",actionMethods:"POST",extraParams:{task:b.loadTask,params:Ext.encode({format:"json"})}},sorters:b.sorters,listeners:{scope:this,load:this.onLoad}});
b=Ext.applyIf(b||{},{store:a,rootVisible:false,useArrows:true,width:250,height:250,animate:false,isFormField:true,catchAllEventsField:false,listeners:{},bufferedRenderer:false});
Ext.applyIf(b.listeners,{scope:this,checkchange:this.onCheckChange,afteritemcollapse:this.onAfterItemCollapse,afteritemexpand:this.onAfterItemExpand});
this.callParent([b])
},onCheckChange:function(b,a){switch(this.getNodeLevel(b)){case 0:this.setCheckedChildNodes(b,a);
break;
case 1:this.setCheckStateMain(b.parentNode);
break
}if(a){this.clearInvalid()
}if(this.comboField&&this.comboField.onSelect){this.comboField.onSelect(this.getValue())
}},onAfterItemCollapse:function(a){this.setCheckStateMain(a)
},onAfterItemExpand:function(a){this.setCheckStateMain(a)
},onLoad:function(){if(this._value){this.setValue(this._value)
}},setCheckStateMain:function(a){if(this.isAllSelectChildNodes(a)){a.set("checked",true)
}else{if(this.isAnySelectChildNodes(a)){a.set("checked",false);
this.setNodeBackgroundImage(a,true)
}else{a.set("checked",false);
this.setNodeBackgroundImage(a,false)
}}},setNodeBackgroundImage:function(c,a){var b=this.getView().getNode(c);
if(b){var d=Ext.get(this.getView().getNode(c)).down(".x-tree-checkbox");
if(d){if(a){d.setStyle({"background-position":"0px -26px"})
}else{d.setStyle({"background-position":"0px 0px"})
}}}},isAllSelectChildNodes:function(c){if(!c.childNodes.length){return(false)
}var a=0;
for(var b=0;
b<c.childNodes.length;
b++){if(c.childNodes[b].get("checked")){++a
}}return(c.childNodes.length==a)
},isAnySelectChildNodes:function(b){for(var a=0;
a<b.childNodes.length;
a++){if(b.childNodes[a].get("checked")){return(true)
}}return(false)
},setCheckedChildNodes:function(c,b){for(var a=0;
a<c.childNodes.length;
a++){c.childNodes[a].set("checked",b)
}},getNodeLevel:function(b){for(var a=0;
a<this.levels.length;
a++){if(b.data[this.levels[a].field]==this.levels[a].value){return(a)
}}return(undefined)
},clearAll:function(){var a=this.getRootNode();
if(this.useFullParentNodes){for(var b=0;
b<a.childNodes.length;
b++){a.childNodes[b].set("checked",false);
this.setCheckedChildNodes(a.childNodes[b],false)
}}else{a.cascadeBy(function(c){c.set("checked",false)
},this);
a.eachChild(function(c){this.setCheckStateMain(c,false)
},this)
}},getName:function(){return(this.name)
},setValue:function(g){this._value=g;
this.clearAll();
if(!g){return
}var f=g.split(",");
var b=this.getRootNode();
if(this.useFullParentNodes){for(var d=0;
d<b.childNodes.length;
d++){if(f.isIn(b.childNodes[d].data.id)){b.childNodes[d].set("checked",true);
this.setCheckedChildNodes(b.childNodes[d],true)
}else{var a=b.childNodes[d].childNodes;
var h=false;
for(var c=0;
c<a.length;
c++){if(f.isIn(a[c].data.id)){a[c].set("checked",true);
h=true
}}if(h){this.setCheckStateMain(b.childNodes[d])
}}}}else{b.cascadeBy(function(l){var k=l.data.leaf&&f.isIn(l.data.id);
l.set("checked",k)
},this);
b.eachChild(function(k){if(k.childNodes&&k.childNodes.length){this.setCheckStateMain(k)
}},this)
}},getValue:function(){var f=[];
var b=this.getRootNode();
if(this.useFullParentNodes){for(var d=0;
d<b.childNodes.length;
d++){if(this.isAllSelectChildNodes(b.childNodes[d])){f.push(b.childNodes[d].data.id)
}else{if(this.isAnySelectChildNodes(b.childNodes[d])){var a=b.childNodes[d].childNodes;
for(var c=0;
c<a.length;
c++){if(a[c].get("checked")){f.push(a[c].data.id)
}}}}}}else{b.cascadeBy(function(g){if(g.data.leaf&&g.get("checked")){f.push(g.data.id)
}},this)
}return(f.length?f.join(","):null)
},getSubmitData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},getModelData:function(){var a={};
a[this.name]=this.getValue();
return(a)
},isValid:function(){return(this.allowBlank===false?(this.getValue()!=null):true)
},validate:function(){var a=this.isValid();
if(a){this.clearInvalid()
}else{this.setInvalid()
}return(a)
},clearInvalid:function(){if(this.getEl()){this.getEl().setStyle({border:""})
}},setInvalid:function(){if(this.getEl()){this.getEl().setStyle({border:"1px red solid"})
}},isFileUpload:function(){return(false)
}});
Ext.define("Fields.CountryTree",{extend:"Fields.MultiLevelsTree",alias:"widget.country_tree",constructor:function(b){var a="country";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:[{name:"id"},{name:"code"},{name:"type"},{name:"text"},{name:"iconCls"}],idProperty:"id"})
}Ext.applyIf(b,{loadTask:"getCountryTree",modelName:a,sorters:[{property:"leaf",direction:"ASC"},{property:"text",direction:"ASC"}],levels:[{field:"type",value:"continent"},{field:"type",value:"country"}],useFullParentNodes:true});
this.callParent([b])
}});
Ext.define("Fields.CountryTreeField",{extend:"Ext.form.field.Picker",alias:"widget.country_tree_field",matchFieldWidth:false,constructor:function(a){Ext.applyIf(a,{triggers:{clear:{cls:"x-form-clear-trigger",handler:this.onClear,scope:this,weight:-1}}});
this.callParent([a])
},onClear:function(){this.collapse();
this.setValue(null)
},onTriggerClick:function(){if(this.isExpanded){this.collapse()
}else{this.expand()
}},createPicker:function(){return(new Fields.CountryTree({floating:true,comboField:this}))
},onSelect:function(a){this.setValue(a)
},onExpand:function(){this.picker.setValue(this.getValue())
},isDirty:function(){return(false)
}});
Ext.define("Fields.PhonePrefixesTree",{extend:"Fields.MultiLevelsTree",alias:"widget.phone_prefixes_tree",constructor:function(b){var a="phone_prefixes";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:[{name:"id"},{name:"prefix"},{name:"type"},{name:"country_code"},{name:"text"}],idProperty:"id"})
}Ext.applyIf(b,{loadTask:"getPhonePrefixesTree",modelName:a,sorters:[{property:"text",direction:"ASC"}],levels:[{field:"type",value:"main_prefix"},{field:"type",value:"sub_prefix"}]});
this.callParent([b])
}});
Ext.define("Fields.CBX_treeArrange",{extend:"Ext.ux.combobox.ComboBoxT",alias:"widget.CBX_treeArrange",constructor:function(a){Ext.applyIf(a,{xtype:"ComboBoxT",createPicker:function(){var b=new Tools.Tree.Arrange({dataType:this.dataType,animate:false,autoScroll:true,disableTbar:true,disableDD:true,onlyFolders:true,comboBox:true,onClick:function(c){this.setValue(c.id,c.name);
this.collapse()
},onClickScope:this});
return(new Ext.container.Container({floating:true,focusOnShow:true,layout:"fit",items:b,getNavigationModel:function(){return(b.getNavigationModel())
},getSelectionModel:function(){return(b.getSelectionModel())
},refresh:function(){},bindStore:function(c){},onUnbindStore:function(){}}))
}});
this.callParent([a])
}});
Ext.define("upgrade",{extend:"Ext.Panel",alias:"widget.upgradePanelX",constructor:function(a){Ext.apply(a,{id:"upgrade-panel",title:"Upgrade",iconCls:"icon_menu_diag_monitor",layout:"border",bodyBorder:false,defaults:{collapsible:true,split:true,animFloat:false,autoHide:false,useSplitTips:true},items:{collapsible:false,region:"center",layout:"fit",border:false,items:{xtype:"component",border:false,autoEl:{tag:"iframe",src:"upgrade.php"}}}});
this.callParent([a])
},reactivate:function(){}});
Ext.ns("Network");
Ext.define("Network.IpAddress.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"network",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NetworkIpAddressStore",url:"php/model/sql.php",module:"network_ip_address",recordStruct:rsNetworkIpAddress,sortField:"name",remoteSort:true,pageSize:30,columns:[{dataIndex:"name"},{dataIndex:"interface",widthCh:10},{dataIndex:"ip_address",widthCh:15}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(k,g,h,c){var b=[];
if(k.netInterfaces&&k.netInterfaces.length){for(var f=0;
f<k.netInterfaces.length;
f++){b.push([k.netInterfaces[f],k.netInterfaces[f]])
}}var d=[{name:"name",allowBlank:false},{name:"interface",xtype:"ComboBoxA",aData:b,allowBlank:false},{name:"mac_address"},{name:"vlan",xtype:"checkbox"},{name:"vlan_id",widthCh:10},{name:"type",xtype:"ComboBoxA",aData:{data:arTypeIp,fields:["id","id_string","descr"]},widthCh:10,allowBlank:false},{name:"ip_address",allowBlank:false},{name:"network_subnet",allowBlank:false},{name:"dhcp_hostname"},{name:"dhcp_lease_time"},{name:"dhcp_vendor"}];
return(d)
},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getNetInterfaces",enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},tbar:[{text:this.findLangS("button","restartNetwork"),handler:this.restartNetwork,scope:this},"-"]});
this.callParent([a])
},setContextItems:function(a,d,f,h,g,c,b){this.showField(["ip_address","network_subnet"],d.type==0);
this.allowBlankField(["ip_address","network_subnet"],d.type==0?false:true);
this.showField(["dhcp_hostname","dhcp_lease_time","dhcp_vendor"],d.type==1)
},getDefaultValues:function(){return{type:0,dhcp_lease_time:3600}
},restartNetwork:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartNetwork"},maskEl:this})
}});
Ext.define("Network.Bridge.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"network",constructor:function(c){var d=20;
var f=40;
var b=60;
var a=__width_FormChar(d,f)+__width_FieldChar(b)+8;
c=Ext.applyIf(c||{},{storeId:"NetworkBridgeStore",url:"php/model/sql.php",module:"network_bridge",recordStruct:rsNetworkBridge,sortField:"interface_name",remoteSort:true,pageSize:30,columns:[{dataIndex:"interface_name"},{dataIndex:"description",widthCh:15}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(m,k,l,g){this.gridBridgeInterfaces=new Network.Bridge.Interfaces.Grid({memoryStore:true,relFields:k?undefined:{id_network_bridge:g.data.id},enableSearchX:false,width:__width_FieldChar(b),height:150,border:true,flex:1,columnsDefaults:{sortable:true,widthCh:35}});
var h=[{name:"interface_name",allowBlank:false},{name:"description",xtype:"textarea",heightL:3},{value:this.findLangS("field","interfaces"),xtype:"displayfield",widthCh:40,fieldStyle:{"font-weight":"bold",color:"darkblue"}},this.gridBridgeInterfaces];
return(h)
},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getNetInterfaces",enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},tbar:[{text:this.findLangS("button","restartNetwork"),handler:this.restartNetwork,scope:this},"-"]});
this.callParent([c])
},prepareDataForSave:function(a){if(this.gridBridgeInterfaces){a.bridgeInterfaces=this.gridBridgeInterfaces.getAllGridData(true);
a.bridgeInterfaces_deleteRecords=this.gridBridgeInterfaces._deleteRecords
}},restartNetwork:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartNetwork"},maskEl:this})
}});
Ext.define("Network.Bridge.Interfaces.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"network",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"NetworkBridgeInterfacesStore",url:"php/model/sql.php",module:"network_bridge_interfaces",recordStruct:rsNetworkBridgeInterfaces,sortField:"interface",remoteSort:true,columns:[{dataIndex:"interface"}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(k,g,h,c){var b=[];
if(k.netInterfaces&&k.netInterfaces.length){for(var f=0;
f<k.netInterfaces.length;
f++){b.push([k.netInterfaces[f],k.netInterfaces[f]])
}}var d=[{name:"interface",xtype:"ComboBoxA",aData:b,allowBlank:false}];
return(d)
},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getNetNonBridgeInterfaces",enableEdit:true,enableSearchX:false,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true}});
this.callParent([a])
},prepareDataForSave:function(c,a){if(this.memoryStore){var b=this.getField("name");
if(b){var d=b.getValue();
if(d){c.name=d
}}}}});
Ext.define("Network.Routing.Grid",{extend:"Ext.ux.grid.GridForm",subsystem:"network",constructor:function(a){a=Ext.applyIf(a||{},{storeId:"RoutingAddressStore",url:"php/model/sql.php",module:"network_routing",recordStruct:rsNetworkRouting,sortField:"name",remoteSort:true,pageSize:30,columns:[{dataIndex:"name"},{dataIndex:"network",widthCh:10},{dataIndex:"network_mask",widthCh:10},{dataIndex:"gateway",widthCh:10},{dataIndex:"interface",widthCh:10}],columnsDefaults:{sortable:true,widthCh:40},fpDefaults:{xtype:"textfield",widthCh:40,labelCh:20,disableAutoAddTriggerWidth:true},fpItems:function(k,g,h,c){var b=[];
b.push(["auto","auto"]);
if(k.netInterfaces&&k.netInterfaces.length){for(var f=0;
f<k.netInterfaces.length;
f++){b.push([k.netInterfaces[f],k.netInterfaces[f]])
}}var d=[{name:"name",allowBlank:false},{name:"network"},{name:"network_mask"},{name:"gateway"},{name:"source_ip"},{name:"interface",xtype:"ComboBoxA",aData:b,allowBlank:false}];
return(d)
},ajaxParamsUrl:"php/model/utilities.php",ajaxParamsTask:"getNetAllInterfaces",enableEdit:true,enableSearchX:true,paginatorPrependButtons:true,paginatorDisplayInfo:false,stripeRows:false,deferredLoad:true,subsystemConfig:{columnStrict:true,columnEnableDataIndex:true,fieldStrict:true,fieldEnableName:true,helpStrict:true},tbar:[{text:this.findLangS("button","restartNetwork"),handler:this.restartNetwork,scope:this},"-"]});
this.callParent([a])
},setContextItems:function(a,d,f,h,g,c,b){this.showField(["ip_address","network_subnet"],d.type==0);
this.allowBlankField(["ip_address","network_subnet"],d.type==0?false:true);
this.showField(["dhcp_hostname","dhcp_lease_time","dhcp_vendor"],d.type==1)
},getDefaultValues:function(){return{network:"default","interface":"auto"}
},restartNetwork:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"restartNetwork"},maskEl:this})
}});
Ext.define("Network.DNS.Panel",{extend:"Ext.ux.setting.Form",subsystem:"network",constructor:function(a){Ext.applyIf(a,{settingTableStruct:rsNetworkDNS,settingTableName:"network_dns",widthLabel_char:20,widthField_char:40,specItems:{hostname:{allowBlank:false},domain:{allowBlank:false},dns_1:{allowBlank:false}},nextButtons:[{text:lang.reload,iconCls:"icon_reload",scope:this,handler:this.reload}]});
this.callParent([a])
},reload:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"networkReload",params:Ext.encode({table:"network_dns"})},maskEl:this})
}});
Ext.define("Network.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.networkPanelX",subsystem:"network",constructor:function(a){this.ipAddressesGrid=new Network.IpAddress.Grid({title:this.findLangS("title","ipAddressesTab")});
this.routingGrid=new Network.Routing.Grid({title:this.findLangS("title","routingTab")});
this.dnsPanel=new Network.DNS.Panel({_panel:this,title:this.findLangS("title","dnsTab")});
this.networkBridgeGrid=new Network.Bridge.Grid({title:this.findLangS("title","bridgeTab")});
a=Ext.applyIf(a||{},{id:"network-panel",layout:"fit",items:{xtype:"tabpanel",items:[this.ipAddressesGrid,this.routingGrid,this.networkBridgeGrid,this.dnsPanel],activeTab:0,plain:true,bodyBorder:false,border:false,cls:"panel-border-background-color",tabBar:{renderTpl:__tpl_simplyTabPanel}},titleLang:"network",wikiId:"Network"});
this.callParent([a])
}});
Ext.ns("Collectd");
Ext.define("Collectd.Panel",{extend:"Ext.Panel",subsystem:"collectd",constructor:function(c){if(!c){c={}
}var b=10;
var a=__width_FieldChar(b);
var d=[{xtype:"ComboBoxA",name:"module",fieldLabel:this.findLangS("field","module"),width:__width_Form(a,__width_FieldChar(58)),labelWidth:a,editable:false,aData:[],listeners:{scope:this,select:function(){this.showGraphs()
}},multiSelect:true,_stringValue:true},{xtype:"container",layout:"hbox",items:[{xtype:"displayfield",value:this.findLangS("field","from")+":",width:a+__width_LabelFieldSeparator},{xtype:"button",iconCls:"icon_time",menu:getStdMenuTimeFrom(this,function(f){this.setTypeTimePeriod(f._typeTimeFrom);
this.reloadGraphs()
})},{xtype:"datefield",name:"date_from",format:__format_Date,width:__width_FieldDate,labelWidth:a,listeners:{scope:this,select:function(g,f){this.setTypeTimePeriod(null);
this.reloadGraphs()
}},style:{marginLeft:4}},{xtype:"timefield",name:"time_from",increment:30,format:__format_TimeM,width:__width_FieldTimeM,labelWidth:a,listeners:{scope:this,select:function(g,f){this.setTypeTimePeriod(null);
this.reloadGraphs()
}},style:{marginLeft:2}},{xtype:"displayfield",value:this.findLangS("field","to")+":",style:{marginLeft:10,marginRight:5}},{xtype:"datefield",name:"date_to",format:__format_Date,width:__width_FieldDate,labelWidth:a,listeners:{scope:this,select:function(g,f){this.setTypeTimePeriod(null);
this.reloadGraphs()
}}},{xtype:"timefield",name:"time_to",increment:30,format:__format_TimeM,width:__width_FieldTimeM,labelWidth:a,listeners:{scope:this,select:function(g,f){this.setTypeTimePeriod(null);
this.reloadGraphs()
}},style:{marginLeft:2}},{xtype:"button",iconCls:"icon_reload",handler:function(){this.setTimeFromToViaTypeTimePeriod();
this.reloadGraphs()
},scope:this,style:{marginLeft:4}}],style:{marginBottom:__height_FieldSeparator}}];
Ext.applyIf(c,{layout:{type:"vbox",align:"stretch"},items:[{xtype:"form",items:d,border:false,bodyStyle:{"background-color":__color_WindowFrame}},{xtype:"container",name:"graphs",flex:1,width:"100%",autoScroll:true}],border:false,bodyStyle:{"background-color":__color_WindowFrame},listeners:{scope:this,afterrender:this.onAfterRender,destroy:this.onDestroy},windowTitle:"Collectd",iconCls:"icon_menu_diag_system",width:600,height:Ext.dom.Element.getViewportHeight()-60});
this.callParent([c])
},onAfterRender:function(){this.setTypeTimePeriod("last_60m");
this.fillPlugins();
var a=0;
this.autoReload=Ext.TaskManager.start({run:function(){if(a){this.setTimeFromToViaTypeTimePeriod();
this.reloadGraphs()
}++a
},interval:60000,scope:this})
},onDestroy:function(){Ext.TaskManager.stop(this.autoReload)
},fillPlugins:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"collectd",params:Ext.encode({subtask:"getplugins"})},success:function(a){if(!a.plugins.length){return
}var c=this.getField("module");
for(var b=0;
b<a.plugins.length;
b++){c.addMenuItem({id:a.plugins[b],descr:a.plugins[b]})
}if(!c.getValue()||!c.getValue().length){c.setValue(a.plugins[0]);
this.showGraphs(a.plugins[0])
}}})
},showGraphs:function(a,b){if(!b){var g=this.getGraphsContainer();
g.removeAll()
}if(!a){var d=this.getField("module");
a=d.getValue()
}var f=this.getField("date_from").getValue()?completeDateTime(this.getField("date_from").getValue(),this.getField("time_from").getValue()):null;
var c=this.getField("date_to").getValue()?completeDateTime(this.getField("date_to").getValue(),this.getField("time_to").getValue()):null;
if(c&&!this.getField("time_to").getValue()){c=date(new Date(c.getTime()+36*3600*1000))
}if(!c){c=dateTimeM(new Date)
}if(!f){f=dateTimeM(new Date(c.getTime()-3600*1000))
}if(b){this.__reloadGraphs(f,c)
}else{this._showGraphs(a,0,f,c)
}},reloadGraphs:function(){this.showGraphs(null,true)
},_showGraphs:function(b,a,d,c){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"collectd",params:Ext.encode({subtask:"getgraphs",plugin:Ext.isArray(b)?b[a]:b})},success:function(f){this.__showGraphs(f.graphs,d,c);
if(Ext.isArray(b)&&a<b.length-1){this._showGraphs(b,a+1,d,c)
}}})
},__showGraphs:function(a,h,f){var k=this.getGraphsContainer();
var d=k.getWidth()-__width_Scroller-3;
var c=parseInt(d/2);
for(var b=0;
b<a.length;
b++){var g={subtask:"getgraph",params1:a[b],params2:{begin:parseInt(h.getTime()/1000),end:parseInt(f.getTime()/1000),width:d,heigth:c,background:__color_WindowFrame.substr(1),noframe:true}};
k.add({xtype:"container",items:{xtype:"image",width:d,height:c,src:"php/model/utilities.php?task=collectd&params="+encodeURIComponent(Ext.encode(g))},width:d,height:c,style:{marginTop:5,marginBottom:5},_params1:a[b]})
}},__reloadGraphs:function(h,f){var k=this.getGraphsContainer();
var d=k.getWidth()-__width_Scroller-3;
var c=parseInt(d/2);
for(var b=0;
b<k.items.getCount();
b++){var a=k.items.get(b);
var g={subtask:"getgraph",params1:a._params1,params2:{begin:parseInt(h.getTime()/1000),end:parseInt(f.getTime()/1000),width:d,heigth:c,background:__color_WindowFrame.substr(1),noframe:true}};
a.items.get(0).setSrc("php/model/utilities.php?task=collectd&params="+encodeURIComponent(Ext.encode(g)))
}},getField:function(a){return(this.getItem(a,"name",true))
},getGraphsContainer:function(){return(this.getItem("graphs","name",true))
},setTypeTimePeriod:function(a){this.typeTimePeriod=a;
if(this.typeTimePeriod){this.setTimeFromToViaTypeTimePeriod()
}},setTimeFromToViaTypeTimePeriod:function(){if(!this.typeTimePeriod){return
}var a=dateTimeM(getTimeInterval(this.typeTimePeriod)[0]);
var b=getTimeInterval(this.typeTimePeriod)[1];
if(b){b=dateTimeM(b)
}this.getField("date_from").setValue(date(a));
this.getField("time_from").setValue(time_sec(a)?time(a):null);
this.getField("date_to").setValue(b?date(b):null);
this.getField("time_to").setValue(b&&time_sec(b)?time(b):null)
}});
Ext.ns("SvgPaint");
Ext.define("SvgPaint.Vector",{constructor:function(b,a){this.set(b,a)
},set:function(b,a){this.start=Ext.isArray(b)?{x:b[0],y:b[1]}:b;
this.end=Ext.isArray(a)?{x:a[0],y:a[1]}:a
},intersect:function(c){var g=(c.end.y-c.start.y)*(this.end.x-this.start.x)-(c.end.x-c.start.x)*(this.end.y-this.start.y);
if(g==0){return(null)
}var d=((c.end.x-c.start.x)*(this.start.y-c.start.y)-(c.end.y-c.start.y)*(this.start.x-c.start.x))/g;
var b=((this.end.x-this.start.x)*(this.start.y-c.start.y)-(this.end.y-this.start.y)*(this.start.x-c.start.x))/g;
var a=this.start.x+d*(this.end.x-this.start.x);
var f=this.start.y+d*(this.end.y-this.start.y);
return({x:a,y:f,seg1:d>=0&&d<=1,seg2:b>=0&&b<=1,vect_point:Math.abs(c.start.x-a)<Math.abs(a-c.end.x)&&Math.abs(c.start.y-f)<Math.abs(f-c.end.y)?"start":"end"})
}});
Ext.define("SvgPaint.Bounds",{setFromXY:function(b,a){this.x=Ext.isDefined(b.x)?b.x:b[0];
this.y=Ext.isDefined(b.y)?b.y:b[1];
this.right=Ext.isDefined(a.x)?a.x:b[0];
this.bottom=Ext.isDefined(a.y)?a.y:b[1];
this._setNextItems()
},setFromCoords:function(b,a){this.x=Ext.isDefined(a.x)?a.x:a[0];
this.y=Ext.isDefined(b.y)?b.y:b[1];
this.right=Ext.isDefined(b.x)?b.x:b[0];
this.bottom=Ext.isDefined(a.y)?a.y:a[1];
this._setNextItems()
},setFromBbox:function(a){this.x=a.x;
this.y=a.y;
this.right=a.x+a.width-1;
this.bottom=a.y+a.height-1;
this._setNextItems()
},addBbox:function(c){if(c.x<this.x){this.x=c.x
}if(c.y<this.y){this.y=c.y
}var a=c.x+c.width-1;
var b=c.y+c.height-1;
if(a>this.right){this.right=a
}if(b>this.bottom){this.bottom=b
}this._setNextItems()
},_setNextItems:function(){this.left=this.x;
this.top=this.y;
this.width=this.right-this.left+1;
this.height=this.bottom-this.top+1
},shiftPos:function(a,b){this.x+=a;
this.left+=a;
this.right+=a;
this.y+=b;
this.top+=b;
this.bottom+=b
},isXyIn:function(b){var a=Ext.isDefined(b.x)?b.x:b[0];
var c=Ext.isDefined(b.y)?b.y:b[1];
return(a>=this.left&&a<=this.right&&c>=this.top&&c<=this.bottom)
},isBoundsIn:function(c,a){var f=[[c.left,c.top],[c.right,c.top],[c.left,c.bottom],[c.right,c.bottom]];
for(var b=0;
b<f.length;
b++){var d=this.isXyIn(f[b]);
if(a){if(d){return(true)
}}else{if(!d){return(false)
}}}return(a?false:true)
},isVectorIn:function(d){var g=[];
var b=new SvgPaint.Vector;
for(var c=0;
c<4;
c++){var f={x:c==0||c==3?this.left:this.right,y:c==0||c==1?this.top:this.bottom};
var h={x:c==0||c==1?this.right:this.left,y:c==0||c==3?this.top:this.bottom};
b.set(f,h);
var a=b.intersect(d);
if(a&&a.seg1&&a.seg2){a.side=c==0?"top":c==1?"right":c==2?"bottom":"left";
g.push(a)
}}return(g.length?g:null)
},redukFromLeft:function(a){this.x+=a;
this.left+=a;
this.width-=a;
this._redukFromLeft=(this._redukFromLeft||0)+a
},redukFromRight:function(a){this.right-=a;
this.width-=a;
this._redukFromRight=(this._redukFromRight||0)+a
},redukFromTop:function(a){this.y+=a;
this.top+=a;
this.height-=a;
this._redukFromTop=(this._redukFromTop||0)+a
},redukFromBottom:function(a){this.bottom-=a;
this.height-=a;
this._redukFromBottom=(this._redukFromBottom||0)+a
},minRedukFromLeft:function(a){if(a>(this._redukFromLeft||0)){this.redukFromLeft(a-(this._redukFromLeft||0))
}},minRedukFromRight:function(a){if(a>(this._redukFromRight||0)){this.redukFromRight(a-(this._redukFromRight||0))
}},minRedukFromTop:function(a){if(a>(this._redukFromTop||0)){this.redukFromTop(a-(this._redukFromTop||0))
}},minRedukFromBottom:function(a){if(a>(this._redukFromBottom||0)){this.redukFromBottom(a-(this._redukFromBottom||0))
}}});
Ext.define("SvgPaint.Item",{constructor:function(a){this.type="item";
Ext.apply(this,a);
Ext.applyIf(a.configItem,this._getDefaultProperties(a.group?a.group.typeItem:null,a.typeItem,a.typeElement));
this.initXY();
this.initMatrix();
this.createSvgElement();
this.appendSvgElement();
this.initPosSvgElement()
},initXY:function(){var a={};
for(var b in this.configItem){if(b.toLowerCase){i2=b.toLowerCase();
if(["x","y","x1","y1","x2","y2","width","height"].isIn(i2)){a[i2]=this.configItem[b]*1
}}}if(Ext.isDefined(a.x)&&Ext.isDefined(a.y)){this.XY=[a.x,a.y]
}if(Ext.isDefined(a.x1)&&Ext.isDefined(a.y1)){this.XY1=[a.x1,a.y1]
}if(Ext.isDefined(a.x2)&&Ext.isDefined(a.y2)){this.XY2=[a.x2,a.y2]
}if(Ext.isDefined(a.width)&&Ext.isDefined(a.height)){this.WH=[a.width,a.height]
}},initMatrix:function(){this.matrix=[1,0,0,1,0,0]
},createSvgElement:function(){switch(this.typeElement){case"chart":this.svgEl=document.createElementNS(this._xmlns(),"image");
this.svgEl.setAttributeNS(null,"id",this.id);
break;
default:this.svgEl=document.createElementNS(this._xmlns(),this.typeElement);
this.svgEl.setAttributeNS(null,"id",this.id)
}if(this.configItem){for(var b in this.configItem){if(this.typeElement=="text"&&b=="text"){this.createSgvText(this.configItem[b])
}else{if(["size_perc","scale_perc"].isIn(b)){continue
}var c=this.configItem[b];
if(["width","height"].isIn(b)&&Ext.isDefined(this.configItem.size_perc)&&this.configItem.size_perc!=100){c=roundNumber(c*this.configItem.size_perc/100)
}this.svgEl.setAttributeNS(b=="href"?this._xlink():null,b,c)
}}}if(this.nextConfigItem){for(var b in this.nextConfigItem){switch(b){case"movable":if(this.nextConfigItem[b]){this.svgEl.setAttributeNS(null,"class","movable")
}break;
case"selectable":if(this.nextConfigItem[b]){this.svgEl.setAttributeNS(null,"class","selectable")
}break;
case"transformable":if(this.nextConfigItem[b]){this.svgEl.setAttributeNS(null,"class","movable");
this.svgEl.setAttributeNS(null,"transform",this.getMatrixString())
}break
}}}if(!(this.nextConfigItem&&this.nextConfigItem.no_events)){var a=["onmousedown","onmouseup","oncontextmenu"];
for(var b=0;
b<a.length;
b++){this.svgEl.setAttributeNS(null,a[b],'Ext.getCmp("'+this._painter_id()+'").evSvgElement_'+a[b]+"(evt);")
}}},appendSvgElement:function(){this._svg().appendChild(this.svgEl)
},initPosSvgElement:function(){if(this.isLineBetweenSnapItems()){switch(this.typeItem){case"line":this.setLineBetweenSnapItems();
break;
case"line_background":this.setLineBetweenSnapItems();
break;
case"text_base":case"text_center_start":case"text_center_end":case"text_marker_start":case"text_marker_end":this.setTextBetweenSnapItems(this.typeItem);
break;
case"text_background_base":case"text_background_center_start":case"text_background_center_end":this.setBackgroundTextBetweenSnapItems();
break
}if(this.group.getCountLinesBetweenSnapItems()>1){this.group.setElementsBetweenSnapItems()
}}},deleteSvgElement:function(){if(this.svgEl&&this.svgEl.remove){this.svgEl.remove();
delete this.svgEl
}},createSgvText:function(p){this.textSpans=[];
var m=p&&p.eexplode?p.eexplode(["\r\n","\r","\n"]):[];
for(var l=0;
l<m.length;
l++){var n=[m[l]];
var b=[];
while(match=n[n.length-1].match(/<tspan[^>]*>/)){b.push(match[0]);
n.push(n[n.length-1].substr(match.index+match[0].length));
n[n.length-2]=n[n.length-2].substr(0,match.index)
}for(var h=0;
h<b.length;
h++){var a=b[h].match(/font-size=(\d+)/);
var g=b[h].match(/fill=['"]([^'"]+)/);
var o=b[h].match(/dx=(\d+)/);
var d=null;
if(a||g||o){d={};
if(a){d["font-size"]=a[1]
}if(g){d.fill=g[1]
}if(o){d.dx=o[1]
}}b[h]=d
}for(var h=0;
h<n.length;
h++){var c=document.createElementNS(this._xmlns(),"tspan");
if(h==0){if(!this.isLineBetweenSnapItems()){c.setAttributeNS(null,"x",this.XY?this.XY[0]:0);
c.setAttributeNS(null,"dy",l?"1.2em":"1em")
}}else{if(b[h-1]){for(var f in b[h-1]){c.setAttributeNS(null,f,b[h-1][f])
}}}var q=document.createTextNode(n[h]);
c.appendChild(q);
this.svgEl.appendChild(c);
this.textSpans.push({textSpanEl:c,textEl:q,rowspan:h>0})
}}},deleteSvgText:function(){if(this.textSpans){for(var a=0;
a<this.textSpans.length;
a++){this.textSpans[a].textEl.remove();
this.textSpans[a].textSpanEl.remove()
}delete this.textSpans
}},destroy:function(){this.clearIndikSelect();
if(this.group){this.group.destroy();
return
}this._destroy();
this.container.destroyElementsBetweenSnapItems(this.group?this.group:this);
this.container.removeItem(this.id);
if(this._painter()){this._painter().evChange()
}},_destroy:function(){if(this._painter()&&this._painter().evBeforeDestroyItem){this._painter().evBeforeDestroyItem(this)
}this.deleteSvgElement()
},moveXY:function(a){if(this.group){this.group.moveXY(a);
return
}this._moveXY(a);
this.container.afterMove(this)
},_moveXY:function(b,a){this.svgEl.setAttributeNS(null,"x",(a?0:this.XY[0])+b[0]*1);
this.svgEl.setAttributeNS(null,"y",(a?0:this.XY[1])+b[1]*1);
if(this.selection&&this.selection.selectItem&&!a){this.selection.selectItem._moveXY(b)
}if(this.typeElement=="text"){this._moveXY_text(b,a)
}},_moveXY_text:function(c,a){if(this.textSpans){for(var b=0;
b<this.textSpans.length;
b++){if(!this.textSpans[b].rowspan){this.textSpans[b].textSpanEl.setAttributeNS(null,"x",(a?0:this.XY[0])+c[0]*1)
}}}},shiftXY:function(a){if(this.group){this.group.shiftXY(a);
return
}this._shiftXY(a)
},_shiftXY:function(l){var k=this.svgEl.getAttributeNS(null,"x");
var f=this.svgEl.getAttributeNS(null,"y");
if(!Ext.isEmpty(k)&&!Ext.isEmpty(f)){this.svgEl.setAttributeNS(null,"x",k*1+l[0]*1);
this.svgEl.setAttributeNS(null,"y",f*1+l[1]*1)
}var b=this.svgEl.getAttributeNS(null,"x1");
var h=this.svgEl.getAttributeNS(null,"y1");
if(!Ext.isEmpty(b)&&!Ext.isEmpty(h)){this.svgEl.setAttributeNS(null,"x1",b*1+l[0]*1);
this.svgEl.setAttributeNS(null,"y1",h*1+l[1]*1)
}var a=this.svgEl.getAttributeNS(null,"x2");
var g=this.svgEl.getAttributeNS(null,"y2");
if(!Ext.isEmpty(a)&&!Ext.isEmpty(g)){this.svgEl.setAttributeNS(null,"x2",a*1+l[0]*1);
this.svgEl.setAttributeNS(null,"y2",g*1+l[1]*1)
}var c=this.svgEl.getAttributeNS(null,"transform");
if(!Ext.isEmpty(c)){var d=c.match(/\(([0-9.-]+) ([0-9.-]+),([0-9.-]+)\)/);
if(d&&d.length==4){this.svgEl.setAttributeNS(null,"transform","rotate ("+d[1]+" "+(d[2]*1+l[0]*1)+","+(d[3]*1+l[1]*1)+")")
}}},_setX_text:function(a){if(this.textSpans){for(var b=0;
b<this.textSpans.length;
b++){if(!this.textSpans[b].rowspan){this.textSpans[b].textSpanEl.setAttributeNS(null,"x",a)
}}}},fixXY:function(a){if(this.group){this.group.fixXY(a);
return
}this._fixXY();
this.container.afterMove(this)
},_fixXY:function(){var g=false;
var a={};
if(this.XY){var h=[this.svgEl.getAttributeNS(null,"x")*1,this.svgEl.getAttributeNS(null,"y")*1];
if(h[0]!=this.XY[0]||h[1]!=this.XY[1]){g=true
}this.XY=h;
a.x=h[0];
a.y=h[1]
}if(this.XY1){var f=[this.svgEl.getAttributeNS(null,"x1")*1,this.svgEl.getAttributeNS(null,"y1")*1];
if(f[0]!=this.XY1[0]||f[1]!=this.XY1[1]){g=true
}this.XY1=f;
a.x1=f[0];
a.y1=f[1]
}if(this.XY2){var d=[this.svgEl.getAttributeNS(null,"x2")*1,this.svgEl.getAttributeNS(null,"y2")*1];
if(d[0]!=this.XY2[0]||d[1]!=this.XY2[1]){g=true
}this.XY2=d;
a.x2=d[0];
a.y2=d[1]
}for(var b in a){if(b.toUpperCase){var c=b.toUpperCase();
if(Ext.isDefined(this.configItem[b])){this.configItem[b]=a[b]
}else{if(Ext.isDefined(this.configItem[c])){this.configItem[c]=a[b]
}}}}if(this.selection&&this.selection.selectItem){this.selection.selectItem._fixXY()
}if(g&&this._painter()){this._painter().evChange()
}return(g)
},setMatrix:function(){this.svgEl.setAttributeNS(null,"transform",this.getMatrixString())
},fixMatrix:function(){var a=this.svgEl.getAttributeNS(null,"transform");
if(a){var b=a.match(/matrix\((.*)\)/);
if(b&&b.length>=2){this.matrix=b[1].split(" ")
}}},getMatrixString:function(){return("matrix("+this.matrix.join(" ")+")")
},getOptimalSnapPointsForLine:function(){var h={text_left:3,text_right:3,other:2};
var r=this.group.snapItems[0].getCenterXY();
if(!r){return
}var f=this.group.snapItems[0].getBBoxes(true,h);
if(!f){return
}f.push(this.group.snapItems[0].getBBoxMinHoriz(true,h));
var q=this.group.snapItems[1].getCenterXY();
if(!q){return
}var d=this.group.snapItems[1].getBBoxes(true,h);
if(!d){return
}d.push(this.group.snapItems[1].getBBoxMinHoriz(true,h));
var o=r;
var m=q;
var l=this.group.getCountLinesBetweenSnapItems();
if(l>1){var a=this.group.getHeightLinesBetweenSnapItems();
var p=this.group.getPosHeightLinesBetweenSnapItems();
var n=this.group.getHeightForLineBetweenSnapItems();
var g=p+n[1]-(a/2);
var b=Math.atan((m[1]-o[1])/(m[0]-o[0]));
o[0]+=g*Math.sin(b);
m[0]+=g*Math.sin(b);
o[1]-=g*Math.cos(b);
m[1]-=g*Math.cos(b)
}for(var c=0;
c<f.length;
c++){var k=this.getBorderPoint(o,m,f[c]);
if(k){o=k
}}for(var c=0;
c<d.length;
c++){var k=this.getBorderPoint(m,o,d[c]);
if(k){m=k
}}o[0]=roundNumber(o[0]);
o[1]=roundNumber(o[1]);
m[0]=roundNumber(m[0]);
m[1]=roundNumber(m[1]);
return([o,m])
},setLineBetweenSnapItems:function(){var b=this.getOptimalSnapPointsForLine();
if(!b){return
}var c={x1:b[0][0],y1:b[0][1],x2:b[1][0],y2:b[1][1]};
for(var a in c){this.svgEl.setAttributeNS(null,a,c[a])
}this.XY1=b[0];
this.XY2=b[1]
},_setTextBetweenSnapItems:function(d){var g=this._getBBox();
var b=this.group.getXY12();
if(!b){b=this.getOptimalSnapPointsForLine()
}if(!b){return(null)
}var f=Math.atan((b[1][1]-b[0][1])/(b[1][0]-b[0][0]))/Math.PI*180;
var k=this.group.lineGroup?this.group.lineGroup.getPropertyInTypeItem("line","stroke-width"):this.group.getPropertyInTypeItem("line","stroke-width");
var a=k==1?15:k==2?19:k==3?22:k==4?26:0;
var c=(k-1)*0.75;
var h=d=="text_base"?[(b[1][0]+b[0][0])/2,(b[1][1]+b[0][1])/2]:d=="text_background_base"?[g.x,g.y]:d=="text_center_start"?[(b[1][0]+b[0][0])/2-Math.cos(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+(this.nextConfigItem&&this.nextConfigItem.leftRightMargin||0)),(b[1][1]+b[0][1])/2-Math.sin(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+(this.nextConfigItem&&this.nextConfigItem.leftRightMargin||0))]:d=="text_background_center_start"?[g.x,g.y]:d=="text_center_end"?[(b[1][0]+b[0][0])/2+Math.cos(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+(this.nextConfigItem&&this.nextConfigItem.leftRightMargin||0)),(b[1][1]+b[0][1])/2+Math.sin(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+(this.nextConfigItem&&this.nextConfigItem.leftRightMargin||0))]:d=="text_background_center_end"?[g.x,g.y]:d=="text_marker_start"?[b[0][0]+Math.cos(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+a),b[0][1]+Math.sin(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+a)]:d=="text_marker_end"?[b[1][0]-Math.cos(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+a),b[1][1]-Math.sin(f/180*Math.PI)*(b[0][0]<=b[1][0]?1:-1)*(g.width/2+a)]:null;
if(!h){return(null)
}var h=d=="text_base"||d=="text_center_start"||d=="text_center_end"?[h[0]+Math.sin(f/180*Math.PI)*(g.height*0.15+c),h[1]-Math.cos(f/180*Math.PI)*(g.height*0.15+c)]:d=="text_background_base"||d=="text_background_center_start"||d=="text_background_center_end"?[h[0],h[1]]:d=="text_marker_start"||d=="text_marker_end"?[h[0]-Math.sin(f/180*Math.PI)*(g.height*0.75+c),h[1]+Math.cos(f/180*Math.PI)*(g.height*0.75+c)]:null;
if(!(this.nextConfigItem&&this.nextConfigItem.disableRoundPos)){h[0]=roundNumber(h[0]);
h[1]=roundNumber(h[1]);
f=roundNumber(f,1)
}return({bbox:g,pos:h,angle:f})
},setTextBetweenSnapItems:function(b){var d=this._setTextBetweenSnapItems(b);
if(d&&Ext.isNumeric(d.pos[0])&&Ext.isNumeric(d.pos[1])&&Ext.isNumeric(d.angle)){this.svgEl.setAttributeNS(null,"x",d.pos[0]);
this.svgEl.setAttributeNS(null,"y",d.pos[1]);
this._pos_text=d.pos;
this.svgEl.setAttributeNS(null,"transform","rotate("+d.angle+" "+d.pos[0]+","+d.pos[1]+")")
}var c=this.typeItem=="text_base"?"text_background_base":this.typeItem=="text_center_start"?"text_background_center_start":this.typeItem=="text_center_end"?"text_background_center_end":null;
if(c){var a=this.group.items.find(function(f){return(f.typeItem==c)
});
if(a){a.setBackgroundTextBetweenSnapItems()
}}},setBackgroundTextBetweenSnapItems:function(){var a=this.typeItem=="text_background_base"?"text_base":this.typeItem=="text_background_center_start"?"text_center_start":this.typeItem=="text_background_center_end"?"text_center_end":null;
if(a){var b=this.group.items.find(function(d){return(d.typeItem==a)
});
if(b){var c=b._setTextBetweenSnapItems(this.typeItem);
if(c&&Ext.isNumeric(c.pos[0])&&Ext.isNumeric(c.pos[1])&&Ext.isNumeric(c.angle)){this.svgEl.setAttributeNS(null,"x",c.pos[0]-(b.nextConfigItem&&b.nextConfigItem.leftRightMargin||0));
this.svgEl.setAttributeNS(null,"y",c.pos[1]+(this.nextConfigItem&&this.nextConfigItem.redukY||0));
this.svgEl.setAttributeNS(null,"width",c.bbox.width+(b.nextConfigItem&&b.nextConfigItem.leftRightMargin||0)*2);
this.svgEl.setAttributeNS(null,"height",c.bbox.height+(this.nextConfigItem&&this.nextConfigItem.redukHeight||0));
this.svgEl.setAttributeNS(null,"transform","rotate("+c.angle+" "+(c.pos[0]+c.bbox.width/2)+","+(c.pos[1]+c.bbox.height-(c.bbox.height-(b._pos_text[1]-c.pos[1])))+")")
}}}},toFront:function(){if(this.group){this.group.toFront();
return
}this._toFront()
},_toFront:function(){this._svg().appendChild(this.svgEl)
},addIndikSelect:function(a){if(this.group){this.group.addIndikSelect(a);
return
}var b=this.getBBox(true,3);
this._addIndikSelect(a,b)
},_addIndikSelect:function(b,c){if(!b){b={}
}Ext.applyIf(b,{id:this.container.newIdSelectItem(),"stroke-dasharray":"1,1"});
var a=null;
if(this.isLineBetweenSnapItems()){a=this._addIndikSelect_lineBetweenSnapItems(b,c)
}else{a=this._addIndikSelect_rect(b,c)
}if(a){this.selection={selectItem:a,configSelect:b}
}},_addIndikSelect_rect:function(b,d){var c=Ext.applyIf(cloneObject(b)||{},{x:d.left,y:d.top,width:d.width,height:d.height,stroke:"#FF0000","stroke-width":1,fill:"none"});
var a=new SvgPaint.Item({type:"selection",typeItem:"selection_rect",typeElement:"rect",painter:this._painter(),configItem:c});
return(a)
},_addIndikSelect_lineBetweenSnapItems:function(n,k){var g=this.group.getXY12();
if(!g){g=this.getOptimalSnapPointsForLine()
}if(!g){return
}var h=this.group.getHeightForLineBetweenSnapItems();
var c=Math.atan((g[1][1]-g[0][1])/(g[1][0]-g[0][0]))/Math.PI*180;
var a=[(g[1][0]+g[0][0])/2,(g[1][1]+g[0][1])/2];
var b=Math.pow(Math.pow(g[1][0]-g[0][0],2)+Math.pow(g[1][1]-g[0][1],2),1/2)+2;
var l=h[0]+h[1];
var f=[a[0]+Math.sin(c/180*Math.PI)*h[0],a[1]-Math.cos(c/180*Math.PI)*h[0]];
c=roundNumber(c,1);
b=roundNumber(b);
l=roundNumber(l);
f[0]=roundNumber(f[0]);
f[1]=roundNumber(f[1]);
var d=Ext.applyIf(cloneObject(n)||{},{x:f[0]-b/2,y:f[1],width:b,height:l,stroke:"#FF0000","stroke-width":1,fill:"none",transform:"rotate("+c+" "+f[0]+","+f[1]+")"});
var m=new SvgPaint.Item({type:"selection",typeItem:"selection_line",typeElement:"rect",painter:this._painter(),configItem:d});
return(m)
},clearIndikSelect:function(){if(this.group){this.group.clearIndikSelect();
return
}this._clearIndikSelect()
},_clearIndikSelect:function(){if(this.selection&&this.selection.selectItem){this.selection.selectItem.deleteSvgElement()
}delete this.selection
},refreshIndikSelect:function(){if(!this.selection){return
}if(this.group){this.group.refreshIndikSelect();
return
}this._refreshIndikSelect()
},_refreshIndikSelect:function(){if(this.selection&&this.selection.selectItem){var b=this.selection.selectItem;
var a=this.selection.configSelect;
this.clearIndikSelect();
this.addIndikSelect(a)
}},relayout:function(a,d,c,b){if(this.group){this.group.relayout(a,d,c,b)
}},getBBox:function(b,a){if(this.group){return(this.group.getBBox(b,a))
}return(this._getBBox(b,a))
},getBBoxMinHoriz:function(b,a){if(this.group){return(this.group.getBBoxMinHoriz(b,a))
}return(this._getBBox(b,a))
},_getBBox:function(b,a){var f=this.svgEl.getBBox();
if(b){f.x=roundNumber(f.x);
f.y=roundNumber(f.y);
f.width=roundNumber(f.width);
f.height=roundNumber(f.height)
}if(a){var d=["left","right","top","bottom"];
var g={};
if(Ext.isNumber(a)){for(var c=0;
c<d.length;
c++){g[d[c]]=a
}}else{if(Ext.isObject(a)){for(var c=0;
c<d.length;
c++){g[d[c]]=this.group&&a[this._typeItemGroup()+"_"+this.typeItem+"_"+this.typeElement+"_"+d[c]]||a[this.typeItem+"_"+this.typeElement+"_"+d[c]]||a[this.typeItem+"_"+this.typeElement]||a[this.typeElement+"_"+d[c]]||a[this.typeElement]||a[d[c]]||a.other||0
}}}if(g){f.x-=g.left;
f.y-=g.top;
f.width+=g.left+g.right;
f.height+=g.top+g.bottom
}}return({x:f.x,y:f.y,width:f.width,height:f.height,left:f.x,right:f.x+f.width-1,top:f.y,bottom:f.y+f.height-1})
},getBBoxes:function(b,a){if(this.group){return(this.group.getBBoxes(b,a))
}return([this._getBBox(b,a)])
},getCenterXY:function(){if(this.group){return(this.group.getCenterXY())
}return(this._getCenterXY())
},_getCenterXY:function(){var a=this._getBBox();
return([roundNumber(a.x+a.width/2),roundNumber(a.y+a.height/2)])
},isMovable:function(){return(this.nextConfigItem&&this.nextConfigItem.movable)
},isTransformable:function(){return(this.nextConfigItem&&this.nextConfigItem.transformable)
},isLineBetweenSnapItems:function(){return(this.group&&this._typeItemGroup()=="line_between_items"&&this.group.snapItems&&this.group.snapItems.length==2)
},isChart:function(){return(this.group&&this._typeItemGroup()=="chart_with_text")
},getBorderPoint:function(b,c,g){if(!this.isLineInBbox(b,c,g)){return(null)
}var f=[];
if(c[0]!=b[0]){f.push(c[0]>b[0]?"right":"left")
}if(c[1]!=b[1]){f.push(c[1]>b[1]?"bottom":"top")
}for(var a=0;
a<f.length;
a++){var d=this.getBorderPoint_direction(b,c,g,f[a]);
if(d){return(d)
}}return(null)
},getBorderPoint_direction:function(d,g,r,p){var f=p=="left"||p=="right"?"x":"y";
var a=f=="x"?"y":"x";
var s=f=="x"?0:1;
var q=a=="x"?0:1;
var o=g[s]>d[s]?1:g[s]<d[s]?-1:0;
var n=g[q]>d[q]?1:g[q]<d[q]?-1:0;
var m=f=="x"?(o==1?r.right:o==-1?r.left:null):(o==1?r.bottom:o==-1?r.top:null);
var c=a=="x"?(n==1?r.right:n==-1?r.left:null):(n==1?r.bottom:n==-1?r.top:null);
if(m){if(c){var b=m-d[s];
var l=(g[q]-d[q])/(g[s]-d[s]);
var k=d[q]+b*l;
var h=f=="x"?[m,k]:[k,m];
if(this.isPointInBbox(h,r)){return(h)
}}else{c=d[q];
return(f=="x"?[m,c]:[c,m])
}}return(null)
},isLineInBbox:function(b,c,f){var d=b[0]<c[0]?[b[0],c[0]]:[c[0],b[0]];
var a=b[1]<c[1]?[b[1],c[1]]:[c[1],b[1]];
return((d[0]>=f.left&&d[0]<=f.right||d[1]>=f.left&&d[1]<=f.right||d[0]<f.left&&d[1]>f.right)&&(a[0]>=f.top&&a[0]<=f.bottom||a[1]>=f.top&&a[1]<=f.bottom||a[0]<f.top&&a[1]>f.bottom))
},isPointInBbox:function(a,b){return(a[0]>=b.left&&a[0]<=b.right&&a[1]>=b.top&&a[1]<=b.bottom)
},isEnableLine:function(){return(this.nextConfigItem&&this.nextConfigItem.enable_line)
},getProperties:function(){if(this.group){return(this.group.getProperties())
}return([this._getProperties()])
},_getProperties:function(){var a={typeItemGroup:this._typeItemGroup(),typeItem:this.typeItem,typeElement:this.typeElement};
switch(this.typeElement){case"image":Ext.applyIf(a,this._getPropertiesFromSvgEl(["href"]));
if(this.configItem.size_perc){a.size_perc=this.configItem.size_perc
}break;
case"text":Ext.applyIf(a,this._getPropertiesFromSvgEl(["text","fill","font-family","font-size"]));
break;
case"line":Ext.applyIf(a,this._getPropertiesFromSvgEl(["stroke","stroke-width","stroke-dasharray","marker-start","marker-end"]));
break;
case"chart":Ext.applyIf(a,this._getPropertiesFromSvgEl(["width","height"]));
if(this.configItem.scale_perc){a.scale_perc=this.configItem.scale_perc
}break
}Ext.applyIf(a,this._getDefaultProperties(this._typeItemGroup(),this.typeItem,this.typeElement));
return(a)
},_getPropertiesFromSvgEl:function(c){var b={};
for(var a=0;
a<c.length;
a++){var d=null;
if(c[a]=="text"){d=this._getPropertiesFromSvgEl_text()
}else{d=this.svgEl.getAttributeNS(c=="href"?this._xlink():null,c[a])
}if(d){b[c[a]]=d
}}return(b)
},_getPropertiesFromSvgEl_text:function(){var a=[];
if(this.textSpans){for(var b=0;
b<this.textSpans.length;
b++){a.push(this.textSpans[b].textEl.data)
}}return(a.join("\r\n"))
},_getDefaultProperties:function(c,b,d){var a={};
switch(d){case"image":Ext.applyIf(a,{size_perc:100});
break;
case"text":Ext.applyIf(a,{text:"",fill:"#000000","font-family":"tahoma, arial, verdana, sans-serif","font-size":b=="text_marker_start"||b=="text_marker_end"?10:12});
break;
case"line":Ext.applyIf(a,{stroke:"#000000","stroke-width":1,"stroke-dasharray":"0","marker-start":"none","marker-end":"none"});
break;
case"chart":Ext.applyIf(a,{scale_perc:"100"});
break
}return(a)
},setProperties:function(a,b){if(this.group){this.group.setProperties(a,b);
return
}this._setProperties(a,b);
this.afterSetProperties()
},_setProperties:function(b,c){if(!Ext.isArray(b)){if(b.typeItemGroup==this._typeItemGroup()&&b.typeItem==this.typeItem&&b.typeElement==this.typeElement){this._setPropertiesToSvgEl(b,c)
}}else{for(var a=0;
a<b.length;
a++){if(b[a].typeItemGroup==this._typeItemGroup()&&b[a].typeItem==this.typeItem&&b[a].typeElement==this.typeElement){this._setPropertiesToSvgEl(b[a],c)
}}}},_setPropertiesToSvgEl:function(b,c){for(var a in b){if(["type","typeItemGroup","typeItem","typeElement"].isIn(a)){continue
}if(a=="text"){this._setPropertiesToSvgEl_text(b[a])
}else{if(a=="size_perc"){this._setPropertiesToSvgEl_resize(b[a],this.configItem[a])
}else{switch(a){case"marker-start":case"marker-end":this._painter().addDefArrowColor(b[a],b.stroke,b["stroke-width"]);
break
}this.svgEl.setAttributeNS(a=="href"?this._xlink():null,a,b[a]);
if(a=="href"){this._setPropertiesToSvgEl_resize_after_change_icon(c.wh,this.WH);
this.WH=c.wh
}}}this.configItem[a]=b[a];
if(a=="font-size"){this._setPropertiesToSvgEl_text(this.configItem.text)
}}},_setPropertiesToSvgEl_text:function(a){if(!a){if(this.typeItem=="text_marker_start"||this.typeItem=="text_marker_end"){this._destroy();
this.group.removeItem(this.id);
return
}}this.deleteSvgText();
this.createSgvText(a)
},_setPropertiesToSvgEl_resize:function(b,a){if(this.group&&this.group.typeItem=="icon_with_text"&&this.typeItem=="icon"&&this.WH&&this.WH[0]&&this.WH[1]){this.group.iconPercResize(b,a)
}},_setPropertiesToSvgEl_resize_after_change_icon:function(a,b){if(this.group&&this.group.typeItem=="icon_with_text"&&this.typeItem=="icon"&&a&&a[0]&&a[1]&&b&&b[0]&&b[1]){this.group.iconResizeAfterChangeIcon(this.configItem.size_perc,a,b)
}},afterSetProperties:function(){if(this.group){this.group.afterSetProperties();
return
}this.container.afterMove(this);
this.refreshIndikSelect();
if(this._painter()){this._painter().evChange();
this._painter().setPositionProperies()
}},getData:function(){return({id:this.id,type:this.type,typeItem:this.typeItem,typeElement:this.typeElement,configItem:this.configItem,nextConfigItem:this.nextConfigItem})
},getMaxXY:function(){var f=this._getBBox();
var a=[f.right,f.bottom];
var d=["XY","XY1","XY2"];
for(var c=0;
c<d.length;
c++){if(this[d[c]]){for(var b=0;
b<2;
b++){if(this[d[c]][b]>a[b]){a[b]=this[d[c]][b]
}}}}return(a)
},getText:function(){if(this.group){return(this.group.getText())
}return(this._getText())
},_getText:function(){return(this._getPropertiesFromSvgEl_text())
},_typeItemGroup:function(){return(this.group?this.group.typeItem:null)
},_getGroup:function(a){return(this.group?this.group:(a?this:null))
},_getIdGroup:function(a){return(this.group?this.group.id:(a?this.id:null))
},_xmlns:function(){return(this._painter()?this._painter().xmlns:null)
},_xlink:function(){return(this._painter()?this._painter().xlink:null)
},_svg:function(){return(this._painter()?this._painter().svgG:null)
},_painter_id:function(){return(this._painter()?this._painter().id:null)
},_painter:function(){return(this.painter||this.container&&this.container.painter||null)
}});
Ext.define("SvgPaint.ItemsGroup",{extend:"SvgPaint.Item",subsystem:"svg_paint",constructor:function(a){this.type="group";
Ext.apply(this,a);
this.items=[]
},destroy:function(c){var b=[];
if(!c){if(this.isLineBetweenSnapItems()){b.push(this.snapItems[0]);
b.push(this.snapItems[1])
}if(this._painter()&&this._painter().evBeforeDestroyItem){this._painter().evBeforeDestroyItem(this)
}}this.clearIndikSelect();
for(var a=0;
a<this.items.length;
a++){this.items[a]._destroy()
}if(!c){this.container.destroyElementsBetweenSnapItems(this)
}this.container.removeItem(this.id);
if(!c){if(b.length==2){this.container.setElementsBetweenSnapItems(b[0],b[1])
}if(this._painter()){this._painter().evChange()
}}},removeItem:function(b){for(var a=0;
a<this.items.length;
a++){if(this.items[a].id==b){this.items.splice(a,1);
break
}}},moveXY:function(b){for(var a=0;
a<this.items.length;
a++){this.items[a]._moveXY(b)
}this.container.afterMove(this)
},shiftXY:function(b){for(var a=0;
a<this.items.length;
a++){this.items[a]._shiftXY(b)
}},fixXY:function(){for(var a=0;
a<this.items.length;
a++){this.items[a]._fixXY()
}this.container.afterMove(this)
},iconPercResize:function(d,c){var f=this.getIconTextItems();
if(!f){return
}var b={width:roundNumber(f.icon.WH[0]*d/100),height:roundNumber(f.icon.WH[1]*d/100)};
var a={width:roundNumber(f.icon.WH[0]*c/100),height:roundNumber(f.icon.WH[1]*c/100)};
this.iconResize(b,a)
},iconResizeAfterChangeIcon:function(f,b,d){var g=this.getIconTextItems();
if(!g){return
}if(!f){f=100
}var c={width:roundNumber(b[0]*f/100),height:roundNumber(b[1]*f/100)};
var a={width:roundNumber(d[0]*f/100),height:roundNumber(d[1]*f/100)};
this.iconResize(c,a)
},iconResize:function(b,a){var d=this.getIconTextItems();
if(!d){return
}b.x=d.icon.XY[0]+roundNumber((a.width-b.width)/2);
b.y=d.icon.XY[1]+roundNumber((a.height-b.height)/2);
for(var c in b){d.icon.svgEl.setAttributeNS(null,c,b[c])
}d.icon._fixXY();
var f={x:b.x+roundNumber(b.width/2),y:b.y+b.height+2};
for(var c in f){d.text.svgEl.setAttributeNS(null,c,f[c])
}d.text._fixXY();
d.text._setX_text(f.x)
},getIconTextItems:function(){if(this.typeItem!="icon_with_text"){return(null)
}var b=null;
var c=null;
for(var a=0;
a<this.items.length;
a++){if(this.items[a].typeItem=="icon"){b=this.items[a]
}else{if(this.items[a].typeItem=="icon_text"){c=this.items[a]
}}}if(b&&c){return({icon:b,text:c})
}return(null)
},toFront:function(){for(var a=0;
a<this.items.length;
a++){this.items[a]._toFront()
}},addIndikSelect:function(a){var b=this.getBBox(true,3);
this.items[0]._addIndikSelect(a,b);
this.selection=true
},clearIndikSelect:function(){for(var a=0;
a<this.items.length;
a++){if(this.items[0].selection){this.items[0]._clearIndikSelect()
}}delete this.selection
},refreshIndikSelect:function(){if(!this.selection){return
}for(var a=0;
a<this.items.length;
a++){if(this.items[0].selection){this.items[0]._refreshIndikSelect()
}}},getBBox:function(n,k,b){var c=null;
var l=null;
var h=null;
var a=null;
for(var f=0;
f<1+(b?b.length:0);
f++){var g=f==0?this:b[f-1];
for(var d=0;
d<g.items.length;
d++){var m=g.items[d]._getBBox(n,k);
if(c===null){c=m.left;
l=m.right;
h=m.top;
a=m.bottom
}else{if(m.left<c){c=m.left
}if(m.right>l){l=m.right
}if(m.top<h){h=m.top
}if(m.bottom>a){a=m.bottom
}}}}return({x:c,y:h,width:l-c+1,height:a-h+1,left:c,right:l,top:h,bottom:a})
},getBBoxMinHoriz:function(c,b){var h=null;
var f=null;
var g=null;
var a=null;
for(var d=0;
d<this.items.length;
d++){var k=this.items[d]._getBBox(c,b);
if(h===null){h=k.left;
f=k.right;
g=k.top;
a=k.bottom
}else{if(k.left>h){h=k.left
}if(k.right<f){f=k.right
}if(k.top<g){g=k.top
}if(k.bottom>a){a=k.bottom
}}}return({x:h,y:g,width:f-h+1,height:a-g+1,left:h,right:f,top:g,bottom:a})
},getBBoxes:function(b,a){var d=[];
for(var c=0;
c<this.items.length;
c++){d.push(this.items[c]._getBBox(b,a))
}return(d)
},getCenterXY:function(){var a=this.getBBox();
return([roundNumber(a.x+a.width/2),roundNumber(a.y+a.height/2)])
},getXY12:function(){for(var a=0;
a<this.items.length;
a++){if(this.items[a].XY1&&this.items[a].XY2){return([this.items[a].XY1,this.items[a].XY2])
}}return(null)
},getPosLineBetweenSnapItems:function(){return(this.container.getPosLineBetweenSnapItems(this))
},getPosHeightLinesBetweenSnapItems:function(){return(this.container.getPosHeightLinesBetweenSnapItems(this))
},getCountLinesBetweenSnapItems:function(){return(this.container.getCountLinesBetweenSnapItems(this.snapItems))
},getHeightLinesBetweenSnapItems:function(){return(this.container.getHeightLinesBetweenSnapItems(this.snapItems))
},getHeightForLineBetweenSnapItems:function(){if(!this.isLineBetweenSnapItems()){return(null)
}var b=6;
var d=6;
for(var c=0;
c<this.items.length;
c++){switch(this.items[c].typeItem){case"text_base":case"text_center_start":case"text_center_end":var f=this.items[c]._getBBox();
var a=f.height*0.9;
if(a>b){b=f.height*0.9
}break;
case"text_marker_start":case"text_marker_end":var f=this.items[c]._getBBox();
var a=f.height*0.95;
if(a>d){d=f.height*0.95
}break
}}return([b,d])
},isLineBetweenSnapItems:function(){return(this.typeItem=="line_between_items"&&this.snapItems&&this.snapItems.length==2)
},isChart:function(){return(this.typeItem=="chart_with_text")
},existsChartConfiguration:function(){return(this._painter().chartItems&&this._painter().chartItems[this.id])
},setElementsBetweenSnapItems:function(){for(var a=0;
a<this.items.length;
a++){switch(this.items[a].typeItem){case"line":this.items[a].setLineBetweenSnapItems();
break;
case"text_base":case"text_center_start":case"text_center_end":case"text_marker_start":case"text_marker_end":this.items[a].setTextBetweenSnapItems(this.items[a].typeItem);
break
}}},relayout:function(l,d,q,k){if(this.disableRelayout){return
}if(!q){q=this.getBBox()
}oldCenterXY=[q.x+q.width/2,q.y+q.height/2];
if(this.typeItem=="chart_with_text"){if(this.items.length!=2){return
}var o=this.getBBoxes();
if(o.length!=2){return
}var p=null;
var n=null;
var b=null;
var h=null;
for(var m=0;
m<2;
m++){switch(this.items[m].typeItem){case"chart_text":p=this.items[m];
n=o[m];
break;
case"chart":b=this.items[m];
h=o[m];
break
}}var a=Math.max(n.width,h.width);
var c=n.height+1+h.height;
var g=[roundNumber(oldCenterXY[0]),roundNumber(oldCenterXY[1]-c/2)];
p._moveXY(g,true);
var f=[roundNumber(oldCenterXY[0]-h.width/2),roundNumber(oldCenterXY[1]-(c/2)+n.height+1)];
b._moveXY(f,true);
this.fixXY();
b.svgEl.setAttributeNS(this._xlink(),"href","data:image/svg+xml;base64,"+Base64.encode("<svg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='"+b.configItem.width+"' height='"+b.configItem.height+"'><rect width='"+b.configItem.width+"' height='"+b.configItem.height+"' style='fill:rgb(220,220,220);stroke-width:1;stroke:rgb(100,100,100);stroke-dasharray:1.1;'/>"+(this.existsChartConfiguration()?"":"<rect x='10' y='62' rx='3' ry='3' width='170' height='25' fill='rgb(240,240,240)' stroke='grey'/>")+"<text x='10' y='20' font-family='tahoma, arial, verdana, sans-serif' font-size='12'>"+findLangS(this.subsystem,"text","chartRenderInfo")+(this.existsChartConfiguration()?"":"<tspan x='10' dy='2em' font-family='tahoma, arial, verdana, sans-serif' font-size='15' fill='red'>"+findLangS(this.subsystem,"text","missingChartConfiguration")+"</tspan><tspan x='15' y='80' font-family='tahoma, arial, verdana, sans-serif' font-size='15' fill='red'>"+findLangS(this.subsystem,"text","clickHereForEditChart")+"</tspan>")+"</text></svg>"))
}},getProperties:function(){var b=[];
for(var a=0;
a<this.items.length;
a++){b.push(this.items[a]._getProperties())
}return(b)
},setProperties:function(c,d){var g=this.getProperties();
var f=this.getBBox();
var a=this.getBBoxes();
if(Ext.isArray(c)){for(var b=0;
b<c.length;
b++){this.checkExistsTypeItemInProperties(c[b])
}}else{this.checkExistsTypeItemInProperties(c)
}for(var b=0;
b<this.items.length;
b++){this.items[b]._setProperties(c,d)
}this.afterSetProperties(c,g,f,a)
},checkExistsTypeItemInProperties:function(c){var a=false;
for(var b=0;
b<this.items.length;
b++){if(this.items[b].typeItem==c.typeItem){a=true
}}if(!a){switch(c.typeItem){case"text_marker_start":case"text_marker_end":this.container.group=this;
this.container.addItem(c.typeItem,"text",{"text-anchor":"middle",text:c.text},{selectable:true});
delete this.container.group
}}},getPropertyInTypeItem:function(b,c){for(var a=0;
a<this.items.length;
a++){if(this.items[a].typeItem==b){return(this.items[a].configItem[c])
}}return(null)
},afterSetProperties:function(a,d,c,b){if(this.isLineBetweenSnapItems()){this.setElementsBetweenSnapItems();
this.toFront()
}else{this.relayout(a,d,c,b);
this.container.afterMove(this)
}this.refreshIndikSelect();
if(this._painter()){this._painter().evChange();
this._painter().setPositionProperies()
}},getData:function(){var a=[];
for(var b=0;
b<this.items.length;
b++){a.push(this.items[b].getData())
}var c={id:this.id,type:this.type,typeItem:this.typeItem,items:a};
if(this.snapItems&&this.snapItems.length){for(var b=0;
b<this.snapItems.length;
b++){c["snap_item_"+(b+1)+"_id"]=this.snapItems[b].id
}}return(c)
},getMaxXY:function(){var a=[0,0];
for(var c=0;
c<this.items.length;
c++){_maxXY=this.items[c].getMaxXY();
for(var b=0;
b<2;
b++){if(_maxXY[b]>a[b]){a[b]=_maxXY[b]
}}}return(a)
},getText:function(){for(var a=0;
a<this.items.length;
a++){var b=this.items[a]._getText();
if(b){return(b)
}}return(null)
},getItemByTypeItem:function(b){for(var a=0;
a<this.items.length;
a++){if(this.items[a].typeItem==b){return(this.items[a])
}}return(null)
},_typeItemGroup:function(){return(this.typeItem)
},optimizePosTextBetweenSnapItems:function(m){var q=new SvgPaint.Bounds;
q.setFromBbox(this.bounds_bbox);
var c=null;
var b=null;
var l=this.items[0].getOptimalSnapPointsForLine();
var n=q.isXyIn(l[0]);
var k=q.isXyIn(l[1]);
if(n&&!k||!n&&k){var g=new SvgPaint.Vector(l[0],l[1]);
if(m){for(var f=0;
f<m.length;
f++){var h=m[f].isVectorIn(g);
if(h){switch(m[f].side){case"left":q.minRedukFromLeft(m[f].width);
break;
case"right":q.minRedukFromRight(m[f].width);
break;
case"top":q.minRedukFromTop(m[f].height);
break;
case"bottom":q.minRedukFromBottom(m[f].height);
break
}for(var d=0;
d<h.length;
d++){switch(m[f].side){case"left":if(h[d].x>q.left){q.redukFromLeft(h[d].x-q.left)
}break;
case"right":if(q.right>h[d].x){q.redukFromRight(q.right-h[d].x)
}break;
case"top":if(h[d].y>q.top){q.redukFromTop(h[d].y-q.top)
}break;
case"bottom":if(q.bottom>h[d].y){q.redukFromBottom(m[f].height)
}break
}}}}}var o=new SvgPaint.Bounds;
for(var f=0;
f<this.items.length;
f++){var p=this.items[f].svgEl.getBBox();
if(f==0){o.setFromBbox(p)
}else{o.addBbox(p)
}}var a=this.items[0].svgEl;
while(a.tagName!="DIV"){a=a.parentNode
}o.shiftPos(parseInt(a.style.left),parseInt(a.style.top));
if(!q.isBoundsIn(o)){if(o.left<q.left){c=q.left-o.left
}if(o.right>q.right){c=-(o.right-q.right)
}if(o.top<q.top){b=q.top-o.top
}if(o.bottom>q.bottom){b=-(o.bottom-q.bottom)
}}}if(c||b){if(Math.abs(c)>Math.abs(b)){b=c*(l[1][1]-l[0][1])/(l[1][0]-l[0][0])
}else{c=b*(l[1][0]-l[0][0])/(l[1][1]-l[0][1])
}this.shiftXY([c,b]);
return(true)
}return(false)
},getPosBoundText:function(){var b=this.items[0].getOptimalSnapPointsForLine();
var a=new SvgPaint.Vector(b[0],b[1]);
var c=this.bounds_bbox.isVectorIn(a);
if(c&&c.length==1){c[0].vect_point=this.bounds_bbox.isXyIn(b[0])?"end":"start"
}return(c)
}});
Ext.define("SvgPaint.ItemsContainer",{constructor:function(a){this.prefix_id="svgpaint";
Ext.apply(this,a);
this.items=[];
this.last_id_item=1;
this.last_id_group=1;
this.last_id_select_item=1
},addItem:function(b,g,a,f,d){var c=new SvgPaint.Item({id:this.newIdItem(),typeItem:b,typeElement:g,configItem:a,nextConfigItem:f,container:this,group:this.group});
if(d){Ext.applyIf(c,d)
}if(this.group){this.group.items.push(c)
}else{this.items.push(c)
}this.painter.evChange();
return(c)
},removeItem:function(b){for(var a=0;
a<this.items.length;
a++){if(this.items[a].id==b){this.items.splice(a,1);
break
}}},destroyAll:function(a){while(this.items.length){this.items[0].destroy(true)
}},relayoutAll:function(){for(var a=0;
a<this.items.length;
a++){this.items[a].relayout()
}},beginGroup:function(a,b){this.group=new SvgPaint.ItemsGroup({id:this.newIdGroup(),typeItem:a,container:this});
if(b){Ext.applyIf(this.group,b)
}return(this.group)
},pushGroup:function(){if(this.group){var a=this.group;
this.items.push(this.group);
delete this.group;
this.setElementsBetweenSnapItems();
this.painter.evChange();
if(a.typeItem=="chart_with_text"){a.relayout()
}return(a)
}},addGroupSnapItem:function(a,b){if(this.group){if(Ext.isString(a)){a=this.getItemById(a,b);
if(!a){return
}}if(!Ext.isDefined(this.group.snapItems)){this.group.snapItems=[]
}if(a.group){a=a.group
}this.group.snapItems.push(a)
}},newIdItem:function(){return(this.prefix_id+"_item_"+String(this.last_id_item++).lpad(6,"0"))
},newIdGroup:function(){return(this.prefix_id+"_group_"+String(this.last_id_group++).lpad(6,"0"))
},newIdSelectItem:function(){return("svgpaint_select_item_"+String(this.last_id_select_item++).lpad(6,"0"))
},getItemById:function(f,d){for(var b=0;
b<this.items.length;
b++){if(this.items[b][d?"id_old":"id"]==f){return(this.items[b])
}if(this.items[b].type=="group"){var c=this.items[b];
for(var a=0;
a<c.items.length;
a++){if(c.items[a][d?"id_old":"id"]==f){return(c.items[a])
}}}}return(null)
},setElementsBetweenSnapItems:function(a,c){for(var b=0;
b<this.items.length;
b++){if(this.items[b].isLineBetweenSnapItems()&&(!a||a==this.items[b].snapItems[0]||a==this.items[b].snapItems[1])&&(!c||c==this.items[b].snapItems[0]||c==this.items[b].snapItems[1])){this.items[b].setElementsBetweenSnapItems()
}}},toFrontLinesBetweenSnapItems:function(a){for(var b=0;
b<this.items.length;
b++){if(this.items[b].isLineBetweenSnapItems()&&(!a||a==this.items[b].snapItems[0]||a==this.items[b].snapItems[1])){this.items[b].toFront()
}}},destroyElementsBetweenSnapItems:function(a){for(var b=0;
b<this.items.length;
b++){if(this.items[b].isLineBetweenSnapItems()&&(a==this.items[b].snapItems[0]||a==this.items[b].snapItems[1])){this.items[b].destroy();
--b
}}},afterMove:function(b){var a=b?(b.type=="group"?b:b.group?b.group:null):null;
this.setElementsBetweenSnapItems(a);
this.toFrontLinesBetweenSnapItems(a)
},getPosLineBetweenSnapItems:function(a){return(this._getCountLinesBetweenSnapItems(a.snapItems,a.id))
},getPosHeightLinesBetweenSnapItems:function(a){return(this._getCountLinesBetweenSnapItems(a.snapItems,a.id,true))
},getCountLinesBetweenSnapItems:function(a){return(this._getCountLinesBetweenSnapItems(a))
},getHeightLinesBetweenSnapItems:function(a){return(this._getCountLinesBetweenSnapItems(a,0,true))
},_getCountLinesBetweenSnapItems:function(g,c,a){var b=0;
for(var d=0;
d<this.items.length;
d++){if(this.items[d].isLineBetweenSnapItems()&&this.cmpSnapItems(this.items[d].snapItems,g)){if(c&&c==this.items[d].id){return(b)
}if(a){var f=this.items[d].getHeightForLineBetweenSnapItems();
b+=f[0]+f[1]
}else{++b
}}}return(b)
},cmpSnapItems:function(a,d){if(a.length!=d.length){return(false)
}for(var c=0;
c<a.length;
c++){for(var b=0;
b<d.length;
b++){if(a[c].id==d[b].id){break
}}if(b==d.length){return(false)
}}return(true)
},clearIndikSelect:function(){for(var a=0;
a<this.items.length;
a++){if(this.items[a].selection){this.items[a].clearIndikSelect()
}}},getData:function(){var b=[];
for(var a=0;
a<this.items.length;
a++){b.push(this.items[a].getData())
}return(b)
},loadData:function(f){for(var d=0;
d<f.length;
d++){if(f[d].type=="item"){this.addItem(f[d].typeItem,f[d].typeElement,f[d].configItem,f[d].nextConfigItem,{id_old:f[d].id})
}else{if(f[d].type=="group"&&f[d].typeItem!="line_between_items"){this.beginGroup(f[d].typeItem,{id_old:f[d].id});
for(var c=0;
c<f[d].items.length;
c++){this.addItem(f[d].items[c].typeItem,f[d].items[c].typeElement,f[d].items[c].configItem,f[d].items[c].nextConfigItem,{id_old:f[d].items[c].id})
}this.pushGroup()
}}}for(var d=0;
d<f.length;
d++){if(f[d].type=="group"&&f[d].typeItem=="line_between_items"){this.beginGroup("line_between_items",{id_old:f[d].id});
this.addGroupSnapItem(f[d].snap_item_1_id,true);
this.addGroupSnapItem(f[d].snap_item_2_id,true);
for(var c=0;
c<f[d].items.length;
c++){if(f[d].items[c].typeItem=="line"){var g=["marker-start","marker-end"];
for(var b=0;
b<g.length;
b++){if(f[d].items[c].configItem[g[b]]){var a=this.painter.addDefArrowColor(f[d].items[c].configItem[g[b]],f[d].items[c].configItem.stroke,f[d].items[c].configItem["stroke-width"]);
if(a){f[d].items[c].configItem[g[b]]="url(#"+a+")"
}}}}this.addItem(f[d].items[c].typeItem,f[d].items[c].typeElement,f[d].items[c].configItem,f[d].items[c].nextConfigItem,{id_old:f[d].items[c].id})
}this.pushGroup()
}}},getMaxXY:function(){var a=[0,0];
for(var c=0;
c<this.items.length;
c++){_maxXY=this.items[c].getMaxXY();
for(var b=0;
b<2;
b++){if(_maxXY[b]>a[b]){a[b]=_maxXY[b]
}}}return(a)
}});
Ext.define("SvgPaint.Painter_functions",{addDefArrowColor:function(l,d,c,p){match=l.match(/url\(#arrow-(.*)-c(.*)-w(\d+)\)/);
if(match&&match.length==4){l=match[1];
d=match[2];
c=match[3]
}else{match=l.match(/url\(#arrow-(.*)-c(.*)\)/);
if(match&&match.length==3){l=match[1];
d=match[2];
c=c||1
}else{if(l!="start"&&l!="end"||!d||!c){return(null)
}}}if(d[0]=="#"){d=d.substr(1)
}if(p&&p[0]=="#"){p=p.substr(1)
}c*=1;
var a=c>1?c:0;
var b="arrow-"+l+"-c"+d+"-w"+c;
for(var h=0;
h<this.defs.childNodes.length;
h++){if(this.defs.childNodes[h].id==b){return(b)
}}var n=document.createElementNS(this.xmlns,"marker");
var g=roundNumber(12+(c-1)*2.5);
var f=roundNumber(10+(c-1)*2.5);
var k={id:b,markerWidth:g+a,markerHeight:f+a,viewBox:"0 0 "+(g+a)+" "+(f+a),refX:l=="end"?(g):a/2,refY:f/2+a/2,markerUnits:"userSpaceOnUse",orient:"auto"};
for(var h in k){n.setAttributeNS(null,h,k[h])
}var m=document.createElementNS(this.xmlns,"polygon");
var o={points:l=="start"?(a/2)+","+(f/2+a/2)+" "+(g+a/2)+","+(a/2)+" "+(g+a/2-c/3-2)+","+(f/2+a/2)+" "+(g+a/2)+","+(f+a/2):(a/2)+","+(a/2)+" "+(g+a/2)+","+(f/2+a/2)+" "+(a/2)+","+(f+a/2)+" "+(a/2+c/3+2)+","+(f/2+a/2),fill:p?((isHexColor(p)?"#":"")+p):"white",stroke:(isHexColor(d)?"#":"")+d,"stroke-width":c};
for(var h in o){m.setAttributeNS(null,h,o[h])
}n.appendChild(m);
this.defs.appendChild(n);
return(b)
}});
Ext.define("SvgPaint.Painter",{extend:"Ext.Panel",mixins:{addDefArrowColor:"SvgPaint.Painter_functions"},xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",subsystem:"svg_paint",constructor:function(a){this.svgIdNumber=SvgPaint.SingletonTools.getSvgPainterIdNumber();
this.svgId="SvgPaint_"+this.svgIdNumber;
this.svgIdG="SvgPaintG_"+this.svgIdNumber;
this.fullSizeWidth=6000;
this.fullSizeHeight=4000;
a=Ext.applyIf(a||{},{items:{html:'<svg id="'+this.svgId+'" class="svg_painter" xmlns="'+this.xmlns+'" xmlns:xlink="'+this.xlink+'" width="100%" height="100%"/>',border:false,width:this.fullSizeWidth,height:this.fullSizeHeight},border:false,listeners:{scope:this,afterrender:function(){var b=this;
this.svg=this.body.down("#"+this.svgId);
this.defs=this.svg.dom.insertBefore(document.createElementNS(this.xmlns,"defs"),this.svg.dom.firstChild);
this.svgG=document.createElementNS(this.xmlns,"g");
this.svgG.setAttributeNS(null,"id",this.svgIdG);
this.svgG.setAttributeNS(null,"transform","scale(1,1)");
this.svg.appendChild(this.svgG);
this.svg.on("mousedown",function(c){b.ev_onmousedown(c)
});
this.svg.on("mouseup",function(c){b.ev_onmouseup(c)
});
this.svg.on("mouseout",function(c){b.ev_onmouseout(c)
});
this.svg.on("mousemove",function(c){b.ev_onmousemove(c)
});
this.svg.dom.addEventListener("dragstart",function(c){if(c.stopPropagation){c.stopPropagation()
}if(c.preventDefault){c.preventDefault()
}return(false)
});
this.itemsContainer=new SvgPaint.ItemsContainer({painter:this});
new Ext.dd.DropZone(this.body,{getTargetFromEvent:function(c){return b.body
},onNodeOver:function(g,c,f,d){return Ext.dd.DropZone.prototype.dropAllowed
},onNodeDrop:function(g,c,f,d){b.ev_ondrop(f,d)
}})
},destroy:function(){if(this.indikSelectItem&&this.indikSelectItem.properties_control){this.indikSelectItem.properties_control.close()
}},resize:this.evResize},autoScroll:true});
this.callParent([a])
},setScale:function(c){var f=this.body.getWidth();
var l=this.body.getHeight();
var b;
var k;
if(this.indikSelectItem){b=this.indikSelectItem.item.getCenterXY();
k=this.unscaleXY(b)
}else{var k=[this.body.dom.scrollLeft+f/2,this.body.dom.scrollTop+l/2];
b=this.scaleXY(k)
}var n=[k[0]-this.body.dom.scrollLeft,k[1]-this.body.dom.scrollTop];
this.svgScale=c;
this.svgG.setAttributeNS(null,"transform","scale("+(c/100)+","+(c/100)+")");
this.items.get(0).setSize(this.fullSizeWidth*c/100,this.fullSizeHeight*c/100);
var d=this.unscaleXY(b);
var h=this.itemsContainer.getMaxXY();
var g=this.unscaleXY(h);
var m=Math.max(d[0]-n[0],0);
if((!this.indikSelectItem||n[0]<f*2/5)&&m+f>g[0]){m-=m+f-g[0];
if(m<0){m=0
}}this.body.dom.scrollLeft=m;
var a=Math.max(d[1]-n[1],0);
if((!this.indikSelectItem||n[1]<l*2/5)&&a+l>g[1]){a-=a+l-g[1];
if(a<0){a=0
}}this.body.dom.scrollTop=a
},scaleXY:function(a){if(!this.svgScale||this.svgScale==100){return(a)
}return([a[0]*100/this.svgScale,a[1]*100/this.svgScale])
},unscaleXY:function(a){if(!this.svgScale||this.svgScale==100){return(a)
}return([a[0]*this.svgScale/100,a[1]*this.svgScale/100])
},selectItemForMove:function(a,b){this.unselectItemForMove();
this.addIndikSelect(a);
if(a.isMovable()||a.isTransformable()){a.toFront();
this.selectedItemForMove={item:a,selectXY:[b.clientX,b.clientY]}
}},unselectItemForMove:function(){if(this.selectedItemForMove){this.selectedItemForMove.item.fixXY();
delete this.selectedItemForMove
}},moveSelected:function(d){if(this.isModeMultipleSelect()){if(!this.itemsMultipleSelect||!this.itemsMultipleSelect.length){return(null)
}var c=this.scaleXY([d[0]-this.selectedItemForMultipleSelectMove.selectXY[0],d[1]-this.selectedItemForMultipleSelectMove.selectXY[1]]);
var a=this.selectedItemForMultipleSelectMove.lastXY?this.scaleXY([d[0]-this.selectedItemForMultipleSelectMove.lastXY[0],d[1]-this.selectedItemForMultipleSelectMove.lastXY[1]]):null;
this.selectedItemForMultipleSelectMove.lastXY=d;
for(var b=0;
b<this.itemsMultipleSelect.length;
b++){this.itemsMultipleSelect[b].moveXY(c)
}return({moveXY:c,diffXY:a})
}else{if(!this.selectedItemForMove){return(null)
}var c=this.scaleXY([d[0]-this.selectedItemForMove.selectXY[0],d[1]-this.selectedItemForMove.selectXY[1]]);
var a=this.selectedItemForMove.lastXY?this.scaleXY([d[0]-this.selectedItemForMove.lastXY[0],d[1]-this.selectedItemForMove.lastXY[1]]):null;
this.selectedItemForMove.lastXY=d;
this.selectedItemForMove.item.moveXY(c);
return({moveXY:c,diffXY:a})
}},addIndikSelect:function(c,a){if(this.isModeForSelectItemsForNewLink()){this.addItemForLine(c)
}else{if(!this.isModeMultipleSelect()){var d;
if(c&&this.indikSelectItem&&this.indikSelectItem.item&&c==this.indikSelectItem.item){d=false
}else{this.clearIndikSelect();
if(!c){return
}c.addIndikSelect(a);
d=true
}if(this.isModeWatching()){this.indikSelectItem={item:c}
}else{if(d||!this.indikSelectItem||!this.indikSelectItem.properties_control||!this.indikSelectItem.properties_control.isVisible()){if(this.enableEdit()){var b=new SvgPaint.EditItem.Form.Window({contextItem:true,item:c,painter:this});
this.indikSelectItem={item:c,properties_control:b}
}}}}}},clearIndikSelect:function(){this.itemsContainer.clearIndikSelect();
if(this.indikSelectItem){if(this.indikSelectItem.properties_control){this.indikSelectItem.properties_control.close()
}delete this.indikSelectItem
}},startModeForSelectItemsForNewLink:function(b){if(this.isModeForSelectItemsForNewLink()){return
}var a=null;
if(this.indikSelectItem){a=this.indikSelectItem.item
}this.clearIndikSelect();
this.deleteItemsForLine();
this._mode={type:"select_items_for_new_link",ev_object:b};
if(a&&!a.isLineBetweenSnapItems()){Ext.defer(function(){this.addItemForLine(a)
},100,this)
}if(this.toolBar&&this.toolBar.autoEnableButtons){this.toolBar.autoEnableButtons()
}},endModeForSelectItemsForNewLink:function(){if(this.isModeForSelectItemsForNewLink()){delete this._mode;
this.clearIndikSelect();
if(this.toolBar&&this.toolBar.autoEnableButtons){this.toolBar.autoEnableButtons()
}}},isModeForSelectItemsForNewLink:function(){return(this._mode&&this._mode.type=="select_items_for_new_link")
},startModeWatching:function(){if(this.isModeWatching()){return
}this.endAllModes();
this.deactivate();
if(this.painterTools){this.painterTools.hide()
}this.initWatching();
this._mode={type:"watching",timer:Ext.TaskManager.start({run:this.onWatchingTimer,interval:100,scope:this})};
if(this.toolBar){if(this.toolBar.autoEnableButtons){this.toolBar.autoEnableButtons()
}if(this.toolBar.onStartModeWatching){this.toolBar.onStartModeWatching()
}}},endModeWatching:function(){if(this.isModeWatching()){Ext.TaskManager.stop(this._mode.timer);
this.termWatching();
delete this._mode;
if(this.painterTools){this.painterTools.show()
}if(this.toolBar&&this.toolBar.autoEnableButtons){this.toolBar.autoEnableButtons()
}}},isModeWatching:function(){return(this._mode&&this._mode.type=="watching")
},startModeMultipleSelect:function(a){if(this.isModeMultipleSelect()){return
}this.endAllModes();
this.deactivate();
if(this.painterTools){this.painterTools.hide()
}this._mode={type:"multiple_select",form:new SvgPaint.Tools.MultipleSelectForm({autoCreateWindow:true,painter:this,disableAnimateWindow:a})};
if(this.toolBar){if(this.toolBar.autoEnableButtons){this.toolBar.autoEnableButtons()
}if(this.toolBar.onStartModeMultipleSelect){this.toolBar.onStartModeMultipleSelect()
}}},endModeMultipleSelect:function(){if(this.isModeMultipleSelect()){if(this._mode.form){var a=this._mode.form;
delete this._mode.form;
a.closeWindow()
}delete this._mode;
if(this.painterTools){this.painterTools.show()
}if(this.toolBar){if(this.toolBar.autoEnableButtons){this.toolBar.autoEnableButtons()
}if(this.toolBar.onEndModeMultipleSelect){this.toolBar.onEndModeMultipleSelect()
}}if(this.itemsMultipleSelect){this.unselectAllMultipleSelect()
}}},isModeMultipleSelect:function(){return(this._mode&&this._mode.type=="multiple_select")
},isMove:function(){return(this.selectedItemForMove||this.selectedItemForMultipleSelectMove)
},endAllModes:function(){this.endModeForSelectItemsForNewLink();
this.endModeWatching();
this.endModeMultipleSelect()
},isAnyMode:function(){return(this.isModeForSelectItemsForNewLink()||this.isModeWatching()||this.isModeMultipleSelect())
},evSvgElement_onmousedown:function(d,g){if(d.button==2&&!g){d.preventDefault();
return
}this.moveAfterClick=false;
var b=this.itemsContainer.getItemById(d.currentTarget.id);
if((d.ctrlKey||d.shiftKey)&&!this.isAnyMode()&&this.indikSelectItem&&b!=this.indikSelectItem.item&&b._getGroup(true)!=this.indikSelectItem.item._getGroup(true)){var c=this.indikSelectItem.item;
this.startModeMultipleSelect(true);
this.toggleItemForMultipleSelect(c);
this.toggleItemForMultipleSelect(b);
this.selectItemForMultipleSelectMove(b,d);
this.multipleSelect_addClickItem=true;
this.multipleSelect_start=true;
return
}if(this.isModeForSelectItemsForNewLink()){if(b&&!b.isLineBetweenSnapItems()){b.clearIndikSelect();
this.addItemForLine(b)
}}else{if(this.isModeMultipleSelect()){if(b&&!b.isLineBetweenSnapItems()&&b.isMovable()||b.isTransformable()){if(this.existsItemInMultipleSelect(b)){this.multipleSelect_addClickItem=false
}else{this.toggleItemForMultipleSelect(b);
this.multipleSelect_addClickItem=true
}this.selectItemForMultipleSelectMove(b,d)
}}else{if(this.evSvgElement_onmousedown_data&&Math.abs(this.evSvgElement_onmousedown_data.xy[0]-d.clientX)<3&&Math.abs(this.evSvgElement_onmousedown_data.xy[1]-d.clientY)<3&&(new Date).getTime()<this.evSvgElement_onmousedown_data.time+1000){delete this.evSvgElement_onmousedown_data;
this.unselectItemForMove();
this.evSvgElement_onmousedblclick(d)
}else{this.evSvgElement_onmousedown_data={xy:[d.clientX,d.clientY],time:(new Date).getTime()};
if(b){this.selectItemForMove(b,d)
}if(this.isModeWatching()&&b.isLineBetweenSnapItems()){var a=b._getIdGroup();
if(this.watchingItems&&this.watchingItems[a]){var f=new Ext.menu.Menu({items:[{text:this.findLangS("menu","showWatchingRecords"),iconCls:"icon_magnifier",handler:function(){this.showWatchingRecords(b)
},scope:this}]});
f.showAtMouse(d)
}}}}}d.stopPropagation()
},evSvgElement_onmouseup:function(d){if(!this.isAnyMode()){if(!this.moveAfterClick){var a=this.itemsContainer.getItemById(d.currentTarget.id);
var c=a._getGroup();
if(c&&c.typeItem=="chart_with_text"&&!c.existsChartConfiguration()){if(this.indikSelectItem.properties_control){var b=this.indikSelectItem.properties_control.items.get(0);
if(b&&b.createWatchingItemForm){b.createChartItemForm()
}}}}}else{if(this.isModeMultipleSelect()){var a=this.itemsContainer.getItemById(d.currentTarget.id);
if(!this.moveAfterClick&&!this.multipleSelect_addClickItem&&this.existsItemInMultipleSelect(a)){this.toggleItemForMultipleSelect(a)
}}}},evSvgElement_onmousedblclick:function(b){var a=this.itemsContainer.getItemById(b.currentTarget.id);
if(!this.isModeWatching()&&a.isEnableLine()){this.addIndikSelect(a,{stroke:"#000080"});
this.addItemForLine(a)
}},evSvgElement_oncontextmenu:function(f){f.preventDefault();
var c=this.itemsContainer.getItemById(f.currentTarget.id);
var d=c._getGroup();
this.unselectItemForMove();
this.addIndikSelect(c);
var b=[];
if(!this.isAnyMode()){if(!d&&c.typeItem=="text"){if(this.enableEdit()){b.push("delete")
}}else{if(d&&d.typeItem=="icon_with_text"){if(this.enableEdit()){b.push("delete")
}}else{if(d&&d.typeItem=="chart_with_text"){if(this.enableEdit()){b.push("delete",{text:this.findLangS("menu","setChart"),iconCls:"icon_edit",handler:function(){if(this.indikSelectItem.properties_control){var h=this.indikSelectItem.properties_control.items.get(0);
if(h&&h.createChartItemForm){h.createChartItemForm()
}}},scope:this})
}}else{if(d&&d.typeItem=="line_between_items"){if(this.enableEdit()){b.push("delete",{text:this.findLangS("menu","setWatching"),iconCls:"icon_edit",handler:function(){if(this.indikSelectItem.properties_control){var h=this.indikSelectItem.properties_control.items.get(0);
if(h&&h.createWatchingItemForm){h.createWatchingItemForm()
}}},scope:this})
}}}}}}else{if(this.isModeForSelectItemsForNewLink()||this.isModeMultipleSelect()){this.evSvgElement_onmousedown(f,true)
}else{if(this.isModeWatching()){if(d&&d.typeItem=="chart_with_text"){if(this.chartItems&&this.chartItems[d.id]){b.push("refresh")
}}else{if(d&&d.typeItem=="line_between_items"){if(this.watchingItems&&this.watchingItems[d.id]){b.push("refresh")
}}}}}}if(b.length){for(var a=0;
a<b.length;
a++){if(b[a]=="delete"){b[a]={text:this.findLangS("menu","deleteItem"),iconCls:"icon_delete",handler:function(){Ext.Msg.confirm("",this.findLangS("text","deleteSelectedItemQuestion"),function(h){if(h=="yes"){this.clearIndikSelect();
if(d){d.destroy()
}else{c.destroy()
}}},this)
},scope:this}
}else{if(b[a]=="refresh"){b[a]={text:this.findLangS("menu","refreshNow"),iconCls:"icon_reload",handler:function(){this.startWatchingItem(d.id,new Date)
},scope:this}
}}}var g=new Ext.menu.Menu({items:b});
g.showAtMouse(f)
}},ev_onmousedown:function(a){if(a.button==2){a.preventDefault();
return
}if(this.isModeMultipleSelect()){if(this.multipleSelect_start){delete this.multipleSelect_start
}else{this.endModeMultipleSelect()
}}else{this.deleteItemsForLine();
this.clearIndikSelect()
}},ev_onmouseup:function(a){this.unselectItemForMove();
this.unselectItemForMultipleSelectMove();
if(this.indikSelectItem&&this.indikSelectItem.properties_control){this.indikSelectItem.properties_control.optimizeFloatingPosition();
this.indikSelectItem.properties_control.setOpacityIfFloating()
}},ev_onmouseout:function(b){var a=this.svg.dom.getBoundingClientRect();
if(b.browserEvent.clientX<=a.left||b.browserEvent.clientX>=a.right||b.browserEvent.clientY<=a.top||b.browserEvent.clientY>=a.bottom){this.unselectItemForMove();
this.unselectItemForMultipleSelectMove()
}},ev_onmousemove:function(d){this.moveAfterClick=true;
if(this.isModeMultipleSelect()){if(this.selectedItemForMultipleSelectMove&&this.itemsMultipleSelect&&this.itemsMultipleSelect.length){var a=this.moveSelected([d.browserEvent.clientX,d.browserEvent.clientY]);
var b=a?a.diffXY:null;
for(var c=0;
c<this.itemsMultipleSelect.length;
c++){var f=this.itemsMultipleSelect[c].getBBox();
if(f.top<=0&&b&&b[1]<0||f.left<=0&&b&&b[0]<0){this.unselectItemForMultipleSelectMove();
break
}}}}else{if(this.selectedItemForMove){this.moveSelected([d.browserEvent.clientX,d.browserEvent.clientY]);
if(this.indikSelectItem&&this.indikSelectItem.properties_control){this.indikSelectItem.properties_control.optimizeFloatingPosition();
this.indikSelectItem.properties_control.setTransparencyIfFloating()
}}}},ev_ondrop:function(d,b){var a=this.svg.dom.getBoundingClientRect();
var c=this.scaleXY([d.browserEvent.clientX-a.left,d.browserEvent.clientY-a.top]);
switch(b.typeItem){case"text":c[1]-=5;
this.addText(c,b.text);
break;
case"icon_with_text":this.addIcon(c,Ext.apply({center:true},b.iconData));
break;
case"chart":this.addChart(c,Ext.apply({center:true},b.chartData));
break
}},initWatching:function(){if(this.watchingItems){for(var c in this.watchingItems){var f=this.itemsContainer.getItemById(c);
var d=f.getProperties();
var b={};
for(var a=0;
a<d.length;
a++){switch(d[a].typeItem){case"line":b.color_line=d[a].stroke;
b.width_line=d[a]["stroke-width"];
b["marker-start"]=d[a]["marker-start"];
b["marker-end"]=d[a]["marker-end"];
break;
case"text_base":b.color_text=d[a].fill;
b.size_text=d[a]["font-size"];
b.text=d[a].text;
break
}}this.watchingItems[c].watchingData={lastStart:null,lastEnd:null,properties:b}
}}if(this.chartItems){for(var c in this.chartItems){var f=this.itemsContainer.getItemById(c);
var d=f.getProperties();
var b={};
for(var a=0;
a<d.length;
a++){switch(d[a].typeItem){case"chart_text":b.text=d[a].text;
break
}}this.chartItems[c].watchingData={lastStart:null,lastEnd:null,properties:b}
}}},termWatching:function(){this.disableEvChange=true;
if(this.watchingItems){for(var c in this.watchingItems){var d=this.itemsContainer.getItemById(c);
var b=d.getProperties();
for(var a=0;
a<b.length;
a++){switch(b[a].typeItem){case"line":b[a].stroke=this.watchingItems[c].watchingData.properties.color_line;
b[a]["marker-start"]=this.watchingItems[c].watchingData.properties["marker-start"];
b[a]["marker-end"]=this.watchingItems[c].watchingData.properties["marker-end"];
break;
case"text_base":b[a].fill=this.watchingItems[c].watchingData.properties.color_text;
b[a].text=this.watchingItems[c].watchingData.properties.text;
break
}}d.setProperties(b);
delete this.watchingItems[c].watchingData
}}if(this.chartItems){for(var c in this.chartItems){var d=this.itemsContainer.getItemById(c);
var b=d.getProperties();
for(var a=0;
a<b.length;
a++){switch(b[a].typeItem){case"chart_text":b[a].text=this.chartItems[c].watchingData.properties.text;
break
}}d.setProperties(b);
delete this.chartItems[c].watchingData
}}delete this.disableEvChange
},onWatchingTimer:function(){if(this.isMove()||!this.isModeWatching()||!this.watchingItems&&!this.chartItems){return
}if(this.watchingItems){for(var f in this.watchingItems){this.showTimeToRefresh(f);
this.setLineColor(f)
}}if(this.chartItems){for(var f in this.chartItems){this.showTimeToRefresh(f)
}}if(Ext.isDefined(this._mode.watchingAjaxProcessIdItem)){return
}var k=(new Date).getTime();
var g=null;
var a=0;
var h=false;
for(var d=0;
d<2&&!h;
d++){var c=d?"chartItems":"watchingItems";
if(this[c]){for(var f in this[c]){var b=c=="watchingItems"?this[c][f].head.check_period_minutes*60:this[c][f].head.refresh_period;
if(!this[c][f].watchingData.lastStart){g=f;
h=true;
break
}else{if((k-this[c][f].watchingData.lastStart)/1000>=b&&(k-this[c][f].watchingData.lastStart)>a){g=f;
a=k-this[c][f].watchingData.lastStart
}}}}}if(g){this.startWatchingItem(g,k)
}},startWatchingItem:function(b,f){var c=this.itemsContainer.getItemById(b);
if(!c){return
}if(this.watchingItems&&this.watchingItems[b]){this._mode.watchingAjaxProcessIdItem=b;
this.watchingItems[b].watchingData.lastStart=f;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getCountRecords",params:Ext.encode({filter_type:this.watchingItems[b].head.filter_type,filter:this.watchingItems[b].filter,check_last_minutes:this.watchingItems[b].head.check_last_minutes})},success:function(g){this.showResultWatchingItem(b,g);
if(this.isModeWatching()){delete this._mode.watchingAjaxProcessIdItem
}this.watchingItems[b].watchingData.lastEnd=(new Date).getTime()
},errorFailure2:function(){if(this.isModeWatching()){delete this._mode.watchingAjaxProcessIdItem
}},scope:this})
}if(this.chartItems&&this.chartItems[b]){c=c.getItemByTypeItem&&c.getItemByTypeItem("chart");
if(!c){this.chartItems[b].watchingData.lastStart=f;
return
}this._mode.watchingAjaxProcessIdItem=b;
this.chartItems[b].watchingData.lastStart=f;
var a=this.getChartTimeInterval(this.chartItems[b].head.chart_interval);
var d=cloneObject(this.chartItems[b].chartConfig);
if(d.filtersFromParent){delete d.filtersFromParent
}Ext.apply(d,{dateFrom:a[0],dateTo:a[1],timeAxis:this.getChartTimeAxis(this.chartItems[b].head.chart_interval),title:"blank",_disableLegendTimeAxis:true,chart_width:roundNumber(c.configItem.width),chart_height:roundNumber(c.configItem.height)});
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getChartSvg",params:Ext.encode({chart_config:d,scale_perc:c.configItem.scale_perc,is_gecko:Ext.isGecko})},success:function(g){this.showResultChartItem(b,g);
if(this.isModeWatching()){delete this._mode.watchingAjaxProcessIdItem
}this.chartItems[b].watchingData.lastEnd=(new Date).getTime()
},errorFailure2:function(){if(this.isModeWatching()){delete this._mode.watchingAjaxProcessIdItem
}},scope:this})
}},showResultWatchingItem:function(m,q){if(!Ext.isDefined(this.watchingItems[m].watchingData)){return
}this.watchingItems[m].watchingData.alerts=[];
this.watchingItems[m].watchingData.colors_line={colors:[]};
var o="";
for(var n=0;
n<3;
n++){var a=n==0?"count_records":n==1?"response_time":"response_time_2";
if(Ext.isDefined(q[a])){for(var h=0;
h<this.watchingItems[m].watchingConfigTable.length;
h++){if(Ext.isDefined(this.watchingItems[m].watchingConfigTable[h][a])&&this.watchingItems[m].watchingConfigTable[h].type_condition==(n+1)&&(a=="count_records"?q[a]<=this.watchingItems[m].watchingConfigTable[h].count_records:q[a]>=this.watchingItems[m].watchingConfigTable[h].response_time)){var b=this.watchingItems[m].watchingData.properties.color_text||"#000000";
if(this.watchingItems[m].watchingConfigTable[h].color){b=this.watchingItems[m].watchingConfigTable[h].color;
this.watchingItems[m].watchingData.colors_line.colors.push(this.watchingItems[m].watchingConfigTable[h].color)
}if(this.watchingItems[m].watchingConfigTable[h].text){o+='<tspan fill="'+b+'" dx=8>'+this.watchingItems[m].watchingConfigTable[h].text+(this.watchingItems[m].watchingConfigTable[h].show_condition_value?"<tspan font-size="+(this.watchingItems[m].watchingData.properties.size_text-2)+' fill="'+b+'" dx=2>'+(a=="count_records"?"#":"")+q[a]+(a=="count_records"?"":"ms"):"")
}this.watchingItems[m].watchingData.alerts.push({type:a,value:q[a],text:this.watchingItems[m].watchingConfigTable[h].text});
break
}}}}this.watchingItems[m].watchingData.text=this.watchingItems[m].watchingData.properties.text+o;
var p=this.itemsContainer.getItemById(m);
var l=p.getProperties();
for(var h=0;
h<l.length;
h++){switch(l[h].typeItem){case"line":if(this.watchingItems[m].watchingData.colors_line.colors.length){this.watchingItems[m].watchingData.colors_line.act_index_color=0;
this.watchingItems[m].watchingData.colors_line.last_set_color=new Date;
var c=this.watchingItems[m].watchingData.colors_line.colors[0];
l[h].stroke=c;
for(var f=0;
f<2;
f++){var d=f?"marker-end":"marker-start";
var g=this.watchingItems[m].watchingData.properties[d];
if(g){var k=g.match(/url\(#arrow-.*-c(.*)-w\d+\)/);
if(k){l[h][d]=g.replace(k[1],c.substr(1))
}}}}break;
case"text_base":l[h].text=this.watchingItems[m].watchingData.properties.text+o;
break
}}this.disableEvChange=true;
p.setProperties(l);
delete this.disableEvChange
},showResultChartItem:function(b,a){if(a.svg_base64){var c=this.itemsContainer.getItemById(b);
if(c){c=c.getItemByTypeItem("chart");
if(c){c.svgEl.setAttributeNS(this.xlink,"href","data:image/svg+xml;base64,"+a.svg_base64)
}}}},showTimeToRefresh:function(d){if(this.watchingItems&&this.watchingItems[d]&&this.watchingItems[d].watchingData.text){var f=this.itemsContainer.getItemById(d);
var c=f.getProperties();
var a=[];
for(var b=0;
b<c.length;
b++){switch(c[b].typeItem){case"text_base":a.push(c[b]);
var g=Math.round(this.watchingItems[d].watchingData.lastStart/1000+this.watchingItems[d].head.check_period_minutes*60-dateTime().getTime()/1000);
a[a.length-1].text=this.watchingItems[d].watchingData.text+' <tspan font-size=9 fill="dimgrey"> '+(d==this._mode.watchingAjaxProcessIdItem?"refresh":g>0?"-"+g+"s":"wait");
break
}}this.disableEvChange=true;
f.setProperties(a);
delete this.disableEvChange
}if(this.chartItems&&this.chartItems[d]&&this.chartItems[d].watchingData.lastStart){var f=this.itemsContainer.getItemById(d);
var c=f.getProperties();
var a=[];
for(var b=0;
b<c.length;
b++){switch(c[b].typeItem){case"chart_text":a.push(c[b]);
var g=Math.round(this.chartItems[d].watchingData.lastStart/1000+this.chartItems[d].head.refresh_period-dateTime().getTime()/1000);
a[a.length-1].text=this.chartItems[d].watchingData.properties.text+' <tspan font-size=9 fill="dimgrey"> '+(d==this._mode.watchingAjaxProcessIdItem?"refresh":g>0?"-"+g+"s":"wait");
break
}}this.disableEvChange=true;
f.disableRelayout=true;
f.setProperties(a);
delete f.disableRelayout;
delete this.disableEvChange
}},setLineColor:function(l){if(this.watchingItems&&this.watchingItems[l]&&this.watchingItems[l].watchingData.colors_line&&this.watchingItems[l].watchingData.colors_line.colors&&this.watchingItems[l].watchingData.colors_line.colors.length>1){if((new Date).getTime()-this.watchingItems[l].watchingData.colors_line.last_set_color.getTime()>1000){++this.watchingItems[l].watchingData.colors_line.act_index_color;
if(this.watchingItems[l].watchingData.colors_line.act_index_color>=this.watchingItems[l].watchingData.colors_line.colors.length){this.watchingItems[l].watchingData.colors_line.act_index_color=0
}this.watchingItems[l].watchingData.colors_line.last_set_color=new Date;
var a=this.watchingItems[l].watchingData.colors_line.colors[this.watchingItems[l].watchingData.colors_line.act_index_color];
var m=this.itemsContainer.getItemById(l);
var k=m.getProperties();
var c=[];
for(var g=0;
g<k.length;
g++){switch(k[g].typeItem){case"line":c.push(k[g]);
c[g].stroke=a;
for(var d=0;
d<2;
d++){var b=d?"marker-end":"marker-start";
var f=this.watchingItems[l].watchingData.properties[b];
if(f){var h=f.match(/url\(#arrow-.*-c(.*)-w\d+\)/);
if(h){c[g][b]=f.replace(h[1],a.substr(1))
}}}break
}}this.disableEvChange=true;
m.setProperties(c);
delete this.disableEvChange
}}},showWatchingRecords:function(d){var b=d._getIdGroup();
if(this.watchingItems&&this.watchingItems[b]){var c=cloneObject(this.watchingItems[b].filter||{});
var a=null;
var g=dateTime(dateTime().getTime()/1000-this.watchingItems[b].head.check_last_minutes*60);
g.timeDefined=true;
switch(this.watchingItems[b].head.filter_type){case 1:c.fdatefrom=g;
a=new CDR.Grid({extraParams:c,disableCharts:true,disableMenu:true,disablePagingToolbar:true,enableTbarRibbonDateFromTo:true,enableTbarRibbonFilterButton:true,enableTbarRibbonPaginator:true,loadAtInit:true,border:false});
break;
case 2:c.calldate_from=g;
a=new Message.Grid({form_filters:c,disableCharts:true,disableMenu:true,disablePagingToolbar:true,enableTbarRibbonDateFromTo:true,enableTbarRibbonFilterButton:true,enableTbarRibbonPaginator:true,border:false});
break;
case 3:c.date_time_from=g;
a=new HTTP.Grid({form_filters:c,disableCharts:true,disableMenu:true,disablePagingToolbar:true,enableTbarRibbonDateFromTo:true,enableTbarRibbonFilterButton:true,enableTbarRibbonPaginator:true,border:false})
}if(!a){Ext.Msg.alert("","unsupported watching type");
return
}var f=new Ext.Window({layout:"fit",items:a,title:this.watchingItems[b].watchingData.text,width:Math.round(Ext.dom.Element.getViewportWidth()*7/8),height:Math.round(Ext.dom.Element.getViewportHeight()*7/8),modal:true,closable:true,maximizable:true});
f.show()
}},addItemForLine:function(b){if(!Ext.isDefined(this.itemsForLine)){this.itemsForLine=[]
}if(this.isModeForSelectItemsForNewLink()){if(b.isEnableLine()){if(this.itemsForLine.length<2){if(!this.itemsForLine.length||b!=this.itemsForLine[0]){this.itemsForLine.push(b)
}}else{if(b!=this.itemsForLine[1]){this.itemsForLine[0]=this.itemsForLine[1];
this.itemsForLine[1]=b
}}this.clearIndikSelect();
for(var a=0;
a<this.itemsForLine.length;
a++){this.itemsForLine[a].addIndikSelect()
}if(this._mode.ev_object&&this._mode.ev_object.ev_selectItemsForLink(this.itemsForLine)){this._mode.ev_object.ev_selectItemsForLink(this.itemsForLine)
}}}else{if(this.itemsForLine.length==0||this.itemsForLine.length==1&&this.itemsForLine[0].id!=b.id){this.itemsForLine.push(b);
this.addLineFromItemsForLine()
}}},deleteItemsForLine:function(){if(this.itemsForLine){for(var a=0;
a<this.itemsForLine.length;
a++){this.itemsForLine[a].clearIndikSelect()
}delete this.itemsForLine;
if(this.isModeForSelectItemsForNewLink()&&this._mode.ev_object&&this._mode.ev_object.ev_selectItemsForLink(this.itemsForLine)){this._mode.ev_object.ev_selectItemsForLink(null)
}}},addLineFromItemsForLine:function(){if(this.itemsForLine&&this.itemsForLine.length==2){this.addLine({item1:this.itemsForLine[0],item2:this.itemsForLine[1]});
this.deleteItemsForLine()
}},selectItemForMultipleSelectMove:function(a,b){a=a._getGroup(true);
a.toFront();
this.selectedItemForMultipleSelectMove={item:a,selectXY:[b.clientX,b.clientY]}
},unselectItemForMultipleSelectMove:function(){if(this.selectedItemForMultipleSelectMove){this.selectedItemForMultipleSelectMove.item.fixXY();
if(this.itemsMultipleSelect&&this.itemsMultipleSelect.length){for(var a=0;
a<this.itemsMultipleSelect.length;
a++){this.itemsMultipleSelect[a].fixXY()
}}delete this.selectedItemForMultipleSelectMove
}},existsItemInMultipleSelect:function(a){a=a._getGroup(true);
return(this.itemsMultipleSelect&&this.itemsMultipleSelect.isIn(a))
},toggleItemForMultipleSelect:function(a){a=a._getGroup(true);
if(a.isLineBetweenSnapItems()){return
}if(!Ext.isDefined(this.itemsMultipleSelect)){this.itemsMultipleSelect=[]
}if(this.itemsMultipleSelect.isIn(a)){this.itemsMultipleSelect.splice(this.itemsMultipleSelect.indexOf(a),1);
a.clearIndikSelect()
}else{this.itemsMultipleSelect.push(a);
a.addIndikSelect()
}if(this._mode&&this._mode.form&&this._mode.form.setSelectedItems){this._mode.form.setSelectedItems(this.itemsMultipleSelect.length)
}},selectAllMultipleSelect:function(){this.unselectAllMultipleSelect();
for(var a=0;
a<this.itemsContainer.items.length;
a++){this.toggleItemForMultipleSelect(this.itemsContainer.items[a])
}},unselectAllMultipleSelect:function(){if(this.itemsMultipleSelect){while(this.itemsMultipleSelect.length){this.toggleItemForMultipleSelect(this.itemsMultipleSelect[0])
}delete this.itemsMultipleSelect
}},addIcon:function(b,a){if(a.center){b[0]=roundNumber(b[0]-a.width/2);
b[1]=roundNumber(b[1]-a.height/2)
}this.itemsContainer.beginGroup("icon_with_text");
this.itemsContainer.addItem("icon","image",{x:b[0],y:b[1],width:a.width,height:a.height,href:a.url},{movable:true,enable_line:true});
this.itemsContainer.addItem("icon_text","text",{x:b[0]+roundNumber(a.width/2),y:b[1]+a.height+2,"text-anchor":"middle",text:a.name},{movable:true,enable_line:true});
var c=this.itemsContainer.pushGroup();
this.addIndikSelect(c)
},addLine:function(a){this.itemsContainer.beginGroup("line_between_items");
this.itemsContainer.addGroupSnapItem(a.item1);
this.itemsContainer.addGroupSnapItem(a.item2);
this.addDefArrowColor("start","#000000",1);
this.addDefArrowColor("end","#000000",1);
this.itemsContainer.addItem("line","line",{"marker-start":"url(#arrow-start-c000000-w1)","marker-end":"url(#arrow-end-c000000-w1)"},{selectable:true});
this.itemsContainer.addItem("text_base","text",{"text-anchor":"middle",text:"new line"},{selectable:true});
var b=this.itemsContainer.pushGroup();
this.addIndikSelect(b)
},addText:function(b,c){var a=this.itemsContainer.addItem("text","text",{x:b[0],y:b[1],"text-anchor":"middle",fill:"#000000",text:c},{movable:true,enable_line:true});
this.addIndikSelect(a)
},addChart:function(d,c){var b=350;
var a=180;
if(c.center){d[0]=roundNumber(d[0]-b/2);
d[1]=roundNumber(d[1]-a/2)
}this.itemsContainer.beginGroup("chart_with_text");
this.itemsContainer.addItem("chart_text","text",{x:d[0]+roundNumber(b/2),y:d[1],"text-anchor":"middle",text:c.text},{movable:true,enable_line:true});
this.itemsContainer.addItem("chart","chart",{x:d[0],y:d[1]+10,width:b,height:a,scale_perc:70},{movable:true,enable_line:false});
var f=this.itemsContainer.pushGroup();
this.addIndikSelect(f)
},getItemProperties:function(a){return(a.getProperties())
},removeDefArrowColor:function(c,a){if(a[0]=="#"){a=a.substr(1)
}var d="arrow-"+c+"-c"+a;
for(var b=0;
b<this.defs.childNodes.length;
b++){if(this.defs.childNodes[b].id==d){Ext.fly(this.defs.childNodes[b]).remove();
return
}}},evResize:function(){if(this.indikSelectItem&&this.indikSelectItem.properties_control){this.indikSelectItem.properties_control.evResizePainter()
}if(this._mode&&this._mode.ev_object&&this._mode.ev_object.evResizePainter){this._mode.ev_object.evResizePainter()
}},clear:function(a,b){if(a&&this.itemsContainer.items.length){Ext.Msg.confirm("",this.findLangS("text","clearPaintQuestion"),function(c){if(c=="yes"){this._clear(b)
}},this)
}else{this._clear(b)
}},_clear:function(a){this.clearAllSelect();
this.itemsContainer.destroyAll(true);
if(this.watchingItems){delete this.watchingItems
}if(this.chartItems){delete this.chartItems
}if(a&&this.toolBar&&this.toolBar.onClearPaint){this.toolBar.onClearPaint()
}},clearAllSelect:function(){this.unselectItemForMove();
this.unselectItemForMultipleSelectMove();
this.deleteItemsForLine();
this.clearIndikSelect();
this.unselectAllMultipleSelect()
},evChange:function(){if(this.toolBar&&this.toolBar.onClearPaint&&!this.disableEvChange){this.toolBar.onChangePaint()
}},setPositionProperies:function(){if(this.indikSelectItem&&this.indikSelectItem.properties_control){Ext.defer(function(){this.indikSelectItem.properties_control.optimizeFloatingPosition()
},100,this)
}},getSvgPaintForSave:function(){var a=this.itemsContainer.getData();
if(!isDataEmpty(this.watchingItems)||!isDataEmpty(this.chartItems)){a={svgData:a};
if(!isDataEmpty(this.watchingItems)){a.watchingItems=this.watchingItems
}if(!isDataEmpty(this.chartItems)){a.chartItems=this.chartItems
}}return(a)
},loadSvgPaint:function(c){this.clear();
this.itemsContainer.loadData(c.svgData||c);
if(c.watchingItems){this.watchingItems={};
for(var a in c.watchingItems){var b=this.itemsContainer.getItemById(a,true);
if(b){this.watchingItems[b._getIdGroup(true)]=c.watchingItems[a]
}}}if(c.chartItems){this.chartItems={};
for(var a in c.chartItems){var b=this.itemsContainer.getItemById(a,true);
if(b){this.chartItems[b._getIdGroup(true)]=c.chartItems[a]
}}}this.itemsContainer.relayoutAll()
},setWatchingConfig:function(b,a){if(!Ext.isDefined(this.watchingItems)){this.watchingItems={}
}this.watchingItems[b._getIdGroup(true)]=a;
this.evChange()
},getWatchingConfig:function(a){if(!Ext.isDefined(this.watchingItems)||!this.watchingItems[a._getIdGroup(true)]){return(null)
}return(this.watchingItems[a._getIdGroup(true)])
},setChartConfig:function(b,a){if(!Ext.isDefined(this.chartItems)){this.chartItems={}
}this.chartItems[b._getIdGroup(true)]=a;
this.evChange()
},getChartConfig:function(a){if(!Ext.isDefined(this.chartItems)||!this.chartItems[a._getIdGroup(true)]){return(null)
}return(this.chartItems[a._getIdGroup(true)])
},evBeforeDestroyItem:function(a){if(this.watchingItems&&this.watchingItems[a.id]){delete this.watchingItems[a.id]
}if(this.chartItems&&this.chartItems[a.id]){delete this.chartItems[a.id]
}},deactivate:function(){this.unselectItemForMove();
this.deleteItemsForLine();
this.clearIndikSelect()
},getSvg:function(){var b=this.itemsContainer.getMaxXY();
var a='<svg xmlns="'+this.xmlns+'" xmlns:xlink="'+this.xlink+'" width="'+(b[0]+100)+'" height="'+(b[1]+100)+'" >'+this.svg.dom.innerHTML+"</svg>";
var f=[/(onmousedown="[^"]+")/,/(class="[^"]+")/];
for(var c=0;
c<f.length;
c++){do{var d=a.match(f[c]);
if(d&&d.length>1){a=a.replace(d[1],"")
}else{break
}}while(true)
}return(a)
},getChartTimeIntervalsData:function(){return(arDashboardTimeIntervals)
},getChartTimeAxis:function(a){return(getDataArrayItem(this.getChartTimeIntervalsData(),a,0,2))
},getChartTimeInterval:function(a){return(getTimeIntervalForTypeInterval(a,{prevInterval:false,intervalOffset:null,timeIntervalData:this.getChartTimeIntervalsData()}))
},createNewPaintFromData:function(a){this.clear(false,true);
if(a.typeData=="sip_history"){this.createNewPaintFromData_sip_history(a.data)
}},createNewPaintFromData_sip_history:function(a){if(a.ip.length<=12){this.createNewPaintFromData_add_icons_ring(a)
}else{this.createNewPaintFromData_add_icons_matrix(a)
}this.createNewPaintFromData_add_lines(a)
},createNewPaintFromData_add_icons_matrix:function(d){var h=100;
var c=50;
var l=300;
var n=150;
var o=3;
var m={url:"images/network_topology/router.gif",width:77,height:52,size_perc:75};
d.icons={};
for(var f=0;
f<d.ip.length;
f++){var g=parseInt(f/o);
var a=parseInt(f%o);
var k=[roundNumber(h+a*l+m.width/2),roundNumber(c+g*n+m.height/2)];
var b=this.createNewPaintFromData_add_icon_to_pos(d,f,m,k);
d.icons[d.ip[f]]=b.id
}},createNewPaintFromData_add_icons_ring:function(f){var n=this.getWidth();
var m=this.getHeight();
var b=Math.min(n,m)*2/5-50;
var a=[n*2/5,m*2/5];
var h=120;
var l={url:"images/network_topology/router.gif",width:77,height:52,size_perc:75};
f.icons={};
for(var g=0;
g<f.ip.length;
g++){var d=Math.PI*2/360*(h-g*(360/f.ip.length));
var k=[roundNumber(a[0]+Math.sin(d)*b),roundNumber(a[1]+Math.cos(d)*b)];
var c=this.createNewPaintFromData_add_icon_to_pos(f,g,l,k);
f.icons[f.ip[g]]=c.id
}},createNewPaintFromData_add_icon_to_pos:function(b,d,a,c){this.itemsContainer.beginGroup("icon_with_text");
this.itemsContainer.addItem("icon","image",{x:c[0],y:c[1],width:a.width,height:a.height,href:a.url,size_perc:a.size_perc},{movable:true,enable_line:true});
this.itemsContainer.addItem("icon_text","text",{x:c[0]+roundNumber(a.width*a.size_perc/100/2),y:c[1]+roundNumber(a.height*a.size_perc/100+2),"text-anchor":"middle",text:b.ip[d]+(b.hostnames[b.ip[d]]?"\r\n"+b.hostnames[b.ip[d]]:""),"font-size":11},{movable:true,enable_line:true});
return(this.itemsContainer.pushGroup())
},createNewPaintFromData_add_lines:function(d){var b={"request/SIP/SDP":"SIP","response/SIP/SDP":"SIP","request/SIP":"SIP","response/SIP":"SIP","rtp/":"RTP","http_jj/":"HTTP"};
var a={SIP:{color:"00AA00"},RTP:{color:"0000AA"},HTTP:{color:"AA0000"}};
var n={};
for(var f=0;
f<d.data.length;
f++){var g=d.data[f].type+"/"+d.data[f].protocol;
var h=b[g]||g;
var l=h+"/"+(d.data[f].srcip<d.data[f].dstip?d.data[f].srcip+":"+d.data[f].srcport+"-"+d.data[f].dstip+":"+d.data[f].dstport:d.data[f].dstip+":"+d.data[f].dstport+"-"+d.data[f].srcip+":"+d.data[f].srcport);
var k=d.data[f].srcip<d.data[f].dstip?"a":"b";
if(!n[l]){n[l]={ipa:d.data[f][k=="a"?"srcip":"dstip"],ipb:d.data[f][k=="a"?"dstip":"srcip"],porta:d.data[f][k=="a"?"srcport":"dstport"],portb:d.data[f][k=="a"?"dstport":"srcport"],typeLine:h}
}n[l][k=="a"?"dir_to_b":"dir_to_a"]=true
}for(var f in n){var c=a[n[f].typeLine]&&a[n[f].typeLine].color||"000000";
this.itemsContainer.beginGroup("line_between_items");
this.itemsContainer.addGroupSnapItem(this.itemsContainer.getItemById(d.icons[n[f].ipa]));
this.itemsContainer.addGroupSnapItem(this.itemsContainer.getItemById(d.icons[n[f].ipb]));
this.addDefArrowColor("start","#"+c,1);
this.addDefArrowColor("end","#"+c,1);
this.itemsContainer.addItem("line","line",{"marker-start":n[f].dir_to_a?"url(#arrow-start-c"+c+"-w1)":undefined,"marker-end":n[f].dir_to_b?"url(#arrow-end-c"+c+"-w1)":undefined,stroke:"#"+c},{selectable:true});
var m=n[f].typeLine;
this.itemsContainer.addItem("text_base","text",{"text-anchor":"middle","font-size":11,fill:"#"+c,text:m},{selectable:true});
if(n[f].porta){this.itemsContainer.addItem("text_marker_start","text",{"text-anchor":"middle","font-size":8,fill:"#"+c,text:String(n[f].porta)},{selectable:true})
}if(n[f].portb){this.itemsContainer.addItem("text_marker_end","text",{"text-anchor":"middle","font-size":8,fill:"#"+c,text:String(n[f].portb)},{selectable:true})
}this.itemsContainer.pushGroup()
}},enableEdit:function(){return(!this.configPaintPanel||!this.configPaintPanel.disableEdit)
},disableForShare:function(){return(this.configPaintPanel&&this.configPaintPanel.disableForShare)
}});
Ext.define("SvgPaint.EditItem.Form",{extend:"Ext.form.Panel",subsystem:"svg_paint",constructor:function(c){var d=__width_FieldChar(50);
var a=__width_FieldChar(12);
var b=this.getItemsForProperies(c.painter,c.item,{fieldWidth:d,labelWidth:a});
var f=[{xtype:"button",text:this.findLangS("button","deleteItem"),iconCls:"icon_delete",scope:this,handler:function(){Ext.Msg.confirm("",this.findLangS("text","deleteSelectedItemQuestion"),function(g){if(g=="yes"){if(this._window){this._window.close()
}c.item.destroy()
}},this)
}}];
if(c.item.isLineBetweenSnapItems()){f.push({width:4,border:false},{xtype:"button",text:this.findLangS("button","setWatching"),iconCls:"icon_edit",scope:this,handler:function(){this.createWatchingItemForm()
}})
}if(c.item.isChart()){f.push({width:4,border:false},{xtype:"button",text:this.findLangS("button","setChart"),iconCls:"icon_edit",scope:this,handler:function(){this.createChartItemForm()
}})
}b.push({xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:5}}},{layout:{type:"vbox",align:"center"},items:{layout:"hbox",items:f,border:false,bodyStyle:{"background-color":c.style&&c.style["background-color"]||"white"}},border:false,width:d,bodyStyle:{"background-color":c.style&&c.style["background-color"]||"white"}});
c=Ext.applyIf(c||{},{border:false,items:b});
this.callParent([c])
},createWatchingItemForm:function(){this.painter.maskLoad();
if(this._window){this._window.hide()
}Ext.defer(function(){this._createWatchingItemForm()
},100,this)
},_createWatchingItemForm:function(){return(new SvgPaint.SetWatchingItem.Form.Window({item:this.item,painter:this.painter,maskEl:this.painter,hideEl:this._window,evOk:function(a){this.painter.setWatchingConfig(this.item,a)
},evOkScope:this,data:this.painter.getWatchingConfig(this.item)}))
},createChartItemForm:function(a){if(!a){var c=this.painter.getChartConfig(this.item);
if(!c){var b=new Ext.form.FormPanel({items:[{xtype:"ComboBoxA",name:"chart_type",value:"CDR",fieldLabel:this.findLangS("field","chart_type"),aData:[["CDR",this.findLangS("combomenu","CDR")],["MESSAGES",this.findLangS("combomenu","Message")]],labelWidth:__width_FieldChar(12),width:__width_FormChar(15,12)}],buttons:[{text:lang.okButtonText,iconCls:"icon_ok",scope:this,handler:function(){var f=b.getForm().findField("chart_type").getValue();
this.createChartItemForm(f);
b.ownerCt.close()
}},{text:lang.cancelButtonText,iconCls:"icon_cancel",scope:this,handler:function(){b.ownerCt.close()
}}],frame:true,border:false,height:Ext.isIE?150:undefined});
var d=new Ext.Window({title:this.findLangS("title","selectNewChartType"),layout:"fit",items:b,border:false,modal:true,closable:true,resizable:false});
d.show();
return
}}this.painter.maskLoad();
if(this._window){this._window.hide()
}Ext.defer(function(){this._createChartItemForm(a)
},100,this)
},_createChartItemForm:function(a){new SvgPaint.SetChartItem.Form.Window({item:this.item,painter:this.painter,maskEl:this.painter,hideEl:this._window,evOk:function(b){this.painter.setChartConfig(this.item,b);
this.item.relayout()
},evOkScope:this,data:this.painter.getChartConfig(this.item),_typeChart:a})
},getItemsForProperies:function(k,n,a){var g=[];
var f=k.getItemProperties(n);
for(var d=0;
d<f.length;
d++){if(["text_marker_start","text_marker_end"].isIn(f[d].typeItem)){continue
}var l=f[d].typeItem||f[d].typeElement;
if(this.findLangS("field_properties",l,2)){l=this.findLangS("field_properties",l,2)
}g.push({xtype:"displayfield",value:l,style:{marginLeft:a.labelWidth+__width_FieldSeparator},fieldStyle:{color:"darkblue","font-weight":"bold","font-style":"italic",height:14,"min-height":14}});
for(var c in f[d]){if(["typeItem","typeItemGroup","typeElement"].isIn(c)){continue
}var m=this.getConfigField(f[d],c,a,k);
if(c=="marker-start"||c=="marker-end"){var b="text_"+(c=="marker-start"?"marker_start":"marker_end");
var h=this.getPropertiesForTypeItem(f,b)||Ext.apply(n._getDefaultProperties(n._typeItemGroup(),b,"text"),{typeItemGroup:n._typeItemGroup(),typeItem:b,typeElement:"text"});
m.width=a.labelWidth+__width_FieldSeparator+20;
m={xtype:"container",layout:"hbox",items:[m,Ext.apply(this.getConfigField(h,"text",a,k),{fieldLabel:undefined,width:__width_FieldChar(10)}),{width:__width_FieldSeparator,border:false},Ext.apply(this.getConfigField(h,"fill",a,k),{fieldLabel:undefined,width:__width_FieldChar(8)+__width_Trigger}),{width:__width_FieldSeparator,border:false},Ext.apply(this.getConfigField(h,"font-size",a,k),{fieldLabel:undefined,width:__width_FieldChar(4)+__width_Trigger})],style:{marginBottom:__height_FieldSeparator}}
}g.push(m)
}}return(g)
},evChangeProp:function(g){var c={};
c.typeItemGroup=g._typeItemGroup;
c.typeItem=g._typeItem;
c.typeElement=g._typeElement;
c[g._prop]=this.getPropValue(g._typeItem,g._typeElement,g._prop);
if(g._typeItemGroup=="line_between_items"&&g._typeItem=="line"&&g._typeElement=="line"&&(g._prop=="stroke"||g._prop=="stroke-width")){var f=this.getPropValue(g._typeItem,g._typeElement,"marker-start");
if(f){c["marker-start"]=f
}var b=this.getPropValue(g._typeItem,g._typeElement,"marker-end");
if(f){c["marker-end"]=b
}}var d={};
if(c.typeItem=="icon"&&c.typeElement=="image"&&c.href&&g.xtype=="combobox"){var a=g.findRecord(g.valueField,c[g._prop]);
if(!a){return
}Ext.apply(d,{wh:[a.data.width,a.data.height]})
}this.item.setProperties(c,d)
},getPropValue:function(d,h,k){var g=this.getForm().findField(this.getNameField(d,h,k));
if(!g){return(null)
}var f=g.getValue();
switch(k){case"marker-start":case"marker-end":var b=k=="marker-start"?"start":"end";
var a=this.getPropValue(d,h,"stroke");
if(a[0]=="#"){a=a.substr(1)
}var c=this.getPropValue(d,h,"stroke-width");
f=f?"url(#arrow-"+b+"-c"+a+"-w"+c+")":"none";
break
}return(f)
},getPropertiesForTypeItem:function(b,c){for(var a=0;
a<b.length;
a++){if(b[a].typeItem==c){return(b[a])
}}return(null)
},getNameField:function(a,b,c){return(a+"/"+b+"/"+c)
},getConfigField:function(c,d,b,a){var f={};
var g="textfield";
switch(d){case"href":if(a.iconsStore){Ext.applyIf(f,{xtype:"combobox",editable:false,allowBlank:false,mode:"local",queryMode:"local",triggerAction:"all",store:a.iconsStore,displayField:"name",valueField:"url",iconClsField:"url",tpl:'<tpl for="."><tpl if="[xindex]==1"><table class="comboBox-menuList" style="table-layout: fixed;"><col width=25><col width=300></tpl><tr class="x-boundlist-item"><td style="text-align: left;"><img src="{url}" width="20px"></td><td style="">{name}</td></tr><tpl if="[xcount-xindex]==0"></table></tpl></tpl>'});
break
}case"text":if(c.typeItemGroup!="line_between_items"){Ext.applyIf(f,{xtype:"textarea",height:60})
}break;
case"font-size":Ext.applyIf(f,{xtype:"numberfield",minValue:6,maxValue:30});
break;
case"stroke-width":Ext.applyIf(f,{xtype:"numberfield",minValue:1,maxValue:4});
break;
case"size_perc":Ext.applyIf(f,{xtype:"numberfield",step:10,minValue:20,maxValue:400});
break;
case"width":case"height":Ext.applyIf(f,{xtype:"numberfield",step:10,minValue:10,maxValue:800});
break;
case"scale_perc":Ext.applyIf(f,{xtype:"numberfield",step:5,minValue:10,maxValue:100});
break;
case"fill":case"stroke":Ext.applyIf(f,{xtype:"colorpickerfield"});
break;
case"marker-start":case"marker-end":Ext.applyIf(f,{xtype:"checkbox",checked:c[d]&&c[d]!="none"});
break
}Ext.applyIf(f,{xtype:g,fieldLabel:this.findLangS("field_properties",d,2)||d,name:this.getNameField(c.typeItem,c.typeElement,d),value:f.xtype!="checkbox"?c[d]:undefined,labelWidth:b.labelWidth,width:b.fieldWidth,_typeItemGroup:c.typeItemGroup,_typeItem:c.typeItem,_typeElement:c.typeElement,_prop:d,listeners:{scope:this,change:this.evChangeProp}});
return(f)
}});
Ext.define("SvgPaint.EditItem.Form.Window",{extend:"Ext.Window",subsystem:"svg_paint",constructor:function(a){if(Ext.dom.Element.getViewportWidth()>1400){this._floating=true
}if(this._floating){a=Ext.applyIf(a||{},{border:false,resizable:false,title:this.findLangS("title","properties"),closable:true,items:new SvgPaint.EditItem.Form(Ext.apply({_window:this,style:{padding:5,"background-color":__color_WindowFrame},bodyStyle:{"background-color":__color_WindowFrame}},a)),style:{paddingRight:5,paddingBottom:5},listeners:{activate:function(){Ext.defer(function(){this._activated=true
},100,this)
},move:function(){if(this._activated&&!this.settingPosition){this.manualMove=true;
this.setOpacityIfFloating()
}},scope:this}})
}else{a=Ext.applyIf(a||{},{frame:true,border:false,closable:false,header:false,frameHeader:false,resizable:false,shadow:false,items:new SvgPaint.EditItem.Form(Ext.apply({_window:this},a)),style:{paddingRight:5,paddingBottom:5,background:"white","border-width":0,"box-shadow":"none"},listeners:{afterrender:function(b){Ext.defer(function(){var c=this.painter.findWindow();
if(c&&c.getEl()&&c.getEl().dom&&c.getEl().dom.style&&c.getEl().dom.style["z-index"]){b.getEl().dom.style["z-index"]=(c.getEl().dom.style&&c.getEl().dom.style["z-index"]*1)+100
}Ext.WindowManager.bringToFront(b)
},100,this)
},scope:this}})
}this.callParent([a]);
this.show();
if(this.contextItem){if(this._floating){this.optimizeFloatingPosition();
this.setOpacityIfFloating()
}else{this.moveToRightBottomInPainter()
}}},moveToRightBottomInPainter:function(){var a=this.getSize();
var b=this.painter.getSize();
var c=getAbsolutePosition(this.painter.body.dom);
this.settingPosition=true;
this.setPosition(c[0]+b.width-a.width-__width_Scroller+1,c[1]+b.height-a.height-__height_Scroller+1);
delete this.settingPosition
},optimizeFloatingPosition:function(){if(this.contextItem&&this._floating&&this.isVisible()&&!this.manualMove){var a=this.getSize();
var f=this.painter.getSize();
var g=getAbsolutePosition(this.painter.body.dom);
var d=this.item.getBBox();
var c=d.left>(f.width-d.right)?"left":"right";
var b=d.top>(f.height-d.bottom)?"top":"bottom";
this.settingPosition=true;
this.setPosition(g[0]+(c=="left"?d.left-a.width:d.right),g[1]+(b=="top"?d.top-a.height:d.bottom));
delete this.settingPosition
}},setTransparencyIfFloating:function(){if(this.contextItem&&this._floating&&!this.manualMove){this.getEl().setOpacity(0.5)
}},setOpacityIfFloating:function(){if(this.contextItem&&this._floating){this.getEl().setOpacity(this.manualMove?1:0.9)
}},evResizePainter:function(){if(this.contextItem){if(this._floating){this.optimizeFloatingPosition()
}else{this.moveToRightBottomInPainter()
}}}});
Ext.define("SvgPaint.SetWatchingItem.Form",{extend:"Ext.form.Panel",subsystem:"svg_paint",constructor:function(d){var r=this;
this.headFields=["filter_type","check_last_minutes","check_period_minutes"];
var s=20;
var o=[{xtype:"ComboBoxA",name:"filter_type",value:d.data&&d.data.head&&d.data.head.filter_type||1,fieldLabel:this.findLangS("field","filter_type"),labelWidth:__width_FieldChar(s),aData:[[1,this.findLangS("combomenu","CDR")],[2,this.findLangS("combomenu","Message")],[3,this.findLangS("combomenu","HTTP")]],listeners:{scope:this,select:function(t){this.evSelectFilterType(t.getValue())
}}},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"check_last_minutes",value:5,minValue:1,fieldLabel:this.findLangS("field","check_last_minutes"),labelWidth:__width_FieldChar(s),width:__width_FormChar(6,s)},{xtype:"numberfield",name:"check_period_minutes",value:1,minValue:1,fieldLabel:this.findLangS("field","check_period_minutes"),labelWidth:__width_FieldChar(10),width:__width_FormChar(6,10),style:{marginLeft:20,marginRight:2}},{xtype:"displayfield",value:"["+lang.minuteShort2+"]"}],style:{marginBottom:__height_FieldSeparator}}];
this.watchingConfigConditionItems=["count_records","response_time","response_time_2"];
this.watchingConfigItems=["type_condition","condition_text","show_condition_value","color","text"];
this.watchingConfigAllItems=[].concat(this.watchingConfigConditionItems).concat(this.watchingConfigItems);
var m="WatchingConfig";
if(!Ext.ClassManager.isCreated(m)){Ext.define(m,{extend:"Ext.data.Model",fields:[{name:"type_condition",type:"integer",convert:_convNull},{name:"count_records",type:"integer",convert:_convNull},{name:"response_time",type:"integer",convert:_convNull},{name:"response_time_2",type:"integer",convert:_convNull},{name:"condition_text"},{name:"show_condition_value",type:"bool"},{name:"color"},{name:"text"}]})
}var l=new Ext.data.ArrayStore({model:m,sorters:{property:"condition_text",direction:"ASC"},data:[]});
var n=[{xtype:"actioncolumn",text:" ",width:20,rendererBase:function(y,t,u,z,w,v){t.style="padding-bottom: 0; padding-top: 1; padding-left: 3;";
return("")
},sortable:false,items:[{getClass:function(t,u,w){return("icon_delete_small")
},handler:function(u,z,t,v,w){var y=u.store.getAt(z);
Ext.Msg.confirm("",this.findLangS("text","deleteRowQuestion"),function(A){if(A=="yes"){this.deleteWatchingConfig(y)
}},this)
},enableHandler:function(y,z,A,B,t,w,u){return(true)
},tooltip:this.findLangS("tooltip","delete_row"),scope:this}]},{dataIndex:"condition_text",width:__width_ColumnChar(15),renderer:function(z,t,v,A,y,w,u){return(r.findLangS("column","prefix_"+r.watchingConfigConditionItems[v.data.type_condition-1])+(v.data[r.watchingConfigConditionItems[v.data.type_condition-1]]||"--")+(r.findLangS("column","suffix_"+r.watchingConfigConditionItems[v.data.type_condition-1])||""))
}},{dataIndex:"color",width:__width_ColumnChar(10),renderer:function(z,t,v,A,y,w,u){return(z?'<span style="color: '+z+'";>'+z+"</span>":"")
},sortable:false},{dataIndex:"text",width:__width_ColumnChar(30),flex:1,sortable:false}];
for(var k=0;
k<n.length;
k++){if(!n[k].text){n[k].text=this.findLangS("column",n[k].dataIndex,2)
}}var q=new Ext.grid.Panel({store:l,columns:n,height:170,flex:1,viewConfig:{stripeRows:false}});
this.watchingConfigGrid=q;
q.selModel.on("selectionchange",function(t){var u=t.getSelection();
this.evWatchingConfigGridSelection(u)
},this);
var h=[{name:"type_condition",xtype:"ComboBoxA",aData:[[1,this.findLangS("combomenu","typeCondition_count_records")],[2,this.findLangS("combomenu","typeCondition_response_time")],[3,this.findLangS("combomenu","typeCondition_response_time_2")]],value:1,_width:20,listeners:{select:function(u){var t=u.getValue();
if(t){this.showWatchingConfigFieldConditionByType(t)
}},scope:this}},{name:"count_records",xtype:"numberfield",value:null,minValue:0,_width:11,allowBlank:false},{name:"response_time",xtype:"numberfield",value:null,minValue:0,_width:11,hidden:true,allowBlank:false},{name:"response_time_2",xtype:"numberfield",value:null,minValue:0,_width:11,hidden:true,allowBlank:false},{name:"show_condition_value",xtype:"checkbox"},{name:"color",xtype:"colorpickerfield",_width:11,allowBlank:false},{name:"text",_width:25,allowBlank:false}];
function p(t){for(var u=0;
u<t.length;
u++){if(t[u].items){p.call(this,t[u].items)
}else{t[u].fieldLabel=this.findLangS("field",t[u].name,2)||this.findLangS("column",t[u].name);
if(!t[u].width&&t[u]._width){t[u].width=__width_FormChar(t[u]._width,14)
}if(!t[u].labelWidth){t[u].labelWidth=__width_FieldChar(14)
}}}}p.call(this,h);
var b=[{xtype:"button",text:this.findLangS("button","add"),iconCls:"icon_add",handler:function(){if(this.checkFieldsWatchingConfig()){this.addWatchingConfig()
}},scope:this,_btnId:"addWatchingConfig"},{width:5,border:false},{xtype:"button",text:this.findLangS("button","save"),iconCls:"icon_save",handler:function(){if(this.checkFieldsWatchingConfig()){this.modifyWatchingConfig()
}},scope:this,_btnId:"modifyWatchingConfig",disabled:true}];
var g={xtype:"container",layout:"hbox",items:[q,{width:5,border:false},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"container",defaultType:"textfield",items:h},{height:6,border:false},{xtype:"container",layout:"hbox",items:b}]}]};
o.push(g);
var f=[];
this.containerFilterCdrCommon=new Ext.Container({xtype:"container",items:CDR.Filter.getFieldset("common",{values:{},disableTimeInterval:true,disableSelections:true}),title:this.findLangS("title","tabFilterCommon")});
f.push(this.containerFilterCdrCommon);
this.containerFilterCdrRTP=new Ext.Container({xtype:"container",items:CDR.Filter.getFieldset("rtp",{values:{}}),title:this.findLangS("title","tabFilterRtp")});
f.push(this.containerFilterCdrRTP);
if(window.existsDscpCdr){this.containerFilterCdrDSCP=new Ext.Container({xtype:"container",items:CDR.Filter.getFieldset("dscp",{values:{}}),title:this.findLangS("title","tabFilterDscp")});
f.push(this.containerFilterCdrDSCP)
}this.containerFilterCdrFiltersCombination=new Ext.Container({xtype:"container",items:CDR.Filter.getFieldset("filters_comb",{values:{}}),title:this.findLangS("title","tabFilterFiltersComb")});
f.push(this.containerFilterCdrFiltersCombination);
this.containerFilterMessage=new Ext.Container({xtype:"container",items:Message.Filter.getFieldset({values:{},disableTimeInterval:true}),title:this.findLangS("title","tabFilter")});
f.push(this.containerFilterMessage);
this.containerFilterHTTP=new Ext.Container({xtype:"container",items:HTTP.Filter.getFieldset({values:{},disableTimeInterval:true,extFilters:true}),title:this.findLangS("title","tabFilter")});
f.push(this.containerFilterHTTP);
var a=CDR.Filter.getWidthForm();
var c={xtype:"tabpanel",border:false,items:[],flex:1};
for(var k=0;
k<f.length;
k++){c.items.push({xtype:"container",items:{xtype:"container",items:f[k],style:{paddingTop:4,paddingLeft:4,paddingRight:4,"background-color":__color_FormBackground},width:a},border:false,width:a+__width_Scroller+4,autoScroll:true,title:f[k].title,style:{"background-color":__color_FormBackground}})
}Ext.applyIf(d,{layout:{type:"vbox",align:"stretch"},frame:true,border:false,items:[{xtype:"panel",items:o,border:false,bodyStyle:{"background-color":__color_FormBackground}},{height:6,border:false,bodyStyle:{"background-color":__color_FormBackground}},c,{xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:4}}},{layout:{type:"vbox",align:"center"},items:{xtype:"button",iconCls:"icon_ok",text:lang.okButtonText,handler:this.onOk,scope:this},border:false,bodyStyle:{"background-color":__color_FormBackground,padding:2}}],width:a+__width_Scroller+4+8,listeners:{scope:this,afterrender:function(){CDR.Filter.setContextFields(this);
Message.Filter.setContextFields(this);
HTTP.Filter.setContextFields(this)
}}});
this.callParent([d]);
this.evSelectFilterType(this.getForm().findField("filter_type").getValue())
},evSelectFilterType:function(c){if(c){var a=this.getForm().findField("type_condition");
if(a){if(c==1){a.addMenuItem({id:3,descr:this.findLangS("combomenu","typeCondition_response_time_2")})
}else{a.deleteMenuItem(3)
}}}this.containerFilterCdrFiltersCombination.ownerCt.ownerCt.tab.showIf(c==1);
this.containerFilterCdrFiltersCombination.ownerCt.ownerCt.showIf(c==1);
if(this.containerFilterCdrDSCP){this.containerFilterCdrDSCP.ownerCt.ownerCt.tab.showIf(c==1);
this.containerFilterCdrDSCP.ownerCt.ownerCt.showIf(c==1)
}this.containerFilterCdrRTP.ownerCt.ownerCt.tab.showIf(c==1);
this.containerFilterCdrRTP.ownerCt.ownerCt.showIf(c==1);
this.containerFilterCdrCommon.ownerCt.ownerCt.showIf(c==1);
this.containerFilterCdrCommon.ownerCt.ownerCt.tab.showIf(c==1);
this.containerFilterMessage.ownerCt.ownerCt.tab.showIf(c==2);
this.containerFilterMessage.ownerCt.ownerCt.showIf(c==2);
this.containerFilterHTTP.ownerCt.ownerCt.tab.showIf(c==3);
this.containerFilterHTTP.ownerCt.ownerCt.showIf(c==3);
var b=this.containerFilterCdrCommon.ownerCt.ownerCt.tab.ownerCt;
switch(c){case 1:b.setActiveTab(this.containerFilterCdrCommon.ownerCt.ownerCt.tab);
break;
case 2:b.setActiveTab(this.containerFilterMessage.ownerCt.ownerCt.tab);
break;
case 3:b.setActiveTab(this.containerFilterHTTP.ownerCt.ownerCt.tab);
break
}},checkFieldsWatchingConfig:function(){var b=this.getForm().getFieldValues();
this.getForm().isValid();
for(var a=0;
a<this.watchingConfigAllItems.length;
a++){var c=this.getForm().findField(this.watchingConfigAllItems[a]);
if(c){if(c.hidden){c.clearInvalid()
}else{if(!c.isValid()){return(false)
}}}}return(true)
},addWatchingConfig:function(){var b=this.getForm().getFieldValues();
var d={};
for(var a=0;
a<this.watchingConfigAllItems.length;
a++){d[this.watchingConfigAllItems[a]]=b[this.watchingConfigAllItems[a]]
}d.condition_text=(d.type_condition==1?"cr":(d.type_condition==2?"t1":"t2"))+String(d[this.watchingConfigConditionItems[d.type_condition-1]]).lpad(8,"0");
var c=0;
var f=this.watchingConfigGrid.store.sorters.items[0].getProperty();
this.watchingConfigGrid.store.each(function(g){if(g.data[f]<d[f]){++c
}});
this.watchingConfigGrid.store.insert(c,d);
this.watchingConfigGrid.getSelectionModel().deselectAll()
},modifyWatchingConfig:function(){var a=this.watchingConfigGrid.getSelectionModel().getSelection();
if(a.length!=1){return
}this.deleteWatchingConfig(a[0]);
this.addWatchingConfig()
},deleteWatchingConfig:function(a){var b=this.watchingConfigGrid.store.indexOf(a);
if(b>=0){this.watchingConfigGrid.store.removeAt(b)
}},loadWatchingConfig:function(a){for(var b=0;
b<this.watchingConfigAllItems.length;
b++){var c=this.getForm().findField(this.watchingConfigAllItems[b]);
if(c){c.setValue(a.data[this.watchingConfigAllItems[b]])
}}this.showWatchingConfigFieldConditionByType(a.data.type_condition)
},showWatchingConfigFieldConditionByType:function(b){for(var a=0;
a<this.watchingConfigConditionItems.length;
a++){this.getForm().findField(this.watchingConfigConditionItems[a]).showIf(b==(a+1))
}},evWatchingConfigGridSelection:function(a){var b=this.findC("_btnId","modifyWatchingConfig");
if(b){b.enableIf(a&&a.length)
}if(a&&a.length){this.loadWatchingConfig(a[0])
}},getConfigData:function(){var d={};
for(var c=0;
c<this.headFields.length;
c++){var h=this.getForm().findField(this.headFields[c]);
if(h){d[this.headFields[c]]=h.getValue()
}}var f=[];
var b=this.watchingConfigGrid.store;
var g=this;
b.each(function(k){var m={};
for(var l=0;
l<g.watchingConfigAllItems.length;
l++){m[g.watchingConfigAllItems[l]]=k.data[g.watchingConfigAllItems[l]]
}f.push(m)
});
var a={head:d,watchingConfigTable:f};
if(d.filter_type){a.filter=this.getFilterConfig(d.filter_type)
}return(a)
},setConfigData:function(a){var c={};
if(a.head){for(var b=0;
b<this.headFields.length;
b++){var d=this.getForm().findField(this.headFields[b]);
if(d){d.setValue(a.head[this.headFields[b]])
}}this.evSelectFilterType(a.head.filter_type)
}if(a.watchingConfigTable){this.watchingConfigGrid.store.removeAll();
for(var b=0;
b<a.watchingConfigTable.length;
b++){this.watchingConfigGrid.store.add(a.watchingConfigTable[b])
}}if(a.filter&&a.head&&a.head.filter_type){this.setFilterConfig(a.head.filter_type,a.filter)
}},getFilterConfig:function(a){filterConfig={};
switch(a){case 1:Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"common"));
Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"rtp"));
if(window.existsDscpCdr){Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"dscp"))
}Ext.apply(filterConfig,CDR.Filter.fetchValuesFromFieldset(this,"filters_comb"));
break;
case 2:Ext.apply(filterConfig,Message.Filter.fetchValuesFromFieldset(this));
break;
case 3:Ext.apply(filterConfig,HTTP.Filter.fetchValuesFromFieldset(this));
break
}return(filterConfig)
},setFilterConfig:function(a,b){switch(a){case 1:CDR.Filter.setValueFieldsFieldset(b,this,"common");
CDR.Filter.setValueFieldsFieldset(b,this,"rtp");
if(window.existsDscpCdr){CDR.Filter.setValueFieldsFieldset(b,this,"dscp")
}CDR.Filter.setValueFieldsFieldset(b,this,"filters_comb");
break;
case 2:Message.Filter.setValueFieldsFieldset(b,this);
break;
case 3:HTTP.Filter.setValueFieldsFieldset(b,this);
break
}},onOk:function(){var a=this.getConfigData();
if(this.evOk){this.evOk.call(this.evOkScope,a)
}this._window.close()
}});
Ext.define("SvgPaint.SetWatchingItem.Form.Window",{extend:"Ext.Window",subsystem:"svg_paint",constructor:function(a){var b=new SvgPaint.SetWatchingItem.Form(Ext.apply({_window:this},a));
a=Ext.applyIf(a||{},{layout:"fit",border:false,resizable:false,items:b,title:this.findLangS("title","setWatching"),modal:true,height:Math.min(900,Ext.dom.Element.getViewportHeight()-40),listeners:{scope:this,activate:function(){if(this._activated){return
}if(this.maskEl){this.maskEl.unmask()
}if(this.config.data){this.maskLoad();
Ext.defer(function(){b.setConfigData(this.config.data);
this.unmask()
},10,this)
}this._activated=true
},close:function(){if(this.hideEl){this.hideEl.show()
}}}});
this.callParent([a]);
this.show()
}});
Ext.define("SvgPaint.SetChartItem.Form",{extend:"Ext.form.Panel",subsystem:"svg_paint",constructor:function(d){this.headFields=["chart_interval","refresh_period","interval_offset"];
var g=16;
var f="last_60minutes";
var b=[{xtype:"ComboBoxA",name:"chart_interval",value:f,fieldLabel:this.findLangS("field","chart_interval"),aData:this.getTimeIntervalsData(),labelWidth:__width_FieldChar(g),width:__width_FormChar(50,g),allowBlank:false,listeners:{scope:this,select:a},_tpl:"{descr}"},{xtype:"container",layout:"hbox",items:[{xtype:"numberfield",name:"refresh_period",value:this.getDefaultRefreshPeriod(f),minValue:1,fieldLabel:this.findLangS("field","refresh_period"),labelWidth:__width_FieldChar(g),width:__width_FormChar(6,g),style:{marginRight:2}},{xtype:"displayfield",value:"["+lang.secondShort2+"]"},{xtype:"numberfield",name:"interval_offset",minValue:0,fieldLabel:this.findLangS("field","interval_offset"),labelWidth:__width_FieldChar(12),width:__width_FormChar(6,12),style:{marginLeft:20,marginRight:2}},{xtype:"displayfield",value:"["+lang.secondShort2+"]"}],style:{marginBottom:__height_FieldSeparator}}];
this.chartConfigForm=new CDR.Chart.ConfigForm({chartConfig:{},disableCreateWindow:true,disableShowWindow:true,disableSaveCancelFormButtons:true,disableSaveDeleteChartButtons:true,disableChartTitle:true,dashboardConfig:true,frame:false,_typeChart:d.data&&d.data.chartConfig&&d.data.chartConfig._typeChart||d._typeChart});
var c=CDR.Filter.getWidthForm();
Ext.applyIf(d,{layout:{type:"vbox",align:"stretch"},frame:true,border:false,items:[{xtype:"panel",items:b,border:false,bodyStyle:{"background-color":__color_FormBackground}},{height:6,border:false,bodyStyle:{"background-color":__color_FormBackground}},this.chartConfigForm,{xtype:"box",autoEl:{tag:"hr",color:__color_FieldBorder,size:1,style:{marginTop:2,marginBottom:4}}},{layout:{type:"vbox",align:"center"},items:{xtype:"button",iconCls:"icon_ok",text:lang.okButtonText,handler:this.onOk,scope:this},border:false,bodyStyle:{"background-color":__color_FormBackground,padding:2}}],width:c+__width_Scroller+4+8,autoScroll:true});
this.callParent([d]);
function a(){var h=this.getForm().findField("chart_interval").getValue();
var k=this.getForm().findField("refresh_period");
if(k){k.setValue(this.getDefaultRefreshPeriod(h))
}}},getConfigData:function(){var b={};
for(var a=0;
a<this.headFields.length;
a++){var c=this.getForm().findField(this.headFields[a]);
if(c){b[this.headFields[a]]=c.getValue()
}}return({head:b,chartConfig:this.chartConfigForm.getChartConfig()})
},setConfigData:function(a){var c={};
if(a.head){for(var b=0;
b<this.headFields.length;
b++){var d=this.getForm().findField(this.headFields[b]);
if(d){d.setValue(a.head[this.headFields[b]])
}}}if(a.chartConfig){this.chartConfigForm.setChartConfigFields(a.chartConfig)
}},onOk:function(){var b=this.getConfigData();
if(this.chartConfigForm&&b.chartConfig){var a=this.chartConfigForm.checkErrorInChartConfig(b.chartConfig);
if(a){Ext.Msg.alert(lang.error,a);
return
}}if(this.evOk){this.evOk.call(this.evOkScope,b)
}this._window.close()
},getTimeIntervalsData:function(){return(arDashboardTimeIntervals)
},getDefaultRefreshPeriod:function(a){return(getDataArrayItem(this.getTimeIntervalsData(),a,0,6))
}});
Ext.define("SvgPaint.SetChartItem.Form.Window",{extend:"Ext.Window",subsystem:"svg_paint",constructor:function(a){var b=new SvgPaint.SetChartItem.Form(Ext.apply({_window:this},a));
a=Ext.applyIf(a||{},{layout:"fit",border:false,resizable:false,items:b,title:this.findLangS("title","setChart"),modal:true,height:Math.min(900,Ext.dom.Element.getViewportHeight()-40),listeners:{scope:this,beforeactivate:function(){},activate:function(){if(this._activated){return
}if(this.maskEl){this.maskEl.unmask()
}if(this.config.data){this.maskLoad();
Ext.defer(function(){b.setConfigData(this.config.data);
this.unmask()
},10,this)
}this._activated=true
},close:function(){if(this.hideEl){this.hideEl.show()
}}}});
this.callParent([a]);
this.show()
}});
Ext.define("SvgPaint.Tools",{extend:"Ext.Panel",subsystem:"svg_paint",constructor:function(a){this.toolsIcons=new SvgPaint.Tools.Icons({painter:a&&a.painter,flex:1,enableDrag:true});
a=Ext.applyIf(a||{},{layout:"fit",border:false,items:{layout:{type:"vbox",align:"stretch"},items:[{xtype:"button",text:this.findLangS("button","newText"),handler:function(){this.painter.addText([100,100],this.findLangS("text","new_text"))
},scope:this,style:{marginTop:5,marginLeft:5,marginRight:5},listeners:{scope:this,render:this.onRenderBtnNewText}},{xtype:"button",text:this.findLangS("button","newLink"),handler:this.newLink,scope:this,style:{marginTop:4,marginLeft:5,marginRight:5}},{xtype:"button",text:this.findLangS("button","newChart"),handler:function(){this.painter.addChart([100,100],{text:this.findLangS("text","new_chart")})
},scope:this,style:{marginTop:4,marginBottom:5,marginLeft:5,marginRight:5},listeners:{scope:this,render:this.onRenderBtnNewChart}},this.toolsIcons],border:false}});
this.callParent([a])
},onRenderBtnNewText:function(a){var b=this;
new Ext.dd.DragZone(a.getEl(),{btn:a,getDragData:function(c){b.painter.clearIndikSelect();
return{ddel:this.btn.getEl().down("span").dom,typeItem:"text",text:findLangS(b.subsystem,"text","new_text")}
}})
},onRenderBtnNewChart:function(a){var b=this;
new Ext.dd.DragZone(a.getEl(),{btn:a,getDragData:function(c){b.painter.clearIndikSelect();
return{ddel:this.btn.getEl().down("span").dom,typeItem:"chart",chartData:{text:findLangS(b.subsystem,"text","new_chart")}}
}})
},newLink:function(){if(this.newLinkForm){return
}this.painter.startModeForSelectItemsForNewLink(this);
var b=__width_FormChar(35,10);
var a=__width_FieldChar(10);
this.newLinkForm=new Ext.form.Panel({frame:true,border:false,defaultType:"displayfield",items:[{value:this.findLangS("text","selectTwoItemsForNewLink"),hideLabel:true,width:b,fieldStyle:{"font-style":"italic","font-size":"90%"}},{fieldLabel:this.findLangS("field","item_1"),name:"item_1",width:b,labelWidth:a},{fieldLabel:this.findLangS("field","item_2"),name:"item_2",width:b,labelWidth:a}],buttons:[{text:this.findLangS("button","addLink"),iconCls:"icon_add",handler:this.newLinkAdd,scope:this,_btnId:"addLink",disabled:true},{text:this.findLangS("button","cancel"),handler:function(){this.newLinkWindow.close()
},scope:this}],listeners:{scope:this,destroy:function(){this.newLinkCancel()
}}});
this.newLinkWindow=new Ext.Window({layout:"fit",items:this.newLinkForm,title:this.findLangS("title","addNewLink"),border:false});
this.newLinkWindow.show();
this.moveToRightBottomInPainter(this.newLinkWindow,true)
},newLinkAdd:function(){this.newLinkWindow.close();
this.painter.addLineFromItemsForLine()
},newLinkCancel:function(){if(this.newLinkForm){this.painter.endModeForSelectItemsForNewLink();
this.newLinkForm=null;
this.newLinkWindow=null
}},ev_selectItemsForLink:function(b){this.newLinkForm.getDockedItems()[0].findC("_btnId","addLink").enableIf(b&&b.length==2);
for(var c=0;
c<2;
c++){var d=this.newLinkForm.getForm().findField("item_"+(c+1));
if(d){var a=b&&b.length>c?b[c].getText():null;
d.setValue(a)
}}},moveToRightBottomInPainter:function(d,a){var g=getAbsolutePosition(this.painter.body.dom);
var f=this.painter.getSize();
var c=d.getSize();
var b=[g[0]+f.width-c.width-3,g[1]+f.height-c.height-3];
if(a){d.setPositionAnimate(b,1,10)
}else{d.setPosition(b)
}},evResizePainter:function(){if(this.newLinkWindow){this.moveToRightBottomInPainter(this.newLinkWindow,false)
}},deactivate:function(){if(this.newLinkWindow){this.newLinkWindow.close()
}}});
Ext.define("SvgPaint.Tools.Icons",{extend:"Ext.Panel",subsystem:"svg_paint",constructor:function(a){this.iconsStore=new SvgPaint.Icons.Store;
this.iconsGrid=new Ext.grid.GridPanel({store:this.iconsStore,columns:[{dataIndex:"name",align:"center",flex:1,renderer:function(h,b,c,l,f,d){var k=c.data.width;
var g=c.data.height;
if(k&&g){while(k>70||g>70){k=roundNumber(k/2);
g=roundNumber(g/2)
}}return('<table style="width: 100%"><tr><td style="text-align:center;"><img src="'+c.data.url+'"'+(k&&g?' width="'+k+'px" height="'+g+'px"':"")+' draggable="false"><tr><td style="text-align:center; font: '+__font_Grid+';">'+h+"</table>")
}}],viewConfig:{stripeRows:false},hideHeaders:true,border:false,listeners:{scope:this,celldblclick:function(f,l,c,b,g,k,h,d){this.painter.addIcon([100,100],b.data)
},afterrender:this.onRenderIconsGrid}});
a=Ext.applyIf(a||{},{layout:"fit",items:this.iconsGrid,border:false,listeners:{scope:this,afterrender:function(){this.iconsStore.load()
}}});
this.callParent([a])
},onRenderIconsGrid:function(){if(this.config.enableDrag){new Ext.dd.DragZone(this.iconsGrid.view.getEl(),{grid:this.iconsGrid,getDragData:function(c){this.grid.ownerCt.painter.clearIndikSelect();
var b=c.getTarget(this.grid.view.itemSelector);
var a=this.grid.view.getRecord(b);
if(b&&a){this.grid.selModel.select(a);
return({ddel:b,typeItem:"icon_with_text",iconData:a.data})
}return(false)
}})
}}});
Ext.define("SvgPaint.Icons.Store",{extend:"Ext.data.Store",constructor:function(b){var a="iconsModel";
if(!Ext.ClassManager.isCreated(a)){Ext.define(a,{extend:"Ext.data.Model",fields:[{name:"name"},{name:"extension"},{name:"dir"},{name:"url"},{name:"width",type:"integer"},{name:"height",type:"integer"}]})
}b=Ext.applyIf(b||{},{model:a,proxy:{type:"ajax",url:"php/model/utilities.php",actionMethods:"POST",extraParams:{task:"loadImages",params:Ext.encode({type:"network_topology"})},reader:{rootProperty:"results",totalProperty:"total",idProperty:"name"}},sorters:{property:"name",direction:"asc"},remoteSort:false});
this.callParent([b])
}});
Ext.define("SvgPaint.PainterWithTools",{extend:"Ext.Panel",subsystem:"svg_paint",constructor:function(b){this.painter=new SvgPaint.Painter({region:"center",paintPanel:b&&b.paintPanel,configPaintPanel:b&&b.configPaintPanel});
if(this.painter.enableEdit()){this.painterTools=new SvgPaint.Tools({painter:this.painter,region:"east",split:true,width:150})
}this.toolBar=new SvgPaint.Painter.ToolBar({painter:this.painter});
this.painter.toolBar=this.toolBar;
if(this.painterTools){this.painter.iconsStore=this.painterTools.toolsIcons.iconsStore;
this.painter.painterTools=this.painterTools
}var a=[this.painter];
if(this.painterTools){a.push(this.painterTools)
}b=Ext.applyIf(b||{},{layout:"border",tbar:this.toolBar.getToolBar(),items:a,border:false,listeners:{scope:this,afterrender:function(){if(this.painter.disableForShare()){this.toolBar.loadPaints()
}}}});
this.callParent([b])
},deactivate:function(){this.painter.deactivate();
if(this.painterTools){this.painterTools.deactivate()
}}});
Ext.define("SvgPaint.Painter.ToolBar",{subsystem:"svg_paint",constructor:function(a){Ext.applyIf(this,a)
},getToolBar:function(){var a=this;
if(!this.painter.disableForShare()){this.comboPaints=new Ext.ux.combobox.ComboBoxA({name:"paints",_tpl:"{textMenu}",width:__width_ColumnChar(45),aData:{data:[],fields:["id","name","user_id","user_name","textMenu","config","priv","user_ids","group_ids"]},listeners:{scope:this,select:function(d){this.setPaintHandler(d.getValue())
},afterrender:function(d){if(this.painter.configPaintPanel&&this.painter.configPaintPanel.svgPaints&&this.painter.configPaintPanel.svgPaints.length){this.fillStorePaints(this.painter.configPaintPanel.svgPaints);
d.enable();
d.setValue(d.store.getAt(0));
Ext.defer(function(){this.setPaintHandler(d.getValue())
},500,this)
}else{d.disable();
this.loadPaints()
}}},disabled:true,onTriggerClick:function(){this.expand();
if(a.painter.enableEdit()){ajaxSafeRequest({scope:a,url:"php/model/utilities.php",params:{task:"getSvgPaints"},success:function(d){this.comboPaints.store.removeAll();
this.fillStorePaints(d.svgPaints)
}})
}}})
}if(this.painter.enableEdit()){this.btnNewPaint=new Ext.Button({iconCls:"icon_page",text:this.findLangS("button","newPaint"),handler:this.toolBarHandler,scope:this,disabled:true,_btnId:"newPaint"})
}this.scale=new Ext.form.field.Number({value:100,minValue:25,maxValue:100,step:5,width:__width_FieldNum(3)+__width_Trigger,listeners:{scope:this,select:function(d){var f=d.getValue();
if(f>=25&&f<=100){this.setScale(f)
}},change:function(d){var f=d.getValue();
if(f>=25&&f<=100){this.setScale(f)
}}}});
if(this.painter.enableEdit()){this.btnMultipleSelect=new Ext.Button({iconCls:"icon_table_multiple",text:this.findLangS("button","multipleSelect"),enableToggle:true,toggleHandler:this.multipleSelectHandler,scope:this,disabled:true,_btnId:"multipleSelect"});
this.btnSavePaint=new Ext.Button({iconCls:"icon_save",text:this.findLangS("button","savePaint"),handler:this.toolBarHandler,scope:this,disabled:true,_btnId:"savePaint"});
this.btnDeletePaint=new Ext.Button({iconCls:"icon_delete",text:this.findLangS("button","deletePaint"),handler:this.toolBarHandler,scope:this,disabled:true,_btnId:"deletePaint"})
}if(!this.painter.disableForShare()){var b=[];
if(user_can_cdr_share_local_private()){b.push({text:this.findLangS("menu","classicNMUrl"),_btnId:"self_login_link"})
}if(user_can_cdr_share_local_public()){b.push({text:this.findLangS("menu","shareNMUrl"),_btnId:"self_protected_link"})
}if(b.length){this.btnUrlPaint=new Ext.Button({iconCls:"icon_link",text:this.findLangS("button","urlPaint"),tooltip:this.findLangS("button_help","urlPaint"),scope:this,disabled:true,menu:{defaults:{scope:this,handler:this.toolBarHandler},items:b}})
}}this.btnExportAs=new Ext.Button({iconCls:"icon_save2_black",text:this.findLangS("button","exportAs"),scope:this,disabled:true,menu:{defaults:{scope:this,handler:this.exportAsHandler},items:[{iconCls:"icon_save2_black",text:this.findLangS("menu","exportAsSvg"),_menuId:"export_as_svg"},{iconCls:"icon_save2_pdf",text:this.findLangS("menu","exportAsPdf"),_menuId:"export_as_pdf"}]}});
if(!this.painter.disableForShare()){this.btnStartStopWatching=new Ext.Button({iconCls:"icon_rec_play",text:this.findLangS("button","startWatching"),handler:this.startStopWatchingHandler,scope:this,disabled:true,_btnId:"startStopWatching"})
}var c=[];
if(this.btnNewPaint){c.push(this.btnNewPaint)
}if(this.scale){c.push(this.findLangS("button","scale")+":",this.scale)
}if(this.btnMultipleSelect){c.push(this.btnMultipleSelect)
}if(this.comboPaints){if(c.length){c.push("-")
}c.push({xtype:"displayfield",value:this.findLangS("button","selectPaint")+":",fieldCls:"x-form-item-label",fieldStyle:{paddingTop:0,marginTop:-1,marginLeft:4,color:"#333"}},this.comboPaints)
}if(this.btnSavePaint){c.push(this.btnSavePaint)
}if(this.btnDeletePaint){c.push(this.btnDeletePaint)
}if(this.btnUrlPaint){c.push(this.btnUrlPaint)
}if(this.btnExportAs){if(c.length){c.push("-")
}c.push(this.btnExportAs)
}if(this.btnStartStopWatching){if(c.length){c.push("-")
}c.push(this.btnStartStopWatching)
}return(c)
},toolBarHandler:function(a){switch(a._btnId){case"newPaint":this.painter.clear(true,true);
break;
case"savePaint":this.savePaint();
break;
case"deletePaint":this.deletePaint();
break;
case"self_login_link":case"self_protected_link":this.urlPaint(a._btnId);
break
}},startStopWatchingHandler:function(a){if(this.painter.isModeWatching()){this.painter.endModeWatching();
a.setIconCls("icon_rec_play");
a.setText(this.findLangS("button","startWatching"))
}else{this.painter.startModeWatching();
a.setIconCls("icon_rec_stop");
a.setText(this.findLangS("button","stopWatching"))
}this.autoEnableButtons()
},multipleSelectHandler:function(a,b){if(b){this.painter.startModeMultipleSelect()
}else{this.painter.endModeMultipleSelect()
}},exportAsHandler:function(b){this.painter.clearAllSelect();
var a=this.comboPaints?this.comboPaints.getRawValue():this.selectPaintData?this.selectPaintData.name:null;
if(a&&a.match(/\ \*$/)){a=a.substr(0,a.length-2)
}var c={chartConfigData:{_title:"svg paint"+(a?" - "+a:"")},svg:this.painter.getSvg(),saveType:b._menuId=="export_as_svg"?"svg":"pdf"};
ajaxSafeRequest({url:"php/reports/charts.php",params:{task:"testSaveChart",params:Ext.encode(c)},success:function(d){formPostSafe("php/reports/charts.php","POST",{task:"saveChart",params:Ext.encode(c)})
},scope:this,maskEl:this.painter})
},setPaintHandler:function(a){this._onChangePaint_disable=true;
var c=null;
if(this.comboPaints){var b=this.comboPaints.findRecordByValue(a);
if(b){c=Ext.decode(b.data.config)
}}else{if(this.selectPaintData){c=Ext.decode(this.selectPaintData.config)
}}if(c){this.painter.loadSvgPaint(c);
this.autoEnableButtons();
this.lastPaintData=null;
this._onChangePaint_disable=false
}},loadPaints:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getSvgPaints",id:window.svg_paint_id},success:function(a){if(this.fillStorePaints(a.svgPaints)&&this.comboPaints){this.comboPaints.enable()
}}})
},fillStorePaints:function(c){var b=false;
if(c){for(var a=0;
a<c.length;
a++){if(this.comboPaints&&!this.comboPaints.store.getById(c[a].id*1)){this.addPaint(c[a])
}if(window.svg_paint_id?window.svg_paint_id==c[a].id:window.svg_paint==c[a].name){b=c[a].id*1;
this.selectPaintData=c[a];
delete window.svg_paint;
delete window.svg_paint_id
}}if(b){Ext.defer(function(){if(this.comboPaints){this.comboPaints.setValue(b)
}this.setPaintHandler(b);
if(window.start_watching){this.painter.startModeWatching()
}if(window.hidemenu){Ext.getCmp("main-left-panel").collapse()
}},100,this)
}return(c.length)
}return(false)
},addPaint:function(f,c,a,d){var d=0;
for(var b=0;
b<this.comboPaints.store.getCount();
b++){if(this.comboPaints.store.getAt(b).data.name<=f.name){++d
}else{break
}}this.comboPaints.addMenuItem({id:f.id*1,name:f.name,user_id:f.user_id*1,user_name:f.user_name,textMenu:(c?'<span style="color: green;">':"")+f.name+(f.user_name?'<span style="font-size: 70%;"> / '+f.user_name+"</span>":"")+(c?"</span>":""),config:f.config,priv:f.priv*1,user_ids:f.user_ids,group_ids:f.group_ids},a,false,d)
},savePaint:function(b){if(!user_is_admin()&&!Ext.isDefined(b)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCountOtherUsersInGroup"},success:function(l){this.savePaint(l.count)
}});
return
}var d=this.comboPaints.getValue();
var g=this.comboPaints.findRecordByValue(d);
var a={};
if(d&&g){a={name:g.data.name,priv:g.data.priv,user_ids:g.data.user_ids,group_ids:g.data.group_ids}
}else{if(this.lastPaintData){a={name:this.lastPaintData.name,priv:this.lastPaintData.priv,user_ids:this.lastPaintData.user_ids,group_ids:this.lastPaintData.group_ids}
}}var c=[{xtype:"textfield",name:"name",fieldLabel:this.findLangS("field","paintName"),value:a.name,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),disabled:d&&g,allowBlank:false},{xtype:"checkbox",name:"priv",fieldLabel:this.findLangS("field","privatePaint"),checked:a.priv,labelWidth:__width_FieldChar(15),listeners:{change:function(n){var l=n.getValue();
var o=k.getForm().findField("user_ids");
if(o){o.enableIf(!l)
}var m=k.getForm().findField("group_ids");
if(m){m.enableIf(!l)
}}}}];
if(user_is_admin()||b){c.push({xtype:"ComboBoxX",name:"user_ids",fieldLabel:this.findLangS("field","showForUsers"),value:a.user_ids,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"user_list",recordStruct:rsUserList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,disabled:a.priv,_autoDisableIfEmpty:true})
}if(user_is_admin()){c.push({xtype:"ComboBoxX",name:"group_ids",fieldLabel:this.findLangS("field","showForGroups"),value:a.group_ids,width:__width_FormChar(15,30),labelWidth:__width_FieldChar(15),valueField:"id",displayField:"name",url:"php/model/sql.php",module:"group_list",recordStruct:rsGroupList,sortField:"name",columns:[{fields:"name",widthCh:30}],_clearButton:true,_multiSelect2:true,editable:false,disabled:a.priv,_autoDisableIfEmpty:true})
}var k=new Ext.FormPanel({frame:true,border:false,items:c,buttons:[{text:this.findLangS("button","save"),iconCls:"icon_save",handler:f,scope:this},{text:this.findLangS("button","cancel"),iconCls:"icon_cancel",handler:function(){k.destroyWindow()
},scope:this}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",k.el,{enter:f,scope:this})
}}});
var h=new Ext.Window({layout:"fit",items:k,border:false,title:this.findLangS("title",d&&g?"editPaint":"savePaint"),modal:true,closable:true,listeners:{scope:this,activate:function(){k.getForm().findField("name").focus(false,200)
}}});
h.show();
function f(){if(k.getForm().isValid()){var o=["name","priv","user_ids","group_ids"];
var m={};
for(var l=0;
l<o.length;
l++){var n=k.getForm().findField(o[l]);
if(n){m[o[l]]=n.getValue()
}}this.savePaintAjax(m,d>0,d,k,this.painter.getSvgPaintForSave())
}}},savePaintAjax:function(a,c,g,f,d){var b=arguments;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({id:g,subsystem:"svg_paints",name:a.name,user_id:user_id(),priv:a.priv,user_ids:a.user_ids,group_ids:a.group_ids,config:Ext.encode(d),enableUpdate:c,enableGzip:true})},success:function(h){var k=h.id;
this.addPaint(h.row,true,true);
this.comboPaints.enable();
this.comboPaints.setValue(k);
this.autoEnableButtons();
if(f){f.destroyWindow()
}},error:function(k,h){if(k.error=="name_duplication"){Ext.Msg.confirm("",this.findLangS("text","nameIsUsed_OverwriteQuestion"),function(l){if(l=="yes"){var m=b;
m[1]=true;
this.savePaintAjax.apply(this,m)
}else{if(f){f.destroyWindow()
}}},this)
}else{alertAjaxError(h)
}},failure:function(){if(f){f.getEl().unmask()
}else{this.getEl().unmask()
}},maskEl:f||this})
},deletePaint:function(){var a=this.comboPaints.getValue();
var b=this.comboPaints.findRecordByValue(a);
Ext.Msg.confirm("",this.findLangS("text","deletePaintQuestion"),function(c){if(c=="yes"){this.lastPaintData=null;
this.deletePaintAjax(b.data.id)
}},this)
},deletePaintAjax:function(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"deleteTemplate",params:Ext.encode({id:a})},success:function(b){this.comboPaints.deleteMenuItem(a);
this.comboPaints.setValue(null);
if(!this.comboPaints.store.getCount()){this.comboPaints.disable()
}this.autoEnableButtons()
}})
},urlPaint:function(b,d){var a=this.comboPaints.getValue();
var c=this.comboPaints.findRecordByValue(a);
if(!a||!c){return
}if(!d){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"shareNetworkMap",params:Ext.encode({subType:b,id:a})},success:function(g){if(g.link){this.urlPaint(b,g.link)
}},scope:this});
return
}switch(b){case"self_protected_link":break;
case"self_login_link":d+="?svg_paint="+encodeURIComponent(c.data.name)+"&start_watching=1&hidemenu=1"
}var f='<table style="font: '+__font_Grid+'; table-layout: fixed;"><col width="400"><col width="100"><tr><td style="padding: 3;"><div style="width: 400; word-wrap: break-word; white-space: normal;"><a href="'+d+'" target="_blank">'+d+'</a></div></td><td style="padding: 3;"><div style="width: 100; height: 22;"><div id="copy_button_div" style="height: 18;"/>';
"</div></td><tr></table>";
Ext.Msg.alert(findLangS(this.subsystem,"title","viewUrl"),f,function(){var g=Ext.getCmp("copy_button");
if(g){g.destroy()
}});
new cClipboardButton({text:lang.clipboard.copyTo,getClipText:function(g){return(g.clipboardText)
},getClipTextParams:{clipboardText:d},id:"copy_button",renderTo:"copy_button_div"})
},autoEnableButtons:function(d){var c=this.painter.itemsContainer.items.length>0;
var a=null;
var b=null;
if(this.comboPaints){a=this.comboPaints.getValue();
b=this.comboPaints.findRecordByValue(a);
if(b===false){a=null
}if(d&&this.painter.enableEdit()&&a&&b&&b.data){this.lastPaintData=b.data;
this.comboPaints.setValue(null);
if(this.lastPaintData.name){this.comboPaints.setRawValue(this.lastPaintData.name+" *")
}a=null;
b=null
}}if(this.btnNewPaint){this.btnNewPaint.enableIf(!this.painter.isModeWatching()&&c)
}if(this.comboPaints){this.comboPaints.enableIf(!this.painter.isModeWatching()&&this.comboPaints.store.getCount())
}if(this.btnMultipleSelect){this.btnMultipleSelect.enableIf(!this.painter.isModeWatching()&&!this.painter.isModeForSelectItemsForNewLink()&&c)
}if(this.btnSavePaint){this.btnSavePaint.enableIf(!this.painter.isModeWatching()&&c&&(!b||!b.data||(!b.data.user_id||user_is_admin()||user_can_edit_all_templates()||b.data.user_id==user_id())));
this.btnSavePaint.setText(this.findLangS("button",b?"editPaint":"savePaint"));
this.btnSavePaint.setIconCls(b?"icon_edit":"icon_save")
}if(this.btnDeletePaint){this.btnDeletePaint.enableIf(!this.painter.isModeWatching()&&a&&b&&b.data&&(user_is_admin()||user_can_delete_all_templates()||user_id()==b.data.user_id))
}if(this.btnUrlPaint){this.btnUrlPaint.enableIf(a&&b&&b.data)
}if(this.btnExportAs){this.btnExportAs.enableIf(c)
}if(this.btnStartStopWatching){this.btnStartStopWatching.enableIf(c)
}},onClearPaint:function(){this.lastPaintData=null;
if(this.comboPaints){this.comboPaints.setValue(null)
}this.autoEnableButtons()
},onChangePaint:function(){if(this._onChangePaint_disable){return
}this.autoEnableButtons(true)
},setScale:function(a){this.painter.setScale(a)
},onStartModeWatching:function(){if(!this.painter.disableForShare()){this.btnStartStopWatching.setIconCls("icon_rec_stop");
this.btnStartStopWatching.setText(this.findLangS("button","stopWatching"));
this.autoEnableButtons()
}},onStartModeMultipleSelect:function(){this.btnMultipleSelect.toggle(true)
},onEndModeMultipleSelect:function(){this.btnMultipleSelect.toggle(false)
},findLangS:function(a,b){return(findLangS(this.subsystem,a,b))
}});
Ext.define("SvgPaint.Tools.MultipleSelectForm",{extend:"Ext.form.Panel",subsystem:"svg_paint",constructor:function(a){var c=__width_FormChar(30,15);
var b=__width_FieldChar(15);
a=Ext.applyIf(a||{},{frame:true,border:false,defaultType:"displayfield",items:[{value:this.findLangS("text","multipleSelectInformation"),hideLabel:true,width:c,fieldStyle:{"font-style":"italic","font-size":"90%"}},{fieldLabel:this.findLangS("field","selected_items"),name:"selected_items",value:0,width:c,labelWidth:b}],buttons:[{text:this.findLangS("button","selectAll"),handler:this.selectAll,scope:this},{text:this.findLangS("button","unselectAll"),handler:this.unselectAll,scope:this},{text:this.findLangS("button","close"),handler:function(){this.closeWindow()
},scope:this}],listeners:{scope:this,destroy:function(){this.closeWindow()
}}});
this.callParent([a]);
if(a.autoCreateWindow){this.createWindow()
}},selectAll:function(){this.painter.selectAllMultipleSelect()
},unselectAll:function(){this.painter.unselectAllMultipleSelect()
},createWindow:function(){this.window=new Ext.Window({layout:"fit",items:this,title:this.findLangS("title","multipleSelect"),border:false});
this.window.show();
this.moveToRightBottomInPainter(this.window,!this.disableAnimateWindow)
},closeWindow:function(){if(!this.window){return
}this.window.close();
if(this.painter){this.painter.endModeMultipleSelect()
}},setSelectedItems:function(a){this.getForm().findField("selected_items").setValue(a||0)
},moveToRightBottomInPainter:function(d,a){var g=getAbsolutePosition(this.painter.body.dom);
var f=this.painter.getSize();
var c=d.getSize();
var b=[g[0]+f.width-c.width-3,g[1]+f.height-c.height-3];
if(a){d.setPositionAnimate(b,1,10)
}else{d.setPosition(b)
}},evResizePainter:function(){if(this.window){this.moveToRightBottomInPainter(this.window,false)
}}});
Ext.define("SvgPaint.Panel",{extend:"Ext.ux.grid.Panel",alias:"widget.SvgPaintPanelX",subsystem:"svg_paint",constructor:function(a){this.painterWithTools=new SvgPaint.PainterWithTools({paintPanel:this,configPaintPanel:a});
a=Ext.applyIf(a||{},{id:"SvgPaint-panel"+(a&&a.id_autosuffix?"_"+SvgPaint.SingletonTools.getPainterPanelIdNumber():""),layout:"fit",items:this.painterWithTools,titleLang:"panel",iconCls:"icon_computers"});
this.callParent([a])
},reactivate:function(){this.painterWithTools.toolBar.loadPaints()
},deactivate:function(){this.painterWithTools.deactivate()
},createNewPaintFromData:function(a){if(!this.painterWithTools.painterTools.toolsIcons.iconsStore.getCount()){Ext.defer(function(){this.createNewPaintFromData(a)
},250,this);
return
}this.painterWithTools.painter.createNewPaintFromData(cloneObject(a))
}});
Ext.define("SvgPaint.SingletonTools",{singleton:true,subsystem:"svg_paint",painterPanelIdNumber:1,svgPainterIdNumber:1,getSvgPainterIdNumber:function(){return(this.svgPainterIdNumber++)
},getPainterPanelIdNumber:function(){return(this.painterPanelIdNumber++)
}});
Ext.ns("GMap");
Ext.define("GMap.Panel",{extend:"Ext.Panel",subsystem:"gmap",subsystem_gmap_api_key:"gmap_api_key",statics:{map_id:0},zoom_default:7,zoom_detail:15,cache_markers_size:{},constructor:function(b){++GMap.Panel.map_id;
var g=[];
if(b&&b.switchMarkers){for(var d=0;
d<b.switchMarkers.length;
d++){if(b.controlMarkersIfPos&&b.controlMarkersIfPos.isIn(b.switchMarkers[d])){var c=false;
if(b.pos){for(var a=0;
a<b.pos.length;
a++){if(this.getPosMainType(b.pos[a].posType)==b.switchMarkers[d]){c=true;
break
}}}if(!c){continue
}}g.push({text:this.findLangS("marker",b.switchMarkers[d]),enableToggle:true,toggleHandler:this.switchMarkers,pressed:b.initMarkers&&b.initMarkers.isIn(b.switchMarkers[d]),scope:this,_typeMarkers:b.switchMarkers[d],height:19,innerStyle:{marginTop:-3},disabled:b.initDisabledMarkers&&b.initDisabledMarkers.isIn(b.switchMarkers[d])});
if(b.selectProvMarkers&&b.selectProvMarkers.inArray(b.switchMarkers[d])){var f=null;
if(b.pos){for(var a=0;
a<b.pos.length;
a++){if(this.getPosMainType(b.pos[a].posType)==b.switchMarkers[d]){f=b.pos[a].pos.prov
}}}g.push({xtype:"ComboBoxA",name:"prov_"+b.switchMarkers[d],value:f,editable:false,aData:{data:b["prov_"+b.switchMarkers[d]]?b["prov_"+b.switchMarkers[d]]:[],fields:["id","descr","portal_name","portal_url","key_portal_url","key_config","user_id_config"]},width:__width_ColumnChar(40),listeners:{scope:this,select:this.changeProvMarkers},_stringValue:true,_buttonGroup:true,_typeSelectProvMarkers:b.switchMarkers[d],disabled:b.initDisabledMarkers&&b.initDisabledMarkers.isIn(b.switchMarkers[d])});
g.push("-")
}}if(g[g.length-1]!=="-"){g.push("-")
}}if(g.length){g.push({text:this.findLangS("tbar","centerMarkers"),handler:this.centerMarkers,scope:this,_menuId:"center_markers",height:19,innerStyle:{marginTop:-3}})
}if(!window.isCloud&&user_is_admin()&&!(b&&b.disableLoadGeoipData)){g.push({text:this.findLangS("tbar","loadGeoipData"),handler:this.loadGeoipData,scope:this,height:19,innerStyle:{marginTop:-3}})
}b=Ext.applyIf(b||{},{type_map:this.getTypeMapDefault(),pos:[],title:b&&b.disableTitle?undefined:this.findLangS("title","map"),iconCls:b&&b.disableIcon?undefined:"icon_google_maps",layout:"fit",items:{xtype:"panel",border:false},tbar:g.length?g:undefined,listeners:{scope:this,afterrender:function(){if(this.onAfterRender){this.onAfterRender()
}this.checkMapSrc_counter=0;
this.checkMapSrc()
},destroy:function(){delete this.map
},resize:function(){if(this.isGoogle()){if(window.google&&google.maps&&this.map){google.maps.event.trigger(this.map,"resize")
}}else{if(this.isOSM()){if(window.OpenLayers&&this.map){Ext.defer(function(){this.map.updateSize()
},250,this)
}}}}}});
this.callParent([b]);
window.mapPanel=this
},checkMapSrc:function(){var a=this;
if(this.isOSM()&&this.isOffline()&&this.type_map.offline.tiles_type){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"mapTiles",params:Ext.encode({task:"check_tiles",type:this.type_map.offline.tiles_type})},success:function(b){if(b.max_ok_zoom<6){if(user_is_admin()){var c=null;
Ext.Msg.confirm("",this.findLangS("text","download_osm_offline_question")+'<br><br><div id="max_zoom_level" style="height: 30px;"></div>',function(d){window._select_download_osm_tiles_max_zoom=c.getValue();
if(d=="yes"){if(this.checkMapSrc_counter<1){Tools.DownloadData.downloadOSMtiles(window._select_download_osm_tiles_max_zoom,function(h,l,k){Tools.DownloadData.applyOSMtilesFile(h,function(m){a.checkMapSrc()
},function(m){a.checkMapSrc()
},l,k)
},function(h){a.checkMapSrc()
},null,this)
}else{var f=new Tools.UploadFile({type:"load_osm_tiles",maskEl:this,onErrorDownloadData:function(){if(f&&f.ownerCt&&f.ownerCt.close){f.ownerCt.close()
}a.checkMapSrc()
},onSuccessApplyData:function(){a.checkMapSrc()
},onErrorApplyData:function(){a.checkMapSrc()
},onCancelForm:function(){delete a.type_map.offline;
a._loadMapApi()
}});
var g=new Ext.Window({title:f.windowTitle,iconCls:f.windowIconCls||f.iconCls,layout:"fit",items:f,border:false,modal:true,closable:true,resizable:false,wikiId:f.windowWikiId});
if(f.iconCls){delete f.iconCls
}g.show()
}++this.checkMapSrc_counter
}else{delete this.type_map.offline;
this._loadMapApi()
}},this);
c=new Ext.form.field.Number({renderTo:"max_zoom_level",value:window._select_download_osm_tiles_max_zoom||6,minValue:6,maxValue:8,fieldLabel:this.findLangS("field","maxZoom"),width:110,labelWidth:70})
}else{delete this.type_map.offline;
this._loadMapApi()
}return
}this.type_map.offline.max_zoom_level=parseInt(b.max_ok_zoom);
this._loadMapApi()
}})
}else{this._loadMapApi()
}},_loadMapApi:function(){if(this.isGoogle()){this._loadGoogleApis()
}else{if(this.isOSM()){this._loadOpenLayersApi()
}}},_loadGoogleApis:function(){this.map_body_id=this.items.get(0).body.id;
loadGoogleApis(function(){Ext.defer(this.createMap,100,this)
},this,function(){Ext.defer(this.evInvalidGoogleApisKey,100,this)
},this)
},_loadOpenLayersApi:function(){this.map_body_id=this.items.get(0).body.id;
loadOpenLayersApi(function(){Ext.defer(this.createMap,100,this)
},this)
},createMap:function(){if(this.pos.length){this.posCenter=[this.pos[0].pos.lat,this.pos[0].pos.lng];
for(var b=1;
b<this.pos.length;
b++){this.posCenter=gpsSimpleCenter(this.posCenter,[this.pos[b].pos.lat,this.pos[b].pos.lng])
}}if(this.isOSM()){this.mapId=this.items.get(0).id+"-innerCt";
this.map=new OpenLayers.Map(Ext.get(this.mapId).dom,{controls:[new OpenLayers.Control.Navigation(),new OpenLayers.Control.Zoom()],units:"m",projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),zoomDuration:0,adjustZoom:function(c){return(c)
}})
}if(this.posCenter){this.mapPosCenter=this.createLatLng(this.posCenter[0],this.posCenter[1])
}else{this.mapPosCenter=this.createLatLng(0,0)
}this.mapPos=[];
for(var b=0;
b<this.pos.length;
b++){this.mapPos[b]=this.createLatLng(this.pos[b].pos.lat,this.pos[b].pos.lng);
this.mapPos[b]._pos=this.pos[b];
this.pos[b]._mapPos=this.mapPos[b]
}if(this.isGoogle()){this.mapProp={mapTypeId:google.maps.MapTypeId.ROADMAP,center:this.mapPosCenter,zoom:this.zoom||this.zoom_default};
this.mapId=this.items.get(0).body.id;
this.map=new google.maps.Map(Ext.get(this.mapId).dom,this.mapProp);
if(window._google_map_ok){this.createMap2()
}else{Ext.defer(function(){if(!window._google_map_failure){this.createMap2()
}},1000,this)
}}else{if(this.isOSM()){if(this.isOffline()){var a=null;
if(this.type_map.offline.tiles_folder){a=this.type_map.offline.tiles_folder+"/${z}/${x}/${y}.png"
}else{if(this.type_map.offline.tiles_type){a=getUrlWithTaskParams("php/model/utilities.php","mapTiles",{task:"get_tile",type:this.type_map.offline.tiles_type,z:"_z_",x:"_x_",y:"_y_"}).replace("_z_","${z}").replace("_x_","${x}").replace("_y_","${y}")
}}this.map_layer_osm=new OpenLayers.Layer.OSM("offline",a,{numZoomLevels:this.type_map.offline.max_zoom_level+1})
}else{this.map_layer_osm=new OpenLayers.Layer.OSM.Mapnik("mapnik")
}this.map.addLayer(this.map_layer_osm);
this.map_container_osm=this.map.div.children[0].children[0];
if(this.mapPosCenter){this.setCenter(this.mapPosCenter,this.zoom||this.zoom_default)
}this.createMap2()
}}if(this.onAfterCreateMap){this.onAfterCreateMap.call(this.onAfterCreateMapScope)
}},createMap2:function(){window._google_map_ok=true;
if(this.setMarkerOnClick){if(this.isGoogle()){var b=this;
this.map.addListener("click",function(d){b._createMarker(d.latLng)
})
}else{if(this.isOSM()){this.map.events.register("click",this,function(f){var d=this.map.getLonLatFromViewPortPx(f.xy);
d=d.transform(this.map.projection,this.map.displayProjection);
this._createMarker({lat:d.lat,lng:d.lon})
})
}}}if(this.markers&&this.markers.length){var c=this.markers;
delete this.markers;
for(var a=0;
a<c.length;
a++){this._createMarker(c[a],true)
}this.centerMarkers()
}if(this.initMarkers){for(var a=0;
a<this.initMarkers.length;
a++){this.addMarkers(this.initMarkers[a])
}this.centerMarkers()
}if(this.postalAddress){this.searchPostalAddress(this.postalAddress,{setMarker:true,ifNotSearch:{message:true,location:[0,0],zoom:2}})
}},evInvalidGoogleApisKey:function(){if(user_is_admin()){this.setGoogleApisKeyQuestion()
}else{this.setGoogleApisKeyInformation()
}},setGoogleApisKeyInformation:function(){Ext.Msg.alert(this.findLangS("msgbox",window._google_map_key?"gmapApiInvalidKeyHeader":"gmapApiUndefinedKeyHeader"),this.findLangS("msgbox",window._google_map_key?"gmapApiInvalidKeyMessage":"gmapApiUndefinedKeyMessage")+"<br><br>"+this.findLangS("msgbox","gmapApiContactAdministratorMessage"))
},setGoogleApisKeyQuestion:function(){Ext.Msg.confirm(this.findLangS("msgbox",window._google_map_key?"gmapApiInvalidKeyHeader":"gmapApiUndefinedKeyHeader"),this.findLangS("msgbox",window._google_map_key?"gmapApiInvalidKeyMessage":"gmapApiUndefinedKeyMessage")+"<br><br>"+this.findLangS("msgbox","gmapApiNewKeyQuestion"),function(a){if(a=="yes"){this.setGoogleApisKey()
}},this)
},setGoogleApisKey:function(){var b="https://developers.google.com/maps/documentation/javascript/get-api-key";
var a=[];
a.push({xtype:"displayfield",value:this.findLangS("field",window._google_map_key?"gmapApiInvalidKeyText":"gmapApiUndefinedKeyText")+" "+this.findLangS("field",window._google_map_key?"gmapApiSetNewKey":"gmapApiSetKey"),fieldStyle:{marginTop:5,marginBottom:8,color:"red"}},{xtype:"displayfield",value:this.findLangS("field","gmapApiKeyGenerator")+'<br><a href="'+b+'" style="color: blue;" target="_blank">'+b+"</a>",fieldStyle:{marginBottom:8}},{xtype:"textfield",name:"key",value:window._google_map_key,width:450,fieldLabel:this.findLangS("field","gmapApiKey"),labelWidth:120,allowBlank:false});
var d=new Ext.form.FormPanel({items:a,buttons:{items:[{text:lang.okButtonText,handler:function(){if(d.getForm().isValid()){window._google_map_key=d.getForm().findField("key").getValue();
c.close();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"google_map",name:"key",config:window._google_map_key,enableUpdate:true})}});
this._loadGoogleApis()
}},scope:this}],style:{"background-color":__color_WindowFrame,marginTop:0}},bodyStyle:{"background-color":__color_WindowFrame,padding:5},border:false});
var c=new Ext.Window({title:this.findLangS("title","gmapApiKey"),items:d,autoWidth:true,autoHeight:true,border:false,modal:true});
c.show()
},fitBounds:function(f,a,d){if(f.length){if(f.length==1){this.setCenter(f[0],a)
}else{var b=this.isGoogle()?new google.maps.LatLngBounds():this.isOSM()?new OpenLayers.Bounds():undefined;
if(b){for(var c=0;
c<f.length;
c++){b.extend(f[c])
}this.map[this.isGoogle()?"fitBounds":this.isOSM()?"zoomToExtent":undefined](b);
if(this.isOSM()&&d&&((this.map.getExtent().right-this.map.getExtent().left)/(b.right-b.left)<1.25||(this.map.getExtent().top-this.map.getExtent().bottom)/(b.top-b.bottom)<1.25)){this.map.zoomTo(this.map.zoom-1)
}}}}},centerMarkers:function(){if(this.markers&&this.markers.length){var b=[];
for(var a=0;
a<this.markers.length;
a++){b.push(this.isGoogle()?this.markers[a].position:this.isOSM()?this.markers[a].lonlat:undefined)
}}else{var b=[];
for(var a=0;
a<this.pos.length;
a++){if(this.pos[a]._mapMarker){b.push(this.pos[a]._mapPos)
}}}this.fitBounds(b,this.markerZoom||this.zoom_default,true)
},_createMarker_google:function(c,b){var a=new google.maps.Marker({position:c,icon:b,map:this.map});
return(a)
},_createMarker_osm:function(d,c){if(!this.map_layer_markers){this.map_layer_markers=new OpenLayers.Layer.Markers("markers");
this.map.addLayer(this.map_layer_markers)
}if(!c){c="images/openlayers/marker.png"
}var a=Ext.isDefined(this.cache_markers_size[c])?this.cache_markers_size[c]:null;
var g=null;
var k=null;
if(a){g=new OpenLayers.Size(a.width,a.height);
k=new OpenLayers.Pixel(-(a.width/2),-a.height)
}var h=new OpenLayers.Icon(c,g,k);
var b=new OpenLayers.Marker(d,h);
this.map_layer_markers.addMarker(b);
if(!g){var f=new Image();
f.onload=Ext.bind(function(n,m,l){this.cache_markers_size[l]={width:n.width,height:n.height};
m.icon.size={w:n.width,h:n.height};
m.icon.offset={x:-(n.width/2),y:-n.height};
m.draw()
},this,[f,b,c]);
f.src=c
}return(b)
},_createMarker:function(b,c){if(this.singleMarker){this._destroyMarkers()
}var a=null;
if(this.isGoogle()){a=this._createMarker_google(b)
}else{if(this.isOSM()){a=this._createMarker_osm(this.createLatLng(b))
}}if(!this.markers){this.markers=[]
}this.markers.push(a);
if(!c&&this.evAddMarker){this.evAddMarker.call(this.evAddMarkerScope,b)
}},_destroyMarker_google:function(a){a.setMap(null)
},_destroyMarker_osm:function(a){this.map_layer_markers.removeMarker(a)
},_destroyMarker:function(a){if(this.isGoogle()){this._destroyMarker_google(a)
}else{if(this.isOSM()){this._destroyMarker_osm(a)
}}},_destroyMarkers:function(){if(this.markers){for(var a=0;
a<this.markers.length;
a++){this._destroyMarker(this.markers[a]);
delete this.markers[a]
}delete this.markers
}},addMarker:function(d){var b=this.getIconSrcMarker(d.posTypeTemp||d.posType,d.pos.prec);
if(this.isGoogle()){d._mapMarker=this._createMarker_google(d._mapPos,b);
d._mapMarker._pos=d;
var a=this.getInfoContent(d.posTypeTemp||d.posType,d.pos.lat,d.pos.lng);
if(a){var c=this.getSizeInfoContent(d.posTypeTemp||d.posType);
d._mapInfo=new InfoBubble({content:a,padding:5,borderRadius:3,minWidth:c[0],maxWidth:c[0],minHeight:c[1],maxHeight:c[1],backgroundColor:__color_FormBackground,borderColor:__color_PanelBorder,arrowWidth:8,arrowPosition:5,arrowStyle:2,arrowSize:0,disableAutoPan:true});
this.addListenerOpenInfo(this.map,d._mapMarker,d._mapInfo)
}}else{if(this.isOSM()){d._mapMarker=this._createMarker_osm(d._mapPos,b);
d._mapMarker._pos=d
}}},addMarkers:function(a){var c=this.getTempPos(a,true);
for(var b=0;
b<c.length;
b++){if(!c[b]._mapMarker){this.addMarker(c[b])
}}this.syncToolbar()
},removeMarker:function(a){if(a._mapMarker){this._destroyMarker(a._mapMarker);
delete a._mapMarker;
a._mapMarker=null;
if(a._mapInfo){delete a._mapInfo;
a._mapInfo=null
}}},removeMarkers:function(a){var c=this.getTempPos(a);
for(var b=0;
b<c.length;
b++){this.removeMarker(c[b])
}this.syncToolbar()
},getSimpleInfoContent:function(b){var a=b;
switch(this.typeData+"-"+b){case"cdr-sip_src":a=this.config.data.caller2;
break;
case"cdr-sip_dst":a=this.config.data.called2;
break;
case"cdr-sip":a=this.config.data.caller2+"<br><br>"+this.config.data.called2;
break;
case"message-sip_src":a=this.config.data.caller2;
break;
case"message-sip_dst":a=this.config.data.called2;
break;
case"message-sip":a=this.config.data.caller2+"<br><br>"+this.config.data.called2;
break;
case"cdr-geos_src":case"cdr-geos_dst":case"cdr-geos":case"message-geos_src":case"message-geos_dst":case"message-geos":a=null;
break;
case"cdr-geop":case"message-geop":a="geoposition";
break
}return(a)
},getInfoContent:function(d,c,b){var a=this.getSimpleInfoContent(d);
if(!a){return(null)
}return('<div style="overflow: hidden; font: '+__font_Grid+';">'+a+'</div><input type="button" value="center" mapid="'+this.id+'" lat="'+c+'" lng="'+b+'" onclick="Ext.getCmp(this.attributes.mapid.nodeValue).setCenterToLatLng(this.attributes.lat.nodeValue, this.attributes.lng.nodeValue)" style="font: '+__font_Grid+"; height: 20; margin-top: 5; margin-left: 5; padding-left: 3; padding-right: 3; padding-bottom: "+(Ext.isChrome?1:3)+';">')
},getSizeInfoContent:function(b){var a=getSizeHtml(this.getSimpleInfoContent(b),false,{font:__font_Grid});
return([a[0]+30,a[1]+12+25])
},getTempPos:function(a,b){var d=[];
for(var c=0;
c<this.pos.length;
c++){if(!a||this.getPosMainType(this.pos[c].posType)==a){this.pos[c].posTypeTemp=null;
d.push(this.pos[c])
}}if(b){if(a=="sip"){if(d.length>1&&d[0].pos.lat==d[1].pos.lat&&d[0].pos.lng==d[1].pos.lng){d[0].posTypeTemp="sip";
d.splice(1,1)
}}}return(d)
},getPosMainType:function(a){switch(a){case"sip_src":case"sip_dst":return("sip");
case"geos_src":case"geos_dst":return("geos")
}return(a)
},getIconSrcMarker:function(c,b){var a;
switch(c){case"sip_src":a="sip_src";
break;
case"sip_dst":a="sip_dst";
break;
case"sip":a="sip";
break;
case"geos_src":a="src";
b=true;
break;
case"geos_dst":a="dst";
b=true;
break;
case"geos":a="src_dst";
b=true;
break;
case"geop":a="geopos";
b=true;
break
}if(a){return("images/map_marker_"+a+(b?"":"_2")+".png")
}return(null)
},addListenerOpenInfo:function(b,a,c){google.maps.event.addListener(a,"click",function(){if(c.isOpen()){c.close()
}else{c.open(b,a)
}})
},syncToolbar:function(){var b=[];
for(var a=0;
a<this.pos.length;
a++){if(this.pos[a]._mapMarker){b.push(this.pos[a])
}}this.getTopToolbar().findC("_menuId","center_markers").enableIf(b.length)
},switchMarkers:function(a,b){if(b){this.addMarkers(a._typeMarkers);
this.centerMarkers()
}else{this.removeMarkers(a._typeMarkers)
}comboSelectProvMarker=this.getTopToolbar().findC("_typeSelectProvMarkers",a._typeMarkers);
if(comboSelectProvMarker){comboSelectProvMarker.enableIf(b)
}},changeProvMarkers:function(b,a){if(this._disableChangeProvMarkers){return
}this.removeMarkers(b._typeSelectProvMarkers);
this.removePos(b._typeSelectProvMarkers);
this.getPos(a.data.id,a.data,b._typeSelectProvMarkers)
},getPos:function(c,b,a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getGeoPos",params:Ext.encode({ip:{sip_src:this.sip.src,sip_dst:this.sip.dst},prov:c})},success:function(d){if(d.pos&&d.pos.length){this.addPos(d.pos);
this.addMarkers(a);
this.centerMarkers()
}if(d.errors&&user_is_admin()){this.evGetPosErrors(d.errors,b)
}},error:function(d,f,g){if(d.errors){this.evGetPosErrors(d.errors,b)
}else{alertAjaxError(f)
}},maskEl:this})
},evGetPosErrors:function(c,b){for(var a in c){if(c[a].match&&(c[a].match(/missing_user_id/)||c[a].match(/missing_key/))){this.onMissingProvKey(b);
return
}else{if(c[a].match&&c[a].match(/invalid_key/)){this.onInvalidProvKey(b);
return
}else{if(c[a].match&&c[a].match(/missing_data/)){this.onMissingLocalData(b,posMainType);
return
}}}}this.evGetPosError(c,{onCloseSetCustomerGeoIP:function(d){if(d){this.getPos(prov,b,posMainType)
}},onCloseSetCustomerGeoIP_scope:this})
},evGetPosError:function(f,b){var a="";
var d=[];
for(var c in f){if(a){a+="<br>"
}a+=c+" : "+(this.findLangS("text","getPosError_"+f[c])||f[c]);
if(f[c]=="ip_is_private"){d.push(c)
}}if(user_is_admin()&&d.length){this.confirmSetCustomerGeoIP(d,b)
}else{Ext.Msg.longalert(lang.alertAjaxErrorHeader,a)
}},confirmSetCustomerGeoIP:function(b,a){Ext.Msg.confirm(this.findLangS("msgbox","missingCoordinatesForPrivHeader"),this.findLangS("msgbox","missingCoordinatesForPrivText")+"<br><br>"+b.join("<br>")+"<br><br>"+this.findLangS("msgbox","missingCoordinatesForPrivQuestion"),function(c){if(c=="yes"){this.setCustomerGeoIP({onClose:a&&a.onCloseSetCustomerGeoIP,onCloseScope:a&&a.onCloseSetCustomerGeoIP_scope})
}},this)
},removePos:function(a){for(var b=0;
b<this.pos.length;
b++){if(this.getPosMainType(this.pos[b].posType)==a){this.mapPos.splice(b,1);
this.pos.splice(b,1);
--b
}}},addPos:function(c){for(var b=0;
b<c.length;
b++){if(this.mapPos){var a=this.createLatLng(c[b].pos.lat,c[b].pos.lng);
a._pos=c[b];
c[b]._mapPos=a;
this.pos.push(c[b]);
this.mapPos.push(a)
}else{this.pos.push(c[b])
}}},initPos:function(d,a){switchMarker=this.getTopToolbar().findC("_typeMarkers",a);
if(switchMarker){switchMarker.enable()
}comboSelectProvMarker=this.getTopToolbar().findC("_typeSelectProvMarkers",a);
if(comboSelectProvMarker){var c=null;
for(var b=0;
b<d.length;
b++){if(this.getPosMainType(d[b].posType)==a&&d[b].pos.prov!="custom"){c=d[b].pos.prov
}}if(c){this._disableChangeProvMarkers=true;
comboSelectProvMarker.setValue(c);
delete this._disableChangeProvMarkers
}comboSelectProvMarker.enable()
}this.addPos(d);
if(this.mapPos){this.addMarkers(a);
this.centerMarkers()
}},createLatLng:function(c,b){if(!Ext.isDefined(b)){if(c._createdLatLng){return(c)
}if(Ext.isObject(c)){b=c.lng;
c=c.lat
}else{if(Ext.isArray(c)){b=c[1];
c=c[0]
}}}var a=null;
if(this.isGoogle()){a=new google.maps.LatLng(c||0,b||0)
}else{if(this.isOSM()){a=new OpenLayers.LonLat(b||0,c||0).transform(this.map.displayProjection,this.map.projection)
}}if(a){a._createdLatLng=true
}return(a)
},searchPostalAddress:function(c,a){if(this.isGoogle()){geocoder=new google.maps.Geocoder();
var b=this;
geocoder.geocode({address:c},function(g,d){if(d==google.maps.GeocoderStatus.OK){b.setCenter(g[0].geometry.location,(a&&a.zoom)||this.zoom_detail);
if(a&&a.setMarker){b._createMarker(g[0].geometry.location)
}}else{if(a&&a.ifNotSearch){if(a.ifNotSearch.message){Ext.Msg.alert(lang.error,"Geocode was not successful for the following reason: "+d)
}if(a.ifNotSearch.location){var f=this.createLatLng(a.ifNotSearch.location[0],a.ifNotSearch.location[1]);
this.setCenter(f,a.ifNotSearch.zoom)
}}}})
}else{if(this.isOSM()){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getGeoPos",params:Ext.encode({search:c,provider:"nominatim"})},success:function(d){if(d){var f=this.createLatLng(d.lat,d.lng);
this.setCenter(f,(a&&a.zoom)||this.zoom_detail);
if(a&&a.setMarker){this._createMarker(f)
}}},error:function(d,g,h){if(a.ifNotSearch){if(a.ifNotSearch.message){Ext.Msg.alert(lang.error,"Geocode was not successful for the following reason: "+getStringAjaxError(d))
}if(a.ifNotSearch.location){var f=this.createLatLng(a.ifNotSearch.location[0],a.ifNotSearch.location[1]);
this.setCenter(f,a.ifNotSearch.zoom)
}}}})
}}},onMissingProvKey:function(a){Ext.Msg.confirm(this.findLangS("msgbox",a.user_id_config?"missingKeyUserId":"missingKey"),this.findLangS("msgbox",a.user_id_config?"missingKeyUserIdText":"missingKeyText").template(a),function(b){if(b=="yes"){window.open(a.key_portal_url)
}},this)
},onInvalidProvKey:function(a){Ext.Msg.alert(this.findLangS("msgbox",a.user_id_config?"invalidKeyUserId":"invalidKey"),this.findLangS("msgbox",a.user_id_config?"invalidKeyUserIdText":"invalidKeyText").template(a))
},onMissingLocalData:function(a,b){Ext.Msg.confirm(this.findLangS("msgbox","missingDataHeader"),this.findLangS("msgbox","missingDataText"),function(c){if(c=="yes"){this.downloadData(a,b)
}},this)
},downloadData:function(a,c){var b=this;
Tools.DownloadData.downloadGeoipCity(function(d,g,f){Tools.DownloadData.applyGeoipCityFile(d,function(h){b.getPos(h.provData.id,h.provData,h.posType)
},null,g,f,true)
},null,{provData:a,posType:c},this)
},loadGeoipData:function(){var a=new Tools.UploadFile({type:"load_geoip_city_file",maskEl:this});
var b=new Ext.Window({title:a.windowTitle,iconCls:a.windowIconCls||a.iconCls,layout:"fit",items:a,border:false,modal:true,closable:true,resizable:false,wikiId:a.windowWikiId});
if(a.iconCls){delete a.iconCls
}b.show()
},adjustZoom:function(a){if(this.isOSM()&&this.isOffline()&&this.type_map.offline.max_zoom_level<a){return(this.type_map.offline.max_zoom_level)
}return(a)
},setZoom:function(a){a=this.adjustZoom(a);
if(this.isGoogle()){this.map.setZoom(a)
}else{if(this.isOSM()){this.map.zoomTo(a)
}}},setCenter:function(b,a){if(!Ext.isDefined(a)){a=this.zoom_default
}a=this.adjustZoom(a);
if(this.isGoogle()){this.map.setCenter(b);
this.setZoom(a)
}else{if(this.isOSM()){this.map.setCenter(b,a)
}}},setCenterToLatLng:function(c,a,b){var d=this.createLatLng(c,a);
this.setCenter(d,b)
},hideGoogleInfoText:function(){Ext.defer(function(){if(this.getEl()){var b=this.getEl().down(".gm-style");
if(b){var d=[".gm-style-cc",".gmnoprint.gm-style-cc"];
for(var a=0;
a<d.length;
a++){var c=b.down(d[a]);
if(c){c.setStyle("visibility","hidden")
}}}}},1000,this)
},setCustomerGeoIP:function(a){var b=new Settings.GeoIP_customerType.Grid({prefixCls:"geoip_type_window"});
var c=new Ext.Window({title:this.findLangS("title","customerGeoIP"),closable:true,maximizable:true,resizable:true,layout:"fit",width:Math.min(650,Ext.dom.Element.getViewportWidth()-50),height:Math.min(500,Ext.dom.Element.getViewportHeight()-50),items:b,modal:true,listeners:{scope:this,close:function(){if(a&&a.onClose){a.onClose.call(a.onCloseScope,b._change)
}}}});
c.show()
},isGoogle:function(){return(this.type_map=="google"||this.type_map.type=="google")
},isOSM:function(){return(this.type_map=="osm"||this.type_map.type=="osm")
},isOffline:function(){return(this.type_map.offline)
},getTypeMapDefault:function(){return(window.map_type&&window.map_type.toLowerCase()=="GoogleMaps".toLowerCase()?"google":window.map_type&&window.map_type.toLowerCase()=="OSM_offline".toLowerCase()?{type:"osm",offline:{max_zoom_level:7,tiles_type:"osm"}}:"osm")
}});
Ext.define("GMap.Item",{constructor:function(a){Ext.apply(this,a)
},renderer:function(d){if(!(this.type=="text"&&!this._svg&&this.location)){return(null)
}var f=[];
var s=[];
var c=[];
function q(C){if(c.isIn(C)){return
}c.push(C);
if(C.location.priv){var A=C.location.descr;
var B=null;
for(var z=0;
z<f.length;
z++){if(f[z].descr==A){B=f[z];
break
}}if(B){B.f+=C.counts.f;
B.r+=C.counts.r
}else{f.push({descr:A,f:C.counts.f,r:C.counts.r})
}}else{var u=C.location.country;
var w=C.location.country_name;
var v=null;
for(var z=0;
z<s.length;
z++){if(s[z].country==u){v=s[z];
break
}}if(v){v.f+=C.counts.f;
v.r+=C.counts.r
}else{s.push({country:u,country_name:w,f:C.counts.f,r:C.counts.r,cities:[]});
v=s[s.length-1]
}var k=C.location.city;
if(k){var y=null;
for(var z=0;
z<v.cities.length;
z++){if(v.cities[z].city==k){y=v.cities[z];
break
}}if(y){y.f+=C.counts.f;
y.r+=C.counts.r
}else{v.cities.push({city:k,f:C.counts.f,r:C.counts.r})
}}}}rslt='<table callpadding=0 cellspacing=0 border=0 style="border: none; border-collapse: collapse; padding: 0; margin: 0;">';
if(d&&d.items){for(var n=0;
n<d.items.length;
n++){var a=this.getAgregation();
if(a){for(var m=0;
m<a.items.length;
m++){q(a.items[m])
}}else{q(d.items[n])
}}}else{var a=this.getAgregation();
if(a){for(var n=0;
n<a.items.length;
n++){q(a.items[n])
}}else{q(this)
}}var l=0;
var h=d&&d.maxShowItems||10;
if(f.length){f.sort(function(u,k){return((k.f+k.r)-(u.f+u.r))
});
for(var n=0;
n<f.length;
n++){for(var m=0;
m<c.length;
m++){if(c[m].location.descr==f[n].descr){var r=c[m];
++l;
if(l<=h){rslt+="<tr><td>"+r._renderer(d)
}break
}}}}if(s.length){s.sort(function(u,k){return((k.f+k.r)-(u.f+u.r))
});
for(var n=0;
n<s.length;
n++){++l;
if(l<=h){rslt+="<tr><td>"+this._renderer_country(s[n].country,s[n].country_name,d)
}if(!(d&&d.boundText)){var b=s[n];
b.cities.sort(function(u,k){return((k.f+k.r)-(u.f+u.r))
});
for(var m=0;
m<b.cities.length;
m++){for(var g=0;
g<c.length;
g++){if(c[g].location.country==b.country&&c[g].location.city==b.cities[m].city){var r=c[g];
++l;
if(l<=h){rslt+="<tr><td>"+r._renderer(d)
}break
}}}}}}if(!(d&&d.disableNextItems)&&l>h){rslt+="<tr><td>"+this._renderer_next_items(l-h,d)
}if(!(d&&d.disableInternalCalls)){lines=this.getLinesInAgregationItems();
if(lines.length){var p=0;
for(var n=0;
n<lines.length;
n++){p+=lines[n].counts.f+lines[n].counts.r
}var o=this._getCountConfig(p);
if(o){style={"font-size":o.fontSize*(d&&d.scale?d.scale/100:1),color:o.color};
rslt+='<tr><td style="'+getHtmlStyle(style)+'">'+p
}}}rslt+="</table>";
if(d&&(d.side=="left"||d.side=="right")){var t={"writing-mode":"vertical-rl",transform:"rotate(180deg)"};
rslt='<div style="'+getHtmlStyle(t)+'">'+rslt+"</div>"
}return(rslt)
},_renderer:function(b){if(this.type=="text"){var a=this.getLocation();
if(a){var d=null;
if(a.priv){d=b&&b.boundText?this._owner.configData.locationFonts.bound_text:this._owner.configData.locationFonts.private_network
}else{if(a.city){d=b&&b.boundText?this._owner.configData.locationFonts.bound_text:this._owner.configData.locationFonts.city
}else{return(this._renderer_country(a.country,a.country_name,b))
}}if(d){var c={"font-size":d.size*(b&&b.scale?b.scale/100:1),color:d.color,"font-weight":d.bold?"bold":"normal","white-space":"nowrap"};
return('<span style="'+getHtmlStyle(c)+'">'+(a.priv?(a.descr||"private network"):(a.city||a.country))+"</span>")
}}else{return(this.text)
}}return(null)
},_renderer_country:function(d,c,b){var g=b&&b.boundText?this._owner.configData.locationFonts.bound_text:this._owner.configData.locationFonts.country_code;
var f=b&&b.boundText?this._owner.configData.locationFonts.bound_text:this._owner.configData.locationFonts.country_name;
if(g&&f){var l={"font-size":g.size*(b&&b.scale?b.scale/100:1),color:g.color,"font-weight":g.bold?"bold":"normal","white-space":"nowrap"};
var h={"font-size":f.size*(b&&b.scale?b.scale/100:1),color:f.color,"font-weight":f.bold?"bold":"normal","white-space":"nowrap","padding-left":b.boundText?undefined:"5px"};
var k=flagImage(d)||('<span style="'+getHtmlStyle(l)+'">'+d+"</span>");
var a=c?('<span style="'+getHtmlStyle(h)+'">'+c+"</span>"):"";
return(b&&b.boundText?a:k+a)
}},_renderer_next_items:function(d,a){var c=this._owner.configData.locationFonts.next_items;
if(c){var b={"font-size":c.size*(a&&a.scale?a.scale/100:1),color:c.color,"font-weight":c.bold?"bold":"normal","white-space":"nowrap"};
return('<span style="'+getHtmlStyle(b)+'">... hide #'+d+"</span>")
}},_renderer_bound_text:function(a){var c=this._owner.configData.locationFonts.bound_text;
if(c){var b={"font-size":c.size*(a&&a.scale?a.scale/100:1),color:c.color,"font-weight":c.bold?"bold":"normal","white-space":"nowrap"};
if(a&&(a.side=="left"||a.side=="right")){b["writing-mode"]="vertical-rl";
b.transform="rotate(180deg)"
}return('<span style="'+getHtmlStyle(b)+'">'+this.getMainText()+"</span>")
}},getMainText:function(){switch(this.type){case"text":var a=this.getAgregation();
if(a){return(a.getMainText())
}else{return(this._getMainText())
}break;
case"line":return("|")
}},_getMainText:function(a){switch(this.type){case"text":return(this.location?(this.location.priv?(a&&a.agregation?this.location.descr:(this.location.descr_wrap||this.location.descr)):this.location.city?this.location.city+" ("+this.location.country+")":this.location.country):this.text);
break;
case"line":return("|")
}},getLocationContent:function(){if(this.location){return(this.location?(this.location.priv?this.location.descr:this.location.city?this.location.city+" ("+this.location.country+")":this.location.country+(this.location.country_name?" "+this.location.country_name:"")):this.text)
}},getLocationId:function(){if(this.location){return(this.location?(this.location.priv?"p:"+this.location.descr:this.location.city?"cc:"+this.location.country+"#"+this.location.city:"c:"+this.location.country):this.text)
}},getCenterFromText:function(a){switch(this.type){case"line":if(!Ext.isDefined(a)){a=this.getCounts()
}if(a){return(String(a.r))
}break
}},getCenterToText:function(a){switch(this.type){case"line":if(!Ext.isDefined(a)){a=this.getCounts()
}if(a){return(String(a.f))
}break
}},getCounts:function(){if(this.type=="line"){var d=this.getAgregationItems();
if(d&&d.length){if(d.length==1){this._counts=d[0].counts;
return(d[0].counts)
}else{var c={f:0,r:0};
for(var b=0;
b<d.length;
b++){var a=d[b].reverse;
var f=d[b].reverse?d[b].item:d[b];
if(a){c.f+=f.counts.r;
c.r+=f.counts.f
}else{c.f+=f.counts.f;
c.r+=f.counts.r
}}this._counts=c;
return(c)
}}}return(null)
},getLinesInAgregationItems:function(){var c=this.getAgregationItems();
var d=[];
for(var b=0;
b<c.length;
b++){if(!d.isIn(c[b].id)){d.push(c[b].id)
}}var a=[];
for(var b=0;
b<this._owner.map_items.length;
b++){if(this._owner.map_items[b].type=="line"&&(d.isIn(this._owner.map_items[b].snapitems_id[0])&&d.isIn(this._owner.map_items[b].snapitems_id[1]))){a.push(this._owner.map_items[b])
}}return(a)
},getAgregationItems:function(){switch(this.type){case"text":if(this.isAgregation()){var h=this.getAgregation();
return(h.items)
}else{return([this])
}break;
case"line":if(!this.snapitems[0].isAgregation()&&!this.snapitems[1].isAgregation()){return([this])
}var d;
var b;
if(this.snapitems[0].isAgregation()){var h=this.snapitems[0].getAgregation();
d=h.items
}else{d=[this.snapitems[0]]
}if(this.snapitems[1].isAgregation()){var h=this.snapitems[1].getAgregation();
b=h.items
}else{b=[this.snapitems[1]]
}var a=[];
for(var f=0;
f<d.length;
f++){for(var c=0;
c<b.length;
c++){var g=this._owner.findMapItemBySnapitemsId(d[f].id,b[c].id);
if(g){a.push(g)
}else{var g=this._owner.findMapItemBySnapitemsId(b[c].id,d[f].id);
if(g){a.push({item:g,reverse:true})
}}}}return(a);
break
}},getCenterXY:function(){switch(this.type){case"text":var a=this._getTextXYWH();
if(a){return([a.x,a.y])
}}},getBBoxes:function(){switch(this.type){case"text":var a=this._getTextXYWH();
if(a){return([{x:a.x-(a.width/2),y:a.y-(a.height/2),width:a.width,height:a.height}])
}}},getBBoxMinHoriz:function(){switch(this.type){case"text":var a=this._getTextXYWH();
if(a){rslt={x:a.x-(a.width/2),y:a.y-(a.height/2),width:a.width,height:a.height};
rslt.left=rslt.x;
rslt.top=rslt.y;
rslt.right=rslt.x+rslt.width-1;
rslt.bottom=rslt.y+rslt.height-1;
return(rslt)
}}},_getTextXYWH:function(){if(this.xy){var a=this._svg?this.div_background:this.divs[0];
if(a){return({x:this.xy.x,y:this.xy.y,width:parseFloat(a.style.width||a.offsetWidth),height:parseFloat(a.style.height||a.offsetHeight)})
}}return(null)
},_getBoundTextLTWH:function(){return({x:this.divs[0].offsetLeft,y:this.divs[0].offsetTop,width:this.divs[0].offsetWidth,height:this.divs[0].offsetHeight})
},cmpSnapItems:function(c){if(this.snapitems_id.length!=c.length){return(false)
}for(var b=0;
b<this.snapitems_id.length;
b++){for(var a=0;
a<c.length;
a++){if(this.snapitems_id[b]==c[a].id){break
}}if(a==c.length){return(false)
}}return(true)
},getHeightForLineBetweenSnapItems:function(){var c=6;
var f=6;
if(this.svgGroups){for(var d=0;
d<this.svgGroups.length;
d++){for(var b=0;
b<this.svgGroups[d].items.length;
b++){switch(this.svgGroups[d].items[b].typeItem){case"text_base":var g=this.svgGroups[d].items[b]._getBBox();
var a=g.height*0.9;
if(a>c){c=g.height*0.9
}break;
case"text_marker_start":case"text_marker_end":var g=this.svgGroups[d].items[b]._getBBox();
var a=g.height*0.95;
if(a>f){f=g.height*0.95
}break
}}}}return([c,f])
},setItemsIdMap:function(){switch(this.type){case"text":case"bound_text":var c=this.div_background?this.div_background.id:this.div_background?this.div_background:this.divs[0].id;
this._owner.items_id_map[c]=this;
break;
case"line":for(var b=0;
b<this.svgGroups.length;
b++){for(var a=0;
a<this.svgGroups[b].items.length;
a++){this._owner.items_id_map[this.svgGroups[b].items[a].id]=this
}}break
}},destroyItemsIdMap:function(){switch(this.type){case"text":case"bound_text":var c=this.div_background?this.div_background.id:this.div_background?this.div_background:this.divs[0].id;
if(this._owner.items_id_map[c]){delete this._owner.items_id_map[c]
}break;
case"line":for(var b=0;
b<this.svgGroups.length;
b++){for(var a=0;
a<item.svgGroup.items.length;
a++){if(this._owner.items_id_map[item.svgGroups[b].items[a].id]){delete this._owner.items_id_map[item.svgGroups[b].items[a].id]
}}}break
}},destroySvg:function(){if(this.svgItems){for(var b=0;
b<this.svgItems.length;
b++){this.svgItems[b].destroy()
}delete this.svgItems
}if(this.svgGroups){for(var b=0;
b<this.svgGroups.length;
b++){for(var a=0;
a<this.svgGroups[b].items.length;
a++){this.svgGroups[b].items[a].destroy()
}}delete this.svgGroups
}},destroy:function(){this.destroySvg();
if(this.svgPainters){for(var a=0;
a<this.svgPainters;
a++){this.svgPainters[a].destroySvg()
}}if(this.div_content){this.div_content.parentNode.removeChild(this.div_content);
delete this.div_content
}if(this.div_background){this.div_background.parentNode.removeChild(this.div_background);
delete this.div_background
}},getCountConfig:function(){switch(this.type){case"line":var b=this.getCounts();
if(!b){return(null)
}var a=this._getCountConfig(b.f+b.r);
if(!a){return(null)
}return({lineConfig:{stroke:a.color,"stroke-width":a.strokeWidth},textConfig:{"font-size":a.fontSize,fill:a.color,"background-fill":"white","background-opacity":0.95},textConfigInv:{"font-size":a.fontSize,fill:"white","font-weight":a.fontBold?"bold":"normal","background-fill":a.color,"background-opacity":1},arrowConfig:{from:{stroke:a.color,fill:a.color},to:{stroke:a.color,fill:a.color}}})
}},_getCountConfig:function(c){var a=this._owner.configData.count;
for(var b=a.length-1;
b>=0;
b--){if(c>=a[b].count_ge){return(a[b])
}}return(null)
},getLocation:function(){return(this.location_e?Ext.decode(this.location_e):null)
},getSize:function(){var a=this.renderer({scale:this._owner.scale,maxShowItems:this._owner.maxShowItemsInAgregation});
this._html=a;
this.size=getSizeHtml(a);
return(this.size)
},getSizeBoundText:function(c,a){var b=this.renderer({side:c,scale:this._owner.scale,items:a,boundText:true,disableInternalCalls:true,disableNextItems:true,maxShowItems:this._owner.maxShowItemsInBoundsAgregation});
return(getSizeHtml(b))
},isAgregation:function(){return(Ext.isDefined(this.agregation_index))
},isAgregationMainItem:function(){if(Ext.isDefined(this.agregation_index)&&this._owner.agregations.items[this.agregation_index].items[0].id==this.id){return(true)
}return(false)
},getAgregation:function(a){if(Ext.isDefined(this.agregation_index)){return(this._owner.agregations.items[this.agregation_index])
}return(null)
},getAgregationMainItem:function(){var a=this.getAgregation();
return(a?a.items[0]:item)
},show:function(){if(this.divs){for(var a=0;
a<this.divs.length;
a++){this.divs[a].style.visibility="visible"
}}},hide:function(){if(this.divs){for(var a=0;
a<this.divs.length;
a++){this.divs[a].style.visibility="hidden"
}}if(this._counts){delete this._counts
}},moveToTop:function(b){if(b&&b<this.divs.length){this._owner.overlayContainer.appendChild(this.divs[b])
}else{for(var a=0;
a<this.divs.length;
a++){this._owner.overlayContainer.appendChild(this.divs[a])
}}}});
Ext.define("GMap.Agregation",{constructor:function(a){Ext.apply(this,a);
this.items=[]
},add:function(a){this.items.push(a);
a.agregation_index=this.index
},merge:function(a){for(var b=0;
b<a.items.length;
b++){this.add(a.items[b])
}a.items=[]
},getMainText:function(){var c=[];
for(var b=0;
b<this.items.length;
b++){var a=this.items[b]._getMainText({agregation:true});
if(!c.isIn(a)){c.push(a)
}}return(c.join("\r"))
}});
Ext.define("GMap.Agregations",{constructor:function(a){Ext.apply(this,a);
this.items=[]
},doAgregation:function(){this.reset();
var d=["text"];
var a=50;
for(var f=0;
f<3;
f++){for(var c=0;
c<this._owner.map_items.length;
c++){for(var b=0;
b<this._owner.map_items.length;
b++){if(c!=b&&d.isIn(this._owner.map_items[c].type)&&this._owner.map_items[c].xy&&(!this._owner.map_items[c].isAgregation()||this._owner.map_items[c].isAgregationMainItem())&&d.isIn(this._owner.map_items[b].type)&&this._owner.map_items[b].xy&&(!this._owner.map_items[b].isAgregation()||this._owner.map_items[b].isAgregationMainItem())&&this.checkOverlap(this._owner.map_items[c],this._owner.map_items[b],a)){this.add(this._owner.map_items[c],this._owner.map_items[b],f>0)
}}}for(var c=0;
c<this._owner.map_items.length;
c++){if(d.isIn(this._owner.map_items[c].type)&&this._owner.map_items[c].xy&&this._owner.map_items[c].isAgregationMainItem()){this._owner.map_items[c].getSize()
}}}},reset:function(){this.items=[];
for(var a=0;
a<this._owner.map_items.length;
a++){if(Ext.isDefined(this._owner.map_items[a].agregation_index)){delete this._owner.map_items[a].agregation_index
}}},add:function(c,b,f){if(Ext.isDefined(c.agregation_index)&&Ext.isDefined(b.agregation_index)){var a=c.getAgregation();
var h=b.getAgregation();
if(a.items.length>=h.items.length){a.merge(h)
}else{h.merge(a)
}}else{if(Ext.isDefined(c.agregation_index)||Ext.isDefined(b.agregation_index)){var g=this.items[Ext.isDefined(c.agregation_index)?c.agregation_index:b.agregation_index];
if(Ext.isDefined(c.agregation_index)){g.add(b)
}else{g.add(c)
}if(f){g.items[0].getSize()
}}else{var d=new GMap.Agregation({id:"agreg_"+String(this.items.length+1).lpad(6,"0"),index:this.items.length});
d.add(c);
d.add(b);
this.items.push(d);
if(f){c.getSize()
}}}},checkOverlap:function(c,a,b){rectItem1={left:c.xy.x-c.size[0]/2,top:c.xy.y-c.size[1]/2,width:c.size[0],height:c.size[1]};
rectItem2={left:a.xy.x-a.size[0]/2,top:a.xy.y-a.size[1]/2,width:a.size[0],height:a.size[1]};
var b=50;
return(this.checkPointInRect([rectItem1.left,rectItem1.top],rectItem2,b)||this.checkPointInRect([rectItem1.left+rectItem1.width,rectItem1.top],rectItem2,b)||this.checkPointInRect([rectItem1.left+rectItem1.width,rectItem1.top+rectItem1.height],rectItem2,b)||this.checkPointInRect([rectItem1.left,rectItem1.top+rectItem1.height],rectItem2,b)||this.checkPointInRect([rectItem2.left,rectItem2.top],rectItem1,b)||this.checkPointInRect([rectItem2.left+rectItem2.width,rectItem2.top],rectItem1,b)||this.checkPointInRect([rectItem2.left+rectItem2.width,rectItem2.top+rectItem2.height],rectItem1,b)||this.checkPointInRect([rectItem2.left,rectItem2.top+rectItem2.height],rectItem1,b))
},checkPointInRect:function(a,d,c){var b=c?{left:d.left-c,top:d.top-c,width:d.width+c*2,height:d.height+c*2}:d;
return(a[0]>=b.left&&a[0]<=(b.left+b.width)&&a[1]>=b.top&&a[1]<=(b.top+b.height))
}});
Ext.define("GMap.PanelExt",{extend:"GMap.Panel",subsystem:"gmap",constructor:function(a){this.scale=a&&a.items_scale||100;
this.maxShowItemsInAgregation=10;
this.maxShowItemsInBoundsAgregation=2;
this.configData={count:a.line_colors||GMap.Utils.getDefaultLineColors(),locationFonts:{private_network:{size:11,color:"purple",bold:true},city:{size:11,color:"blue",bold:false},country_code:{size:12,color:"blue",bold:true},country_name:{size:10,color:"black",bold:false},next_items:{size:10,color:"black",bold:false},bound_text:{size:11,color:"black",bold:false}},background:{text:{fill:"white",opacity:0.95,padding:2},bound_text:{fill:"lightcyan",opacity:1,padding:2}}};
var b=null;
if(!a||!a.disableTbar){this.scaleField=new Ext.form.field.Number({value:this.scale,minValue:25,maxValue:400,step:5,width:__width_FieldNum(3)+__width_Trigger,listeners:{scope:this,select:function(c){var d=c.getValue();
if(d>=c.minValue&&d<=c.maxValue){this.scale=d;
this.redrawMapItems()
}},change:function(c){var d=c.getValue();
if(d>=c.minValue&&d<=c.maxValue){this.scale=d;
this.redrawMapItems()
}}}});
this.callerCalledByCombo=new Ext.ux.combobox.ComboBoxA({name:"caller_called_by",value:a.caller_called_by||"number/number",aData:GMap.Utils.getCallerCalledByData(),width:__width_FieldChar(37),listeners:{scope:this,select:this.onSelectCallerdBy}});
b=a.tbar||[];
b.push(this.findLangS("tbar","caller_called_by")+":",this.callerCalledByCombo,"-",this.findLangS("tbar","scale")+":",this.scaleField,"-",{text:this.findLangS("tbar","lineColors"),handler:this.setLineColors,scope:this},{text:this.findLangS("tbar","geoipCustomer"),handler:function(){this.setCustomerGeoIP({onClose:function(c){if(c){this.reload(true)
}},onCloseScope:this})
},scope:this},"-",{iconCls:"icon_reload",handler:function(){this.reload(true)
},scope:this},this.findLangS("tbar","refreshInterval")+":",{xtype:"numberfield",width:__width_ColumnNum(3)+__width_Trigger,value:a._timeoutRefreshInterval,minValue:10,maxValue:9999,step:5,enableKeyEvents:true,listeners:{scope:this,change:function(c){this.setTimeoutRefreshInterval(c)
},keyup:function(d,c){this.setTimeoutRefreshInterval(d)
}},fieldStyle:{"text-align":"right"}});
if(!window.isCloud&&user_is_admin()){b.push("->",{text:this.findLangS("tbar","loadGeoipData"),handler:this.loadGeoipData,scope:this})
}}a=Ext.applyIf(a||{},{tbar:b&&b.length?b:undefined,posCenter:a.mainPos,disableTitle:a.windowConfig,disableIcon:a.windowConfig});
this.initMapItems();
this.agregations=new GMap.Agregations({_owner:this});
this.callParent([a]);
this.on("destroy",function(){this.destroyMapItems();
if(this.globalOverlay){delete this.globalOverlay
}},this);
window.mapPanelExt=this;
if(this.windowConfig){this.createWindow();
if(this.windowConfig.autoShow){this.window.show()
}}},createWindow:function(){Ext.applyIf(this.windowConfig,{closable:true,maximizable:true,resizable:true,layout:"fit",width:Ext.dom.Element.getViewportWidth()-50,height:Ext.dom.Element.getViewportHeight()-50,items:this});
this.window=new Ext.Window(this.windowConfig)
},onAfterRender:function(){this.toolTip=Ext.create("Ext.tip.ToolTip",{target:this.items.get(0).body,trackMouse:false,renderTo:Ext.getBody(),dismissDelay:15000,floating:true,dynamicContent:true,_content:"init"});
this.hideToolTip()
},onAfterCreateMapExt:function(){if(this.isGoogle()){var a=this;
this.map.addListener("zoom_changed",function(){if(!a._suppressEvZoomChanged){a.setTimeoutDeferFunction("redrawMapItems")
}});
this.map.addListener("dragstart",function(){a._dragstart_center_coord=a.getCenterCoord();
a.destroyMapItems("bound_text")
});
this.map.addListener("dragend",function(){a._dragend_flag=true;
a.setTimeoutDeferFunction("redrawLinesIfNeed")
});
this.globalOverlay=this.createOverlay({globalOverlay:true,mapPanel:this})
}else{if(this.isOSM()){this.map.events.register("zoomend",this,function(b){if(!this._suppressEvZoomChanged){this.setTimeoutDeferFunction("redrawMapItems")
}});
this.map.events.register("move",this,function(b){if(!this.__moving){this.__moving=true;
this.destroyMapItems("bound_text")
}});
this.map.events.register("moveend",this,function(b){if(this.__moving){delete this.__moving;
this.setTimeoutDeferFunction("redrawLinesIfNeed")
}})
}}if(this.testMap){this.createTestMap()
}else{this.createLcMap({mask:true,autoCenter:!this.disableInitAutoCenter,zoom:this.zoom||5})
}},onSelectCallerdBy:function(){this.createLcMap({mask:true,autoCenter:true,zoom:this.zoom||(this.getCallerBy()=="number"||this.getCalledBy()=="number"?3:5)})
},getCallerBy:function(){var a=this.getCallerCalledBy();
return(a[0])
},getCalledBy:function(){var a=this.getCallerCalledBy();
return(a[1])
},getCallerCalledBy:function(){var a=this.callerCalledByCombo?this.callerCalledByCombo.getValue():this.caller_called_by;
return(a.split("/"))
},reload:function(a){this.createLcMap({mask:a})
},addText:function(c){var a=Ext.apply({},c.textConfig);
Ext.applyIf(a,{"font-size":12});
var b=new GMap.Item({type:"text",id:c.id||this.newIdMapItem(),coordinates:c.coordinates,text:c.text,textConfig:a,backgroundConfig:c.background,location_e:c.location_e,location:c.location,counts:c.counts,_owner:this,_svg:c.svg});
this.createOverlay(b);
this.map_items.push(b);
return(b)
},addBoundText:function(b){var a=new GMap.Item({type:"bound_text",id:this.newIdMapItem(),textItems:b.items,pos:b.pos,_owner:this});
this.createOverlay(a);
this.map_items.push(a);
return(a)
},addLine:function(g){var d=this.findMapItemById(g.betweenIdItems[0]);
var b=this.findMapItemById(g.betweenIdItems[1]);
if(!d||!b){return
}var k=Ext.apply({},g.lineConfig);
Ext.applyIf(k,{"stroke-width":1});
var a=Ext.apply({},g.textConfig);
Ext.applyIf(a,{"font-size":11});
var c=null;
if(g.textFrom){var c=Ext.apply({},g.textFromConfig);
Ext.applyIf(c,{"font-size":9})
}var h=null;
if(g.textTo){var h=Ext.apply({},g.textToConfig);
Ext.applyIf(h,{"font-size":9})
}var f=new GMap.Item({type:"line",id:g.id||this.newIdMapItem(),snapitems_id:g.betweenIdItems,snapitems:[d,b],lineConfig:k,text:g.text,textConfig:a,textCenterFrom:g.textCenterFrom,textCenterTo:g.textCenterTo,textFrom:g.textFrom,textFromConfig:c,textTo:g.textTo,textToConfig:h,arrowConfig:g.arrowConfig,counts:g.counts,_owner:this});
this.createOverlay(f);
this.map_items.push(f);
this.items_snapitems_id_map[d.id+"/"+b.id]=f;
return(f)
},findMapItemById:function(b){for(var a=0;
a<this.map_items.length;
a++){if(this.map_items[a].id==b){return(this.map_items[a])
}}return(null)
},findMapItemBySnapitemsId:function(b,a){if(Ext.isDefined(this.items_snapitems_id_map[b+"/"+a])){return(this.items_snapitems_id_map[b+"/"+a])
}return(null)
},redrawMapItems:function(b){if(this.redrawMapItems_forceConfig){b=Ext.applyIf(b||{},this.redrawMapItems_forceConfig);
delete this.redrawMapItems_forceConfig
}if(b&&b.checkExistsDivsOnAllMapItems){for(var d=0;
d<this.map_items.length;
d++){if(!this.map_items[d].divs){Ext.defer(function(){this.redrawMapItems(b)
},100,this);
return
}}}if(b&&b.waitForFixMap&&this._coord&&b.waitForFixMap.coord&&this._bounds&&b.waitForFixMap.bounds&&(b.waitForFixMap.coord[0]!=this._coord[0]||b.waitForFixMap.coord[1]!=this._coord[1]||b.waitForFixMap.bounds.n!=this._bounds.n||b.waitForFixMap.bounds.e!=this._bounds.e||b.waitForFixMap.bounds.s!=this._bounds.s||b.waitForFixMap.bounds.w!=this._bounds.w)){b.waitForFixMap.coord=this._coord;
b.waitForFixMap.bounds=this._bounds;
Ext.defer(function(){this.redrawMapItems(b)
},250,this);
return
}this.hideToolTip();
this.destroyMapItems("bound_text");
this.redrawMapItems_processing=true;
this.agregations.reset();
this.getXY_Items();
this.getMapBoundsInPixel();
this.getSizeItems();
this.agregations.doAgregation();
var c=["text","line"];
for(var a=0;
a<c.length;
a++){for(var d=0;
d<this.map_items.length;
d++){if(this.map_items[d].type==c[a]){this.onDrawOverlay(this.map_items[d])
}}}this.createBoundTextItems();
this.optimalMoveTextItemsInLine();
this.optimalMoveItemsToTop();
delete this.redrawMapItems_processing;
this.onOverlayContainer("mouseset");
this.hideGoogleInfoText()
},redrawLinesIfNeed:function(){this.hideToolTip();
this.redrawLinesIfNeed_processing=true;
this.getXY_Items();
this.getMapBoundsInPixel();
for(var b=0;
b<this.map_items.length;
b++){if(this.map_items[b].type=="line"&&this.map_items[b].last_draw_snapitems_xy){var a=this.map_items[b];
if(this.map_items[b]._optimize_pos_text||a.snapitems[0].xy.x!=a.last_draw_snapitems_xy[0].x||a.snapitems[0].xy.y!=a.last_draw_snapitems_xy[0].y||a.snapitems[1].xy.x!=a.last_draw_snapitems_xy[1].x||a.snapitems[1].xy.y!=a.last_draw_snapitems_xy[1].y){this.onDrawOverlay(this.map_items[b])
}}}this.createBoundTextItems();
this.optimalMoveTextItemsInLine();
this.optimalMoveItemsToTop();
delete this.redrawLinesIfNeed_processing;
this.onOverlayContainer("mouseset")
},moveLines:function(g,h){var d=h[0]-g[0];
var b=h[1]-g[1];
for(var f=0;
f<this.map_items.length;
f++){if(this.map_items[f].type=="line"){var a=this.map_items[f];
for(var c=0;
c<a.divs.length;
c++){a.divs[c].style.left=(parseInt(a.divs[c].style.left)+d)+"px";
a.divs[c].style.top=(parseInt(a.divs[c].style.top)+b)+"px"
}}}},optimalMoveItemsToTop:function(){var a=[];
for(var c=0;
c<this.map_items.length;
c++){if(this.map_items[c].type=="line"&&this.map_items[c]._counts){a.push(this.map_items[c])
}}a.sort(function(f,d){return((f._counts.f+f._counts.r)-(d._counts.f+d._counts.r))
});
for(var c=0;
c<2;
c++){for(var b=0;
b<a.length;
b++){a[b].moveToTop(c)
}}for(var c=0;
c<this.map_items.length;
c++){if(this.map_items[c].type=="bound_text"){this.map_items[c].moveToTop()
}}for(var c=0;
c<this.map_items.length;
c++){if(this.map_items[c].type=="text"){this.map_items[c].moveToTop()
}}},optimalMoveTextItemsInLine:function(){var a=[];
for(var b=0;
b<this.map_items.length;
b++){if(this.map_items[b].type=="bound_text"){var c=new SvgPaint.Bounds;
c.setFromBbox(this.map_items[b]._getBoundTextLTWH());
c.side=this.map_items[b].pos.side;
a.push(c)
}}for(var b=0;
b<this.map_items.length;
b++){if(this.map_items[b].type=="line"&&this.map_items[b].divs[1].style.visibility=="visible"){if(this.map_items[b].svgGroups[1].optimizePosTextBetweenSnapItems(a)){this.map_items[b]._optimize_pos_text=true
}}}},createBoundTextItems:function(){var f={};
for(var d=0;
d<this.map_items.length;
d++){if(this.map_items[d].type=="line"&&this.map_items[d].divs[0].style.visibility=="visible"){var g=this.map_items[d].svgGroups[1].getPosBoundText();
if(g&&g.length){for(var a=0;
a<g.length;
a++){if(!Ext.isDefined(f[g[a].side])){f[g[a].side]=[]
}f[g[a].side].push({items:[this.map_items[d].snapitems[g[a].vect_point=="start"?0:1]],pos:{x:g[a].x,y:g[a].y,side:g[a].side}})
}}}}this.createBoundTextItems_processing=true;
for(var c in f){if(f[c]&&f[c].length){this.agregationBoundItems(c,f[c]);
for(var d=0;
d<f[c].length;
d++){if(f[c][d].items&&f[c][d].items.length){var b=this.addBoundText(f[c][d]);
this.onAddOverlay(b);
this.onDrawOverlay(b)
}}}}delete this.createBoundTextItems_processing
},agregationBoundItems:function(g,c){var a=g=="top"||g=="bottom"?"x":"y";
var l=g=="top"||g=="bottom"?0:1;
for(var h=0;
h<3;
h++){for(var f=0;
f<c.length;
f++){if(c[f].items&&c[f].items.length){c[f].size=c[f].items[0].getSizeBoundText(g,c[f].items)
}else{delete c[f].size
}}for(var f=0;
f<c.length;
f++){for(var d=0;
d<c.length;
d++){if(f!=d&&c[f].items&&c[f].items.length&&c[d].items&&c[d].items.length&&this.checkOverlapBoundItems(g,c[f],c[d])){c[f].pos[a]=(c[f].pos[a]*c[f].items.length+c[d].pos[a]*c[d].items.length)/(c[f].items.length+c[d].items.length);
for(var b=0;
b<c[d].items.length;
b++){c[f].items.push(c[d].items[b])
}delete c[d].items
}}}}},checkOverlapBoundItems:function(d,c,b){var a=d=="top"||d=="bottom"?"x":"y";
var f=d=="top"||d=="bottom"?0:1;
var g=Math.abs(c.pos[a]-b.pos[a]);
if(g<c.size[f]+c.size[f]){return(true)
}else{return(false)
}},setTimeoutDeferFunction:function(a){if(!Ext.isDefined(this._deferTimeoutsId)){this._deferTimeoutsId={}
}this.clearTimeoutDeferFunction();
this._deferTimeoutsId[a]=setTimeout(Ext.bind(function(){delete this._deferTimeoutsId[a];
this[a]()
},this),500)
},clearTimeoutDeferFunction:function(a){if(this._deferTimeoutsId&&this._deferTimeoutsId[a]){clearTimeout(this._deferTimeoutsId[a]);
delete this._deferTimeoutsId[a]
}},isSetTimeoutDeferFunction:function(a){return(this._deferTimeoutsId&&this._deferTimeoutsId[a])
},destroyMapItems:function(c){var d=false;
if(!c){c=["text","line","bound_text"];
d=true
}else{if(!Ext.isArray(c)){c=[c]
}}for(var a=c.length-1;
a>=0;
a--){for(var b=0;
b<this.map_items.length;
b++){if(this.map_items[b].type==c[a]){this.map_items[b].destroy();
if(this.isGoogle()){this.map_items[b].overlay.setMap(null)
}delete this.map_items[b].overlay;
if(!d){this.map_items.splice(b,1);
--b
}}}}if(d){this.initMapItems();
this.agregations.reset()
}},initMapItems:function(){this.last_id_map_item=1;
this.map_items=[];
this.items_id_map={};
this.items_snapitems_id_map={}
},_getXYfromLatLng:function(d,b,a){if(this.isGoogle()){if(!a){a=this.globalOverlay.getProjection()
}return(a.fromLatLngToDivPixel(Ext.isObject(d)?d:this.createLatLng(d,b)))
}else{if(this.isOSM()){var c=this.map.getPixelFromLonLat(Ext.isObject(d)?d:this.createLatLng(d,b));
c.x-=this.map_container_osm.offsetLeft;
c.y-=this.map_container_osm.offsetTop;
return(c)
}}},getXY_Items:function(){var b=["text"];
for(var a=0;
a<this.map_items.length;
a++){if(b.isIn(this.map_items[a].type)){var c=this._getXYfromLatLng(this.map_items[a].coordinates[0],this.map_items[a].coordinates[1]);
this.map_items[a].xy=c
}}},getMapBoundsInPixel:function(){var d=null;
var b=null;
if(this.isGoogle()){var c=this.map.getBounds();
var f=c.getNorthEast();
var a=c.getSouthWest();
d=this._getXYfromLatLng(f);
b=this._getXYfromLatLng(a)
}else{if(this.isOSM()){var c=this.map.getExtent();
var f=new OpenLayers.LonLat(c.right,c.top);
var a=new OpenLayers.LonLat(c.left,c.bottom);
d=this._getXYfromLatLng(f);
b=this._getXYfromLatLng(a)
}}if(!this.bounds_bbox){this.bounds_bbox=new SvgPaint.Bounds
}this.bounds_bbox.setFromCoords(d,b)
},getMapBoundsInCoord:function(){if(this.isGoogle()){var b=this.map.getBounds();
var c=b.getNorthEast();
var a=b.getSouthWest();
return({n:c.lat(),e:c.lng(),s:a.lat(),w:a.lng()})
}else{if(this.isOSM()){var b=this.map.getExtent();
var c=new OpenLayers.LonLat(b.right,b.top);
var a=new OpenLayers.LonLat(b.left,b.bottom);
c=c.transform(this.map.projection,this.map.displayProjection);
a=a.transform(this.map.projection,this.map.displayProjection);
return({n:c.lat,e:c.lon,s:a.lat,w:a.lon})
}}},getCenterCoord:function(){return(this._getXYfromLatLng(0,0))
},getSizeItems:function(){var b=["text"];
for(var a=0;
a<this.map_items.length;
a++){if(b.isIn(this.map_items[a].type)){this.map_items[a].getSize()
}}},createMap2:function(){this.callParent();
if(this.isGoogle()){this.createPrototypeOverlayView()
}this.onAfterCreateMapExt()
},createPrototypeOverlayView:function(){function a(b){google.maps.OverlayView.call(this);
for(var c in google.maps.OverlayView.prototype){this[c]=google.maps.OverlayView.prototype[c]
}this.overlayData=b;
this.overlayData.overlay=this;
this.setMap(b.mapPanel.map)
}a.prototype.onAdd=function(){this.overlayData.mapPanel.onAddOverlay(this.overlayData)
};
a.prototype.draw=function(){this.overlayData.mapPanel.onDrawOverlay(this.overlayData)
};
a.prototype.onRemove=function(){this.overlayData.mapPanel.onRemoveOverlay(this.overlayData)
};
this.prototypeOverlayView=a
},onOverlayContainer:function(d){if(window.event){var g=window.event.xy||[window.event.x,window.event.y];
this.__last_xy=g
}else{if(this.__last_xy){g=this.__last_xy
}else{return
}}var f=document.elementsFromPoint(g[0],g[1]);
var a=[];
for(var c=0;
c<f.length;
c++){if(f[c].id){if(f[c].id==this.map_body_id){break
}a.push(f[c].id)
}}var b=[];
for(var c=0;
c<a.length;
c++){if(this.items_id_map[a[c]]&&!b.isIn(this.items_id_map[a[c]])){b.push(this.items_id_map[a[c]])
}}switch(d){case"click":if(b.length){this.onClick(b)
}break;
case"mouseset":this.hideToolTip();
case"mousemove":this.setCursor(b.length?"pointer":null);
if(b.length){this.showToolTip(b,g);
b[0].moveToTop();
this.__cursor_pointer=true
}else{if(this.__cursor_pointer){delete this.__cursor_pointer;
this.hideToolTip();
this.optimalMoveItemsToTop()
}}break;
case"mouseout":if(!b.length&&this.__cursor_pointer){this.setCursor();
this.hideToolTip();
this.optimalMoveItemsToTop()
}break
}},onClick:function(a){},onClickItem:function(a){debug_log(a.id);
debug_log(a.getAgregationItems())
},showToolTip:function(a,d){if(!a||!a.length){this.hideToolTip();
return
}var b=this.rendererToolTip(a);
if(b){if(b!=this.toolTip._content){this.toolTip.update(b);
if(this.toolTip.currentTarget.dom){this.toolTip.hide()
}this.toolTip.show();
this.toolTip._content=b;
var c=getSizeHtml(b,true);
this.toolTip._content_width=c[0]+10;
this.toolTip._content_height=c[1]+10
}this.toolTip.setWidth(this.toolTip._content_width);
this.toolTip.setHeight(this.toolTip._content_height);
if(d[0]&&d[1]){if(d[0]>Ext.dom.Element.getViewportWidth()/2){d[0]-=this.toolTip._content_width+20
}else{d[0]+=20
}this.toolTip.setPosition(d[0],d[1]+20);
Ext.defer(function(){this.toolTip.setPosition(d[0],d[1]+20)
},1,this)
}}else{this.hideToolTip()
}},hideToolTip:function(){if(this.toolTip._content){this.toolTip.update(null);
this.toolTip.hide();
delete this.toolTip._content
}delete this.toolTip._content_ids
},rendererToolTip:function(a){var d=[];
for(var c=0;
c<a.length;
c++){d.push(a[c].id)
}var f=d.join(",");
if(f==this.toolTip._content_ids){return(this.toolTip._content)
}var b=this._rendererToolTip(f,a);
if(window.debug){b+=(this.testMap?"<div>":'<div style="padding-left: 3; padding-top: 6; color: grey; font-size: 80%;">')+d.join("; ")+"</div>"
}return(b)
},_rendererToolTip:function(C,s){var B=20;
var f=true;
this.toolTip._content_ids=C;
var q="";
var d={};
var c={};
var r=[];
var b=null;
var g=null;
for(var A=0;
A<s.length;
A++){if(s[A].type=="bound_text"){for(var y=0;
y<s[A].textItems.length;
y++){s.push(s[A].textItems[y])
}s.splice(A,1);
--A
}}var E=s[0].type;
switch(E){case"text":for(var A=0;
A<s.length;
A++){if(s[A].type!="text"){continue
}var k=s[A].getAgregationItems();
for(var y=0;
y<k.length;
y++){var D=k[y];
var t=D.getLocationId();
var G=null;
if(Ext.isDefined(d[t])){G=d[t]
}else{G={item:D,counts:{f:0,r:0}};
d[t]=G
}G.counts.f+=D.counts.f;
G.counts.r+=D.counts.r
}var F=s[A].getLinesInAgregationItems();
for(var y=0;
y<F.length;
y++){r.push(F[y])
}}var p=[];
for(var A in d){p.push(d[A])
}p.sort(function(M,L){return((L.counts.f+L.counts.r)-(M.counts.f+M.counts.r))
});
for(var A=0;
A<Math.min(B,p.length);
A++){var D=p[A];
var a=D.item._getCountConfig(D.counts.f);
var z=D.item._getCountConfig(D.counts.r);
if(!b){b='<table callpadding=0 cellspacing=0 border=0 style="'+getHtmlStyle({"font-size":10,border:"none","border-collapse":"collapse",padding:0,margin:0})+'">'
}b+='<tr><td style="'+getHtmlStyle({"white-space":"nowrap"})+'">'+D.item.getLocationContent()+'<td style="'+getHtmlStyle({"white-space":"nowrap"})+'">'+(D.counts.r?"&nbsp;&nbsp;&nbsp;IN":"")+'<td style="'+getHtmlStyle({"text-align":"right",color:z&&z.color||"black"})+'">'+(D.counts.r?D.counts.r:"")+'<td style="'+getHtmlStyle({})+'">'+(D.counts.f?"&nbsp;&nbsp;&nbsp;OUT":"")+'<td style="'+getHtmlStyle({"text-align":"right",color:a&&a.color||"black"})+'">'+(D.counts.f?D.counts.f:"")
}if(p.length>B){b+='<tr><td colspan=5 style="color: dimgrey;">... hide #'+(p.length-B)
}if(b){b+="</table>"
}if(!f){break
}case"line":if(E!="text"){for(var A=0;
A<s.length;
A++){if(s[A].type!="line"){continue
}var k=s[A].getAgregationItems();
for(var y=0;
y<k.length;
y++){r.push(k[y])
}}}for(var A=0;
A<r.length;
A++){var J=false;
var n=r[A];
if(n.reverse){n=n.item;
J=true
}var m=n.snapitems[0].getLocationId()+"/"+n.snapitems[1].getLocationId();
var o=n.snapitems[1].getLocationId()+"/"+n.snapitems[0].getLocationId();
if(J){var I=m;
m=o;
o=I
}var v=null;
if(Ext.isDefined(c[m])){v=c[m]
}else{if(Ext.isDefined(c[o])){v=c[o];
J=!J
}else{v={src:n.snapitems[J?1:0],dst:n.snapitems[J?0:1],rev:J,counts:{f:0,r:0}};
c[m]=v
}}if(J){v.counts.f+=n.counts.r;
v.counts.r+=n.counts.f
}else{v.counts.f+=n.counts.f;
v.counts.r+=n.counts.r
}}var u=[];
for(var A in c){u.push(c[A])
}u.sort(function(M,L){return((L.counts.f+L.counts.r)-(M.counts.f+M.counts.r))
});
for(var A=0;
A<Math.min(B,u.length);
A++){var n=u[A];
if(!g){g='<table callpadding=0 cellspacing=0 border=0 style="'+getHtmlStyle({"font-size":10,border:"none","border-collapse":"collapse",padding:0,margin:0})+'">'
}var h;
var K;
var H;
if(n.dst.location.priv&&!n.src.location.priv){h=n.dst;
K=n.src;
H={f:n.counts.r,r:n.counts.f}
}else{h=n.src;
K=n.dst;
H=n.counts
}var l=false;
var a=null;
var z=null;
var w=null;
if(h.getLocationContent()==K.getLocationContent()){l=true;
w=h._getCountConfig(H.f+H.r)
}else{a=h._getCountConfig(H.f);
z=K._getCountConfig(H.r)
}g+='<tr><td style="'+getHtmlStyle({"white-space":"nowrap"})+'">'+h.getLocationContent()+(l?('<td colspan=2 style="'+getHtmlStyle({"white-space":"nowrap","text-align":"center"})+'">'+(H.f+H.r?'---> <span style="'+getHtmlStyle({color:w&&w.color||"black"})+'">'+(H.f+H.r)+"</span> <---":"")):('<td style="'+getHtmlStyle({"white-space":"nowrap","text-align":"right"})+'">'+(H.f?'--- <span style="'+getHtmlStyle({color:a&&a.color||"black"})+'">'+H.f+"</span> ->":"")+'<td style="'+getHtmlStyle({"white-space":"nowrap","text-align":"left"})+'">'+(H.r?'<- <span style="'+getHtmlStyle({"text-align":"right",color:z&&z.color||"black"})+'">'+H.r+"</span> ---":"")))+'<td style="'+getHtmlStyle({"white-space":"nowrap"})+'">'+K.getLocationContent()
}if(u.length>B){g+='<tr><td colspan=4 style="color: dimgrey;">... hide #'+(u.length-B)
}if(g){g+="</table>"
}break
}if(b){q+=b
}if(g){if(b){q+='<div style="height: 6"></div>'
}q+=g
}return(q)
},setCursor:function(a){this.map.setOptions({draggableCursor:a||""})
},createOverlay:function(a){Ext.applyIf(a,{mapPanel:this});
if(this.isGoogle()){return(new this.prototypeOverlayView(a))
}else{if(this.isOSM()){return(this.createOverlayItem_osm(a))
}}},createOverlayLayer_osm:function(){if(!this.map_layer_boxes){this.map_layer_boxes=new OpenLayers.Layer.Boxes("boxes");
this.map.addLayer(this.map_layer_boxes);
this.overlayContainer=this.map_layer_boxes.div;
this.setOverlayContainerListeners()
}},createOverlayItem_osm:function(b){var a=null;
this.createOverlayLayer_osm();
this.createOverlayDivs(b);
this.onDrawOverlay(b);
return(b)
},createOverlayDivs:function(a){a.divs=[];
a.divs.push(document.createElement("div"));
a.divs[0].setAttribute("id",a.id);
a.divs[0].style.position="absolute";
this.overlayContainer.appendChild(a.divs[0]);
if(a.type=="line"){a.divs.push(document.createElement("div"));
a.divs[1].setAttribute("id",a.id+"_next1");
a.divs[1].style.position="absolute";
this.overlayContainer.appendChild(a.divs[1])
}},setOverlayContainerListeners:function(){var a=this;
if(this.isGoogle()){this.overlayContainer.addEventListener("click",function(){a.onOverlayContainer("click")
});
this.overlayContainer.addEventListener("mousemove",function(){a.onOverlayContainer("mousemove")
});
this.overlayContainer.addEventListener("mouseout",function(){a.onOverlayContainer("mouseout")
});
this.overlayContainer.parentNode.parentNode.addEventListener("mousemove",function(){a._mouseIn=true
});
this.overlayContainer.parentNode.parentNode.addEventListener("mouseout",function(){if(a._mouseIn){delete a._mouseIn
}})
}else{if(this.isOSM()){this.overlayContainer.parentNode.addEventListener("click",function(){a.onOverlayContainer("click")
});
this.overlayContainer.parentNode.addEventListener("mousemove",function(){a.onOverlayContainer("mousemove");
a._mouseIn=true
});
this.overlayContainer.parentNode.addEventListener("mouseout",function(){a.onOverlayContainer("mouseout");
if(a._mouseIn){delete a._mouseIn
}})
}}},onAddOverlay:function(a){if(a.globalOverlay){return
}if(Ext.isDefined(a.divs)){return
}if(!this.overlayContainer){this.overlayContainer=a.overlay.getPanes().overlayMouseTarget;
this.setOverlayContainerListeners()
}this.createOverlayDivs(a)
},onDrawOverlay:function(M){if(M.globalOverlay){this._coord=this.getCenterCoord();
this._bounds=this.getMapBoundsInCoord();
if(this._dragend_flag){if(!this._coord||!this._dragstart_center_coord||this._coord[0]!=this._dragstart_center_coord[0]||this._coord[1]!=this._dragstart_center_coord[1]){this.moveLines(this._dragstart_center_coord,this._coord);
delete this._dragend_flag;
delete this._dragstart_center_coord
}}return
}if(this.isSetTimeoutDeferFunction("redrawMapItems")||!M.divs){return
}switch(M.type){case"line":if(!this.redrawMapItems_processing&&!this.redrawLinesIfNeed_processing){return
}else{if(this._dragend_flag){delete this._dragend_flag
}}break;
case"bound_text":if(!this.createBoundTextItems_processing){return
}else{if(this._dragend_flag){delete this._dragend_flag
}}break
}M.destroySvg();
switch(M.type){case"text":if(!M.isAgregation()||M.isAgregationMainItem()){M.show()
}else{if(M.svgPainters){for(var J=0;
J<M.svgPainters.length;
J++){M.svgPainters[J].destroySvg()
}}M.hide();
return
}break;
case"bound_text":break;
case"line":var d=this.findMapItemById(M.snapitems_id[0]);
var c=this.findMapItemById(M.snapitems_id[1]);
var v=false;
if(d&&c&&d.id!=c.id){if(!d.isAgregation()&&!c.isAgregation()){M.show();
v=true
}else{var E=M.getAgregationItems();
if(E[0].id==M.id){if(d.isAgregation()){d=d.getAgregationMainItem()
}if(c.isAgregation()&&!c.isAgregationMainItem()){c=c.getAgregationMainItem()
}if(d.agregation_index!=c.agregation_index){M.show();
v=true
}}}}if(!v){if(M.svgPainters){for(var J=0;
J<M.svgPainters.length;
J++){M.svgPainters[J].destroySvg()
}}M.hide();
return
}break
}var H=null;
if(this.isGoogle()){H=M.overlay.getProjection()
}var G=100;
var g=this.scale||100;
if((M.type=="text"||M.type=="bound_text")){var L=M.backgroundConfig||(M.type=="text"?this.configData.background.text:M.type=="bound_text"?this.configData.background.bound_text:{});
if(!M.div_background){M.div_background=document.createElement("div");
M.div_background.setAttribute("id",M.id+"_background");
M.divs[0].appendChild(M.div_background);
if(Ext.isDefined(L.fill)){M.div_background.style.backgroundColor=L.fill
}if(M._svg){M.div_background.style.position="absolute"
}else{M.div_background.style.padding=L.padding
}if(Ext.isDefined(L.opacity)){M.div_background.style.opacity=L.opacity
}}}if(M.type=="text"&&M._svg||M.type=="line"){if(!M.svgPainters){M.svgPainters=[];
M.svgPainters.push(new GMap.SvgPainter({svgContainer:M.divs[0],scale:G}));
if(M.type=="line"){M.svgPainters.push(new GMap.SvgPainter({svgContainer:M.divs[1],scale:G}))
}}else{for(var J=0;
J<M.svgPainters.length;
J++){M.svgPainters[J].resetSvg({scale:G})
}}var w=[];
w.push(new GMap.SvgItemsContainer({prefix_id:M.id,map:this}));
w[0].setPainter(M.svgPainters[0]);
if(M.type=="line"){w.push(new GMap.SvgItemsContainer({prefix_id:M.id+"_next1",map:this}));
w[1].setPainter(M.svgPainters[1])
}}else{if((M.type=="text"||M.type=="bound_text")&&!M.div_content){M.div_content=document.createElement("div");
M.div_content.setAttribute("id",M.id+"_content");
M.div_background.appendChild(M.div_content)
}}switch(M.type){case"text":var K=M.getAgregation();
var z=this._getXYfromLatLng(M.coordinates[0],M.coordinates[1]);
var f=z.x;
var l=z.y;
var a;
var b;
if(M._svg){var y=M.getMainText();
var Q={text:y||M.text,"text-anchor":"middle"};
if(M.textConfig){Ext.applyIf(Q,M.textConfig)
}Ext.applyIf(Q,{x:0,y:0,fill:"#000000"});
if(g!=100&&Q["font-size"]){Q["font-size"]*=g/100
}if(!Ext.isDefined(M.svgItems)){M.svgItems=[]
}var t=w[0].addItem("text","text",Q,{enable_line:true,no_events:true});
var r=t.getBBox();
a=r.width*G/100;
b=r.height*G/100;
f-=a/2;
l-=b/2;
M.divs[0].style.left=f+"px";
M.divs[0].style.top=l+"px";
M.divs[0].style.width=a+"px";
M.divs[0].style.height=b+"px";
M.svgPainters[0].svg.setAttribute("width",a);
M.svgPainters[0].svg.setAttribute("height",b);
t.moveXY([r.width/2,0]);
M.svgItems.push(t)
}else{if(this.redrawMapItems_processing){M.div_content.innerHTML=M.renderer({scale:g,maxShowItems:this.maxShowItemsInAgregation})
}a=M.div_content.offsetWidth;
b=M.div_content.offsetHeight;
f-=a/2;
l-=b/2;
M.divs[0].style.left=f+"px";
M.divs[0].style.top=l+"px"
}if(M.div_background){var N=L.padding||0;
if(g!=100){N*=g/100
}if(M._svg){M.div_background.style.left=-N+"px";
M.div_background.style.top=-N+"px";
M.div_background.style.width=a+(N*2)+"px";
M.div_background.style.height=b+(N*2)+"px"
}}break;
case"bound_text":M.div_content.innerHTML=M.textItems[0].renderer({side:M.pos.side,scale:g,items:M.textItems,boundText:true,disableInternalCalls:true,disableNextItems:true,maxShowItems:this.maxShowItemsInBoundsAgregation});
var a=M.div_content.offsetWidth;
var b=M.div_content.offsetHeight;
var f=M.pos.x-a/2;
var l=M.pos.y-b/2;
switch(M.pos.side){case"left":f+=a/2;
break;
case"right":f-=a/2+4;
break;
case"top":l+=b/2;
break;
case"bottom":l-=b/2+4;
break
}M.divs[0].style.left=f+"px";
M.divs[0].style.top=l+"px";
break;
case"line":M.last_draw_snapitems_xy=[d.xy,c.xy];
var o=M.getCountConfig();
var F=w[0].beginGroup("line_between_items");
M.group_id=w[0].group.id;
w[0].addGroupSnapItem(d);
w[0].addGroupSnapItem(c);
var n={};
if(M.lineConfig){Ext.applyIf(n,M.lineConfig)
}if(o){n.stroke=o.lineConfig.stroke;
n["stroke-width"]=o.lineConfig["stroke-width"]
}if(g!=100){n["stroke-width"]=roundNumber(n["stroke-width"]*g/100,1)
}var u=M.getCounts();
if(M.arrowConfig){if(M.arrowConfig.from&&(!u||u.r)){var D=M.arrowConfig.from.size||1;
var p=(o&&o.arrowConfig.from.stroke)||M.arrowConfig.from.stroke||"#000000";
var A=(o&&o.arrowConfig.from.fill)||M.arrowConfig.from.fill||"white";
if(g!=100){D=roundNumber(D*g/100,1)
}M.svgPainters[0].addDefArrowColor("start",p,D,A);
if(p[0]=="#"){p=p.substr(1)
}Ext.applyIf(n,{"marker-start":"url(#arrow-start-c"+p+"-w"+D+")"})
}if(M.arrowConfig.to&&(!u||u.f)){var s=M.arrowConfig.to.size||1;
var q=(o&&o.arrowConfig.to.stroke)||M.arrowConfig.to.stroke||"#000000";
var k=(o&&o.arrowConfig.to.fill)||M.arrowConfig.to.fill||"white";
if(g!=100){s=roundNumber(s*g/100,1)
}M.svgPainters[0].addDefArrowColor("end",q,s,k);
if(q[0]=="#"){q=q.substr(1)
}Ext.applyIf(n,{"marker-end":"url(#arrow-end-c"+q+"-w"+s+")"})
}}w[0].addItem("line_background","line",{"stroke-width":n["stroke-width"]+4,stroke:"white","stroke-opacity":0.6},{no_events:true});
w[0].addItem("line","line",n,{no_events:true});
var B=w[1].beginGroup("line_between_items",{lineGroup:F});
B.bounds_bbox=this.bounds_bbox;
M.group_id=w[1].group.id;
w[1].addGroupSnapItem(d);
w[1].addGroupSnapItem(c);
var Q={"text-anchor":"middle"};
if(M.textConfig){Ext.applyIf(Q,M.textConfig)
}Ext.applyIf(Q,{fill:"#000000"});
if(o){Q["font-size"]=o.textConfigInv["font-size"];
Q.fill=o.textConfigInv.fill;
Q["font-weight"]=o.textConfigInv["font-weight"]
}var L={fill:"white","fill-opacity":0.6};
if(o){L.fill=o.textConfigInv["background-fill"];
L["fill-opacity"]=o.textConfigInv["background-opacity"]
}if(g!=100&&Q["font-size"]){Q["font-size"]*=g/100
}var C=M.getCenterFromText();
if(C||M.textCenterFrom){Q.text=C||M.textCenterFrom;
if(d.xy.x>c.xy.x){Q.text+=" >"
}else{Q.text="< "+Q.text
}w[1].addItem("text_background_center_start","rect",L,{no_events:true,disableRoundPos:true,redukY:0,redukHeight:1});
w[1].addItem("text_center_start","text",Q,{no_events:true,disableRoundPos:true,leftRightMargin:5})
}var h=M.getCenterToText();
if(h||M.textCenterTo){Q.text=h||M.textCenterTo;
if(d.xy.x>c.xy.x){Q.text="< "+Q.text
}else{Q.text+=" >"
}w[1].addItem("text_background_center_end","rect",L,{no_events:true,disableRoundPos:true,redukY:0,redukHeight:1});
w[1].addItem("text_center_end","text",Q,{no_events:true,disableRoundPos:true,leftRightMargin:5})
}var y=M.getMainText(u);
if(y||M.text){Q.text=y||M.text;
w[1].addItem("text_base","text",Q,{no_events:true})
}if(M.textFrom){var O={text:M.textFrom,"text-anchor":"middle"};
if(M.textFromConfig){Ext.applyIf(O,M.textFromConfig)
}Ext.applyIf(O,{fill:"#000000"});
if(g!=100&&O["font-size"]){O["font-size"]*=g/100
}w[1].addItem("text_marker_start","text",O,{no_events:true})
}if(M.textTo){var P={text:M.textTo,"text-anchor":"middle"};
if(M.textToConfig){Ext.applyIf(P,M.textToConfig)
}Ext.applyIf(P,{fill:"#000000"});
if(g!=100&&P["font-size"]){P["font-size"]*=g/100
}w[1].addItem("text_marker_end","text",P,{no_events:true})
}if(!Ext.isDefined(M.svgGroups)){M.svgGroups=[]
}var m=[];
for(var J=0;
J<2;
J++){m[J]=w[J].pushGroup()
}var r=m[0].getBBox(null,null,[m[1]]);
var I=10;
if(g!=100){I*=g/100
}var f=r.x-I;
var l=r.y-I;
var a=r.width+(I*2);
var b=r.height+(I*2);
for(var J=0;
J<2;
J++){M.divs[J].style.left=f+"px";
M.divs[J].style.top=l+"px";
M.divs[J].style.width=a+"px";
M.divs[J].style.height=b+"px";
M.svgPainters[J].svg.setAttribute("width",a);
M.svgPainters[J].svg.setAttribute("height",b);
m[J].shiftXY([-f,-l]);
M.svgGroups.push(m[J])
}if(M._optimize_pos_text){delete M._optimize_pos_text
}break
}M.setItemsIdMap()
},onRemoveOverlay:function(b){b.destroy();
for(var a=0;
a<b.divs.length;
a++){b.divs[a].parentNode.removeChild(b.divs[a])
}},newIdMapItem:function(){return("map_"+String(GMap.Panel.map_id).lpad(6,"0")+"_item_"+String(this.last_id_map_item++).lpad(6,"0"))
},onMissingGeoipData:function(a){Ext.Msg.confirm(this.findLangS("msgbox","missingDataHeader"),this.findLangS("msgbox","missingDataText"),function(b){if(b=="yes"){this.downloadGeoipData(a)
}},this)
},onObsoleteGeoipData:function(a){Ext.Msg.confirm(this.findLangS("msgbox","obsoleteDataHeader"),this.findLangS("msgbox","obsoleteDataText"),function(b){if(b=="yes"){this.downloadGeoipData(a)
}else{this.createLcMap(a)
}},this)
},onIncompleteGeoipData:function(a){Ext.Msg.confirm(this.findLangS("msgbox","incompleteDataHeader"),this.findLangS("msgbox","incompleteDataText"),function(b){if(b=="yes"){this.downloadGeoipData(a)
}else{this.createLcMap(a)
}},this)
},onMissingInternationalRules:function(a){if(user_is_admin()){Ext.Msg.confirm(this.findLangS("msgbox","missingInternationalRulesHeader"),this.findLangS("msgbox","missingInternationalRulesQuestion"),function(b){if(b=="yes"){this.setInternationalRules(a)
}},this)
}else{Ext.Msg.alert(this.findLangS("msgbox","missingInternationalRulesHeader"),this.findLangS("msgbox","missingInternationalRulesText"))
}},downloadGeoipData:function(b){var a=this;
Tools.DownloadData.downloadGeoipCity(function(c,f,d){Tools.DownloadData.applyGeoipCityFile(c,function(g){a.createLcMap(b)
},null,f,d,true)
},null,{},this)
},createLcMap:function(r,s,g){if(!Ext.isDefined(this.createLcMap_counter)){this.createLcMap_counter=1
}else{++this.createLcMap_counter
}if(this.getCallerBy()=="ip"||this.getCalledBy()=="ip"){if(!Ext.isDefined(this.createLcMap_byIP_counter)){this.createLcMap_byIP_counter=1
}else{++this.createLcMap_byIP_counter
}}var q=1000;
var m=100;
var h=1;
if(!s){if(this._timeoutRefreshId){clearInterval(this._timeoutRefreshId);
this._timeoutRefreshId=null
}ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"spyMap",params:Ext.encode({selectSensors:this.selectSensors,callerIdType:this.getCallerBy(),calledIdType:this.getCalledBy(),maxNoPrivLocations:q,firstLoad:this.createLcMap_counter==1,firstLoadByIP:(this.getCallerBy()=="ip"||this.getCalledBy()=="ip")&&this.createLcMap_byIP_counter==1})},success:function(v){if(!this.map){return
}if(v.err=="missing_geoip_data"){this.onMissingGeoipData(r)
}else{if(v.err=="obsolete_geoip_data"){this.onObsoleteGeoipData(r)
}else{if(v.err=="incomplete_geoip_data"){this.onIncompleteGeoipData(r)
}else{if(v.err=="missing_international_rules"){this.onMissingInternationalRules(r)
}else{this.createLcMap(r,v.map,v.missing_priv_type)
}}}}},scope:this,maskEl:r&&r.mask?this:undefined});
return
}if(Object.keys(g).length){var n="";
for(var u in g){n+=u+": "+g[u]+" found ips<br>"
}Ext.Msg.confirm(this.findLangS("msgbox","missingCoordinatesForPrivHeader"),this.findLangS("msgbox","missingCoordinatesForPrivText")+"<br><br>"+n+"<br><br>"+this.findLangS("msgbox","missingCoordinatesForPrivQuestion"),function(v){if(v=="yes"){this.setCustomerGeoIP({onClose:function(w){if(w){this.createLcMap(r)
}},onCloseScope:this})
}},this)
}this.destroyMapItems();
if(s.length){this._suppressEvZoomChanged=true;
if(r&&r.zoom){this.setZoom(r.zoom)
}if(r&&r.autoCenter||this.autoCenter&&(!Ext.isFunction(this.autoCenter)||this.autoCenter())){var f=[];
for(var l=0;
l<Math.min(10,s.length);
l++){if(!f.isIn(s[l].caller)){f.push(s[l].caller)
}if(!f.isIn(s[l].called)){f.push(s[l].called)
}}for(var l=0;
l<f.length;
l++){f[l]=Ext.decode(f[l]);
f[l]=this.createLatLng(f[l].lat,f[l].lng)
}this.fitBounds(f,this.zoom_default,true)
}delete this._suppressEvZoomChanged
}var t=this;
var p=[];
var b={};
var d={};
for(var l=0;
l<s.length;
l++){if(s[l].count_both>=h){c(s[l].caller,s[l].count,s[l].count_r);
c(s[l].called,s[l].count_r,s[l].count)
}}for(var l=0;
l<Math.min(p.length,m);
l++){var o=a(p[l]);
d[p[l]]=o.id
}for(var l=0;
l<s.length;
l++){if(s[l].count_both>=h){k(s[l])
}}this.redrawMapItems_forceConfig={checkExistsDivsOnAllMapItems:true,waitForFixMap:{coord:this.getCenterCoord(),bounds:this.getMapBoundsInCoord()}};
this.setTimeoutDeferFunction("redrawMapItems");
if(this.onCreateMap){this.onCreateMap.call(this.onCreateMapScope)
}if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}function c(w,y,v){if(!p.isIn(w)){p.push(w);
b[w]={count:y,count_r:v}
}else{b[w].count+=y;
b[w].count_r+=v
}}function a(v){var w=Ext.decode(v);
return(t.addText({coordinates:[w.lat,w.lng],text:v.priv?(w.descr_wrap||w.descr):(w.city?w.city+" ("+w.country+")":w.country),textConfig:v.priv?{"font-weight":"normal","font-size":10,fill:"red"}:{"font-weight":w.city?"normal":"bold","font-size":w.city?10:10,fill:w.city?"blue":"green"},background:{fill:"white",opacity:0.95,padding:2},location_e:v,location:Ext.decode(v),counts:{f:b[v].count,r:b[v].count_r}}))
}function k(v){if(!d[v.caller]||!d[v.called]){return
}t.addLine({betweenIdItems:[d[v.caller],d[v.called]],lineConfig:{stroke:"black","stroke-width":1},textConfig:{"font-weight":"normal","font-size":10,fill:"black"},arrowConfig:{from:v.count_r>0||true?{size:1,stroke:"black",fill:"black"}:undefined,to:v.count>0||true?{size:1,stroke:"black",fill:"black"}:undefined},counts:{f:v.count,r:v.count_r}})
}},createTestMap:function(){this.addText({svg:true,id:"test_text_1",coordinates:[49.388143,14.690162],text:"test text 1",textConfig:{"font-weight":"bold","font-size":20,fill:"red"},background:{fill:"green",opacity:0.5,padding:5}});
this.addText({svg:true,id:"test_text_2",coordinates:[49.389443,14.690162],text:"test text 2",textConfig:{"font-weight":"bold"},background:{fill:"red",opacity:0.5,padding:5}});
this.addText({svg:true,id:"test_text_3",coordinates:[49.388143,14.685162],text:"test text 3",textConfig:{"font-weight":"bold"},background:{fill:"red",opacity:0.5,padding:5}});
this.addText({svg:true,id:"test_text_4",coordinates:[49.389443,14.685162],text:"test text 4",textConfig:{"font-weight":"bold"},background:{fill:"red",opacity:0.5,padding:5}});
this.addLine({id:"test_line_1",betweenIdItems:["test_text_1","test_text_2"],lineConfig:null,textCenterFrom:"START",textCenterTo:"END",textConfig:null,arrowConfig:{from:false,to:true},textFrom:"start",textTo:"end"});
this.addLine({id:"test_line_2",betweenIdItems:["test_text_1","test_text_3"],lineConfig:null,textCenterFrom:"START",textCenterTo:"END",textConfig:null,arrowConfig:{from:false,to:true},textFrom:"start",textTo:"end"});
this.addLine({id:"test_line_3",betweenIdItems:["test_text_1","test_text_4"],lineConfig:null,textCenterFrom:"START",textCenterTo:"END",textConfig:null,arrowConfig:{from:false,to:true},textFrom:"start",textTo:"end"});
this.redrawMapItems({checkExistsDivsOnAllMapItems:true})
},setLineColors:function(){new GMap.Tools.LineColors({data:this.configData.count,onOk:function(a){this.configData.count=a;
this.redrawMapItems();
window.gmap_spy_line_colors=Ext.encode(a);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"gmap",name:"spy_line_colors",config:window.gmap_spy_line_colors,user_id:user_id(),enableUpdate:true})}});
return(true)
},onOkScope:this,onCancel:function(a){this.configData.count=a;
this.redrawMapItems();
return(true)
},onCancelScope:this,onChange:function(a){this.configData.count=a;
this.redrawMapItems();
return(true)
},onChangeScope:this,_autoShowWindow:true})
},setInternationalRules:function(d){var a=new CommonSettings.InternationalRules({onSave:b,onSaveScope:this});
var c=new Ext.Window({title:this.findLangS("title","internationalRules"),closable:true,maximizable:true,resizable:true,layout:"fit",width:Math.min(650,Ext.dom.Element.getViewportWidth()-50),height:Math.min(500,Ext.dom.Element.getViewportHeight()-50),items:a,modal:true});
c.show();
function b(){c.close();
if(d){this.createLcMap(d)
}else{this.reload(true)
}}},setTimeoutRefreshInterval:function(a){if(this._timeoutRefreshId){clearTimeout(this._timeoutRefreshId);
this._timeoutRefreshId=null
}this._timeoutRefreshInterval=a.getValue();
if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}},timeoutRefreshReload:function(){if(this._timeoutRefreshId){clearTimeout(this._timeoutRefreshId);
this._timeoutRefreshId=null
}if((!this.enableAutoReload||this.enableAutoReload())&&(this.window?Ext.WindowMgr.zIndexStack.last()==this.window:!Ext.WindowMgr.zIndexStack.last())){this.reload()
}else{if(this._timeoutRefreshInterval){this._timeoutRefreshId=setTimeout(Ext.bind(this.timeoutRefreshReload,this),this._timeoutRefreshInterval*1000)
}}}});
Ext.define("GMap.SvgItemsContainer",{extend:"SvgPaint.ItemsContainer",constructor:function(a){a=Ext.applyIf(a||{},{});
this.callParent([a])
},createPainter:function(){this.painter=new GMap.SvgPainter
},setPainter:function(a){this.painter=a
},_getCountLinesBetweenSnapItems:function(g,c,a){var b=0;
for(var d=0;
d<this.map.map_items.length;
d++){if(this.map.map_items[d].type=="line"&&this.map.map_items[d].snapitems_id[0]!=this.map.map_items[d].snapitems_id[1]&&this.map.map_items[d].cmpSnapItems(g)){if(c&&c==this.map.map_items[d].group_id){return(b)
}if(a){var f=this.map.map_items[d].getHeightForLineBetweenSnapItems();
b+=f[0]+f[1]
}else{++b
}}}return(b)
}});
Ext.define("GMap.SvgPainter",{extend:"SvgPaint.Painter_functions",xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",constructor:function(a){if(a){Ext.apply(this,a)
}if(!this.svgContainer){this.svgContainer=document.createElement("div")
}this.createSvg()
},createSvg:function(a){if(a){Ext.apply(this,a)
}this.svg=document.createElementNS(this.xmlns,"svg");
if(this.width){this.svg.setAttribute("width",this.width)
}if(this.height){this.svg.setAttribute("height",this.height)
}this.defs=this.svg.insertBefore(document.createElementNS(this.xmlns,"defs"),this.svg.firstChild);
this.svgG=document.createElementNS(this.xmlns,"g");
if(!this.scale){this.scale=100
}this.svgG.setAttributeNS(null,"transform","scale("+(this.scale/100)+","+(this.scale/100)+")");
this.svgContainer.appendChild(this.svg);
this.svg.appendChild(this.svgG)
},destroySvg:function(){if(!this.svg){return
}this.svg.removeChild(this.svgG);
delete this.svgG;
this.svgContainer.removeChild(this.svg);
delete this.svg
},resetSvg:function(a){this.destroySvg();
this.createSvg(a)
},evChange:function(){}});
Ext.define("GMap.Tools.LineColors",{extend:"Ext.form.Panel",subsystem:"gmap",constructor:function(a){if(!a){a={}
}this.data_backup=cloneObject(a.data);
this.lineColorsFields=[{name:"count_ge",type:"integer"},{name:"color"},{name:"strokeWidth",type:"integer"},{name:"fontSize",type:"integer"},{name:"fontBold",type:"bool"}];
var k="GMap.Tools.LineColors_store";
if(!Ext.ClassManager.isCreated(k)){Ext.define(k,{extend:"Ext.data.Model",fields:this.lineColorsFields})
}var n=new Ext.data.ArrayStore({model:k,sorters:{property:"count_ge",direction:"ASC"},data:[]});
var f=[{xtype:"actioncolumn",text:" ",width:20,rendererBase:function(t,p,q,u,s,r){p.style="padding-bottom: 0; padding-top: 1; padding-left: 3;";
return("")
},sortable:false,items:[{getClass:function(p,q,r){return("icon_delete_small")
},handler:function(q,u,p,r,s){var t=q.store.getAt(u);
Ext.Msg.confirm("",this.findLangS("text","removeRowQuestion"),function(v){if(v=="yes"){this.deleteLineColor(t)
}},this)
},enableHandler:function(s,t,u,w,p,r,q){return(true)
},tooltip:this.findLangS("tooltip","delete_row"),scope:this}]},{dataIndex:"count_ge",width:__width_ColumnNum(7)},{dataIndex:"color",width:__width_ColumnChar(10),renderer:function(u,p,r,v,t,s,q){return(u?'<span style="color: '+u+'";>'+u+"</span>":"")
},sortable:false},{dataIndex:"strokeWidth",width:__width_ColumnNum(7)},{dataIndex:"fontSize",width:__width_ColumnNum(7)},{dataIndex:"fontBold",renderer:renderTick,flex:1}];
for(var d=0;
d<f.length;
d++){if(!f[d].text){f[d].text=this.findLangS("column",f[d].dataIndex,2)
}}var o=new Ext.grid.Panel({store:n,columns:f,height:170,width:330,viewConfig:{stripeRows:false}});
this.lineColorsGrid=o;
o.selModel.on("selectionchange",function(p){var q=p.getSelection();
this.evLineColorsGridSelection(q)
},this);
var h=[{name:"count_ge",xtype:"numberfield",value:null,minValue:0,_width:11},{name:"color",xtype:"colorpickerfield",_width:11},{name:"strokeWidth",xtype:"numberfield",value:null,minValue:1,maxValue:6,_width:11},{name:"fontSize",xtype:"numberfield",value:null,minValue:8,maxValue:20,_width:11},{name:"fontBold",xtype:"checkbox",value:null}];
for(var d=0;
d<h.length;
d++){h[d].fieldLabel=this.findLangS("field",h[d].name,2)||this.findLangS("column",h[d].name);
var g=12;
if(!h[d].width&&h[d]._width){h[d].width=__width_FormChar(h[d]._width,g)
}if(!h[d].labelWidth){h[d].labelWidth=__width_FieldChar(g)
}}var m=[{xtype:"button",text:this.findLangS("button","add"),iconCls:"icon_add",handler:function(){if(this.checkFieldsLineColor()){this.addLineColor()
}},scope:this,_btnId:"add"},{width:5,border:false},{xtype:"button",text:this.findLangS("button","save"),iconCls:"icon_save",handler:function(){if(this.checkFieldsLineColor()){this.modifyLineColor()
}},scope:this,_btnId:"modify",disabled:true},{width:5,border:false},{xtype:"button",text:this.findLangS("button","remove"),iconCls:"icon_remove",handler:function(){this.deleteLineColor()
},scope:this,_btnId:"remove",disabled:true}];
var b={xtype:"container",layout:"hbox",items:[o,{width:5,border:false},{xtype:"container",layout:{type:"vbox",align:"center"},items:[{xtype:"container",defaultType:"textfield",items:h},{height:6,border:false},{xtype:"container",layout:"hbox",items:m}]}]};
var l=[{xtype:"panel",items:b,border:false,bodyStyle:{"background-color":__color_FormBackground}}];
if(a.onOk||a.onCancel){var c=[];
if(a.onOk){c.push({xtype:"button",iconCls:"icon_ok",text:lang.okButtonText,handler:function(){var q=this.getConfigData();
var p=this.onOk.call(this.onOkScope,q);
if(p&&this._window){this._window.close()
}},scope:this})
}if(a.onCancel){if(c.length){c.push({width:5,border:false})
}c.push({xtype:"button",iconCls:"icon_cancel",text:lang.cancelButtonText,handler:function(){var q=this.getConfigData();
var p=this.onCancel.call(this.onCancelScope,this.data_backup);
if(p&&this._window){this._window.close()
}},scope:this})
}l.push({height:6,border:false,bodyStyle:{"background-color":__color_FormBackground}},{layout:{type:"vbox",align:"center"},items:{layout:{type:"hbox"},items:c,border:false,bodyStyle:{"background-color":__color_FormBackground}},border:false,bodyStyle:{"background-color":__color_FormBackground,padding:2}})
}Ext.applyIf(a,{layout:{type:"vbox",align:"stretch"},frame:true,border:false,items:l,listeners:{scope:this,afterrender:this.onAfterRender}});
this.callParent([a]);
if(a&&a._autoShowWindow){this._window=new Ext.Window({iconCls:"icon_wrench",title:this.findLangS("title","lineColors"),closable:true,layout:"fit",items:this,border:false,modal:true});
this._window.show()
}},onAfterRender:function(){if(this.config.data){this.setConfigData(this.config.data)
}},setAllowBlankFields:function(a){for(var b=0;
b<this.lineColorsFields.length;
b++){var c=this.getForm().findField(this.lineColorsFields[b].name);
if(c){c.allowBlank=a;
if(a){c.clearInvalid()
}}}},checkFieldsLineColor:function(){var b=this.getForm().getFieldValues();
this.setAllowBlankFields(false);
this.getForm().isValid();
for(var a=0;
a<this.lineColorsFields.length;
a++){var c=this.getForm().findField(this.lineColorsFields[a].name);
if(c){if(!c.isValid()){return(false)
}}}return(true)
},addLineColor:function(){var b=this.getForm().getFieldValues();
var d={};
for(var a=0;
a<this.lineColorsFields.length;
a++){d[this.lineColorsFields[a].name]=b[this.lineColorsFields[a].name]
}var c=0;
var f=this.lineColorsGrid.store.sorters.items[0].getProperty();
this.lineColorsGrid.store.each(function(g){if(g.data[f]<d[f]){++c
}});
this.lineColorsGrid.store.insert(c,d);
this.lineColorsGrid.getSelectionModel().deselectAll();
this.evChange()
},modifyLineColor:function(){var a=this.lineColorsGrid.getSelectionModel().getSelection();
if(a.length!=1){return
}this.deleteLineColor(a[0]);
this.addLineColor();
this.evChange()
},deleteLineColor:function(a){if(!a){var c=this.lineColorsGrid.getSelectionModel().getSelection();
if(c.length!=1){return
}a=c[0];
Ext.Msg.confirm("",this.findLangS("text","removeRowQuestion"),function(d){if(d=="yes"){this.deleteLineColor(a)
}},this);
return
}var b=this.lineColorsGrid.store.indexOf(a);
if(b>=0){this.lineColorsGrid.store.removeAt(b)
}this.evChange()
},loadLineColor:function(a){for(var b=0;
b<this.lineColorsFields.length;
b++){var c=this.getForm().findField(this.lineColorsFields[b].name);
if(c){c.setValue(a.data[this.lineColorsFields[b].name])
}}},evLineColorsGridSelection:function(c){var d=["modify","remove"];
for(var b=0;
b<d.length;
b++){var a=this.findC("_btnId",d[b]);
if(a){a.enableIf(c&&c.length)
}}if(c&&c.length){this.loadLineColor(c[0]);
this.setAllowBlankFields(false)
}else{this.setAllowBlankFields(true)
}},evChange:function(){if(this.onChange){this.maskLoad();
Ext.defer(function(){var a=this.getConfigData();
this.onChange.call(this.onChangeScope,a);
this.unmask()
},100,this)
}},getConfigData:function(){var b=[];
var a=this.lineColorsGrid.store;
var c=this;
a.each(function(d){var g={};
for(var f=0;
f<c.lineColorsFields.length;
f++){g[c.lineColorsFields[f].name]=d.data[c.lineColorsFields[f].name]
}b.push(g)
});
return(b)
},setConfigData:function(b){this.lineColorsGrid.store.removeAll();
for(var a=0;
a<b.length;
a++){this.lineColorsGrid.store.add(b[a])
}}});
Ext.define("GMap.SelectPosPanel",{extend:"Ext.Panel",subsystem:"gmap",constructor:function(b){this.searchField=new Ext.form.field.Text({fieldLabel:this.findLangS("field","search"),labelWidth:__width_FieldChar(8),width:"100%",enableKeyEvents:true,listeners:{scope:this,keydown:this.evKeySearchField,keyup:this.evKeySearchField}});
this.mapPanel=new GMap.Panel({posCenter:[0,0],markers:b.pos?[b.pos]:undefined,markerZoom:12,singleMarker:true,setMarkerOnClick:true,evAddMarker:this.evAddMarker,evAddMarkerScope:this,disableLoadGeoipData:true,disableTitle:true,disableIcon:true,border:true,zoom:2,flex:1,width:"100%"});
var a=b.backgroundColor||__color_FormBackground;
Ext.applyIf(b,{layout:{type:"vbox",align:"stretch"},border:false,items:[this.searchField,this.mapPanel,{layout:{type:"vbox",align:"center"},items:{layout:{type:"hbox"},items:[{xtype:"button",iconCls:"icon_ok",text:lang.okButtonText,handler:function(){var d=null;
if(this.mapPanel.markers&&this.mapPanel.markers.length>0){if(this.mapPanel.isGoogle()){d={lat:roundNumber(this.mapPanel.markers[0].position.lat(),6),lng:roundNumber(this.mapPanel.markers[0].position.lng(),6)}
}else{if(this.mapPanel.isOSM()){var c=this.mapPanel.markers[0].lonlat;
c=c.transform(this.mapPanel.map.projection,this.mapPanel.map.displayProjection);
d={lat:roundNumber(c.lat,6),lng:roundNumber(c.lon,6)}
}}}if(this.onOk&&this.onOk.call(this.onOkScope,d)){if(this._window){this._window.close()
}}},scope:this,_btnId:"ok",disabled:!b.pos}],border:false,bodyStyle:{"background-color":a}},border:false,bodyStyle:{"background-color":a,padding:5}}],bodyStyle:{"background-color":a},listeners:{scope:this,afterrender:this.onAfterRender}});
this.callParent([b]);
if(this.windowConfig){this.createWindow();
if(this.windowConfig.autoShow){this._window.show()
}}},onAfterRender:function(){},createWindow:function(){if(this.windowConfig.width&&this.windowConfig.width>(Ext.dom.Element.getViewportWidth()-50)){this.windowConfig.width=Ext.dom.Element.getViewportWidth()-50
}if(this.windowConfig.height&&this.windowConfig.height>(Ext.dom.Element.getViewportHeight()-50)){this.windowConfig.height=Ext.dom.Element.getViewportHeight()-50
}Ext.applyIf(this.windowConfig,{title:this.findLangS("title","selectPositionFromPap"),iconCls:"icon_google_maps",closable:true,maximizable:true,resizable:true,layout:"fit",width:Ext.dom.Element.getViewportWidth()-50,height:Ext.dom.Element.getViewportHeight()-50,border:false,modal:true,items:this});
this._window=new Ext.Window(this.windowConfig)
},evKeySearchField:function(b,a){if(a.keyCode==13){this.clearTimeoutDeferSearch();
this.search()
}else{this.setTimeoutDeferSearch()
}},clearTimeoutDeferSearch:function(){if(this.search_deferTimeoutId){clearTimeout(this.search_deferTimeoutId);
delete this.search_deferTimeoutId
}},setTimeoutDeferSearch:function(){this.clearTimeoutDeferSearch();
this.search_deferTimeoutId=setTimeout(Ext.bind(this.search,this),1000)
},search:function(){var a=this.searchField.getValue();
if(a){this.mapPanel.searchPostalAddress(a,{setMarker:true,zoom:12})
}},evAddMarker:function(){var a=this.findC("_btnId","ok");
if(a){a.enableIf(this.mapPanel.markers&&this.mapPanel.markers.length)
}}});
Ext.define("GMap.Utils",{singleton:true,subsystem:"gmap",getCallerCalledByData:function(){var b=["number/number","number/ip","ip/number","ip/ip"];
for(var a=0;
a<b.length;
a++){b[a]=[b[a],this.findLangS("comboData",b[a])]
}return(b)
},getDefaultLineColors:function(){if(window.gmap_spy_line_colors&&Ext.decode(window.gmap_spy_line_colors)){return(Ext.decode(window.gmap_spy_line_colors))
}else{return(cloneObject([{count_ge:1,color:"green",strokeWidth:1,fontSize:10,fontBold:false},{count_ge:150,color:"chocolate",strokeWidth:2,fontSize:11,fontBold:false},{count_ge:300,color:"#FF0000",strokeWidth:3,fontSize:12,fontBold:true}]))
}},findLangS:function(a,b){return(findLangS(this.subsystem,a,b))
}});
function gm(){_gm("osm")
}function gm_google(){_gm("google")
}function gm_osm(){_gm("osm")
}function _gm(b){var a=true;
new GMap.PanelExt({type_map:b,caller_called_by:"ip/ip",testMap:a,mainPos:a?[49.38914,14.686404]:[0,0],disableLoadGeoipData:true,border:false,windowConfig:{autoShow:true,title:findLangS("gmap","title","activeCallsMap")},zoom:a?17:2})
}Ext.define("custommenu1",{extend:"Ext.Panel",alias:"widget.custommenu1PanelX",constructor:function(a){Ext.apply(a,{id:"custommenu1-panel",iconCls:"icon_menu_diag_monitor",layout:"border",bodyBorder:false,defaults:{collapsible:true,split:true,animFloat:false,autoHide:false,useSplitTips:true},items:{collapsible:false,region:"center",layout:"fit",border:false,items:{xtype:"component",autoEl:{tag:"iframe",src:"custommenu1.php"}}}});
this.callParent([a])
},reactivate:function(){}});
Ext.define("Ext.Chart3D.rtp_stat",{subsystem:"chart3d",dataColors:{mos:[[0.7,"#0D8A00"],[1,"#7B8A00"],[1.4,"#AD8A00"],[1.9,"#CA5400"],[null,"#AD1616"]],jitter:[[20,"#00C000"],[45,"#AAC000"],[90,"#E9B300"],[170,"#E98400"],[null,"#E90000"]],loss:[[0.1,"#00C000"],[0.5,"#7DC000"],[1,"#AAC000"],[2,"#E9E600"],[5,"#E9B300"],[10,"#E98400"],[20,"#E95601"],[null,"#E90000"]]},chartConfig:{mosf1_min:{chartConfig:{chartMaxValue:5,invertValues:true,heightsScale:1.2},dataColors:{type:"mos"},loadDataParams:{value:"round(5 - coalesce(mosf1_min/10, 5), 1)",agreg:"max"}},mosf1_avg:{chartConfig:{chartMaxValue:5,invertValues:true,heightsScale:1.2},dataColors:{type:"mos"},loadDataParams:{value:"round(5 - coalesce(mosf1_avg/10, 5), 1)",agreg:"avg"}},mosf2_min:{chartConfig:{chartMaxValue:5,invertValues:true,heightsScale:1.2},dataColors:{type:"mos"},loadDataParams:{value:"round(5 - coalesce(mosf2_min/10, 5), 1)",agreg:"max"}},mosf2_avg:{chartConfig:{chartMaxValue:5,invertValues:true,heightsScale:1.2},dataColors:{type:"mos"},loadDataParams:{value:"round(5 - coalesce(mosf2_avg/10, 5), 1)",agreg:"avg"}},mosAD_min:{chartConfig:{chartMaxValue:5,invertValues:true,heightsScale:1.2},dataColors:{type:"mos"},loadDataParams:{value:"round(5 - coalesce(mosAD_min/10, 5), 1)",agreg:"max"}},mosAD_avg:{chartConfig:{chartMaxValue:5,invertValues:true,heightsScale:1.2},dataColors:{type:"mos"},loadDataParams:{value:"round(5 - coalesce(mosAD_avg/10, 5), 1)",agreg:"avg"}},jitter_max:{chartConfig:{chartMaxValue:200,chartLimitValue:300,heightsScale:0.6},dataColors:{type:"jitter",limit:"#7B00AC"},loadDataParams:{value:"jitter_max",agreg:"max"}},jitter_avg:{chartConfig:{chartMaxValue:200,chartLimitValue:300,heightsScale:0.6},dataColors:{type:"jitter",limit:"#7B00AC"},loadDataParams:{value:"jitter_avg",agreg:"avg"}},loss_max:{chartConfig:{chartMaxValue:50,chartLimitValue:75,heightsScale:0.6},dataColors:{type:"loss",limit:"#7B00AC"},loadDataParams:{value:"round(loss_max_mult10/10, 1)",agreg:"max"}},loss_avg:{chartConfig:{chartMaxValue:50,chartLimitValue:75,heightsScale:0.7},dataColors:{type:"loss",limit:"#7B00AC"},loadDataParams:{value:"round(loss_avg_mult10/10, 1)",agreg:"avg"}}},defaultConfig:{interval:10,agregation_type:"avg",column_count:20,row_count:15,column_scale:0.6,row_scale:0.4,column_fontcolor:"#9999cc",row_fontcolor:"#cc3333",height_fontcolor:"#000000"},constructor:function(a){a=Ext.applyIf(a||{},{typeChart:"mosf1_min"});
Ext.apply(this,a)
},createChart:function(b){var a=cloneObject(this.chartConfig[this.typeChart].chartConfig);
Ext.applyIf(a,{chartMinValue:0,columnScale:this.defaultConfig.column_scale,rowScale:this.defaultConfig.row_scale,showEachCol:1,fontSize:22,columnFontSize:50});
this.chart=new Ext.Chart3D.panel({typeChart:this.typeChart,_owner:this,chartConfig:a,chartConfig2:this.chartConfig2,onClick:this.onClickChart,onMouseMove:this.onMouseMove,onDestroyPanel:this.onDestroyPanel,onAfterCreateChart:b,evScope:this,tips:{renderer:this.tipsRenderer,scope:this}})
},createWindow:function(a){var a=cloneObject(a);
Ext.applyIf(a,{iconCls:"icon_menu_diag_system",closable:true,maximizable:true,resizable:true,layout:"fit",items:this.chart,border:false,width:Ext.dom.Element.getViewportWidth()-20,height:Ext.dom.Element.getViewportHeight()-50,modal:false});
this.window=new Ext.Window(a);
this.window.show()
},loadData:function(k,b,f,g){if(this.chart&&this.chart._timeMachine&&!g){if(k){k.call(b)
}return
}this.clearTimeoutLoadInterval();
var d=cloneObject(this.chartConfig[this.typeChart].loadDataParams);
var a=["timeFrom","timeTo"];
for(var c=0;
c<a.length;
c++){if(d[a[c]]){delete d[a[c]]
}}var h=Ext.apply(d,{interval:this.chartConfig2&&this.chartConfig2.interval||this.defaultConfig.interval,agregation_type:this.chartConfig2&&this.chartConfig2.agregation_type||this.defaultConfig.agregation_type,filters:this.filters,limit_columns:this.chartConfig2&&this.chartConfig2.column_count||this.defaultConfig.column_count,limit_rows:this.chartConfig2&&this.chartConfig2.row_count||this.defaultConfig.row_count,enable_dns_ip_lookup:this.enable_dns_ip_lookup});
if(g){Ext.apply(h,g)
}this._loadingData=true;
ajaxSafeRequest({scope:this,url:"php/reports/charts_3d.php",params:{task:"rtp_stat_data",params:Ext.encode(h)},success:function(l){if(!this.chart){return
}if(this._loadingData){delete this._loadingData
}var m=this.getChartDataFromResult(l);
this.chart.enableBtn("prev",l.columns&&l.columns.length>=3);
this.chart.enableBtn("next",l.columns&&l.columns.length&&!l.actTime);
this.chart.setData(m,f,this.chart.data&&!l.empty&&(this.chart.data.data.length!=l.data.length||this.chart.data.columns.length!=l.columns.length));
this.setTimeoutLoadInterval();
if(k){k.call(b)
}if(this.onLoadData&&this.onLoadData.success){this.onLoadData.success.call(this.onLoadData.scope,l)
}},error:function(l,m){if(this._loadingData){delete this._loadingData
}if(this.onLoadData&&this.onLoadData.error){this.onLoadData.error.call(this.onLoadData.scope,l,m)
}}})
},loadNext:function(){if(!this.chart||!this.chart.data||!this.chart.data.times||!this.chart.data.times.length){return(false)
}var a=dateTimeStringToDate(this.chart.data.times[parseInt(this.chart.data.times.length/2)]);
this.loadData(function(){this.chart.adjustPerspective(true);
if(this.chart._nextActive){Ext.defer(this.loadNext,500,this)
}},this,false,{timeFrom:a});
return(true)
},loadPrev:function(){if(!this.chart||!this.chart.data||!this.chart.data.times||this.chart.data.times.length<3){return(false)
}var a=dateTimeStringToDate(this.chart.data.times[parseInt(this.chart.data.times.length/2)]);
this.loadData(function(){this.chart.adjustPerspective(true);
if(this.chart._prevActive){Ext.defer(this.loadPrev,500,this)
}},this,false,{timeTo:a});
return(true)
},loadDataFromTimer:function(){if(this.suppressRefresh()){this.setTimeoutLoadInterval()
}else{this.loadData()
}},getChartDataFromResult:function(c){if(c.empty){return({columns:[],data:[],empty:true})
}var k={times:cloneArray(c.columns),columns:c.columns,data:[]};
for(var h=0;
h<c.data.length;
h++){var g=[];
var b=[];
for(var f=0;
f<c.data[h].data.length;
f++){g.push(c.data[h].data[f].value);
b.push(c.data[h].data[f].counter)
}k.data.push({title:(c.data[h].hostname?(c.data[h].hostname.length>25?c.data[h].hostname.substr(0,25)+"...":c.data[h].hostname):c.data[h].address)+(c.data[h].counter?" ("+c.data[h].counter+")":""),data:g,counters:b,address:c.data[h].address,counter:c.data[h].counter,hostname:c.data[h].hostname})
}for(var h=0;
h<k.data.length;
h++){k.data[h].style={sectorColor:[],sectorNumberColor:[]};
for(var f=0;
f<k.data[h].data.length;
f++){var d;
if(this.chartConfig[this.typeChart].chartConfig.chartLimitValue&&k.data[h].data[f]>this.chartConfig[this.typeChart].chartConfig.chartLimitValue&&this.chartConfig[this.typeChart].dataColors.limit){d=hexToRgb(this.chartConfig[this.typeChart].dataColors.limit)
}else{d=a(k.data[h].data[f],this.dataColors[this.chartConfig[this.typeChart].dataColors.type])
}k.data[h].style.sectorColor.push(d);
k.data[h].style.sectorNumberColor.push(hexToRgb("#404040"))
}}for(var h=0;
h<k.columns.length;
h++){k.columns[h]=Ext.Date.format(dateTimeStringToDate(k.columns[h]),__format_Time)
}return(k);
function a(o,l){if(o===null){return(hexToRgb("#A0A0A0"))
}var m=null;
for(var n=0;
n<l.length;
n++){if(l[n][0]===null){m=l[n][1];
break
}else{if(o<l[n][0]){m=l[n][1];
break
}}}return(hexToRgb(m))
}},startLoadInterval:function(a){this.loadInterval=a;
this.loadData()
},stopLoadInterval:function(){this.clearTimeoutLoadInterval();
if(this.loadInterval){delete this.loadInterval
}},setTimeoutLoadInterval:function(){if(this.loadInterval){this.clearTimeoutLoadInterval();
this.loadIntervalTimer=setTimeout(Ext.bind(this.loadDataFromTimer,this),this.loadInterval)
}},clearTimeoutLoadInterval:function(){if(this.loadIntervalTimer){clearTimeout(this.loadIntervalTimer);
delete this.loadIntervalTime
}},onClickChart:function(a,f,c){if(a<0){return
}var d=this.chart.getDataForChartNum(a);
if(d){var b=['<div class="menu-title" style="font-weight:bold; font-size: 90%; padding-left: 33; padding-right: 30; margin-top: 4; margin-bottom: 4;">'+findLangS(this.subsystem,"menu","rtp_ip")+": "+d.address+"</div>"];
if(this.enable_context_mos_jitter_loss){b.push({text:findLangS(this.subsystem,"menu","showChartsMosJitterLoss"),handler:function(){this.doChartMosJitterLoss(d)
},scope:this})
}if(this.enable_context_cdr){b.push({text:findLangS(this.subsystem,"menu","showCDR"),handler:function(){this.doCDR(d)
},scope:this})
}if(this.enable_context_cdr_filter){b.push({text:findLangS(this.subsystem,"menu","setCDR_filter"),handler:function(){this.setCDR_filter(d)
},scope:this})
}if(b.length){this.contextMenu=new Ext.menu.Menu({items:b,listeners:{hide:function(){if(this.contextMenu){delete this.contextMenu
}}}});
this.contextMenuChartNum=a;
this.contextMenuAt=dateTime().getTime();
this.contextMenu.showAt(c)
}}},onMouseMove:function(a,b){if(this.contextMenu&&(dateTime().getTime()-this.contextMenuAt>2000||a>=0&&a!=this.contextMenuChartNum)){this.contextMenu.destroy();
delete this.contextMenu
}},doChartMosJitterLoss:function(b){var c=dateTimeStringToDate(this.chart.data.times[this.chart.data.times.length-1]);
var a=new CDR.Chart.MosJitterLoss.Panel({dateFrom:new Date(c.getTime()-60*60*1000),dateTo:c,filters:{fa_saddr:b.address}});
a.createWindow();
a.loadCharts()
},doCDR:function(b){var d=dateTimeStringToDate(this.chart.data.times[this.chart.data.times.length-1]);
var a={fdatefrom:new Date(d.getTime()-60*60*1000),fdateto:d,fa_saddr:b.address};
var f=new CDR.Grid({extraParams:a,disableCharts:true,disableMenu:true,disablePagingToolbar:true,enableTbarRibbonDateFromTo:true,enableTbarRibbonFilterButton:true,enableTbarRibbonPaginator:true,loadAtInit:true,border:false});
var c=new Ext.Window({layout:"fit",items:f,width:Math.round(Ext.dom.Element.getViewportWidth()*7/8),height:Math.round(Ext.dom.Element.getViewportHeight()*7/8),modal:true,closable:true,maximizable:true});
c.show()
},setCDR_filter:function(a){this._rtpStat_panel.mainPanel.cdrGrid.setGroupFilter("ab_saddr",a.address)
},onDestroyPanel:function(){this.stopLoadInterval()
},tipsRenderer:function(a,d){if(a<0){return
}var c=this.chart.getDataForChartNum(a);
tip='<div style="font: '+__font_Grid+'; font-weight:bold;">'+c.address;
if(c.hostname){tip+="<br>"+c.hostname
}if(c.counter){tip+="<br>("+c.counter+")"
}tip+="</div>";
var b=getSizeHtml(tip);
d.setWidth(b[0]+10);
d.setHeight(b[1]+8);
d.setTitle(tip)
},suppressRefresh:function(){return(this.contextMenu||this.chart&&this.chart._timeMachine||this.enableRefresh&&!this.enableRefresh())
},resizeTo:function(b,a){if(this.chart){this.chart.resizeTo(b,a)
}}});
Ext.define("Ext.Chart3D.panel",{extend:Ext.Panel,subsystem:"chart3d",constructor:function(a){a=Ext.applyIf(a||{},{layout:"fit",listeners:{scope:this,afterrender:function(){this.createCanvas()
},beforedestroy:function(){if(this.autoDeleteChart3D){this.deleteChart3D()
}},destroy:function(){if(this.onDestroyPanel){this.onDestroyPanel.call(this.evScope)
}}},border:false});
if(a.tips){a.tipConfig=Ext.apply({},a.tips,{constrainPosition:true,autoHide:true})
}this.callParent([a]);
this.btns_disabled={prev:true,next:true};
if(a.tips){this.tooltip=new Ext.tip.ToolTip(this.tipConfig)
}},createCanvas:function(a){this.canvas_component=new Ext.Component({renderTpl:['<canvas id="{id}_canvas_chart3d">'],listeners:{scope:this,afterrender:function(){this.canvasEl=this.getEl().down("canvas");
Ext.defer(function(){this.onAfterCreateCanvas(a)
},10,this)
},resize:function(d,f,c){if(this.evResize_suppress){return
}this.resizeTo(f,c-(this._owner.title?20:0))
}},style:{paddingTop:this._owner.title?20:0}});
this.button_container=new Ext.Container({layout:{type:"hbox"},defaults:{border:false,style:{background:"transparent"},scope:this},items:[{xtype:"button",_id:"btn_prev",iconCls:"x-tbar-page-prev",handler:this.loadPrev,listeners:{scope:this,afterrender:function(c){c.getEl().on("mousedown",function(){if(!c.disabled){}},this);
c.getEl().on("mouseup",function(){delete this._prevActive
},this)
}},tooltip:this.findLangS("button","previous"),disabled:this.btns_disabled.prev,height:19},{xtype:"component",width:2},{xtype:"button",_id:"btn_next",iconCls:"x-tbar-page-next",handler:this.loadNext,listeners:{scope:this,afterrender:function(c){c.getEl().on("mousedown",function(){if(!c.disabled){}},this);
c.getEl().on("mouseup",function(){delete this._nextActive
},this)
}},tooltip:this.findLangS("button","next"),disabled:this.btns_disabled.next,height:19}],style:{padding:4},x:0,y:0,width:2*25,autoHeight:true});
var b=[this.canvas_component,this.button_container];
if(this._owner.title){this.title_container=new Ext.Container({items:{xtype:"displayfield",value:this._owner.title,style:{marginLeft:4}}});
b.push(this.title_container)
}this.canvas_container=new Ext.Container({layout:"absolute",items:b,listeners:{scope:this,afterrender:function(){this.getEl().on("mouseenter",function(){this._mouseIn=true
},this);
this.getEl().on("mouseleave",function(){delete this._mouseIn;
this.chart3d._animationStep(true);
this.hideTip();
Ext.defer(this.adjustPerspective,100,this);
if(this._timeMachine){Ext.defer(function(){if(!this._mouseIn){delete this._timeMachine;
if(this._owner&&this._owner.setTimeoutLoadInterval){this._owner.setTimeoutLoadInterval()
}}},2000,this)
}},this)
},resize:function(d,f,c){this.canvas_component.setSize(f,c);
this.button_container.setPosition(f-this.button_container.getWidth(),0)
}}});
this.add(this.canvas_container)
},deleteChart3D:function(){if(this.chart3d){this.canvasEl.parent().dom.removeChild(this.canvasEl.dom);
delete this.chart3d
}},onAfterCreateCanvas:function(b){var a={};
if(b&&b.chartConfig){Ext.applyIf(a,b.chartConfig)
}Ext.applyIf(a,this.chartConfig);
this.createChart(a,b);
if(b&&b.task=="re_create"){this.setData(this.data)
}},createChart:function(d,c){var a=this.createConfig(d);
this.chart3d=new Graph3d(this.canvasEl.id,[],a,this);
var b=this;
this.chart3d.bindClick(function(f,g){b.evClick(f,g)
});
this.chart3d.bindMouseOver(function(f,g){b.evMouseOver(f,g)
});
this.type_size=this.getTypeSize();
if(this.onAfterCreateChart){this.onAfterCreateChart.call(this.evScope,c)
}if(this.reCreateChart_processing){Ext.defer(function(){delete this.reCreateChart_processing
},2000,this)
}},evClick:function(b,c){if(this.onClick){var a=getAbsolutePosition(this.getEl().dom);
xy_abs=[c[0]+a[0],c[1]+a[1]];
this.onClick.call(this.evScope,b,c,xy_abs)
}},evMouseOver:function(b,c){if(this.onMouseMove){this.onMouseMove.call(this.evScope,b,c)
}if(b>=0&&this.getEl().dom){var a=getAbsolutePosition(this.getEl().dom);
xy_abs=[c[0]+a[0],c[1]+a[1]];
this.showTip(b,xy_abs)
}else{this.hideTip()
}},createConfig:function(b){var a={};
Ext.applyIf(a,b);
Ext.applyIf(a,{chartType:"bar",camera:this.cameraConfigForTypeSize(),numberFontSize:b.fontSize*1.2,rowStyle:{size:(b.fontSize/b.rowScale)*this.fontSizeMultForTypeSize(),family:"monospace",color:Ext.Chart3D.rtp_stat.prototype.defaultConfig.row_fontcolor},columnStyle:{size:(b.columnFontSize||b.fontSize/b.columnScale)*this.fontSizeMultForTypeSize(),family:"monospace",color:Ext.Chart3D.rtp_stat.prototype.defaultConfig.column_fontcolor},heightsRightStyle:{size:(b.fontSize/b.heightsScale)*this.fontSizeMultForTypeSize(),family:"monospace",color:Ext.Chart3D.rtp_stat.prototype.defaultConfig.height_fontcolor},heightsLeftStyle:{size:(b.fontSize/b.heightsScale)*this.fontSizeMultForTypeSize(),family:"monospace",color:Ext.Chart3D.rtp_stat.prototype.defaultConfig.height_fontcolor}});
if(this.chartConfig2){if(this.chartConfig2.column_scale){a.columnScale=this.chartConfig2.column_scale*1
}if(this.chartConfig2.column_scale_perc){a.columnScale*=this.chartConfig2.column_scale_perc/100
}if(this.chartConfig2.column_fontsize){a.columnStyle.size=this.chartConfig2.column_fontsize*1
}if(this.chartConfig2.column_fontsize_perc){a.columnStyle.size*=this.chartConfig2.column_fontsize_perc/100
}if(this.chartConfig2.column_fontcolor){a.columnStyle.color=this.chartConfig2.column_fontcolor
}if(this.chartConfig2.row_scale){a.rowScale=this.chartConfig2.row_scale*1
}if(this.chartConfig2.row_scale_perc){a.rowScale*=this.chartConfig2.row_scale_perc/100
}if(this.chartConfig2.row_fontsize){a.rowStyle.size=this.chartConfig2.row_fontsize*1
}if(this.chartConfig2.row_fontsize_perc){a.rowStyle.size*=this.chartConfig2.row_fontsize_perc/100
}if(this.chartConfig2.row_fontcolor){a.rowStyle.color=this.chartConfig2.row_fontcolor
}if(this.chartConfig2.height_scale){a.heightsScale=this.chartConfig2.height_scale*1
}if(this.chartConfig2.height_scale_perc){a.heightsScale*=this.chartConfig2.height_scale_perc/100
}if(this.chartConfig2.height_fontsize){a.heightsRightStyle.size=this.chartConfig2.height_fontsize*1;
a.heightsLeftStyle.size=this.chartConfig2.height_fontsize*1
}if(this.chartConfig2.height_fontsize_perc){a.heightsRightStyle.size*=this.chartConfig2.height_fontsize_perc/100;
a.heightsLeftStyle.size*=this.chartConfig2.height_fontsize_perc/100
}if(this.chartConfig2.height_fontcolor){a.heightsRightStyle.color=this.chartConfig2.height_fontcolor;
a.heightsLeftStyle.color=this.chartConfig2.height_fontcolor
}if(this.chartConfig2.height_max){a.chartMaxValue=this.chartConfig2.height_max*1
}if(this.chartConfig2.curve_fontsize){a.numberFontSize=this.chartConfig2.curve_fontsize*1
}if(this.chartConfig2.curve_fontsize_perc){a.numberFontSize*=this.chartConfig2.curve_fontsize_perc/100
}if(Ext.isDefined(this.chartConfig2.camera_position_x)||Ext.isDefined(this.chartConfig2.camera_position_y)||Ext.isDefined(this.chartConfig2.camera_position_z)){a.camera.position={x:this.chartConfig2.camera_position_x*1,y:this.chartConfig2.camera_position_y*1,z:this.chartConfig2.camera_position_z*1}
}if(Ext.isDefined(this.chartConfig2.camera_lookat_x)||Ext.isDefined(this.chartConfig2.camera_lookat_y)||Ext.isDefined(this.chartConfig2.camera_lookat_z)){a.camera.lookat={x:this.chartConfig2.camera_lookat_x*1,y:this.chartConfig2.camera_lookat_y*1,z:this.chartConfig2.camera_lookat_z*1}
}if(Ext.isDefined(this.chartConfig2.camera_perspective)){a.camera.perspective=this.chartConfig2.camera_perspective*1
}}return(a)
},setData:function(c,b,d){this.data=c;
if(d){this.reCreateChart();
this.adjustPerspective(true)
}else{var a=c.columns;
this.chart3d._columnLength=this.chart3d._options.chartType=="line"?a.length-1:a.length;
this.chart3d._columnText=a;
this.chart3d.draw(c.data);
this.chart3d.start();
this.adjustPerspective(b)
}},reCreateChart:function(){this.reCreateChart_processing=true;
var a=this.getCameraConfig();
this.removeAll();
this.createCanvas({task:"re_create",chartConfig:{camera:a}})
},getCameraConfig:function(){return({position:this.chart3d._scene.camera.position,lookat:this.chart3d._scene.camera.lookat,perspective:this.chart3d._scene.perspective.fov})
},getCameraConfig2:function(){var a=this.getCameraConfig();
return({position_x:a.position.x,position_y:a.position.y,position_z:a.position.z,lookat_x:a.lookat.x,lookat_y:a.lookat.y,lookat_z:a.lookat.z,perspective:a.perspective})
},getDataForChartNum:function(b){var a=0;
for(var c in this.data.data){if(a==b){return(this.data.data[c])
}++a
}return(null)
},getTypeSize:function(){var a=Math.min(this.canvasEl.dom.width,this.canvasEl.dom.height);
return(a>600?"large":a>400?"small":"tiny")
},cameraConfigForTypeSize:function(){switch(this.getTypeSize()){case"tiny":return({position:{x:13.3,y:29,z:-23.6},lookat:{x:-1.1,y:5,z:2.5},perspective:20})
}return({position:{x:9.3,y:37.7,z:-19},lookat:{x:-3,y:5,z:3.7},perspective:20})
},fontSizeMultForTypeSize:function(){switch(this.getTypeSize()){case"small":return(1.6);
case"tiny":return(2.2)
}return(1)
},showTip:function(b,d){if(!this.tooltip){return
}var c=this.tooltip;
var a=this.tipConfig;
var f=c.trackMouse;
clearTimeout(this.tipTimeout);
if(!f){c.trackMouse=true;
c.targetXY=d
}a.renderer.call(a.scope,b,c);
c.show();
c.trackMouse=f
},hideTip:function(){if(!this.tooltip){return
}clearTimeout(this.tipTimeout);
var a=this.tooltip;
this.tipTimeout=setTimeout(function(){a.hide()
},0)
},getScreenBounds:function(g){var f={};
if(this.chart3d&&this.chart3d._scene&&this.chart3d._scene._entities){for(var k in this.chart3d._scene._entities){var a=this.chart3d._scene._entities[k].getScreenBounds();
if(!Ext.isDefined(f.minx)){f=a
}else{if(a.minx<f.minx){f.minx=a.minx
}if(a.maxx>f.maxx){f.maxx=a.maxx
}if(a.miny<f.miny){f.miny=a.miny
}if(a.maxy>f.maxy){f.maxy=a.maxy
}}}}if(Ext.isDefined(f.minx)&&this.canvasEl&&this.canvasEl.dom){var d=this.canvasEl.dom.width;
var h=this.canvasEl.dom.height;
if(d&&h){var b=undefined;
if(f.minx<0){var c=-f.minx;
b=Ext.isDefined(b)?Math.max(b,c):c
}if(f.miny<0){var c=-f.miny;
b=Ext.isDefined(b)?Math.max(b,c):c
}if(f.maxx>d){var c=f.maxx-d;
b=Ext.isDefined(b)?Math.max(b,c):c
}if(f.maxy>h){var c=f.maxy-h;
b=Ext.isDefined(b)?Math.max(b,c):c
}f.maxOversize=b;
var m=undefined;
if(f.minx>0){var l=f.minx;
m=Ext.isDefined(m)?Math.min(m,l):l
}if(f.miny>0){var l=f.miny;
m=Ext.isDefined(m)?Math.min(m,l):l
}if(f.maxx<d){var l=d-f.maxx;
m=Ext.isDefined(m)?Math.min(m,l):l
}if(f.maxy<h){var l=h-f.maxy;
m=Ext.isDefined(m)?Math.min(m,l):l
}f.minReserve=m
}}return(f)
},resizeTo:function(b,a){if(!b){b=this.getWidth()
}if(!a){a=this.getHeight()
}this.canvasEl.setSize(b,a);
this.canvasEl.dom.width=b;
this.canvasEl.dom.height=a;
if(this.chart3d){this.chart3d._scene.perspective.aspect=this.canvasEl.dom.width/this.canvasEl.dom.height;
this.chart3d._scene.viewport.width=this.canvasEl.dom.width;
this.chart3d._scene.viewport.height=this.canvasEl.dom.height
}if(this.type_size&&!this.reCreateChart_processing){if(this.type_size!=this.getTypeSize()){Ext.defer(this.reCreateChart,10,this);
this.type_size=this.getTypeSize()
}else{this.chart3d._animationStep()
}}this.adjustPerspective()
},adjustPerspective:function(a){if(a||this.AdjustPerspective_process||(!this.AdjustPerspective_suppress&&!this._mouseIn)){if(this.adjustPerspective_doTimeoutId){clearInterval(this.adjustPerspective_doTimeoutId);
delete this.adjustPerspective_doTimeoutId
}this.adjustPerspective_doTimeoutId=setTimeout(Ext.bind(function(){this.AdjustPerspective_process="-";
delete this.AdjustPerspective_stepLast;
delete this.AdjustPerspective_changeStepDirectionCounter;
debug_log("do adjust perspective");
this._adjustPerspective()
},this),100)
}},_adjustPerspective:function(){if(!this.canvasEl||!this.canvasEl.dom){return
}var f=this.getScreenBounds(true);
if(isDataEmpty(f)){return
}var k=0;
if(this.AdjustPerspective_process=="-"){var a=this.canvasEl.dom.width;
if((f.maxx-f.minx)>a*2){k=1;
debug_log(this.typeChart+" adj - "+k);
this.chart3d._scene.perspective.fov+=k
}if(k){this.AdjustPerspective_stepLast=k
}else{delete this.AdjustPerspective_stepLast;
this.AdjustPerspective_process="x"
}}if(this.AdjustPerspective_process=="x"){var a=this.canvasEl.dom.width;
var d=f.minx;
var b=a-f.maxx;
if(Math.abs(d-b)>5&&(this.AdjustPerspective_changeStepDirectionCounter||0)<1){k=Math.max(Math.abs(d-b)/70,0.05)*(d<b?1:-1);
debug_log(this.typeChart+" adj x "+k);
this.chart3d._scene.camera.lookat.x-=k;
this.chart3d._scene.camera.position.x-=k
}if(k){if(this.AdjustPerspective_stepLast&&(k>0&&this.AdjustPerspective_stepLast<0||k<0&&this.AdjustPerspective_stepLast>0)){this.AdjustPerspective_changeStepDirectionCounter=(this.AdjustPerspective_changeStepDirectionCounter||0)+1
}this.AdjustPerspective_stepLast=k
}else{delete this.AdjustPerspective_stepLast;
delete this.AdjustPerspective_changeStepDirectionCounter;
this.AdjustPerspective_process="y"
}}if(this.AdjustPerspective_process=="y"){var c=this.canvasEl.dom.height;
var h=f.miny;
var g=c-f.maxy;
if(Math.abs(h-g)>5&&(this.AdjustPerspective_changeStepDirectionCounter||0)<1){k=Math.max(Math.abs(h-g)/70,0.05)*(h>g?1:-1);
debug_log(this.typeChart+" adj y "+k);
this.chart3d._scene.camera.lookat.y-=k;
this.chart3d._scene.camera.position.y-=k
}if(k){if(this.AdjustPerspective_stepLast&&(k>0&&this.AdjustPerspective_stepLast<0||k<0&&this.AdjustPerspective_stepLast>0)){this.AdjustPerspective_changeStepDirectionCounter=(this.AdjustPerspective_changeStepDirectionCounter||0)+1
}this.AdjustPerspective_stepLast=k
}else{delete this.AdjustPerspective_stepLast;
delete this.AdjustPerspective_changeStepDirectionCounter;
this.AdjustPerspective_process="r"
}}if(this.AdjustPerspective_process=="r"){if(f.minReserve>5&&!Ext.isDefined(f.maxOversize)){k=Math.max(f.minReserve/20,0.2);
debug_log(this.typeChart+" adj r "+k);
this.chart3d._scene.perspective.fov-=k
}if(k){this.AdjustPerspective_stepLast=k
}else{delete this.AdjustPerspective_stepLast;
this.AdjustPerspective_process="o"
}}if(this.AdjustPerspective_process=="o"){if(f.maxOversize>=1){k=Math.max(f.maxOversize/50,0.2);
debug_log(this.typeChart+" adj o "+k);
this.chart3d._scene.perspective.fov+=k
}if(k){this.AdjustPerspective_stepLast=k
}else{delete this.AdjustPerspective_stepLast;
delete this.AdjustPerspective_process
}}if(k){this.chart3d._animationStep();
Ext.defer(this._adjustPerspective,1,this)
}},suppressHighlightRow:function(){return(!this._mouseIn)
},loadPrev:function(){if(this._owner.loadPrev()){this._timeMachine=true
}},loadNext:function(){if(this._owner.loadNext()){this._timeMachine=true
}},enableBtn:function(c,a){var b=this.findC("_id","btn_"+c);
if(b){b.enableIf(a)
}this.btns_disabled[c]=!a
}});
if(window.language){loginLanguage=window.language
}else{if(navigator.appName=="Netscape"){brwlanguage=navigator.language
}else{brwlanguage=navigator.browserLanguage
}loginLanguage=brwlanguage.substring(0,2);
if(window.cookiel){loginLanguage=window.cookiel
}}loginLangStringEn={username:"Username",login:"Login",rememberMe:"Remember Me",exit:"Exit",password:"Password",cloudToken:"Cloud",pleaseLogin:"Please Log In",pleaseRelogin:"Please enter password for continue",loginButton:"Log In",waitTitle:"Please wait",waitMsg:"Transfering data...",loginSuccess:"Login succesfull",serverUnavailable:"Server unavailable",unknownError:"Unknown error",warning:"Warning",language:"Language",loginFailed:"Incorrect username or password.",code2fa:"2FA code",selectCloudToken:"please select Cloud"};
langData=[["English","en","ux-flag-en",loginLangStringEn]];
reloginForm=null;
reloginTasks=null;
Ext.define("LoginPanel",{extend:"Ext.FormPanel",alias:"widget.LoginPanelX",initComponent:function(){var g=new Ext.data.ArrayStore({fields:["name","value","flag","langData"],data:langData});
var k=new Ext.data.ArrayStore({fields:["id","name"],data:[]});
Ext.apply(this,{relogin:window.username,frame:true,titleWindow:getLoginLangString("pleaseLogin"),defaultType:"textfield",defaults:{labelWidth:130,width:160+5+130},monitorValid:true,items:[{xtype:"hidden",name:"module",value:window.username?"relogin":"login"},{xtype:"hidden",name:"dbcheck",value:window.dbcheck||window.debug?1:0},{xtype:"container",layout:{type:"vbox",align:"center"},items:window.gEnableAuth?{xtype:"component",html:'<div id="gSignButton"></div>',style:{marginTop:"4px",marginBottom:"8px"},hidden:true}:!window.gDisableButton?{xtype:"button",text:"Google Sign in",handler:function(){Ext.Msg.alert("Info","You need to enable the 'Google Sign In' in the Settings->System configuration.&nbsp;&nbsp;<a href='https://www.voipmonitor.org/doc/Google_Sign_in_usage'>Wiki</a>")
},style:{marginTop:"4px",marginBottom:"8px"}}:undefined},{fieldLabel:getLoginLangString("username")+(window.DEMO?" (admin)":""),name:"user",value:window.cookieu||window.username||(window.DEMO?"admin":""),readOnly:window.username,allowBlank:false,fieldStyle:window.username?{background:"#F5F5F5"}:undefined,listeners:{scope:this,change:function(){b.call(this)
},focusleave:function(){a.call(this)
}}},{fieldLabel:getLoginLangString("password")+(window.DEMO?" (admin)":""),name:"pass",inputType:"password",value:window.cookiep||(window.DEMO?"admin":""),allowBlank:false},{xtype:"combobox",id:"cloud_token",fieldLabel:getLoginLangString("cloudToken"),editable:false,allowBlank:true,name:"cloud_token",mode:"local",triggerAction:"all",store:k,displayField:"name",valueField:"id",hidden:true,width:450,listeners:{scope:this,expand:function(l){l._expanded=true
},select:function(){Ext.getCmp("loginButton").enable()
}}},{fieldLabel:getLoginLangString("code2fa")+(window.DEMO?" (admin)":""),name:"code2fa",value:"",allowBlank:true,hidden:true},window.username?{xtype:"hidden",name:"language",value:loginLanguage}:{xtype:"iconcombo",id:"logincombo",fieldLabel:getLoginLangString("language"),editable:false,allowBlank:false,name:"language",mode:"local",triggerAction:"all",store:g,displayField:"name",valueField:"value",iconClsField:"flag",value:loginLanguage,listeners:{scope:this,select:h}},window.username?undefined:{xtype:"checkbox",name:"rememberme",fieldLabel:getLoginLangString("rememberMe"),checked:!!window.cookieu}],buttons:[window.isCloud?{text:"Register",handler:function(){window.open(appCloudPriceUrl)
},style:{"background-image":Ext.isChrome?"-webkit-linear-gradient(top,#ccf,#aaf)":"-moz-linear-gradient(center top,#ccf,#aaf)",color:"white"}}:undefined,"->",{id:"loginButton",text:getLoginLangString("login"),formBind:true,scope:this,listeners:{scope:this,click:function(){if(!this.getForm().isValid()){return
}this.getForm().submit({scope:this,url:"php/model/sql.php",method:"POST",success:function(l,m){if(this.relogin){Ext.getBody().unmask();
Ext.defer(runReloginTasks,250)
}obj=Ext.decode(m.response.responseText);
if(this.relogin){this.ownerCt.close();
reloginForm=null
}else{if(obj.redirect){window.location=obj.redirect+(window.urlParamsString?"?"+window.urlParamsString.replaceall("%22",'"').replaceall("%","__perc__").replaceall("__perc__","%25"):"")
}else{if(obj.cloud_token_data){f.call(this);
c.call(this,obj.cloud_token_data);
Ext.getBody().unmask();
this.ownerCt.show()
}}}},failure:function(l,m){Ext.getBody().unmask();
this.ownerCt.show();
l.reset();
Ext.defer(l.clearInvalid,10,l);
if(m.failureType=="server"){obj=Ext.decode(m.response.responseText);
Ext.defer(Ext.Msg.alert,250,Ext.Msg,[getLoginLangString("warning"),obj.error||obj.errors&&obj.errors.reason||obj.msg||getLoginLangString("unknownError")])
}else{Ext.defer(Ext.Msg.alert,250,Ext.Msg,[getLoginLangString("serverUnavailable"),getLoginLangString("serverUnavailable")+": "+(m.response.responseText||m.response.statusText||"")])
}}});
Ext.getBody().mask(getLoginLangString("waitMsg"),"x-mask-loading");
this.ownerCt.hide()
}}},!window.username?null:{id:"exitButton",text:getLoginLangString("exit"),handler:function(){window.location="./"
}}],listeners:{scope:this,afterrender:function(){Ext.create("Ext.util.KeyNav",this.el,{enter:function(){Ext.getCmp("loginButton").fireEvent("click")
},scope:this});
var l=this.getForm().findField(window.username?"pass":"user");
if(l){Ext.defer(function(){l.focus()
},200)
}}}});
this.callParent(arguments);
a.call(this);
function h(q,m){loginLanguage=m.data.value;
this.ownerCt.setTitle(getLoginLangString("pleaseLogin"));
var l=[["user","username"],["pass","password"],["language","language"],["rememberme","rememberMe"]];
var p=[["loginButton","login"]];
for(var o=0;
o<l.length;
o++){this.getForm().findField(l[o][0]).setFieldLabel(getLoginLangString(l[o][1]))
}for(var o=0;
o<p.length;
o++){loginButtons=this.dockedItems.get(0).items.items;
for(var n=0;
n<loginButtons.length;
n++){if(loginButtons[n].id==p[o][0]){loginButtons[n].setText(getLoginLangString(p[o][1]))
}}}}function c(n){d.call(this);
var l=this.getForm().findField("cloud_token");
for(var m=0;
m<n.length;
m++){if(l._expanded){l.store.add({id:n[m][0],name:n[m][1]})
}else{l.store.add(n[m]);
l.store.proxy.data.push(n[m])
}}}function d(){var l=this.getForm().findField("cloud_token");
l.store.removeAll()
}function f(){var l=this.getForm().findField("cloud_token");
l.show();
l.allowBlank=false;
l.markInvalid("Select cloud token!");
Ext.getCmp("loginButton").disable()
}function b(){var l=this.getForm().findField("cloud_token");
l.hide();
l.allowBlank=true;
l.setValue(null);
l.clearInvalid();
d.call(this);
Ext.getCmp("loginButton").enable()
}function a(){var l=this.getForm().findField("user").getValue();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getExistsUserSecret",params:Ext.encode({username:l})},success:function(m){this.getForm().findField("code2fa")[m.exists_secret*1?"show":"hide"]()
}})
}}});
function login(){setLang();
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"getLanguages",params:Ext.encode({loginLangString:treeToArray({login:loginLangStringEn},"//L//")})},success:function(a){setLangData(a.lang);
_login()
},error:function(a){loginLanguage="en";
_login()
}})
}function _login(){var b=Ext.create("LoginPanel");
var a=new Ext.create("Ext.Window",{items:b,title:b.titleWindow,border:false,closable:false,resizable:false,listeners:{show:function(){if(window.gEnableAuth){loadGoogleAuth(function(){gRenderButton(true)
})
}}}});
a.show()
}function reLogin(a){if(window.kill_session){return
}if(a){if(reloginTasks){reloginTasks.push(a)
}else{reloginTasks=[a]
}}if(reloginForm){return
}loginLanguage=window.language;
reloginForm=Ext.create("LoginPanel");
var b=new Ext.create("Ext.Window",{items:reloginForm,title:getLoginLangString("pleaseRelogin"),border:false,closable:false,resizable:false,modal:true,listeners:{show:function(){if(window.gEnableAuth&&user&&user.glogin&&window._google_auth_loaded){loadGoogleAuth(function(){gRenderButton(false)
})
}}}});
b.show();
window.reLoginWindow=b
}function runReloginTasks(){if(reloginTasks){for(var a=0;
a<reloginTasks.length;
a++){reloginTasks[a].fce.apply(reloginTasks[a].scope,reloginTasks[a].params)
}reloginTasks=null
}}function setLangData(b){if(b){for(var c=0;
c<b.length;
c++){flagStyle="";
if(b[c].flag_name){flagStyle="ux-flag-"+b[c].lang_short;
addRuleToStyleSheet("."+flagStyle,'background-image: url("data:image/png;base64,'+b[c].flag_content+'");background-size: Auto 11px',"loginCombo",false,false,true)
}langData.push([b[c].lang,b[c].lang_short,flagStyle,b[c].lang_string])
}}var a=false;
for(var c=0;
c<langData.length;
c++){if(langData[c][1]==loginLanguage){a=true;
break
}}if(!a){loginLanguage="en"
}}if(window.doLogin){if(!window.disableFrameCheck){try{if(top.location.hostname!=self.location.hostname){throw 1
}}catch(e){top.location.href=self.location.href
}}Ext.Ajax.timeout=300000;
Ext.override(Ext.form.Basic,{timeout:Ext.Ajax.timeout/1000});
Ext.override(Ext.data.proxy.Server,{timeout:Ext.Ajax.timeout});
Ext.override(Ext.data.Connection,{timeout:Ext.Ajax.timeout});
Ext.onReady(function(){if(Ext.isIE&&Ext.ieVersion<11){Ext.Msg.alert("Compatibility problem","Internet explorer is supported from version 11.<br><br>"+Ext.userAgent);
return
}Ext.QuickTips.init();
login()
})
}function getLoginLangString(b){if(window.user){return(findLangS("login",b))
}else{var a=null;
for(var c=0;
c<langData.length;
c++){if(langData[c][1]==loginLanguage){a=langData[c][3]
}}return(a?a[b]||loginLangStringEn[b]:loginLangStringEn[b])
}}"use strict";
var WaveSurfer={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio,fillParent:true,scrollParent:false,hideScrollbar:false,normalize:false,audioContext:null,container:null,dragSelection:true,loopSelection:true,audioRate:1,interact:true,renderer:"Canvas",backend:"WebAudio",mediaType:"audio"},init:function(a){this.params=WaveSurfer.util.extend({},this.defaultParams,a);
this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container;
if(!this.container){throw new Error("Container element not found")
}if(typeof this.params.mediaContainer=="undefined"){this.mediaContainer=this.container
}else{if(typeof this.params.mediaContainer=="string"){this.mediaContainer=document.querySelector(this.params.mediaContainer)
}else{this.mediaContainer=this.params.mediaContainer
}}if(!this.mediaContainer){throw new Error("Media Container element not found")
}this.savedVolume=0;
this.isMuted=false;
this.createDrawer();
return(this.createBackend())
},createDrawer:function(){var a=this;
this.drawer=Object.create(WaveSurfer.Drawer[this.params.renderer]);
this.drawer.init(this.container,this.params);
this.drawer.on("redraw",function(){a.drawBuffer();
a.drawer.progress(a.backend.getPlayedPercents())
});
this.drawer.on("click",function(c,b){setTimeout(function(){a.seekTo(b)
},0)
});
this.drawer.on("scroll",function(b){a.fireEvent("scroll",b)
})
},createBackend:function(){var a=this;
if(this.backend){this.backend.destroy()
}if(this.params.backend=="WebAudio"&&!WaveSurfer.WebAudio.supportsWebAudio()){this.params.backend="AudioElement"
}this.backend=Object.create(WaveSurfer[this.params.backend]);
if(!this.backend.init(this.params)){return(false)
}this.backend.on("finish",function(){a.fireEvent("finish")
});
this.backend.on("audioprocess",function(b){a.fireEvent("audioprocess",b)
});
return(true)
},restartAnimationLoop:function(){var b=this;
var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame;
var c=function(){if(!b.backend.isPaused()){b.drawer.progress(b.backend.getPlayedPercents());
a(c)
}};
c()
},getDuration:function(){return this.backend.getDuration()
},getCurrentTime:function(){return this.backend.getCurrentTime()
},play:function(b,a){this.backend.play(b,a);
this.restartAnimationLoop();
this.fireEvent("play")
},pause:function(){this.backend.pause();
this.fireEvent("pause")
},playPause:function(){this.backend.isPaused()?this.play():this.pause()
},skipBackward:function(a){this.skip(-a||-this.params.skipLength)
},skipForward:function(a){this.skip(a||this.params.skipLength)
},skip:function(c){var a=this.getCurrentTime()||0;
var b=this.getDuration()||1;
a=Math.max(0,Math.min(b,a+(c||0)));
this.seekAndCenter(a/b)
},seekAndCenter:function(a){this.seekTo(a);
this.drawer.recenter(a)
},seekTo:function(b){var c=this.backend.isPaused();
var a=this.params.scrollParent;
if(c){this.params.scrollParent=false
}this.backend.seekTo(b*this.getDuration());
this.drawer.progress(this.backend.getPlayedPercents());
if(!c){this.backend.pause();
this.backend.play()
}this.params.scrollParent=a;
this.fireEvent("seek",b)
},stop:function(){this.pause();
this.seekTo(0);
this.drawer.progress(0)
},setVolume:function(a){this.backend.setVolume(a)
},setPlaybackRate:function(a){this.backend.setPlaybackRate(a)
},toggleMute:function(){if(this.isMuted){this.backend.setVolume(this.savedVolume);
this.isMuted=false
}else{this.savedVolume=this.backend.getVolume();
this.backend.setVolume(0);
this.isMuted=true
}},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent;
this.drawBuffer()
},toggleInteraction:function(){this.params.interact=!this.params.interact
},drawBuffer:function(){var d=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);
var c=this.drawer.getWidth();
var b=d;
if(this.params.fillParent&&(!this.params.scrollParent||d<c)){b=c
}var a=this.backend.getPeaksMainWaveform(b);
this.drawer.drawPeaksMainWaveform(a,b,200);
this.fireEvent("redraw",a,b)
},loadArrayBuffer:function(a){var b=this;
this.backend.decodeArrayBuffer(a,function(c){b.loadDecodedBuffer(c)
},function(){b.fireEvent("error","Error decoding audiobuffer")
})
},loadDecodedBuffer:function(a){this.empty();
this.backend.load(a);
this.drawBuffer();
this.fireEvent("ready")
},loadBlob:function(b){var c=this;
var a=new FileReader();
a.addEventListener("progress",function(d){c.onProgress(d)
});
a.addEventListener("load",function(d){c.empty();
c.loadArrayBuffer(d.target.result)
});
a.addEventListener("error",function(){c.fireEvent("error","Error reading file")
});
a.readAsArrayBuffer(b)
},load:function(b,a){switch(this.params.backend){case"WebAudio":return this.loadBuffer(b);
case"AudioElement":case"MediaElement":return this.loadMediaElement(b,a)
}},loadBuffer:function(a){this.empty();
return this.downloadArrayBuffer(a,this.loadArrayBuffer.bind(this))
},loadMediaElement:function(b,a){this.empty();
this.backend.load(b,this.mediaContainer,a);
this.backend.once("canplay",(function(){this.drawBuffer();
this.fireEvent("ready")
}).bind(this));
this.backend.once("error",(function(c){this.fireEvent("error",c)
}).bind(this));
if(!a&&this.backend.supportsWebAudio()){this.downloadArrayBuffer(b,(function(c){this.backend.decodeArrayBuffer(c,(function(d){this.backend.buffer=d;
this.drawBuffer()
}).bind(this))
}).bind(this))
}},downloadArrayBuffer:function(a,d){var c=this;
var b=WaveSurfer.util.ajax({url:a,responseType:"arraybuffer"});
b.on("progress",function(f){c.onProgress(f)
});
b.on("success",d);
b.on("error",function(f){c.fireEvent("error","XHR error: "+f.target.statusText)
});
return b
},onProgress:function(b){if(b.lengthComputable){var a=b.loaded/b.total
}else{a=b.loaded/(b.loaded+1000000)
}this.fireEvent("loading",Math.round(a*100),b.target)
},exportPCM:function(f,g,c){f=f||1024;
g=g||10000;
c=c||false;
var b=this.backend.getPeaks(f,g);
var a=[].map.call(b,function(h){return Math.round(h*g)/g
});
var d=JSON.stringify(a);
if(!c){window.open("data:application/json;charset=utf-8,"+encodeURIComponent(d))
}return d
},empty:function(){if(!this.backend.isPaused()){this.stop();
this.backend.disconnectSource()
}this.drawer.progress(0);
this.drawer.setWidth(0);
this.drawer.drawPeaks({length:this.drawer.getWidth()},0)
},destroy:function(){this.fireEvent("destroy");
this.unAll();
this.backend.destroy();
this.drawer.destroy()
}};
WaveSurfer.Observer={on:function(c,b){if(!this.handlers){this.handlers={}
}var a=this.handlers[c];
if(!a){a=this.handlers[c]=[]
}a.push(b)
},un:function(d,c){if(!this.handlers){return
}var a=this.handlers[d];
if(a){if(c){for(var b=a.length-1;
b>=0;
b--){if(a[b]==c){a.splice(b,1)
}}}else{a.length=0
}}},unAll:function(){this.handlers=null
},once:function(c,b){var d=this;
var a=function(){b.apply(this,arguments);
setTimeout(function(){d.un(c,a)
},0)
};
this.on(c,a)
},fireEvent:function(c){if(!this.handlers){return
}var a=this.handlers[c];
var b=Array.prototype.slice.call(arguments,1);
a&&a.forEach(function(d){d.apply(null,b)
})
}};
WaveSurfer.util={extend:function(b){var a=Array.prototype.slice.call(arguments,1);
a.forEach(function(c){Object.keys(c).forEach(function(d){b[d]=c[d]
})
});
return b
},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)
},max:function(c,f){var b=-Infinity;
for(var d=0,a=c.length;
d<a;
d++){var g=c[d];
if(f!=null){g=Math.abs(g-f)
}if(g>b){b=g
}}return b
},ajax:function(a){var c=Object.create(WaveSurfer.Observer);
var d=new XMLHttpRequest();
var b=false;
d.open(a.method||"GET",a.url,true);
d.responseType=a.responseType;
d.addEventListener("progress",function(f){c.fireEvent("progress",f);
if(f.lengthComputable&&f.loaded==f.total){b=true
}});
d.addEventListener("load",function(f){if(!b){c.fireEvent("progress",f)
}c.fireEvent("load",f);
if(200==d.status||206==d.status){c.fireEvent("success",d.response,f)
}else{c.fireEvent("error",f)
}});
d.addEventListener("error",function(f){c.fireEvent("error",f)
});
d.send();
c.xhr=d;
return c
}};
WaveSurfer.util.extend(WaveSurfer,WaveSurfer.Observer);
"use strict";
WaveSurfer.WebAudio={scriptBufferSize:256,fftSize:128,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return !!(window.AudioContext||window.webkitAudioContext)
},getAudioContext:function(){if(!WaveSurfer.WebAudio.audioContext){WaveSurfer.WebAudio.audioContext=new (window.AudioContext||window.webkitAudioContext)
}return WaveSurfer.WebAudio.audioContext
},getOfflineAudioContext:function(a){if(!WaveSurfer.WebAudio.offlineAudioContext){if(a>48000){a=48000
}WaveSurfer.WebAudio.offlineAudioContext=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,a)
}return WaveSurfer.WebAudio.offlineAudioContext
},init:function(a){this.params=a;
this.ac=a.audioContext||this.getAudioContext();
if(!this.ac){this.error="failed create AudioContext";
return(false)
}else{if(!this.ac.sampleRate){this.error="incorrect sample rate in AudioContext";
return(false)
}}this.lastPlay=this.ac.currentTime;
this.startPosition=0;
this.states=[Object.create(WaveSurfer.WebAudio.state.playing),Object.create(WaveSurfer.WebAudio.state.paused),Object.create(WaveSurfer.WebAudio.state.finished)];
this.setState(this.PAUSED_STATE);
this.createVolumeNode();
this.createScriptNode();
this.createAnalyserNode();
this.setPlaybackRate(this.params.audioRate);
return(true)
},disconnectFilters:function(){if(this.filters){this.filters.forEach(function(a){a&&a.disconnect()
});
this.filters=null
}},setState:function(a){if(this.state!==this.states[a]){this.state=this.states[a];
this.state.init.call(this)
}},setFilter:function(){this.setFilters([].slice.call(arguments))
},setFilters:function(a){this.disconnectFilters();
if(a&&a.length){this.filters=a;
a.reduce(function(b,c){b.connect(c);
return c
},this.analyser).connect(this.gainNode)
}else{this.analyser.connect(this.gainNode)
}},createScriptNode:function(){var a=this;
var b=this.scriptBufferSize;
if(this.ac.createScriptProcessor){this.scriptNode=this.ac.createScriptProcessor(b)
}else{this.scriptNode=this.ac.createJavaScriptNode(b)
}this.scriptNode.connect(this.ac.destination);
this.scriptNode.onaudioprocess=function(){var c=a.getCurrentTime();
if(a.state===a.states[a.PLAYING_STATE]){a.fireEvent("audioprocess",c)
}if(a.buffer&&c>a.getDuration()){a.setState(a.FINISHED_STATE)
}}
},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser();
this.analyser.fftSize=this.fftSize;
this.analyserData=new Uint8Array(this.analyser.frequencyBinCount);
this.analyser.connect(this.gainNode)
},createVolumeNode:function(){if(this.ac.createGain){this.gainNode=this.ac.createGain()
}else{this.gainNode=this.ac.createGainNode()
}this.gainNode.connect(this.ac.destination)
},setVolume:function(a){this.gainNode.gain.value=a
},getVolume:function(){return this.gainNode.gain.value
},decodeArrayBuffer:function(b,c,a){if(!this.offlineAc){this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)
}this.offlineAc.decodeAudioData(b,(function(d){c(d)
}).bind(this),a)
},getPeaks:function(b){var k=this.buffer;
var d=k.length/b;
var m=~~(d/10)||1;
var n=k.numberOfChannels;
var q=new Float32Array(b);
for(var o=0;
o<n;
o++){var f=k.getChannelData(o);
for(var l=0;
l<b;
l++){var a=~~(l*d);
var g=~~(a+d);
var p=0;
for(var h=a;
h<g;
h+=m){var r=f[h];
if(r>p){p=r
}else{if(-r>p){p=-r
}}}if(o==0||p>q[l]){q[l]=p
}}}return q
},getPeaksMainWaveform:function(b){var k=this.buffer;
var d=k.length/b;
var m=~~(d/10)||1;
var n=k.numberOfChannels;
var q=new Float32Array(n*b);
for(var o=0;
o<n;
o++){var f=k.getChannelData(o);
for(var l=0;
l<b;
l++){var a=~~(l*d);
var g=~~(a+d);
var p=0;
for(var h=a;
h<g;
h+=m){var r=f[h];
if(r>p){p=r
}else{if(-r>p){p=-r
}}}q[o*b+l]=p
}}return q
},getNumberOfChannels:function(){return this.buffer.numberOfChannels||1
},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)
},disconnectSource:function(){if(this.source){this.source.disconnect()
}},waveform:function(){this.analyser.getByteTimeDomainData(this.analyserData);
return this.analyserData
},destroy:function(){if(this.error){return
}if(!this.error&&!this.isPaused()){this.pause()
}this.unAll();
this.buffer=null;
this.disconnectFilters();
this.disconnectSource();
this.gainNode.disconnect();
this.scriptNode.disconnect();
this.analyser.disconnect()
},load:function(a){this.startPosition=0;
this.lastPlay=this.ac.currentTime;
this.buffer=a;
this.createSource()
},createSource:function(){this.disconnectSource();
this.source=this.ac.createBufferSource();
this.source.start=this.source.start||this.source.noteGrainOn;
this.source.stop=this.source.stop||this.source.noteOff;
this.source.playbackRate.value=this.playbackRate;
this.source.buffer=this.buffer;
this.source.connect(this.analyser)
},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]
},getDuration:function(){if(this.buffer===undefined){return 0
}return this.buffer.duration
},seekTo:function(b,a){if(b==null){b=this.getCurrentTime();
if(b>=this.getDuration()){b=0
}}if(a==null){a=this.getDuration()
}this.startPosition=b;
this.lastPlay=this.ac.currentTime;
if(this.state===this.states[this.FINISHED_STATE]){this.setState(this.PAUSED_STATE)
}return{start:b,end:a}
},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate
},play:function(c,b){this.createSource();
var a=this.seekTo(c,b);
c=a.start;
b=a.end;
this.source.start(0,c,b-c);
this.setState(this.PLAYING_STATE)
},pause:function(){this.startPosition+=this.getPlayedTime();
this.source&&this.source.stop(0);
this.setState(this.PAUSED_STATE)
},getCurrentTime:function(){return this.state.getCurrentTime.call(this)
},setPlaybackRate:function(a){a=a||1;
if(this.isPaused()){this.playbackRate=a
}else{this.pause();
this.playbackRate=a;
this.play()
}},getPlaybackRate:function(){return this.playbackRate||1
}};
WaveSurfer.WebAudio.state={};
WaveSurfer.WebAudio.state.playing={init:function(){},getPlayedPercents:function(){var a=this.getDuration();
return(this.getCurrentTime()/a)||0
},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()
}};
WaveSurfer.WebAudio.state.paused={init:function(){},getPlayedPercents:function(){var a=this.getDuration();
return(this.getCurrentTime()/a)||0
},getCurrentTime:function(){return this.startPosition
}};
WaveSurfer.WebAudio.state.finished={init:function(){this.fireEvent("finish")
},getPlayedPercents:function(){return 1
},getCurrentTime:function(){return this.getDuration()
}};
WaveSurfer.util.extend(WaveSurfer.WebAudio,WaveSurfer.Observer);
"use strict";
WaveSurfer.MediaElement=Object.create(WaveSurfer.WebAudio);
WaveSurfer.util.extend(WaveSurfer.MediaElement,{init:function(a){this.params=a;
this.media={currentTime:0,duration:0,paused:true,playbackRate:1,play:function(){},pause:function(){}};
this.mediaType=a.mediaType.toLowerCase();
this.ac=a.audioContext||this.getAudioContext();
this.elementPosition=a.elementPosition
},load:function(c,a,b){var f=this;
var d=document.createElement(this.mediaType);
d.controls=false;
d.autoplay=false;
d.preload="auto";
d.src=c;
d.addEventListener("error",function(){f.fireEvent("error","Error loading media element")
});
d.addEventListener("canplay",function(){f.fireEvent("canplay")
});
d.addEventListener("ended",function(){f.fireEvent("finish")
});
d.addEventListener("timeupdate",function(){f.fireEvent("audioprocess",f.getCurrentTime())
});
var g=a.querySelector(this.mediaType);
if(g){a.removeChild(g)
}a.appendChild(d);
this.media=d;
this.peaks=b;
this.onPlayEnd=null;
this.setPlaybackRate(this.playbackRate)
},isPaused:function(){return this.media.paused
},getDuration:function(){var a=this.media.duration;
if(a>=Infinity){a=this.media.seekable.end()
}return a
},getCurrentTime:function(){return this.media.currentTime
},getPlayedPercents:function(){return(this.getCurrentTime()/this.getDuration())||0
},setPlaybackRate:function(a){this.playbackRate=a||1;
this.media.playbackRate=this.playbackRate
},seekTo:function(a){if(a!=null){this.media.currentTime=a
}this.clearPlayEnd()
},play:function(b,a){this.seekTo(b);
this.media.play();
a&&this.setPlayEnd(a)
},pause:function(){this.media.pause();
this.clearPlayEnd()
},setPlayEnd:function(a){var b=this;
this.onPlayEnd=function(c){if(c>=a){b.pause();
b.seekTo(a)
}};
this.on("audioprocess",this.onPlayEnd)
},clearPlayEnd:function(){if(this.onPlayEnd){this.un("audioprocess",this.onPlayEnd);
this.onPlayEnd=null
}},getPeaks:function(a){if(this.buffer){return WaveSurfer.WebAudio.getPeaks.call(this,a)
}return this.peaks||[]
},getVolume:function(){return this.media.volume
},setVolume:function(a){this.media.volume=a
},destroy:function(){this.pause();
this.unAll();
this.media.parentNode&&this.media.parentNode.removeChild(this.media);
this.media=null
}});
WaveSurfer.AudioElement=WaveSurfer.MediaElement;
"use strict";
WaveSurfer.Drawer={init:function(a,b){this.container=a;
this.params=b;
this.width=0;
this.height=b.height*this.params.pixelRatio;
this.lastPos=0;
this.createWrapper();
this.createElements()
},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));
this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});
if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"})
}this.setupWrapperEvents()
},handleEvent:function(a){a.preventDefault();
var b=this.wrapper.getBoundingClientRect();
return((a.clientX-b.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth)||0
},setupWrapperEvents:function(){var a=this;
this.wrapper.addEventListener("click",function(b){var d=a.wrapper.offsetHeight-a.wrapper.clientHeight;
if(d!=0){var c=a.wrapper.getBoundingClientRect();
if(b.clientY>=c.bottom-d){return
}}if(a.params.interact){a.fireEvent("click",b,a.handleEvent(b))
}});
this.wrapper.addEventListener("scroll",function(b){a.fireEvent("scroll",b)
})
},drawPeaks:function(b,c){this.resetScroll();
this.setWidth(c);
if(this.params.normalize){var a=WaveSurfer.util.max(b)
}else{a=1
}this.drawWave(b,a)
},drawPeaksMainWaveform:function(c,d,b){this.resetScroll();
this.setWidthnHeight(d,b);
if(this.params.normalize){var a=WaveSurfer.util.max(c)
}else{a=1
}this.drawWaveMainWaveform(c,d,a)
},style:function(a,b){Object.keys(b).forEach(function(c){if(a.style[c]!=b[c]){a.style[c]=b[c]
}});
return a
},resetScroll:function(){if(this.wrapper!==null){this.wrapper.scrollLeft=0
}},recenter:function(b){var a=this.wrapper.scrollWidth*b;
this.recenterOnPosition(a,true)
},recenterOnPosition:function(a,b){var k=this.wrapper.scrollLeft;
var f=~~(this.wrapper.clientWidth/2);
var g=a-f;
var h=g-k;
var d=this.wrapper.scrollWidth-this.wrapper.clientWidth;
if(d==0){return
}if(!b&&-f<=h&&h<f){var c=20*WaveSurfer.WebAudio.getPlaybackRate();
h=Math.max(-c,Math.min(c,h));
g=k+h
}g=Math.max(0,Math.min(d,g));
if(g!=k){this.wrapper.scrollLeft=g
}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)
},getHeight:function(){return Math.round(this.wrapper.clientHeight)
},setWidth:function(a){if(a==this.width){return
}this.width=a;
if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:""})
}else{this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"})
}this.updateWidth()
},setWidthnHeight:function(b,a){if(b==this.width&&a==this.height){return
}this.width=b;
this.height=a;
if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:"",height:a+"px"})
}else{this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px",height:a+"px"})
}this.updateWidthnHeight()
},progress:function(b){var a=1/this.params.pixelRatio;
var d=Math.round(b*this.width)*a;
if(d<this.lastPos||d-this.lastPos>=a){this.lastPos=d;
if(this.params.scrollParent){var c=~~(this.wrapper.scrollWidth*b);
this.recenterOnPosition(c)
}this.updateProgress(b)
}},destroy:function(){this.unAll();
this.container.removeChild(this.wrapper);
this.wrapper=null
},createElements:function(){},updateWidth:function(){},drawWave:function(b,a){},clearWave:function(){},updateProgress:function(a){}};
WaveSurfer.util.extend(WaveSurfer.Drawer,WaveSurfer.Observer);
"use strict";
WaveSurfer.Drawer.Canvas=Object.create(WaveSurfer.Drawer);
WaveSurfer.util.extend(WaveSurfer.Drawer.Canvas,{createElements:function(){var b=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1}));
this.waveCc=b.getContext("2d");
this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,overflow:"hidden",width:"0",height:this.params.height+"px",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor}));
if(this.params.waveColor!=this.params.progressColor){var a=this.progressWave.appendChild(document.createElement("canvas"));
this.progressCc=a.getContext("2d")
}},updateWidth:function(){var a=Math.round(this.width/this.params.pixelRatio);
this.waveCc.canvas.width=this.width;
this.waveCc.canvas.height=this.height;
this.style(this.waveCc.canvas,{width:a+"px"});
if(this.progressCc){this.progressCc.canvas.width=this.width;
this.progressCc.canvas.height=this.height;
this.style(this.progressCc.canvas,{width:a+"px"})
}this.clearWave()
},updateWidthnHeight:function(){var b=Math.round(this.width/this.params.pixelRatio);
var a=this.height;
this.waveCc.canvas.width=this.width;
this.waveCc.canvas.height=this.height;
this.style(this.waveCc.canvas,{width:b+"px"});
this.style(this.waveCc.canvas,{height:a+"px"});
if(this.progressCc){this.progressCc.canvas.width=this.width;
this.progressCc.canvas.height=this.height;
this.style(this.progressCc.canvas,{width:b+"px"});
this.style(this.progressCc.canvas.parentElement,{height:a+"px"})
}this.clearWave()
},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height);
if(this.progressCc){this.progressCc.clearRect(0,0,this.width,this.height)
}},drawWave:function(b,a){var f=0.5/this.params.pixelRatio;
var h=this.height/2;
var d=h/a;
var c=b.length;
var g=1;
if(this.params.fillParent&&this.width!=c){g=this.width/c
}this.waveCc.fillStyle=this.params.waveColor;
if(this.progressCc){this.progressCc.fillStyle=this.params.progressColor
}[this.waveCc,this.progressCc].forEach(function(m){if(!m){return
}m.beginPath();
m.moveTo(f,h);
for(var k=0;
k<c;
k++){var l=Math.round(b[k]*d);
m.lineTo(k*g+f,h+l)
}m.lineTo(this.width+f,h);
m.moveTo(f,h);
for(var k=0;
k<c;
k++){var l=Math.round(b[k]*d);
m.lineTo(k*g+f,h-l)
}m.lineTo(this.width+f,h);
m.fill();
m.fillRect(0,h-f,this.width,f)
},this)
},drawWaveMainWaveform:function(o,b,l){var f=0.5/this.params.pixelRatio;
var g=0.95;
var a=Math.round(o.length/b);
var h=this.height/a;
var m=h/2;
for(var c=0;
c<a;
c++){var p=c*h+m;
var k=m/l;
var d=1;
if(this.params.fillParent&&this.width!=b){d=this.width/b
}this.waveCc.fillStyle=this.params.waveColor;
if(this.progressCc){this.progressCc.fillStyle=this.params.progressColor
}[this.waveCc,this.progressCc].forEach(function(r){if(!r){return
}r.fillRect(0,(c*h)-f,this.width,f);
r.fillRect(0,p-f,this.width,f);
r.beginPath();
r.moveTo(f,p);
for(var n=c*b;
n<(c+1)*b;
n++){var q=Math.round(o[n]*k);
r.lineTo((n-(c*b))*d+f,p+(g*q))
}r.lineTo(this.width+f,p);
r.moveTo(f,p);
for(var n=c*b;
n<(c+1)*b;
n++){var q=Math.round(o[n]*k);
r.lineTo((n-(c*b))*d+f,p-(g*q))
}r.lineTo(this.width+f,p);
r.fill()
},this)
}},updateProgress:function(a){var b=Math.round(this.width*a)/this.params.pixelRatio;
this.style(this.progressWave,{width:b+"px"})
}});
(function(a,b){if(typeof define==="function"&&define.amd){define(["wavesurfer"],b)
}else{a.WaveSurfer.Timeline=b(a.WaveSurfer)
}}(this,function(a){a.Timeline={init:function(d){this.params=d;
var b=this.wavesurfer=d.wavesurfer;
if(!this.wavesurfer){throw Error("No WaveSurfer intance provided")
}var c=this.drawer=this.wavesurfer.drawer;
this.container="string"==typeof d.container?document.querySelector(d.container):d.container;
if(!this.container){throw Error("No container for WaveSurfer timeline")
}this.width=c.width;
this.height=this.params.height||20;
this.notchPercentHeight=this.params.notchPercentHeight||90;
this.primaryColor=this.params.primaryColor||"#000";
this.secondaryColor=this.params.secondaryColor||"#c0c0c0";
this.primaryFontColor=this.params.primaryFontColor||"#000";
this.secondaryFontColor=this.params.secondaryFontColor||"#000";
this.fontFamily=this.params.fontFamily||"Arial";
this.fontSize=this.params.fontSize||10;
this.createWrapper();
this.createCanvas();
this.render();
b.drawer.wrapper.onscroll=this.updateScroll.bind(this);
b.on("redraw",this.render.bind(this))
},createWrapper:function(){var b=this.container.querySelector("timeline");
if(b){this.container.removeChild(b)
}var c=this.wavesurfer.params;
this.wrapper=this.container.appendChild(document.createElement("timeline"));
this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.height+"px"});
if(c.fillParent||c.scrollParent){this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"})
}var d=this;
this.wrapper.addEventListener("click",function(g){g.preventDefault();
var f="offsetX" in g?g.offsetX:g.layerX;
d.fireEvent("click",(f/d.wrapper.scrollWidth)||0)
})
},createCanvas:function(){var b=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));
this.timeCc=b.getContext("2d");
this.wavesurfer.drawer.style(b,{position:"absolute",zIndex:4})
},render:function(){this.updateCanvasStyle();
this.drawTimeCanvas()
},updateCanvasStyle:function(){var b=Math.round(this.drawer.wrapper.scrollWidth/this.wavesurfer.params.pixelRatio);
this.canvas.width=b;
this.canvas.height=this.height;
this.canvas.style.width=b+"px"
},drawTimeCanvas:function(){var o=this.wavesurfer.backend,n=this.wavesurfer.params,d=o.getDuration();
if(n.fillParent&&!n.scrollParent){var b=this.drawer.getWidth();
var r=b/d
}else{var b=o.getDuration()*n.minPxPerSec;
var r=n.minPxPerSec
}r=r/n.pixelRatio;
if(d>0){var p=0,c=0,h=parseInt(d,10)+1,s=function(u){if(u/60>1){var t=parseInt(u/60),u=parseInt(u%60);
u=(u<10)?"0"+u:u;
return""+t+":"+u
}else{return u
}};
if(r*1>=25){var m=1;
var q=10;
var l=5
}else{if(r*5>=25){var m=5;
var q=6;
var l=2
}else{if(r*15>=25){var m=15;
var q=4;
var l=2
}else{var m=60;
var q=4;
var l=2
}}}var k=this.height-4,g=(this.height*(this.notchPercentHeight/100))-4;
for(var f=0;
f<h/m;
f++){if(f%q==0){this.timeCc.fillStyle=this.primaryColor;
this.timeCc.fillRect(p,0,1,k);
this.timeCc.font=this.fontSize+"px "+this.fontFamily;
this.timeCc.fillStyle=this.primaryFontColor;
this.timeCc.fillText(s(c),p+5,k)
}else{if(f%l==0){this.timeCc.fillStyle=this.secondaryColor;
this.timeCc.fillRect(p,0,1,k);
this.timeCc.font=this.fontSize+"px "+this.fontFamily;
this.timeCc.fillStyle=this.secondaryFontColor;
this.timeCc.fillText(s(c),p+5,k)
}else{this.timeCc.fillStyle=this.secondaryColor;
this.timeCc.fillRect(p,0,1,g)
}}c+=m;
p+=r*m
}}},updateScroll:function(b){this.wrapper.scrollLeft=b.target.scrollLeft
}};
a.util.extend(a.Timeline,a.Observer);
return a.Timeline
}));
"use strict";
WaveSurfer.Spectrogram={init:function(c){this.params=c;
var a=this.wavesurfer=c.wavesurfer;
if(!this.wavesurfer){throw Error("No WaveSurfer intance provided")
}this.frequenciesDataUrl=c.frequenciesDataUrl;
var b=this.drawer=this.wavesurfer.drawer;
this.buffer=this.wavesurfer.backend.buffer;
this.container="string"==typeof c.container?document.querySelector(c.container):c.container;
if(!this.container){throw Error("No container for WaveSurfer spectrogram")
}this.width=b.width;
this.pixelRatio=this.params.pixelRatio||a.params.pixelRatio;
this.fftSamples=this.params.fftSamples||a.params.fftSamples||512;
this.height=this.fftSamples/2;
this.createWrapper();
this.createCanvas();
this.render();
a.drawer.wrapper.onscroll=this.updateScroll.bind(this);
a.on("redraw",this.render.bind(this))
},createWrapper:function(){var a=this.wavesurfer.params;
this.wrapper=this.container.appendChild(document.createElement("spectrogram"));
this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.height+"px"});
if(a.fillParent||a.scrollParent){this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"})
}var b=this;
this.wrapper.addEventListener("click",function(d){d.preventDefault();
var c="offsetX" in d?d.offsetX:d.layerX;
b.fireEvent("click",(c/b.scrollWidth)||0)
})
},createCanvas:function(){var a=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));
this.spectrCc=a.getContext("2d");
this.wavesurfer.drawer.style(a,{position:"absolute",zIndex:4})
},render:function(){this.updateCanvasStyle();
if(this.frequenciesDataUrl){this.loadFrequenciesData(this.frequenciesDataUrl)
}else{this.getFrequencies(this.drawSpectrogram)
}},updateCanvasStyle:function(){var a=Math.round(this.width/this.pixelRatio)+"px";
this.canvas.width=this.width;
this.canvas.height=this.height;
this.canvas.style.width=a
},drawSpectrogram:function(l,k){var h=k.spectrCc;
var b=k.wavesurfer.backend.getDuration();
var m=k.height;
var c=k.resample(l);
var d=2/k.buffer.numberOfChannels;
for(var g=0;
g<c.length;
g++){for(var f=0;
f<c[g].length;
f++){var a=255-c[g][f];
k.spectrCc.fillStyle="rgb("+a+", "+a+", "+a+")";
k.spectrCc.fillRect(g,m-f*d,1,1*d)
}}},getFrequencies:function(k){var g=this.fftSamples;
var f=this.buffer;
var d=new Array();
var b=new window.OfflineAudioContext(1,f.length,f.sampleRate);
var a=b.createBufferSource();
var c=b.createScriptProcessor(16384,1,1);
var l=b.createAnalyser();
l.fftSize=g;
l.smoothingTimeConstant=(this.width/f.duration<10)?0.75:0.25;
a.buffer=f;
a.connect(l);
l.connect(c);
c.connect(b.destination);
c.onaudioprocess=function(){var m=new Uint8Array(l.frequencyBinCount);
l.getByteFrequencyData(m);
d.push(m)
};
a.start(0);
b.startRendering();
var h=this;
b.oncomplete=function(){k(d,h)
}
},loadFrequenciesData:function(a){var c=this;
var b=WaveSurfer.util.ajax({url:a});
b.on("success",function(d){c.drawSpectrogram(JSON.parse(d),c)
});
b.on("error",function(d){c.fireEvent("error","XHR error: "+d.target.statusText)
});
return b
},updateScroll:function(a){this.wrapper.scrollLeft=a.target.scrollLeft
},resample:function(p,b){var b=this.width;
var q=new Array();
var a=1/p.length;
var d=1/b;
for(var n=0;
n<b;
n++){var f=new Array(p[0].length);
for(var l=0;
l<p.length;
l++){var h=l*a;
var s=h+a;
var m=n*d;
var c=m+d;
var o=(s<=m||c<=h)?0:Math.min(Math.max(s,m),Math.max(c,h))-Math.max(Math.min(s,m),Math.min(c,h));
if(o>0){for(var g=0;
g<p[0].length;
g++){if(f[g]==null){f[g]=0
}f[g]+=(o/d)*p[l][g]
}}}var r=new Uint8Array(p[0].length);
for(var g=0;
g<p[0].length;
g++){r[g]=f[g]
}q.push(r)
}return q
}};
WaveSurfer.util.extend(WaveSurfer.Spectrogram,WaveSurfer.Observer);
(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()
}else{if(typeof define==="function"&&define.amd){define([],b)
}else{var a;
if(typeof window!=="undefined"){a=window
}else{if(typeof global!=="undefined"){a=global
}else{if(typeof self!=="undefined"){a=self
}else{a=this
}}}a.pako=b()
}}})(function(){var d,b,a;
return(function c(g,m,k){function h(s,q){if(!m[s]){if(!g[s]){var p=typeof require=="function"&&require;
if(!q&&p){return p(s,!0)
}if(f){return f(s,!0)
}var r=new Error("Cannot find module '"+s+"'");
throw r.code="MODULE_NOT_FOUND",r
}var n=m[s]={exports:{}};
g[s][0].call(n.exports,function(o){var t=g[s][1][o];
return h(t?t:o)
},n,n.exports,c,g,m,k)
}return m[s].exports
}var f=typeof require=="function"&&require;
for(var l=0;
l<k.length;
l++){h(k[l])
}return h
})({1:[function(g,h,f){var m=(typeof Uint8Array!=="undefined")&&(typeof Uint16Array!=="undefined")&&(typeof Int32Array!=="undefined");
f.assign=function(r){var n=Array.prototype.slice.call(arguments,1);
while(n.length){var o=n.shift();
if(!o){continue
}if(typeof o!=="object"){throw new TypeError(o+"must be non-object")
}for(var q in o){if(o.hasOwnProperty(q)){r[q]=o[q]
}}}return r
};
f.shrinkBuf=function(n,o){if(n.length===o){return n
}if(n.subarray){return n.subarray(0,o)
}n.length=o;
return n
};
var k={arraySet:function(o,q,s,n,r){if(q.subarray&&o.subarray){o.set(q.subarray(s,s+n),r);
return
}for(var p=0;
p<n;
p++){o[r+p]=q[s+p]
}},flattenChunks:function(t){var r,p,o,s,q,n;
o=0;
for(r=0,p=t.length;
r<p;
r++){o+=t[r].length
}n=new Uint8Array(o);
s=0;
for(r=0,p=t.length;
r<p;
r++){q=t[r];
n.set(q,s);
s+=q.length
}return n
}};
var l={arraySet:function(o,q,s,n,r){for(var p=0;
p<n;
p++){o[r+p]=q[s+p]
}},flattenChunks:function(n){return[].concat.apply([],n)
}};
f.setTyped=function(n){if(n){f.Buf8=Uint8Array;
f.Buf16=Uint16Array;
f.Buf32=Int32Array;
f.assign(f,k)
}else{f.Buf8=Array;
f.Buf16=Array;
f.Buf32=Array;
f.assign(f,l)
}};
f.setTyped(m)
},{}],2:[function(k,g,l){var r=k("./common");
var o=true;
var m=true;
try{String.fromCharCode.apply(null,[0])
}catch(p){o=false
}try{String.fromCharCode.apply(null,new Uint8Array(1))
}catch(p){m=false
}var h=new r.Buf8(256);
for(var f=0;
f<256;
f++){h[f]=(f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1)
}h[254]=h[254]=1;
l.string2buf=function(y){var q,z,t,u,s,w=y.length,v=0;
for(u=0;
u<w;
u++){z=y.charCodeAt(u);
if((z&64512)===55296&&(u+1<w)){t=y.charCodeAt(u+1);
if((t&64512)===56320){z=65536+((z-55296)<<10)+(t-56320);
u++
}}v+=z<128?1:z<2048?2:z<65536?3:4
}q=new r.Buf8(v);
for(s=0,u=0;
s<v;
u++){z=y.charCodeAt(u);
if((z&64512)===55296&&(u+1<w)){t=y.charCodeAt(u+1);
if((t&64512)===56320){z=65536+((z-55296)<<10)+(t-56320);
u++
}}if(z<128){q[s++]=z
}else{if(z<2048){q[s++]=192|(z>>>6);
q[s++]=128|(z&63)
}else{if(z<65536){q[s++]=224|(z>>>12);
q[s++]=128|(z>>>6&63);
q[s++]=128|(z&63)
}else{q[s++]=240|(z>>>18);
q[s++]=128|(z>>>12&63);
q[s++]=128|(z>>>6&63);
q[s++]=128|(z&63)
}}}}return q
};
function n(t,s){if(s<65537){if((t.subarray&&m)||(!t.subarray&&o)){return String.fromCharCode.apply(null,r.shrinkBuf(t,s))
}}var q="";
for(var u=0;
u<s;
u++){q+=String.fromCharCode(t[u])
}return q
}l.buf2binstring=function(q){return n(q,q.length)
};
l.binstring2buf=function(u){var s=new r.Buf8(u.length);
for(var t=0,q=s.length;
t<q;
t++){s[t]=u.charCodeAt(t)
}return s
};
l.buf2string=function(w,t){var y,v,z,u;
var s=t||w.length;
var q=new Array(s*2);
for(v=0,y=0;
y<s;
){z=w[y++];
if(z<128){q[v++]=z;
continue
}u=h[z];
if(u>4){q[v++]=65533;
y+=u-1;
continue
}z&=u===2?31:u===3?15:7;
while(u>1&&y<s){z=(z<<6)|(w[y++]&63);
u--
}if(u>1){q[v++]=65533;
continue
}if(z<65536){q[v++]=z
}else{z-=65536;
q[v++]=55296|((z>>10)&1023);
q[v++]=56320|(z&1023)
}}return n(q,v)
};
l.utf8border=function(s,q){var t;
q=q||s.length;
if(q>s.length){q=s.length
}t=q-1;
while(t>=0&&(s[t]&192)===128){t--
}if(t<0){return q
}if(t===0){return q
}return(t+h[s[t]]>q)?t:q
}
},{"./common":1}],3:[function(g,h,f){function k(p,o,l,s){var q=(p&65535)|0,m=((p>>>16)&65535)|0,r=0;
while(l!==0){r=l>2000?2000:l;
l-=r;
do{q=(q+o[s++])|0;
m=(m+q)|0
}while(--r);
q%=65521;
m%=65521
}return(q|(m<<16))|0
}h.exports=k
},{}],4:[function(g,h,f){h.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}
},{}],5:[function(h,k,g){function l(){var r,p=[];
for(var q=0;
q<256;
q++){r=q;
for(var o=0;
o<8;
o++){r=((r&1)?(3988292384^(r>>>1)):(r>>>1))
}p[q]=r
}return p
}var f=l();
function m(s,p,n,u){var r=f,o=u+n;
s=s^(-1);
for(var q=u;
q<o;
q++){s=(s>>>8)^r[(s^p[q])&255]
}return(s^(-1))
}k.exports=m
},{}],6:[function(g,h,f){function k(){this.text=0;
this.time=0;
this.xflags=0;
this.os=0;
this.extra=null;
this.extra_len=0;
this.name="";
this.comment="";
this.hcrc=0;
this.done=false
}h.exports=k
},{}],7:[function(h,k,g){var l=30;
var m=12;
k.exports=function f(M,s){var t;
var O;
var z;
var N;
var y;
var r;
var F;
var o;
var D;
var p;
var G;
var C;
var J;
var H;
var K;
var w;
var A;
var n;
var v;
var L;
var E;
var I;
var q;
var B,u;
t=M.state;
O=M.next_in;
B=M.input;
z=O+(M.avail_in-5);
N=M.next_out;
u=M.output;
y=N-(s-M.avail_out);
r=N+(M.avail_out-257);
F=t.dmax;
o=t.wsize;
D=t.whave;
p=t.wnext;
G=t.window;
C=t.hold;
J=t.bits;
H=t.lencode;
K=t.distcode;
w=(1<<t.lenbits)-1;
A=(1<<t.distbits)-1;
top:do{if(J<15){C+=B[O++]<<J;
J+=8;
C+=B[O++]<<J;
J+=8
}n=H[C&w];
dolen:for(;
;
){v=n>>>24;
C>>>=v;
J-=v;
v=(n>>>16)&255;
if(v===0){u[N++]=n&65535
}else{if(v&16){L=n&65535;
v&=15;
if(v){if(J<v){C+=B[O++]<<J;
J+=8
}L+=C&((1<<v)-1);
C>>>=v;
J-=v
}if(J<15){C+=B[O++]<<J;
J+=8;
C+=B[O++]<<J;
J+=8
}n=K[C&A];
dodist:for(;
;
){v=n>>>24;
C>>>=v;
J-=v;
v=(n>>>16)&255;
if(v&16){E=n&65535;
v&=15;
if(J<v){C+=B[O++]<<J;
J+=8;
if(J<v){C+=B[O++]<<J;
J+=8
}}E+=C&((1<<v)-1);
if(E>F){M.msg="invalid distance too far back";
t.mode=l;
break top
}C>>>=v;
J-=v;
v=N-y;
if(E>v){v=E-v;
if(v>D){if(t.sane){M.msg="invalid distance too far back";
t.mode=l;
break top
}}I=0;
q=G;
if(p===0){I+=o-v;
if(v<L){L-=v;
do{u[N++]=G[I++]
}while(--v);
I=N-E;
q=u
}}else{if(p<v){I+=o+p-v;
v-=p;
if(v<L){L-=v;
do{u[N++]=G[I++]
}while(--v);
I=0;
if(p<L){v=p;
L-=v;
do{u[N++]=G[I++]
}while(--v);
I=N-E;
q=u
}}}else{I+=p-v;
if(v<L){L-=v;
do{u[N++]=G[I++]
}while(--v);
I=N-E;
q=u
}}}while(L>2){u[N++]=q[I++];
u[N++]=q[I++];
u[N++]=q[I++];
L-=3
}if(L){u[N++]=q[I++];
if(L>1){u[N++]=q[I++]
}}}else{I=N-E;
do{u[N++]=u[I++];
u[N++]=u[I++];
u[N++]=u[I++];
L-=3
}while(L>2);
if(L){u[N++]=u[I++];
if(L>1){u[N++]=u[I++]
}}}}else{if((v&64)===0){n=K[(n&65535)+(C&((1<<v)-1))];
continue dodist
}else{M.msg="invalid distance code";
t.mode=l;
break top
}}break
}}else{if((v&64)===0){n=H[(n&65535)+(C&((1<<v)-1))];
continue dolen
}else{if(v&32){t.mode=m;
break top
}else{M.msg="invalid literal/length code";
t.mode=l;
break top
}}}}break
}}while(O<z&&N<r);
L=J>>3;
O-=L;
J-=L<<3;
C&=(1<<J)-1;
M.next_in=O;
M.next_out=N;
M.avail_in=(O<z?5+(z-O):5-(O-z));
M.avail_out=(N<r?257+(r-N):257-(N-r));
t.hold=C;
t.bits=J;
return
}
},{}],8:[function(aw,aB,R){var W=aw("../utils/common");
var Q=aw("./adler32");
var ah=aw("./crc32");
var au=aw("./inffast");
var q=aw("./inftrees");
var ag=0;
var ai=1;
var N=2;
var s=4;
var X=5;
var G=6;
var z=0;
var D=1;
var y=2;
var ax=-2;
var B=-3;
var P=-4;
var m=-5;
var ae=8;
var ap=1;
var ao=2;
var n=3;
var ak=4;
var I=5;
var g=6;
var w=7;
var ac=8;
var u=9;
var av=10;
var A=11;
var p=12;
var am=13;
var k=14;
var aD=15;
var at=16;
var r=17;
var E=18;
var Y=19;
var ad=20;
var f=21;
var aA=22;
var Z=23;
var ay=24;
var H=25;
var J=26;
var ar=27;
var aa=28;
var F=29;
var h=30;
var aC=31;
var K=32;
var ab=852;
var T=592;
var U=15;
var O=U;
function v(aE){return(((aE>>>24)&255)+((aE>>>8)&65280)+((aE&65280)<<8)+((aE&255)<<24))
}function aj(){this.mode=0;
this.last=false;
this.wrap=0;
this.havedict=false;
this.flags=0;
this.dmax=0;
this.check=0;
this.total=0;
this.head=null;
this.wbits=0;
this.wsize=0;
this.whave=0;
this.wnext=0;
this.window=null;
this.hold=0;
this.bits=0;
this.length=0;
this.offset=0;
this.extra=0;
this.lencode=null;
this.distcode=null;
this.lenbits=0;
this.distbits=0;
this.ncode=0;
this.nlen=0;
this.ndist=0;
this.have=0;
this.next=null;
this.lens=new W.Buf16(320);
this.work=new W.Buf16(288);
this.lendyn=null;
this.distdyn=null;
this.sane=0;
this.back=0;
this.was=0
}function V(aE){var aF;
if(!aE||!aE.state){return ax
}aF=aE.state;
aE.total_in=aE.total_out=aF.total=0;
aE.msg="";
if(aF.wrap){aE.adler=aF.wrap&1
}aF.mode=ap;
aF.last=0;
aF.havedict=0;
aF.dmax=32768;
aF.head=null;
aF.hold=0;
aF.bits=0;
aF.lencode=aF.lendyn=new W.Buf32(ab);
aF.distcode=aF.distdyn=new W.Buf32(T);
aF.sane=1;
aF.back=-1;
return z
}function az(aE){var aF;
if(!aE||!aE.state){return ax
}aF=aE.state;
aF.wsize=0;
aF.whave=0;
aF.wnext=0;
return V(aE)
}function C(aE,aG){var aF;
var aH;
if(!aE||!aE.state){return ax
}aH=aE.state;
if(aG<0){aF=0;
aG=-aG
}else{aF=(aG>>4)+1;
if(aG<48){aG&=15
}}if(aG&&(aG<8||aG>15)){return ax
}if(aH.window!==null&&aH.wbits!==aG){aH.window=null
}aH.wrap=aF;
aH.wbits=aG;
return az(aE)
}function t(aE,aG){var aF;
var aH;
if(!aE){return ax
}aH=new aj();
aE.state=aH;
aH.window=null;
aF=C(aE,aG);
if(aF!==z){aE.state=null
}return aF
}function M(aE){return t(aE,O)
}var al=true;
var aq,o;
function L(aF){if(al){var aE;
aq=new W.Buf32(512);
o=new W.Buf32(32);
aE=0;
while(aE<144){aF.lens[aE++]=8
}while(aE<256){aF.lens[aE++]=9
}while(aE<280){aF.lens[aE++]=7
}while(aE<288){aF.lens[aE++]=8
}q(ai,aF.lens,0,288,aq,0,aF.work,{bits:9});
aE=0;
while(aE<32){aF.lens[aE++]=5
}q(N,aF.lens,0,32,o,0,aF.work,{bits:5});
al=false
}aF.lencode=aq;
aF.lenbits=9;
aF.distcode=o;
aF.distbits=5
}function S(aF,aI,aE,aJ){var aH;
var aG=aF.state;
if(aG.window===null){aG.wsize=1<<aG.wbits;
aG.wnext=0;
aG.whave=0;
aG.window=new W.Buf8(aG.wsize)
}if(aJ>=aG.wsize){W.arraySet(aG.window,aI,aE-aG.wsize,aG.wsize,0);
aG.wnext=0;
aG.whave=aG.wsize
}else{aH=aG.wsize-aG.wnext;
if(aH>aJ){aH=aJ
}W.arraySet(aG.window,aI,aE-aJ,aH,aG.wnext);
aJ-=aH;
if(aJ){W.arraySet(aG.window,aI,aE-aJ,aJ,0);
aG.wnext=aJ;
aG.whave=aG.wsize
}else{aG.wnext+=aH;
if(aG.wnext===aG.wsize){aG.wnext=0
}if(aG.whave<aG.wsize){aG.whave+=aH
}}}return 0
}function af(a1,aV){var aJ;
var aO,aM;
var aT;
var aK;
var aH,aI;
var aR;
var aX;
var a5,a4;
var aW;
var aY;
var aG;
var aE=0;
var a2,aN,a3;
var aS,aF,aP;
var a0;
var a6;
var aL=new W.Buf8(4);
var aQ;
var aU;
var aZ=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
if(!a1||!a1.state||!a1.output||(!a1.input&&a1.avail_in!==0)){return ax
}aJ=a1.state;
if(aJ.mode===p){aJ.mode=am
}aK=a1.next_out;
aM=a1.output;
aI=a1.avail_out;
aT=a1.next_in;
aO=a1.input;
aH=a1.avail_in;
aR=aJ.hold;
aX=aJ.bits;
a5=aH;
a4=aI;
a6=z;
inf_leave:for(;
;
){switch(aJ.mode){case ap:if(aJ.wrap===0){aJ.mode=am;
break
}while(aX<16){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if((aJ.wrap&2)&&aR===35615){aJ.check=0;
aL[0]=aR&255;
aL[1]=(aR>>>8)&255;
aJ.check=ah(aJ.check,aL,2,0);
aR=0;
aX=0;
aJ.mode=ao;
break
}aJ.flags=0;
if(aJ.head){aJ.head.done=false
}if(!(aJ.wrap&1)||(((aR&255)<<8)+(aR>>8))%31){a1.msg="incorrect header check";
aJ.mode=h;
break
}if((aR&15)!==ae){a1.msg="unknown compression method";
aJ.mode=h;
break
}aR>>>=4;
aX-=4;
a0=(aR&15)+8;
if(aJ.wbits===0){aJ.wbits=a0
}else{if(a0>aJ.wbits){a1.msg="invalid window size";
aJ.mode=h;
break
}}aJ.dmax=1<<a0;
a1.adler=aJ.check=1;
aJ.mode=aR&512?av:p;
aR=0;
aX=0;
break;
case ao:while(aX<16){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.flags=aR;
if((aJ.flags&255)!==ae){a1.msg="unknown compression method";
aJ.mode=h;
break
}if(aJ.flags&57344){a1.msg="unknown header flags set";
aJ.mode=h;
break
}if(aJ.head){aJ.head.text=((aR>>8)&1)
}if(aJ.flags&512){aL[0]=aR&255;
aL[1]=(aR>>>8)&255;
aJ.check=ah(aJ.check,aL,2,0)
}aR=0;
aX=0;
aJ.mode=n;
case n:while(aX<32){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if(aJ.head){aJ.head.time=aR
}if(aJ.flags&512){aL[0]=aR&255;
aL[1]=(aR>>>8)&255;
aL[2]=(aR>>>16)&255;
aL[3]=(aR>>>24)&255;
aJ.check=ah(aJ.check,aL,4,0)
}aR=0;
aX=0;
aJ.mode=ak;
case ak:while(aX<16){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if(aJ.head){aJ.head.xflags=(aR&255);
aJ.head.os=(aR>>8)
}if(aJ.flags&512){aL[0]=aR&255;
aL[1]=(aR>>>8)&255;
aJ.check=ah(aJ.check,aL,2,0)
}aR=0;
aX=0;
aJ.mode=I;
case I:if(aJ.flags&1024){while(aX<16){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.length=aR;
if(aJ.head){aJ.head.extra_len=aR
}if(aJ.flags&512){aL[0]=aR&255;
aL[1]=(aR>>>8)&255;
aJ.check=ah(aJ.check,aL,2,0)
}aR=0;
aX=0
}else{if(aJ.head){aJ.head.extra=null
}}aJ.mode=g;
case g:if(aJ.flags&1024){aW=aJ.length;
if(aW>aH){aW=aH
}if(aW){if(aJ.head){a0=aJ.head.extra_len-aJ.length;
if(!aJ.head.extra){aJ.head.extra=new Array(aJ.head.extra_len)
}W.arraySet(aJ.head.extra,aO,aT,aW,a0)
}if(aJ.flags&512){aJ.check=ah(aJ.check,aO,aW,aT)
}aH-=aW;
aT+=aW;
aJ.length-=aW
}if(aJ.length){break inf_leave
}}aJ.length=0;
aJ.mode=w;
case w:if(aJ.flags&2048){if(aH===0){break inf_leave
}aW=0;
do{a0=aO[aT+aW++];
if(aJ.head&&a0&&(aJ.length<65536)){aJ.head.name+=String.fromCharCode(a0)
}}while(a0&&aW<aH);
if(aJ.flags&512){aJ.check=ah(aJ.check,aO,aW,aT)
}aH-=aW;
aT+=aW;
if(a0){break inf_leave
}}else{if(aJ.head){aJ.head.name=null
}}aJ.length=0;
aJ.mode=ac;
case ac:if(aJ.flags&4096){if(aH===0){break inf_leave
}aW=0;
do{a0=aO[aT+aW++];
if(aJ.head&&a0&&(aJ.length<65536)){aJ.head.comment+=String.fromCharCode(a0)
}}while(a0&&aW<aH);
if(aJ.flags&512){aJ.check=ah(aJ.check,aO,aW,aT)
}aH-=aW;
aT+=aW;
if(a0){break inf_leave
}}else{if(aJ.head){aJ.head.comment=null
}}aJ.mode=u;
case u:if(aJ.flags&512){while(aX<16){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if(aR!==(aJ.check&65535)){a1.msg="header crc mismatch";
aJ.mode=h;
break
}aR=0;
aX=0
}if(aJ.head){aJ.head.hcrc=((aJ.flags>>9)&1);
aJ.head.done=true
}a1.adler=aJ.check=0;
aJ.mode=p;
break;
case av:while(aX<32){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}a1.adler=aJ.check=v(aR);
aR=0;
aX=0;
aJ.mode=A;
case A:if(aJ.havedict===0){a1.next_out=aK;
a1.avail_out=aI;
a1.next_in=aT;
a1.avail_in=aH;
aJ.hold=aR;
aJ.bits=aX;
return y
}a1.adler=aJ.check=1;
aJ.mode=p;
case p:if(aV===X||aV===G){break inf_leave
}case am:if(aJ.last){aR>>>=aX&7;
aX-=aX&7;
aJ.mode=ar;
break
}while(aX<3){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.last=(aR&1);
aR>>>=1;
aX-=1;
switch((aR&3)){case 0:aJ.mode=k;
break;
case 1:L(aJ);
aJ.mode=ad;
if(aV===G){aR>>>=2;
aX-=2;
break inf_leave
}break;
case 2:aJ.mode=r;
break;
case 3:a1.msg="invalid block type";
aJ.mode=h
}aR>>>=2;
aX-=2;
break;
case k:aR>>>=aX&7;
aX-=aX&7;
while(aX<32){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if((aR&65535)!==((aR>>>16)^65535)){a1.msg="invalid stored block lengths";
aJ.mode=h;
break
}aJ.length=aR&65535;
aR=0;
aX=0;
aJ.mode=aD;
if(aV===G){break inf_leave
}case aD:aJ.mode=at;
case at:aW=aJ.length;
if(aW){if(aW>aH){aW=aH
}if(aW>aI){aW=aI
}if(aW===0){break inf_leave
}W.arraySet(aM,aO,aT,aW,aK);
aH-=aW;
aT+=aW;
aI-=aW;
aK+=aW;
aJ.length-=aW;
break
}aJ.mode=p;
break;
case r:while(aX<14){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.nlen=(aR&31)+257;
aR>>>=5;
aX-=5;
aJ.ndist=(aR&31)+1;
aR>>>=5;
aX-=5;
aJ.ncode=(aR&15)+4;
aR>>>=4;
aX-=4;
if(aJ.nlen>286||aJ.ndist>30){a1.msg="too many length or distance symbols";
aJ.mode=h;
break
}aJ.have=0;
aJ.mode=E;
case E:while(aJ.have<aJ.ncode){while(aX<3){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.lens[aZ[aJ.have++]]=(aR&7);
aR>>>=3;
aX-=3
}while(aJ.have<19){aJ.lens[aZ[aJ.have++]]=0
}aJ.lencode=aJ.lendyn;
aJ.lenbits=7;
aQ={bits:aJ.lenbits};
a6=q(ag,aJ.lens,0,19,aJ.lencode,0,aJ.work,aQ);
aJ.lenbits=aQ.bits;
if(a6){a1.msg="invalid code lengths set";
aJ.mode=h;
break
}aJ.have=0;
aJ.mode=Y;
case Y:while(aJ.have<aJ.nlen+aJ.ndist){for(;
;
){aE=aJ.lencode[aR&((1<<aJ.lenbits)-1)];
a2=aE>>>24;
aN=(aE>>>16)&255;
a3=aE&65535;
if((a2)<=aX){break
}if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if(a3<16){aR>>>=a2;
aX-=a2;
aJ.lens[aJ.have++]=a3
}else{if(a3===16){aU=a2+2;
while(aX<aU){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aR>>>=a2;
aX-=a2;
if(aJ.have===0){a1.msg="invalid bit length repeat";
aJ.mode=h;
break
}a0=aJ.lens[aJ.have-1];
aW=3+(aR&3);
aR>>>=2;
aX-=2
}else{if(a3===17){aU=a2+3;
while(aX<aU){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aR>>>=a2;
aX-=a2;
a0=0;
aW=3+(aR&7);
aR>>>=3;
aX-=3
}else{aU=a2+7;
while(aX<aU){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aR>>>=a2;
aX-=a2;
a0=0;
aW=11+(aR&127);
aR>>>=7;
aX-=7
}}if(aJ.have+aW>aJ.nlen+aJ.ndist){a1.msg="invalid bit length repeat";
aJ.mode=h;
break
}while(aW--){aJ.lens[aJ.have++]=a0
}}}if(aJ.mode===h){break
}if(aJ.lens[256]===0){a1.msg="invalid code -- missing end-of-block";
aJ.mode=h;
break
}aJ.lenbits=9;
aQ={bits:aJ.lenbits};
a6=q(ai,aJ.lens,0,aJ.nlen,aJ.lencode,0,aJ.work,aQ);
aJ.lenbits=aQ.bits;
if(a6){a1.msg="invalid literal/lengths set";
aJ.mode=h;
break
}aJ.distbits=6;
aJ.distcode=aJ.distdyn;
aQ={bits:aJ.distbits};
a6=q(N,aJ.lens,aJ.nlen,aJ.ndist,aJ.distcode,0,aJ.work,aQ);
aJ.distbits=aQ.bits;
if(a6){a1.msg="invalid distances set";
aJ.mode=h;
break
}aJ.mode=ad;
if(aV===G){break inf_leave
}case ad:aJ.mode=f;
case f:if(aH>=6&&aI>=258){a1.next_out=aK;
a1.avail_out=aI;
a1.next_in=aT;
a1.avail_in=aH;
aJ.hold=aR;
aJ.bits=aX;
au(a1,a4);
aK=a1.next_out;
aM=a1.output;
aI=a1.avail_out;
aT=a1.next_in;
aO=a1.input;
aH=a1.avail_in;
aR=aJ.hold;
aX=aJ.bits;
if(aJ.mode===p){aJ.back=-1
}break
}aJ.back=0;
for(;
;
){aE=aJ.lencode[aR&((1<<aJ.lenbits)-1)];
a2=aE>>>24;
aN=(aE>>>16)&255;
a3=aE&65535;
if(a2<=aX){break
}if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if(aN&&(aN&240)===0){aS=a2;
aF=aN;
aP=a3;
for(;
;
){aE=aJ.lencode[aP+((aR&((1<<(aS+aF))-1))>>aS)];
a2=aE>>>24;
aN=(aE>>>16)&255;
a3=aE&65535;
if((aS+a2)<=aX){break
}if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aR>>>=aS;
aX-=aS;
aJ.back+=aS
}aR>>>=a2;
aX-=a2;
aJ.back+=a2;
aJ.length=a3;
if(aN===0){aJ.mode=J;
break
}if(aN&32){aJ.back=-1;
aJ.mode=p;
break
}if(aN&64){a1.msg="invalid literal/length code";
aJ.mode=h;
break
}aJ.extra=aN&15;
aJ.mode=aA;
case aA:if(aJ.extra){aU=aJ.extra;
while(aX<aU){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.length+=aR&((1<<aJ.extra)-1);
aR>>>=aJ.extra;
aX-=aJ.extra;
aJ.back+=aJ.extra
}aJ.was=aJ.length;
aJ.mode=Z;
case Z:for(;
;
){aE=aJ.distcode[aR&((1<<aJ.distbits)-1)];
a2=aE>>>24;
aN=(aE>>>16)&255;
a3=aE&65535;
if((a2)<=aX){break
}if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if((aN&240)===0){aS=a2;
aF=aN;
aP=a3;
for(;
;
){aE=aJ.distcode[aP+((aR&((1<<(aS+aF))-1))>>aS)];
a2=aE>>>24;
aN=(aE>>>16)&255;
a3=aE&65535;
if((aS+a2)<=aX){break
}if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aR>>>=aS;
aX-=aS;
aJ.back+=aS
}aR>>>=a2;
aX-=a2;
aJ.back+=a2;
if(aN&64){a1.msg="invalid distance code";
aJ.mode=h;
break
}aJ.offset=a3;
aJ.extra=(aN)&15;
aJ.mode=ay;
case ay:if(aJ.extra){aU=aJ.extra;
while(aX<aU){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}aJ.offset+=aR&((1<<aJ.extra)-1);
aR>>>=aJ.extra;
aX-=aJ.extra;
aJ.back+=aJ.extra
}if(aJ.offset>aJ.dmax){a1.msg="invalid distance too far back";
aJ.mode=h;
break
}aJ.mode=H;
case H:if(aI===0){break inf_leave
}aW=a4-aI;
if(aJ.offset>aW){aW=aJ.offset-aW;
if(aW>aJ.whave){if(aJ.sane){a1.msg="invalid distance too far back";
aJ.mode=h;
break
}}if(aW>aJ.wnext){aW-=aJ.wnext;
aY=aJ.wsize-aW
}else{aY=aJ.wnext-aW
}if(aW>aJ.length){aW=aJ.length
}aG=aJ.window
}else{aG=aM;
aY=aK-aJ.offset;
aW=aJ.length
}if(aW>aI){aW=aI
}aI-=aW;
aJ.length-=aW;
do{aM[aK++]=aG[aY++]
}while(--aW);
if(aJ.length===0){aJ.mode=f
}break;
case J:if(aI===0){break inf_leave
}aM[aK++]=aJ.length;
aI--;
aJ.mode=f;
break;
case ar:if(aJ.wrap){while(aX<32){if(aH===0){break inf_leave
}aH--;
aR|=aO[aT++]<<aX;
aX+=8
}a4-=aI;
a1.total_out+=a4;
aJ.total+=a4;
if(a4){a1.adler=aJ.check=(aJ.flags?ah(aJ.check,aM,a4,aK-a4):Q(aJ.check,aM,a4,aK-a4))
}a4=aI;
if((aJ.flags?aR:v(aR))!==aJ.check){a1.msg="incorrect data check";
aJ.mode=h;
break
}aR=0;
aX=0
}aJ.mode=aa;
case aa:if(aJ.wrap&&aJ.flags){while(aX<32){if(aH===0){break inf_leave
}aH--;
aR+=aO[aT++]<<aX;
aX+=8
}if(aR!==(aJ.total&4294967295)){a1.msg="incorrect length check";
aJ.mode=h;
break
}aR=0;
aX=0
}aJ.mode=F;
case F:a6=D;
break inf_leave;
case h:a6=B;
break inf_leave;
case aC:return P;
case K:default:return ax
}}a1.next_out=aK;
a1.avail_out=aI;
a1.next_in=aT;
a1.avail_in=aH;
aJ.hold=aR;
aJ.bits=aX;
if(aJ.wsize||(a4!==a1.avail_out&&aJ.mode<h&&(aJ.mode<ar||aV!==s))){if(S(a1,a1.output,a1.next_out,a4-a1.avail_out)){aJ.mode=aC;
return P
}}a5-=a1.avail_in;
a4-=a1.avail_out;
a1.total_in+=a5;
a1.total_out+=a4;
aJ.total+=a4;
if(aJ.wrap&&a4){a1.adler=aJ.check=(aJ.flags?ah(aJ.check,aM,a4,a1.next_out-a4):Q(aJ.check,aM,a4,a1.next_out-a4))
}a1.data_type=aJ.bits+(aJ.last?64:0)+(aJ.mode===p?128:0)+(aJ.mode===ad||aJ.mode===aD?256:0);
if(((a5===0&&a4===0)||aV===s)&&a6===z){a6=m
}return a6
}function an(aE){if(!aE||!aE.state){return ax
}var aF=aE.state;
if(aF.window){aF.window=null
}aE.state=null;
return z
}function l(aE,aF){var aG;
if(!aE||!aE.state){return ax
}aG=aE.state;
if((aG.wrap&2)===0){return ax
}aG.head=aF;
aF.done=false;
return z
}R.inflateReset=az;
R.inflateReset2=C;
R.inflateResetKeep=V;
R.inflateInit=M;
R.inflateInit2=t;
R.inflate=af;
R.inflateEnd=an;
R.inflateGetHeader=l;
R.inflateInfo="pako inflate (from Nodeca project)"
},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(k,g,l){var u=k("../utils/common");
var t=15;
var q=852;
var p=592;
var s=0;
var n=1;
var h=2;
var r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];
var v=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];
var m=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];
var f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];
g.exports=function o(z,ae,M,ab,aa,Y,L,I){var P=I.bits;
var W=0;
var H=0;
var O=0,V=0;
var N=0;
var Z=0;
var F=0;
var A=0;
var D=0;
var U=0;
var T;
var Q;
var af;
var S;
var K;
var C=null;
var J=0;
var y;
var E=new u.Buf16(t+1);
var B=new u.Buf16(t+1);
var w=null;
var ad=0;
var X,G,ac;
for(W=0;
W<=t;
W++){E[W]=0
}for(H=0;
H<ab;
H++){E[ae[M+H]]++
}N=P;
for(V=t;
V>=1;
V--){if(E[V]!==0){break
}}if(N>V){N=V
}if(V===0){aa[Y++]=(1<<24)|(64<<16)|0;
aa[Y++]=(1<<24)|(64<<16)|0;
I.bits=1;
return 0
}for(O=1;
O<V;
O++){if(E[O]!==0){break
}}if(N<O){N=O
}A=1;
for(W=1;
W<=t;
W++){A<<=1;
A-=E[W];
if(A<0){return -1
}}if(A>0&&(z===s||V!==1)){return -1
}B[1]=0;
for(W=1;
W<t;
W++){B[W+1]=B[W]+E[W]
}for(H=0;
H<ab;
H++){if(ae[M+H]!==0){L[B[ae[M+H]]++]=H
}}if(z===s){C=w=L;
y=19
}else{if(z===n){C=r;
J-=257;
w=v;
ad-=257;
y=256
}else{C=m;
w=f;
y=-1
}}U=0;
H=0;
W=O;
K=Y;
Z=N;
F=0;
af=-1;
D=1<<N;
S=D-1;
if((z===n&&D>q)||(z===h&&D>p)){return 1
}var R=0;
for(;
;
){R++;
X=W-F;
if(L[H]<y){G=0;
ac=L[H]
}else{if(L[H]>y){G=w[ad+L[H]];
ac=C[J+L[H]]
}else{G=32+64;
ac=0
}}T=1<<(W-F);
Q=1<<Z;
O=Q;
do{Q-=T;
aa[K+(U>>F)+Q]=(X<<24)|(G<<16)|ac|0
}while(Q!==0);
T=1<<(W-1);
while(U&T){T>>=1
}if(T!==0){U&=T-1;
U+=T
}else{U=0
}H++;
if(--E[W]===0){if(W===V){break
}W=ae[M+L[H]]
}if(W>N&&(U&S)!==af){if(F===0){F=N
}K+=O;
Z=W-F;
A=1<<Z;
while(Z+F<V){A-=E[Z+F];
if(A<=0){break
}Z++;
A<<=1
}D+=1<<Z;
if((z===n&&D>q)||(z===h&&D>p)){return 1
}af=U&S;
aa[af]=(N<<24)|(Z<<16)|(K-Y)|0
}}if(U!==0){aa[K+U]=((W-F)<<24)|(64<<16)|0
}I.bits=N;
return 0
}
},{"../utils/common":1}],10:[function(g,h,f){h.exports={"2":"need dictionary","1":"stream end","0":"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}
},{}],11:[function(g,h,f){function k(){this.input=null;
this.next_in=0;
this.avail_in=0;
this.total_in=0;
this.output=null;
this.next_out=0;
this.avail_out=0;
this.total_out=0;
this.msg="";
this.state=null;
this.data_type=2;
this.adler=0
}h.exports=k
},{}],"/lib/inflate.js":[function(o,k,p){var f=o("./zlib/inflate.js");
var s=o("./utils/common");
var t=o("./utils/strings");
var r=o("./zlib/constants");
var m=o("./zlib/messages");
var n=o("./zlib/zstream");
var h=o("./zlib/gzheader");
var g=Object.prototype.toString;
var q=function(w){this.options=s.assign({chunkSize:16384,windowBits:0,to:""},w||{});
var y=this.options;
if(y.raw&&(y.windowBits>=0)&&(y.windowBits<16)){y.windowBits=-y.windowBits;
if(y.windowBits===0){y.windowBits=-15
}}if((y.windowBits>=0)&&(y.windowBits<16)&&!(w&&w.windowBits)){y.windowBits+=32
}if((y.windowBits>15)&&(y.windowBits<48)){if((y.windowBits&15)===0){y.windowBits|=15
}}this.err=0;
this.msg="";
this.ended=false;
this.chunks=[];
this.strm=new n();
this.strm.avail_out=0;
var v=f.inflateInit2(this.strm,y.windowBits);
if(v!==r.Z_OK){throw new Error(m[v])
}this.header=new h();
f.inflateGetHeader(this.strm,this.header)
};
q.prototype.push=function(B,C){var F=this.strm;
var z=this.options.chunkSize;
var A,y;
var w,D,v;
var E=false;
if(this.ended){return false
}y=(C===~~C)?C:((C===true)?r.Z_FINISH:r.Z_NO_FLUSH);
if(typeof B==="string"){F.input=t.binstring2buf(B)
}else{if(g.call(B)==="[object ArrayBuffer]"){F.input=new Uint8Array(B)
}else{F.input=B
}}F.next_in=0;
F.avail_in=F.input.length;
do{if(F.avail_out===0){F.output=new s.Buf8(z);
F.next_out=0;
F.avail_out=z
}A=f.inflate(F,r.Z_NO_FLUSH);
if(A===r.Z_BUF_ERROR&&E===true){A=r.Z_OK;
E=false
}if(A!==r.Z_STREAM_END&&A!==r.Z_OK){this.onEnd(A);
this.ended=true;
return false
}if(F.next_out){if(F.avail_out===0||A===r.Z_STREAM_END||(F.avail_in===0&&(y===r.Z_FINISH||y===r.Z_SYNC_FLUSH))){if(this.options.to==="string"){w=t.utf8border(F.output,F.next_out);
D=F.next_out-w;
v=t.buf2string(F.output,w);
F.next_out=D;
F.avail_out=z-D;
if(D){s.arraySet(F.output,F.output,w,D,0)
}this.onData(v)
}else{this.onData(s.shrinkBuf(F.output,F.next_out))
}}}if(F.avail_in===0&&F.avail_out===0){E=true
}}while((F.avail_in>0||F.avail_out===0)&&A!==r.Z_STREAM_END);
if(A===r.Z_STREAM_END){y=r.Z_FINISH
}if(y===r.Z_FINISH){A=f.inflateEnd(this.strm);
this.onEnd(A);
this.ended=true;
return A===r.Z_OK
}if(y===r.Z_SYNC_FLUSH){this.onEnd(r.Z_OK);
F.avail_out=0;
return true
}return true
};
q.prototype.onData=function(v){this.chunks.push(v)
};
q.prototype.onEnd=function(v){if(v===r.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")
}else{this.result=s.flattenChunks(this.chunks)
}}this.chunks=[];
this.err=v;
this.msg=this.strm.msg
};
function u(v,w){var y=new q(w);
y.push(v,true);
if(y.err){throw y.msg
}return y.result
}function l(v,w){w=w||{};
w.raw=true;
return u(v,w)
}p.Inflate=q;
p.inflate=u;
p.inflateRaw=l;
p.ungzip=u
},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")
});
!function(c){var b=function(){var q="s",z={DAY:86400000,HOUR:3600000,MINUTE:60000,SECOND:1000,BASELINE_YEAR:2014,MAX_SCORE:864000000,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"Europe/London":["Africa/Casablanca"],"America/Chicago":["America/Mexico_City"],"America/Asuncion":["America/Campo_Grande","America/Santiago"],"America/Montevideo":["America/Sao_Paulo","America/Santiago"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},p=function(m){var l=-m.getTimezoneOffset();
return null!==l?l:0
},a=function(){var l=p(new Date(z.BASELINE_YEAR,0,2)),m=p(new Date(z.BASELINE_YEAR,5,2)),o=l-m;
return 0>o?l+",1":o>0?m+",1,"+q:l+",0"
},g=function(){var m,l;
if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat&&(m=Intl.DateTimeFormat(),"undefined"!=typeof m&&"undefined"!=typeof m.resolvedOptions)){return l=m.resolvedOptions().timeZone,l&&(l.indexOf("/")>-1||"UTC"===l)?l:void 0
}},f=function(D){for(var E=new Date(D,0,1,0,0,1,0).getTime(),G=new Date(D,12,31,23,59,59).getTime(),C=E,l=new Date(C).getTimezoneOffset(),B=null,u=null;
G-86400000>C;
){var F=new Date(C),m=F.getTimezoneOffset();
m!==l&&(l>m&&(B=F),m>l&&(u=F),l=m),C+=86400000
}return B&&u?{s:w(B).getTime(),e:w(u).getTime()}:!1
},w=function k(D,F,C){"undefined"==typeof F&&(F=z.DAY,C=z.HOUR);
for(var l=new Date(D.getTime()-F).getTime(),B=D.getTime()+F,s=new Date(l).getTimezoneOffset(),G=l,H=null;
B-C>G;
){var m=new Date(G),E=m.getTimezoneOffset();
if(E!==s){H=m;
break
}G+=C
}return F===z.DAY?k(H,z.HOUR,z.MINUTE):F===z.HOUR?k(H,z.MINUTE,z.SECOND):H
},y=function(o,l,n,m){if("N/A"!==n){return n
}if("Asia/Beirut"===l){if("Africa/Cairo"===m.name&&1398376800000===o[6].s&&1411678800000===o[6].e){return 0
}if("Asia/Jerusalem"===m.name&&1395964800000===o[6].s&&1411858800000===o[6].e){return 0
}}else{if("America/Santiago"===l){if("America/Asuncion"===m.name&&1412481600000===o[6].s&&1397358000000===o[6].e){return 0
}if("America/Campo_Grande"===m.name&&1413691200000===o[6].s&&1392519600000===o[6].e){return 0
}}else{if("America/Montevideo"===l){if("America/Sao_Paulo"===m.name&&1413687600000===o[6].s&&1392516000000===o[6].e){return 0
}}else{if("Pacific/Auckland"===l&&"Pacific/Fiji"===m.name&&1414245600000===o[6].s&&1396101600000===o[6].e){return 0
}}}}return n
},d=function(H,F){for(var s=function(l){for(var m=0,o=0;
o<H.length;
o++){if(l.rules[o]&&H[o]){if(!(H[o].s>=l.rules[o].s&&H[o].e<=l.rules[o].e)){m="N/A";
break
}if(m=0,m+=Math.abs(H[o].s-l.rules[o].s),m+=Math.abs(l.rules[o].e-H[o].e),m>z.MAX_SCORE){m="N/A";
break
}}}return m=y(H,F,m,l)
},C={},t=b.olson.dst_rules.zones,K=t.length,B=z.AMBIGUITIES[F],J=0;
K>J;
J++){var D=t[J],E=s(t[J]);
"N/A"!==E&&(C[D.name]=E)
}for(var G in C){if(C.hasOwnProperty(G)){for(var I=0;
I<B.length;
I++){if(B[I]===G){return G
}}}}return F
},v=function(t){var m=function(){for(var A=[],r=0;
r<b.olson.dst_rules.years.length;
r++){var n=f(b.olson.dst_rules.years[r]);
A.push(n)
}return A
},l=function(r){for(var n=0;
n<r.length;
n++){if(r[n]!==!1){return !0
}}return !1
},o=m(),u=l(o);
return u?d(o,t):t
},h=function(){var l=g();
return l||(l=b.olson.timezones[a()],"undefined"!=typeof z.AMBIGUITIES[l]&&(l=v(l))),{name:function(){return l
}}
};
return{determine:h}
}();
b.olson=b.olson||{},b.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Asuncion","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},b.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:1219957200000,s:1209074400000},{e:1250802000000,s:1240524000000},{e:1285880400000,s:1284069600000},!1,!1,!1,{e:1411678800000,s:1406844000000}]},{name:"Africa/Casablanca",rules:[{e:1220223600000,s:1212278400000},{e:1250809200000,s:1243814400000},{e:1281222000000,s:1272758400000},{e:1312066800000,s:1301788800000},{e:1348970400000,s:1345428000000},{e:1382839200000,s:1376100000000},{e:1414288800000,s:1406944800000}]},{name:"America/Asuncion",rules:[{e:1205031600000,s:1224388800000},{e:1236481200000,s:1255838400000},{e:1270954800000,s:1286078400000},{e:1302404400000,s:1317528000000},{e:1333854000000,s:1349582400000},{e:1364094000000,s:1381032000000},{e:1395543600000,s:1412481600000}]},{name:"America/Campo_Grande",rules:[{e:1203217200000,s:1224388800000},{e:1234666800000,s:1255838400000},{e:1266721200000,s:1287288000000},{e:1298170800000,s:1318737600000},{e:1330225200000,s:1350792000000},{e:1361070000000,s:1382241600000},{e:1392519600000,s:1413691200000}]},{name:"America/Goose_Bay",rules:[{e:1225594860000,s:1205035260000},{e:1257044460000,s:1236484860000},{e:1289098860000,s:1268539260000},{e:1320555600000,s:1299988860000},{e:1352005200000,s:1331445600000},{e:1383454800000,s:1362895200000},{e:1414904400000,s:1394344800000}]},{name:"America/Havana",rules:[{e:1224997200000,s:1205643600000},{e:1256446800000,s:1236488400000},{e:1288501200000,s:1268542800000},{e:1321160400000,s:1300597200000},{e:1352005200000,s:1333256400000},{e:1383454800000,s:1362891600000},{e:1414904400000,s:1394341200000}]},{name:"America/Mazatlan",rules:[{e:1225008000000,s:1207472400000},{e:1256457600000,s:1238922000000},{e:1288512000000,s:1270371600000},{e:1319961600000,s:1301821200000},{e:1351411200000,s:1333270800000},{e:1382860800000,s:1365325200000},{e:1414310400000,s:1396774800000}]},{name:"America/Mexico_City",rules:[{e:1225004400000,s:1207468800000},{e:1256454000000,s:1238918400000},{e:1288508400000,s:1270368000000},{e:1319958000000,s:1301817600000},{e:1351407600000,s:1333267200000},{e:1382857200000,s:1365321600000},{e:1414306800000,s:1396771200000}]},{name:"America/Miquelon",rules:[{e:1225598400000,s:1205038800000},{e:1257048000000,s:1236488400000},{e:1289102400000,s:1268542800000},{e:1320552000000,s:1299992400000},{e:1352001600000,s:1331442000000},{e:1383451200000,s:1362891600000},{e:1414900800000,s:1394341200000}]},{name:"America/Santa_Isabel",rules:[{e:1225011600000,s:1207476000000},{e:1256461200000,s:1238925600000},{e:1288515600000,s:1270375200000},{e:1319965200000,s:1301824800000},{e:1351414800000,s:1333274400000},{e:1382864400000,s:1365328800000},{e:1414314000000,s:1396778400000}]},{name:"America/Santiago",rules:[{e:1206846000000,s:1223784000000},{e:1237086000000,s:1255233600000},{e:1270350000000,s:1286683200000},{e:1304823600000,s:1313899200000},{e:1335668400000,s:1346558400000},{e:1367118000000,s:1378612800000},{e:1398567600000,s:1410062400000}]},{name:"America/Sao_Paulo",rules:[{e:1203213600000,s:1224385200000},{e:1234663200000,s:1255834800000},{e:1266717600000,s:1287284400000},{e:1298167200000,s:1318734000000},{e:1330221600000,s:1350788400000},{e:1361066400000,s:1382238000000},{e:1392516000000,s:1413687600000}]},{name:"Asia/Amman",rules:[{e:1225404000000,s:1206655200000},{e:1256853600000,s:1238104800000},{e:1288303200000,s:1269554400000},{e:1319752800000,s:1301608800000},!1,!1,{e:1414706400000,s:1395957600000}]},{name:"Asia/Damascus",rules:[{e:1225486800000,s:1207260000000},{e:1256850000000,s:1238104800000},{e:1288299600000,s:1270159200000},{e:1319749200000,s:1301608800000},{e:1351198800000,s:1333058400000},{e:1382648400000,s:1364508000000},{e:1414702800000,s:1395957600000}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:1219957200000,s:1206655200000},{e:1252015200000,s:1238104800000},{e:1281474000000,s:1269640860000},{e:1312146000000,s:1301608860000},{e:1348178400000,s:1333058400000},{e:1380229200000,s:1364508000000},{e:1414098000000,s:1395957600000}]},{name:"Asia/Irkutsk",rules:[{e:1224957600000,s:1206813600000},{e:1256407200000,s:1238263200000},{e:1288461600000,s:1269712800000},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:1223161200000,s:1206662400000},{e:1254006000000,s:1238112000000},{e:1284246000000,s:1269561600000},{e:1317510000000,s:1301616000000},{e:1348354800000,s:1333065600000},{e:1382828400000,s:1364515200000},{e:1414278000000,s:1395964800000}]},{name:"Asia/Kamchatka",rules:[{e:1224943200000,s:1206799200000},{e:1256392800000,s:1238248800000},{e:1288450800000,s:1269698400000},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:1224961200000,s:1206817200000},{e:1256410800000,s:1238266800000},{e:1288465200000,s:1269716400000},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:1224964800000,s:1206820800000},{e:1256414400000,s:1238270400000},{e:1288468800000,s:1269720000000},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:1224950400000,s:1206806400000},{e:1256400000000,s:1238256000000},{e:1288454400000,s:1269705600000},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954000000,s:1206810000000},{e:1256403600000,s:1238259600000},{e:1288458000000,s:1269709200000},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:1224968400000,s:1206824400000},{e:1256418000000,s:1238274000000},{e:1288472400000,s:1269723600000},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972000000,s:1206828000000},{e:1256421600000,s:1238277600000},{e:1288476000000,s:1269727200000},{e:1319925600000,s:1301176800000},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:1207407600000,s:1223134200000},{e:1238857200000,s:1254583800000},{e:1270306800000,s:1286033400000},{e:1301756400000,s:1317483000000},{e:1333206000000,s:1349537400000},{e:1365260400000,s:1380987000000},{e:1396710000000,s:1412436600000}]},{name:"Australia/Perth",rules:[{e:1206813600000,s:1224957600000},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:1224982800000,s:1206838800000},{e:1256432400000,s:1238288400000},{e:1288486800000,s:1269738000000},{e:1319936400000,s:1301187600000},{e:1351386000000,s:1332637200000},{e:1382835600000,s:1364691600000},{e:1414285200000,s:1396141200000}]},{name:"Europe/Minsk",rules:[{e:1224979200000,s:1206835200000},{e:1256428800000,s:1238284800000},{e:1288483200000,s:1269734400000},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:1224975600000,s:1206831600000},{e:1256425200000,s:1238281200000},{e:1288479600000,s:1269730800000},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:1301752800000,s:1316872800000},{e:1333202400000,s:1348927200000},{e:1365256800000,s:1380376800000},{e:1396706400000,s:1411826400000}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:1269698400000,s:1287842400000},{e:1327154400000,s:1319292000000},{e:1358604000000,s:1350741600000},{e:1390050000000,s:1382796000000},{e:1421503200000,s:1414850400000}]},{name:"Europe/London",rules:[{e:1224982800000,s:1206838800000},{e:1256432400000,s:1238288400000},{e:1288486800000,s:1269738000000},{e:1319936400000,s:1301187600000},{e:1351386000000,s:1332637200000},{e:1382835600000,s:1364691600000},{e:1414285200000,s:1396141200000}]}]},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=b:"undefined"!=typeof define&&null!==define&&null!=define.amd?define([],function(){return b
}):"undefined"==typeof c?window.jstz=b:c.jstz=b
}();
function InfoBubble(b){this.extend(InfoBubble,google.maps.OverlayView);
this.tabs_=[];
this.activeTab_=null;
this.baseZIndex_=100;
this.isOpen_=false;
var a=b||{};
if(a.backgroundColor==undefined){a.backgroundColor=this.BACKGROUND_COLOR_
}if(a.borderColor==undefined){a.borderColor=this.BORDER_COLOR_
}if(a.borderRadius==undefined){a.borderRadius=this.BORDER_RADIUS_
}if(a.borderWidth==undefined){a.borderWidth=this.BORDER_WIDTH_
}if(a.padding==undefined){a.padding=this.PADDING_
}if(a.arrowPosition==undefined){a.arrowPosition=this.ARROW_POSITION_
}if(a.disableAutoPan==undefined){a.disableAutoPan=false
}if(a.disableAnimation==undefined){a.disableAnimation=false
}if(a.minWidth==undefined){a.minWidth=this.MIN_WIDTH_
}if(a.shadowStyle==undefined){a.shadowStyle=this.SHADOW_STYLE_
}if(a.arrowSize==undefined){a.arrowSize=this.ARROW_SIZE_
}if(a.arrowStyle==undefined){a.arrowStyle=this.ARROW_STYLE_
}if(a.closeSrc==undefined){a.closeSrc=this.CLOSE_SRC_
}this.buildDom_();
this.setValues(a)
}window.InfoBubble=InfoBubble;
InfoBubble.prototype.ARROW_SIZE_=15;
InfoBubble.prototype.ARROW_STYLE_=0;
InfoBubble.prototype.SHADOW_STYLE_=1;
InfoBubble.prototype.MIN_WIDTH_=50;
InfoBubble.prototype.ARROW_POSITION_=50;
InfoBubble.prototype.PADDING_=10;
InfoBubble.prototype.BORDER_WIDTH_=1;
InfoBubble.prototype.BORDER_COLOR_="#ccc";
InfoBubble.prototype.BORDER_RADIUS_=10;
InfoBubble.prototype.BACKGROUND_COLOR_="#fff";
InfoBubble.prototype.CLOSE_SRC_="https://maps.gstatic.com/intl/en_us/mapfiles/iw_close.gif";
InfoBubble.prototype.extend=function(b,a){return(function(c){for(var d in c.prototype){this.prototype[d]=c.prototype[d]
}return this
}).apply(b,[a])
};
InfoBubble.prototype.buildDom_=function(){var n=this.bubble_=document.createElement("DIV");
n.style.position="absolute";
n.style.zIndex=this.baseZIndex_;
var b=this.tabsContainer_=document.createElement("DIV");
b.style.position="relative";
var p=this.close_=document.createElement("IMG");
p.style.position="absolute";
p.style.border=0;
p.style.zIndex=this.baseZIndex_+1;
p.style.cursor="pointer";
p.src=this.get("closeSrc");
var k=this;
google.maps.event.addDomListener(p,"click",function(){k.close();
google.maps.event.trigger(k,"closeclick")
});
var m=this.contentContainer_=document.createElement("DIV");
m.style.overflowX="auto";
m.style.overflowY="auto";
m.style.cursor="default";
m.style.clear="both";
m.style.position="relative";
var l=this.content_=document.createElement("DIV");
m.appendChild(l);
var o=this.arrow_=document.createElement("DIV");
o.style.position="relative";
var c=this.arrowOuter_=document.createElement("DIV");
var d=this.arrowInner_=document.createElement("DIV");
var g=this.getArrowSize_();
c.style.position=d.style.position="absolute";
c.style.left=d.style.left="50%";
c.style.height=d.style.height="0";
c.style.width=d.style.width="0";
c.style.marginLeft=this.px(-g);
c.style.borderWidth=this.px(g);
c.style.borderBottomWidth=0;
var f=this.bubbleShadow_=document.createElement("DIV");
f.style.position="absolute";
n.style.display=f.style.display="none";
n.appendChild(this.tabsContainer_);
n.appendChild(p);
n.appendChild(m);
o.appendChild(c);
o.appendChild(d);
n.appendChild(o);
var a=document.createElement("style");
a.setAttribute("type","text/css");
this.animationName_="_ibani_"+Math.round(Math.random()*10000);
var h="."+this.animationName_+"{-webkit-animation-name:"+this.animationName_+";-webkit-animation-duration:0.5s;-webkit-animation-iteration-count:1;}@-webkit-keyframes "+this.animationName_+" {from {-webkit-transform: scale(0)}50% {-webkit-transform: scale(1.2)}90% {-webkit-transform: scale(0.95)}to {-webkit-transform: scale(1)}}";
a.textContent=h;
document.getElementsByTagName("head")[0].appendChild(a)
};
InfoBubble.prototype.setBackgroundClassName=function(a){this.set("backgroundClassName",a)
};
InfoBubble.prototype.setBackgroundClassName=InfoBubble.prototype.setBackgroundClassName;
InfoBubble.prototype.backgroundClassName_changed=function(){this.content_.className=this.get("backgroundClassName")
};
InfoBubble.prototype.backgroundClassName_changed=InfoBubble.prototype.backgroundClassName_changed;
InfoBubble.prototype.setTabClassName=function(a){this.set("tabClassName",a)
};
InfoBubble.prototype.setTabClassName=InfoBubble.prototype.setTabClassName;
InfoBubble.prototype.tabClassName_changed=function(){this.updateTabStyles_()
};
InfoBubble.prototype.tabClassName_changed=InfoBubble.prototype.tabClassName_changed;
InfoBubble.prototype.getArrowStyle_=function(){return parseInt(this.get("arrowStyle"),10)||0
};
InfoBubble.prototype.setArrowStyle=function(a){this.set("arrowStyle",a)
};
InfoBubble.prototype.setArrowStyle=InfoBubble.prototype.setArrowStyle;
InfoBubble.prototype.arrowStyle_changed=function(){this.arrowSize_changed()
};
InfoBubble.prototype.arrowStyle_changed=InfoBubble.prototype.arrowStyle_changed;
InfoBubble.prototype.getArrowSize_=function(){return parseInt(this.get("arrowSize"),10)||0
};
InfoBubble.prototype.setArrowSize=function(a){this.set("arrowSize",a)
};
InfoBubble.prototype.setArrowSize=InfoBubble.prototype.setArrowSize;
InfoBubble.prototype.arrowSize_changed=function(){this.borderWidth_changed()
};
InfoBubble.prototype.arrowSize_changed=InfoBubble.prototype.arrowSize_changed;
InfoBubble.prototype.setArrowPosition=function(a){this.set("arrowPosition",a)
};
InfoBubble.prototype.setArrowPosition=InfoBubble.prototype.setArrowPosition;
InfoBubble.prototype.getArrowPosition_=function(){return parseInt(this.get("arrowPosition"),10)||0
};
InfoBubble.prototype.arrowPosition_changed=function(){var a=this.getArrowPosition_();
this.arrowOuter_.style.left=this.arrowInner_.style.left=a+"%";
this.redraw_()
};
InfoBubble.prototype.arrowPosition_changed=InfoBubble.prototype.arrowPosition_changed;
InfoBubble.prototype.setZIndex=function(a){this.set("zIndex",a)
};
InfoBubble.prototype.setZIndex=InfoBubble.prototype.setZIndex;
InfoBubble.prototype.getZIndex=function(){return parseInt(this.get("zIndex"),10)||this.baseZIndex_
};
InfoBubble.prototype.zIndex_changed=function(){var a=this.getZIndex();
this.bubble_.style.zIndex=this.baseZIndex_=a;
this.close_.style.zIndex=a+1
};
InfoBubble.prototype.zIndex_changed=InfoBubble.prototype.zIndex_changed;
InfoBubble.prototype.setShadowStyle=function(a){this.set("shadowStyle",a)
};
InfoBubble.prototype.setShadowStyle=InfoBubble.prototype.setShadowStyle;
InfoBubble.prototype.getShadowStyle_=function(){return parseInt(this.get("shadowStyle"),10)||0
};
InfoBubble.prototype.shadowStyle_changed=function(){var a=this.getShadowStyle_();
var c="";
var d="";
var b="";
switch(a){case 0:c="none";
break;
case 1:d="40px 15px 10px rgba(33,33,33,0.3)";
b="transparent";
break;
case 2:d="0 0 2px rgba(33,33,33,0.3)";
b="rgba(33,33,33,0.35)";
break
}this.bubbleShadow_.style.boxShadow=this.bubbleShadow_.style.webkitBoxShadow=this.bubbleShadow_.style.MozBoxShadow=d;
this.bubbleShadow_.style.backgroundColor=b;
if(this.isOpen_){this.bubbleShadow_.style.display=c;
this.draw()
}};
InfoBubble.prototype.shadowStyle_changed=InfoBubble.prototype.shadowStyle_changed;
InfoBubble.prototype.showCloseButton=function(){this.set("hideCloseButton",false)
};
InfoBubble.prototype.showCloseButton=InfoBubble.prototype.showCloseButton;
InfoBubble.prototype.hideCloseButton=function(){this.set("hideCloseButton",true)
};
InfoBubble.prototype.hideCloseButton=InfoBubble.prototype.hideCloseButton;
InfoBubble.prototype.hideCloseButton_changed=function(){this.close_.style.display=this.get("hideCloseButton")?"none":""
};
InfoBubble.prototype.hideCloseButton_changed=InfoBubble.prototype.hideCloseButton_changed;
InfoBubble.prototype.setBackgroundColor=function(a){if(a){this.set("backgroundColor",a)
}};
InfoBubble.prototype.setBackgroundColor=InfoBubble.prototype.setBackgroundColor;
InfoBubble.prototype.backgroundColor_changed=function(){var a=this.get("backgroundColor");
this.contentContainer_.style.backgroundColor=a;
this.arrowInner_.style.borderColor=a+" transparent transparent";
this.updateTabStyles_()
};
InfoBubble.prototype.backgroundColor_changed=InfoBubble.prototype.backgroundColor_changed;
InfoBubble.prototype.setBorderColor=function(a){if(a){this.set("borderColor",a)
}};
InfoBubble.prototype.setBorderColor=InfoBubble.prototype.setBorderColor;
InfoBubble.prototype.borderColor_changed=function(){var c=this.get("borderColor");
var b=this.contentContainer_;
var a=this.arrowOuter_;
b.style.borderColor=c;
a.style.borderColor=c+" transparent transparent";
b.style.borderStyle=a.style.borderStyle=this.arrowInner_.style.borderStyle="solid";
this.updateTabStyles_()
};
InfoBubble.prototype.borderColor_changed=InfoBubble.prototype.borderColor_changed;
InfoBubble.prototype.setBorderRadius=function(a){this.set("borderRadius",a)
};
InfoBubble.prototype.setBorderRadius=InfoBubble.prototype.setBorderRadius;
InfoBubble.prototype.getBorderRadius_=function(){return parseInt(this.get("borderRadius"),10)||0
};
InfoBubble.prototype.borderRadius_changed=function(){var b=this.getBorderRadius_();
var a=this.getBorderWidth_();
this.contentContainer_.style.borderRadius=this.contentContainer_.style.MozBorderRadius=this.contentContainer_.style.webkitBorderRadius=this.bubbleShadow_.style.borderRadius=this.bubbleShadow_.style.MozBorderRadius=this.bubbleShadow_.style.webkitBorderRadius=this.px(b);
this.tabsContainer_.style.paddingLeft=this.tabsContainer_.style.paddingRight=this.px(b+a);
this.redraw_()
};
InfoBubble.prototype.borderRadius_changed=InfoBubble.prototype.borderRadius_changed;
InfoBubble.prototype.getBorderWidth_=function(){return parseInt(this.get("borderWidth"),10)||0
};
InfoBubble.prototype.setBorderWidth=function(a){this.set("borderWidth",a)
};
InfoBubble.prototype.setBorderWidth=InfoBubble.prototype.setBorderWidth;
InfoBubble.prototype.borderWidth_changed=function(){var a=this.getBorderWidth_();
this.contentContainer_.style.borderWidth=this.px(a);
this.tabsContainer_.style.top=this.px(a);
this.updateArrowStyle_();
this.updateTabStyles_();
this.borderRadius_changed();
this.redraw_()
};
InfoBubble.prototype.borderWidth_changed=InfoBubble.prototype.borderWidth_changed;
InfoBubble.prototype.updateArrowStyle_=function(){var c=this.getBorderWidth_();
var f=this.getArrowSize_();
var b=this.getArrowStyle_();
var g=this.px(f);
var h=this.px(Math.max(0,f-c));
var d=this.arrowOuter_;
var a=this.arrowInner_;
this.arrow_.style.marginTop=this.px(-c);
d.style.borderTopWidth=g;
a.style.borderTopWidth=h;
if(b==0||b==1){d.style.borderLeftWidth=g;
a.style.borderLeftWidth=h
}else{d.style.borderLeftWidth=a.style.borderLeftWidth=0
}if(b==0||b==2){d.style.borderRightWidth=g;
a.style.borderRightWidth=h
}else{d.style.borderRightWidth=a.style.borderRightWidth=0
}if(b<2){d.style.marginLeft=this.px(-(f));
a.style.marginLeft=this.px(-(f-c))
}else{d.style.marginLeft=a.style.marginLeft=0
}if(c==0){d.style.display="none"
}else{d.style.display=""
}};
InfoBubble.prototype.setPadding=function(a){this.set("padding",a)
};
InfoBubble.prototype.setPadding=InfoBubble.prototype.setPadding;
InfoBubble.prototype.setCloseSrc=function(a){if(a&&this.close_){this.close_.src=a
}};
InfoBubble.prototype.setCloseSrc=InfoBubble.prototype.setCloseSrc;
InfoBubble.prototype.getPadding_=function(){return parseInt(this.get("padding"),10)||0
};
InfoBubble.prototype.padding_changed=function(){var a=this.getPadding_();
this.contentContainer_.style.padding=this.px(a);
this.updateTabStyles_();
this.redraw_()
};
InfoBubble.prototype.padding_changed=InfoBubble.prototype.padding_changed;
InfoBubble.prototype.px=function(a){if(a){return a+"px"
}return a
};
InfoBubble.prototype.addEvents_=function(){var c=["mousedown","mousemove","mouseover","mouseout","mouseup","mousewheel","DOMMouseScroll","touchstart","touchend","touchmove","dblclick","contextmenu","click"];
var a=this.bubble_;
this.listeners_=[];
for(var b=0,d;
d=c[b];
b++){this.listeners_.push(google.maps.event.addDomListener(a,d,function(f){f.cancelBubble=true;
if(f.stopPropagation){f.stopPropagation()
}}))
}};
InfoBubble.prototype.onAdd=function(){if(!this.bubble_){this.buildDom_()
}this.addEvents_();
var a=this.getPanes();
if(a){a.floatPane.appendChild(this.bubble_);
a.floatShadow.appendChild(this.bubbleShadow_)
}google.maps.event.trigger(this,"domready")
};
InfoBubble.prototype.onAdd=InfoBubble.prototype.onAdd;
InfoBubble.prototype.draw=function(){var h=this.getProjection();
if(!h){return
}var b=(this.get("position"));
if(!b){this.close();
return
}var o=0;
if(this.activeTab_){o=this.activeTab_.offsetHeight
}var m=this.getAnchorHeight_();
var g=this.getArrowSize_();
var f=this.getArrowPosition_();
f=f/100;
var l=h.fromLatLngToDivPixel(b);
var a=this.contentContainer_.offsetWidth;
var n=this.bubble_.offsetHeight;
if(!a){return
}var k=l.y-(n+g);
if(m){k-=m
}var c=l.x-(a*f);
this.bubble_.style.top=this.px(k);
this.bubble_.style.left=this.px(c);
var d=parseInt(this.get("shadowStyle"),10);
switch(d){case 1:this.bubbleShadow_.style.top=this.px(k+o-1);
this.bubbleShadow_.style.left=this.px(c);
this.bubbleShadow_.style.width=this.px(a);
this.bubbleShadow_.style.height=this.px(this.contentContainer_.offsetHeight-g);
break;
case 2:a=a*0.8;
if(m){this.bubbleShadow_.style.top=this.px(l.y)
}else{this.bubbleShadow_.style.top=this.px(l.y+g)
}this.bubbleShadow_.style.left=this.px(l.x-a*f);
this.bubbleShadow_.style.width=this.px(a);
this.bubbleShadow_.style.height=this.px(2);
break
}};
InfoBubble.prototype.draw=InfoBubble.prototype.draw;
InfoBubble.prototype.onRemove=function(){if(this.bubble_&&this.bubble_.parentNode){this.bubble_.parentNode.removeChild(this.bubble_)
}if(this.bubbleShadow_&&this.bubbleShadow_.parentNode){this.bubbleShadow_.parentNode.removeChild(this.bubbleShadow_)
}for(var a=0,b;
b=this.listeners_[a];
a++){google.maps.event.removeListener(b)
}};
InfoBubble.prototype.onRemove=InfoBubble.prototype.onRemove;
InfoBubble.prototype.isOpen=function(){return this.isOpen_
};
InfoBubble.prototype.isOpen=InfoBubble.prototype.isOpen;
InfoBubble.prototype.close=function(){if(this.bubble_){this.bubble_.style.display="none";
this.bubble_.className=this.bubble_.className.replace(this.animationName_,"")
}if(this.bubbleShadow_){this.bubbleShadow_.style.display="none";
this.bubbleShadow_.className=this.bubbleShadow_.className.replace(this.animationName_,"")
}this.isOpen_=false
};
InfoBubble.prototype.close=InfoBubble.prototype.close;
InfoBubble.prototype.open=function(c,a){var b=this;
window.setTimeout(function(){b.open_(c,a)
},0)
};
InfoBubble.prototype.open_=function(d,a){this.updateContent_();
if(d){this.setMap(d)
}if(a){this.set("anchor",a);
this.bindTo("anchorPoint",a);
this.bindTo("position",a)
}this.bubble_.style.display=this.bubbleShadow_.style.display="";
var c=!this.get("disableAnimation");
if(c){this.bubble_.className+=" "+this.animationName_;
this.bubbleShadow_.className+=" "+this.animationName_
}this.redraw_();
this.isOpen_=true;
var f=!this.get("disableAutoPan");
if(f){var b=this;
window.setTimeout(function(){b.panToView()
},200)
}};
InfoBubble.prototype.open=InfoBubble.prototype.open;
InfoBubble.prototype.setPosition=function(a){if(a){this.set("position",a)
}};
InfoBubble.prototype.setPosition=InfoBubble.prototype.setPosition;
InfoBubble.prototype.getPosition=function(){return(this.get("position"))
};
InfoBubble.prototype.getPosition=InfoBubble.prototype.getPosition;
InfoBubble.prototype.position_changed=function(){this.draw()
};
InfoBubble.prototype.position_changed=InfoBubble.prototype.position_changed;
InfoBubble.prototype.panToView=function(){var h=this.getProjection();
if(!h){return
}if(!this.bubble_){return
}var m=this.getAnchorHeight_();
var o=this.bubble_.offsetHeight+m;
var a=this.get("map");
var n=a.getDiv();
var k=n.offsetHeight;
var d=this.getPosition();
var c=h.fromLatLngToContainerPixel(a.getCenter());
var l=h.fromLatLngToContainerPixel(d);
var g=c.y-o;
var p=k-c.y;
var b=g<0;
var f=0;
if(b){g*=-1;
f=(g+p)/2
}l.y-=f;
d=h.fromContainerPixelToLatLng(l);
if(a.getCenter()!=d){a.panTo(d)
}};
InfoBubble.prototype.panToView=InfoBubble.prototype.panToView;
InfoBubble.prototype.htmlToDocumentFragment_=function(c){c=c.replace(/^\s*([\S\s]*)\b\s*$/,"$1");
var b=document.createElement("DIV");
b.innerHTML=c;
if(b.childNodes.length==1){return(b.removeChild(b.firstChild))
}else{var a=document.createDocumentFragment();
while(b.firstChild){a.appendChild(b.firstChild)
}return a
}};
InfoBubble.prototype.removeChildren_=function(a){if(!a){return
}var b;
while(b=a.firstChild){a.removeChild(b)
}};
InfoBubble.prototype.setContent=function(a){this.set("content",a)
};
InfoBubble.prototype.setContent=InfoBubble.prototype.setContent;
InfoBubble.prototype.getContent=function(){return(this.get("content"))
};
InfoBubble.prototype.getContent=InfoBubble.prototype.getContent;
InfoBubble.prototype.updateContent_=function(){if(!this.content_){return
}this.removeChildren_(this.content_);
var d=this.getContent();
if(d){if(typeof d=="string"){d=this.htmlToDocumentFragment_(d)
}this.content_.appendChild(d);
var c=this;
var a=this.content_.getElementsByTagName("IMG");
for(var b=0,f;
f=a[b];
b++){google.maps.event.addDomListener(f,"load",function(){c.imageLoaded_()
})
}}this.redraw_()
};
InfoBubble.prototype.imageLoaded_=function(){var a=!this.get("disableAutoPan");
this.redraw_();
if(a&&(this.tabs_.length==0||this.activeTab_.index==0)){this.panToView()
}};
InfoBubble.prototype.updateTabStyles_=function(){if(this.tabs_&&this.tabs_.length){for(var b=0,c;
c=this.tabs_[b];
b++){this.setTabStyle_(c.tab)
}this.activeTab_.style.zIndex=this.baseZIndex_;
var a=this.getBorderWidth_();
var d=this.getPadding_()/2;
this.activeTab_.style.borderBottomWidth=0;
this.activeTab_.style.paddingBottom=this.px(d+a)
}};
InfoBubble.prototype.setTabStyle_=function(d){var n=this.get("backgroundColor");
var g=this.get("borderColor");
var f=this.getBorderRadius_();
var a=this.getBorderWidth_();
var m=this.getPadding_();
var h=this.px(-(Math.max(m,f)));
var c=this.px(f);
var k=this.baseZIndex_;
if(d.index){k-=d.index
}var o={cssFloat:"left",position:"relative",cursor:"pointer",backgroundColor:n,border:this.px(a)+" solid "+g,padding:this.px(m/2)+" "+this.px(m),marginRight:h,whiteSpace:"nowrap",borderRadiusTopLeft:c,MozBorderRadiusTopleft:c,webkitBorderTopLeftRadius:c,borderRadiusTopRight:c,MozBorderRadiusTopright:c,webkitBorderTopRightRadius:c,zIndex:k,display:"inline"};
for(var b in o){d.style[b]=o[b]
}var l=this.get("tabClassName");
if(l!=undefined){d.className+=" "+l
}};
InfoBubble.prototype.addTabActions_=function(a){var b=this;
a.listener_=google.maps.event.addDomListener(a,"click",function(){b.setTabActive_(this)
})
};
InfoBubble.prototype.setTabActive=function(a){var b=this.tabs_[a-1];
if(b){this.setTabActive_(b.tab)
}};
InfoBubble.prototype.setTabActive=InfoBubble.prototype.setTabActive;
InfoBubble.prototype.setTabActive_=function(c){if(!c){this.setContent("");
this.updateContent_();
return
}var d=this.getPadding_()/2;
var b=this.getBorderWidth_();
if(this.activeTab_){var a=this.activeTab_;
a.style.zIndex=this.baseZIndex_-a.index;
a.style.paddingBottom=this.px(d);
a.style.borderBottomWidth=this.px(b)
}c.style.zIndex=this.baseZIndex_;
c.style.borderBottomWidth=0;
c.style.marginBottomWidth="-10px";
c.style.paddingBottom=this.px(d+b);
this.setContent(this.tabs_[c.index].content);
this.updateContent_();
this.activeTab_=c;
this.redraw_()
};
InfoBubble.prototype.setMaxWidth=function(a){this.set("maxWidth",a)
};
InfoBubble.prototype.setMaxWidth=InfoBubble.prototype.setMaxWidth;
InfoBubble.prototype.maxWidth_changed=function(){this.redraw_()
};
InfoBubble.prototype.maxWidth_changed=InfoBubble.prototype.maxWidth_changed;
InfoBubble.prototype.setMaxHeight=function(a){this.set("maxHeight",a)
};
InfoBubble.prototype.setMaxHeight=InfoBubble.prototype.setMaxHeight;
InfoBubble.prototype.maxHeight_changed=function(){this.redraw_()
};
InfoBubble.prototype.maxHeight_changed=InfoBubble.prototype.maxHeight_changed;
InfoBubble.prototype.setMinWidth=function(a){this.set("minWidth",a)
};
InfoBubble.prototype.setMinWidth=InfoBubble.prototype.setMinWidth;
InfoBubble.prototype.minWidth_changed=function(){this.redraw_()
};
InfoBubble.prototype.minWidth_changed=InfoBubble.prototype.minWidth_changed;
InfoBubble.prototype.setMinHeight=function(a){this.set("minHeight",a)
};
InfoBubble.prototype.setMinHeight=InfoBubble.prototype.setMinHeight;
InfoBubble.prototype.minHeight_changed=function(){this.redraw_()
};
InfoBubble.prototype.minHeight_changed=InfoBubble.prototype.minHeight_changed;
InfoBubble.prototype.addTab=function(a,c){var b=document.createElement("DIV");
b.innerHTML=a;
this.setTabStyle_(b);
this.addTabActions_(b);
this.tabsContainer_.appendChild(b);
this.tabs_.push({label:a,content:c,tab:b});
b.index=this.tabs_.length-1;
b.style.zIndex=this.baseZIndex_-b.index;
if(!this.activeTab_){this.setTabActive_(b)
}b.className=b.className+" "+this.animationName_;
this.redraw_()
};
InfoBubble.prototype.addTab=InfoBubble.prototype.addTab;
InfoBubble.prototype.updateTab=function(a,c,d){if(!this.tabs_.length||a<0||a>=this.tabs_.length){return
}var b=this.tabs_[a];
if(c!=undefined){b.tab.innerHTML=b.label=c
}if(d!=undefined){b.content=d
}if(this.activeTab_==b.tab){this.setContent(b.content);
this.updateContent_()
}this.redraw_()
};
InfoBubble.prototype.updateTab=InfoBubble.prototype.updateTab;
InfoBubble.prototype.removeTab=function(a){if(!this.tabs_.length||a<0||a>=this.tabs_.length){return
}var d=this.tabs_[a];
d.tab.parentNode.removeChild(d.tab);
google.maps.event.removeListener(d.tab.listener_);
this.tabs_.splice(a,1);
delete d;
for(var c=0,b;
b=this.tabs_[c];
c++){b.tab.index=c
}if(d.tab==this.activeTab_){if(this.tabs_[a]){this.activeTab_=this.tabs_[a].tab
}else{if(this.tabs_[a-1]){this.activeTab_=this.tabs_[a-1].tab
}else{this.activeTab_=undefined
}}this.setTabActive_(this.activeTab_)
}this.redraw_()
};
InfoBubble.prototype.removeTab=InfoBubble.prototype.removeTab;
InfoBubble.prototype.getElementSize_=function(b,f,c){var d=document.createElement("DIV");
d.style.display="inline";
d.style.position="absolute";
d.style.visibility="hidden";
if(typeof b=="string"){d.innerHTML=b
}else{d.appendChild(b.cloneNode(true))
}document.body.appendChild(d);
var a=new google.maps.Size(d.offsetWidth,d.offsetHeight);
if(f&&a.width>f){d.style.width=this.px(f);
a=new google.maps.Size(d.offsetWidth,d.offsetHeight)
}if(c&&a.height>c){d.style.height=this.px(c);
a=new google.maps.Size(d.offsetWidth,d.offsetHeight)
}document.body.removeChild(d);
delete d;
return a
};
InfoBubble.prototype.redraw_=function(){this.figureOutSize_();
this.positionCloseButton_();
this.draw()
};
InfoBubble.prototype.figureOutSize_=function(){var v=this.get("map");
if(!v){return
}var g=this.getPadding_();
var w=this.getBorderWidth_();
var b=this.getBorderRadius_();
var l=this.getArrowSize_();
var r=v.getDiv();
var c=l*2;
var t=r.offsetWidth-c;
var o=r.offsetHeight-c-this.getAnchorHeight_();
var f=0;
var p=(this.get("minWidth")||0);
var k=(this.get("minHeight")||0);
var u=(this.get("maxWidth")||0);
var n=(this.get("maxHeight")||0);
u=Math.min(t,u);
n=Math.min(o,n);
var h=0;
if(this.tabs_.length){for(var s=0,a;
a=this.tabs_[s];
s++){var m=this.getElementSize_(a.tab,u,n);
var d=this.getElementSize_(a.content,u,n);
if(p<m.width){p=m.width
}h+=m.width;
if(k<m.height){k=m.height
}if(m.height>f){f=m.height
}if(p<d.width){p=d.width
}if(k<d.height){k=d.height
}}}else{var q=(this.get("content"));
if(typeof q=="string"){q=this.htmlToDocumentFragment_(q)
}if(q){var d=this.getElementSize_(q,u,n);
if(p<d.width){p=d.width
}if(k<d.height){k=d.height
}}}if(u){p=Math.min(p,u)
}if(n){k=Math.min(k,n)
}p=Math.max(p,h);
if(p==h){p=p+2*g
}l=l*2;
p=Math.max(p,l);
if(p>t){p=t
}if(k>o){k=o-f
}if(this.tabsContainer_){this.tabHeight_=f;
this.tabsContainer_.style.width=this.px(h)
}this.contentContainer_.style.width=this.px(p);
this.contentContainer_.style.height=this.px(k)
};
InfoBubble.prototype.getAnchorHeight_=function(){var a=this.get("anchor");
if(a){var b=(this.get("anchorPoint"));
if(b){return -1*b.y
}}return 0
};
InfoBubble.prototype.anchorPoint_changed=function(){this.draw()
};
InfoBubble.prototype.anchorPoint_changed=InfoBubble.prototype.anchorPoint_changed;
InfoBubble.prototype.positionCloseButton_=function(){var b=this.getBorderRadius_();
var g=this.getBorderWidth_();
var a=2;
var d=2;
if(this.tabs_.length&&this.tabHeight_){d+=this.tabHeight_
}d+=g;
a+=g;
var f=this.contentContainer_;
if(f&&f.clientHeight<f.scrollHeight){a+=15
}this.close_.style.right=this.px(a);
this.close_.style.top=this.px(d)
};
var ActiveModule;
var panels=[];
var activePanel=null;
var enableChangeTimezone=false;
window.client_panel_id=window.location.href+"_"+(new Date).getTime()+(window.username?"_"+window.username:"");
if(window.user&&!window.disableStartAppJs){Ext.onReady(function(){override_Ext_clone();
override_Ext_MessageBox();
if(!window.disableFrameCheck){try{if(top.location.hostname!=self.location.hostname){throw 1
}}catch(a){top.location.href=self.location.href
}}Ext.Ajax.timeout=300000;
Ext.Ajax.setTimeout(300000);
Ext.override(Ext.form.Basic,{timeout:Ext.Ajax.timeout/1000});
Ext.override(Ext.data.proxy.Server,{timeout:Ext.Ajax.timeout});
Ext.override(Ext.data.Connection,{timeout:Ext.Ajax.timeout});
Ext.menu.Item.prototype.menuExpandDelay=50;
Ext.menu.Item.prototype.menuHideDelay=50;
setLang();
if(Ext.isIE&&Ext.ieVersion<11){Ext.Msg.alert(lang.IE_header,lang.IE_msg_old+"<br><br>"+Ext.userAgent);
return
}if(user&&Ext.ieVersion>=11&&!window.ie_warning_skip){user=Ext.decode(user);
Ext.MessageBox.show({title:lang.IE_header,msg:lang.IE_msg+(user_id()>0?'<br/><br/><table><tr><td><input type="checkbox" id="ie_warning_skip"/> <td><span style="display: block; margin-top: -3px; font-size: 12;">'+lang.IE_msg_never_show_again+"</span></table>":""),buttons:Ext.MessageBox.OK,fn:function(b){if(b=="ok"){if(user_id()>0&&Ext.get("ie_warning_skip")&&Ext.get("ie_warning_skip").dom.checked){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"ie_warning",name:"skip",config:1,user_id:user_id(),enableUpdate:true})}})
}eula()
}}});
return
}eula()
})
}function eula(){if(user&&Ext.isString(user)){user=Ext.decode(user)
}if(window.eula_agree||!user_is_admin()){runApp()
}else{var c=Math.min(850,Ext.dom.Element.getViewportWidth()-20);
var a=Ext.dom.Element.getViewportHeight()-50;
var b={xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",autoEl:{tag:"embed",src:"./EULA.pdf",type:"application/pdf"},style:{"border-left":"1px solid "+__color_PanelBorder,"border-right":"1px solid "+__color_PanelBorder,"border-bottom":"1px solid "+__color_PanelBorder},flex:1},{xtype:"container",items:[{xtype:"displayfield",value:findLangS("eula","text"),fieldStyle:{"font-size":"130%","font-weight":"bold"}}],style:{padding:5,"background-color":__color_WindowFrame}},{xtype:"container",layout:{type:"hbox",pack:"center",align:"middle"},items:[{xtype:"button",text:'<span style="font-size: 130%;">'+findLangS("eula","doNotAgreeButton")+"</span>",style:{marginRight:15},height:30,handler:function(){d.close()
}},{xtype:"button",text:'<span style="font-size: 130%; font-weight: bold;">'+findLangS("eula","agreeButton")+"</span>",style:{"font-size":"130%"},height:30,handler:function(){d.close();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"set_eula_agree"}});
runApp()
}}],style:{padding:5,"background-color":__color_WindowFrame}}]};
var d=new Ext.Window({title:findLangS("eula","title"),closable:false,maximizable:true,resizable:true,layout:"fit",items:b,border:false,width:c,height:a});
d.show()
}}function runApp(){if(user&&Ext.isString(user)){user=Ext.decode(user)
}debug_log("onReady");
debug_log(typeDb);
debug_log(user);
if(window.language&&language!="en"){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"setLanguage",params:Ext.encode({language:language,langJsData:treeToArray(langS_En,"//L//")})},success:function(a){if(a.langJsData){setLang(arrayToTree(a.langJsData,"//L//"))
}if(a.langPhpData){window.langS_php=arrayToTree(a.langPhpData,"//L//")
}getPhpData()
}})
}else{ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getPhpLocalizationEn"},success:function(a){if(a.langPhpData){window.langS_php=arrayToTree(a.langPhpData,"//L//")
}getPhpData()
}})
}}function getPhpData(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getPhpData"},success:function(a){window.serverTimeInfo=a.serverTime;
window.serverTimeHourOffset=Math.round((dateTime(a.serverTime.php_time).getTime()-(new Date()).getTime())/3600/1000);
window.timezones=a.timezones;
main()
}})
}function checkDbError(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getLogDbError",params:Ext.encode({cleanDbError:true})},success:function(b){var d="";
if(window.missingLocalAdmin){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">You have no user with admin privileges defined - please create your admin user.</p>'
}if(b.missingSnifferTables){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">Missing sniffer tables - is sniffer running?</p>'
}if(b.lastSIPresponse_id_smallint){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">Primary and reference key for the last sip response is too small. Please run in mysql '+applName+" database this command (WARNING - it can run for hours and can block inserts of new CDR records until the alter is finished):</p>alter table cdr modify column lastSIPresponse_id mediumint unsigned;<br>alter table message modify column lastSIPresponse_id mediumint unsigned;<br>alter table cdr_sip_response modify column id mediumint unsigned not null auto_increment;"
}if(b.missingGuiTables){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">Missing GUI tables.'+(b.logDbError&&b.logDbError.length?" Check errors bellow.":"");
"</p>"
}if(b.readOnlySpool){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">Spool directory is readonly or full. Check permission, state of filesystem and free inodes (df -ih).</p>'
}if(!window.isCloud&&(b.missingCron||b.oldCron)&&!window.DEMO&&!window.debug){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">Crontab log is '+(b.missingCron?"empty":"too old")+'.<p><br>run this command as a root:<br>&nbsp;&nbsp;&nbsp;echo " * * * * * root php '+b.dir+'/run.php cron" >> /etc/crontab'
}if(!window.existsSox){if(d!=""){d+="<br><br><br>"
}d+='<p style="color: red; font-size: 120%;">sox utility is missing:<p><br>run this command as root:<br><br>Debian/Ubuntu: apt-get install sox<br>Redhat/CentOS: yum install sox'
}if(b.logDbError&&b.logDbError.length){for(var c=0;
c<b.logDbError.length;
c++){if(!Ext.isString(b.logDbError[c][0])||!Ext.isString(b.logDbError[c][1])){continue
}if(d!=""){d+="<br><br><br>"
}d+="<p>"+(b.logDbError[c].length>=3?b.logDbError[c][2]:"query:<br>")+b.logDbError[c][0].replaceall("\n","<br>")+(b.logDbError[c].length>=4?b.logDbError[c][3]:"")+"</p>";
d+="<br>";
d+='<p style="color: red">'+b.logDbError[c][1].replaceall("\n","<br>")+"</p>"
}}if(d!=""){Ext.Msg.longalert("SQL / Admin errors",d,function(){if(a&&a.length){window[a[0]](a.splice(1))
}},null,true)
}else{if(a&&a.length){window[a[0]](a.splice(1))
}}}})
}function checkLogSensor(a){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getCountUnconfirmedRowsInLogSensor"},success:function(c){if(c.count>0){var f=Ext.dom.Element.getViewportWidth()-80;
var b=Ext.dom.Element.getViewportHeight()-80;
var d=new Tools.LogSensor.Grid;
var g=new Ext.Window({title:findLangS("sensors","title","newSensorLogs"),iconCls:"icon_tracker",closable:true,maximizable:true,resizable:true,layout:"fit",items:d,border:false,width:f,height:b,modal:true,listeners:{close:function(){window[a[0]](a.splice(1))
}}});
g.show()
}else{window[a[0]](a.splice(1))
}}})
}function checkChangeLicenseKey(a){if(!window.setLicenseToken&&!window.disableAutoLicense&&!window.hideLicense&&!window.isCloud&&!(user.sqlrow.hide_license_information*1)){if(user_id()>0){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"loadConfigSubsystem",params:Ext.encode({subsystem:"license_alert",name:"skip",user_id:user_id()})},success:function(b){if(!(b.config*1)){changeLicenseKey("set_license_token",true,a)
}else{if(a&&a.length){window[a[0]](a.splice(1))
}}},errorFailure2:function(){if(a&&a.length){window[a[0]](a.splice(1))
}}})
}else{changeLicenseKey("set_license_token",true,a)
}}else{if(a&&a.length){window[a[0]](a.splice(1))
}}}function checkFillGeoipCountryTable(c,a){if(window.isCloud){if(c&&c.length){window[c[0]](c.splice(1))
}return
}var b=false;
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkNeedFillGeoipCountry",params:Ext.encode({v6:a})},success:function(d){if(d.error){if(d.error_type!="runAnotherProcess"){Ext.Msg.alert("",d.error,function(){if(c&&c.length){window[c[0]](c.splice(1))
}})
}else{if(c&&c.length){window[c[0]](c.splice(1))
}}}else{if(!d.unsupported&&d.rowsInFile&&(d.emptyTable||d.newVersion||d.rowsInTable<d.rowsInFile-10)){var f=(new Date).getTime();
var g=new Tools.ProgressProcess({text:"updating GeoIP"+(a?"v6":"")+" data - please wait ...",fceCancel:function(){b=true;
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"abortFillTableData",params:Ext.encode({timestampId:f})}})
},fcePercState:function(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"stateFillGeoipCountry",params:Ext.encode({v6:a})},success:function(h){if(h.count<d.rowsInFile-2&&g){g.setPercState(h.count/d.rowsInFile*100)
}}})
},nextFunctions:c});
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"startFillGeoipCountry",params:Ext.encode({timestampId:f,v6:a})},success:function(){g.close();
g=null;
if(!b){refreshCountryDetect();
refreshFraud()
}},timeout:30*60*1000})
}else{if(c&&c.length){window[c[0]](c.splice(1))
}}}},errorFailure2:function(){if(c&&c.length){window[c[0]](c.splice(1))
}}})
}function checkFillGeoipv6CountryTable(a){checkFillGeoipCountryTable(a,true)
}function checkSensorsVersion(a){if(!window.min_sensor_version){if(a&&a.length){window[a[0]](a.splice(1))
}return
}var b=Ext.decode(window.min_sensor_version);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getSensors",params:Ext.encode({stat:true})},success:function(c){var d=null;
var g=null;
if(c.results&&c.results.length){for(var f=0;
f<c.results.length;
f++){if(c.results[f].version_parse&&(Ext.isEmpty(g)||c.results[f].version_parse.num<g)){d=c.results[f].version_parse;
g=c.results[f].version_parse.num
}}}if(d&&d.num<b.num){Ext.Msg.confirm(lang.checkSnifferVersionTitle,lang.checkSnifferVersionTextTooOld+"<br><br>"+lang.checkSnifferVersionUpgradeQuestion,function(h){if(h=="yes"){showPanel("sensor_table");
Ext.defer(function(){if(activePanel.doUpgradeAll){activePanel.doUpgradeAll()
}},500,this)
}else{if(a&&a.length){window[a[0]](a.splice(1))
}}})
}},errorFailure2:function(){if(a&&a.length){window[a[0]](a.splice(1))
}}})
}function main(){window.mouseState={down:false};
document.body.onmousedown=function(){mouseState.down=true
};
document.body.onmouseup=function(){mouseState.down=false
};
Ext.ariaWarn=Ext.emptyFn;
if(getDefaultClientOsTimezone()){window.client_os_timezone=null
}if(window.VERSION){window._load_vm_version=VERSION*1
}setAppData();
applyColorThemeShift();
Ext.QuickTips.init();
autoFillDataStructCustomHeaders();
if(window.userCanNagios){autoFillDataStructNagios();
Nagios.Utils.getObjectDefinitions()
}Ext.apply(Ext.QuickTips.getQuickTip(),{showDelay:50,trackMouse:false});
Ext.ns("App");
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"saveTimezone"}});
ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"sendCrashBt"},success:function(r){if(r.crashOldVersion&&r.existsOldVersion){var s=[];
for(var t in r.crashOldVersion){s.push(t)
}var u=s.length==1?lang.listSensor.template([s[0]]):lang.listSensors.template([s.join(", ")]);
Ext.Msg.confirm(lang.crashOldVersionHeader,lang.crashOldVersionText.template([u]),function(v){if(v=="yes"){upgradeSniffer()
}})
}}});
var c=Ext.create("Ext.data.TreeStore",{autoLoad:true,proxy:{type:"ajax",url:"php/model/sql.php?module=mainmenu",actionMethods:"POST",listeners:{beginprocessresponse:function(t,s,r){s.responseText=Ext.encode(Ext.decode(s.responseText).menu)
}}}});
treePanel=Ext.create("Ext.tree.TreePanel",{id:"tree-panel",region:"center",height:"30%",autoScroll:true,rootVisible:false,lines:true,singleExpand:true,useArrows:true,store:c,border:false,cls:"main-menu",viewConfig:{listeners:{itemclick:function(s,r){if(r.data.children){s.toggle(r)
}}}},listeners:{load:function(){n()
}}});
treePanel.on("itemclick",function(u,r,t,s,v){var y=r.data;
if(y.id=="logout"){if(window.gEnableAuth&&user&&user.glogin&&window._google_auth_loaded){gSignOut();
return
}Ext.Ajax.request({url:"php/model/sql.php",params:{module:"logout"},success:function(){window.onbeforeunload_disable=true;
window.location="./"
},failure:function(){window.onbeforeunload_disable=true;
window.location="./"
},timeout:15000});
return
}var w=this.selModel.selNode||{};
if((y.leaf||y._leaf)&&y.id!=w.id){if(y.id=="load_pcap"&&(!existsCdrTable||!existsCdrNextTable)&&window.isCloud){Ext.Msg.confirm("Confirmation","Missing db tables. Do you want to create tables ?",function(z){if(z==="yes"){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"updateDbSchema"},success:function(A){existsCdrTable=true;
existsCdrNextTable=true;
showPanel(y.id,y.parentId,y,v.shiftKey,v.ctrlKey)
},failure:function(A){showPanel(y.id,y.parentId,y,v.shiftKey,v.ctrlKey)
},maskEl:this,timeout:10*60*1000})
}else{Ext.Msg.alert("Info","Without db tables is not possible to upload pcap.")
}},this)
}else{showPanel(y.id,y.parentId,y,v.shiftKey,v.ctrlKey)
}return
}});
var m="<table><tr>"+(window.resellerLogoId?'<td style="vertical-align: midle; padding-top: 3px; padding-right: 10px;"><img src="'+getUrlWithTaskParams("php/model/utilities.php","getFileFromDb",{table:"ipacc_config_resellers",id:resellerLogoId,attachmentFieldPrefix:"logo"})+'" height="25px;"></td>':"")+'<td style="vertical-align: midle; padding-top: '+(window.resellerLogoId?1:0)+'px; font: bold 16px lucida grande,tahoma,arial,sans-serif;">'+(window.resellerTitle?window.resellerTitle+"&nbsp;&nbsp;-&nbsp;&nbsp;":"")+window.brand_name+"</td></tr></table>";
var k=applyColorThemeShift_color("#e1e1e1");
var b=applyColorThemeShift_color("#b0b0b0");
var d=null;
var l=null;
var f=[];
for(var g=0;
g<2;
g++){if(!(g==0||g==1&&!getDefaultClientOsTimezone())){continue
}var o=new Ext.ux.combobox.ComboBoxA({xtype:"ComboBoxA",id:g==0?"select_timezone":"select_timezone_os",valueField:"name",displayField:"name",aData:{data:window.timezones,fields:["name"]},allowBlank:false,width:__width_FieldChar(g==0?10:3)+__width_FieldChar(32),style:{marginRight:10},fieldStyle:{background:__color_FormBackground,height:"18 !important","min-height":"18 !important"},fieldLabel:g==0?findLangSd("timezone"):findLangSd("timezone_os_short"),labelAlign:"right",labelWidth:__width_FieldChar(g==0?10:3),listeners:{scope:this,afterrender:function(r){if(r.id=="select_timezone"){if(getClientTimezone()){r.setValue(getClientTimezone())
}else{r.markInvalid(findLangSd("timezoneIsRequiredField"))
}if(l){if(getClientOsTimezone()){l.setValue(getClientOsTimezone())
}else{l.markInvalid(findLangSd("timezoneIsRequiredField"))
}}}},select:function(s){var r=s.getValue();
if(r){if(s.id=="select_timezone"){window.client_timezone=r
}else{window.client_os_timezone=r
}if(user_id()>0){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:s.id=="select_timezone"?"timezone":"timezone_os",name:"name",config:r,user_id:user_id(),enableUpdate:true})}})
}if(activePanel&&activePanel.changeTimezone){activePanel.changeTimezone();
if(activePanel.focus){Ext.defer(function(){activePanel.focus()
},1)
}}}}}});
if(g==0){d=o
}else{l=o
}f.push(o)
}f.push({xtype:"displayfield",value:window.VERSION?parseInt(VERSION/10000)+"."+VERSION%10000:"",fieldStyle:{"font-family":"lucida grande,tahoma,arial,sans-serif","font-weight":"bold","font-size":"12px",color:"black",paddingTop:"2px",marginRight:"5px"}});
mviewport=new Ext.create("Ext.Viewport",{layout:"border",items:[{id:"app-header",xtype:"container",region:"north",layout:{type:"hbox"},style:{"background-image":Ext.isGecko?"-moz-linear-gradient(top, "+b+", "+k+")":"-webkit-linear-gradient(top, "+b+", "+k+")"},height:window.resellerLogoId?30:24,items:[{xtype:"displayfield",value:m,fieldStyle:{"font-family":"lucida grande,tahoma,arial,sans-serif","font-weight":"bold","font-size":"16px",color:"black",marginLeft:3,marginTop:0}},{xtype:"container",id:"title_center_info",layout:{type:"hbox",pack:"center",align:"middle"},flex:1},{xtype:"container",layout:{type:"hbox",align:"middle"},items:f,height:24,style:{marginTop:(window.resellerLogoId?5:1)}}],margin:"0 0 4 0"},{layout:"border",id:"main-left-panel",title:lang.maintitleText,region:"west",border:false,split:true,margin:"0 0 4 4",width:setMainMenuFont(window.uc_fontMainMenu)||190,minSize:100,maxSize:500,collapsible:true,collapsed:window.hidemenu,hideCollapseTool:true,border:true,items:treePanel,listeners:{collapse:function(){if(activePanel&&activePanel.onCollapseMainMenu){activePanel.onCollapseMainMenu()
}},expand:function(){if(activePanel&&activePanel.onExpandMainMenu){activePanel.onExpandMainMenu()
}}}},{id:"content-panel",region:"center",layout:"card",margin:"0 4 4 0",activeItem:0,border:false,deferredRender:true,layoutConfig:{deferredRender:true},items:[{id:"start-panel",autoScroll:true,title:"",layout:"fit",bodyStyle:"padding:25px",html:findLangSd("appWelcome").template([brand_name])+(window.hwid&&!window.isCloud?'<p style="margin-top: 4px; font-size: 80%;">hwid: '+window.hwid:"")+(!(user.sqlrow.hide_license_information*1)&&getDaysToLicenseExpiration()<30&&!window.hideLicense?getHtmlLicenseInfo():"")+(user_is_admin()&&!window.disableAutoLicense&&!window.hideLicense?getHtmlLicenseUsernamePassword():"")+(window.serverTimeInfo?getHtmlServerTimeInfo(window.serverTimeInfo,false):"")+(window.upgrade_available||window.upgrade_sniffer_stable_available||window.upgrade_sniffer_beta_available?getHtmlUpgradeChangeLog():"")}]}],listeners:{afterrender:function(){if(window.missingLocalAdmin){showPanel("user_admin")
}else{if(isInitCdrSelectUrlParams()){showPanel("CDR")
}else{if(isInitMessageSelectUrlParams()){showPanel("MESSAGES")
}else{if(isInitSs7SelectUrlParams()){showPanel("SS7")
}else{if(isInitRegisterSelectUrlParams()=="active"){showPanel("Register_active")
}else{if(isInitRegisterSelectUrlParams()=="failed"){showPanel("Register_failed")
}else{if(isInitRegisterSelectUrlParams()=="state"){showPanel("Register_state")
}else{if(isInitSipMsgSelectUrlParams()=="active"){showPanel("SipMsg_active")
}else{if(isInitSipMsgSelectUrlParams()=="stored"){showPanel("SipMsg_stored")
}else{if(window.trackerId){showPanel("Tracker_tickets")
}else{if(window.alertId){if(user_can_alerts_edit()){showPanel("alerts_edit")
}else{Ext.defer(function(){Ext.Msg.alert("",lang.youDoNotHavePermissionToEdit+" alerts.")
},250)
}}else{if(window.reportId){if(user_can_reports_edit()){showPanel("daily_reports_edit")
}else{Ext.defer(function(){Ext.Msg.alert("",lang.youDoNotHavePermissionToEdit+" reports.")
},250)
}}else{if(window.dashboard||window.dashboard_id){showPanel("Dashboard_d")
}else{if(window.activecalls){showPanel("SPY_table")
}else{if(window.svg_paint){showPanel("SvgPaint")
}else{if(window.exclude_ip||window.exclude_ip_dst){if(user_can_alerts_edit()){excludeIp(window.exclude_ip||window.exclude_ip_dst,Ext.isDefined(window.exclude_ip_dst)&&!Ext.isEmpty(window.exclude_ip_dst))
}else{Ext.defer(function(){Ext.Msg.alert("",lang.youDoNotHavePermissionToEdit+" alerts.")
},250)
}delete window.exclude_ip;
delete window.exclude_ip_dst
}else{if(window.exclude_number){if(user_can_alerts_edit()){excludeNumber(window.exclude_number)
}else{Ext.defer(function(){Ext.Msg.alert("",lang.youDoNotHavePermissionToEdit+" alerts.")
},250)
}delete window.exclude_number
}else{if(window.debug){}}}}}}}}}}}}}}}}}}if(window.hidemenu){Ext.defer(function(){Ext.getCmp("main-left-panel").collapse()
},100);
delete window.hidemenu
}}},renderTo:Ext.getBody()});
var q=[];
if(user.login_type=="user"&&user_id()&&!(user.sqlrow.hide_change_password*1)&&(user.secure_users_data.password_expired*1||user.secure_users_data.password_expiration_days*1&&user.secure_users_data.password_duration*1>=user.secure_users_data.password_expiration_days*1)){user.reqPass=true
}if(user.sqlrow.__create_new_secret){user.req2FA=true
}if(user.reqPass||user.req2FA){q.push("requireNewAuth")
}if(user_is_admin()){q.push("checkDbError","checkLogSensor","checkChangeLicenseKey");
if(!window.sensors_timezone){q.push("setSensorsTimezone")
}q.push("checkFillGeoipCountryTable");
q.push("checkFillGeoipv6CountryTable");
q.push("checkSensorsVersion")
}q.push("checkCallStats");
q.push(user_is_admin()?"checkTablesIdProblems":"showSqlBatch");
if(window.debug&&window.test&&window[window.test]&&Ext.isFunction(window[window.test])){q.push(window.test)
}window.onbeforeunload_disable=false;
window.onbeforeunload=function(){if(!(user.sqlrow.uc_disable_confirm_before_unload*1)&&!window.onbeforeunload_disable){return("")
}};
setTimeout(h,5*1000);
Ext.TaskManager.start({run:function(r){if(r){a();
if(!(r%(6*12))){p()
}}},interval:5*60*1000});
function a(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkGuiVersion"},error:function(){},failure:function(){}})
}function p(){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkLicense"},success:function(r){var t=null;
if(r.incompleteCallStats&&!window.isCloud){t="The license check is older than 24 hours. "+(user_is_admin()?"Check your cron configuration.":"There is problem with the license. Please contact admin.")
}else{if(r.maxCallsExceeded){t="Number of concurrent calls was exceeded. "+(user_is_admin()?"The average peak is "+r.maxCallsPeak+" calls and the limit for this license is "+r.limitMaxCalls+".":"There is problem with the license. Please contact admin.")
}}var s=Ext.getCmp("title_center_info");
if(s){s.removeAll();
if(t){s.add({xtype:"displayfield",value:t,style:{marginTop:4},fieldStyle:{color:"red","font-size":"9pt","font-weight":"bold"}})
}}},error:function(){},failure:function(){}})
}function h(){if(window._server_vm_version>window._load_vm_version){Ext.Msg.show({title:lang.newVersionHeader,msg:lang.newVersionText,buttons:Ext.Msg.OKCANCEL,icon:Ext.Msg.QUESTION,fn:function(r){if(r=="ok"){window.onbeforeunload_disable=true;
window.location.reload(true)
}else{setTimeout(h,5*60*1000)
}}})
}else{setTimeout(h,15*1000)
}}function n(){if(q.length){window[q[0]](q.splice(1))
}}if(!Ext.isIE){document.captureEvents(Event.MOUSEMOVE)
}document.onmousemove=getMouseXY;
if(user&&user.glogin){loadGoogleAuth()
}}function showPanel(h,k,g,o,b,c){if(!getClientTimezone()||!getClientOsTimezone()){Ext.Msg.alert("",findLangSd("selectTimezonesFirst"));
return
}if(!evChangeAppPanelSettingForm.apply(this,arguments)){return
}if(!c&&activePanel&&activePanel.evChangeAppPanel&&!activePanel.evChangeAppPanel.apply(activePanel,arguments)){return
}var d=null;
switch(h){case"Dashboard_d":case"SPY":case"SPY_table":case"SPY_map":case"Livepacket":if(!c){fetchSensorInfo(function(){Ext.defer(function(){showPanel(h,k,g,o,b,true)
},10)
});
return
}break;
case"CDR_sip_only":h="CDR";
break;
case"CDR_h323_only":case"CDR_iax_only":case"CDR_other_only":case"CDR_vpn_only":case"report_vpn":case"report_black_ip":case"report_white_ip":Ext.Msg.alert("under development","subsystem "+g.text+" is under development");
return;
case"acl_configuration":case"acl_whitelist":case"acl_blacklist":var d=new ACL.Forms({type:h});
break;
case"load_pcap":case"load_geoip_city_data":case"load_geoip_country_data":case"batch_download_cdr_wav":case"restore_gui_config_tables":case"restore_gui_data_tables":case"restore_gui_configuration":case"load_osm_tiles":var d=new Tools.UploadFile({type:h,shiftKey:o,ctrlKey:b});
break;
case"change_user_auth":var d=new Tools.AuthChangeGuide({type:h,what:"selfaction"});
break;
case"server_side_configuration":var d=new Tools.ServerSideConfiguration({type:h});
break;
case"tcpdump_window":new Tcpdump.Window();
return;
case"ipaccount_realtime_chart":IP_acount.Utils.realTimeChart();
return;
case"user_config":userConfig();
return;
case"show_call_stats":showCallStats();
return;
case"collectd":var d=new Collectd.Panel({type:h});
break;
case"backup_gui_config_tables":backupGuiTables("config");
return;
case"backup_gui_data_tables":backupGuiTables("data");
return;
case"backup_gui_configuration":backupGuiConfiguration();
return;
case"check_mysql_schema":checkTablesIdProblems(null,true);
return;
case"generate_debug_log":generateDebugLog();
return;
case"license":licenseWindow(user_is_admin());
return;
case"upgrade":if(!c){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"checkSession"},success:function(n){showPanel(h,k,g,o,b,true)
}});
return
}break
}if(d){var l=new Ext.Window({title:d.windowTitle,iconCls:d.windowIconCls||d.iconCls,layout:"fit",items:d,border:false,modal:true,closable:true,resizable:false,wikiId:d.windowWikiId});
if(d.iconCls){delete d.iconCls
}l.show();
return
}if(typeof(panels[h])=="boolean"){}var q=false;
enableChangeTimezone=false;
if(typeof(panels[h])=="undefined"){debug_log("Create panel ID: "+h+"PanelX");
var m=Ext.ClassManager.getNameByAlias("widget."+h+"PanelX");
if(m){var f=Ext.ClassManager.get(m);
if(f&&f.prototype&&f.prototype.changeTimezone){enableChangeTimezone=true
}}Ext.getCmp("content-panel").add({xtype:h+"PanelX"});
Ext.getCmp("content-panel").updateLayout();
panels[h]=true;
q=true
}else{debug_log("Activate panel ID: "+h+"PanelX")
}if(activePanel&&activePanel.deactivate){activePanel.deactivate()
}Ext.getCmp("content-panel").layout.setActiveItem(h+"-panel");
var a=Ext.getCmp("content-panel").getComponent(h+"-panel");
if(!q){if(a.changeTimezone){enableChangeTimezone=true
}if(a.reactivate){a.reactivate()
}}activePanel=a;
var p=Ext.getCmp("select_timezone");
if(p){p.showIf(activePanel.changeTimezone)
}ActiveModule=h
}function setMainMenuFont(b){var d=11;
if(b){addRuleToStyleSheet(".main-menu .x-grid-cell","font: "+b,undefined,true,true);
d=b.match(/(\d*)px/);
if(d&&d.length==2){d=d[1];
if(d){var c=Math.max(Math.round(d*1.4),16);
addRuleToStyleSheet(".main-menu .x-grid-cell-inner","line-height: "+c+"px;",undefined,true,true);
var f=Math.round((c-16)/2*1.2+0.5);
if(f){addRuleToStyleSheet(".main-menu img","margin-top: "+f+"px; height: 16px;",undefined,true,true)
}}}}else{addRuleToStyleSheet(".main-menu .x-grid-cell",null,undefined,true,true);
addRuleToStyleSheet(".main-menu .x-grid-cell-inner",null,undefined,true,true);
addRuleToStyleSheet(".main-menu img",null,undefined,true,true)
}var g=Math.max(d>14?190*d/14*0.85:0,190);
var a=Ext.getCmp("main-left-panel");
if(a){a.setWidth(g)
}return(g)
}function getHtmlLicenseInfo(g){var b="";
if(window.ionpropsLimits&&!window.isCloud){ionpropsLimitsObj=Ext.decode(ionpropsLimits);
if(ionpropsLimitsObj){if(!g){b+='<table style="margin-top: 70; margin-left: auto; margin-right: auto; font-weight: bold; color:#555;"><tr><td>'+lang.licenseInformation+"</td></tr></table>"
}var c="margin-top: 10; margin-left: auto; margin-right: auto; border: 1px dotted #999; color:#555; background: #f9f9f9;";
var k="padding-left: 15; padding-right: 40; padding-top: 3; padding-bottom: 3; font-weight: bold;";
var l="text-align: right; padding-left: 40; padding-right: 15; font-weight: bold;";
var f="text-align: right; padding-left: 40; padding-right: 15; font-weight: bold; color: red;";
b+='<table style="'+c+'">';
b+='<tr style="height: 10;"><td colspan=3></td></tr>';
if(ionpropsLimitsObj.expire){var a=date(ionpropsLimitsObj.expire);
var h=Math.round((a.getTime()-(new Date).getTime())/(24*60*60*1000));
var d=h>0?h+" "+(h>1?"days":"day"):"EXPIRED";
b+='<tr><td style="'+k+'">valid through</td><td style="'+l+'">'+Ext.Date.format(a,__format_Date)+'</td><td style="'+(h<8?f:l)+'">'+d+"</td></tr>"
}else{if(ionpropsLimitsObj.upgradeexpire){var a=date(ionpropsLimitsObj.upgradeexpire);
var h=Math.round((a.getTime()-(new Date).getTime())/(24*60*60*1000));
var d=h>0?h+" "+(h>1?"days":"day"):"EXPIRED";
b+='<tr><td style="'+k+'">upgrade expiration</td><td style="'+l+'">'+Ext.Date.format(a,__format_Date)+'</td><td style="'+(h<8?f:l)+'">'+d+"</td></tr>"
}}if(ionpropsLimitsObj.maxcalls){b+='<tr><td style="'+k+'">concurrent calls limit</td><td style="'+l+'">'+ionpropsLimitsObj.maxcalls+'</td><td style="'+l+'"></td></tr>'
}b+='<tr style="height: 10;"><td colspan=3></td></tr>'
}}if(b){b+="</table>";
b+='<table style="margin-top: 10; margin-left: auto; margin-right: auto;"><tr><td><input type="button" value=" change license key " onclick="changeLicenseKey(\'change_license_key\');"></td></tr></table>'
}return(b)
}function getHtmlLicenseUsernamePassword(f){var d="";
if(!window.setLicenseToken&&!window.isCloud){if(!f){d+='<table style="margin-top: 70; margin-left: auto; margin-right: auto; font-weight: bold; color:#555;"><tr><td>'+lang.automaticLicenseUpdate+"</td></tr></table>"
}var a="margin-top: 10; margin-left: auto; margin-right: auto; border: 1px dotted #999; color:#555; background: #f9f9f9;";
var c="padding-left: 15; padding-right: 40; padding-top: 3; padding-bottom: 3; font-weight: bold;";
var b="text-align: right; padding-left: 40; padding-right: 15; font-weight: bold;";
var g="text-align: right; padding-left: 40; padding-right: 15; font-weight: bold; color: red;";
d+='<table style="'+a+'">';
d+='<tr style="height: 10;"><td></td></tr>';
d+='<tr><td style="'+c+'">missing license token</td></tr>';
d+='<tr style="height: 10;"><td></td></tr>'
}if(d){d+="</table>";
d+='<table style="margin-top: 10; margin-left: auto; margin-right: auto;"><tr><td><input type="button" value=" set license token " onclick="changeLicenseKey(\'set_license_token\');"></td></tr></table>'
}return(d)
}function getHtmlServerTimeInfo(k,h){if(window.hideTimezoneInformation){return("")
}var d="";
if(!h){d+='<table style="margin-top: 70; margin-left: auto; margin-right: auto; font-weight: bold; color:#555;"><tr><td>'+lang.timezoneInformation+"</td></tr></table>"
}var a="margin-top: 10; margin-left: auto; margin-right: auto; border: 1px dotted #999; color:#555; background: #f9f9f9;";
var c="padding-left: 15; padding-right: 40; padding-top: 3; padding-bottom: 3; font-weight: bold;";
var f="text-align: left; padding-left: 5; padding-right: 15; font-weight: bold;";
var b="text-align: left; padding-left: 40; padding-right: 15; font-weight: bold;";
d+='<table style="'+a+'">';
d+='<tr style="height: 10;"><td colspan=4></td></tr>';
if(Ext.isDefined(k.php_timezone)){d+='<tr><td style="'+c+'">'+lang.serverPhpTimezone+"</td><td>"+(user_is_admin()?'<img src="images/icon/pencil.png" style="cursor: pointer;" onclick="changePhpTimezone()">':"")+'</td><td style="'+f+'">'+window.php_timezone+(user_is_admin()&&window.php_timezone=="system default"?'<br><span style="color: red; font-size: 80%; cursor: pointer;" onclick="changePhpTimezone()">'+lang.recommendedNoSystemDefaultTimezone+"</span>":"")+'</td><td style="'+b+'">'+k.php_timezone+(Ext.isDefined(k.php_timezone_offset)?"<br>"+g(k.php_timezone_offset):"")+"</td></tr>";
if(Ext.isDefined(k.sensor_timezone)){d+='<tr style="height: 8;"><td colspan=4></td></tr>'
}}if(Ext.isDefined(k.sensor_timezone)&&!window.isCloud){d+='<tr><td style="'+c+'">'+lang.sensorTimezone+"</td><td>"+(user_is_admin()?'<img src="images/icon/pencil.png" style="cursor: pointer;" onclick="changePhpTimezone(true)">':"")+'</td><td style="'+f+'">'+(window.sensors_timezone||lang.notSet)+(user_is_admin()&&window.sensors_timezone=="system default"?'<br><span style="color: red; font-size: 80%; cursor: pointer;" onclick="changePhpTimezone(true)">'+lang.recommendedNoSystemDefaultTimezone+"</span>":"")+'</td><td style="'+b+'">'+k.sensor_timezone+(Ext.isDefined(k.sensor_timezone_offset)?"<br>"+g(k.sensor_timezone_offset):"");
"</td></tr>"
}d+='<tr style="height: 10;"><td colspan=4></td></tr></table>';
return(d);
function g(l){return("UTC/GMT"+(l?" "+(l>0?"+":"")+parseInt(l/60)+((l%60)?":"+(l%60):""):""))
}}function getHtmlUpgradeChangeLog(){var a="";
if(window.upgrade_available&&!window.isCloud){a+='<table style="margin-top: 70; margin-left: auto; margin-right: auto; font-weight: bold; color:#555;"><tr><td style="color: red;">'+lang.newVersionGuiAvaialable+"</td></tr></table>";
if(user_is_admin()){a+='<table style="margin-top: 10; margin-left: auto; margin-right: auto;"><tr><td><input type="button" value=" '+lang.upgrade+' " onclick="upgradeGUI();"></td></tr></table>'
}}if(window.upgrade_sniffer_stable_available||window.upgrade_sniffer_beta_available){a+='<table style="margin-top: '+(window.upgrade_available?30:100)+'; margin-left: auto; margin-right: auto; font-weight: bold; color:#555;"><tr><td style="color: red;">'+lang.newVersionSnifferAvaialable+"</td></tr></table>";
if(user_is_admin()){a+='<table style="margin-top: 10; margin-left: auto; margin-right: auto;"><tr><td><input type="button" value=" '+lang.upgrade+' " onclick="upgradeSniffer();"></td></tr></table>'
}}return(a)
}function getDaysToLicenseExpiration(){var a=null;
if(window.ionpropsLimits){ionpropsLimitsObj=Ext.decode(ionpropsLimits);
if(ionpropsLimitsObj){if(ionpropsLimitsObj.expire){var b=date(ionpropsLimitsObj.expire);
var a=Math.round((b.getTime()-(new Date).getTime())/(24*60*60*1000))
}else{if(ionpropsLimitsObj.upgradeexpire){var b=date(ionpropsLimitsObj.upgradeexpire);
var a=Math.round((b.getTime()-(new Date).getTime())/(24*60*60*1000))
}}}}return(a)
}function licenseWindow(f,c,a){if(!c){var c=getHtmlLicenseInfo(true)
}if(!c){Ext.Msg.alert(lang.information,lang.noLicenseInformation);
return
}if(f&&!Ext.isDefined(a)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"valueFromSystemTable",params:Ext.encode({type:"emailForLicenseExpirationAlert"})},success:function(k){licenseWindow(f,c,k.value||"")
}});
return
}if(user_is_admin()&&!window.disableAutoLicense){licenseUsernamePasswordInfo=getHtmlLicenseUsernamePassword(true);
if(licenseUsernamePasswordInfo){c+="<br>"+licenseUsernamePasswordInfo
}}var d={xtype:"panel",html:c,padding:20,border:false,style:{"background-color":__color_WindowFrame},bodyStyle:{"background-color":__color_WindowFrame},windowTitle:lang.licenseInfoContent};
var h=[d];
if(f){h.push({xtype:"textfield",name:"emailForLicenseExpirationAlert",value:a,fieldLabel:lang.emailForLicenseExpirationAlert,labelAlign:"top",width:300,style:{"margin-top":5}})
}h.push({xtype:"button",text:lang.okButtonText,iconCls:"icon_ok",style:{"margin-top":10},handler:function(){g.close()
}});
var g=new Ext.Window({title:lang.licenseInformation,layout:"fit",items:{xtype:"panel",layout:{type:"vbox",align:"center"},items:h,border:false,style:{"background-color":__color_WindowFrame,"padding-bottom":20},bodyStyle:{"background-color":__color_WindowFrame}},border:false,modal:true,closable:true,resizable:false,listeners:{close:b}});
g.show();
function b(){if(!f){return
}var k=g.findC("name","emailForLicenseExpirationAlert").getValue();
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"valueToSystemTable",params:Ext.encode({type:"emailForLicenseExpirationAlert",value:k})}})
}}function changeLicenseKey(g,f,l){var m=false;
if(g=="change_license_key"){g=lang.changeLicenseKey
}else{if(g=="set_license_token"){g=lang.setLicenseToken;
m=true
}}var c=[];
if(f){c.push({xtype:"displayfield",value:"If you would like to configure automated license download please enter your license token.",fieldStyle:{marginTop:5,marginBottom:10,color:"red"}})
}c.push({xtype:"displayfield",value:"If you do not have account yet please create one on:",fieldStyle:{"font-weight":"bold","font-style":"italic"}},{xtype:"displayfield",value:'<a href="'+appFreeTrialUrl+'" style="color: blue;" target="_blank">'+appFreeTrialUrl+"</a>",style:{marginLeft:20}},{xtype:"displayfield",value:"If you have an account enter your license token:",fieldStyle:{"font-weight":"bold","font-style":"italic"}},{xtype:"textfield",name:"license_token",width:__width_FieldChar(64)+__width_FieldChar(12)+__width_FieldSeparator,fieldLabel:"license token",labelWidth:__width_FieldChar(12),style:{marginLeft:20}});
if(!m){c.push({xtype:"button",text:"get license key",handler:function(){d(a)
},style:{marginLeft:20+__width_FieldChar(12)+__width_FieldSeparator}})
}if(!m){c.push({xtype:"displayfield",value:"If your server does not have access to internet<br>please paste your license key which you can get from:",fieldStyle:{"font-weight":"bold","font-style":"italic"}},{xtype:"displayfield",value:'<a href="'+appLicenseUrl+'" style="color: blue;" target="_blank">'+appLicenseUrl+"</a>",style:{marginLeft:20}},{xtype:"textarea",name:"key",width:400,height:300,fieldLabel:lang.newKey,labelWidth:__width_FieldChar(lang.newKey.length),style:{marginLeft:20}})
}var a=new Ext.form.FormPanel({items:c,buttons:{items:[{text:lang.okButtonText,handler:function(){if(m){d(a)
}else{k(a)
}}},{text:f?lang.skipButtonText:lang.cancelButtonText,handler:function(){if(f){h()
}a.ownerCt.close()
}}],style:{"background-color":__color_WindowFrame,marginTop:0}},bodyStyle:{"background-color":__color_WindowFrame},border:false});
var b=new Ext.Window({title:g,items:a,autoWidth:true,autoHeight:true,border:false,modal:true,listeners:{afterrender:function(){a.getForm().findField(m?"license_token":"key").focus(false,200);
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getLicenseToken"},success:function(n){if(n.license_token){a.getForm().findField("license_token").setValue(n.license_token)
}}})
},close:function(){if(l&&l.length){window[l[0]](l.splice(1))
}}}});
b.show();
function k(o){var n=o.getForm().findField("key").getValue();
if(!n){Ext.Msg.alert("","missing key")
}else{ajaxSafeRequest({scope:this,url:"php/model/ioncube.php",params:{task:"setLicenseKey",params:Ext.encode({key:n})},success:function(p){ajaxSafeRequest({scope:this,url:"php/model/ioncubecheck.php",success:function(q){if(q.error){_alertAjaxError(q)
}else{o.ownerCt.close();
window.onbeforeunload_disable=true;
window.location.reload()
}},error:function(){o.ownerCt.close();
window.onbeforeunload_disable=true;
window.location="./"
},failure:function(){o.ownerCt.close();
window.onbeforeunload_disable=true;
window.location="./"
}})
},maskEl:b})
}}function d(n){var o=n.getForm().findField("license_token").getValue();
if(!o){Ext.Msg.alert("","missing license token")
}else{ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getLicenseKey",params:Ext.encode({license_token:o})},success:function(p){if(m){n.ownerCt.close();
window.onbeforeunload_disable=true;
window.location="./"
}else{n.getForm().findField("key").setValue(p.key);
Ext.Msg.alert("","The license key was successfully downloaded. Now you can confirm the license by pressing the OK button.",function(){k(n)
})
}},maskEl:b})
}}function h(){if(user_id()>0){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"saveConfigSubsystem",params:Ext.encode({subsystem:"license_alert",name:"skip",config:1,user_id:user_id(),enableUpdate:true})}})
}}}function changePhpTimezone(f,d){var c=new Ext.form.FormPanel({items:[{xtype:"ComboBoxA",name:"timezone",width:350,fieldLabel:lang.timezone,labelWidth:__width_FieldChar(12),value:f?window.sensors_timezone:window.php_timezone,aData:{data:window.timezones,fields:["tz"]},valueField:"tz",displayField:"tz",allowBlank:false},f&&!window.sensors_timezone?{xtype:"displayfield",value:lang.sensorTimezoneDisplayText,width:350}:undefined],buttons:{items:[{text:lang.okButtonText,handler:function(){b(c,f)
}},{text:lang.cancelButtonText,handler:function(){c.ownerCt.close()
}}],style:{"background-color":__color_WindowFrame,marginTop:0}},bodyStyle:{"background-color":__color_WindowFrame},border:false});
var a=new Ext.Window({title:f?lang.setSensorTimezone:lang.setTimezone,items:c,autoWidth:true,autoHeight:true,border:false,modal:true,listeners:{afterrender:function(){c.getForm().findField("timezone").focus(false,200)
},close:function(){if(d&&d.length){window[d[0]](d.splice(1))
}}}});
a.show();
function b(h,k){var g=h.getForm().findField("timezone").getValue();
if(h.getForm().isValid()&&g){if(g!=(k?window.sensors_timezone:window.php_timezone)){ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:k?"setSensorsTimezone":"setTimezone",params:Ext.encode({timezone:g})},success:function(l){h.ownerCt.close();
window.onbeforeunload_disable=true;
window.location="./"
},maskEl:a})
}else{h.ownerCt.close()
}}}}function setSensorsTimezone(a){changePhpTimezone(true,a)
}function requireNewAuth(c){var b=new Tools.AuthChangeGuide({what:"requiredaction",skipAuth:true,reqPass:user.reqPass,req2FA:user.req2FA});
var a=new Ext.Window({title:findLangSd("title","setupPassword2FA"),onEsc:false,layout:"fit",items:b,border:false,modal:true,closable:false,resizable:false,listeners:{close:function(){if(c&&c.length){window[c[0]](c.splice(1))
}}}});
a.show()
}function upgradeGUI(m){if(m){var c=["check_system","check_init_directory","check_license","check_files","download_upgrade","check_unzip_upgrade","upgrade"];
var l=[];
for(var f=0;
f<c.length;
f++){l.push({value:lang.upgradeSteps[c[f]],style:{marginRight:20}},{value:"",width:150,upgradeStep:c[f]})
}var g=0;
var a=null;
var d=new Ext.Window({title:lang.upgradingPleaseWait,items:{layout:{type:"table",columns:2},defaults:{xtype:"displayfield"},items:l,border:false,bodyStyle:{"background-color":__color_WindowFrame}},autoWidth:true,autoHeight:true,border:false,modal:true,closable:false,bodyStyle:{"background-color":__color_WindowFrame},listeners:{destroy:function(){Ext.TaskManager.stop(a)
}}});
d.on("activate",b,null,{single:true});
d.show()
}else{mviewport.getEl().mask(lang.loadingNewVersionGuiInformationPleaseWait,"x-mask-loading");
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:m?"upgradeGUI":"getNewVersionGUI"},success:function(n){mviewport.unmask();
Ext.Msg.longalert(lang.questionText,"<b>"+lang.upgradeGuiQuestion.template([parseInt(n.data.majorminor/10000)+"."+n.data.majorminor%10000])+"</b><br><br><i><u>"+lang.changelog+":</u></i><br><br>"+n.data.upgrade_changelog_html,function(o){if(o=="yes"){upgradeGUI(n.data)
}},this,true,{buttons:Ext.Msg.YESNO})
},errorFailure2:function(){mviewport.unmask()
},timeout:30*60*1000})
}function b(){a=Ext.TaskManager.start({run:k,interval:500});
h()
}function h(){var n=d.findC("upgradeStep",c[g]);
n.setValue(lang.processing+" ...");
n.inputEl.setStyle({color:"blue","font-weight":"bold"});
ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"upgradeGUI",params:Ext.encode({task:c[g]})},success:function(o){if(c[g]=="check_system"&&(o.mysql_version==50540||o.mysql_version==50541)){Ext.Msg.confirm("",lang.mysqlHasCriticalError,function(q){if(q=="yes"){p.call(this)
}else{g=0;
n.setValue(lang.FAIL);
n.inputEl.setStyle({color:"red","font-weight":"bold"});
Ext.defer(function(){d.close()
},2000)
}},this);
return
}else{p.call(this)
}function p(){n.setValue(lang.OK);
n.inputEl.setStyle({color:"green","font-weight":"bold"});
if(g<c.length-1){++g;
h()
}else{g=0;
Ext.defer(function(){d.close();
window.onbeforeunload_disable=true;
window.location="./"
},2000)
}}},error:function(o,p){var q=g;
g=0;
n.setValue(lang.FAIL);
n.inputEl.setStyle({color:"red","font-weight":"bold"});
Ext.defer(function(){var r=null;
if(p&&p.responseText){r=Ext.decode(p.responseText);
if(isDataEmpty(r)){r={msg:p.responseText}
}}var s=getStringAjaxError(r);
Ext.Msg.show({title:lang.upgradeSteps[c[q]]+" - "+lang.failed,msg:s,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,fn:function(){Ext.defer(function(){d.close()
},2000)
}})
},2000)
},failure2:function(){g=0;
n.setValue(lang.FAIL);
n.inputEl.setStyle({color:"red","font-weight":"bold"});
Ext.defer(function(){d.close()
},2000)
}})
}function k(){if(g!=3){return
}ajaxSafeRequest({scope:this,url:"php/model/utilities.php",params:{task:"getFileSize",params:Ext.encode({file:"../../l.tar.gz"})},success:function(n){if(g==3&&n.size){var o=d.findC("upgradeStep",c[3]);
if(o.getValue().match(lang.processing)){o.setValue(lang.processing+" ... "+formatNumber(n.size/(1024*1024),1)+"MB")
}}}})
}}function upgradeSniffer(){Ext.Msg.show({title:lang.newVersionHeader,msg:lang.newVersionSnifferText,buttons:Ext.Msg.OK,icon:Ext.Msg.ALERT,fn:function(a){showPanel("sensor_table")
}})
}function backupGuiTables(a){Ext.Msg.confirm(a=="config"?lang.backupGuiConfigTablesTitle:lang.backupGuiDataTablesTitle,a=="config"?lang.backupGuiConfigTablesQuestionRun:lang.backupGuiDataTablesQuestionRun,function(b){if(b=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"prepareBackupGuiTables",params:Ext.encode({type:a})},success:function(c){downloadPrepareFileHash(c)
},maskEl:mviewport,maskMsg:lang.preparingBackupGuiTables,timeout:30*60*1000})
}})
}function backupGuiConfiguration(){Ext.Msg.confirm(lang.backupGuiConfigurationTitle,lang.backupGuiConfigurationQuestionRun,function(a){if(a=="yes"){ajaxSafeRequest({url:"php/model/utilities.php",params:{task:"prepareBackupGuiConfiguration"},success:function(b){downloadPrepareFileHash(b)
},maskEl:mviewport,maskMsg:lang.preparingBackupGuiConfiguration,timeout:30*60*1000})
}})
}function getMouseXY(a){var c=0;
var b=0;
if(Ext.isIE){c=event.clientX+document.body.scrollLeft;
b=event.clientY+document.body.scrollTop
}else{c=a.pageX;
b=a.pageY
}if(c>=0&&b>=0){window.XY=[c,b]
}};